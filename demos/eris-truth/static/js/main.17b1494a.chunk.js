(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{113:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a="DEFAULT_CONFIG__SET_DEFAULT_CONFIG"},114:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a="EVENT_DRAWER__STATUS"},115:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a="STATEFUL__UPDATE_STATUS"},181:function(e,t,n){e.exports=n(565)},21:function(e,t,n){"use strict";n.d(t,"d",function(){return a}),n.d(t,"b",function(){return s}),n.d(t,"l",function(){return o}),n.d(t,"a",function(){return i}),n.d(t,"k",function(){return r}),n.d(t,"h",function(){return c}),n.d(t,"c",function(){return l}),n.d(t,"j",function(){return p}),n.d(t,"i",function(){return d}),n.d(t,"f",function(){return u}),n.d(t,"g",function(){return h}),n.d(t,"e",function(){return v});var a="EVENTS__EVENT_SELECTED",s="EVENTS__EVENT_EDITED",o="EVENT__EVENT_RESET",i="EVENTS__EVENT_CLOSE",r="EVENT__EVENT_REFRESH",c="EVENT__EVENT_NEW",l="EVENTS__EVENT_NEW_UPDATE",p="EVENT__EVENT_NEW_RESET",d="EVENT__EVENT_NEW_CANCEL",u="EVENTS__FETCH_EVENT_DATA_PENDING",h="EVENTS__FETCH_EVENT_DATA_SUCCESS",v="EVENTS__FETCH_EVENT_DATA_ERROR"},301:function(e,t,n){e.exports=n(564)},310:function(e,t,n){},41:function(e,t,n){"use strict";n.d(t,"c",function(){return a}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"e",function(){return i}),n.d(t,"a",function(){return r});var a="DATA__FETCH_DATA_PENDING",s="DATA__FETCH_DATA_SUCCESS",o="DATA__FETCH_DATA_ERROR",i="DATA__REFRESH_VIEWPORT_DATA",r="DATA__CLEAR"},433:function(e,t,n){},435:function(e,t,n){},440:function(e,t,n){},51:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return o}),n.d(t,"d",function(){return i});var a="VOTER__FETCH_VOTER_PENDING",s="VOTER__FETCH_VOTER_SUCCESS",o="VOTER__FETCH_VOTER_ERROR",i="VOTER__UPDATE_VOTER_DATA"},533:function(e,t,n){},550:function(e,t,n){},552:function(e,t,n){},56:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return o});var a="VOTE__FETCH_VOTES_PENDING",s="VOTE__FETCH_VOTES_SUCCESS",o="VOTE__FETCH_VOTES_ERROR"},560:function(e,t,n){},564:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),o=n(16),i=n.n(o),r=n(29),c=(n(310),n(25)),l=n(26),p=n(35),d=n(34),u=n(36),h=n(8),v=n(12),f=n(279),m=n(11),g=n(13),E=n.n(g),_=n(97),y=n(94),b=n.n(y),O=n(54),S=n.n(O),w=n(71),C=n.n(w),T=n(55),k=n.n(T),D=n(24),j=n.n(D),V=n(27),N=n.n(V),R=n(64),x=n.n(R),U=n(28),P=n.n(U),B=n(284),F=n.n(B),I=n(285),L=n.n(I),H=n(286),A=n.n(H),M=n(287),Y=n.n(M),G=n(288),q=n.n(G),K=n(289),W=n.n(K),z=n(72),J=n.n(z),Z=n(182),$=n(73),Q=n.n($),X=n(22),ee=n.n(X),te=n(76);function ne(e){return{type:te.b,settings:e}}var ae=n(41);n(215);function se(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}var oe=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"fetchData",value:function(e){var t=window.document.createElement("a");return t.href=e,e=":"===t.protocol?"//".concat(e):e,new Promise(function(t,n){fetch(e).then(se).then(function(e){return e.json()}).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"postData",value:function(e,t){var n=window.document.createElement("a");return n.href=e,e=":"===n.protocol?"//".concat(e):e,new Promise(function(n,a){fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(se).then(function(e){return e.json()}).then(function(e){n(e)}).catch(function(e){a(e)})})}},{key:"putData",value:function(e,t){var n=window.document.createElement("a");return n.href=e,e=":"===n.protocol?"//".concat(e):e,new Promise(function(n,a){fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(se).then(function(e){return e.json()}).then(function(e){n(e)}).catch(function(e){a(e)})})}},{key:"getEventObj",value:function(e){return{event_id:e.event_id,video_offset_sec:e.video_offset_sec,event_time:e.event_time,event_lat:e.event_lat,event_lon:e.event_lon,event_altitude:e.event_altitude,product_id:e.product_id,dataset_id:e.dataset_id,is_modified:e.is_modified,notes:e.notes,first_name:e.first_name,last_name:e.last_name,video_id:e.video_id}}},{key:"getNewEventId",value:function(){return"New Event"}},{key:"deleteData",value:function(e){var t=window.document.createElement("a");return t.href=e,e=":"===t.protocol?"//".concat(e):e,new Promise(function(t,n){fetch(e,{method:"DELETE"}).then(se).then(function(e){return e.json()}).then(function(e){t(e)}).catch(function(e){n(e)})})}}]),e}();function ie(e){return function(t){var n;return t((n={},{type:ae.c,data:n})),oe.fetchData(e).then(function(e){t(function(e){return{type:ae.d,data:e}}({results:e}))}).catch(function(e){t(function(e){return{type:ae.b,error:e}}(e))})}}n(433);var re=function(e){return s.a.createElement("div",{className:"toast-content"},s.a.createElement("h3",null,e.title),e.message)},ce=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={fetch:!1,start:e.settings.start||E.a.utc().subtract(1,"d").startOf("h").toISOString(),end:e.settings.end||E.a.utc().startOf("h").toISOString(),startTime:{hour:"",minute:"",second:""},endTime:{hour:"",minute:"",second:""},isModified:!0},n._updateData=n._updateData.bind(Object(h.a)(Object(h.a)(n))),n._setTime=n._setTime.bind(Object(h.a)(Object(h.a)(n))),n._updateSettings=n._updateSettings.bind(Object(h.a)(Object(h.a)(n))),n._toastInvalidDate=n._toastInvalidDate.bind(Object(h.a)(Object(h.a)(n))),n._handleOnChange=n._handleOnChange.bind(Object(h.a)(Object(h.a)(n))),n._changeTime=n._changeTime.bind(Object(h.a)(Object(h.a)(n))),n._handleTimeChange=n._handleTimeChange.bind(Object(h.a)(Object(h.a)(n))),n._handleOnKeyDown=n._handleOnKeyDown.bind(Object(h.a)(Object(h.a)(n))),n._stepRange=n._stepRange.bind(Object(h.a)(Object(h.a)(n))),n._setRange=n._setRange.bind(Object(h.a)(Object(h.a)(n))),n._setToday=n._setToday.bind(Object(h.a)(Object(h.a)(n))),n._setStartOfDay=n._setStartOfDay.bind(Object(h.a)(Object(h.a)(n))),n._setEndOfDay=n._setEndOfDay.bind(Object(h.a)(Object(h.a)(n))),n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"_updateData",value:function(){var e=this.props.bounds,t="".concat(this.props.config.dataUrl,"/events?minlon=").concat(e._southWest.lng,"&minlat=").concat(e._southWest.lat,"&maxlon=").concat(e._northEast.lng,"&maxlat=").concat(e._northEast.lat,"&start=").concat(this.props.settings.start,"&end=").concat(this.props.settings.end,"&filterByNoVote=").concat(this.props.settings.filterByNoVote,"&filterByUpvote=").concat(this.props.settings.filterByUpvote,"&filterByDownvote=").concat(this.props.settings.filterByDownvote,"&filterByUserVotes=").concat(this.props.settings.filterByUserVotes);this.props.fetchData(t),this.setState({isModified:!1})}},{key:"_setTime",value:function(e){var t=E.a.utc(this.state[e],this.props.config.dateFormat).isValid(),n={hour:t?("0"+E.a.utc(this.state[e]).hour()).slice(-2):"00",minute:t?("0"+E.a.utc(this.state[e]).minute()).slice(-2):"00",second:t?("0"+E.a.utc(this.state[e]).second()).slice(-2):"00"};"start"===e?this.setState({startTime:n}):this.setState({endTime:n})}},{key:"_updateSettings",value:function(e,t){var n=this;this.setState({fetch:!0},function(){var a=Object.assign({},n.props.settings);a.start=e,a.end=t,n.props.updateSettings(a)})}},{key:"_toastInvalidDate",value:function(e,t){(t=t||null)||(t="start"===e?"Invalid Start Date.":"Invalid End Date."),Object(v.toast)(s.a.createElement(re,{title:"Error Setting Date Value",message:t}),{type:v.toast.TYPE.ERROR})}},{key:"_handleOnChange",value:function(e,t){var n=Object.assign({},this.props.settings);"Invalid date"===t?(this._toastInvalidDate(e),n[e]=t):("start"===e?E.a.utc(t,this.props.config.dateFormat).isAfter(E.a.utc(this.state.end,this.props.config.dateFormat))&&this._toastInvalidDate(e,"Start Date is after End Date."):E.a.utc(t,this.props.config.dateFormat).isBefore(E.a.utc(this.state.start,this.props.config.dateFormat))&&this._toastInvalidDate(e,"End Date is before Start Date."),n[e]=E.a.utc(t).toISOString()),this.props.updateSettings(n)}},{key:"_changeTime",value:function(e,t,n){var a=this;if(n[t].length>2&&(n[t]=("0"+n.hour).slice(-2)),!isNaN(n[t])){(n.hour>23||n.hour<0)&&(n.hour=n.hour>23?23:0),(n.minute>59||n.minute<0)&&(n.minute=n.minute>59?59:0),(n.second>59||n.second<0)&&(n.second=n.second>59?59:0);var s={hour:("0"+n.hour).slice(-2),minute:("0"+n.minute).slice(-2),second:("0"+n.second).slice(-2)},o="startTime"===e?E.a.utc(this.state.start):E.a.utc(this.state.end);o.set(s),"startTime"===e?this.setState({start:o.toISOString(),startTime:s},function(){a._handleOnChange("start",a.state.start)}):"endTime"===e&&this.setState({end:o.toISOString(),endTime:s},function(){a._handleOnChange("end",a.state.end)})}}},{key:"_handleTimeChange",value:function(e,t,n){var a=this,s=m.cloneDeep(this.state[t]);s[n]=e,"startTime"===t?this.setState({startTime:s},function(){e.length>1&&a._changeTime("startTime",n,s)}):this.setState({endTime:s},function(){e.length>1&&a._changeTime("endTime",n,s)})}},{key:"_handleOnKeyDown",value:function(e,t,n){var a=0,s=m.clone(this.state[n]);"hour"===t?a=23:"minute"!==t&&"second"!==t||(a=60),"ArrowUp"===e.key?(isNaN(s[t])&&(s[t]="00".slice(-2)),s[t]<a&&s[t]++,s[t]=("0"+s[t]).slice(-2),this._changeTime(n,t,s)):"ArrowDown"===e.key&&(isNaN(s[t])&&(s[t]="00".slice(-2)),s[t]>0&&s[t]--,s[t]=("0"+s[t]).slice(-2),this._changeTime(n,t,s))}},{key:"_stepRange",value:function(e){var t=E.a.utc(this.state.start),n=E.a.utc(this.state.end),a=E.a.duration(n.diff(t)),s=function(a){t="forward"===e?E.a.utc(t).add(1,a).toISOString():E.a.utc(t).subtract(1,a).toISOString(),n="forward"===e?E.a.utc(n).add(1,a).toISOString():E.a.utc(n).subtract(1,a).toISOString()};a.hours()>0&&a.minutes()>0&&a.seconds()>0?s("d"):a.minutes()>0&&a.seconds()>0?s("h"):a.seconds()>0?s("m"):(t="forward"===e?t.add(a).toISOString():t.subtract(a).toISOString(),n="forward"===e?n.add(a).toISOString():n.subtract(a).toISOString()),this._updateSettings(t,n)}},{key:"_setRange",value:function(e,t){var n=E.a.utc().add(e,t).startOf(t),a=E.a.utc().startOf(t);(-1===e&&"hours"===t||-30===e&&"minutes"===t)&&(n=E.a.utc().add(e,t).toISOString(),a=E.a.utc().toISOString()),this._updateSettings(n,a)}},{key:"_setToday",value:function(){var e=E.a.utc().startOf("d").toISOString(),t=E.a.utc().endOf("d").toISOString();this._updateSettings(e,t)}},{key:"_setStartOfDay",value:function(){var e=this,t={hour:"00".slice(-2),minute:"00".slice(-2),second:"00".slice(-2)},n=E.a.utc(this.state.start);n.set({hour:("0"+t.hour).slice(-2),minute:("0"+t.minute).slice(-2),second:("0"+t.second).slice(-2)}),this.setState({start:n.toISOString(),startTime:t,isModified:!0},function(){e._handleOnChange("start",e.state.start)})}},{key:"_setEndOfDay",value:function(){var e=this,t=E.a.utc(this.state.end);t.set({hour:23,minute:59,second:59}),this.setState({end:t.toISOString(),endTime:{hour:23,minute:59,second:59},isModified:!0},function(){e._handleOnChange("end",e.state.end)})}},{key:"componentDidMount",value:function(){this._setTime("start"),this._setTime("end")}},{key:"componentDidUpdate",value:function(e,t){var n=this;this.props.settings&&!m.isEqual(e.settings,this.props.settings)&&(e.settings.start!==this.props.settings.start||e.settings.end!==this.props.settings.end?this.setState({start:this.props.settings.start,end:this.props.settings.end,isModified:!0},function(){n._setTime("start"),n._setTime("end")}):this.setState({isModified:!1})),m.isEqual(t,this.state)||t.fetch!==this.state.fetch&&this.state.fetch&&this.setState({fetch:!1},function(){n._updateData()})}},{key:"render",value:function(){var e=this,t=E.a.utc(this.state.start).format(this.props.config.dateFormat),n=E.a.utc(this.state.end).format(this.props.config.dateFormat),a="Invalid date"===this.state.start||"Invalid date"===this.state.end||E.a.utc(this.state.start).isAfter(E.a.utc(this.state.end))||E.a.utc(this.state.end).isBefore(E.a.utc(this.state.start)),o=[];return m.forEach(this.props.config.ranges,function(t){o.push(s.a.createElement(N.a,{key:t.units,style:{minWidth:"50px"},labelStyle:{padding:0,fontSize:"13px"},primary:!0,label:"".concat(t.label),onClick:function(){e._setRange(t.units,t.unitOfTime)}}))}),o.push(s.a.createElement(N.a,{key:"today",style:{minWidth:"50px"},labelStyle:{padding:0,fontSize:"13px"},primary:!0,label:"TODAY",onClick:this._setToday})),s.a.createElement("div",{className:"temporalFilter"},s.a.createElement("div",{className:"margin-bottom-md"},"Temporal Filter"),s.a.createElement("div",{className:"temporalFilter__start"},s.a.createElement("div",{className:"temporalFilter__datepicker"},s.a.createElement("label",{className:"temporalFilter__label"},"Start Date"),s.a.createElement(Z.a,{date:t,format:this.props.config.dateFormat,onChange:function(t){e._handleOnChange("start",t)}})),s.a.createElement(ee.a,{id:"start-hour",title:"Hour",type:"tel",floatingLabelFixed:!0,floatingLabelText:"Hour",value:this.state.startTime.hour,style:{width:"65px",height:"64px",fontSize:"14px"},onChange:function(t,n){e._handleTimeChange(n,"startTime","hour")},onKeyDown:function(t){e._handleOnKeyDown(t,"hour","startTime")}}),s.a.createElement(ee.a,{id:"start-minute",title:"Minute",type:"tel",floatingLabelFixed:!0,floatingLabelText:"Minute",value:this.state.startTime.minute,style:{width:"65px",height:"64px",fontSize:"14px"},onChange:function(t){e._handleOnChange("startTime",t)},onKeyDown:function(t){e._handleOnKeyDown(t,"minute","startTime")}}),s.a.createElement(ee.a,{id:"start-second",title:"Second",type:"tel",floatingLabelFixed:!0,floatingLabelText:"Second",value:this.state.startTime.second,style:{width:"65px",height:"64px",fontSize:"14px"},onChange:function(t){e._handleOnChange("startTime",t)},onKeyDown:function(t){e._handleOnKeyDown(t,"second","startTime")}}),s.a.createElement("div",{className:"temporalFilter__time-btn"},s.a.createElement("span",{className:"fa fa-hourglass-start",onClick:this._setStartOfDay}))),s.a.createElement("div",{className:"temporalFilter__end"},s.a.createElement("div",{className:"temporalFilter__datepicker"},s.a.createElement("label",{className:"temporalFilter__label"},"End Date"),s.a.createElement(Z.a,{date:n,format:this.props.config.dateFormat,onChange:function(t){e._handleOnChange("end",t)}})),s.a.createElement(ee.a,{id:"end-hour",title:"Hour",type:"tel",floatingLabelFixed:!0,floatingLabelText:"Hour",value:this.state.endTime.hour,style:{width:"65px",height:"64px",fontSize:"14px"},onChange:function(t,n){e._handleTimeChange(n,"endTime","hour")},onKeyDown:function(t){e._handleOnKeyDown(t,"hour","endTime")}}),s.a.createElement(ee.a,{id:"end-minute",title:"Minute",type:"tel",floatingLabelFixed:!0,floatingLabelText:"Minute",value:this.state.endTime.minute,style:{width:"65px",height:"64px",fontSize:"14px"},onChange:function(t){e._handleOnChange("endTime",t)},onKeyDown:function(t){e._handleOnKeyDown(t,"minute","endTime")}}),s.a.createElement(ee.a,{id:"end-second",title:"Second",type:"tel",floatingLabelFixed:!0,floatingLabelText:"Second",value:this.state.endTime.second,style:{width:"65px",height:"64px",fontSize:"14px"},onChange:function(t){e._handleOnChange("endTime",t)},onKeyDown:function(t){e._handleOnKeyDown(t,"second","endTime")}}),s.a.createElement("div",{className:"temporalFilter__time-btn"},s.a.createElement("span",{className:"fa fa-hourglass-end",onClick:this._setEndOfDay}))),s.a.createElement("div",{className:"temporalFilter__ranges"},o),s.a.createElement("div",{className:"temporalFilter__controls"},s.a.createElement(Q.a,{icon:s.a.createElement("i",{className:"fa fa-caret-left"}),buttonStyle:{width:"35px"},style:{minWidth:"35px"},backgroundColor:"#9e9e9e",onClick:function(){e._stepRange("backward")}}),s.a.createElement(Q.a,{className:"temporalFilter__controls-apply",label:"Apply",buttonStyle:{width:"100px"},primary:this.state.isModified,onClick:function(){e._updateSettings(e.state.start,e.state.end)},disabled:a}),s.a.createElement(Q.a,{icon:s.a.createElement("i",{className:"fa fa-caret-right"}),buttonStyle:{width:"35px"},style:{minWidth:"35px"},backgroundColor:"#9e9e9e",onClick:function(){e._stepRange("forward")}})))}}]),t}(a.Component),le=Object(r.b)(function(e){return{config:e.config,settings:e.settings}},{updateSettings:ne,fetchData:ie})(ce),pe=n(290),de=n.n(pe),ue=n(112),he=n.n(ue),ve=n(291),fe=n.n(ve),me=n(292),ge=n.n(me),Ee=(n(435),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={noBtnColor:"#fff",upBtnColor:"#fff",downBtnColor:"#fff"},n._updateData=n._updateData.bind(Object(h.a)(Object(h.a)(n))),n._handleOnChange=n._handleOnChange.bind(Object(h.a)(Object(h.a)(n))),n._setBtnColors=n._setBtnColors.bind(Object(h.a)(Object(h.a)(n))),n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"_updateData",value:function(){var e=this.props.bounds,t="".concat(this.props.config.dataUrl,"/events?minlon=").concat(e._southWest.lng,"&minlat=").concat(e._southWest.lat,"&maxlon=").concat(e._northEast.lng,"&maxlat=").concat(e._northEast.lat,"&start=").concat(this.props.settings.start,"&end=").concat(this.props.settings.end,"&filterByNoVote=").concat(this.props.settings.filterByNoVote,"&filterByUpvote=").concat(this.props.settings.filterByUpvote,"&filterByDownvote=").concat(this.props.settings.filterByDownvote,"&filterByUserVotes=").concat(this.props.settings.filterByUserVotes);this.props.fetchData(t)}},{key:"_handleOnChange",value:function(e,t){var n=Object.assign({},this.props.settings);"filterByNoVote"===e&&!0===t&&(this.props.settings.filterByUpvote||this.props.settings.filterByDownvote)?(n.filterByUpvote=!1,n.filterByDownvote=!1):"filterByUpvote"!==e&&"filterByDownvote"!==e||!this.props.settings.filterByNoVote||(n.filterByNoVote=!1),n[e]=t,this.props.updateSettings(n)}},{key:"_setBtnColors",value:function(){this.setState({noBtnColor:!this.props.settings.filterByNoVote||this.props.settings.filterByUpvote||this.props.settings.filterByDownvote?"#fff":"#0097a7",upBtnColor:this.props.settings.filterByUpvote&&!this.props.settings.filterByNoVote?"#0097a7":"#fff",downBtnColor:this.props.settings.filterByDownvote&&!this.props.settings.filterByNoVote?"#0097a7":"#fff"})}},{key:"componentDidMount",value:function(){this._setBtnColors()}},{key:"componentDidUpdate",value:function(e){this.props.settings&&!m.isEqual(e.settings,this.props.settings)&&(this._setBtnColors(),e.settings.filterByNoVote===this.props.settings.filterByNoVote&&e.settings.filterByUpvote===this.props.settings.filterByUpvote&&e.settings.filterByDownvote===this.props.settings.filterByDownvote&&e.settings.filterByUserVotes===this.props.settings.filterByUserVotes||this._updateData())}},{key:"render",value:function(){var e=this,t=this.props.settings.filterByUserVotes?s.a.createElement(fe.a,null):s.a.createElement(ge.a,null),n=this.props.settings.filterByUserVotes?"Show Your Votes":"Show All Votes";return s.a.createElement("div",null,s.a.createElement("div",{className:"voteFilter"},s.a.createElement("div",null,"Vote Filter"),s.a.createElement("div",{className:"voteFilter__btns"},s.a.createElement(j.a,{className:"voteFilter_user",tooltip:n,onClick:function(){e._handleOnChange("filterByUserVotes",!e.props.settings.filterByUserVotes)}},t),s.a.createElement("div",{className:"divider"},"\xa0"),s.a.createElement(j.a,{className:"voteFilter__novote",tooltip:"Events without votes",onClick:function(){e._handleOnChange("filterByNoVote",!e.props.settings.filterByNoVote)}},s.a.createElement(de.a,{color:this.state.noBtnColor})),s.a.createElement(j.a,{className:"voteFilter__upvote",tooltip:"Upvoted events",onClick:function(){e._handleOnChange("filterByUpvote",!e.props.settings.filterByUpvote)}},s.a.createElement(he.a,{color:this.state.upBtnColor})),s.a.createElement(j.a,{className:"voteFilter__downvote",tooltip:"Downvoted events",tooltipPosition:"bottom-left",onClick:function(){e._handleOnChange("filterByDownvote",!e.props.settings.filterByDownvote)}},s.a.createElement(J.a,{color:this.state.downBtnColor})))))}}]),t}(a.Component)),_e=Object(r.b)(function(e){return{config:e.config,settings:e.settings}},{updateSettings:ne,fetchData:ie})(Ee);function ye(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t}var be=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"getVersion",value:function(e){return new Promise(function(t,n){fetch(e).then(ye).then(function(e){return e.json()}).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"getState",value:function(e){return new Promise(function(t,n){fetch(e).then(ye).then(function(e){return e.json()}).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"setState",value:function(e,t){return new Promise(function(n,a){fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(ye).then(function(e){return e.json()}).then(function(e){n(e)}).catch(function(e){a(e)})})}}]),e}(),Oe=n(77);function Se(e){return{type:Oe.b,config:e}}function we(e){return{type:Oe.a,config:e}}var Ce=n(21);function Te(e){return{type:Ce.f,event:e}}function ke(e){return{type:Ce.e,eventError:e}}function De(e){return function(t){t(function(e){return{type:Ce.d,event:e}}(e))}}function je(e){return function(t){t({type:e.new?Ce.c:Ce.b,event:e})}}function Ve(e){return function(t){return t(Te({})),oe.fetchData(e).then(function(e){var n=m.cloneDeep(e);null===n.notes&&(n.notes=""),t({type:Ce.l,event:n})}).catch(function(e){t(ke(e))})}}function Ne(e){return function(t){t({type:Ce.c,event:e})}}var Re=n(56);function xe(e){return function(t){var n;return t((n={},{type:Re.b,eventVotes:n})),oe.fetchData(e).then(function(e){var n;t((n={results:e},{type:Re.c,eventVotes:n}))}).catch(function(e){var n;t((n=e,{type:Re.a,eventVotesError:n}))})}}var Ue=n(57);function Pe(e){return function(t){var n;return t((n={},{type:Ue.b,userVotes:n})),oe.fetchData(e).then(function(e){var n;t((n={results:e},{type:Ue.c,userVotes:n}))}).catch(function(e){var n;t((n=e,{type:Ue.a,userVotesError:n}))})}}var Be=n(96);function Fe(){return function(e){e({type:Be.a})}}var Ie=function(e){return s.a.createElement("div",{className:"toast-content"},s.a.createElement("h3",null,"Share Application State"),s.a.createElement("a",{href:e.href},e.href))},Le=(n(216),n(438),n(440),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).cache=new _.c({fixedWidth:!0,defaultHeight:100}),n.state={showHelp:!1,dataUrl:n.props.config.dataUrl,pending:!1,eventIdx:0,userVotes:null,windowWidth:1,windowHeight:1,csvPending:!1},n.listRef=s.a.createRef(),n._handleHelpOpen=n._handleHelpOpen.bind(Object(h.a)(Object(h.a)(n))),n._handleHelpClose=n._handleHelpClose.bind(Object(h.a)(Object(h.a)(n))),n._saveConfig=n._saveConfig.bind(Object(h.a)(Object(h.a)(n))),n._resetConfig=n._resetConfig.bind(Object(h.a)(Object(h.a)(n))),n._exportCsv=n._exportCsv.bind(Object(h.a)(Object(h.a)(n))),n._handleOnChange=n._handleOnChange.bind(Object(h.a)(Object(h.a)(n))),n._updateData=n._updateData.bind(Object(h.a)(Object(h.a)(n))),n._updateDimensions=n._updateDimensions.bind(Object(h.a)(Object(h.a)(n))),n._rowRenderer=n._rowRenderer.bind(Object(h.a)(Object(h.a)(n))),n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"_handleHelpOpen",value:function(){this.setState({showHelp:!0})}},{key:"_handleHelpClose",value:function(){this.setState({showHelp:!1})}},{key:"_saveConfig",value:function(){var e=m.cloneDeep(this.props.config);e.viewport=this.props.viewport,e.settings=this.props.settings,this.props.saveConfig(e),v.toast.isActive(this.settingsToast)||(this.settingsToast=Object(v.toast)(s.a.createElement(re,{title:"Application state saved."}),{type:v.toast.TYPE.SUCCESS}))}},{key:"_resetConfig",value:function(){this.props.updateConfig(this.props.defaultConfig),this.props.saveConfig(this.props.defaultConfig),this.props.resetSettings(this.props.defaultConfig),v.toast.isActive(this.settingsToast)||(this.settingsToast=Object(v.toast)(s.a.createElement(re,{title:"Application state reset."}),{type:v.toast.TYPE.SUCCESS}))}},{key:"_exportCsv",value:function(){var e=this;this.setState({csvPending:!0},function(){oe.fetchData("".concat(e.props.config.dataUrl,"/events?filterByUpvote=true")).then(function(t){oe.postData("".concat(e.props.config.erisDownloadUrl,"/api/eris-truth/csv"),{data:t,erisUrl:e.props.config.erisUrl}).then(function(t){e.setState({csvPending:!1},function(){if(t.message)Object(v.toast)(s.a.createElement(re,{title:"CSV Export",message:t.message}),{type:v.toast.TYPE.INFO});else if(t.file){var e=document.createElement("a");document.body.appendChild(e),e.style="display: none",e.href=t.file,e.click()}else t.error&&Object(v.toast)(s.a.createElement(re,{title:"CSV Export",message:t.error.message}),{type:v.toast.TYPE.ERROR})})}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error generating CSV",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})})}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error retrieving events",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})})})}},{key:"_handleOnChange",value:function(e,t){var n=Object.assign({},this.props.settings);n[e]=t,this.props.updateSettings(n)}},{key:"_handleEventClicked",value:function(e){var t=m.cloneDeep(e);null===t.notes&&(t.notes=""),null===t.first_name&&(t.first_name=""),null===t.last_name&&(t.last_name=""),t.event_id===this.props.event.event_id&&(t.open=!1),this.props.selectEvent(t),this.props.flyToCoordinates(t),this.props.fetchEventVotes("".concat(this.props.config.dataUrl,"/votes/event/").concat(t.event_id))}},{key:"_updateData",value:function(){var e=this.props.bounds,t="".concat(this.props.config.dataUrl,"/events?minlon=").concat(e._southWest.lng,"&minlat=").concat(e._southWest.lat,"&maxlon=").concat(e._northEast.lng,"&maxlat=").concat(e._northEast.lat,"&start=").concat(this.props.settings.start,"&end=").concat(this.props.settings.end,"&filterByNoVote=").concat(this.props.settings.filterByNoVote,"&filterByUpvote=").concat(this.props.settings.filterByUpvote,"&filterByDownvote=").concat(this.props.settings.filterByDownvote,"&filterByUserVotes=").concat(this.props.settings.filterByUserVotes);this.props.fetchData(t)}},{key:"_handleDownvoteClicked",value:function(e,t){var n=this;e.stopPropagation(),e.preventDefault();var a={event_id:t.event_id,vote:!1,vote_time:E.a.utc().toISOString(),event_time:E.a.utc(t.event_time).toISOString(),geo_confidence:!1,off_camera:!1},o=this._getUserVote(t);o&&!0===o.vote?oe.putData("".concat(this.props.config.dataUrl,"/votes/").concat(o.vote_id),a).then(function(){Object(v.toast)(s.a.createElement(re,{title:"Vote updated"}),{type:v.toast.TYPE.SUCCESS}),n.props.fetchUserVotes("".concat(n.props.config.dataUrl,"/votes/voter"))}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error updating vote",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})}):o&&!1===o.vote?oe.deleteData("".concat(this.props.config.dataUrl,"/votes/").concat(o.vote_id)).then(function(){Object(v.toast)(s.a.createElement(re,{title:"Downvote removed"}),{type:v.toast.TYPE.SUCCESS}),n.props.fetchUserVotes("".concat(n.props.config.dataUrl,"/votes/voter"))}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error deleting vote",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})}):oe.postData("".concat(this.props.config.dataUrl,"/votes"),a).then(function(){Object(v.toast)(s.a.createElement(re,{title:"Vote saved"}),{type:v.toast.TYPE.SUCCESS}),n.props.fetchUserVotes("".concat(n.props.config.dataUrl,"/votes/voter"))}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error adding vote",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})})}},{key:"_getUserVote",value:function(e){return m.find(this.state.userVotes,{event_id:e.event_id})}},{key:"_updateDimensions",value:function(){var e=window,t=document,n=t.documentElement,a=t.getElementsByTagName("body")[0],s=e.innerWidth||n.clientWidth||a.clientWidth,o=e.innerHeight||n.clientHeight||a.clientHeight,i=document.querySelector(".events__list"),r=o-Math.floor(i.getBoundingClientRect().top)-10;i.style.height="".concat(r,"px"),this.setState({windowWidth:s,windowHeight:o})}},{key:"_rowRenderer",value:function(e){var t=this,n=e.index,a=e.key,o=e.style,i=e.parent,r="".concat("/demos/eris-truth","/unavailable.png"),c=this.props.data.results[n],l=this._getUserVote(c),p=null;return null!==l&&"undefined"!==typeof l&&m.has(l,"vote")||(p=s.a.createElement(j.a,{className:"grid__event-downvote",onClick:function(e){t._handleDownvoteClicked(e,c)}},s.a.createElement(J.a,{color:"#fff"}))),s.a.createElement(_.b,{key:a,cache:this.cache,parent:i,columnIndex:0,rowIndex:n},function(e){var n=e.measure;return s.a.createElement("div",{style:o},s.a.createElement("div",{onClick:function(){t._handleEventClicked(c)},onMouseOver:function(){t.props.onEventHover(c)},onMouseOut:function(){t.props.onEventHover(null)},className:t.props.event.event_id===c.event_id?"grid__event grid__event-selected":"grid__event"},s.a.createElement("div",{className:"grid__event-header-bar"},s.a.createElement("div",{cols:1,rows:1,className:"grid__event-header"},s.a.createElement("div",{className:"grid__event-header-title"},c.event_id),s.a.createElement("div",{className:"grid__event-header-subtitle"},s.a.createElement("span",null,"(",parseFloat(c.event_lat).toPrecision(6),",",parseFloat(c.event_lon).toPrecision(6),")"))),s.a.createElement("div",{className:"grid__event-icon"},p)),s.a.createElement("img",{onLoad:n,src:c.gif_path,className:"freezeframe freezeframe-responsive",onError:function(e){e.target.onerror=null,e.target.src=r},height:"auto",width:"100%",alt:"alt"})))})}},{key:"componentDidMount",value:function(){this.props.config.stateful&&(this.props.stateful.value?this.props.stateful.error&&Object(v.toast)(s.a.createElement(re,{title:"State server error",message:this.props.stateful.error}),{type:v.toast.TYPE.ERROR}):Object(v.toast)(s.a.createElement(re,{title:"Unable to contact state server",message:this.props.stateful.error}),{type:v.toast.TYPE.ERROR})),this.props.fetchUserVotes("".concat(this.props.config.dataUrl,"/votes/voter")),window.addEventListener("resize",this._updateDimensions),this._updateDimensions()}},{key:"componentDidUpdate",value:function(e){var t=this;!m.isEqual(e.data,this.props.data)&&this.props.data.refresh&&this._updateData(),this.props.data&&!m.isEqual(e.data,this.props.data)?(this.setState({pending:this.props.data.pending}),this.props.data.results&&this.props.data.results.error&&(v.toast.isActive(this.fetchToast)||(this.fetchToast=Object(v.toast)(s.a.createElement(re,{title:"Data Error",message:this.props.data.results.error.toString()}),{type:v.toast.TYPE.ERROR})))):m.isEqual(e.event,this.props.event)||(this.props.event.refresh?this._updateData():this.setState({eventIdx:m.findIndex(this.props.data.results,function(e){return e.event_id===t.props.event.event_id})})),this.props.userVotes&&!m.isEqual(e.userVotes,this.props.userVotes)&&(this.props.userVotes.error?v.toast.isActive(this.fetchToast)||(this.fetchToast=Object(v.toast)(s.a.createElement(re,{title:"Error retrieving user votes",message:this.props.userVotes.error.toString()}),{type:v.toast.TYPE.ERROR})):this.props.userVotes.pending||this.setState({userVotes:this.props.userVotes.results},function(){t.listRef.current.forceUpdateGrid()})),this.props.eventVotes&&!m.isEqual(e.eventVotes,this.props.eventVotes)&&this.props.eventVotes.error&&(v.toast.isActive(this.fetchToast)||(this.fetchToast=Object(v.toast)(s.a.createElement(re,{title:"Error retrieving event votes",message:this.props.eventVotes.error.toString()}),{type:v.toast.TYPE.ERROR})));var n=document.querySelector("#event-notes"),a=document.querySelector("#event-first-name"),o=document.querySelector("#event-last-name");if(!m.isEqual(n,document.activeElement)&&!m.isEqual(a,document.activeElement)&&!m.isEqual(o,document.activeElement)&&this.props.hotkey&&!m.isEqual(e.hotkey,this.props.hotkey))if(!this.props.data.results||"w"!==this.props.hotkey.key&&"s"!==this.props.hotkey.key&&"a"!==this.props.hotkey.key&&"d"!==this.props.hotkey.key)"f"===this.props.hotkey.key&&this._updateData();else if(this.props.event&&0!==m.keys(this.props.event).length){var i=null;"a"===this.props.hotkey.key?i=this.state.eventIdx>0?this.state.eventIdx-1:this.props.data.results.length-1:"s"!==this.props.hotkey.key&&"w"!==this.props.hotkey.key&&"d"!==this.props.hotkey.key||(i=this.props.data.results.length-1>=this.state.eventIdx+1?this.state.eventIdx+1:0),this.setState({eventIdx:i},function(){t._handleEventClicked(t.props.data.results[t.state.eventIdx])})}else this._handleEventClicked(this.props.data.results[0]),this.setState({eventIdx:0})}},{key:"render",value:function(){var e=this,t=this.props.config.stateful?s.a.createElement(P.a,{leftIcon:s.a.createElement(W.a,null),primaryText:"Share",onClick:this.props.share}):null,n=[s.a.createElement(N.a,{label:"Close",secondary:!0,onClick:this._handleHelpClose})],a=this.state.pending?s.a.createElement(b.a,null):null,o=this.state.csvPending?s.a.createElement(b.a,{size:25,thickness:2.5}):null,i=0;return this.props.data.results&&Array.isArray(this.props.data.results)&&Array.isArray(this.props.data.results)&&(i=this.props.data.results.length||0),window.$(".freezeframe").freezeframe(),s.a.createElement("div",{className:"settings"},s.a.createElement(C.a,{width:"25%",containerClassName:"settings__drawer"},s.a.createElement("div",{className:"settings__actions"},s.a.createElement("h1",null,"Eris Truth ",o),s.a.createElement(x.a,{iconButtonElement:s.a.createElement(j.a,null,s.a.createElement(Y.a,null)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},className:"settings__menu"},s.a.createElement(P.a,{leftIcon:s.a.createElement(q.a,null),primaryText:"Save",onClick:this._saveConfig}),s.a.createElement(P.a,{leftIcon:s.a.createElement(L.a,null),primaryText:"Reset",onClick:this._resetConfig}),t,s.a.createElement(P.a,{leftIcon:s.a.createElement(A.a,null),primaryText:"Export",onClick:this._exportCsv}),s.a.createElement(k.a,null),s.a.createElement(P.a,{leftIcon:s.a.createElement(F.a,null),primaryText:"Help",onClick:this._handleHelpOpen}))),s.a.createElement("div",{className:"settings__filters"},s.a.createElement(_e,{bounds:this.props.bounds}),s.a.createElement(le,{bounds:this.props.bounds})),s.a.createElement("h3",{className:"text-center margin-bottom-sm"},"Events (",i,")"),s.a.createElement("div",{className:"events__list"},s.a.createElement("div",{className:"settings__loading"},a),s.a.createElement(_.a,null,function(t){var n=t.width,a=t.height;return s.a.createElement(_.d,{ref:e.listRef,width:n,height:a,deferredMeasurementCache:e.cache,rowHeight:e.cache.rowHeight,rowRenderer:e._rowRenderer,rowCount:i,scrollToIndex:e.state.eventIdx})}))),s.a.createElement(v.ToastContainer,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,pauseOnHover:!0}),s.a.createElement(S.a,{title:"Eris Truth Help",modal:!1,open:this.state.showHelp,onRequestClose:this._handleHelpClose,actions:n,autoScrollBodyContent:!0,className:"settings__help"},s.a.createElement("h4",null,"Menu Options"),s.a.createElement("div",{className:"settings__help_list"},s.a.createElement("dl",null,s.a.createElement("dt",null,"Save"),s.a.createElement("dd",null,"Save the current filter settings to the browser's local storage."),s.a.createElement("dt",null,"Reset"),s.a.createElement("dd",null,"Reset filter settings back to their default values.")),s.a.createElement("dl",null,s.a.createElement("dt",null,"Share"),s.a.createElement("dd",null,"Save the current state of the app and generate a shareable URL to retrieve it."),s.a.createElement("dt",null,"Export"),s.a.createElement("dd",null,"Download a CSV of all the events that users have upvoted."))),s.a.createElement("h4",null,"Keyboard Shortcuts"),s.a.createElement("div",{className:"settings__help_list"},s.a.createElement("dl",null,s.a.createElement("dt",null,"W"),s.a.createElement("dd",null,"Upvote Event"),s.a.createElement("dt",null,"S"),s.a.createElement("dd",null,"Downvote Event"),s.a.createElement("dt",null,"A"),s.a.createElement("dd",null,"Previous Event"),s.a.createElement("dt",null,"D"),s.a.createElement("dd",null,"Next Event"),s.a.createElement("dt",null,"F"),s.a.createElement("dd",null,"Filter Events")),s.a.createElement("dl",null,s.a.createElement("dt",null,"Space"),s.a.createElement("dd",null,"Pause/Resume Video"),s.a.createElement("dt",null,"Period"),s.a.createElement("dd",null,"Increase Video Playback Speed"),s.a.createElement("dt",null,"Comma"),s.a.createElement("dd",null,"Decrease Video Playback Speed"),s.a.createElement("dt",null,"ESC"),s.a.createElement("dd",null,"Close Event")))))}}]),t}(a.Component)),He=Object(r.b)(function(e,t){return{defaultConfig:e.defaultConfig,config:e.config,settings:e.settings,data:e.data,mapPoint:e.mapPoint,event:e.event,eventVotes:e.eventVotes,userVotes:e.userVotes,share:function(){try{var t={app_name:"eris-truth",user_state:JSON.stringify(e)};be.setState("".concat(e.config.stateful,"/states"),t).then(function(e){Object(v.toast)(s.a.createElement(Ie,{href:"".concat(window.location.origin,"/?id=").concat(e.id)}),{autoClose:!1,closeOnClick:!1})}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Unable to contact state server",message:e.message}),{type:v.toast.TYPE.ERROR})})}catch(n){Object(v.toast)(s.a.createElement(re,{title:"Unable to serialize state",message:n.message}),{type:v.toast.TYPE.ERROR})}},stateful:e.stateful}},{updateConfig:Se,updateSettings:ne,resetSettings:function(e){return{type:te.a,defaultConfig:e}},saveConfig:we,fetchData:ie,clearData:function(){return function(e){e({type:ae.a})}},flyToCoordinates:function(e){return function(t){t(function(e){return{type:Be.b,event:e}}(e))}},clearCoordinates:Fe,selectEvent:De,fetchEventVotes:xe,resetEvent:Ve,fetchUserVotes:Pe})(Le),Ae=n(300),Me=n(20),Ye=n.n(Me),Ge=n(293),qe=n.n(Ge),Ke=n(294),We=(n(443),n(444),n(445),n(295)),ze=n(296),Je=n.n(ze),Ze=n(113);function $e(e){return{type:Ze.a,defaultConfig:e}}n(531),n(533);var Qe=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={map:null,viewport:e.config.viewport,refreshStyle:null,hoveredEvent:null,selectedEvent:null,selectedEventMarker:null,dragging:null,addingNewEvent:null,kmlPending:!1},n.mapRef=s.a.createRef(),n.eventsGroup=new Ye.a.FeatureGroup,n.selectedEventGroup=new Ye.a.FeatureGroup,n.drawGroup=new Ye.a.FeatureGroup,n.drawControl=new Ye.a.Control.Draw({draw:{polyline:!1,polygon:!1,circle:!1,rectangle:!1,circlemarker:!1},edit:{featureGroup:n.drawGroup}}),n._handleRefreshClicked=n._handleRefreshClicked.bind(Object(h.a)(Object(h.a)(n))),n._refreshMap=n._refreshMap.bind(Object(h.a)(Object(h.a)(n))),n._drawEvent=n._drawEvent.bind(Object(h.a)(Object(h.a)(n))),n._exportKml=n._exportKml.bind(Object(h.a)(Object(h.a)(n))),n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"_drawMarker",value:function(e){var t=this,n=Ye.a.circleMarker(Ye.a.latLng(e.event_lat,e.event_lon),{color:"#ffffff",weight:2,fillOpacity:1,radius:8,fillColor:"#0097a7",event:e});return n.bindPopup("".concat(e.event_lat,", ").concat(e.event_lon,"<br />").concat(e.event_time),{offset:Ye.a.point(0,-5),autoPan:!1}),n.on("mouseover",function(e){e.target.openPopup()}),n.on("mouseout",function(e){e.target.closePopup()}),n.on("click",function(){t.props.fetchEventVotes("".concat(t.props.config.dataUrl,"/votes/event/").concat(e.event_id)),t.props.selectEvent(e)}),n.addTo(this.eventsGroup),n}},{key:"_getGeomBounds",value:function(){if(this.props.event){var e=null,t=null;try{e=JSON.parse(this.props.event.video_geom)}catch(a){console.log(a)}if("Point"===e.type)t=Ye.a.latLng(e.coordinates[1],e.coordinates[0]).toBounds(100);else{var n=qe()(e);t=new Ye.a.latLngBounds([[n[1],n[0]],[n[3],n[2]],[this.props.event.event_lat,this.props.event.event_lon]])}return t}}},{key:"_onViewportChange",value:function(e){var t=this;m.isEqual(e,this.state.viewport)||(this.viewportChanged=!0),this.setState({viewport:Object(Ae.a)({},this.state.viewport,e),refreshStyle:this.viewportChanged?{display:"block",transform:"scaleY(1)"}:{display:"none",transform:"scaleY(0)"}},function(){t.props.onViewportChange(t.state.viewport),t.props.onBoundsChange(t.state.map.getBounds())})}},{key:"_handleRefreshClicked",value:function(){var e=this;this.setState({refreshStyle:{display:"none",transform:"scaleY(0)"}},function(){e.viewportChanged=!1,e.props.refreshViewportData()})}},{key:"_configLayers",value:function(e){var t={};return m.forEach(e,function(e){var n=null;e.options&&((n=Object.assign({},e.options)).crs="EPSG:4326"===n.crs?Ye.a.CRS.EPSG4326:Ye.a.CRS.EPSG3857),t[e.name]="tile"===e.type?Ye.a.tileLayer(e.url):Ye.a.tileLayer.wms(e.url,n)}),t}},{key:"_refreshMap",value:function(e){var t=this;this.eventsGroup.clearLayers(),m.forEach(this.props.data.results,function(n){"update"===e?(t.props.event&&t.props.event.event_id!==n.event_id||!t.props.event)&&t._drawMarker(n):t._drawMarker(n)}),this.setState({refreshStyle:{display:"none",transform:"scaleY(0)"}},function(){"mount"===e&&t.props.event&&t.props.event.event_id&&t._drawEvent()})}},{key:"_drawEvent",value:function(){var e=this;this.state.map.addControl(this.drawControl);var t=m.find(this.eventsGroup.getLayers(),{options:{event:{event_id:this.props.event.event_id}}});t&&this.setState({selectedEvent:t},function(){var n=Ye.a.latLng(e.props.event.event_lat,e.props.event.event_lon);e.eventsGroup.removeLayer(t);var a=Ye.a.marker(n,{draggable:!0,event:t.options.event});if(a.bindPopup("".concat(e.props.event.event_lat,", ").concat(e.props.event.event_lon,"<br />").concat(e.props.event.event_time),{offset:Ye.a.point(0,-5),autoPan:!1}),a.on("mouseover",function(e){e.target.openPopup()}),a.on("mouseout",function(e){e.target.closePopup()}),a.on("drag",function(n){e.setState({dragging:!0},function(){var a=Object.assign({},t.options.event);a.event_lat=n.latlng.lat,a.event_lon=n.latlng.lng,e.props.editEvent(a),e.props.onDrag(!0)})}),a.on("dragend",function(){e.setState({dragging:!1},function(){e.props.onDrag(!1)})}),a.addTo(e.selectedEventGroup),e.setState({selectedEventMarker:a}),e.props.event.video_geom){var s=null;try{s=JSON.parse(e.props.event.video_geom),Ye.a.geoJSON(s).addTo(e.selectedEventGroup)}catch(o){console.log("Error parsing geometry")}}e.state.map.flyToBounds(e._getGeomBounds())})}},{key:"_exportKml",value:function(){var e=this;this.setState({kmlPending:!0},function(){var t=e.selectedEventGroup.toGeoJSON();m.forEach(t.features,function(t){t.properties.event_time=e.props.event.event_time});var n=Ke(t,{timestamp:"event_time"});oe.postData("".concat(e.props.config.erisDownloadUrl,"/api/kml"),{kml:n}).then(function(t){e.setState({kmlPending:!1},function(){if(t.message)Object(v.toast)(s.a.createElement(re,{title:"KML Export",message:t.message}),{type:v.toast.TYPE.INFO});else if(t.file){var e=document.createElement("a");document.body.appendChild(e),e.style="display: none",e.href=t.file,e.click()}else t.error&&Object(v.toast)(s.a.createElement(re,{title:"KML Export",message:t.error.message}),{type:v.toast.TYPE.ERROR})})}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error generating KML",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})})})}},{key:"componentDidMount",value:function(){var e=this,t=this._configLayers(this.props.config.baseMaps),n=this._configLayers(this.props.config.overlays);this.setState({map:Ye.a.map("map",{center:this.props.config.viewport.center,zoom:this.props.config.viewport.zoom,layers:[t[this.props.config.defaultBaseMap]],maxBounds:Ye.a.latLngBounds([-90,-180],[90,180]),keyboard:!1,maxZoom:21})},function(){Ye.a.control.scale({imperial:!1}).addTo(e.state.map),Ye.a.control.layers(t,n).addTo(e.state.map),Ye.a.control.coordinates({enableUserInput:!1,useLatLngOrder:!0}).addTo(e.state.map),e.drawGroup.addTo(e.state.map),e.eventsGroup.addTo(e.state.map),e.selectedEventGroup.addTo(e.state.map);var a=e.state.map.getCenter();e.viewportChanged=!0,e._onViewportChange({center:[a.lat,a.lng],zoom:e.state.map.getZoom()}),e.state.map.on("moveend",function(){e.viewportChanged=!0,e._onViewportChange({center:e.state.map.getCenter(),zoom:e.state.map.getZoom()})}),e.state.map.on(Ye.a.Draw.Event.CREATED,function(t){e.setState({addingNewEvent:!0},function(){e.state.selectedEvent&&(e.eventsGroup.addLayer(e.state.selectedEvent),e.selectedEventGroup.removeLayer(e.state.selectedEventMarker)),e.props.onNewEvent(t.layer),e.drawGroup.addLayer(t.layer)})}),e.state.map.on(Ye.a.Draw.Event.DELETED,function(){e.setState({addingNewEvent:!1},function(){e.props.onNewEvent(null),e.drawGroup.clearLayers()})}),e.props.data&&e.props.data.results&&(e._refreshMap("mount"),e.props.event&&e.props.event.event_id&&(e.mapRef.current.style.width="42%",e.mapRef.current.style.right="33%",e.state.map.invalidateSize()))})}},{key:"componentDidUpdate",value:function(e){if(m.isEqual(e.data,this.props.data)||this.props.data.pending||!this.props.data.results||this._refreshMap("update"),!m.isEqual(e.hoverEvent,this.props.hoverEvent))if(this.props.hoverEvent){var t=m.find(this.eventsGroup.getLayers(),{options:{event:{event_id:this.props.hoverEvent.event_id}}});t?this.setState({hoveredEvent:t},function(){t.openPopup()}):(t=m.find(this.selectedEventGroup.getLayers(),{options:{event:{event_id:this.props.hoverEvent.event_id}}}))&&this.setState({hoveredEvent:t},function(){t.openPopup()})}else this.state.hoveredEvent&&(this.state.hoveredEvent.closePopup(),this.setState({hoveredEvent:null}));if(!m.isEqual(e.event,this.props.event)&&!this.state.dragging)if(this.props.event.new);else if(this.props.event.refresh){if(this.state.selectedEvent)if(this.state.addingNewEvent){if(!m.isEqual(this.props.event,this.state.selectedEvent.options.event)){var n=m.cloneDeep(this.state.selectedEvent);n.options.event=this.props.event,n._latlng=Ye.a.latLng(this.props.event.event_lat,this.props.event.event_lon),this.setState({selectedEvent:n}),this.props.refreshViewportData()}}else{var a=m.cloneDeep(this.state.selectedEvent);a._latlng=Ye.a.latLng(this.props.event.event_lat,this.props.event.event_lon),this.setState({selectedEvent:a})}this.setState({addingNewEvent:!1})}else{if(this.selectedEventGroup.clearLayers(),this.drawGroup.clearLayers(),this.state.selectedEvent){var s=m.cloneDeep(this.state.selectedEvent.options.event);s.refresh=!1;var o=this._drawMarker(s);this.eventsGroup.addLayer(o),this.setState({selectedEvent:null})}this.props.event.close?(this.state.map.removeControl(this.drawControl),this.setState({selectedEvent:null})):this._drawEvent()}m.isEqual(e.eventDrawerStatus,this.props.eventDrawerStatus)||(this.props.eventDrawerStatus?(this.mapRef.current.style.width="42%",this.mapRef.current.style.right="33%"):(this.mapRef.current.style.width="75%",this.mapRef.current.style.right=0),this.state.map.invalidateSize()),m.isEqual(e.kmlEvent,this.props.kmlEvent)||this._exportKml()}},{key:"render",value:function(){return s.a.createElement("div",{id:"map",ref:this.mapRef},s.a.createElement("div",{className:"map__refresh-map",style:this.state.refreshStyle},s.a.createElement(We.a,{mini:!0,onClick:this._handleRefreshClicked},s.a.createElement(Je.a,null))))}}]),t}(a.Component),Xe=Object(r.b)(function(e){return{defaultConfig:e.defaultConfig,config:e.config,settings:e.settings,data:e.data,mapPoint:e.mapPoint,event:e.event,eventDrawerStatus:e.eventDrawerStatus,stateful:e.stateful}},{updateConfig:Se,setDefaultConfig:$e,selectEvent:De,editEvent:je,updateNewEvent:Ne,refreshViewportData:function(){return function(e){e({type:ae.e})}},fetchEventVotes:xe})(Qe),et=n(74),tt=n.n(et),nt=n(38),at=n.n(nt),st=n(75),ot=n.n(st),it=n(177),rt=n.n(it),ct=n(178),lt=n.n(ct),pt=n(297),dt=n.n(pt),ut=n(298),ht=n.n(ut),vt=n(118),ft=(n(548),n(550),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={source:null},n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"_handleStateChange",value:function(e,t){if(t.playbackRate!==e.playbackRate){var n=Object.assign({},this.props.settings);n.videoSpeed=e.playbackRate,this.props.updateSettings(n)}isNaN(e.duration)||t.duration===e.duration?isNaN(e.duration)&&this.props.onPlayerError("Duration value is not a number"):this.props.onPlayerLoaded(this.refs.player),this.setState({player:e})}},{key:"_handleVideoSpeed",value:function(e){var t=Object.assign({},this.props.settings);t.videoSpeed=e?this.props.settings.videoSpeed<this.props.settings.maxVideoSpeed?2*this.props.settings.videoSpeed:this.props.settings.minVideoSpeed:this.props.settings.videoSpeed>this.props.settings.minVideoSpeed?this.props.settings.videoSpeed/2:this.props.settings.maxVideoSpeed,this.refs.player.playbackRate=t.videoSpeed,this.props.updateSettings(t)}},{key:"_handleFrameAdvance",value:function(e){var t=this.refs.player.getState().player;t.paused||this.refs.player.pause();var n=t.currentTime;e?this.refs.player.seek(n+.1):this.refs.player.seek(n-.1)}},{key:"_handlePause",value:function(){this.refs.player.getState().player.paused?this.refs.player.play():this.refs.player.pause()}},{key:"componentDidMount",value:function(){var e=this;this.refs.player.subscribeToStateChange(this._handleStateChange.bind(this)),this.props.event&&this.props.event.event_id&&this.setState({source:this.props.event.video_path},function(){e.refs.player.load(),e.refs.player.playbackRate=e.props.settings.videoSpeed})}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.event&&m.keys(this.props.event).length>0&&(m.isEqual(e.event,this.props.event)||e.event.event_id===this.props.event.event_id||this.setState({source:this.props.event.video_path},function(){t.refs.player.load(),t.refs.player.playbackRate=t.props.settings.videoSpeed}));var n=document.querySelector("#event-lat"),a=document.querySelector("#event-lon"),s=document.querySelector("#event-offset"),o=document.querySelector("#event-notes");m.isEqual(n,document.activeElement)||m.isEqual(a,document.activeElement)||m.isEqual(s,document.activeElement)||m.isEqual(o,document.activeElement)||this.props.hotkey&&!m.isEqual(e.hotkey,this.props.hotkey)&&m.keys(this.props.event).length>0&&("."===this.props.hotkey.key?this._handleVideoSpeed(!0):","===this.props.hotkey.key?this._handleVideoSpeed(!1):"ArrowLeft"===this.props.hotkey.key?this._handleFrameAdvance(!1):"ArrowRight"===this.props.hotkey.key?this._handleFrameAdvance(!0):" "===this.props.hotkey.key&&this._handlePause())}},{key:"render",value:function(){var e=this.props.event.video_offset_sec-this.props.settings.videoBuffer;return s.a.createElement("div",{className:"video"},s.a.createElement(vt.Player,{ref:"player",startTime:e,autoPlay:!0,loop:!0},s.a.createElement("source",{src:this.state.source}),s.a.createElement(vt.ControlBar,{autoHide:!1},s.a.createElement(vt.PlaybackRateMenuButton,{rates:[16,8,4,2,1,.5,.25,.125],order:7.1}))))}}]),t}(a.Component)),mt=Object(r.b)(function(e){return{settings:e.settings,event:e.event}},{updateSettings:ne})(ft),gt=n(114);n(552);var Et=n(180),_t=n.n(Et),yt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={open:!1,pending:!1,votes:null,userVote:null,event_lat:null,event_lon:null,mode:null,currEvent:null,video_path:null,voteOptions:[],eventStart:"",eventEnd:"",eventTime:"",playerRef:null,dialogOpen:!1},n.upvoteMenuRef=s.a.createRef(),n.downvoteMenuRef=s.a.createRef(),n._toggleDrawerOpen=n._toggleDrawerOpen.bind(Object(h.a)(Object(h.a)(n))),n._toggleDrawerClosed=n._toggleDrawerClosed.bind(Object(h.a)(Object(h.a)(n))),n._handleVote=n._handleVote.bind(Object(h.a)(Object(h.a)(n))),n._handleEventNotes=n._handleEventNotes.bind(Object(h.a)(Object(h.a)(n))),n._handleEventAltitude=n._handleEventAltitude.bind(Object(h.a)(Object(h.a)(n))),n._handleEventClose=n._handleEventClose.bind(Object(h.a)(Object(h.a)(n))),n._handleVoteOptions=n._handleVoteOptions.bind(Object(h.a)(Object(h.a)(n))),n._handlePlayerLoaded=n._handlePlayerLoaded.bind(Object(h.a)(Object(h.a)(n))),n._handlePlayerError=n._handlePlayerError.bind(Object(h.a)(Object(h.a)(n))),n._handleSetOffset=n._handleSetOffset.bind(Object(h.a)(Object(h.a)(n))),n._handleDialogOpen=n._handleDialogOpen.bind(Object(h.a)(Object(h.a)(n))),n._handleDialogClose=n._handleDialogClose.bind(Object(h.a)(Object(h.a)(n))),n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"_toggleDrawerOpen",value:function(){this.props.setEventDrawerStatus(!0),void 0!==this.props.event.video_path&&this.setState({open:!0,video_path:this.props.event.video_path})}},{key:"_toggleDrawerClosed",value:function(){var e=this;this.setState({open:!1,mode:null},function(){e.props.setEventDrawerStatus(!1)})}},{key:"_handleEventClose",value:function(){this.props.event.edited?this._handleDialogOpen():(this.props.closeEvent(),this._toggleDrawerClosed())}},{key:"_handleSubmitClick",value:function(){var e=this,t=m.cloneDeep(this.props.event);this.props.event.new?(delete t.event_id,delete t.product_id,delete t.dataset_id,this.setState({mode:null},function(){oe.postData("".concat(e.props.config.dataUrl,"/events"),oe.getEventObj(t)).then(function(t){Object(v.toast)(s.a.createElement(re,{title:"Event saved"}),{type:v.toast.TYPE.SUCCESS}),e.props.refreshEventDetails("".concat(e.props.config.dataUrl,"/events/").concat(t.event_id)),e.props.fetchEventVotes("".concat(e.props.config.dataUrl,"/votes/event/").concat(t.event_id))}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error adding event",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})})})):oe.putData("".concat(this.props.config.dataUrl,"/events/").concat(this.props.event.event_id),oe.getEventObj(t)).then(function(){Object(v.toast)(s.a.createElement(re,{title:"Event updated"}),{type:v.toast.TYPE.SUCCESS}),e.props.refreshEventDetails("".concat(e.props.config.dataUrl,"/events/").concat(e.props.event.event_id)),e.props.fetchEventVotes("".concat(e.props.config.dataUrl,"/votes/event/").concat(e.props.event.event_id))}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error updating event",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})})}},{key:"_handleResetClick",value:function(){this.props.event.new?this.props.resetNewEvent(this.props.event):this.props.resetEvent("".concat(this.props.config.dataUrl,"/events/").concat(this.props.event.event_id))}},{key:"_handleEventNotes",value:function(e,t){var n=m.cloneDeep(this.props.event);n.notes=t,this.props.editEvent(n)}},{key:"_handleEventAltitude",value:function(e,t){var n=m.cloneDeep(this.props.event);n.event_altitude=t,this.props.editEvent(n)}},{key:"_handleAddNewEventClicked",value:function(){var e=this;this.setState({votes:null,userVote:null,mode:"add",currEventId:this.props.event.event_id},function(){var t=m.cloneDeep(e.props.event);delete t.product_id,delete t.dataset_id,t.event_lat=parseFloat(e.props.newEvent._latlng.lat.toFixed(4)),t.event_lon=parseFloat(e.props.newEvent._latlng.lng.toFixed(4)),e.props.createNewEvent(t)})}},{key:"_handleCancelNewEventClicked",value:function(){var e=this;this.props.cancelNewEvent(this.props.event),this.setState({votes:this.props.eventVotes.results,userVote:m.find(this.props.eventVotes.results,{voter:this.props.voterData.voter.voter_name}),mode:null},function(){e.props.resetEvent("".concat(e.props.config.dataUrl,"/events/").concat(e.state.currEventId))})}},{key:"_handleVote",value:function(e){var t=this,n=null;this.state.userVote&&this.state.userVote.vote_id?!0===this.state.userVote.vote&&"up"===e||!1===this.state.userVote.vote&&"down"===e?oe.deleteData("".concat(this.props.config.dataUrl,"/votes/").concat(this.state.userVote.vote_id)).then(function(){Object(v.toast)(s.a.createElement(re,{title:"Vote removed"}),{type:v.toast.TYPE.SUCCESS}),t.props.fetchEventVotes("".concat(t.props.config.dataUrl,"/votes/event/").concat(t.props.event.event_id)),t.props.fetchUserVotes("".concat(t.props.config.dataUrl,"/votes/voter"))}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error deleting vote",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})}):((n=m.clone(this.state.userVote)).vote="up"===e,n.geo_confidence=m.includes(this.state.voteOptions,"geo_confidence"),n.off_camera=m.includes(this.state.voteOptions,"off_camera"),oe.putData("".concat(this.props.config.dataUrl,"/votes/").concat(this.state.userVote.vote_id),n).then(function(){Object(v.toast)(s.a.createElement(re,{title:"Vote updated"}),{type:v.toast.TYPE.SUCCESS}),t.props.fetchEventVotes("".concat(t.props.config.dataUrl,"/votes/event/").concat(t.props.event.event_id)),t.props.fetchUserVotes("".concat(t.props.config.dataUrl,"/votes/voter"))}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error updating vote",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})})):(n={event_id:this.props.event.event_id,vote:"up"===e,vote_time:E.a.utc().toISOString(),event_time:E.a.utc(this.props.event.event_time).toISOString(),geo_confidence:m.includes(this.state.voteOptions,"geo_confidence"),off_camera:m.includes(this.state.voteOptions,"off_camera")},oe.postData("".concat(this.props.config.dataUrl,"/votes"),n).then(function(){Object(v.toast)(s.a.createElement(re,{title:"Vote saved"}),{type:v.toast.TYPE.SUCCESS}),t.props.fetchEventVotes("".concat(t.props.config.dataUrl,"/votes/event/").concat(t.props.event.event_id)),t.props.fetchUserVotes("".concat(t.props.config.dataUrl,"/votes/voter"))}).catch(function(e){Object(v.toast)(s.a.createElement(re,{title:"Error adding vote",message:"".concat(e.response.status," ").concat(e.response.statusText)}),{type:v.toast.TYPE.ERROR})})),this.setState({userVote:n})}},{key:"_handleOpenErisEvent",value:function(){var e="".concat(this.props.config.erisUrl,"/?product_id=").concat(this.props.event.product_id.trim(),"&dataset_id=").concat(this.props.event.dataset_id,"&confidence=0&zoom=14&baselayer=fusion");window.open(e,"_blank")}},{key:"_handleOpenKmlEvent",value:function(){this.props.onKmlExport(this.props.event.event_id)}},{key:"_handleVoteOptions",value:function(e,t){m.remove(t,function(e){return"submit"===e}),this.setState({voteOptions:t})}},{key:"_handlePlayerLoaded",value:function(e){var t=e.getState().player,n=E.a.utc(this.props.event.event_time).subtract(this.props.event.video_offset_sec,"s"),a=E.a.utc(n.toISOString()).add(t.duration,"s");this.setState({eventStart:n.format("YYYY-MM-DD HH:mm:ss[Z]"),eventEnd:a.format("YYYY-MM-DD HH:mm:ss[Z]"),eventTime:E.a.utc(this.props.event.event_time).format("YYYY-MM-DD HH:mm:ss[Z]"),playerRef:e})}},{key:"_handlePlayerError",value:function(e){console.log(e);var t=E.a.utc(this.props.event.event_time).subtract(this.props.event.video_offset_sec,"s");this.setState({eventStart:t.format("YYYY-MM-DD HH:mm:ss[Z]"),eventEnd:"",eventTime:E.a.utc(this.props.event.event_time).format("YYYY-MM-DD HH:mm:ss[Z]"),playerRef:null})}},{key:"_handleSetOffset",value:function(){this.state.playerRef.pause();var e=this.state.playerRef.getState().player,t=m.cloneDeep(this.props.event);t.video_offset_sec=parseInt(e.currentTime,10),this.props.editEvent(t),Object(v.toast)(s.a.createElement(re,{title:"Offset Updated",message:"Video offset changed to ".concat(t.video_offset_sec," seconds. Click submit to accept this value.")}),{type:v.toast.TYPE.INFO})}},{key:"_handleDialogOpen",value:function(){this.setState({dialogOpen:!0})}},{key:"_handleDialogClose",value:function(e){var t=this;this.setState({dialogOpen:!1},function(){e&&(t.props.closeEvent(),t._toggleDrawerClosed())})}},{key:"componentDidMount",value:function(){this.props.event&&this.props.event.event_id&&(this.props.event.pending||this.props.event.open||this._toggleDrawerOpen())}},{key:"componentDidUpdate",value:function(e){var t=this;if(this.props.event&&m.keys(this.props.event).length>0){m.isEqual(e.event,this.props.event)||e.event.event_id===this.props.event.event_id||(this.props.event.close?this._toggleDrawerClosed():(this.props.event.pending||this.props.event.open||this._toggleDrawerOpen(),this.setState({userVote:null}))),!this.props.eventVotes||m.isEqual(e.eventVotes,this.props.eventVotes)||this.props.event.close||this.props.eventVotes.pending||this.setState({votes:this.props.eventVotes.results,userVote:m.find(this.props.eventVotes.results,{voter_name:this.props.voterData.voter.voter_name})},function(){if(t.state.userVote){var e=[];t.state.userVote.geo_confidence&&e.push("geo_confidence"),t.state.userVote.off_camera&&e.push("off_camera"),t.setState({voteOptions:e})}});var n=document.querySelector("#event-lat"),a=document.querySelector("#event-lon"),s=document.querySelector("#event-offset"),o=document.querySelector("#event-notes");m.isEqual(n,document.activeElement)||m.isEqual(a,document.activeElement)||m.isEqual(s,document.activeElement)||m.isEqual(o,document.activeElement)||this.props.hotkey&&!m.isEqual(e.hotkey,this.props.hotkey)&&m.keys(this.props.event).length>0&&("Escape"===this.props.hotkey.key?this._handleEventClose():"w"===this.props.hotkey.key?this._handleVote("up"):"s"===this.props.hotkey.key?this._handleVote("down"):"/"===this.props.hotkey.key&&this._handleSetOffset())}e.dragging!==this.props.dragging&&this.props.dragging&&this.state.playerRef&&this.state.playerRef.pause(),m.isEqual(e.newEvent,this.props.newEvent)||(this.props.newEvent?this._handleAddNewEventClicked():this._handleCancelNewEventClicked())}},{key:"render",value:function(){var e=this,t=this.state.video_path?m.last(this.state.video_path.split("/")):null,n=this.state.userVote&&!0===this.state.userVote.vote,a=this.state.userVote&&!1===this.state.userVote.vote,o=n?"#0097a7":"#fff",i=a?"#0097a7":"#fff",r=m.filter(this.state.votes,function(e){return e.vote}),c=m.filter(this.state.votes,function(e){return!e.vote}),l=n?"Undo Upvote":"Submit Upvote",p=a?"Undo Downvote":"Submit Downvote",d=[s.a.createElement(N.a,{label:"No",primary:!0,onClick:function(){e._handleDialogClose(!1)}}),s.a.createElement(N.a,{label:"Yes",primary:!0,onClick:function(){e._handleDialogClose(!0)}})],u=E.a.duration(this.props.event.video_offset_sec,"s"),h=E.a.utc(u.asMilliseconds()).format("mm:ss");return s.a.createElement("div",{className:"events"},s.a.createElement(ot.a,{mini:!0,className:"events__open-btn",onClick:this._toggleDrawerOpen,disabled:!this.props.event.selected},s.a.createElement(rt.a,null)),s.a.createElement(C.a,{open:this.state.open,openSecondary:!0,width:"33%"},s.a.createElement("div",{className:"events__drawer"},s.a.createElement("div",{className:"events__action-div"},s.a.createElement(ot.a,{mini:!0,secondary:!0,className:"events__close-btn",onClick:this._toggleDrawerClosed,title:"Close event drawer"},s.a.createElement(lt.a,null)),s.a.createElement(N.a,{primary:!0,label:"Open In Eris",className:"margin-top-md margin-bottom-md events__add-pt-btn",icon:s.a.createElement(_t.a,null),onClick:this._handleOpenErisEvent.bind(this),disabled:!this.props.event.selected}),s.a.createElement(N.a,{primary:!0,label:"Open as KML",className:"margin-top-md margin-bottom-md events__add-pt-btn",icon:s.a.createElement(_t.a,null),onClick:this._handleOpenKmlEvent.bind(this),disabled:!this.props.event.selected}),s.a.createElement(ot.a,{mini:!0,secondary:!0,className:"events__close-evt-btn",onClick:this._handleEventClose,disabled:!this.props.event.selected,title:"Close event data"},s.a.createElement(dt.a,null))),s.a.createElement("div",{className:"events__video_player"},s.a.createElement("h4",null,t),s.a.createElement(mt,{hotkey:this.props.hotkey,onPlayerLoaded:this._handlePlayerLoaded,onPlayerError:this._handlePlayerError})),s.a.createElement("div",{className:"events__event_header"},s.a.createElement("div",{className:"events__vote_controls"},s.a.createElement("div",null,r.length),s.a.createElement(x.a,{iconButtonElement:s.a.createElement(j.a,{disabled:"add"===this.state.mode,tooltip:"Upvote Event",tooltipPosition:"top-center"},s.a.createElement(he.a,{color:o})),onChange:this._handleVoteOptions,value:this.state.voteOptions,multiple:!0,clickCloseDelay:0,ref:this.upvoteMenuRef},s.a.createElement(P.a,{value:"geo_confidence",primaryText:"Low Confidence Geolocation",disabled:n}),s.a.createElement(P.a,{value:"off_camera",primaryText:"Off-Camera Event",disabled:n}),s.a.createElement(k.a,null),s.a.createElement(P.a,{value:"submit",primaryText:l,onClick:function(){e._handleVote("up"),e.upvoteMenuRef.current.close()}})),s.a.createElement(x.a,{iconButtonElement:s.a.createElement(j.a,{disabled:"add"===this.state.mode,tooltip:"Downvote Event",tooltipPosition:"top-center"},s.a.createElement(J.a,{color:i})),onChange:this._handleVoteOptions,value:this.state.voteOptions,multiple:!0,clickCloseDelay:0,ref:this.downvoteMenuRef},s.a.createElement(P.a,{value:"geo_confidence",primaryText:"Low Confidence Geolocation",disabled:a}),s.a.createElement(P.a,{value:"off_camera",primaryText:"Off-Camera Event",disabled:a}),s.a.createElement(k.a,null),s.a.createElement(P.a,{value:"submit",primaryText:p,onClick:function(){e._handleVote("down"),e.downvoteMenuRef.current.close()}})),s.a.createElement("div",null,c.length)),s.a.createElement("div",{className:"events__event_title"},s.a.createElement("h2",null,"Event: ",this.props.event.event_id),s.a.createElement("h4",null,"Product: ",this.props.event.product_id||"None",", Dataset: ",this.props.event.dataset_id||"None")),s.a.createElement(j.a,{tooltip:"Set Offset Seconds",tooltipPosition:"top-left"},s.a.createElement(ht.a,{onClick:function(){e._handleSetOffset()}}))),s.a.createElement("div",{className:"events__event_info"},this.props.event&&this.props.event.selected&&s.a.createElement(tt.a,null,s.a.createElement(et.CardText,null,s.a.createElement(at.a,{cols:3,spacing:3,cellHeight:"auto",className:"grid__list"},s.a.createElement(nt.GridTile,{cols:1},s.a.createElement(ee.a,{disabled:!0,id:"event-start",floatingLabelFixed:!0,floatingLabelText:"Video Start",value:this.state.eventStart})),s.a.createElement(nt.GridTile,{cols:1},s.a.createElement(ee.a,{disabled:!0,id:"event-time",floatingLabelFixed:!0,floatingLabelText:"Event Time",value:this.state.eventTime})),s.a.createElement(nt.GridTile,{cols:1},s.a.createElement(ee.a,{disabled:!0,id:"event-end",floatingLabelFixed:!0,floatingLabelText:"Video End",value:this.state.eventEnd}))),s.a.createElement(at.a,{cols:4,spacing:3,cellHeight:"auto",className:"grid__list"},s.a.createElement(nt.GridTile,{cols:1},s.a.createElement(ee.a,{id:"event-lat",floatingLabelFixed:!0,floatingLabelText:"Latitude",value:parseFloat(this.props.event.event_lat).toFixed(4),type:"number"})),s.a.createElement(nt.GridTile,{cols:1},s.a.createElement(ee.a,{id:"event-lon",floatingLabelFixed:!0,floatingLabelText:"Longitude",value:parseFloat(this.props.event.event_lon).toFixed(4),type:"number"})),s.a.createElement(nt.GridTile,{cols:1},s.a.createElement(ee.a,{id:"event-altitude",title:"".concat(this.props.event.event_altitude," meters"),floatingLabelFixed:!0,floatingLabelText:"Altitude (meters)",value:+this.props.event.event_altitude,onChange:this._handleEventAltitude,type:"number"})),s.a.createElement(nt.GridTile,{cols:1},s.a.createElement(ee.a,{disabled:!0,id:"event-offset",title:"".concat(this.props.event.video_offset_sec," seconds"),floatingLabelFixed:!0,floatingLabelText:"Video Offset",value:h})),s.a.createElement(nt.GridTile,{cols:4},s.a.createElement(ee.a,{id:"event-notes",floatingLabelFixed:!0,floatingLabelText:"Notes",fullWidth:!0,multiLine:!0,rows:3,rowsMax:3,onChange:this._handleEventNotes,value:this.props.event.notes||""})))),s.a.createElement(et.CardActions,{style:{textAlign:"right"}},s.a.createElement(N.a,{primary:!0,label:"Reset",className:"margin-top-sm margin-bottom-md",onClick:this._handleResetClick.bind(this),disabled:!this.props.event.edited}),s.a.createElement(N.a,{primary:!0,label:"Submit",className:"margin-top-sm margin-bottom-md",onClick:this._handleSubmitClick.bind(this),disabled:!this.props.event.edited})))))),s.a.createElement(S.a,{actions:d,modal:!1,open:this.state.dialogOpen},"Changes made to this event will be discarded. Do you want to continue?"))}}]),t}(a.Component),bt=Object(r.b)(function(e){return{defaultConfig:e.defaultConfig,config:e.config,settings:e.settings,data:e.data,mapPoint:e.mapPoint,event:e.event,eventDrawerStatus:e.eventDrawerStatus,eventVotes:e.eventVotes,userVotes:e.userVotes,voterData:e.voterData,stateful:e.stateful}},{clearCoordinates:Fe,setEventDrawerStatus:function(e){return function(t){t({type:gt.a,eventDrawerStatus:e})}},fetchData:ie,fetchUserVotes:Pe,fetchEventVotes:xe,resetEvent:Ve,putEventData:function(e,t){return function(n){return n(Te(t)),oe.putData(e,t).then(function(e){n(function(e){return{type:Ce.g,event:e}}(e))}).catch(function(e){n(ke(e))})}},editEvent:je,closeEvent:function(e){return function(t){t({type:Ce.a,event:e})}},refreshEventDetails:function(e){return function(t){return oe.fetchData(e).then(function(e){var n=m.cloneDeep(e);null===n.notes&&(n.notes=""),null===n.first_name&&(n.first_name=""),null===n.last_name&&(n.last_name=""),t({type:Ce.k,event:n})}).catch(function(e){t(ke(e))})}},createNewEvent:function(e){return function(t){var n=m.cloneDeep(e);n.event_id=oe.getNewEventId(),n.notes="",n.first_name="",n.last_name="",t({type:Ce.h,event:n})}},resetNewEvent:function(e){return function(t){var n=m.cloneDeep(e);n.event_lat="",n.event_lon="",n.notes="",n.first_name="",n.last_name="",t({type:Ce.j,event:n})}},updateNewEvent:Ne,cancelNewEvent:function(e){return function(t){var n=m.cloneDeep(e);t({type:Ce.i,event:n})}},updateSettings:ne})(yt),Ot=n(51);function St(e){return{type:Ot.b,voterData:e}}function wt(e){return{type:Ot.c,voterData:e}}function Ct(e){return{type:Ot.a,voterDataError:e}}n(554),n(556),n(558),n(560);var Tt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={viewport:null,bounds:null,hotkey:null,hoverEvent:null,error:null,newEvent:null,dragging:null,kmlEvent:null},n._handleViewport=n._handleViewport.bind(Object(h.a)(Object(h.a)(n))),n._handleBounds=n._handleBounds.bind(Object(h.a)(Object(h.a)(n))),n._handleHotkey=n._handleHotkey.bind(Object(h.a)(Object(h.a)(n))),n._handleEventHover=n._handleEventHover.bind(Object(h.a)(Object(h.a)(n))),n._handleNewEvent=n._handleNewEvent.bind(Object(h.a)(Object(h.a)(n))),n._handleDrag=n._handleDrag.bind(Object(h.a)(Object(h.a)(n))),n._handleKml=n._handleKml.bind(Object(h.a)(Object(h.a)(n))),n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"_handleViewport",value:function(e){var t=this;this.setState({viewport:e},function(){var n=m.clone(t.props.config);n.viewport=e,t.props.updateConfig(n)})}},{key:"_handleBounds",value:function(e){this.setState({bounds:e})}},{key:"_handleHotkey",value:function(e){this.setState({hotkey:e})}},{key:"_handleEventHover",value:function(e){this.setState({hoverEvent:e})}},{key:"_handleNewEvent",value:function(e){this.setState({newEvent:e})}},{key:"_handleDrag",value:function(e){this.setState({dragging:e})}},{key:"_handleKml",value:function(e){this.setState({kmlEvent:e})}},{key:"componentDidMount",value:function(){this.props.fetchVoterData("".concat(this.props.config.dataUrl,"/voters/voter"))}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.voterData&&!m.isEqual(e.voterData,this.props.voterData)&&(!this.props.voterData.error||this.props.voterData.pending||this.state.error||this.setState({error:this.props.voterData.error.message},function(){Object(v.toast)(s.a.createElement(re,{title:"Error retrieving voter",message:t.state.error}),{type:v.toast.TYPE.ERROR})}),this.state.error||this.props.voterData.voter||this.props.voterData.pending||this.props.postVoterData("".concat(this.props.config.dataUrl,"/voters")))}},{key:"render",value:function(){var e={prevEvent:this._handleHotkey,nextEvent:this._handleHotkey,playPauseVideo:this._handleHotkey,videoSpeedIncrease:this._handleHotkey,videoSpeedDecrease:this._handleHotkey,closeEvent:this._handleHotkey,voteUp:this._handleHotkey,voteDown:this._handleHotkey,filter:this._handleHotkey,forwardFrame:this._handleHotkey,backwardFrame:this._handleHotkey,setOffset:this._handleHotkey};return s.a.createElement("div",{className:"App"},s.a.createElement(f.HotKeys,{keyMap:{prevEvent:"a",nextEvent:"d",playPauseVideo:"space",videoSpeedIncrease:".",videoSpeedDecrease:",",closeEvent:"esc",voteUp:"w",voteDown:"s",filter:"f",forwardFrame:"right",backwardFrame:"left",setOffset:"/"},handlers:e},s.a.createElement(He,{viewport:this.state.viewport,bounds:this.state.bounds,hotkey:this.state.hotkey,onEventHover:this._handleEventHover}),s.a.createElement(bt,{hotkey:this.state.hotkey,newEvent:this.state.newEvent,dragging:this.state.dragging,onKmlExport:this._handleKml}),s.a.createElement(Xe,{onViewportChange:this._handleViewport,onBoundsChange:this._handleBounds,onNewEvent:this._handleNewEvent,hoverEvent:this.state.hoverEvent,onDrag:this._handleDrag,kmlEvent:this.state.kmlEvent})))}}]),t}(a.Component),kt=Object(r.b)(function(e){return{config:e.config,voterData:e.voterData}},{fetchVoterData:function(e){return function(t){return t(St({})),oe.fetchData(e).then(function(e){t(wt({voter:e.length>0?e[0]:null}))}).catch(function(e){t(Ct(e))})}},postVoterData:function(e,t){return function(n){return n(St(t)),oe.postData(e,t).then(function(e){n(wt({voter:e}))}).catch(function(e){n(Ct(e))})}},updateConfig:Se})(Tt),Dt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function jt(){if("serviceWorker"in navigator){if(new URL("/demos/eris-truth",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/demos/eris-truth","/service-worker.js");Dt?(!function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Vt(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Vt(e)})}}function Vt(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var Nt=n(119),Rt=null,xt={setStore:function(e){Rt=e},getStore:function(){return Rt}},Ut=n(181),Pt=n.n(Ut),Bt=n(115);function Ft(e){return{type:Bt.a,status:e}}var It=new XMLHttpRequest,Lt={},Ht=null;It.onreadystatechange=function(){if(4===It.readyState&&200===It.status){Ht=Pt()(),xt.setStore(Ht),Lt=JSON.parse(It.responseText);var e=localStorage.getItem("eris-truth.configuration");if(e){var t=JSON.parse(e);t.version&&t.version>=Lt.version?(Ht.dispatch(Se(t)),Ht.dispatch(ne(t.settings))):(console.log("Stored version was ".concat(t.version," - upgrading to ").concat(Lt.version)),Ht.dispatch(Se(Lt)),Ht.dispatch(we(Lt)),Ht.dispatch(ne(Lt.settings)))}else Ht.dispatch(Se(Lt)),Ht.dispatch(we(Lt)),Ht.dispatch(ne(Lt.settings));Ht.dispatch($e(Lt));var n=function(){i.a.render(s.a.createElement(r.a,{store:Ht},s.a.createElement(Nt.MuiThemeProvider,{muiTheme:Object(Nt.getMuiTheme)(Nt.darkBaseTheme)},s.a.createElement(kt,null))),document.getElementById("root")),jt()},a=function(){for(var e=window.location.search.substring(1).split("&"),t=0;t<e.length;t++){var n=e[t].split("=");if("id"===decodeURIComponent(n[0]))return decodeURIComponent(n[1])}}();a?be.getState("".concat(Lt.stateful,"/states/state/").concat(a)).then(function(e){var t={};try{(t=JSON.parse(e.user_state)).stateful.id=a,Ht=Pt()(t),xt.setStore(Ht),n()}catch(s){Ht.dispatch(Ft({value:!0,error:s.message,id:a})),n()}}).catch(function(e){Ht.dispatch(Ft({value:!1,error:e.message,id:a})),n()}):Lt.stateful?be.getVersion("".concat(Lt.stateful,"/version")).then(function(){Ht.dispatch(Ft({value:!0,error:null,id:null})),n()}).catch(function(e){Ht.dispatch(Ft({value:!1,error:e.message,id:null})),n()}):n()}},It.open("GET","".concat("/demos/eris-truth","/app-config.json"),!0),It.send()},565:function(e,t,n){"use strict";n.r(t);var a=n(50),s=n(299),o=n(113);var i=n(77);var r=n(76);var c=n(41);var l=n(51);var p=n(115);var d=n(96);var u=n(21);var h=n(114);var v=n(56);var f=n(57);var m=Object(a.combineReducers)({defaultConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o.a:return t.defaultConfig;default:return e}},config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i.b:return Object.assign({},e,t.config);case i.a:var n=JSON.stringify(t.config);return localStorage.setItem("eris-truth.configuration",n),t.config;default:return e}},settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case r.b:return Object.assign({},e,t.settings);case r.a:return Object.assign({},e,t.defaultConfig.settings);default:return e}},data:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case c.c:return Object.assign({},t.data,{pending:!0});case c.d:return Object.assign({},t.data,{pending:!1});case c.b:return Object.assign({},{pending:!1,error:t.error});case c.e:return Object.assign({},t.data,{refresh:!0});case c.a:return Object.assign({},{clear:!0});default:return e}},voterData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.b:return Object.assign({},t.voterData,{pending:!0});case l.c:return Object.assign({},t.voterData,{pending:!1});case l.a:return Object.assign({},{pending:!1,error:t.voterDataError});case l.d:return Object.assign({},t.voterData,{pending:!1});default:return e}},mapPoint:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.b:return Object.assign({},t.event,{clear:!1});default:return e}},event:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u.d:return Object.assign({},t.event,{selected:!0,edited:!1,pending:!1,new:!1});case u.b:return Object.assign({},t.event,{selected:!0,edited:!0,pending:!1,new:!1});case u.l:return Object.assign({},t.event,{selected:!0,edited:!1,pending:!1,new:!1,reset:!0});case u.a:return Object.assign({},t,{close:!0});case u.k:return Object.assign({},t.event,{selected:!0,edited:!1,pending:!1,new:!1,refresh:!0});case u.h:return Object.assign({},t.event,{new:!0,selected:!0,edited:!1,pending:!1});case u.c:return Object.assign({},t.event,{new:!0,selected:!0,edited:!0,pending:!1,reset:!1});case u.j:return Object.assign({},t.event,{new:!0,selected:!0,reset:!0,edited:!0,pending:!1});case u.i:return Object.assign({},t.event,{new:!0,cancel:!0,selected:!0,reset:!1,edited:!1,pending:!1});case u.g:return Object.assign({},t.event,{selected:!0,edited:!1,pending:!1,new:!1});case u.f:return Object.assign(t.event,{pending:!0});case u.e:return Object.assign({},{pending:!1,error:t.eventError});default:return e}},eventDrawerStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.a:return t.eventDrawerStatus;default:return e}},eventVotes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v.b:return Object.assign({},t.eventVotes,{pending:!0});case v.c:return Object.assign({},t.eventVotes,{pending:!1});case v.a:return Object.assign({},{error:t.eventVotesError,pending:!1});default:return e}},userVotes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f.b:return Object.assign({},t.userVotes,{pending:!0});case f.c:return Object.assign({},t.userVotes,{pending:!1});case f.a:return Object.assign({},{pending:!1,error:t.userVotesError});default:return e}},stateful:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p.a:return Object.assign({},e,t.status);default:return e}}});function g(e){var t=[s.a];return Object(a.createStore)(m,e,Object(a.compose)(a.applyMiddleware.apply(void 0,t)))}n.d(t,"default",function(){return g})},57:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return o});var a="USER_VOTES__FETCH_PENDING",s="USER_VOTES__FETCH_SUCCESS",o="USER_VOTES__FETCH_ERROR"},76:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return s});var a="SETTINGS__UPDATE_SETTINGS",s="SETTINGS__RESET_SETTINGS"},77:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return s});var a="CONFIG__UPDATE_CONFIG",s="CONFIG__SAVE_CONFIG"},96:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return s});var a="MAP__FLY_TO_EVENT",s="MAP__CLEAR_EVENTS"}},[[301,2,1]]]);
//# sourceMappingURL=main.17b1494a.chunk.js.map