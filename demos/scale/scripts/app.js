(function () {
    'use strict';

    var app = angular.module('scaleApp', [
        'scaleConfigModule',
        'ngResource',
        'ngSanitize',
        'ngRoute',
        'emguo.poller',
        'ui.bootstrap',
        'ui.grid',
        'ui.grid.selection',
        'ui.grid.pagination',
        'ui.grid.resizeColumns',
        'ui.sortable',
        'cfp.hotkeys',
        'toggle-switch',
        'uiSwitch'
    ]);

    app.config(['$routeProvider', '$resourceProvider', '$provide', 'pollerConfig', function($routeProvider, $resourceProvider, $provide, pollerConfig) {
        // Fix sourcemaps
        // @url https://github.com/angular/angular.js/issues/5217#issuecomment-50993513
        $provide.decorator('$exceptionHandler', ['$delegate', function ($delegate) {
            return function (exception, cause) {
                $delegate(exception, cause);
                setTimeout(function() {
                    throw exception;
                });
            };
        }]);

        // stop pollers when route changes
        pollerConfig.stopOn = '$routeChangeStart';
        pollerConfig.smart = true;

        // preserve trailing slashes
        $resourceProvider.defaults.stripTrailingSlashes = false;

        //routing
        $routeProvider
            .when('/', {
                controller: 'ovController',
                controllerAs: 'vm',
                templateUrl: 'modules/overview/partials/ovTemplate.html'
            })
            .when('/admin/login',{
                controller: 'adminLoginController',
                templateUrl: 'modules/admin/partials/adminLoginTemplate.html'
            })
            .when('/admin/logout',{
                controller: 'logoutController',
                templateUrl: 'modules/admin/partials/adminLoginTemplate.html'
            })
            .when('/about', {
                controller: 'aboutController',
                controllerAs: 'vm',
                templateUrl: 'modules/about/partials/aboutTemplate.html'
            })
            .when('/feed', {
                controller: 'feedDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/feedDetailsTemplate.html',
                reloadOnSearch: false
            })
            .when('/feed/ingests', {
                controller: 'ingestRecordsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/ingestRecordsTemplate.html',
                reloadOnSearch: false
            })
            .when('/feed/ingests/:id', {
                controller: 'ingestRecordDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/ingestRecordDetailsTemplate.html'
            })
            .when('/metrics', {
                controller: 'metricsController',
                controllerAs: 'vm',
                templateUrl: 'modules/metrics/partials/metricsTemplate.html',
                reloadOnSearch: false
            })
            .when('/nodes', {
                controller: 'nodesController',
                controllerAs: 'vm',
                templateUrl: 'modules/nodes/partials/nodesTemplate.html',
                reloadOnSearch: false
            })
            .when('/nodes/:id', {
                controller: 'nodeDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/nodes/partials/nodeDetailsTemplate.html'
            })
            .when('/load/queued', {
                controller: 'loadController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/loadTemplate.html'
            })
            .when('/load/running', {
                controller: 'queueRunningController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/queueRunningTemplate.html'
            })
            .when('/load/depth', {
                controller: 'loadDepthController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/loadDepthTemplate.html'
            })
            .when('/recipes', {
                controller: 'recipesController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipesTemplate.html',
                reloadOnSearch: false
            })
            .when('/recipes/recipe/:id', {
                controller: 'recipeDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipeDetailsTemplate.html'
            })
            .when('/recipes/types/:id?', {
                controller: 'recipeTypesController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipeTypesTemplate.html'
            })
            .when('/jobs', {
                controller: 'jobsController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobsTemplate.html',
                reloadOnSearch: false
            })
            .when('/jobs/job/:id', {
                controller: 'jobDetailController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobDetailTemplate.html'
            })
            .when('/jobs/types/:id?', {
                controller: 'jobTypesController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobTypesTemplate.html',
                reloadOnSearch: false
            })
            .when('/jobs/failure-rates', {
                controller: 'jobTypesFailureRatesController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobTypesFailureRatesTemplate.html',
                reloadOnSearch: false
            })
            .when('/jobs/executions', {
                controller: 'jobExecutionsController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobExecutionsTemplate.html'
            })
            .when('/jobs/executions/:id', {
                controller: 'jobExecutionDetailController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobExecutionDetailTemplate.html'
            })
            .when('/workspaces/:id?', {
                controller: 'workspacesController',
                controllerAs: 'vm',
                templateUrl: 'modules/workspaces/partials/workspacesTemplate.html'
            })
            .when('/feed/strikes/:id?', {
                controller: 'strikesController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/strikesTemplate.html'
            })
            .when('/feed/scans/', {
                controller: 'scansController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/scansTemplate.html'
            })
            .when('/feed/scans/:id', {
                controller: 'scanDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/scanDetailsTemplate.html'
            })
            .when('/batch', {
                controller: 'batchesController',
                controllerAs: 'vm',
                templateUrl: 'modules/batch/partials/batchesTemplate.html'
            })
            .when('/batch/:id', {
                controller: 'batchDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/batch/partials/batchDetailsTemplate.html'
            })
            .otherwise({
                redirectTo: '/'
            });
    }])
    .value('moment', window.moment)
    .value('localStorage', window.localStorage)
    .value('XMLHttpRequest', window.XMLHttpRequest)
    .value('toastr', window.toastr);
})();

(function () {
    'use strict';

    angular.module('scaleConfigModule', []).provider('scaleConfig', function () {
        var scaleConfig = {},
            scaleConfigLocal = {};

        this.$get = function () {
            var config = $.ajax({
                type: 'GET',
                url: 'config/scaleConfig.json',
                cache: false,
                async: false,
                contentType: 'application/json',
                dataType: 'json'
            });
            
            if (config.status === 200) {
                scaleConfig = config.responseJSON.scaleConfig;

                var configLocal = $.ajax({
                    type: 'GET',
                    url: 'config/scaleConfig.local.json',
                    cache: false,
                    async: false,
                    contentType: 'application/json',
                    dataType: 'json'
                });

                if (configLocal.status === 200) {
                    scaleConfigLocal = configLocal.responseJSON.scaleConfigLocal;
                }

                _.merge(scaleConfig, scaleConfigLocal);

                // add function for getApiPrefix
                scaleConfig.getUrlPrefix = function(serviceName){
                    return scaleConfig.urls.overrides && scaleConfig.urls.overrides[serviceName] ? scaleConfig.urls.overrides[serviceName] : scaleConfig.urls.apiPrefix;
                }
            }

            return scaleConfig;
        }


    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisHeaderController', ['$scope', 'subnavService', function ($scope, subnavService) {
        var vm = this;
        vm.currentPath = subnavService.getCurrentPath();
        vm.loadingClass = $scope.showSubnav ? 'loading-content-subnav' : 'loading-content';
    }])
    .directive('aisHeader', function () {
        /**
         * Usage: <ais-header name={name}></ais-header>
         */
        return {
            controller: 'aisHeaderController',
            controllerAs: 'vm',
            restrict: 'E',
            templateUrl: 'modules/header/headerTemplate.html',
            scope: {
                name: '=',
                hideTitle: '=',
                loading: '=', // optional - will overlay a loading spinner on the page based on the passed-in value
                showSubnav: '=',
                subnavLinks: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('scaleNavigation', function () {
        return {
            restrict: 'E',
            templateUrl: 'modules/navigation/partials/navTemplate.html',
            controller: 'navController',
            controllerAs: 'vm'
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aboutController', ['$scope', '$location', 'navService', 'stateService', function($scope, $location, navService, stateService) {
        var vm = this;
        
        vm.stateService = stateService;
        vm.version = '';

        var initialize = function() {
            navService.updateLocation('about');
        };

        initialize();

        $scope.$watch('vm.stateService.getVersion()', function (newValue) {
            vm.version = newValue;
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('adminLoginController', ['$timeout', '$location', 'stateService', 'userService', function ($timeout, $location, stateService, userService) {

        var initialize = function () {
            var user = userService.getUserCreds();
            
            if (!user) {
                userService.login('admin');
            }

            $timeout(function () {
                // Any code in here will automatically have an $scope.apply() run afterwards
                $location.path('/');
            });
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('logoutController', ['$timeout', '$rootScope', '$location', 'userService', function ($timeout, $rootScope, $location, userService) {

        var initialize = function () {
            userService.logout();
            $timeout(function(){
                // Any code in here will automatically have an $scope.apply() run afterwards
                $location.path("/");
            });
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('batchDetailsController', ['$scope', '$routeParams', '$location', 'scaleConfig', 'navService', 'userService', 'batchService', 'recipeService', 'jobTypeService', 'Batch', 'toastr', 'moment', function ($scope, $routeParams, $location, scaleConfig, navService, userService, batchService, recipeService, jobTypeService, Batch, toastr, moment) {
        var vm = this;

        vm.scaleConfig = scaleConfig;
        vm.moment = moment;
        vm.loading = true;
        vm.mode = $routeParams.id > 0 ? 'details' : 'create';
        vm.readonly = true;
        vm.saveBtnClass = 'btn-default';
        vm.batch = $routeParams.id > 0 ? {} : new Batch();
        vm.recipeTypes = [];
        vm.selectedRecipeType = {};
        vm.jobTypes = [];
        vm.selectedJobTypes = [];
        vm.startTime = {
            hour: null,
            minute: null,
            second: null
        };
        vm.endTime = {
            hour: null,
            minute: null,
            second: null
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.dateRangeStartedPopup = {
            opened: false
        };
        vm.openDateRangeStartedPopup = function ($event) {
            $event.stopPropagation();
            vm.dateRangeStartedPopup.opened = true;
        };
        vm.dateRangeEndedPopup = {
            opened: false
        };
        vm.openDateRangeEndedPopup = function ($event) {
            $event.stopPropagation();
            vm.dateRangeEndedPopup.opened = true;
        };

        vm.cancelCreate = function () {
            vm.mode = 'view';
            if ($routeParams.id === '0') {
                $location.path('/batch');
            }
        };

        vm.disableSaveBtn = function (invalid) {
            var returnVal = !(!invalid);
            vm.saveBtnClass = returnVal ? 'btn-default' : 'btn-success';
            return returnVal;
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.getDateRange = function () {
            return moment.utc(vm.batch.definition.date_range.started).format(scaleConfig.dateFormats.day_second_utc) + ' &ndash; ' +  moment.utc(vm.batch.definition.date_range.ended).format(scaleConfig.dateFormats.day_second_utc);
        };

        vm.setTime = function (type) {
            if (type === 'started') {
                vm.startTime = {
                    hour: ('0' + moment.utc(vm.batch.definition.date_range[type]).hour()).slice(-2),
                    minute: ('0' + moment.utc(vm.batch.definition.date_range[type]).minute()).slice(-2),
                    second: ('0' + moment.utc(vm.batch.definition.date_range[type]).second()).slice(-2)
                };
            } else {
                vm.endTime = {
                    hour: ('0' + moment.utc(vm.batch.definition.date_range[type]).hour()).slice(-2),
                    minute: ('0' + moment.utc(vm.batch.definition.date_range[type]).minute()).slice(-2),
                    second: ('0' + moment.utc(vm.batch.definition.date_range[type]).second()).slice(-2)
                };
            }
        };

        vm.changeTime = function (type, unit) {
            if (vm.batch.definition.date_range) {
                if (vm[type][unit].length > 2) {
                    vm[type][unit] = ('0' + vm[type].hour).slice(-2);
                }
                if (!isNaN(vm[type][unit])) {
                    if (vm[type].hour > 23 || vm[type].hour < 0) {
                        vm[type].hour = vm[type].hour > 23 ? 23 : 0;
                    }
                    if (vm[type].minute > 59 || vm[type].minute < 0) {
                        vm[type].minute = vm[type].minute > 59 ? 59 : 0;
                    }
                    if (vm[type].second > 59 || vm[type].second < 0) {
                        vm[type].second = vm[type].second > 59 ? 59 : 0;
                    }
                    var timeSet = type === 'startTime' ? moment.utc(vm.batch.definition.date_range.started.toISOString()) : moment.utc(vm.batch.definition.date_range.ended.toISOString());
                    timeSet.set({
                        'hour': ('0' + vm[type].hour).slice(-2),
                        'minute': ('0' + vm[type].minute).slice(-2),
                        'second': ('0' + vm[type].second).slice(-2)
                    });
                    if (type === 'startTime') {
                        vm.batch.definition.date_range.started = timeSet.toDate();
                        console.log('start time: ' + vm.batch.definition.date_range.started.toISOString());
                    } else if (type === 'endTime') {
                        vm.batch.definition.date_range.ended = timeSet.toDate();
                        console.log('end time: ' + vm.batch.definition.date_range.ended.toISOString());
                    }
                }
            }
        };

        vm.keydown = function ($event, unit, type) {
            var max = 0;
            if (unit === 'hour') {
                max = 23;
            } else if (unit === 'minute' || unit === 'second') {
                max = 60;
            }
            if ($event.keyCode === 38) {
                // up arrow
                if (isNaN(vm[type][unit])) {
                    vm[type][unit] = ('0' + 0).slice(-2);
                }
                vm[type][unit] < max ? vm[type][unit]++ : vm[type][unit];
                vm[type][unit] = ('0' + vm[type][unit]).slice(-2);
                vm.changeTime(type, unit);
            } else if ($event.keyCode === 40) {
                // down arrow
                if (isNaN(vm[type][unit])) {
                    vm[type][unit] = ('0' + 0).slice(-2);
                }
                vm[type][unit] > 0 ? vm[type][unit]-- : vm[type][unit];
                vm[type][unit] = ('0' + vm[type][unit]).slice(-2);
                vm.changeTime(type, unit);
            }
        };

        vm.validateBatch = function () {
            vm.loading = true;
            batchService.validateBatch(vm.batch).then(function (data) {
                if (data.warnings && data.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(data.warnings);
                    toastr['error'](warningsHtml);
                } else {
                    toastr['success']('Batch is valid.');
                }
            }).catch(function (error) {
                if (error && error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error']('Error validating batch');
                }
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.saveBatch = function () {
            vm.loading = true;
            batchService.saveBatch(vm.batch).then(function (data) {
                toastr['success']('Batch successfully created.');
            }).catch(function (error) {
                if (error && error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error']('Error creating batch');
                }
            }).finally(function () {
                vm.loading = false;
                $location.path('/batch');
            })
        };

        var getRecipeTypes = function () {
            return recipeService.getRecipeTypes().then(function (data) {
                vm.recipeTypes = data.results;
            }).catch(function (e) {
                console.log('Error retrieving recipe types: ' + e);
            });
        };

        var getBatch = function () {
            batchService.getBatchById($routeParams.id).then(function (data) {
                vm.loading = false;
                vm.batch = Batch.transformer(data);
            });
        };

        var initialize = function () {
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            navService.updateLocation('batch');

            if (vm.mode === 'create') {
                getRecipeTypes()
                    .then(function () {
                        vm.loading = false;
                    });
            } else if (vm.mode === 'details') {
                getBatch();
            }
        };

        initialize();

        $scope.$watchCollection('vm.batch.recipe_type', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            if (newValue) {
                vm.jobTypes = [];
                var recipeJobs = _.map(newValue.definition.jobs, 'job_type.name');
                _.forEach(recipeJobs, function (job) {
                    vm.jobTypes.push({
                        label: job,
                        title: job,
                        value: job
                    });
                });
            } else {
                vm.jobTypes = [];
            }
        });

        $scope.$watch('vm.batch.definition.date_range.started', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            if (!newValue) {
                vm.startTime = {
                    hour: null,
                    minute: null,
                    second: null
                };
            }
        });

        $scope.$watch('vm.batch.definition.date_range.ended', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            if (!newValue) {
                vm.endTime = {
                    hour: null,
                    minute: null,
                    second: null
                };
            }
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('batchesController', ['$scope', '$location', 'scaleConfig', 'gridFactory', 'subnavService', 'userService', 'recipeService', 'navService', 'stateService', 'batchService', 'Batch', 'moment', 'poller', function ($scope, $location, scaleConfig, gridFactory, subnavService, userService, recipeService, navService, stateService, batchService, Batch, moment, poller) {
        subnavService.setCurrentPath('batch');

        var vm = this,
            recipeTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.batchesParams = stateService.getBatchesParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.readonly = true;
        vm.recipeTypeValues = [recipeTypeViewAll];
        vm.selectedRecipeType = vm.batchesParams.recipe_type_id ? vm.batchesParams.recipe_type_id : recipeTypeViewAll;
        vm.batchStatusValues = scaleConfig.batchStatus;
        vm.selectedBatchStatus = vm.batchesParams.status || vm.batchStatusValues[0];
        vm.lastModifiedStart = moment.utc(vm.batchesParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.batchesParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.batchesParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.batchesParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByBatchStatus = vm.batchesParams.status ? true : false,
            filteredByRecipeType = vm.batchesParams.recipe_type_id ? true : false,
            filteredByOrder = vm.batchesParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'title',
                enableFiltering: false,
                displayName: 'Title'
            },
            {
                field: 'recipe_type',
                displayName: 'Recipe Type',
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.recipe_type.title }} {{ row.entity.recipe_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedRecipeType" ng-options="recipeType as (recipeType.title + \' \' + recipeType.version) for recipeType in grid.appScope.vm.recipeTypeValues"></select></div>'
            },
            {
                field: 'status',
                displayName: 'Status',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedBatchStatus"><option ng-selected="{{ grid.appScope.vm.batchStatusValues[$index] == grid.appScope.vm.selectedBatchStatus }}" value="{{ grid.appScope.vm.batchStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.batchStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'created_count',
                enableFiltering: false,
                displayName: 'Job Creation Rate',
                cellTemplate: 'completedRate.html'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            }
        ];

        vm.getBatches = function () {
            batchService.getBatches(vm.batchesParams).then(function (data) {
                vm.loading = false;
                vm.gridOptions.totalItems = data.count ? data.count : 0;
                vm.gridOptions.minRowsToShow = data.results ? data.results.length : 0;
                vm.gridOptions.virtualizationThreshold = data.results ? data.results.length : 0;
                vm.gridOptions.data = data.results ? Batch.transformer(data.results) : [];
            }).catch(function (e) {
                console.log('Error retrieving batches: ' + e);
                vm.loading = false;
            });
        };

        vm.getRecipeTypes = function () {
            return recipeService.getRecipeTypes().then(function (data) {
                vm.recipeTypeValues.push(data.results);
                vm.recipeTypeValues = _.flatten(vm.recipeTypeValues);
                vm.selectedRecipeType = _.find(vm.recipeTypeValues, { id: vm.batchesParams.recipe_type_id }) || recipeTypeViewAll;
            }).catch(function (e) {
                console.log('Error retrieving recipe types: ' + e);
            });
        };

        vm.filterResults = function () {
            poller.stopAll();
            stateService.setBatchesParams(vm.batchesParams);
            vm.loading = true;
            vm.getBatches();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.batchesParams);
        };

        vm.updateBatchOrder = function (sortArr) {
            vm.batchesParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateRecipeType = function (value) {
            if (value.id !== vm.batchesParams.recipe_type_id) {
                vm.batchesParams.page = 1;
            }
            vm.batchesParams.recipe_type_id = value.id === 0 ? null : value.id;
            vm.batchesParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateBatchStatus = function (value) {
            if (value != vm.batchesParams.status) {
                vm.batchesParams.page = 1;
            }
            vm.batchesParams.status = value === 'VIEW ALL' ? null : value;
            vm.batchesParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.completedRateStyle = function (created, total) {
            var percentage = ((created / total) * 100).toFixed(0);
            return percentage > 0 ? 'width: ' + percentage + '%' : 'display: none';
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                $location.path('/batch/' + row.entity.id).search('');
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.batchesParams.page = currentPage;
                vm.batchesParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setBatchesColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateBatchOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setBatchesParams(vm.batchesParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            vm.getRecipeTypes()
                .then(vm.getBatches);
            navService.updateLocation('batch');
        };

        vm.initialize();

        $scope.$watch('vm.selectedRecipeType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.recipeTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByRecipeType) {
                        vm.updateRecipeType(value);
                    }
                } else {
                    filteredByRecipeType = !angular.equals(value, recipeTypeViewAll);
                    vm.updateRecipeType(value);
                }
            }
        });

        $scope.$watch('vm.selectedBatchStatus', function (value) {
            if (vm.loading) {
                if (filteredByBatchStatus) {
                    vm.updateBatchStatus(value);
                }
            } else {
                filteredByBatchStatus = value !== 'VIEW ALL';
                vm.updateBatchStatus(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.batchesParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.batchesParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getBatchesColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getBatchesParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.batchesParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Batch', ['scaleConfig', 'JobType', 'RecipeType', function (scaleConfig, JobType, RecipeType) {
        var Batch = function (id, title, description, status, recipe_type, event, creator_job, definition, created_count, failed_count, total_count, created, last_modified) {
            this.id = id || null;
            this.title = title || null;
            this.description = description || null;
            this.status = status || null;
            this.recipe_type = recipe_type ? RecipeType.transformer(recipe_type) : null;
            this.event = event || null;
            this.creator_job = creator_job ? {
                id: creator_job.id || null,
                job_type: creator_job.job_type ? JobType.transformer(creator_job.job_type) : null,
                job_type_rev: creator_job.job_type_rev || null,
                event: creator_job.event || null,
                status: creator_job.status || null,
                priority: creator_job.priority || null,
                num_exes: creator_job.num_exes || null
            } : {};
            this.definition = definition ? {
                version: scaleConfig.batchDefinitionVersion,
                date_range: definition.date_range || null,
                job_names: definition.job_names || null,
                all_jobs: definition.all_jobs || null,
                priority: definition.priority || null
            } : { version: scaleConfig.batchDefinitionVersion };
            this.created_count = created_count || 0;
            this.failed_count = failed_count || 0;
            this.total_count = total_count || 0;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc);
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc);
        };

        Batch.prototype = {
            clean: function () {
                var returnObj = {
                    recipe_type_id: this.recipe_type ? this.recipe_type.id : null,
                    title: this.title,
                    description: this.description,
                    definition: this.definition
                };
                // remove empty/null/undefined values from returnObj
                return _.pick(returnObj, _.identity);
            }
        };

        // static methods, assigned to class
        Batch.build = function (data) {
            if (data) {
                var returnObj = new Batch(
                    data.id,
                    data.title,
                    data.description,
                    data.status,
                    data.recipe_type,
                    data.event,
                    data.creator_job,
                    data.definition,
                    data.created_count,
                    data.failed_count,
                    data.total_count,
                    data.created,
                    data.last_modified
                );
                // remove empty/null/undefined values from returnObj
                returnObj = _.pick(returnObj, _.identity);
                // restore 0 counts if necessary
                returnObj.created_count = typeof returnObj.created_count === 'undefined' ? 0 : returnObj.created_count;
                returnObj.failed_count = typeof returnObj.failed_count === 'undefined' ? 0 : returnObj.failed_count;
                returnObj.total_count = typeof returnObj.total_count === 'undefined' ? 0 : returnObj.total_count;
                return returnObj;
            }
            return new Batch();
        };

        Batch.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(Batch.build);
            }
            return Batch.build(data);
        };

        return Batch;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('batchService', ['$http', '$q', '$resource', 'scaleConfig', function($http, $q, $resource, scaleConfig) {

        var getBatchesParams = function (page, page_size, started, ended, order, status) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                status: status
            };
        };

        return {
            getBatches: function (params) {
                params = params || getBatchesParams();
                var d = $q.defer();
                var url = scaleConfig.getUrlPrefix() + 'batches/';
                $http({
                    url: url,
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getBatchById: function (id) {
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix() + 'batches/' + id + '/',
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            validateBatch: function (batch) {
                var d = $q.defer();

                $http.post(scaleConfig.urls.apiPrefix + 'batches/validation/', batch.clean()).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            saveBatch: function (batch) {
                var d = $q.defer();

                $http.post(scaleConfig.urls.apiPrefix + 'batches/', batch.clean()).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisDataFeedController', ['$scope', 'scaleConfig', 'loadService', 'scaleService', function ($scope, scaleConfig, loadService, scaleService) {
        var days = [],
            hours = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],
            values = {};
        
        var processNewFeed = function () {
            days = [];
            var day = '';
            if ($scope.feed) {
                _.forEach($scope.feed.values, function (val) {
                    var valday = moment.utc(val.time).format(scaleConfig.dateFormats.day);
                    var valhour = moment.utc(val.time).hour();
                    var id = valday + '_' + valhour;
                    values[id] = val;
                    if (valday !== day) {
                        day = valday;
                        days.push(valday);
                    }
                });
                buildTable();
            }
        };

        var buildTable = function () {
            var currDay = moment().utc().format(scaleConfig.dateFormats.day);
            var currHour = moment().utc().hour();

            var table_html = '<div class="table-responsive"><table>';
            table_html += '<tr><th>Hour (UTC)</th>';
            for(day in days) {
                table_html += '<td class="day-label" title="' + days[day] + '"><div class="day-of-week">' + scaleService.getDayString(moment(days[day]).day()) + '</div>' + moment(days[day]).format('MM/DD') + '</td>';
            }
            table_html += '</tr>';
            for(var hour in hours) {
                hour = 23-hour;
                table_html += '<tr>';
                table_html += '<th title="' + hours[hour] + ':00">' + hours[hour] + '</th>';

                for(var day in days) {
                    var key =  days[day] + '_' + hours[hour];
                    var files = values[key].files;
                    var size = values[key].size;
                    var cls = 'good';
                    if (days[day] === currDay) {
                        if (hours[hour] === currHour) {
                            cls = 'current';
                        }
                        else if (hours[hour] > currHour) {
                            cls = 'future';
                        }
                    }
                    if (files === 0 && size === 0 && cls !== 'current' && cls !== 'future') {
                        cls = 'unknown';
                    }
                    table_html += '<td id="' + key + '" title="' + days[day] + ' ' + hours[hour] + ':00">';
                    if (cls === 'future') {
                        table_html += '<span class="' + cls + '" id="span_' + days[day] + '_' + hours[hour] + '" style="display: block;">&nbsp;</span></td>';
                    }
                    else{
                        table_html += '<span class="' + cls + '" id="span_' + days[day] + '_' + hours[hour] + '" style="display: block;">' + scaleService.calculateFileSizeFromBytes(size,1) + ' / ' + files + '</span></td>';
                    }

                }
                table_html += '</tr>';
            }
            table_html += '</table></div>';
            $('#history').html(table_html);
        };

        var initialize = function () {

            $scope.$watch('feed', function (value) {
                if ($scope.feed) {
                    processNewFeed();
                }
            });
        };

        initialize();
    }]).directive('aisDataFeed', function () {
        return {
            controller: 'aisDataFeedController',
            templateUrl: 'modules/charts/dataFeed/dataFeedTemplate.html',
            restrict: 'E',
            scope: {
                feed: '=' // Feed data
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisDonutController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
        var colData = [],
            chart = null;

        var genChart = function () {
            if (chart) {
                var oldData = [],
                    removeIds = [];

                // reassemble currently displayed data to match colData
                _.forEach(chart.data(), function (d) {
                    oldData.push([d.values[0].id, d.values[0].value]);
                });

                // determine which elements to remove
                _.forEach(oldData, function (od) {
                    var keep = _.find(colData, function (cd) {
                        return cd[0] === od[0];
                    });
                    if (!keep) {
                        removeIds.push(od[0]);
                    }
                });

                // update chart
                chart.load({
                    columns: colData,
                    unload: removeIds
                });
            } else {
                chart = c3.generate({
                    bindto: $element[0],
                    data: {
                        columns: colData,
                        type: $scope.type,
                        colors: {
                            down: scaleConfig.colors.chart_red,
                            warning: scaleConfig.colors.chart_yellow,
                            up: scaleConfig.colors.chart_green,
                            Completed: scaleConfig.colors.chart_green,
                            Done: '#3681bf',
                            Queue: scaleConfig.colors.chart_yellow,
                            Failed: scaleConfig.colors.chart_red,
                            ALGORITHM: scaleConfig.colors.failure_algorithm,
                            DATA: scaleConfig.colors.failure_data,
                            SYSTEM: scaleConfig.colors.failure_system,
                            Offline: scaleConfig.colors.chart_red,
                            'High Failure Rate': scaleConfig.colors.chart_orange,
                            Paused: scaleConfig.colors.chart_yellow
                        }
                    },
                    transition: {
                        duration: 700
                    },
                    pie: {
                        label: {
                            format: d3.format(',')
                        }
                    },
                    donut: {
                        label: {
                            format: $scope.showLabel ? d3.format(',') : function () {
                                return '';
                            }
                        },
                        width: $scope.width,
                        title: $scope.name
                    },
                    tooltip: {
                        format: {
                            value: d3.format(',')
                        }
                    },
                    size: {
                        height: $scope.size || 320
                    }
                });
            }
            $element[0].style.position = 'static';
        };

        var initColumnData = function (){
            colData = [];
            $scope.data.forEach(function (obj){
                colData.push([obj.status,obj.count]);
            });
        };

        var initialize = function () {
            initColumnData();
            genChart();
        };

        $scope.$watch('data', function (data) {
            if (data) {
                if (data.length > 0) {
                    initialize();
                } else {
                    if (chart) {
                        chart.destroy();
                        chart = null;
                    }
                }
            }
        });

        window.onresize = function () {
            genChart();
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisDonut', function () {
        return {
            controller: 'aisDonutController',
            restrict: 'E',
            scope: {
                data: '=',
                type: '=',
                size: '=',
                showLabel: '=',
                width: '=',
                name: '='
            }
        };
    });
})();

'use strict';

angular.module('scaleApp').controller('aisRadialPercentageController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
    var isInitialized = false,
        foreground = '',
        text = '',
        arcTween = '',
        textTween = '';

    var getForeground = function () {
        var value = parseFloat($scope.percentage);
        if (value >= 75) {
            return scaleConfig.colors.chart_green;
        } else if (value < 75 && value >= 50) {
            return scaleConfig.colors.chart_yellow;
        } else {
            return scaleConfig.colors.chart_red;
        }
    };

    var initialize = function () {
        // handle input either .83 or 83
        var percentage = $scope.percentage || 0;
        if (percentage > 1) {
            percentage /= 100;
        }

        // size the chart to the parent container. It's square, so take the
        // smaller of width/height
        var size = $element[0].parentNode.clientWidth;
        if ($element[0].parentNode.clientHeight < size) {
            size = $element[0].parentNode.clientHeight;
        }
        
        var formatPercent = d3.format('.0%');

        var arc = d3.svg.arc()
            .startAngle(0)
            .outerRadius(size * 0.95 / 2)
            .innerRadius(size * 0.80 / 2);

        var svg = d3.select($element[0]).append('svg').attr({
            width: size,
            height: size
        }).append('g').attr({
            'transform': 'translate(' + size / 2 + ',' + size / 2 + ')',
            'class': 'aisRadial'
        });

        var meter = svg.append('g').attr({
            'transform': 'rotate(180)'
        });
        meter.append('path')
            .datum({
                endAngle: (2 * Math.PI),
            })
            .attr('class', 'background')
            .attr('d', arc);

        foreground = meter.append('path')
            .datum({
                endAngle: 0
            })
            .attr({
                'd': arc
            })
            .style('fill', function () {
                return getForeground();
            });

        text = svg.append('text')
            .datum({
                percentage: 0
            })
            .attr('text-anchor', 'middle')
            .attr('dy', '.35em');


        textTween = function (transition, newPercentage) {
            transition.attrTween('text', function (d) {
                if (typeof d === 'undefined') {
                    d = 0;
                }
                var i = d3.interpolate(d.percentage, newPercentage);
                return function (t) {
                    d.percentage = i(t);
                    text.text(formatPercent(i(t)));
                    return t;
                }
            });
        };
        arcTween = function (transition, newAngle) {
            transition.attrTween('d', function (d) {
                var i = d3.interpolate(d.endAngle, newAngle);
                return function (t) {
                    d.endAngle = i(t);
                    return arc(d);
                };
            });
        };

        isInitialized = true;

        redraw(percentage);
    };

    var redraw = function (value) {
        if (isInitialized) {
            var percentage = value;
            if (percentage > 1) {
                percentage /= 100;
            }

            foreground.transition().duration(1000)
                .style('fill', function () {
                    return getForeground();
                })
                .call(arcTween, (Math.PI * 2) * percentage);
            text.transition().duration(1000).call(textTween, percentage);
        }
    };

    $scope.$watch('percentage', function (value) {
        if (value && !isInitialized) {
            initialize();
        } else {
            redraw(value);
        }
    })
}]);

'use strict';

angular.module('scaleApp').directive('aisRadialPercentage', function () {
    return {
        controller: 'aisRadialPercentageController',
        restrict: 'E',
        scope: {
            percentage: '@'
        }
    };
});

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisJobLoadController', ['$scope', 'scaleConfig', 'scaleService', 'loadService', function ($scope, scaleConfig, scaleService, loadService) {
        var vm = this,
            chart = null,
            colArr = [],
            xArr = [];

        vm.filterValue = 1;
        vm.filterDuration = 'w';
        vm.filterDurations = ['M', 'w', 'd'];
        vm.zoomEnabled = false;
        vm.zoomClass = 'btn-default';
        vm.zoomText = 'Enable Zoom';
        vm.jobLoadData = {};
        vm.loadingJobLoad = true;
        vm.jobLoadError = null;
        vm.jobLoadErrorStatus = null;
        vm.total = 0;
        vm.chartStyle = '';

        var jobLoadParams = {
            started: moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toDate(), ended: moment.utc().endOf('d').toDate(), job_type_id: null, job_type_name: null, job_type_category: null, url: null
        };

        vm.toggleZoom = function () {
            vm.zoomEnabled = !vm.zoomEnabled;
            chart.zoom.enable(vm.zoomEnabled);
            if (vm.zoomEnabled) {
                vm.zoomClass = 'btn-primary';
                vm.zoomText = 'Disable Zoom';
            } else {
                vm.zoomClass = 'btn-default';
                vm.zoomText = 'Enable Zoom';
            }
        };

        var initChart = function () {
            xArr = [];
            
            xArr = _.pluck(vm.jobLoadData.results, 'time');
            _.forEach(xArr, function (d, i) {
                xArr[i] = moment.utc(d).toDate();
            });
            xArr.unshift('x');

            var pendingArr = _.pluck(vm.jobLoadData.results, 'pending_count'),
                queuedArr = _.pluck(vm.jobLoadData.results, 'queued_count'),
                runningArr = _.pluck(vm.jobLoadData.results, 'running_count');

            pendingArr.unshift('Pending');
            queuedArr.unshift('Queued');
            runningArr.unshift('Running');

            // add to colArr
            colArr = [xArr, pendingArr, queuedArr, runningArr];

            var types = {},
                type = {},
                groups = [];

            _.forEach(colArr, function(col){
                type = {};
                if (col[0] !== 'x') {
                    type[col[0]] = 'area';
                    groups.push(col[0]);
                }
                angular.extend(types, type);
            });

            if (chart) {
                chart.flush();
            }
            // chart config
            chart = c3.generate({
                bindto: '#job-load',
                data: {
                    x: 'x',
                    columns: colArr,
                    types: types,
                    groups: [groups],
                    colors: {
                        Pending: scaleConfig.colors.chart_pink,
                        Queued: scaleConfig.colors.chart_purple,
                        Running: scaleConfig.colors.chart_blue
                    }
                },
                transition: {
                    duration: 700
                },
                tooltip: {
                    format: {
                        title: function (x) {
                            return moment.utc(x).startOf('h').format(scaleConfig.dateFormats.day_second);
                        }
                    }
                },
                axis: {
                    x: {
                        type: 'timeseries',
                        tick: {
                            format: function (d) {
                                return moment.utc(d).format(scaleConfig.dateFormats.day);
                            }
                        }
                    }
                }
            });
            vm.loadingJobLoad = false;
        };

        var getJobLoad = function (showPageLoad) {
            if (showPageLoad) {
                $scope.$parent.loading = true;
            } else {
                vm.loadingJobLoad = true;
            }
            jobLoadParams.started = moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toDate();
            jobLoadParams.ended = moment.utc(jobLoadParams.started).add(1, vm.filterDuration).endOf('d').toDate();
            jobLoadParams.page_size = 1000;

            loadService.getJobLoad(jobLoadParams).then(null, null, function (result) {
                if (result.$resolved) {
                    vm.jobLoadData = result;
                    initChart();
                } else {
                    if (result.statusText && result.statusText !== '') {
                        vm.jobLoadErrorStatus = result.statusText;
                    }
                    vm.jobLoadError = 'Unable to retrieve job load.';
                }
                if (showPageLoad) {
                    $scope.$parent.loading = false;
                } else {
                    vm.loadingJobLoad = false;
                }
            });
        };

        vm.updateJobLoadRange = function (action) {
            if (action === 'older') {
                vm.filterValue++;
            } else if (action === 'newer') {
                if (vm.filterValue > 1) {
                    vm.filterValue--;
                }
            } else if (action === 'today') {
                vm.filterValue = 1;
            }
            getJobLoad(true);
        };

        $scope.$watch('vm.filterValue', function (value) {
            var $jobLoadNewer = $('.job-load-newer'),
                $jobLoadToday = $('.job-load-today');

            if (value > 1) {
                $jobLoadNewer.removeAttr('disabled');
                $jobLoadToday.removeAttr('disabled');
            } else {
                $jobLoadNewer.attr('disabled', 'disabled');
                $jobLoadToday.attr('disabled', 'disabled');
            }
        });


        if ($scope.autoHeight) {
            // set chart height
            angular.element(document).ready(function () {
                // set container heights equal to available page height
                var viewport = scaleService.getViewportSize(),
                    offset = scaleConfig.headerOffset,
                    headerOffset = $('.job-load-header').height(),
                    legendOffset = $('.job-load-legend-label').height(),
                    filterOffset = $('.job-load-filter').outerHeight(true),
                    chartMaxHeight = viewport.height - offset - headerOffset - legendOffset - filterOffset - 5;

                vm.chartStyle = 'height: ' + chartMaxHeight + 'px; max-height: ' + chartMaxHeight + 'px;';
                getJobLoad();
            });
        } else {
            getJobLoad();
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisJobLoad', function () {
        return {
            controller: 'aisJobLoadController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/jobLoad/jobLoadTemplate.html',
            restrict: 'E',
            scope: {
                showFilter: '=', // show time range filter UI
                cullLegend: '=', // only show job types in legend whose value is > 0
                hideTitle: '=',
                autoHeight: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisGridChartController', ['$rootScope', '$scope', '$location', '$uibModal', 'userService', 'scaleConfig', 'scaleService', function ($rootScope, $scope, $location, $uibModal, userService, scaleConfig, scaleService) {
        var vm = this,
            svg = null,
            rect = null,
            scale = parseFloat($scope.scale),
            tip = d3.tip()
                .attr('class', 'd3-tip')
                .offset([-10, 0])
                .html(function(d) {
                    var failures = d.status.getFailures(),
                        failStr = failures.length > 0 ? '<br /><br />' : '',
                        running = getCellActivityTotal(d),
                        completed = getCellTotal(d),
                        statusStr = running > 0 || completed > 0 ? '<br />' : '';

                    if (running > 0) {
                        statusStr = statusStr + '<span class="label label-running">Running: ' + running + '</span>';
                    }
                    if (completed > 0) {
                        statusStr = statusStr + ' <span class="label label-completed">Completed: ' + completed + '</span>';
                    }

                    failures = _.sortByOrder(failures, ['order']);

                    _.forEach(failures, function (f) {
                        failStr = failStr + '<span class="label label-' + f.status.toLowerCase() + '">' + _.capitalize(f.status.toLowerCase()) + ': ' + f.count + '</span> ';
                    });
                    return d.title + ' ' + d.version + '<br />' + statusStr + failStr;
                }),
            cellWidth = 50 * scale,
            cellHeight = 50 * scale,
            enableZoom = typeof $scope.mode !== 'undefined' ? $scope.mode === 'zoom' : true,
            enableTooltip = typeof $scope.mode !== 'undefined' ? $scope.mode === 'tooltip' : false,
            enableReveal = typeof $scope.reveal !== 'undefined' ? $scope.reveal : true,
            user = userService.getUserCreds(),
            gridData = [],
            width = $('.grid-chart').width(),
            height = (Math.ceil(width / cellWidth) * cellHeight),
            cols = 0,
            rows = 0,
            cellFontLg = .4,
            cellFontSm = .3;
        
        vm.loading = true;
        vm.pauseReason = '';
        vm.dataValues = [];
        vm.gridClass = function () {
            return $scope.icons === true ? 'icons' : '';
        };

        $scope.$watchCollection('vm.dataValues', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            height = (Math.ceil(newValue.length / (Math.floor(width / cellWidth))) * cellHeight);
            if (enableZoom) {
                height = height * 6;
            }
            d3.select('.grid-chart-container svg').attr('height', height);
            d3.select('.overlay').attr('height', height);
        });

        var getDataValues = function (data) {
            gridData = [];
            vm.dataValues = [];
            if (data.data) {
                var dataType = data.data.toString().split(',')[0];
                if (dataType === 'JobType') {
                    vm.dataValues = _.sortByOrder(_.values(data.data), ['name'], ['asc']);
                    // associate JobType with JobTypeStatus
                    _.forEach(vm.dataValues, function (val) {
                        val.status = _.find(data.status, 'job_type.id', val.id);
                    });
                    vm.dataValues = _.sortByOrder(_.values(data.data), ['status.has_running', 'status.description', 'name'], ['asc', 'asc', 'asc']);
                } else if (dataType === 'Node') {
                    vm.dataValues = _.values(data.data);
                    //vm.dataValues = _.sortByOrder(_.values(data.data), ['hostname'], ['asc']);
                    // associate Node with NodeStatus
                    _.forEach(vm.dataValues, function (val) {
                        val.status = _.find(data.status, 'node.id', val.id);
                    });
                    //vm.dataValues = _.sortByOrder(vm.dataValues, ['hostname'], ['asc']); // sort by hostName asc
                } else {
                    vm.dataValues = data.data;
                }

                cols = $scope.columns ? $scope.columns : Math.floor(width / cellWidth);
                rows = $scope.rows ? $scope.rows : Math.ceil(vm.dataValues.length / cols);

                d3.range(rows).map(function (row) {
                    d3.range(cols).map(function (col) {
                        if (col <= vm.dataValues.length - 1) {
                            var dataObj = vm.dataValues[(cols * row) + col];
                            if (dataObj) {
                                dataObj.coords = [col * cellHeight, row * cellWidth];
                                gridData.push(dataObj);
                            }
                        }
                    });
                });

                update();
            }
        };

        var revealData = function () {
            d3.selectAll('.cell-text')
                .style('display', 'none');
            d3.selectAll('.cell-text-detail')
                .style('display', 'block');
            d3.selectAll('.cell-pause-resume-icon')
                .style('display', 'block');
        };

        var hideData = function () {
            d3.selectAll('.cell-text')
                .style('display', 'block');
            d3.selectAll('.cell-text-detail')
                .style('display', 'none');
            d3.selectAll('.cell-pause-resume-icon')
                .style('display', 'none');
        };

        var initialize = function (data) {
            cols = $scope.columns ? $scope.columns : Math.floor(width / cellWidth);
            rows = $scope.rows ? $scope.rows : Math.ceil(vm.dataValues.length / cols);

            var tickValues = Array.apply(null, {length: rows}).map(Number.call, Number);

            var zoom = d3.behavior.zoom()
                .scaleExtent([1, 6])
                //.center([0, 0])
                .on('zoom', zoomed);

            if (enableZoom) {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .call(zoom)
                    .append('g');
            } else if (enableTooltip) {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .call(tip);
            } else {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g');
            }

            svg.append('rect')
                .attr('class', 'overlay')
                .attr('width', width)
                .attr('height', height);

            if (vm.showAxes) {
                var y = d3.scale.linear()
                    .domain([0, rows])
                    .range([0, height-10]);

                var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient('left')
                    .tickValues(tickValues);

                svg.attr('transform', 'translate(' + 25 + ',' + 0 + ')')
                    .append('g')
                    .attr('class', 'y axis')
                    .attr('transform', 'translate(' + 0 + ',' + cellHeight / 2 + ')')
                    .call(yAxis);
            }

            getDataValues(data);

            function zoomed() {
                var s = d3.event.scale;

                if (enableReveal) {
                    if (s > 3) {
                        revealData();
                    } else {
                        hideData();
                    }
                }
                if (s === 1) {
                    if ($scope.showAxes) {
                        zoom.translate([25, 0]);
                    } else {
                        zoom.translate([0, 0]);
                    }
                }
                svg.attr('transform', 'translate(' + zoom.translate() + ')scale(' + d3.event.scale + ')');
            }

            vm.loading = false;
        };

        var dragOffsetX = 0,
            dragOffsetY = 0,
            clickOffsetX = 0,
            clickOffsetY = 0;

        var drag = d3.behavior.drag()
            .on('dragstart', function () {
                // track offsetX and offsetY to distinguish between drag and click
                dragOffsetX = d3.event.sourceEvent.layerX;
                dragOffsetY = d3.event.sourceEvent.layerY;
            });

        var getCellFill = function (d) {
            if (d && d.status) {
                return d.status.getCellFill();
            }
            return 'none';
        };

        var getCellText = function (d) {
            if (d) {
                return d.getCellText();
            }
        };

        var getCellActivity = function (d) {
            if (d && d.status) {
                if (d.toString() === 'JobType') {
                    return d.status.getCellActivity();
                }
            }
        };

        var getCellPauseResume = function (d) {
            if (d && d.status) {
                return d.status.getCellPauseResume();
            }
        };

        var getCellActivityTotal = function (d) {
            if (d && d.status) {
                return d.status.getCellActivityTotal();
            }
        };

        var getCellTitle = function (d) {
            if (d) {
                return d.getCellTitle();
            }
        };

        var getCellError = function (d) {
            if (d && d.status) {
                return d.status.getCellError();
            }
            return 'Failed: Unavailable';
        };

        var getCellTotal = function (d) {
            if (d && d.status) {
                return d.status.getCellTotal();
            }
            return 'Completed: Unavailable';
        };

        var getCellStatus = function (d) {
            if (d && d.status) {
                if (d.toString() === 'Node') {
                    return d.status.getCellStatus();
                }
            }
            return 'Status Unavailable';
        };

        var getCellJobs = function (d) {
            if (d && d.status) {
                if (d.toString() === 'Node') {
                    return d.status.getCellJobs();
                }
            }
        };

        var getCellFailures = function (d) {
            if (d && d.status) {
                if (d.toString() === 'JobType') {
                    return d.status.getCellFailures();
                }
            }
        };

        var cellClickHandler = function (target) {
            // track offsetX and offsetY to distinguish between drag and click
            clickOffsetX = d3.event.layerX;
            clickOffsetY = d3.event.layerY;
            if (dragOffsetX === clickOffsetX && dragOffsetY === clickOffsetY) {
                // offsets are the same; no dragging occurred; process as click event
                $scope.$apply(function () {
                    if (target.toString() === 'JobType') {
                        $location.path('/jobs').search('job_type_id', target.id).search('status', target.status.has_running.status);
                    } else if (target.toString() === 'Node') {
                        $location.path('/nodes/' + target.id);
                    }
                });
            }
        };

        var update = function () {
            var elem = $('.cell-activity-icon');
            TweenMax.to(elem, 1, {
                rotation: 360,
                transformOrigin: '50% 50%',
                repeat: -1,
                ease: Linear.easeNone
            });

            // DATA JOIN
            // Join new data with old elements, if any.
            if (enableTooltip) {
                var containerGroup = svg.selectAll('.cell-group')
                    .data(gridData, function (d) { return d.coords; })
                    .on('mouseover', tip.show)
                    .on('mouseout', tip.hide)
                    .on('click', tip.hide);
            } else {
                var containerGroup = svg.selectAll('.cell-group')
                    .data(gridData, function (d) { return d.coords; });
            }

            // UPDATE
            // Update old elements as needed.
            containerGroup.selectAll('.stop1')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 1) {
                            return '100%';
                        }
                        return '0%';
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return failures[0] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[0] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.stop2')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 3) {
                            return '50%';
                        } else if (failures.length === 2) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        return failures[1] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[1] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.stop3')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        if (failures.length === 3) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        return failures[2] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[2] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.cell')
                .data(gridData, function (d) { return d.coords; })
                .transition()
                .duration(750)
                .style('stroke', function (d) {
                    return d ? '#fff' : 'none';
                })
                .style('fill', function (d) {
                    if (d.toString() === 'Node') {
                        return getCellFill(d);
                    }
                });

            var cg = containerGroup.selectAll('.cell-gradient');

            containerGroup.selectAll('.cell-text')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellText(d);
                })
                .attr('y', function (d) {
                    if (d.toString() === 'JobType' && getCellActivityTotal(d) > 0) {
                        return cellHeight / 2;
                    }
                    return (cellHeight / 2) + 10;
                });

            containerGroup.selectAll('.cell-total-active')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    if (d.toString() === 'JobType') {
                        return getCellActivityTotal(d);
                    }
                });

            containerGroup.selectAll('.cell-pause-resume-icon')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellPauseResume(d);
                });

            containerGroup.selectAll('.cell-activity-icon')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellActivity(d);
                });

            containerGroup.selectAll('.cell-title')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellTitle(d);
                });

            containerGroup.selectAll('.cell-error')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellError(d, true);
                });

            containerGroup.selectAll('.cell-total')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellTotal(d);
                });

            containerGroup.selectAll('.cell-status')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellStatus(d);
                });

            containerGroup.selectAll('.cell-jobs')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellJobs(d);
                });

            containerGroup.selectAll('.cell-overlay')
                .data(gridData, function (d) { return d.coords; })
                .on('click', function (target) {
                    cellClickHandler(target);
                });

            // ENTER
            // Create new elements as needed.
            var cellGroup = containerGroup.enter()
                .append('g')
                .attr('class', 'cell-group');

            var defs = cellGroup.append('defs');
            var gradient = defs.append('linearGradient')
                .attr('id', function (d) {
                    return d.name;
                })
                .attr('class', 'cell-gradient')
                .attr('x1', 0)
                .attr('y1', 0)
                .attr('x2', 0)
                .attr('y2', 1);
            gradient.append('stop')
                .attr('class', 'stop1')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 1) {
                            return '100%';
                        }
                        return '0%';
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return failures[0] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[0] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });
            gradient.append('stop')
                .attr('class', 'stop2')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        if (failures.length === 3) {
                            return '50%';
                        } else if (failures.length === 2) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        return failures[1] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[1] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });
            gradient.append('stop')
                .attr('class', 'stop3')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        if (failures.length === 3) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        return failures[2] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[2] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            cellGroup.append('rect')
                .attr('class', 'cell')
                .attr('width', cellWidth)
                .attr('height', cellHeight)
                .style('fill', function (d) {
                    if (d.toString() === 'Node') {
                        return getCellFill(d);
                    }
                })
                .attr('fill', function (d) {
                    if (d.toString() === 'JobType') {
                        return 'url(#' + d.name + ')';
                    }
                })
                .style('stroke', function (d) {
                    return d ? '#fff' : 'none';
                })
                .transition()
                .duration(750);

            cellGroup.append('text')
                .attr('class', 'cell-text')
                .html(function (d) {
                    return getCellText(d);
                })
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', function (d) {
                    if (d.toString() === 'JobType') {
                        if (getCellActivityTotal(d) > 0) {
                            return cellHeight / 2;
                        }
                        return (cellHeight / 2) + 10;
                    }
                    return cellHeight / 2;
                })
                .style('font-size', function (d) {
                    if (d.toString() === 'Node') {
                        return $scope.scale * 8 + 'px';
                    }
                    return '';
                })
                .style('display', enableReveal ? 'block' : 'none');

            cellGroup.append('text')
                .attr('class', 'cell-total-active')
                .text(function (d) {
                    if (d.toString() === 'JobType') {
                        return getCellActivityTotal(d);
                    }
                })
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', cellHeight - 5)
                .style('display', enableReveal ? 'block' : 'none');

            cellGroup.append('g')
                .attr('class', 'cell-activity')
                .append('text')
                .attr('class', 'cell-activity-icon')
                .attr('font-size', 11)
                .html(function (d) {
                    return getCellActivity(d);
                })
                .attr('text-anchor', 'end')
                .attr('x', cellWidth - 2)
                .attr('y', 13);

            var detail = cellGroup.append('text')
                .attr('class', 'cell-text-detail')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.15)) // 15% from top of cell
                .attr('dy', 0)
                .style('display', enableReveal ? 'none' : 'block');

            detail.append('tspan')
                .attr('class', 'cell-title')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .15)) // 15% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .html(function (d) {
                    return getCellTitle(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-error')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.3)) // 30% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .text(function (d) {
                    return getCellError(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-total')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.4)) // 40% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .text(function (d) {
                    return getCellTotal(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-status')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .55)) // 55% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontLg * scale + 'em')
                .text(function (d) {
                    return getCellStatus(d);
                });

            detail.append('tspan')
                .attr('class', 'cell-jobs')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .75)) // 75% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .html(function (d) {
                    return getCellJobs(d);
                })
                .call(wrap);

            cellGroup.append('rect')
                .attr('class', 'cell-overlay')
                .attr('width', cellWidth)
                .attr('height', cellHeight)
                .style('fill', '#fff')
                .on('mouseover', function () {
                    d3.select(this)
                        .style('fill-opacity', '0.25');
                })
                .on('mouseout', function () {
                    d3.select(this)
                        .style('fill-opacity', '0');
                })
                .on('click', function (d) {
                    cellClickHandler(d);
                })
                .call(drag);

            if (user && user.is_admin) {
                cellGroup.append('text')
                    .attr('class', 'cell-pause-resume-icon')
                    .html(function (d) {
                        return getCellPauseResume(d);
                    })
                    .attr('text-anchor', 'start')
                    .attr('x', enableReveal ? 2 : 5)
                    .attr('y', enableReveal ? $scope.scale * 8 : 20)
                    .style('display', enableReveal ? 'none' : 'block')
                    .style('font-size', enableReveal ? $scope.scale * 7 + 'px' : '1.3em')
                    .on('mouseover', function () {
                        d3.select(this)
                            .style('cursor', 'pointer')
                            .style('fill', scaleConfig.colors.chart_blue);
                    })
                    .on('mouseout', function () {
                        d3.select(this)
                            .style('fill', 'white');
                    });
            }

            // ENTER + UPDATE
            // Appending to the enter selection expands the update selection to include
            // entering elements; so, operations on the update selection after appending to
            // the enter selection will apply to both entering and updating nodes.
            containerGroup.transition()
                .duration(750)
                .attr('transform', function (d) {
                    return 'translate(' + d.coords + ')';
                });

            var updateCellFill = function () {
                containerGroup.selectAll('.cell')
                    .transition()
                    .duration(250)
                    .style('stroke', function (d) {
                        return d ? '#fff' : 'none';
                    })
                    .style('fill', function (d) {
                        return getCellFill(d);
                    });
            };

            var updatePauseResume = function () {
                containerGroup.selectAll('.cell-pause-resume-icon')
                    .html(function (d) {
                        return getCellPauseResume(d);
                    });
            };

            var updateCellStatus = function () {
                containerGroup.selectAll('.cell-status')
                    .text(function (d) {
                        return getCellStatus(d);
                    });
            };

            // EXIT
            // Remove old elements as needed.
            containerGroup.exit()
                .attr('class', 'cell-exit')
                .transition()
                .duration(750)
                .attr('transform', 'translate(0,0)')
                .remove();

            function wrap (text, width) {
                text.each(function () {
                    var text = d3.select(this),
                        words = text.text().split(/\s+/).reverse(),
                        word,
                        line = [],
                        lineNumber = 0,
                        lineHeight = 1.1,
                        y = text.attr('y'),
                        dy = parseFloat(text.attr('dy')),
                        tspan = text.text(null).append('tspan').attr('x', cellWidth / 2).attr('y', y).attr('dy', dy + 'em');
                    while (word = words.pop()) {
                        if (word !== 'undefined') {
                            line.push(word);
                            tspan.text(line.join(' '));
                            if (tspan.node().getComputedTextLength() > (cellWidth - 10)) {
                                line.pop();
                                tspan.text(line.join(' '));
                                line = [word];
                                tspan = text.append('tspan').attr('x', cellWidth / 2).attr('y', y).attr('dy', ++lineNumber * lineHeight + dy + 'em').text(word);
                            }
                        }
                    }
                });
            }
        };

        $scope.$watch('data', function (data) {
            if (_.keys(data).length > 0) {
                $('.grid-chart').empty();
                initialize(data);
            }
        });

        $scope.$on('redrawGrid', function (event, data) {
            getDataValues(data);
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisGridChart', function () {
        return {
            controller: 'aisGridChartController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/grid/gridChartTemplate.html',
            restrict: 'E',
            scope: {
                data: '=',
                icons: '=', // indicates whether cell-text is entirely made up of icons
                scale: '=', // multiplier to increase cell size
                reveal: '=', // if true, less data will show when zoomed out
                mode: '@', // valid values are zoom or tooltip
                columns: '=',
                rows: '=',
                showAxes: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisHealthController', ['$scope', function ($scope) {
        var vm = this,
            initialized = false;

        var initialize = function () {
            initialized = true;
            var scale = $scope.scale || 1;
            vm.donutSize = 275 * scale;
            vm.donutWidth = 25 * scale;
        };

        $scope.$watch('data', function (data) {
            if (data) {
                if (_.keys(data).length > 0) {
                    if (!initialized) {
                        initialize();
                    }
                }
            }
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisHealth', function () {
        return {
            controller: 'aisHealthController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/health/healthTemplate.html',
            restrict: 'E',
            scope: {
                name: '=',
                data: '=',
                scale: '=',
                errorLabel: '=',
                type: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisTimelineDirectiveController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
        var vm = this,
            gantt = null,
            taskNames = [];

        $element[0].onresize = function () {
            console.log('element resize');
        };

        var initialize = function () {
            $scope.$watch('tasks', function (value) {
                drawTimeline();
            });
        };

        var drawTimeline = function () {
            if ($scope.tasks && $scope.tasks.length > 0) {
                $scope.tasks.sort(function (a, b) {
                    return a[$scope.ended] - b[$scope.ended];
                });

                taskNames = _($scope.tasks).pluck('taskName').uniq().value();
                var height = taskNames.length * 30 + 20;

                var width = $element[0].clientWidth;
                if (!width || width === 0) { width = 600; }


                $scope.tasks.sort(function (a, b) {
                    return a[$scope.started] - b[$scope.started];
                });
                var minDate = $scope.tasks[0][$scope.started];
                var maxDate = $scope.tasks[$scope.tasks.length - 1][$scope.ended];
                var daysDiff = moment.utc(maxDate).diff(moment.utc(minDate),'days');
                var format = '%H:%M:%S.%m';
                if (daysDiff > 0) {
                    format = "%m/%d/%y %H:%M";
                }

                gantt = d3.gantt().renderTo("#ais-timeline").taskTypes(taskNames).taskStatus(scaleConfig.taskStatusStyles).tickFormat(format).begin($scope.started).ended($scope.ended).height(height).width(width);

                gantt.timeDomainMode("fit");

                gantt($scope.tasks);

            }
        };

        vm.formatDate = function (date) {
            if (date) {
                return moment.utc(date).toISOString();
            }
            else {
                return date;
            }
        };
        initialize();

    }]).directive('aisTimeline', function () {
        return {
            controller: 'aisTimelineDirectiveController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/timeline/timelineDirectiveTemplate.html',
            restrict: 'E',
            scope: {
                tasks: '=',
                started: '=',
                ended: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisGridPagination', function () {
        return {
            templateUrl: 'modules/common/directives/aisGridPaginationTemplate.html',
            restrict: 'E'
        };
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisMultiselect', function () {
        return {
            restrict: 'A',
            require: '^ngModel',
            scope: {
                multiselectDataProvider: '=',
                enableFiltering: '=',
                maxHeight: '=',
                numberDisplayed: '=',
                includeSelectAllOption: '=',
                nonSelectedText: '=',
                ngModel: '='
            },
            link: function(scope, element, attributes) {
                element = $(element[0]);

                element.multiselect({
                    enableFiltering: scope.enableFiltering,
                    enableCaseInsensitiveFiltering: true,
                    maxHeight: scope.maxHeight || 300,
                    numberDisplayed: scope.numberDisplayed || 3,
                    includeSelectAllOption: scope.includeSelectAllOption,
                    nonSelectedText: scope.nonSelectedText || 'None Selected',
                    onChange: function (optionElement, checked) {
                        scope.$apply(function () {
                            scope.ngModel = element.val();
                        });
                    }
                });

                scope.$watchCollection('multiselectDataProvider', function (newValue, oldValue) {
                    if (angular.equals(newValue, oldValue)) {
                        return;
                    }
                    element.multiselect('dataprovider', newValue);
                });

                /*
                // Watch for any changes to the length of our select element
                scope.$watch(function () {
                    return element[0];
                }, function (newValue) {
                    debugger;
                    //element.multiselect('setOptions', element[0]);
                    //element.multiselect('rebuild');
                }, true);

                // Watch for any changes from outside the directive and refresh
                scope.$watch(attributes.ngModel, function () {
                    element.multiselect('refresh');
                });
                */
            }
        };
    })
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('scaleService', ['$q', '$http', 'scaleConfig', function ($q, $http, scaleConfig) {
        function padWithZero (input, length) {
            // Cast input to string
            input = '' + input;

            var paddingSize = Math.max(0, length - input.length);
            return new Array(paddingSize > 0 ? paddingSize + 1 : 0).join('0') + input;
        }

        return {
            calculateFileSizeFromMib: function(num){
                if (num > 0) {
                    if (num < 1024) {
                        return num.toFixed(2) + ' MB';
                    }
                    if (num >= 1024 && num < 1024*1024) {
                        return (num/1024).toFixed(2) + ' GB';
                    }
                    return (num/1024/1024).toFixed(2) + ' TB';
                }
                return num;
            },
            calculateFileSizeFromBytes: function(num,decimals){
                if (num > 0) {
                    if (num < 1024) {
                        return num.toFixed(decimals) + ' Bytes';
                    }
                    if (num >= 1024 && num < 1024*1024) {
                        return (num/1024).toFixed(decimals) + ' KB';
                    }
                    if (num >= 1024*1024 && num < 1024*1024*1024) {
                        return (num/1024/1024).toFixed(decimals) + ' MB';
                    }
                    if (num >= 1024*1024*1024 && num < 1024*1024*1024*1024) {
                        return (num/1024/1024/1024).toFixed(decimals) + ' GB';
                    }
                    return (num/1024/1024/1024/1024).toFixed(decimals) + ' TB';
                }
                return num;
            },
            getViewportSize: function () {
                var w = window,
                    d = document,
                    e = d.documentElement,
                    g = document.body,
                    x = w.innerWidth || e.clientWidth || g.clientWidth,
                    y = w.innerHeight || e.clientHeight || g.clientHeight;

                return {
                    width: x,
                    height: y
                };
            },
            calculateDuration: function (start, stop, noPadding) {
                var to = moment.utc(stop),
                    from = moment.utc(start),
                    diff = moment.utc(to).diff(moment.utc(from)),
                    durationStr = '';

                var duration = moment.duration(diff);

                if (!noPadding) {
                    durationStr = duration.years() > 0 ? durationStr + padWithZero(duration.years(), 2) + 'Y, ' : durationStr;
                    durationStr = duration.months() > 0 ? durationStr + padWithZero(duration.months(), 2) + 'M, ' : durationStr;
                    durationStr = duration.days() > 0 ? durationStr + padWithZero(duration.days(), 2) + 'D, ' : durationStr;
                    durationStr = duration.hours() > 0 ? durationStr + padWithZero(duration.hours(), 2) + 'h, ' : durationStr;
                    durationStr = duration.minutes() > 0 ? durationStr + padWithZero(duration.minutes(), 2) + 'm, ' : durationStr;
                    durationStr = durationStr + padWithZero(duration.seconds(), 2) + 's';
                } else {
                    durationStr = duration.years() > 0 ? durationStr + duration.years() + 'Y, ' : durationStr;
                    durationStr = duration.months() > 0 ? durationStr + duration.months() + 'M, ' : durationStr;
                    durationStr = duration.days() > 0 ? durationStr + duration.days() + 'D, ' : durationStr;
                    durationStr = duration.hours() > 0 ? durationStr + duration.hours() + 'h, ' : durationStr;
                    durationStr = duration.minutes() > 0 ? durationStr + duration.minutes() + 'm, ' : durationStr;
                    durationStr = durationStr + duration.seconds() + 's';
                }

                return durationStr;
            },
            getDayString: function(dayNumber){
                var dayArr = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
                return dayArr[dayNumber];
            },
            isIE: function () {
                var ua = window.navigator.userAgent,
                    oldIE = ua.indexOf('MSIE'),
                    newIE = ua.indexOf('Trident/');

                if ((oldIE > -1) || (newIE > -1)) {
                    return true;
                }
                return false;
            },
            getMediaTypeHtml: function(mediaType){
                var iconHtml = '<i class="fa ' + 'fa-file' + '"></i>';
                if(mediaType){
                    var ic = _.find(scaleConfig.mediaTypes, {mimeType: mediaType})
                    if(ic){
                        iconHtml = '<i class="fa ' + ic.icon + '"></i>';
                    }
                }
                return iconHtml;
            },
            getVersion: function () {
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'version/',
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            setGridHeight: function (offset) {
                // set container heights equal to available page height
                offset = offset || scaleConfig.headerOffset;
                
                var viewport = this.getViewportSize(),
                    gridMaxHeight = viewport.height - offset;

                return 'height: ' + gridMaxHeight + 'px; max-height: ' + gridMaxHeight + 'px; overflow-y: auto;';
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('schedulerService', ['$http', '$q', 'scaleConfig', function ($http, $q, scaleConfig) {
        var getUpdateSchedulerData = function (is_paused) {
            return {
                is_paused: is_paused
            };
        };

        return {
            updateScheduler: function (data) {
                data = data || getUpdateSchedulerData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('scheduler') + 'scheduler/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('stateService', ['$location', function ($location) {
        var version = '',
            jobsColDefs = [],
            jobsParams = {},
            jobExecutionsParams = {},
            jobTypesParams = {},
            recipesColDefs = [],
            jobTypesFailureRatesParams = {},
            recipesParams = {},
            ingestsColDefs = [],
            ingestsParams = {},
            scansColDefs = [],
            scansParams = {},
            nodesColDefs = [],
            batchesColDefs = [],
            batchesParams = {},
            showActiveWorkspaces = true,
            nodesParams = {},
            logArgs = [],
            jobExecutionLogPoller = [];

        var updateQuerystring = function (data, excludeDefaults) {
            excludeDefaults = excludeDefaults || false;
            if (!excludeDefaults) {
                // set defaults
                data.page = data.page || 1;
                data.page_size = data.page_size || 25;
                data.started = data.started || null;
                data.ended = data.ended || null;
                data.order = data.order ? Array.isArray(data.order) ? data.order : [data.order] : null;
                data.status = data.status || null;
            }
            // check for params in querystring, and update as necessary
            _.forEach(_.pairs(data), function (param) {
                $location.search(param[0], param[1]);
            });
        };

        var initJobsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                status: data.status ? data.status : null,
                error_category: data.error_category ? data.error_category : null,
                job_type_id: data.job_type_id ? parseInt(data.job_type_id) : null,
                job_type_name: data.job_type_name ? data.job_type_name : null,
                job_type_category: data.job_type_category ? data.job_type_category : null,
                url: null
            };
        };

        var initJobExecutionsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                status: data.status ? data.status : null,
                job_type_id: data.job_type_id ? parseInt(data.job_type_id) : null,
                job_type_name: data.job_type_name ? data.job_type_name : null,
                job_type_category: data.job_type_category ? data.job_type_category : null,
                node_id: data.node_id ? data.node_id : null
            };
        };

        var initJobTypesParams = function (data){
            return {
                show_rd: typeof data.show_rd !== 'undefined' ? data.show_rd : true
            }
        };

        var initJobTypesFailureRatesParams = function (data) {
            return {
                page: null,
                page_size: null,
                started: null,
                ended: null,
                name: data.name ? data.name : null,
                version: data.version ? data.version : null,
                category: null,
                order: data.order ? data.order : 'desc',
                orderField: data.orderField ? data.orderField : 'twentyfour_hours',
                orderErrorType: data.orderErrorType ? data.orderErrorType : 'errorTotal'
            };
        };

        var initRecipesParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                type_id: data.type_id ? parseInt(data.type_id) : null,
                type_name: data.type_name ? data.type_name : null,
                url: null
            };
        };

        var initIngestsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-ingest_started'],
                status: data.status ? data.status : null,
                file_name: data.file_name ? data.file_name : null,
                strike_id: data.strike_id ? parseInt(data.strike_id) : null
            };
        };

        var initScansParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                name: data.name ? data.name : null,
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified']
            };
        };

        var initNodesParams = function (data) {
            return {
                // page: data.page ? parseInt(data.page) : 1,
                // page_size: data.page_size ? parseInt(data.page_size) : 25,
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['hostname'],
                active: data.active || 'true',
                state: data.state || null
                // include_inactive: data.include_inactive ? data.include_inactive : null
            };
        };

        var initBatchesParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                status: data.status ? data.status : null,
                recipe_type_id: data.recipe_type_id ? parseInt(data.recipe_type_id) : null,
                job_type_id: data.job_type_id ? parseInt(data.job_type_id) : null,
                url: null
            };
        };

        return {
            getVersion: function () {
                return version;
            },
            setVersion: function (data) {
                version = data;
            },
            getJobsColDefs: function () {
                return jobsColDefs;
            },
            setJobsColDefs: function (data) {
                jobsColDefs = data;
            },
            getJobsParams: function () {
                if (_.keys(jobsParams).length === 0) {
                    return initJobsParams($location.search());
                }
                return jobsParams;
            },
            setJobsParams: function (data) {
                jobsParams = initJobsParams(data);
                updateQuerystring(jobsParams);
            },
            getJobExecutionsParams: function () {
                if (_.keys(jobExecutionsParams).length === 0) {
                    return initJobExecutionsParams($location.search());
                }
                return jobExecutionsParams;
            },
            setJobExecutionsParams: function (data) {
                jobExecutionsParams = initJobExecutionsParams(data);
                updateQuerystring(jobExecutionsParams);
            },
            getJobTypesParams: function () {
                if (_.keys(jobTypesParams).length === 0) {
                    jobTypesParams = initJobTypesParams($location.search());
                }
                //console.log(jobTypesParams);
                return jobTypesParams;
            },
            setJobTypesParams: function (data) {
                jobTypesParams = initJobTypesParams(data);
                updateQuerystring(jobTypesParams);
            },
            getJobTypesFailureRatesParams: function () {
                if (_.keys(jobTypesFailureRatesParams).length === 0) {
                    return initJobTypesFailureRatesParams($location.search());
                }
                return jobTypesFailureRatesParams;
            },
            setJobTypesFailureRatesParams: function (data) {
                jobTypesFailureRatesParams = initJobTypesFailureRatesParams(data);
                _.forEach(_.pairs(jobTypesFailureRatesParams), function (param) {
                    $location.search(param[0], param[1]);
                });
            },
            getRecipesColDefs: function () {
                return recipesColDefs;
            },
            setRecipesColDefs: function (data) {
                recipesColDefs = data;
            },
            getRecipesParams: function () {
                if (_.keys(recipesParams).length === 0) {
                    return initRecipesParams($location.search());
                }
                return recipesParams;
            },
            setRecipesParams: function (data) {
                recipesParams = initRecipesParams(data);
                updateQuerystring(recipesParams);
            },
            getIngestsColDefs: function () {
                return ingestsColDefs;
            },
            setIngestsColDefs: function (data) {
                ingestsColDefs = data;
            },
            getScansColDefs: function () {
                return scansColDefs;
            },
            setScansColDefs: function (data) {
                scansColDefs = data;
            },
            getIngestsParams: function () {
                if (_.keys(ingestsParams).length === 0) {
                    return initIngestsParams($location.search());
                }
                return ingestsParams;
            },
            setIngestsParams: function (data) {
                ingestsParams = initIngestsParams(data);
                updateQuerystring(ingestsParams);
            },
            getScansParams: function () {
                if (_.keys(scansParams).length === 0) {
                    return initScansParams($location.search());
                }
                return scansParams;
            },
            setScansParams: function (data) {
                scansParams = initScansParams(data);
                updateQuerystring(scansParams);
            },
            getNodesColDefs: function () {
                return nodesColDefs;
            },
            setNodesColDefs: function (data) {
                nodesColDefs = data;
            },
            getShowActiveWorkspaces: function () {
                return showActiveWorkspaces;
            },
            setShowActiveWorkspaces: function (data) {
                showActiveWorkspaces = data;
            },
            getNodesParams: function () {
                if (_.keys(nodesParams).length === 0) {
                    return initNodesParams($location.search());
                }
                return nodesParams;
            },
            setNodesParams: function (data) {
                nodesParams = initNodesParams(data);
                updateQuerystring(nodesParams, true);
            },
            getLogArgs: function () {
                return logArgs;
            },
            setLogArgs: function (data) {
                logArgs = data;
            },
            getJobExecutionLogPoller: function () {
                return jobExecutionLogPoller;
            },
            setJobExecutionLogPoller: function (data) {
                jobExecutionLogPoller.push(data);
            },
            getBatchesColDefs: function () {
                return batchesColDefs;
            },
            setBatchesColDefs: function (data) {
                batchesColDefs = data;
            },
            getBatchesParams: function () {
                if (_.keys(batchesParams).length === 0) {
                    return initBatchesParams($location.search());
                }
                return batchesParams;
            },
            setBatchesParams: function (data) {
                batchesParams = initBatchesParams(data);
                updateQuerystring(batchesParams);
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('statusService', ['$resource', 'scaleConfig', 'poller', 'pollerFactory', 'Status', function ($resource, scaleConfig, poller, pollerFactory, Status) {
        return {
            getStatus: function (isNodeStatus) {
                isNodeStatus = isNodeStatus || false;
                var statusResource = isNodeStatus ? $resource(scaleConfig.getUrlPrefix('nodeStatus') + 'status/') : $resource(scaleConfig.getUrlPrefix('status') + 'status/'),
                    statusPoller = isNodeStatus ? pollerFactory.newPoller(statusResource, scaleConfig.pollIntervals.nodeStatus) : pollerFactory.newPoller(statusResource, scaleConfig.pollIntervals.status);

                return statusPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        result = isNodeStatus ? result : Status.transformer(result);
                    } else {
                        statusPoller.stop();
                    }
                    return result;
                });
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('userService', function () {
        return {
            getUserCreds: function () {
                var creds = localStorage.getItem('userCreds');
                try {
                    return JSON.parse(creds);
                } catch (e) {
                    console.log('Error parsing user credentials');
                    return creds;
                }
            },
            setUserCreds: function (user) {
                if (user !== null) {
                    localStorage.setItem('userCreds', JSON.stringify(user));
                } else {
                    localStorage.removeItem('userCreds');
                }

            },
            login: function (username) {
                var user = {
                    username: username,
                    is_admin: true
                };
                this.setUserCreds(user);
                return user;
            },
            logout: function () {
                this.setUserCreds(null);
            }
        }
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('gaugeFactory', ['scaleConfig', function (scaleConfig) {
        var Gauge = function (placeholderName, configuration)
        {
            this.placeholderName = placeholderName;

            var self = this; // for internal d3 functions

            this.configure = function(configuration)
            {
                this.config = configuration;

                this.config.size = this.config.size * 0.9;

                this.config.radius = this.config.size * 0.97 / 2;
                this.config.cx = this.config.size / 2;
                this.config.cy = this.config.size / 2;

                this.config.min = undefined != configuration.min ? configuration.min : 0;
                this.config.max = undefined != configuration.max ? configuration.max : 100;
                this.config.range = this.config.max - this.config.min;

                this.config.majorTicks = configuration.majorTicks || 5;
                this.config.minorTicks = configuration.minorTicks || 2;

                this.config.greenColor 	= configuration.greenColor || '#8fca0e';
                this.config.yellowColor = configuration.yellowColor || '#ffc317';
                this.config.redColor 	= configuration.redColor || '#f54d36';
                this.config.grayColor   = configuration.grayColor || '#aaa';

                this.config.transitionDuration = configuration.transitionDuration || 500;
            };

            this.render = function()
            {
                this.body = d3.select('#' + this.placeholderName)
                    .append('svg:svg')
                    .attr('class', 'gauge')
                    .attr('width', this.config.size)
                    .attr('height', this.config.size);

                this.body.append('svg:circle')
                    .attr('class', 'outer-circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', this.config.radius)
                    .style('fill', '#ccc');
                /*.style('stroke', '#000')
                 .style('stroke-width', '0.5px');*/

                this.body.append('svg:circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', 0.9 * this.config.radius)
                    .style('fill', '#fff')
                    .style('stroke', '#e0e0e0')
                    .style('stroke-width', '2px');

                for (var greenIdx in this.config.greenZones)
                {
                    this.drawBand(this.config.greenZones[greenIdx].from, this.config.greenZones[greenIdx].to, self.config.greenColor);
                }

                for (var yellowIdx in this.config.yellowZones)
                {
                    this.drawBand(this.config.yellowZones[yellowIdx].from, this.config.yellowZones[yellowIdx].to, self.config.yellowColor);
                }

                for (var redIdx in this.config.redZones)
                {
                    this.drawBand(this.config.redZones[redIdx].from, this.config.redZones[redIdx].to, self.config.redColor);
                }

                var fontSize = 0;

                if (undefined != this.config.label)
                {
                    fontSize = Math.round(this.config.size / 9);
                    this.body.append('svg:text')
                        .attr('x', this.config.cx)
                        .attr('y', this.config.cy / 2 + fontSize / 2)
                        .attr('dy', fontSize / 2)
                        .attr('text-anchor', 'middle')
                        .text(this.config.label)
                        .style('font-size', fontSize + 'px')
                        .style('fill', '#333')
                        .style('stroke-width', '0px');
                }

                fontSize = Math.round(this.config.size / 16);
                var majorDelta = this.config.range / (this.config.majorTicks - 1);
                for (var major = this.config.min; major <= this.config.max; major += majorDelta)
                {
                    var minorDelta = majorDelta / this.config.minorTicks,
                        point1 = 0,
                        point2 = 0;
                    for (var minor = major + minorDelta; minor < Math.min(major + majorDelta, this.config.max); minor += minorDelta)
                    {
                        point1 = this.valueToPoint(minor, 0.75);
                        point2 = this.valueToPoint(minor, 0.85);

                        this.body.append('svg:line')
                            .attr('x1', point1.x)
                            .attr('y1', point1.y)
                            .attr('x2', point2.x)
                            .attr('y2', point2.y)
                            .style('stroke', '#666')
                            .style('stroke-width', '1px');
                    }

                    point1 = this.valueToPoint(major, 0.7);
                    point2 = this.valueToPoint(major, 0.85);

                    this.body.append('svg:line')
                        .attr('x1', point1.x)
                        .attr('y1', point1.y)
                        .attr('x2', point2.x)
                        .attr('y2', point2.y)
                        .style('stroke', '#333')
                        .style('stroke-width', '2px');

                    if (major == this.config.min || major == this.config.max)
                    {
                        var point = this.valueToPoint(major, 0.63);

                        this.body.append('svg:text')
                            .attr('x', point.x)
                            .attr('y', point.y)
                            .attr('dy', fontSize / 3)
                            .attr('text-anchor', major == this.config.min ? 'start' : 'end')
                            .text(major)
                            .style('font-size', fontSize + 'px')
                            .style('fill', '#333')
                            .style('stroke-width', '0px');
                    }
                }

                var pointerContainer = this.body.append('svg:g').attr('class', 'pointerContainer');

                var midValue = (this.config.min + this.config.max) / 2;

                var pointerPath = this.buildPointerPath(midValue);

                var pointerLine = d3.svg.line()
                    .x(function(d) { return d.x })
                    .y(function(d) { return d.y })
                    .interpolate('basis');

                pointerContainer.selectAll('path')
                    .data([pointerPath])
                    .enter()
                    .append('svg:path')
                    .attr('d', pointerLine)
                    .style('fill', '#888');

                pointerContainer.append('svg:circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', 0.07 * this.config.radius)
                    .style('fill', '#888');

                fontSize = Math.round(this.config.size / 10);
                pointerContainer.selectAll('text')
                    .data([midValue])
                    .enter()
                    .append('svg:text')
                    .attr('x', this.config.cx)
                    .attr('y', this.config.size - this.config.cy / 4 - fontSize)
                    .attr('dy', fontSize / 2)
                    .attr('text-anchor', 'middle')
                    .style('font-size', fontSize + 'px')
                    .style('fill', '#000')
                    .style('stroke-width', '0px');

                this.redraw(this.config.min, 0);
            };

            this.buildPointerPath = function(value)
            {
                var delta = this.config.range / 13;

                var head = valueToPoint(value, 0.85);
                var head1 = valueToPoint(value - delta, 0.12);
                var head2 = valueToPoint(value + delta, 0.12);

                var tailValue = value - (this.config.range * (1/(270/360)) / 2);
                var tail = valueToPoint(tailValue, 0.28);
                var tail1 = valueToPoint(tailValue - delta, 0.12);
                var tail2 = valueToPoint(tailValue + delta, 0.12);

                return [head, head1, tail2, tail, tail1, head2, head];

                function valueToPoint(value, factor)
                {
                    var point = self.valueToPoint(value, factor);
                    point.x -= self.config.cx;
                    point.y -= self.config.cy;
                    return point;
                }
            };

            this.drawBand = function(start, end, color)
            {
                if (0 >= end - start) return;

                this.body.append('svg:path')
                    .style('fill', color)
                    .attr('d', d3.svg.arc()
                        .startAngle(this.valueToRadians(start))
                        .endAngle(this.valueToRadians(end))
                        .innerRadius(0.65 * this.config.radius)
                        .outerRadius(0.85 * this.config.radius))
                    .attr('transform', function() { return 'translate(' + self.config.cx + ', ' + self.config.cy + ') rotate(270)' });
            };

            this.redraw = function(value, transitionDuration)
            {
                var isDisabled = false;
                if (value < 0) {
                    isDisabled = true;
                    value = 0;
                }
                var pointerContainer = this.body.select('.pointerContainer');

                pointerContainer.selectAll('text').text(parseFloat(value).toFixed(2) + '%');

                var pointer = pointerContainer.selectAll('path');
                pointer.transition()
                    .duration(undefined != transitionDuration ? transitionDuration : this.config.transitionDuration)
                    //.delay(0)
                    //.ease('linear')
                    //.attr('transform', function(d)
                    .attrTween('transform', function()
                    {
                        var pointerValue = value;
                        if (value > self.config.max) pointerValue = self.config.max + 0.02*self.config.range;
                        else if (value < self.config.min) pointerValue = self.config.min - 0.02*self.config.range;
                        var targetRotation = (self.valueToDegrees(pointerValue) - 90);
                        var currentRotation = self._currentRotation || targetRotation;
                        self._currentRotation = targetRotation;

                        return function(step)
                        {
                            var rotation = currentRotation + (targetRotation-currentRotation)*step;
                            return 'translate(' + self.config.cx + ', ' + self.config.cy + ') rotate(' + rotation + ')';
                        }
                    });

                var outerCircle = this.body.select('.outer-circle')
                    .transition()
                    .duration(750)
                    .style('fill', function () {
                        var i = parseInt(value);
                        if (i >= 0 && i < 75 && !isDisabled) {
                            return self.config.greenColor;
                        } else if (i >= 75 && i < 90 && !isDisabled) {
                            return self.config.yellowColor;
                        } else if (i === 0 && isDisabled) {
                            return self.config.redColor;
                        } else {
                            return self.config.redColor;
                        }
                    });
            };

            this.valueToDegrees = function(value)
            {
                // thanks @closealert
                //return value / this.config.range * 270 - 45;
                return value / this.config.range * 270 - (this.config.min / this.config.range * 270 + 45);
            };

            this.valueToRadians = function(value)
            {
                return this.valueToDegrees(value) * Math.PI / 180;
            };

            this.valueToPoint = function(value, factor)
            {
                return { 	x: this.config.cx - this.config.radius * factor * Math.cos(this.valueToRadians(value)),
                    y: this.config.cy - this.config.radius * factor * Math.sin(this.valueToRadians(value)) 		};
            };

            // initialization
            this.configure(configuration);
        };

        return {
            createGauge: function (name, label, min, max, size) {
                var config = {
                    size: size || scaleConfig.defaultGaugeWidth,
                    label: label,
                    min: min || 0,
                    max: max || 100,
                    minorTicks: 5
                };

                var range = config.max - config.min;
                config.yellowZones = [{ from: config.min + range*0.75, to: config.min + range*0.9 }];
                config.redZones = [{ from: config.min + range*0.9, to: config.max }];

                var gauge = new Gauge(name + 'GaugeContainer', config);
                gauge.render();
                return gauge;
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('gridFactory', ['uiGridConstants', function (uiGridConstants) {

        var getSortConfig = function (orderParam) {
            var sortArr = [];

            if (orderParam) {
                _.forEach(orderParam, function (param) {
                    var sortField = param;
                    var sortDirection = 'asc';
                    if (_.startsWith(param, '-')) {
                        sortDirection = 'desc';
                    }
                    sortArr.push({
                        direction: sortDirection,
                        field: sortField
                    })
                });
            }

            return sortArr;
        };

        return {
            defaultGridOptions: function () {
                return {
                    enableRowSelection: true,
                    enableRowHeaderSelection: false,
                    enableHorizontalScrollbar: uiGridConstants.scrollbars.NEVER,
                    enableVerticalScrollbar: uiGridConstants.scrollbars.NEVER,
                    multiSelect: false,
                    enableFiltering: true,
                    useExternalSorting: true,
                    useExternalFiltering: true,
                    enableSorting: true,
                    minRowsToShow: 17,
                    paginationPageSizes: [25, 50, 75, 100],
                    paginationPageSize: 25,
                    useExternalPagination: true,
                    enablePaginationControls: false,
                    paginationCurrentPage: 1
                }
            },
            applySortConfig: function (columnDefs, gridParams) {
                var sortConfig = getSortConfig(gridParams.order);
                _.forEach(sortConfig, function (config, idx) {
                    var field = _.startsWith(config.field, '-') ? config.field.substring(1) : config.field,
                        colDef = _.find(columnDefs, {field: field});

                    if (colDef) {
                        colDef.sort = {
                            direction: config.direction,
                            priority: idx
                        };
                    }
                });
                return columnDefs;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('pollerFactory', ['poller', function (poller) {
        return {
            newPoller: function (resource, interval) {
                return poller.get(resource, {
                    delay: interval,
                    catchError: true
                });
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('Status', ['StatusMaster', 'StatusScheduler', 'StatusResources', function (StatusMaster, StatusScheduler, StatusResources) {
        var Status = function ($resolved, master, scheduler, queue_depth, resources) {
            this.$resolved = $resolved;
            this.master = StatusMaster.transformer(master);
            this.scheduler = StatusScheduler.transformer(scheduler);
            this.queue_depth = queue_depth;
            this.resources = StatusResources.transformer(resources);
        };

        // public methods
        Status.prototype = {
            getCpuUsage: function () {
                if (this.resources.scheduled.cpus && this.resources.total.cpus) {
                    if (this.resources.total.cpus > 0) {
                        return ((this.resources.scheduled.cpus / this.resources.total.cpus) * 100).toFixed(2);
                    }
                }
                return 0.00;
            },
            getMemUsage: function () {
                if (this.resources.scheduled.mem && this.resources.total.mem) {
                    if (this.resources.total.mem > 0) {
                        return ((this.resources.scheduled.mem / this.resources.total.mem) * 100).toFixed(2);
                    }
                }
                return 0.00;
            },
            getDiskUsage: function () {
                if (this.resources.scheduled.disk && this.resources.total.disk) {
                    if (this.resources.total.disk > 0) {
                        return ((this.resources.scheduled.disk / this.resources.total.disk) * 100).toFixed(2);
                    }
                }
                return 0.00;
            }
        };

        // static methods, assigned to class
        Status.build = function (data) {
            if (data) {
                return new Status(
                    data.$resolved,
                    data.master,
                    data.scheduler,
                    data.queue_depth,
                    data.resources
                );
            }
            return new Status();
        };

        Status.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Status.build)
                    .filter(Boolean);
            }
            return Status.build(data);
        };

        return Status;
    }]);
})();
(function () {
    'use strict';
    
    angular.module('scaleApp').factory('StatusMaster', function () {
        var StatusMaster = function (is_online, hostname, port) {
            this.is_online = is_online;
            this.hostname = hostname;
            this.port = port;
        };

        // public methods
        StatusMaster.prototype = {

        };

        // static methods, assigned to class
        StatusMaster.build = function (data) {
            if (data) {
                return new StatusMaster(
                    data.is_online,
                    data.hostname,
                    data.port
                );
            }
            return new StatusMaster();
        };

        StatusMaster.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusMaster.build)
                    .filter(Boolean);
            }
            return StatusMaster.build(data);
        };

        return StatusMaster;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusResource', function () {
        var StatusResource = function (cpus, mem, disk) {
            this.cpus = cpus;
            this.mem = mem;
            this.disk = disk;
        };

        // public methods
        StatusResource.prototype = {

        };

        // static methods, assigned to class
        StatusResource.build = function (data) {
            if (data) {
                return new StatusResource(
                    data.cpus,
                    data.mem,
                    data.disk
                );
            }
            return new StatusResource();
        };

        StatusResource.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusResource.build)
                    .filter(Boolean);
            }
            return StatusResource.build(data);
        };

        return StatusResource;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusResources', ['StatusResource', function (StatusResource) {
        var StatusResources = function (total, scheduled, used) {
            this.total = StatusResource.transformer(total);
            this.scheduled = StatusResource.transformer(scheduled);
            this.used = StatusResource.transformer(used);
        };

        // public methods
        StatusResources.prototype = {

        };

        // static methods, assigned to class
        StatusResources.build = function (data) {
            if (data) {
                return new StatusResources(
                    data.total,
                    data.scheduled,
                    data.used
                );
            }
            return new StatusResources();
        };

        StatusResources.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusResources.build)
                    .filter(Boolean);
            }
            return StatusResources.build(data);
        };

        return StatusResources;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusScheduler', function () {
        var StatusScheduler = function (is_online, is_paused, hostname) {
            this.is_online = is_online;
            this.is_paused = is_paused;
            this.hostname = hostname;
        };

        // public methods
        StatusScheduler.prototype = {

        };

        // static methods, assigned to class
        StatusScheduler.build = function (data) {
            if (data) {
                return new StatusScheduler(
                    data.is_online,
                    data.is_paused,
                    data.hostname
                );
            }
            return new StatusScheduler();
        };

        StatusScheduler.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusScheduler.build)
                    .filter(Boolean);
            }
            return StatusScheduler.build(data);
        };

        return StatusScheduler;
    });
})();
/**
 * <scale-file-ancestry-tree />
 */
(function () {
    angular.module('scaleApp').controller('scaleFileAncestryTreeController', ['$scope', 'scaleService', function ($scope, scaleService) {
        var vm = this;
        vm.source = $scope.source;

        $scope.$watchCollection('vm.source', function() {
            draw();
        });

        function formatFileName(filename) {
            var maxlen = 25;
            var newfname = filename;
            if (filename.length > 30) {
                var ext = filename.substring(filename.lastIndexOf('.')+1);
                var firstpartLen = maxlen - ext.length;
                newfname = filename.substring(0,firstpartLen-1) + '...' + ext;
            }
            return newfname;
        }

        function getNodeHtml(file) {
            var iconHtml = scaleService.getMediaTypeHtml(file.media_type);
            var fname = formatFileName(file.file_name);
            var html = "<div class='graph'>";
            html += "<span class='name' title='" + file.file_name + "'>";
            html += "<a ng-show='" + file.url + "' href='" + file.url + "' target='_jobfile'>" + iconHtml + " " + fname + "</a>";
            html += "</span>";
            html += "</div>";

            return html;
        }

        function getJobNodeHtml(jobtype, jobid) {
            var html = "<div>";
            html += "<span class='status'></span><span class='job-name'><a href='#/jobs/job/" + jobid + "'>" + jobtype.name + "</a></span>";
            html += "</div>";

            return html;
        }

        function draw() {
            if (vm.source && vm.source !== undefined) {
                var svg = d3.select('svg');
                var inner = svg.select('g');

                // Set up zoom support
                var zoom = d3.behavior.zoom()
                    .on('zoom', function() {
                        inner.attr('transform', 'translate(' + d3.event.translate + ')' +
                            'scale(' + d3.event.scale + ')');
                });
                svg.call(zoom);

                var render = new dagreD3.render();
                // Left-to-right layout
                var g = new dagreD3.graphlib.Graph({multigraph: true});
                g.setGraph({
                    nodesep: 30,
                    ranksep: 70,
                    rankdir: 'LR',
                    marginx: 20,
                    marginy: 0
                });

                //Starting node
                var html = getNodeHtml(vm.source);
                g.setNode('file-' + vm.source.id, {
                    labelType: 'html',
                    label: html,
                    rx: 10,
                    ry: 10,
                    padding: 10,
                    width: 250,
                    height: 20
                });

                // Products
                for (var id in vm.source.products) {
                    var prod = vm.source.products[id];
                    var jobNodeHtml = getJobNodeHtml(prod.job_type, prod.job.id);
                    // Add node for the job
                    g.setNode('job-' + prod.job.id, {
                        labelType: 'html',
                        label: jobNodeHtml,
                        rx: 10,
                        ry: 10,
                        padding: 10,
                        width: 200,
                        height: 20
                    });
                    g.setEdge('file-'+vm.source.id, 'job-'+prod.job.id, {
                        //labelType: 'html',
                        //label: '<a href='#/jobs/job/' + prod.job.id + ''>' + prod.job_type.name + '</a>'
                        //width: 40
                    });


                    var html = getNodeHtml(prod);
                    g.setNode('file-' + prod.id, {
                        labelType: 'html',
                        label: html,
                        rx: 10,
                        ry: 10,
                        padding: 10,
                        width: 250,
                        height: 20
                    });
                    g.setEdge('job-'+prod.job.id, 'file-'+prod.id, {
                        //labelType: 'html',
                        //label: '<a href='#/jobs/job/' + prod.job.id + ''>' + prod.job_type.name + '</a>'
                        //width: 40
                    });

                }

                // Run the renderer. This is what draws the final graph.
                render(inner, g);

                // Center the graph
                var vbx = svg.attr('viewBox').split(' ');
                var gwidth = g.graph().width;
                var gheight = g.graph().height;
                var ratio = gheight/gwidth;

                console.log(gheight);
                console.log(vbx[3]);

                // If graph is shorter than container, shrink the container height
                if ( gheight < vbx[3] ) {
                    svg.attr('viewBox', vbx[0] + ' ' + vbx[1] + ' ' + vbx[2] + ' ' + gheight*1.1);
                }

                // Scale graph based on width or height based on which exceeds
                // viewbox by most pixels
                var initialScale = Math.min((vbx[2]*0.95)/gwidth,(vbx[3]*0.95)/gheight);
                zoom
                    .translate([(vbx[2]*0.02), (vbx[3]*0.02)])
                    .scale(initialScale)
                    .event(svg);

                // set appropriate class for job nodes
                $('.job-name').closest('.node').children('rect').attr('class', 'job'); //.addClass('job');
            }

        }



    }]).directive('scaleFileAncestryTree', function () {
        'use strict';
        /**
         * Usage: <scale-file-ancestry-tree source='source' />
         */
        return {
            controller: 'scaleFileAncestryTreeController',
            templateUrl: 'modules/feed/directives/fileAncestryTreeTemplate.html',
            restrict: 'E',
            scope: {
                source: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('feedDetailsController', ['$scope', '$location', 'scaleConfig', 'navService', 'subnavService', 'feedService', 'moment', function ($scope, $location, scaleConfig, navService, subnavService, feedService, moment) {
        var vm = this;
        
        vm.loading = true;
        vm.feedData = {};
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.useIngestTime = 'false';
        vm.filterValue = 1;
        vm.filterDuration = 'w';

        vm.changeFeedSelection = function (){
            setFeedUrl();
            //getFeed();
        };

        vm.changeIngestTimeSelection = function (){
            setFeedUrl();
            getFeed();
        };

        var getFeedParams = function (){
            var params = {};
            var strikeId = vm.selectedFeed ? vm.selectedFeed.strike.id : null;
            var useIngestTime = vm.useIngestTime ? vm.useIngestTime : null;

            params.started = moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toISOString();
            params.ended = moment.utc(params.started).add(1, vm.filterDuration).endOf('d').toISOString();

            if (strikeId != $location.search().strike_id) {
                params.strike_id = strikeId;
            } else if ($location.search().strike_id) {
                params.strike_id = $location.search().strike_id;
            }

            if (useIngestTime != $location.search().use_ingest_time) {
               params.use_ingest_time = useIngestTime;
            } else if ($location.search().use_ingest_time) {
               console.log('getFeedParams use_ingest_time: ' + $location.search().use_ingest_time);
               params.use_ingest_time = $location.search().use_ingest_time;
            }

            return params;
        };

        var getFeed = function () {
            vm.loading = true;
            if ($location.search().use_ingest_time) {
                vm.useIngestTime = $location.search().use_ingest_time;
            }
            var feedParams = getFeedParams();
            $location.search(feedParams);
            feedService.getFeed(feedParams).then(function (data) {
                vm.allFeeds = _.sortByOrder(data.results, ['strike.name'], ['asc']);
                var strikeId = $location.search().strike_id;
                if(strikeId){
                    // set selectedFeed = new feed
                    var feed = _.find(vm.allFeeds, function (feed){
                        return feed.strike.id == strikeId;
                    });
                    vm.selectedFeed = feed ? feed : null;
                } else {
                    vm.selectedFeed = vm.allFeeds[0];
                    setFeedUrl();
                }
            }).finally(function (){
                vm.loading = false;
            });
        };

        vm.updateFeedRange = function (action) {
            if (action === 'older') {
                vm.filterValue++;
            } else if (action === 'newer') {
                if (vm.filterValue > 1) {
                    vm.filterValue--;
                }
            } else if (action === 'today') {
                vm.filterValue = 1;
            }
            getFeed();
        };

        var setFeedUrl = function (){
            // set param in URL
            var params = getFeedParams();
            $location.search(params);
        };

        var initialize = function () {
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed');
            getFeed();
        };

        initialize();

        $scope.$watch('vm.filterValue', function (value) {
            var $feedNewer = $('.feed-newer'),
                $feedToday = $('.feed-today');

            if (value > 1) {
                $feedNewer.removeAttr('disabled');
                $feedToday.removeAttr('disabled');
            } else {
                $feedNewer.attr('disabled', 'disabled');
                $feedToday.attr('disabled', 'disabled');
            }
        });
    }]);
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').controller('ingestRecordDetailsController', ['$scope', '$routeParams', 'scaleConfig', 'scaleService', 'navService', 'subnavService', 'feedService', function ($scope, $routeParams, scaleConfig, scaleService, navService, subnavService, feedService) {
        var vm = this;
        
        vm.loading = false;
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.scaleService = scaleService;
        vm.moment = moment;
        vm.ingestRecord = null;

        var getIngestRecordDetails = function () {
            vm.loading = true;
            feedService.getSourceDetails($routeParams.id).then(function (data) {
                vm.ingestRecord = data;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed/ingests');
            getIngestRecordDetails();
        };

        vm.calculateFileSize = function (size) {
            return scaleService.calculateFileSizeFromBytes(size);
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('ingestRecordsController', ['$scope', '$location', '$timeout', 'scaleConfig', 'scaleService', 'stateService', 'feedService', 'strikeService', 'navService', 'subnavService', 'gridFactory', 'poller', function ($scope, $location, $timeout, scaleConfig, scaleService, stateService, feedService, strikeService, navService, subnavService, gridFactory, poller) {
        subnavService.setCurrentPath('feed/ingests');

        var vm = this;

        vm.ingestsParams = stateService.getIngestsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.ingestStatusValues = scaleConfig.ingestStatus;
        vm.selectedIngestStatus = vm.ingestsParams.status || vm.ingestStatusValues[0];
        vm.lastModifiedStart = moment.utc(vm.ingestsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.ingestsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.ingestData = [];
        vm.strikeData = [];
        vm.selectedStrike = {};
        vm.searchText = vm.ingestsParams.file_name || '';
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.data = [];

        $timeout(function () {
            vm.gridOptions.paginationCurrentPage = vm.ingestsParams.page || 1;
            vm.gridOptions.paginationPageSize = vm.ingestsParams.page_size || vm.gridOptions.paginationPageSize;
        });

        vm.refreshData = function () {
            var filteredData = _.filter(vm.ingestData, function (d) {
                return d.file_name.toLowerCase().includes(vm.searchText.toLowerCase());
            });
            vm.gridOptions.data = filteredData.length > 0 ? filteredData : vm.gridOptions.data;
        };

        var filteredByStatus = vm.ingestsParams.status ? true : false,
            filteredByStrike = vm.ingestsParams.strike_id ? true : false,
            filteredByOrder = vm.ingestsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'file_name',
                displayName: 'File Name',
                //filterHeaderTemplate: '<div class="ui-grid-filter-container"><input ng-model="grid.appScope.vm.searchText" ng-change="grid.appScope.vm.refreshData()" class="form-control" placeholder="Search"></div>'
                enableFiltering: false
            },
            {
                field: 'file_size',
                displayName: 'File Size',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.file_size_formatted }}</div>'
            },
            {
                field: 'strike.title',
                displayName: 'Strike Process',
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.strike.title }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedStrike" ng-options="strike as strike.title.toUpperCase() for strike in grid.appScope.vm.strikeData"></select></div>'
            },
            {
                field: 'status',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedIngestStatus" ng-options="status.toUpperCase() for status in grid.appScope.vm.ingestStatusValues"></select></div>'
            },
            {
                field: 'transfer_started',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.transfer_started_formatted }}</div>'
            },
            {
                field: 'transfer_ended',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.transfer_ended_formatted }}</div>'
            },
            {
                field: 'ingest_started',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.ingest_started_formatted }}</div>'
            },
            {
                field: 'ingest_ended',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.ingest_ended_formatted }}</div>'
            }
        ];

        vm.getIngests = function () {
            vm.loading = true;
            feedService.getIngestsOnce(vm.ingestsParams).then(function (data) {
                vm.ingestData = data.results;
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.filterResults = function () {
            poller.stopAll();
            stateService.setIngestsParams(vm.ingestsParams);
            vm.getIngests();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.ingestsParams);
        };

        vm.updateIngestOrder = function (sortArr) {
            vm.ingestsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateIngestStatus = function (value) {
            if (value != vm.ingestsParams.status) {
                vm.ingestsParams.page = 1;
            }
            vm.ingestsParams.status = value === 'VIEW ALL' ? null : value;
            vm.ingestsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateIngestStrike = function (value) {
            if (value.title) {
                if (value.id !== vm.ingestsParams.strike_id) {
                    vm.ingestsParams.page = 1;
                }
                vm.ingestsParams.strike_id = value.title === 'VIEW ALL' ? null : value.id;
                vm.ingestsParams.page_size = vm.gridOptions.paginationPageSize;
                if (!vm.loading) {
                    vm.filterResults();
                }
            }
        };

        vm.getStrikes = function () {
            strikeService.getStrikes().then(function (data) {
                var strikeViewAll = {
                    id: 0,
                    name: 'viewall',
                    title: 'VIEW ALL'
                };
                vm.strikeData = data;
                vm.strikeData.unshift(strikeViewAll);
                vm.selectedStrike = _.find(vm.strikeData, { id: vm.ingestsParams.strike_id }) || data[0];
                vm.getIngests();
            });
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.ingestsParams.page = currentPage;
                vm.ingestsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if(row.entity.source_file && row.entity.source_file.id){
                    $location.path('/feed/ingests/' + row.entity.source_file.id).search('');
                } else {
                    toastr["info"]('Source file is undefined for ' + row.entity.file_name);
                }

            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setIngestsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateIngestOrder(sortArr);
            });
        };

        vm.filterByFilename = function (keyEvent) {
            if (!keyEvent || (keyEvent && keyEvent.which === 13)) {
                vm.ingestsParams.file_name = vm.searchText;
                vm.filterResults();
            }
        };

        vm.initialize = function () {
            stateService.setIngestsParams(vm.ingestsParams);
            vm.updateColDefs();
            vm.getStrikes();
            navService.updateLocation('feed');
        };

        vm.initialize();

        $scope.$watch('vm.selectedIngestStatus', function (value) {
            if (vm.loading) {
                if (filteredByStatus) {
                    vm.updateIngestStatus(value);
                }
            } else {
                filteredByStatus = value !== 'VIEW ALL';
                vm.updateIngestStatus(value);
            }
        });

        $scope.$watch('vm.selectedStrike', function (value) {
            if (vm.loading) {
                if (filteredByStrike) {
                    vm.updateIngestStrike(value);
                }
            } else {
                filteredByStrike = value.title !== 'VIEW ALL';
                vm.updateIngestStrike(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.ingestsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.ingestsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getIngestsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getIngestsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.ingestsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('scanDetailsController', ['$scope', '$route', '$location', '$routeParams', 'Scan', 'ScanIngestFile', 'scaleConfig', 'navService', 'subnavService', 'scanService', 'workspacesService', 'scaleService', 'stateService', 'userService', 'toastr', function ($scope, $route, $location, $routeParams, Scan, ScanIngestFile, scaleConfig, navService, subnavService, scanService, workspacesService, scaleService, stateService, userService, toastr) {
        var vm = this,
            currScan = {};

        vm.loading = true;
        vm.scaleConfig = scaleConfig;
        vm.workspaces = [];
        vm.newWorkspaces = [];
        vm.activeWorkspace = {};
        vm.localScans = [];
        vm.activeScan = new Scan();
        vm.activeScanIngestFile = new ScanIngestFile();
        vm.dataType = '';
        vm.availableWorkspaceTypes = _.cloneDeep(scaleConfig.workspaceTypes);
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.saveBtnClass = 'btn-default';
        vm.mode = 'view';
        vm.user = userService.getUserCreds();
        vm.readonly = !(vm.user && vm.user.is_admin);
        vm.JSON = JSON;

        vm.cancelCreate = function () {
            vm.mode = 'view';
            // revert any changes to the scan
            vm.activeScan = Scan.transformer(_.cloneDeep(currScan));
            if ($routeParams.id === '0') {
                $location.path('/feed/scans');
            }
        };

        vm.editScan = function () {
            // store a reference of the scan as it currently exists in case the user cancels the edit
            currScan = Scan.transformer(_.cloneDeep(vm.activeScan));
            vm.mode = 'edit';
        };

        vm.saveScan = function () {
            scanService.saveScan(vm.activeScan).then(function (scan) {
                vm.activeScan = Scan.transformer(scan);
                // only store the new workspace name, not the entire object
                _.forEach(vm.activeScan.configuration.files_to_ingest, function (file) {
                    if (file.new_workspace) {
                        file.new_workspace = file.new_workspace.name;
                    }
                });
                if (scaleConfig.static) {
                    localStorage.setItem('scan' + vm.activeScan.id, JSON.stringify(vm.activeScan));
                }
                if ($routeParams.id === '0') {
                    $location.path('/feed/scans/' + vm.activeScan.id);
                } else {
                    $route.reload();
                }
            }).catch(function () {

            });
        };

        vm.clearLocalScans = function () {
            _.forEach(vm.localScans, function (scan) {
                localStorage.removeItem('scan' + scan.id);
            });
            $location.path('/feed/scans');
        };

        vm.newScan = function () {
            vm.mode = 'add';
            vm.loadScan(0);
        };

        vm.loadScan = function (id) {
            $location.path('feed/scans/' + id);
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateScan = function () {
            vm.loading = true;
            scanService.validateScan(vm.activeScan).then(function (data) {
                if (data.warnings && data.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(data.warnings);
                    toastr['error'](warningsHtml);
                } else {
                    toastr['success']('Scan is valid.');
                }
            }).catch(function (error) {
                if (error && error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error']('Error validating scan');
                }
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.disableSaveBtn = function (invalid) {
            var returnVal = !(!invalid && vm.activeScan.configuration.files_to_ingest.length > 0);
            vm.saveBtnClass = returnVal ? 'btn-default' : 'btn-success';
            return returnVal;
        };

        vm.addScanIngestFile = function () {
            if (_.keys(vm.activeScanIngestFile).length > 0) {
                vm.activeScan.configuration.files_to_ingest.push(ScanIngestFile.transformer(vm.activeScanIngestFile));
                vm.activeScanIngestFile = new ScanIngestFile();
            }
        };

        vm.deleteScanIngestFile = function (file) {
            _.remove(vm.activeScan.configuration.files_to_ingest, function (f) {
                return angular.equals(f, file);
            });
        };

        vm.addDataType = function () {
            if (vm.dataType) {
                vm.activeScanIngestFile.data_types.push(vm.dataType);
                vm.dataType = '';
            }
        };

        vm.removeDataType = function (dataType) {
            _.remove(vm.activeScanIngestFile.data_types, function (d) {
                return d === dataType;
            });
        };

        vm.updateWorkspace = function () {
            if (vm.activeScan) {
                var workspaceObj = _.find(vm.workspaces, {name: vm.activeScan.configuration.workspace});
                if (workspaceObj) {
                    vm.newWorkspaces = _.cloneDeep(vm.workspaces);
                    _.remove(vm.newWorkspaces, workspaceObj);
                    getWorkspaceDetails(workspaceObj.id);
                }
            }
        };

        vm.formatJSON = function (file) {
            file = _.omit(file, '$$hashKey');
            if (file.new_workspace) {
                file.new_workspace = file.new_workspace.name;
            }
            var jsonStr = JSON.stringify(file, null, 4);
            return jsonStr.replace(/\\\\/g, '\\');
        };

        var getWorkspaceDetails = function (id) {
            vm.loading = true;
            workspacesService.getWorkspaceDetails(id).then(function (data) {
                vm.activeWorkspace = data;
                if (vm.activeWorkspace.json_config.broker.type === 'host') {
                    vm.activeScan.configuration.scanner.type = 'dir';
                } else if (vm.activeWorkspace.json_config.broker.type === 's3') {
                    vm.activeScan.configuration.scanner.type = 's3';
                } else {
                    vm.activeScan.configuration.scanner.type = null;
                }
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var getWorkspaces = function () {
            workspacesService.getWorkspaces().then(function (data) {
                vm.workspaces = data;
                vm.newWorkspaces = data;
                vm.updateWorkspace();
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            getWorkspaces();
            vm.activeScan = null;
            vm.mode = 'view';

            if ($routeParams.id) {
                var id = parseInt($routeParams.id);
                if (id === 0) {
                    vm.mode = 'add';
                    vm.activeScan = new Scan();
                } else {
                    scanService.getScanDetails(id).then(function (data) {
                        vm.activeScan = Scan.transformer(data);
                    });
                }
            }
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed/scans');
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('scansController', ['$scope', '$location', '$timeout', 'scaleConfig', 'scaleService', 'stateService', 'scanService', 'Scan', 'navService', 'subnavService', 'gridFactory', function ($scope, $location, $timeout, scaleConfig, scaleService, stateService, scanService, Scan, navService, subnavService, gridFactory) {
        subnavService.setCurrentPath('feed/scans');

        var vm = this;

        vm.scansParams = stateService.getScansParams();
        vm.stateService = stateService;
        vm.loading = true;
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.lastModifiedStart = moment.utc(vm.scansParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.scansParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.scanData = [];
        vm.searchText = vm.scansParams.name || '';
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.data = [];
        vm.sortableOptions = {
            handle: '.sortable-handle'
        };

        $timeout(function () {
            vm.gridOptions.paginationCurrentPage = vm.scansParams.page || 1;
            vm.gridOptions.paginationPageSize = vm.scansParams.page_size || vm.gridOptions.paginationPageSize;
        });

        vm.refreshData = function () {
            var filteredData = _.filter(vm.scanData, function (d) {
                return d.name.toLowerCase().includes(vm.searchText.toLowerCase());
            });
            vm.gridOptions.data = filteredData.length > 0 ? filteredData : vm.gridOptions.data;
        };

        var filteredByOrder = vm.scansParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'name',
                displayName: 'Name',
                //filterHeaderTemplate: '<div class="ui-grid-filter-container"><input ng-model="grid.appScope.vm.searchText" ng-change="grid.appScope.vm.refreshData()" class="form-control" placeholder="Search"></div>'
                enableFiltering: false
            },
            {
                field: 'file_count',
                displayName: 'File Count',
                enableFiltering: false
            },
            {
                field: 'job',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.job.job_type.title }}</div>'
            },
            {
                field: 'created',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            }
        ];

        vm.getScans = function () {
            vm.loading = true;
            scanService.getScans(vm.scansParams).then(function (data) {
                vm.scanData = Scan.transformer(data.results);
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.data = vm.scanData = Scan.transformer(data.results);;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.filterResults = function () {
            stateService.setScansParams(vm.scansParams);
            vm.getScans();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.scansParams);
        };

        vm.updateScanOrder = function (sortArr) {
            vm.scansParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.scansParams.page = currentPage;
                vm.scansParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                $location.path('/feed/scans/' + row.entity.id).search('');

            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setScansColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateScanOrder(sortArr);
            });
        };

        vm.filterByName = function (keyEvent) {
            if (!keyEvent || (keyEvent && keyEvent.which === 13)) {
                vm.scansParams.name = vm.searchText;
                vm.filterResults();
            }
        };

        vm.initialize = function () {
            vm.getScans();
            stateService.setScansParams(vm.scansParams);
            vm.updateColDefs();
            navService.updateLocation('feed');
        };

        vm.initialize();

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.scansParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.scansParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getScansColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getScansParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.scansParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('strikesController', ['$scope', '$route', '$location', '$routeParams', 'Strike', 'StrikeIngestFile', 'scaleConfig', 'navService', 'subnavService', 'strikeService', 'workspacesService', 'scaleService', 'stateService', 'userService', 'toastr', function ($scope, $route, $location, $routeParams, Strike, StrikeIngestFile, scaleConfig, navService, subnavService, strikeService, workspacesService, scaleService, stateService, userService, toastr) {
        var vm = this,
            currStrike = {};

        vm.loading = true;
        vm.scaleConfig = scaleConfig;
        vm.strikes = [];
        vm.workspaces = [];
        vm.newWorkspaces = [];
        vm.activeWorkspace = {};
        vm.localStrikes = [];
        vm.activeStrike = new Strike();
        vm.activeStrikeIngestFile = new StrikeIngestFile();
        vm.dataType = '';
        vm.availableWorkspaceTypes = _.cloneDeep(scaleConfig.workspaceTypes);
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.saveBtnClass = 'btn-default';
        vm.mode = 'view';
        vm.user = userService.getUserCreds();
        vm.readonly = !(vm.user && vm.user.is_admin);
        vm.JSON = JSON;
        vm.sortableOptions = {
            handle: '.sortable-handle'
        };

        vm.cancelCreate = function () {
            vm.mode = 'view';
            // revert any changes to the strike
            vm.activeStrike = Strike.transformer(_.cloneDeep(currStrike));
            if ($routeParams.id === '0') {
                $location.path('/feed/strikes');
            }
        };

        vm.editStrike = function () {
            // store a reference of the strike as it currently exists in case the user cancels the edit
            currStrike = Strike.transformer(_.cloneDeep(vm.activeStrike));
            vm.mode = 'edit';
        };

        vm.saveStrike = function () {
            strikeService.saveStrike(vm.activeStrike).then(function (strike) {
                vm.activeStrike = Strike.transformer(strike);
                // only store the new workspace name, not the entire object
                _.forEach(vm.activeStrike.configuration.files_to_ingest, function (file) {
                    if (file.new_workspace) {
                        file.new_workspace = file.new_workspace.name;
                    }
                });
                if (scaleConfig.static) {
                    localStorage.setItem('strike' + vm.activeStrike.id, JSON.stringify(vm.activeStrike));
                }
                $route.reload();
            }).catch(function () {

            });
        };

        vm.clearLocalStrikes = function () {
            _.forEach(vm.localStrikes, function (strike) {
                localStorage.removeItem('strike' + strike.id);
            });
            $location.path('/feed/strikes');
        };

        vm.newStrike = function () {
            vm.mode = 'add';
            vm.loadStrike(0);
        };

        vm.loadStrike = function (id) {
            $location.path('feed/strikes/' + id);
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateStrike = function () {
            vm.loading = true;
            strikeService.validateStrike(vm.activeStrike).then(function (data) {
                if (data.warnings && data.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(data.warnings);
                    toastr['error'](warningsHtml);
                } else {
                    toastr['success']('Strike is valid.');
                }
            }).catch(function (error) {
                if (error && error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error']('Error validating strike');
                }
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.disableSaveBtn = function (invalid) {
            var returnVal = !(!invalid && vm.activeStrike.configuration.files_to_ingest.length > 0);
            vm.saveBtnClass = returnVal ? 'btn-default' : 'btn-success';
            return returnVal;
        };

        vm.addStrikeIngestFile = function () {
            if (_.keys(vm.activeStrikeIngestFile).length > 0) {
                vm.activeStrike.configuration.files_to_ingest.push(StrikeIngestFile.transformer(vm.activeStrikeIngestFile));
                vm.activeStrikeIngestFile = new StrikeIngestFile();
            }
        };

        vm.deleteStrikeIngestFile = function (file) {
            _.remove(vm.activeStrike.configuration.files_to_ingest, function (f) {
                return angular.equals(f, file);
            });
        };

        vm.addDataType = function () {
            if (vm.dataType) {
                vm.activeStrikeIngestFile.data_types.push(vm.dataType);
                vm.dataType = '';
            }
        };

        vm.removeDataType = function (dataType) {
            _.remove(vm.activeStrikeIngestFile.data_types, function (d) {
                return d === dataType;
            });
        };

        vm.updateWorkspace = function () {
            if (vm.activeStrike) {
                var workspaceObj = _.find(vm.workspaces, {name: vm.activeStrike.configuration.workspace});
                if (workspaceObj) {
                    vm.newWorkspaces = _.cloneDeep(vm.workspaces);
                    _.remove(vm.newWorkspaces, workspaceObj);
                    getWorkspaceDetails(workspaceObj.id);
                }
            }
        };

        vm.formatJSON = function (file) {
            file = _.omit(file, '$$hashKey');
            if (file.new_workspace) {
                file.new_workspace = file.new_workspace.name;
            }
            return JSON.stringify(file, null, 4);
        };

        var getWorkspaceDetails = function (id) {
            vm.loading = true;
            workspacesService.getWorkspaceDetails(id).then(function (data) {
                vm.activeWorkspace = data;
                if (vm.activeWorkspace.json_config.broker.type === 'host') {
                    vm.activeStrike.configuration.monitor.type = 'dir-watcher';
                } else if (vm.activeWorkspace.json_config.broker.type === 's3') {
                    vm.activeStrike.configuration.monitor.type = 's3';
                } else {
                    vm.activeStrike.configuration.monitor.type = null;
                }
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var getWorkspaces = function () {
            workspacesService.getWorkspaces().then(function (data) {
                vm.workspaces = data;
                vm.newWorkspaces = data;
                vm.updateWorkspace();
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var getStrikes = function () {
            vm.loading = true;
            strikeService.getStrikes().then(function (data) {
                if (scaleConfig.static) {
                    var i = 0,
                        oJson = {},
                        sKey;
                    for (; sKey = localStorage.key(i); i++) {
                        oJson[sKey] = localStorage.getItem(sKey);
                    }
                    _.filter(_.pairs(oJson), function (o) {
                        if (_.contains(o[0], 'strike')) {
                            var type = JSON.parse(o[1]);
                            vm.localStrikes.push(type);
                            data.push(type);
                        }
                    });
                }
                vm.strikes = data;
                getWorkspaces();
            }).catch(function (error) {
                console.log(error);
                vm.loading = false;
            });
        };

        var initialize = function () {
            getStrikes();
            vm.activeStrike = null;
            vm.mode = 'view';

            if ($routeParams.id) {
                var id = parseInt($routeParams.id);
                if (id === 0) {
                    vm.mode = 'add';
                    vm.activeStrike = new Strike();
                } else {
                    strikeService.getStrikeDetails(id).then(function (data) {
                        vm.activeStrike = Strike.transformer(data);
                    });
                }
            }
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed/strikes');
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset + 60;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Feed', ['scaleConfig', function (scaleConfig) {
        var Feed = function (value, status) {
            this.value = value;
            this.status = status;
        };

        // public methods
        Feed.prototype = {
            toString: function () {
                return 'Feed';
            },
            getCellText: function () {
                return this.value;
            },
            getCellTitle: function () {
                return '';
            }
        };

        // static methods, assigned to class
        Feed.build = function (data) {
            if (data) {
                return new Feed(
                    data.value,
                    data.status
                );
            }
            return new Feed();
        };

        Feed.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Feed.build)
                    .filter(Boolean);
            }
            return Feed.build(data);
        };

        return Feed;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('FeedStatus', ['scaleConfig', function (scaleConfig) {
        var FeedStatus = function (status) {
            this.status = status;
        };

        // public methods
        FeedStatus.prototype = {
            toString: function () {
                return 'FeedStatus';
            },
            getCellFill: function () {
                return scaleConfig.colors.chart_green;
            },
            getCellActivity: function () {
                return '';
            },
            getCellActivityTotal: function () {
                return '';
            },
            getCellError: function () {
                return '';
            },
            getCellTotal: function () {
                return '';
            }
        };

        // static methods, assigned to class
        FeedStatus.build = function (data) {
            if (data) {
                return new FeedStatus(
                    data.status
                );
            }
            return new FeedStatus();
        };

        FeedStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(FeedStatus.build)
                    .filter(Boolean);
            }
            return FeedStatus.build(data);
        };

        return FeedStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Ingest', ['scaleConfig', 'scaleService', function (scaleConfig, scaleService) {
        var Ingest = function (id, file_name, strike, status, bytes_transferred, transfer_started, transfer_ended, media_type, file_size, data_type, ingest_started, ingest_ended, source_file, created, last_modified) {
            this.id = id;
            this.file_name = file_name;
            this.strike = strike;
            this.status = status;
            this.bytes_transferred = bytes_transferred;
            this.transfer_started = transfer_started;
            this.transfer_started_formatted = moment.utc(transfer_started).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.transfer_ended = transfer_ended;
            this.transfer_ended_formatted = moment.utc(transfer_ended).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.media_type = media_type;
            this.file_size = file_size;
            this.file_size_formatted = scaleService.calculateFileSizeFromBytes(file_size);
            this.data_type = data_type;
            this.ingest_started = ingest_started;
            this.ingest_started_formatted = ingest_started ? moment.utc(ingest_started).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.ingest_ended = ingest_ended;
            this.ingest_ended_formatted = ingest_ended ? moment.utc(ingest_ended).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.source_file = source_file;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
        };

        // public methods
        Ingest.prototype = {
            
        };

        // static methods, assigned to class
        Ingest.build = function (data) {
            if (data) {
                return new Ingest(
                    data.id,
                    data.file_name,
                    data.strike,
                    data.status,
                    data.bytes_transferred,
                    data.transfer_started,
                    data.transfer_ended,
                    data.media_type,
                    data.file_size,
                    data.data_type,
                    data.ingest_started,
                    data.ingest_ended,
                    data.source_file,
                    data.created,
                    data.last_modified
                );
            }
            return new Ingest();
        };

        Ingest.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Ingest.build);
            }
            return Ingest.build(data);
        };

        return Ingest;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Scan', ['scaleConfig', 'Job', 'ScanConfiguration', function (scaleConfig, Job, ScanConfiguration) {
        var Scan = function (id, name, title, description, file_count, job, dry_run_job, created, last_modified, configuration) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.file_count = file_count;
            this.job = Job.transformer(job);
            this.dry_run_job = Job.transformer(dry_run_job);
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc);
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc);
            this.configuration = ScanConfiguration.transformer(configuration);
        };

        Scan.prototype = {
            clean: function () {
                var returnObj = {
                    name: this.name,
                    title: this.title,
                    description: this.description,
                    configuration: this.configuration
                };
                if (returnObj.configuration && returnObj.configuration.scanner.type === 's3') {
                    delete returnObj.configuration.scanner.transfer_suffix;
                }
                if (returnObj.configuration.files_to_ingest) {
                    _.forEach(returnObj.configuration.files_to_ingest, function (f) {
                        delete f.$$hashKey;
                    });
                }
                // remove empty/null/undefined values from returnObj
                return _.pick(returnObj, _.identity);
            }
        };

        // static methods, assigned to class
        Scan.build = function (data) {
            if (data) {
                return new Scan(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.file_count,
                    data.job,
                    data.dry_run_job,
                    data.created,
                    data.last_modified,
                    data.configuration
                );
            }
            return new Scan();
        };

        Scan.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(Scan.build);
            }
            return Scan.build(data);
        };

        return Scan;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('ScanConfiguration', ['scaleConfig', 'ScanIngestFile', function (scaleConfig, ScanIngestFile) {
        var ScanConfiguration = function (version, workspace, scanner, files_to_ingest) {
            this.version = scaleConfig.scanConfigurationVersion;
            this.workspace = workspace;
            this.scanner = scanner ? scanner : {
                type: '',
                transfer_suffix: ''
            };
            this.files_to_ingest = files_to_ingest ? ScanIngestFile.transformer(files_to_ingest) : [];
        };

        ScanConfiguration.prototype = {

        };

        // static methods, assigned to class
        ScanConfiguration.build = function (data) {
            if (data) {
                return new ScanConfiguration(
                    data.version,
                    data.workspace,
                    data.scanner,
                    data.files_to_ingest
                );
            }
            return new ScanConfiguration();
        };

        ScanConfiguration.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(ScanConfiguration.build);
            }
            return ScanConfiguration.build(data);
        };

        return ScanConfiguration;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('ScanIngestFile', function () {
        var ScanIngestFile = function (filename_regex, data_types, new_workspace, new_file_path) {
            this.filename_regex = filename_regex;
            this.data_types = data_types || [];
            this.new_workspace = new_workspace || '';
            this.new_file_path = new_file_path || '';
        };

        ScanIngestFile.prototype = {

        };

        // static methods, assigned to class
        ScanIngestFile.build = function (data) {
            if (data) {
                var returnObj = new ScanIngestFile(
                    data.filename_regex,
                    data.data_types,
                    data.new_workspace,
                    data.new_file_path
                );
                if (data.data_types && data.data_types.length === 0) {
                    delete returnObj.data_types;
                }
                // remove empty/null/undefined values from returnObj
                return _.pick(returnObj, _.identity);
            }
            return new ScanIngestFile();
        };

        ScanIngestFile.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(ScanIngestFile.build);
            }
            return ScanIngestFile.build(data);
        };

        return ScanIngestFile;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Strike', ['scaleConfig', 'Job', 'StrikeConfiguration', function (scaleConfig, Job, StrikeConfiguration) {
        var Strike = function (id, name, title, description, job, created, last_modified, configuration) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.job = Job.transformer(job);
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc);
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc);
            this.configuration = StrikeConfiguration.transformer(configuration);
        };

        Strike.prototype = {
            clean: function () {
                return {
                    name: this.name,
                    title: this.title,
                    description: this.description,
                    configuration: this.configuration
                };
            }
        };

        // static methods, assigned to class
        Strike.build = function (data) {
            if (data) {
                return new Strike(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.job,
                    data.created,
                    data.last_modified,
                    data.configuration
                );
            }
            return new Strike();
        };

        Strike.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(Strike.build);
            }
            return Strike.build(data);
        };

        return Strike;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('StrikeConfiguration', ['scaleConfig', 'StrikeIngestFile', function (scaleConfig, StrikeIngestFile) {
        var StrikeConfiguration = function (version, workspace, monitor, files_to_ingest) {
            this.version = scaleConfig.strikeConfigurationVersion;
            this.workspace = workspace;
            this.monitor = monitor ? monitor : {
                type: '',
                region_name: '',
                credentials: {
                    access_key_id: '',
                    secret_access_key: ''
                }
            };
            this.files_to_ingest = files_to_ingest ? StrikeIngestFile.transformer(files_to_ingest) : [];
        };

        StrikeConfiguration.prototype = {

        };

        // static methods, assigned to class
        StrikeConfiguration.build = function (data) {
            if (data) {
                return new StrikeConfiguration(
                    data.version,
                    data.workspace,
                    data.monitor,
                    data.files_to_ingest
                );
            }
            return new StrikeConfiguration();
        };

        StrikeConfiguration.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(StrikeConfiguration.build);
            }
            return StrikeConfiguration.build(data);
        };

        return StrikeConfiguration;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('StrikeIngestFile', function () {
        var StrikeIngestFile = function (filename_regex, data_types, new_workspace, new_file_path) {
            this.filename_regex = filename_regex;
            this.data_types = data_types || [];
            this.new_workspace = new_workspace || '';
            this.new_file_path = new_file_path || '';
        };

        StrikeIngestFile.prototype = {

        };

        // static methods, assigned to class
        StrikeIngestFile.build = function (data) {
            if (data) {
                var returnObj = new StrikeIngestFile(
                    data.filename_regex,
                    data.data_types,
                    data.new_workspace,
                    data.new_file_path
                );
                if (data.data_types && data.data_types.length === 0) {
                    delete returnObj.data_types;
                }
                // remove empty/null/undefined values from returnObj
                return _.pick(returnObj, _.identity);
            }
            return new StrikeIngestFile();
        };

        StrikeIngestFile.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(StrikeIngestFile.build);
            }
            return StrikeIngestFile.build(data);
        };

        return StrikeIngestFile;
    });
})();

(function () {
    'use strict';
    angular.module('scaleApp').service('feedService', ['$location', '$timeout', '$q', '$http', 'scaleConfig', 'Ingest', function ($location, $timeout, $q, $http, scaleConfig, Ingest) {

        var getFeedParams = function (params) {
            if(!params) { params = {}; }
            var p = {};
            p.page_size = 1000;
            p.started = params.started ? params.started : moment.utc().add(-7,'days').startOf('d').toDate();
            p.ended = params.ended ? params.ended : moment.utc().toDate();
            p.use_ingest_time = params.use_ingest_time ? params.use_ingest_time : null;
            return p;
        };

        var getIngestsParams = function (params) {
            return params;
        };

        var getSourceParams = function (page, page_size, started, ended, order, is_parsed, file_name) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended,
                order: order ? order : '-last_modified',
                is_parsed: is_parsed,
                file_name: file_name
            };
        };

        return {
            getFeed: function (params) {
                var d = $q.defer();
                var params = getFeedParams(params);
                $http({
                    url: scaleConfig.getUrlPrefix('ingests') + 'ingests/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getIngestsOnce: function (params) {
                var d = $q.defer();
                var params = getIngestsParams(params);
                $http({
                    url: scaleConfig.getUrlPrefix('ingests') + 'ingests/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Ingest.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getSources: function (params) {
                params = params || getSourceParams();
                var d = $q.defer();
                $http({
                    url: scaleConfig.getUrlPrefix('sources') + 'sources/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getSourceDetails: function (id) {
                var d = $q.defer();
                $http({
                    url: scaleConfig.getUrlPrefix('sources') + 'sources/' + id + '/',
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('scanService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        return {
            getScans: function (params) {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'scans/';

                $http({
                    url: url,
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getScanDetails: function (id) {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'scans/' + id + '/';

                $http({
                    url: url,
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;

            },
            validateScan: function (scan) {
                var d = $q.defer();
                var cleanScan = scan.clean();

                $http.post(scaleConfig.urls.apiPrefix + 'scans/validation/', cleanScan).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            saveScan: function (scan) {
                var d = $q.defer();

                if (!scan.id) {
                    $http.post(scaleConfig.urls.apiPrefix + 'scans/', scan).success(function (result) {
                        d.resolve(result);
                    }).error(function (error) {
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.urls.apiPrefix + 'scans/' + scan.id + '/', scan).success(function (result) {
                        scan = result;
                        d.resolve(scan);
                    }).error(function (error) {
                        d.reject(error);
                    });
                }

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('strikeService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        return {
            getStrikes: function () {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'strikes/';

                $http({
                    url: url,
                    method: 'GET',
                    params: { order: '-title' }
                }).success(function (data) {
                    d.resolve(data.results);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getStrikeDetails: function (id) {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'strikes/' + id + '/';

                $http({
                    url: url,
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;

            },
            validateStrike: function (strike) {
                var d = $q.defer();
                var cleanStrike = strike.clean();

                $http.post(scaleConfig.urls.apiPrefix + 'strikes/validation/', cleanStrike).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            saveStrike: function (strike) {
                var d = $q.defer();

                if (!strike.id) {
                    $http.post(scaleConfig.urls.apiPrefix + 'strikes/', strike.clean()).success(function (result) {
                        d.resolve(result);
                    }).error(function (error) {
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.urls.apiPrefix + 'strikes/' + strike.id + '/', strike.clean()).success(function (result) {
                        strike = result;
                        d.resolve(strike);
                    }).error(function (error) {
                        d.reject(error);
                    });
                }

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobDetailController', ['$scope', '$rootScope', '$location', '$routeParams', '$uibModal', 'stateService', 'navService', 'jobService', 'jobExecutionService', 'nodeService', 'loadService', 'scaleConfig', 'subnavService', 'userService', 'scaleService', 'toastr', function ($scope, $rootScope, $location, $routeParams, $uibModal, stateService, navService, jobService, jobExecutionService, nodeService, loadService, scaleConfig, subnavService, userService, scaleService, toastr) {
        var vm = this;
        
        vm.job = {};
        vm.jobId = $routeParams.id;
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs');
        vm.loadingJobDetail = false;
        vm.latestExecution = null;
        vm.executionLog = null;
        vm.executionDetails = null;
        vm.selectedExecutionDetailValues = null;
        vm.timeline = [];
        vm.readonly = true;
        vm.jobErrorCreated = '';
        vm.jobErrorLastModified = '';
        vm.lastStatusChange = '';
        vm.supersededStatus = '';
        vm.triggerOccurred = '';

        vm.showLog = function (execution) {
            jobExecutionService.getJobExecutionDetails(execution.id).then(function(result){
                vm.selectedExecutionLog = result;
            });

            var modalInstance = $uibModal.open({
                animation: true,
                templateUrl: 'showLog.html',
                scope: $scope,
                windowClass: 'log-modal-window'
            });

            modalInstance.result.then(function () {

            }, function () {
                _.forEach(stateService.getJobExecutionLogPoller(), function (poller) {
                    poller.stop();
                });
            });
        };

        vm.showExecutionDetails = function (executionId) {
            jobExecutionService.getJobExecutionDetails(executionId).then(function (data) {
                vm.selectedExecutionDetails = data;
                vm.selectedExecutionDetailValues = _.pairs(data);
                $uibModal.open({
                    animation: true,
                    templateUrl: 'showExecutionDetails.html',
                    scope: $scope,
                    size: 'lg'
                });
            }).catch(function (error) {
                console.log(error);
            });
        };

        vm.requeueJob = function (jobId) {
            vm.loading = true;
            loadService.requeueJobs({ job_ids: [jobId] }).then(function (data) {
                toastr['success']('Requeued Job');
                vm.job.status = data.job_status;
                getJobDetail(jobId);
            }).catch(function (error) {
                toastr['error']('Requeue request failed');
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.cancelJob = function (job) {
            vm.loading = true;
            vm.actionClicked = true;
            vm.loading = true;
            var originalStatus = job.status;
            job.status = 'CANCEL';
            jobService.updateJob(job.id, { status: 'CANCELED' }).then(function () {
                toastr['success']('Job Canceled');
                job.status = 'CANCELED';
            }).catch(function (error) {
                toastr['error'](error);
                console.log(error);
                job.status = originalStatus;
            }).finally(function () {
                vm.loading = false;
            });
        };
        
        vm.calculateFileSize = function (size) {
            return scaleService.calculateFileSizeFromBytes(size);
        };

        var getJobDetail = function (jobId) {
            vm.loadingJobDetail = true;
            jobService.getJobDetail(jobId).then(function (data) {
                vm.job = data;
                vm.timeline = calculateTimeline(data);
                vm.latestExecution = data.getLatestExecution();
                vm.jobErrorCreated = data.error ? moment.utc(data.error.created).toISOString() : '';
                vm.lastStatusChange = data.last_status_change ? moment.duration(moment.utc(data.last_status_change).diff(moment.utc())).humanize(true) : '';
                vm.supersededChange = data.superseded ? moment.duration(moment.utc(data.superseded).diff(moment.utc())).humanize(true) : '';
                vm.triggerOccurred = data.event.occurred ? moment.duration(moment.utc(data.event.occurred).diff(moment.utc())).humanize(true) : '';
                vm.inputs = data.inputs;
                vm.outputs = data.outputs;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loadingJobDetail = false;
            });
        };

        var calculateTimeline = function (job) {
            var tl = [];
            tl.push({ taskName: 'Created', started: job.created ? moment.utc(job.created).toDate() : job.created, ended: job.queued ? moment.utc(job.queued).toDate() : job.queued });
            tl.push({ taskName: 'Queued', started: job.queued ? moment.utc(job.queued).toDate() : job.queued, ended: job.started ? moment.utc(job.started).toDate() : job.started });
            tl.push({ taskName: 'Executed', started: job.started ? moment.utc(job.started).toDate() : job.started, ended: job.ended ? moment.utc(job.ended).toDate() : job.ended });

            return tl;
        };

        var initialize = function () {
            navService.updateLocation('jobs');
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            getJobDetail(vm.jobId);
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobExecutionDetailController', ['$scope', '$location', '$routeParams', 'navService', 'jobExecutionService', 'nodeService', 'scaleConfig', 'subnavService', function ($scope, $location, $routeParams, navService, jobExecutionService, nodeService, scaleConfig, subnavService) {
        var vm = this;
        
        vm.jobExecution = {};
        vm.jobExecutionId = $routeParams.id;
        vm.loading = true;
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/runs');

        var getJobExecutionDetail = function () {
            jobExecutionService.getJobExecutionDetail(id).then(function (data) {
                vm.jobExecution = data;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            getJobExecutionDetail($routeParams.id);
            navService.updateLocation('jobs');
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobExecutionsController', ['$scope', '$location', 'navService', 'stateService', 'gridFactory', 'userService', 'jobExecutionService', 'jobTypeService', 'uiGridConstants', 'scaleConfig', 'subnavService', function ($scope, $location, navService, stateService, gridFactory, userService, jobExecutionService, jobTypeService, uiGridConstants, scaleConfig, subnavService) {
        subnavService.setCurrentPath('jobs');

        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobExecutionsParams = stateService.getJobExecutionsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.readonly = true;
        vm.jobTypeValues = [jobTypeViewAll];
        vm.jobExecution = null;
        vm.selectedJobType = vm.jobExecutionsParams.job_type_id ? vm.jobExecutionsParams.job_type_id : jobTypeViewAll;
        vm.jobStatusValues = scaleConfig.jobStatus;
        vm.selectedJobStatus = vm.jobExecutionsParams.status || vm.jobStatusValues[0];
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        vm.actionClicked = false;
        vm.lastModifiedStart = moment.utc(vm.jobExecutionsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.jobExecutionsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.jobExecutionsParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.jobExecutionsParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByJobType = vm.jobExecutionsParams.job_type_id ? true : false,
            filteredByJobStatus = vm.jobExecutionsParams.status ? true : false,
            filteredByOrder = vm.jobExecutionsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'status',
                width: 150,
                cellTemplate: '<div class="ui-grid-cell-contents"><div class="pull-right"><button ng-show="((!grid.appScope.vm.readonly) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.vm.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job"><i class="fa fa-repeat"></i></button> <button ng-show="!grid.appScope.vm.readonly && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.vm.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job"><i class="fa fa-ban"></i></button></div> {{ row.entity.status }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobStatus"><option ng-selected="{{ grid.appScope.vm.jobStatusValues[$index] == grid.appScope.vm.selectedJobStatus }}" value="{{ grid.appScope.vm.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'id',
                displayName: 'Log',
                enableFiltering: false,
                sortable: false,
                width: 60,
                cellTemplate: '<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.vm.showLog(row.entity)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'
            }
        ];

        vm.getJobExecutions = function () {
            jobExecutionService.getJobExecutions(vm.jobExecutionsParams).then(function (data) {
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues.push(data.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { id: vm.jobExecutionsParams.job_type_id }) || jobTypeViewAll;
                vm.getJobExecutions();
            }).catch(function () {
                vm.loading = false;
            });
        };

        vm.showLog = function (jobExecution) {
            // show log modal
            vm.actionClicked = true;
            vm.jobExecution = jobExecution;
            $uibModal.open({
                animation: true,
                templateUrl: 'showLog.html',
                scope: $scope,
                size: 'lg',
                windowClass: 'log-modal-window'
            });
        };

        vm.filterResults = function () {
            stateService.setJobsParams(vm.jobExecutionsParams);
            vm.loading = true;
            vm.getJobs();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.jobExecutionsParams);
        };

        vm.updateJobOrder = function (sortArr) {
            vm.jobExecutionsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateJobType = function (value) {
            if (value.id !== vm.jobExecutionsParams.job_type_id) {
                vm.jobExecutionsParams.page = 1;
            }
            vm.jobExecutionsParams.job_type_id = value.id === 0 ? null : value.id;
            vm.jobExecutionsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateJobStatus = function (value) {
            if (value != vm.jobExecutionsParams.status) {
                vm.jobExecutionsParams.page = 1;
            }
            vm.jobExecutionsParams.status = value === 'VIEW ALL' ? null : value;
            vm.jobExecutionsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.path('/jobs/job/' + row.entity.id);
                }
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.jobExecutionsParams.page = currentPage;
                vm.jobExecutionsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setJobsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateJobOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setJobExecutionsParams(vm.jobExecutionsParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            vm.getJobTypes();
            navService.updateLocation('jobs/executions');
        };

        vm.initialize();

        $scope.$watch('vm.selectedJobType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.jobTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByJobType) {
                        vm.updateJobType(value);
                    }
                } else {
                    filteredByJobType = !angular.equals(value, jobTypeViewAll);
                    vm.updateJobType(value);
                }
            }
        });

        $scope.$watch('vm.selectedJobStatus', function (value) {
            if (vm.loading) {
                if (filteredByJobStatus) {
                    vm.updateJobStatus(value);
                }
            } else {
                filteredByJobStatus = value !== 'VIEW ALL';
                vm.updateJobStatus(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.jobExecutionsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.jobExecutionsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getJobsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getJobsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.jobExecutionsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobTypesController', ['$rootScope', '$scope', '$routeParams', '$location', 'hotkeys', 'scaleService', 'navService', 'stateService', 'jobTypeService', 'scaleConfig', 'subnavService', 'nodeService', 'localStorage', 'userService', function ($rootScope, $scope, $routeParams, $location, hotkeys, scaleService, navService, stateService, jobTypeService, scaleConfig, subnavService, nodeService, localStorage, userService) {
        var vm = this;
        
        vm.containerStyle = '';
        vm.requestedJobTypeId = parseInt($routeParams.id);
        vm.jobTypes = [];
        vm.jobTypeIds = [];
        vm.jobTypeCount = 0;
        vm.activeJobTypeDetails = {};
        vm.activeJobTypeInterfaceValues = [];
        vm.activeJobTypeErrors = [];
        vm.activeJobTypeStats = {};
        vm.jobTypesParams = stateService.getJobTypesParams();
        vm.showJobTypeErrors = false;
        vm.loading = true;
        vm.activeJobType = null;
        vm.healthData6 = {};
        vm.healthData12 = {};
        vm.healthData24 = {};
        vm.activityIcon = '<i class="fa fa-pulse">&#x' + scaleConfig.activityIconCode + '</i>';
        vm.jobDetailsClass = 'hidden';
        vm.pauseBtnClass = 'fa-pause';
        vm.user = userService.getUserCreds();
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/types');

        $scope.$watchCollection('vm.jobTypesParams',function(newValue){
            stateService.setJobTypesParams(newValue);
        });

        vm.viewDetails = function (id) {
            vm.activeJobType = _.find(vm.jobTypes, 'id', id);
            vm.activeJobType.created = formatDateTime(vm.activeJobType.created);
            vm.activeJobType.lastModified = formatDateTime(vm.activeJobType.lastModified);

            $location.path('jobs/types/' + id);

            getJobTypeDetails(vm.activeJobType.id);

            vm.jobDetailsClass = 'visible';
        };

        vm.togglePause = function () {
            vm.activeJobType.is_paused = !vm.activeJobType.is_paused;
            vm.activeJobTypeDetails.is_paused = vm.activeJobType.is_paused;
            vm.loading = true;
            jobTypeService.updateJobType(vm.activeJobTypeDetails).then(function(data){
                vm.activeJobTypeDetails = data;
                vm.pauseBtnClass = vm.getPauseButtonClass(vm.activeJobTypeDetails.is_paused);
                vm.loading = false;
            }).catch(function (error) {
                console.log(error);
                toastr['error'](error);
                vm.loading = false;
            });
        };

        vm.getPauseButtonClass = function(is_paused){
            return is_paused ? 'fa-play' : 'fa-pause';
        };

        vm.getJobTypeListItemClass = function(jobType){
            return jobType.is_paused ? 'paused' : '';
        };

        var formatDateTime = function (dt) {
            return moment.utc(dt).toISOString();
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypes = data.results;
                vm.jobTypeIds = _.pluck(vm.jobTypes, 'id');
                vm.jobTypeCount = data.count;
                if (vm.requestedJobTypeId) {
                    vm.viewDetails(vm.requestedJobTypeId);
                } else {
                    vm.loading = false;
                }
                hotkeys.bindTo($scope)
                    .add({
                        combo: 'ctrl+up',
                        description: 'Previous Job Type',
                        callback: function () {
                            if (vm.activeJobType) {
                                var idx = _.indexOf(vm.jobTypeIds, vm.activeJobType.id);
                                if (idx > 0) {
                                    vm.viewDetails(vm.jobTypeIds[idx - 1]);
                                }
                            }
                        }
                    }).add({
                        combo: 'ctrl+down',
                        description: 'Next Job Type',
                        callback: function () {
                            if (vm.activeJobType) {
                                var idx = _.indexOf(vm.jobTypeIds, vm.activeJobType.id);
                                if (idx < (vm.jobTypeIds.length - 1)) {
                                    vm.viewDetails(vm.jobTypeIds[idx + 1]);
                                }
                            }
                        }
                    });
            }).catch(function (error) {
                console.log(error);
                vm.loading = false;
            });
        };

        var getJobTypeDetails = function (id) {
            vm.loading = true;
            jobTypeService.getJobTypeDetails(id).then(function (data) {
                vm.activeJobTypeDetails = data;
                vm.activeJobTypeInterfaceValues = _.pairs(data.job_type_interface);
                vm.pauseBtnClass = vm.getPauseButtonClass(vm.activeJobTypeDetails.is_paused);
                // format error mapping
                vm.activeJobTypeErrors = [];
                vm.showJobTypeErrors = _.keys(data.error_mapping.exit_codes).length > 0;
                if (vm.showJobTypeErrors) {
                    _.forEach(data.error_mapping.exit_codes, function (error_name) {
                        var error = _.find(data.errors, 'name', error_name),
                            exitCode = _.invert(data.error_mapping.exit_codes)[error_name];
                        vm.activeJobTypeErrors.push({code: exitCode, data: error});
                    });
                }

                // format job type stats
                var performance = data.getPerformance(),
                    failures = data.getFailures();

                vm.activeJobTypeStats = performance;

                vm.healthData6 = {
                    gaugeData: performance.hour6.rate,
                    donutData: failures.hour6
                };
                vm.healthData12 = {
                    gaugeData: performance.hour12.rate,
                    donutData: failures.hour12
                };
                vm.healthData24 = {
                    gaugeData: performance.hour24.rate,
                    donutData: failures.hour24
                };
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            vm.jobTypesParams = stateService.getJobTypesParams();
            getJobTypes();
            navService.updateLocation('jobs');
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').controller('jobTypesFailureRatesController', ['$scope', '$location', 'scaleConfig', 'stateService', 'scaleService', 'subnavService', 'jobTypeService', 'metricsService', 'gridFactory', 'JobType', 'toastr', 'moment', function ($scope, $location, scaleConfig, stateService, scaleService, subnavService, jobTypeService, metricsService, gridFactory, JobType, toastr, moment) {
        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobTypesParams = stateService.getJobTypesFailureRatesParams();

        var jobTypes = [],
            started = moment.utc().subtract(30, 'days').startOf('d').toISOString(),
            ended = moment.utc().endOf('d').toISOString(),
            filteredByJobType = vm.jobTypesParams.name ? true : false;

        vm.stateService = stateService;
        vm.scaleService = scaleService;
        vm.loading = true;
        vm.dates = [];
        vm.performanceData = [];
        vm.jobTypeValues = [jobTypeViewAll];
        vm.selectedJobType = null;
        vm.sortOrders = {
            twentyfour_hours: {
                system: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                algorithm: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                data: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                total: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                errorTotal: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                }
            },
            fortyeight_hours: {
                system: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                algorithm: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                data: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                total: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                errorTotal: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                }
            },
            thirty_days: {
                system: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                algorithm: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                data: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                total: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                },
                errorTotal: {
                    direction: vm.jobTypesParams.order || 'desc',
                    icon: 'hidden'
                }
            }
        };
        vm.currSortField = '';
        vm.currSortErrorType = '';
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/failure-rates');

        var defaultColumnDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>',
                width: '16%',
                enableSorting: false
            },
            {
                field: 'twentyfour_hours',
                displayName: '24 Hours',
                enableSorting: false,
                enableFiltering: false,
                width: '28%',
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            },
            {
                field: 'fortyeight_hours',
                displayName: '48 Hours',
                enableSorting: false,
                enableFiltering: false,
                width: '28%',
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            },
            {
                field: 'thirty_days',
                displayName: '30 Days',
                enableSorting: false,
                enableFiltering: false,
                width: '28%',
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            }
        ];

        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.columnDefs = defaultColumnDefs;
        vm.gridOptions.data = [];
        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            $scope.gridApi = gridApi;
            $scope.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if ($scope.actionClicked) {
                    $scope.actionClicked = false;
                } else {
                    $scope.$apply(function () {
                        $location.path('/jobs/types/' + row.entity.job_type.id);
                    });
                }
            });
        };
        
        vm.setStyle = function (colField, errorType) {
            var errorValue = (colField[errorType] / colField.total).toFixed(2);
            var textColor = errorValue >= 0.5 ? '#fff' : '#000';
            var rgb = errorType === 'system' ? '103, 0, 13' : errorType === 'algorithm' ? '203, 24, 29' : '241, 105, 19';
            return 'background: rgba(' + rgb + ', ' + errorValue + '); color: ' + textColor;
        };

        vm.failRateStyle = function (error, total) {
            var percentage = ((error / total) * 100).toFixed(0);
            return percentage > 0 ? 'width: ' + percentage + '%' : 'display: none';
        };
        
        vm.getPercentageOfTotal = function (errorTotal, total) {
            if (total === 0) {
                return '0%';
            }
            return ((errorTotal / total) * 100).toFixed(0) + '%';
        };

        vm.filterResults = function (skipInit, skipSort) {
            stateService.setJobTypesFailureRatesParams(vm.jobTypesParams);
            _.forEach(_.pairs(vm.jobTypesParams), function (param) {
                $location.search(param[0], param[1]);
            });
            if (!skipInit) {
                vm.gridOptions.data = [];
                vm.loading = true;
                initialize(skipSort);
            }
        };

        vm.updateJobType = function (value) {
            vm.jobTypesParams.name = value.name === 'VIEW ALL' ? null : value.name;
            vm.jobTypesParams.version = value.name === 'VIEW ALL' ? null : value.version;
            if (!vm.loading) {
                vm.filterResults(false, false);
            }
        };

        vm.sortBy = function (errorType, field, order) {
            order = order || vm.sortOrders[field][errorType].direction;
            vm.sortOrders[vm.currSortField][vm.currSortErrorType].icon = 'hidden';
            vm.gridOptions.data = _.sortByOrder(vm.performanceData, function (d) {
                if (errorType === 'errorTotal') {
                    if (d[field].total > 0) {
                        return d[field].errorTotal / d[field].total;
                    }
                    return 0;
                }
                return d[field][errorType];
            }, order);
            vm.currSortErrorType = errorType;
            vm.currSortField = field;
            vm.jobTypesParams.order = order;
            vm.jobTypesParams.orderField = field;
            vm.jobTypesParams.orderErrorType = errorType;

            if (order) {
                vm.sortOrders[field][errorType].icon = order === 'desc' ? 'fa-caret-down' : 'fa-caret-up';
                vm.sortOrders[field][errorType].direction = order === 'desc' ? 'asc' : 'desc';
            } else {
                vm.sortOrders[field][errorType].icon = vm.sortOrders[field][errorType].direction === 'desc' ? 'fa-caret-down' : 'fa-caret-up';
                vm.sortOrders[field][errorType].direction = vm.sortOrders[field][errorType].direction === 'desc' ? 'asc' : 'desc';
            }

            vm.filterResults(true);
            $scope.gridApi.core.refresh();
        };

        var formatData = function (data, numDays) {
            var dataArr = [];
            _.forEach(data, function (result) {
                var filteredResult = _.filter(result, function (d) {
                    var date = moment.utc(d.date, 'YYYY-MM-DD');
                    if (moment.utc().diff(moment.utc(date), 'd') <= numDays) {
                        return d;
                    }
                });
                dataArr.push(filteredResult);
            });
            return dataArr;
        };

        var formatColumn = function (cData, id) {
            var systemErrors = cData[0],
                algorithmErrors = cData[1],
                dataErrors = cData[2],
                totalCount = cData[3];

            var obj = {
                system: _.sum(_.map(_.filter(systemErrors, { id: id }), 'value')),
                algorithm: _.sum(_.map(_.filter(algorithmErrors, { id: id }), 'value')),
                data: _.sum(_.map(_.filter(dataErrors, { id: id }), 'value')),
                total: _.sum(_.map(_.filter(totalCount, { id: id }), 'value'))
            };
            obj.errorTotal = obj.system + obj.algorithm + obj.data;

            return obj;
        };

        var initialize = function (skipSort) {
            vm.performanceData = [];
            vm.jobTypeValues = [jobTypeViewAll];
            stateService.setJobTypesFailureRatesParams(vm.jobTypesParams);
            jobTypeService.getJobTypesOnce().then(function (jobTypesData) {
                if (vm.jobTypesParams.name && vm.jobTypesParams.version) {
                    jobTypes = _.filter(jobTypesData.results, { name: vm.jobTypesParams.name, version: vm.jobTypesParams.version });
                } else {
                    jobTypes = _.cloneDeep(jobTypesData.results);
                }
                vm.jobTypeValues.push(jobTypesData.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { name: vm.jobTypesParams.name, version: vm.jobTypesParams.version }) || jobTypeViewAll;
                vm.gridOptions.totalItems = jobTypesData.count;

                var metricsParams = {
                    page: null,
                    page_size: null,
                    started: started,
                    ended: ended,
                    choice_id: vm.selectedJobType.id > 0 ? [vm.selectedJobType.id] : _.map(jobTypes, 'id'),
                    column: ['error_system_count', 'error_algorithm_count', 'error_data_count', 'total_count'],
                    group: null,
                    dataType: 'job-types'
                };

                metricsService.getPlotData(metricsParams).then(function (data) {
                    if (data.results.length > 0) {
                        var data30Days = _.map(data.results, 'values'),
                            data48Hours = formatData(data30Days, 2),
                            data24Hours = formatData(data48Hours, 1);

                        _.forEach(jobTypes, function (jobType) {
                            vm.performanceData.push({
                                job_type: JobType.transformer(jobType),
                                twentyfour_hours: formatColumn(data24Hours, jobType.id),
                                fortyeight_hours: formatColumn(data48Hours, jobType.id),
                                thirty_days: formatColumn(data30Days, jobType.id)
                            });
                        });

                        vm.performanceData = _.sortByOrder(vm.performanceData, [function (d) {
                            if (d.twentyfour_hours.total > 0) {
                                return d.twentyfour_hours.errorTotal / d.twentyfour_hours.total;
                            }
                            return 0;
                        }, 'twentyfour_hours.total'], ['desc', 'desc']);

                        vm.gridOptions.minRowsToShow = vm.performanceData.length;
                        vm.gridOptions.virtualizationThreshold = vm.performanceData.length;
                        vm.gridOptions.data = vm.performanceData;
                        if (!skipSort) {
                            vm.currSortField = vm.jobTypesParams.orderField || 'twentyfour_hours';
                            vm.currSortErrorType = vm.jobTypesParams.orderErrorType || 'errorTotal';
                            if (vm.jobTypesParams.order && vm.jobTypesParams.orderField && vm.jobTypesParams.orderErrorType) {
                                vm.sortBy(vm.jobTypesParams.orderErrorType, vm.jobTypesParams.orderField, vm.jobTypesParams.order);
                            }
                        }
                    }

                    vm.loading = false;
                }).catch(function (error) {
                    vm.loading = false;
                    console.log(error);
                    toastr['error'](error);
                });
            });
        };
        
        initialize();

        $scope.$watch('vm.selectedJobType', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            if (vm.jobTypeValues.length > 1) {
                if (vm.loading) {
                    if (filteredByJobType) {
                        vm.updateJobType(newValue);
                    }
                } else {
                    filteredByJobType = newValue !== 'VIEW ALL';
                    vm.updateJobType(newValue);
                }
            }
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobsController', ['$scope', '$location', '$uibModal', 'scaleConfig', 'scaleService', 'stateService', 'navService', 'subnavService', 'userService', 'jobService', 'jobExecutionService', 'jobTypeService', 'loadService', 'gridFactory', 'toastr', 'poller', function ($scope, $location, $uibModal, scaleConfig, scaleService, stateService, navService, subnavService, userService, jobService, jobExecutionService, jobTypeService, loadService, gridFactory, toastr, poller) {
        subnavService.setCurrentPath('jobs');

        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobsParams = stateService.getJobsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.readonly = true;
        vm.jobTypeValues = [jobTypeViewAll];
        vm.jobExecution = null;
        vm.selectedJobType = vm.jobsParams.job_type_id ? vm.jobsParams.job_type_id : jobTypeViewAll;
        vm.jobStatusValues = scaleConfig.jobStatus;
        vm.selectedJobStatus = vm.jobsParams.status || vm.jobStatusValues[0];
        vm.errorCategoryValues = _.map(scaleConfig.errorCategories, 'name');
        vm.selectedErrorCategory = vm.jobsParams.error_category || vm.errorCategoryValues[0];
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        vm.actionClicked = false;
        vm.lastModifiedStart = moment.utc(vm.jobsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.jobsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.jobsParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.jobsParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByJobType = vm.jobsParams.job_type_id ? true : false,
            filteredByJobStatus = vm.jobsParams.status ? true : false,
            filteredByErrorCategory = vm.jobsParams.error_category ? true : false,
            filteredByOrder = vm.jobsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'status',
                width: 150,
                cellTemplate: '<div class="ui-grid-cell-contents">' +
                    '<div class="pull-right">' +
                        '<button ng-show="((!grid.appScope.vm.readonly && !row.entity.is_superseded) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.vm.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job">' +
                            '<i class="fa fa-repeat"></i></button> ' +
                        '<button ng-show="!grid.appScope.vm.readonly && !row.entity.is_superseded && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.vm.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job">' +
                            '<i class="fa fa-ban"></i></button>' +
                    '</div> {{ row.entity.status }} <span type="button"  ng-if="row.entity.is_superseded" class="label label-info pull-right" tooltip-append-to-body="true" uib-tooltip="Superseded">S</span></div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobStatus"><option ng-selected="{{ grid.appScope.vm.jobStatusValues[$index] == grid.appScope.vm.selectedJobStatus }}" value="{{ grid.appScope.vm.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'error.category',
                width: 150,
                displayName: 'Error Category',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedErrorCategory"><option ng-selected="{{ grid.appScope.vm.errorCategoryValues[$index] == grid.appScope.vm.selectedErrorCategory }}" value="{{ grid.appScope.vm.errorCategoryValues[$index] }}" ng-repeat="error in grid.appScope.vm.errorCategoryValues track by $index">{{ error.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'error.title',
                displayName: 'Error',
                cellTemplate: '<div class="ui-grid-cell-contents"><div uib-tooltip="{{ row.entity.error.description }}" tooltip-append-to-body="true">{{ row.entity.error.title }}</div></div>',
                width: 200,
                enableFiltering: false
            },
            {
                field: 'id',
                displayName: 'Log',
                enableFiltering: false,
                sortable: false,
                width: 60,
                cellTemplate: '<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.vm.showLog(row.entity.id)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'
            }
        ];

        vm.getJobs = function () {
            jobService.getJobs(vm.jobsParams).then(null, null, function (data) {
                vm.loading = false;
                if (data.$resolved) {
                    vm.gridOptions.totalItems = data.count;
                    vm.gridOptions.minRowsToShow = data.results.length;
                    vm.gridOptions.virtualizationThreshold = data.results.length;
                    vm.gridOptions.data = data.results;
                    vm.gridOptions.paginationCurrentPage = vm.jobsParams.page;
                    vm.gridOptions.paginationPageSize = vm.jobsParams.page_size;
                } else {
                    console.log(error);
                }
            });
        };

        vm.getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues.push(data.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { id: vm.jobsParams.job_type_id }) || jobTypeViewAll;
                vm.getJobs();
            }).catch(function () {
                vm.loading = false;
            });
        };

        vm.showLog = function (jobId) {
            // show log modal
            vm.actionClicked = true;
            jobService.getJobDetail(jobId).then(function (data) {
                vm.jobExecution = data.getLatestExecution();
                jobExecutionService.getJobExecutionDetails(vm.jobExecution.id).then(function(result){
                    vm.jobExecution = result;
                });
                $uibModal.open({
                    animation: true,
                    templateUrl: 'showLog.html',
                    scope: $scope,
                    windowClass: 'log-modal-window'
                });
            });
        };

        vm.requeueJobs = function (jobsParams) {
            if (!jobsParams) {
                jobsParams = vm.jobsParams ? vm.jobsParams : { started: vm.lastModifiedStart.toISOString(), ended: vm.lastModifiedStop.toISOString() };
            }
            vm.actionClicked = true;
            vm.loading = true;
            loadService.requeueJobs(jobsParams).then(function () {
                toastr['success']('Requeue Successful');
                vm.getJobs();
            }).catch(function (error) {
                toastr['error']('Requeue request failed');
                vm.loading = false;
            });
        };

        vm.cancelJob = function (job) {
            vm.actionClicked = true;
            vm.loading = true;
            var originalStatus = job.status;
            job.status = 'CANCEL';
            jobService.updateJob(job.id, { status: 'CANCELED' }).then(function () {
                toastr['success']('Job Canceled');
                job.status = 'CANCELED';
            }).catch(function (error) {
                toastr['error'](error);
                job.status = originalStatus;
            }).finally(function () {
                vm.loading = false;
            });
        };
        
        vm.filterResults = function () {
            poller.stopAll();
            stateService.setJobsParams(vm.jobsParams);
            vm.loading = true;
            vm.getJobs();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.jobsParams);
        };

        vm.updateJobOrder = function (sortArr) {
            vm.jobsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateJobType = function (value) {
            if (value.id !== vm.jobsParams.job_type_id) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.job_type_id = value.id === 0 ? null : value.id;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateJobStatus = function (value) {
            if (value != vm.jobsParams.status) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.status = value === 'VIEW ALL' ? null : value;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateErrorCategory = function (value) {
            if (value != vm.jobsParams.error_category) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.error_category = value === 'VIEW ALL' ? null : value;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.path('/jobs/job/' + row.entity.id).search('');
                }
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.jobsParams.page = currentPage;
                vm.jobsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setJobsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateJobOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setJobsParams(vm.jobsParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            vm.getJobTypes();
            navService.updateLocation('jobs');
        };

        vm.initialize();

        $scope.$watch('vm.selectedJobType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.jobTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByJobType) {
                        vm.updateJobType(value);
                    }
                } else {
                    filteredByJobType = !angular.equals(value, jobTypeViewAll);
                    vm.updateJobType(value);
                }
            }
        });

        $scope.$watch('vm.selectedJobStatus', function (value) {
            if (vm.loading) {
                if (filteredByJobStatus) {
                    vm.updateJobStatus(value);
                }
            } else {
                filteredByJobStatus = value !== 'VIEW ALL';
                vm.updateJobStatus(value);
            }
        });

        $scope.$watch('vm.selectedErrorCategory', function (value) {
            if (vm.loading) {
                if (filteredByErrorCategory) {
                    vm.updateErrorCategory(value);
                }
            } else {
                filteredByErrorCategory = value !== 'VIEW ALL';
                vm.updateErrorCategory(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.jobsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.jobsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getJobsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getJobsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.jobsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').controller('jobExecutionLogController', ['$scope', '$location', '$element', '$timeout', 'scaleConfig', 'jobExecutionService', 'stateService', 'poller', function ($scope, $location, $element, $timeout, scaleConfig, jobExecutionService, stateService, poller) {
        var vm = this,
                 latestScaleOrderNum = 0;
        
        var initialize = function () {
            vm.forceScroll = true;
            vm.jobLogError = null;
            vm.execLog = [];
            stateService.setLogArgs([]);

            // debounce this watch operation to prevent duplicate calls
            // set the timer for 100ms less than the job exe log poll interval
            $scope.$watch('execution', _.debounce(function () {
                if ($scope.execution) {
                    vm.status = $scope.execution.status.toLowerCase();
                    console.log($scope.execution);
                    jobExecutionService.getLog($scope.execution.id).then(null, null, function (result) {
                        if (result.$resolved) {
                            if (result.$status !== 204) {
                                // Content was returned, so add it to the log array
                                // get difference of max scroll length and current scroll length.var  = result.data;
                                var div = $($element[0]).find('.bash');
                                vm.scrollDiff = (div.scrollTop() + div.prop('offsetHeight')) - div.prop('scrollHeight');
                                if (vm.scrollDiff >= 0) {
                                    vm.forceScroll = true;
                                }
                                // concat new content and sort log array by timestamp and then by order num
                                vm.execLog = _.sortBy(vm.execLog.concat(result.hits.hits), ['_source.@timestamp', '_source.scale_order_num']);
                                if (vm.execLog && vm.execLog.length > 0) {
                                    var lastLog = _.last(vm.execLog)._source;
                                    if (lastLog.scale_order_num !== latestScaleOrderNum) {
                                        // new entries, so leave them on the array and report the new timestamp
                                        console.log('New entries - ' + lastLog.scale_order_num + ' : ' + latestScaleOrderNum);
                                        latestScaleOrderNum = lastLog.scale_order_num;
                                        stateService.setLogArgs([
                                            {
                                                // started: moment.utc(lastLog['@timestamp']).subtract(1, 's').toISOString()
                                                started: lastLog['@timestamp']
                                            }
                                        ]);
                                    } else {
                                        // duplicate entries, so remove them from the array
                                        console.log('Duplicate entries');
                                        vm.execLog = _.take(vm.execLog, vm.execLog.length - result.hits.hits.length);
                                    }
                                }
                            }
                        } else {
                            if (result.$statusText && result.$statusText !== '') {
                                vm.jobLogErrorStatus = result.$statusText;
                            }
                            $scope.jobLogError = 'Unable to retrieve job logs.';
                        }
                    });
                    $scope.$on('modal.closing', function () {
                        poller.stopAll();
                    });
                }
            }, scaleConfig.pollIntervals.jobExecutionLog - 100));
            $scope.$watch('vm.execLog', function () {
                if (vm.execLog) {
                    if (vm.forceScroll || vm.scrollDiff >= 0) {
                        $timeout(function () {
                            vm.forceScroll = false;
                            var scrlHeight = $($element[0]).find('.bash').prop('scrollHeight');
                            $($element[0]).find('.bash').scrollTop(scrlHeight);
                        }, 50);
                    }
                }
            });
        };

        vm.scrollitem = function (item) {
            console.log(item);
        };

        vm.stdoutChanged = function () {
            console.log('stdout changed.');
        };

        initialize();

    }]).directive('jobExecutionLog', function () {
        return {
            controller: 'jobExecutionLogController',
            controllerAs: 'vm',
            templateUrl: 'modules/jobs/directives/jobExecutionLogTemplate.html',
            restrict: 'E',
            scope: {
                execution: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisJobHealthController', ['$rootScope', '$scope', 'jobTypeService', function ($rootScope, $scope, jobTypeService) {
        var vm = this;
        
        vm.loadingJobHealth = true;
        vm.jobHealthError = null;
        vm.jobHealthErrorStatus = null;
        vm.jobHealth = {};

        var getJobTypeStatus = function () {
            jobTypeService.getJobTypeStatus({
                page: null,
                page_size: 1000,
                started: $scope.duration,
                ended: null
            }).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.jobHealthError = null;
                    vm.jobTypeStatus = data.results;
                    vm.total = 0;
                    vm.failed = 0;

                    var performance = {},
                        failures = [];

                    _.forEach(data.results, function (status) {
                        performance = status.getPerformance();
                        vm.total = vm.total + performance.total;
                        vm.failed = vm.failed + performance.failed;
                        failures.push(status.getFailures());
                    });

                    var failureData = [],
                        systemFailures = 0,
                        dataFailures = 0,
                        algorithmFailures = 0;

                    _.forEach(failures, function (f) {
                        _.forEach(f, function (type) {
                            if (type.status === 'SYSTEM') {
                                systemFailures = systemFailures + type.count;
                            } else if (type.status === 'DATA') {
                                dataFailures = dataFailures + type.count;
                            } else if (type.status === 'ALGORITHM') {
                                algorithmFailures = algorithmFailures + type.count;
                            }
                        });
                    });

                    if (systemFailures > 0 || dataFailures > 0 || algorithmFailures > 0) {
                        if (systemFailures > 0) {
                            failureData.push({
                                status: 'SYSTEM',
                                count: systemFailures
                            });
                        }
                        if (algorithmFailures > 0) {
                            failureData.push({
                                status: 'ALGORITHM',
                                count: algorithmFailures
                            });
                        }
                        if (dataFailures > 0) {
                            failureData.push({
                                status: 'DATA',
                                count: dataFailures
                            });
                        }
                    }

                    vm.jobHealth = {
                        gaugeData: vm.total === 0 ? 0 : 100 - ((vm.failed / vm.total) * 100).toFixed(2),
                        donutData: failureData
                    };

                    if ($scope.broadcastData) {
                        $rootScope.$broadcast('jobTypeStatus', vm.jobTypeStatus);
                    }
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.jobHealthErrorStatus = data.statusText;
                    }
                    vm.jobHealthError = 'Unable to retrieve job statistics.';
                }
                vm.loadingJobHealth = false;
            });
        };

        getJobTypeStatus();
    }]).directive('aisJobHealth', function(){
        /**
         * Usage: <ais-job-health />
         **/
        return {
            controller: 'aisJobHealthController',
            controllerAs: 'vm',
            templateUrl: 'modules/jobs/directives/jobHealthTemplate.html',
            restrict: 'E',
            scope: {
                duration: '=',
                broadcastData: '=', // set to true when using another widget in the same view that also calls getJobTypeStatus
                showDescription: '='
            }
        };
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobTypeInterfaceDirectiveController', ['$rootScope', '$scope', 'jobTypeService', function ($rootScope, $scope, jobTypeService) {

    }]).directive('aisJobTypeInterface', function(){
        /**
         * Usage: <ais-job-health />
         **/
        return {
            controller: 'jobTypeInterfaceDirectiveController',
            templateUrl: 'modules/jobs/directives/jobTypeInterfaceTemplate.html',
            restrict: 'E',
            scope: {
                jobTypeInterface: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Job', ['scaleConfig', 'JobType', 'scaleService', function (scaleConfig, JobType, scaleService) {
        var Job = function (id, job_type, job_type_rev, event, error, status, priority, num_exes, timeout, max_tries,
                            cpus_required, mem_required, disk_in_required, disk_out_required, created, queued, started,
                            ended, last_status_change, last_modified, is_superseded) {
            this.id = id;
            this.job_type = JobType.transformer(job_type);
            this.job_type_rev = job_type_rev;
            this.event = event;
            this.error = error;
            this.status = status;
            this.priority = priority;
            this.num_exes = num_exes;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_in_required = disk_in_required;
            this.disk_out_required = disk_out_required;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.queued = queued;
            this.started = started;
            this.ended = ended;
            this.last_status_change = last_status_change;
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.is_superseded = is_superseded;
        };

        // public methods
        Job.prototype = {
            getDuration: function () {
                var start = this.started,
                    end = this.ended ? this.ended : moment.utc().toISOString();
                return scaleService.calculateDuration(start, end);
            }
        };

        // static methods, assigned to class
        Job.build = function (data) {
            if (data) {
                return new Job(
                    data.id,
                    data.job_type,
                    data.job_type_rev,
                    data.event,
                    data.error,
                    data.status,
                    data.priority,
                    data.num_exes,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_in_required,
                    data.disk_out_required,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_status_change,
                    data.last_modified,
                    data.is_superseded
                );
            }
            return new Job();
        };

        Job.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Job.build)
                    .filter(Boolean);
            }
            return Job.build(data);
        };

        return Job;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailEvent', ['JobDetailEventRule', function (JobDetailEventRule) {
        var JobDetailEvent = function (id, type, rule, occurred) {
            this.id = id;
            this.type = type;
            this.rule = JobDetailEventRule.transformer(rule);
            this.occurred = occurred;
        };

        // public methods
        JobDetailEvent.prototype = {

        };

        // static methods, assigned to class
        JobDetailEvent.build = function (data) {
            if (data) {
                return new JobDetailEvent(
                    data.id,
                    data.type,
                    data.rule,
                    data.occurred
                );
            }
            return new JobDetailEvent();
        };

        JobDetailEvent.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailEvent.build)
                    .filter(Boolean);
            }
            return JobDetailEvent.build(data);
        };

        return JobDetailEvent;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailEventRule', function () {
        var JobDetailEventRule = function (id, type, is_active, created, archived, last_modified) {
            this.id = id;
            this.type = type;
            this.is_active = is_active;
            this.created = created;
            this.archived = archived;
            this.last_modified = last_modified;
        };

        // public methods
        JobDetailEventRule.prototype = {

        };

        // static methods, assigned to class
        JobDetailEventRule.build = function (data) {
            if (data) {
                return new JobDetailEventRule(
                    data.id,
                    data.type,
                    data.is_active,
                    data.created,
                    data.archived,
                    data.last_modified
                );
            }
            return new JobDetailEventRule();
        };

        JobDetailEventRule.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailEventRule.build)
                    .filter(Boolean);
            }
            return JobDetailEventRule.build(data);
        };

        return JobDetailEventRule;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailInputData', function () {
        var JobDetailInputData = function (name, value, file_id, file_ids, files) {
            this.name = name;
            this.value = value;
            this.file_id = file_id;
            this.file_ids = file_ids;
            this.files = files;
        };

        // public methods
        JobDetailInputData.prototype = {
            getValue: function () {
                if (this.value)
                    return this.value;
                if (this.file_id)
                    return this.file_id;
                if (this.file_ids)
                    return this.file_ids;
            }
        };

        // static methods, assigned to class
        JobDetailInputData.build = function (data) {
            if (data) {
                return new JobDetailInputData(
                    data.name,
                    data.value,
                    data.file_id,
                    data.file_ids,
                    data.files
                );
            }
            return new JobDetailInputData();
        };

        JobDetailInputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailInputData.build)
                    .filter(Boolean);
            }
            return JobDetailInputData.build(data);
        };

        return JobDetailInputData;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailOutputData', function () {
        var JobDetailOutputData = function (name, workspace_id, files) {
            this.name = name;
            this.workspace_id = workspace_id;
            this.files = files;
        };

        // public methods
        JobDetailOutputData.prototype = {

        };

        // static methods, assigned to class
        JobDetailOutputData.build = function (data) {
            if (data) {
                return new JobDetailOutputData(
                    data.name,
                    data.workspace_id,
                    data.files
                );
            }
            return new JobDetailOutputData();
        };

        JobDetailOutputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailOutputData.build)
                    .filter(Boolean);
            }
            return JobDetailOutputData.build(data);
        };

        return JobDetailOutputData;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetails', ['scaleConfig', 'JobType', 'JobExecution', 'Product', 'JobDetailInputData', 'JobDetailOutputData', 'Recipe', 'JobDetailEvent', 'scaleService', function (scaleConfig, JobType, JobExecution, Product, JobDetailInputData, JobDetailOutputData, Recipe, JobDetailEvent, scaleService) {
        var JobDetails = function (id, job_type, job_type_rev, event, error, status,
                                   priority, num_exes, timeout, max_tries, cpus_required, mem_required,
                                   disk_in_required, disk_out_required, created, queued, started, ended,
                                   last_status_change, last_modified, data, results, recipes, job_exes,
                                   inputs, outputs, is_superseded, root_superseded_job, superseded_job,
                                   superseded_by_job, superseded) {
            this.id = id;
            this.job_type = JobType.transformer(job_type);
            this.job_type_rev = job_type_rev;
            this.event = JobDetailEvent.transformer(event);
            this.error = error;
            this.status = status;
            this.priority = priority;
            this.num_exes = num_exes;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_in_required = disk_in_required;
            this.disk_out_required = disk_out_required;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc);
            this.queued = queued;
            this.queued_formatted = moment.utc(queued).format(scaleConfig.dateFormats.day_second_utc);
            this.started = started;
            this.started_formatted = moment.utc(started).format(scaleConfig.dateFormats.day_second_utc);
            this.ended = ended;
            this.ended_formatted = moment.utc(ended).format(scaleConfig.dateFormats.day_second_utc);
            this.last_status_change = last_status_change;
            this.last_modified = last_modified;
            this.data = {
                input_data: JobDetailInputData.transformer(data.input_data),
                version: data.version,
                output_data: JobDetailOutputData.transformer(data.output_data)
            };
            this.results = {
                output_data: JobDetailOutputData.transformer(results.output_data),
                version: results.version
            };
            this.recipes = _.sortBy(Recipe.transformer(recipes), ['created']).reverse();
            this.job_exes = JobExecution.transformer(job_exes);
            this.inputs = inputs;
            this.outputs = outputs;
            this.is_superseded = is_superseded;
            this.root_superseded_job = root_superseded_job;
            this.superseded_job = superseded_job;
            this.superseded_by_job = superseded_by_job;
            this.superseded = superseded;
            this.superseded_formatted = moment.utc(superseded).format(scaleConfig.dateFormats.day_second_utc);;

        };

        // public methods
        JobDetails.prototype = {
            getDuration: function () {
                var start = this.started,
                    end = this.ended ? this.ended : moment.utc().toISOString();

                return scaleService.calculateDuration(start, end);
            },
            getLatestExecution: function(){
                if (this.num_exes > 0 ) {
                    return this.job_exes[0];
                }
                return null;
            },
            getStatusClass: function(){
                // if(this.status === 'COMPLETED'){
                //     return 'label-success';
                // }
                // else if( this.status === 'FAILED'){
                //     return 'label-default';//    return 'label-danger';
                // }
                // else{
                //     return 'label-default';
                // }
                return this.status.toLowerCase();
            }
        };

        // static methods, assigned to class
        JobDetails.build = function (data) {
            if (data) {
                return new JobDetails(
                    data.id,
                    data.job_type,
                    data.job_type_rev,
                    data.event,
                    data.error,
                    data.status,
                    data.priority,
                    data.num_exes,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_in_required,
                    data.disk_out_required,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_status_change,
                    data.last_modified,
                    data.data,
                    data.results,
                    data.recipes,
                    data.job_exes,
                    data.inputs,
                    data.outputs,
                    data.is_superseded,
                    data.root_superseded_job,
                    data.superseded_job,
                    data.superseded_by_job,
                    data.superseded
                );
            }
            return new JobDetails();
        };

        JobDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetails.build)
                    .filter(Boolean);
            }
            return JobDetails.build(data);
        };

        return JobDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobExecution', ['scaleConfig', 'Job', 'Node', 'moment', function (scaleConfig, Job, Node, moment) {
        var JobExecution = function (id, status, command_arguments, timeout, pre_started, pre_completed, pre_exit_code, job_started, job_completed, job_exit_code, post_started, post_completed, post_exit_code, created, queued, started, ended, last_modified, job, node, error, environment, cpus_scheduled, mem_scheduled, disk_in_scheduled, disk_out_scheduled, disk_total_scheduled, results, current_stdout_url, current_stderr_url, results_manifest) {
            this.id = id;
            this.status = status;
            this.command_arguments = command_arguments;
            this.timeout = timeout;
            this.pre_started = pre_started;
            this.pre_completed = pre_completed;
            this.pre_exit_code = pre_exit_code;
            this.job_started = job_started;
            this.job_completed = job_completed;
            this.job_exit_code = job_exit_code;
            this.post_started = post_started;
            this.post_completed = post_completed;
            this.post_exit_code = post_exit_code;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.queued = queued;
            this.queued_formatted = queued ? moment.utc(queued).toISOString() : queued;
            this.started = started;
            this.started_formatted = started ? moment.utc(started).toISOString() : started;
            this.ended = ended;
            this.ended_formatted = ended ? moment.utc(ended).toISOString() : ended;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
            this.job = Job.transformer(job);
            this.node = Node.transformer(node);
            this.error = error;
            this.environment = environment;
            this.cpus_scheduled = cpus_scheduled;
            this.mem_scheduled = mem_scheduled;
            this.disk_in_scheduled = disk_in_scheduled;
            this.disk_out_scheduled = disk_out_scheduled;
            this.disk_total_scheduled = disk_total_scheduled;
            this.results = results;
            this.current_stdout_url = current_stdout_url;
            this.current_stderr_url = current_stderr_url;
            this.results_manifest = results_manifest;
        };

        // public methods
        JobExecution.prototype = {
            getDuration: function () {
                return moment.utc(this.job_completed).diff(moment.utc(this.job_started));
            },
            getIcon: function () {
                return this.job.jobType.iconCode ? '<i class="fa">&#x' + this.job.jobType.iconCode + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            }
        };

        // static methods, assigned to class
        JobExecution.build = function (data) {
            if (data) {
                return new JobExecution(
                    data.id,
                    data.status,
                    data.command_arguments,
                    data.timeout,
                    data.pre_started,
                    data.pre_completed,
                    data.pre_exit_code,
                    data.job_started,
                    data.job_completed,
                    data.job_exit_code,
                    data.post_started,
                    data.post_completed,
                    data.post_exit_code,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_modified,
                    data.job,
                    data.node,
                    data.error,
                    data.environment,
                    data.cpus_scheduled,
                    data.mem_scheduled,
                    data.disk_in_scheduled,
                    data.disk_out_scheduled,
                    data.disk_total_scheduled,
                    data.results,
                    data.current_stdout_url,
                    data.current_stderr_url,
                    data.results_manifest
                );
            }
            return new JobExecution();
        };

        JobExecution.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobExecution.build)
                    .filter(Boolean);
            }
            return JobExecution.build(data);
        };

        return JobExecution;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobExecutionLog', ['scaleConfig', 'Job', 'Node', function (scaleConfig, Job, Node) {
        var JobExecutionLog = function (id, status, command_arguments, timeout, exit_code, created, queued, scheduled, pre_started, pre_completed, job_started, job_completed, post_started, post_completed, ended, last_modified, job, node, error, is_finished, stdout, stderr) {
            this.id = id;
            this.status = status;
            this.command_arguments = command_arguments;
            this.timeout = timeout;
            this.exit_code = exit_code;
            this.created = created;
            this.queued = queued;
            this.scheduled = scheduled;
            this.pre_started = pre_started;
            this.pre_completed = pre_completed;
            this.job_started = job_started;
            this.job_completed = job_completed;
            this.post_started = post_started;
            this.post_completed = post_completed;
            this.ended = ended;
            this.last_modified = last_modified;
            this.job = Job.transformer(job);
            this.node = Node.transformer(node);
            this.error = error;
            this.is_finished = is_finished;
            this.stdout = stdout;
            this.stdoutHtml = stdout ? stdout.replace(new RegExp('\r?\n','g'), '<br />') : '';
            this.stderr = stderr;
        };

        // public methods
        JobExecutionLog.prototype = {
            toHtml: function(instr){
                return instr
            }

        };

        // static methods, assigned to class
        JobExecutionLog.build = function (data) {
            if (data) {
                return new JobExecutionLog(
                    data.id,
                    data.status,
                    data.command_arguments,
                    data.timeout,
                    data.exit_code,
                    data.created,
                    data.queued,
                    data.scheduled,
                    data.pre_started,
                    data.pre_completed,
                    data.job_started,
                    data.job_completed,
                    data.post_started,
                    data.post_completed,
                    data.ended,
                    data.last_modified,
                    data.job,
                    data.node,
                    data.error,
                    data.is_finished,
                    data.stdout,
                    data.stderr
                );
            }
            return new JobExecutionLog();
        };

        JobExecutionLog.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobExecutionLog.build)
                    .filter(Boolean);
            }
            return JobExecutionLog.build(data);
        };

        return JobExecutionLog;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobType', ['scaleConfig', 'JobTypeInterface', function (scaleConfig, JobTypeInterface) {
        var JobType = function (id, name, title, version, description, is_system, is_long_running, is_active, is_operational, is_paused, uses_docker, docker_privileged, docker_image, priority, timeout, max_tries, cpus_required, mem_required, disk_out_const_required, disk_out_mult_required, icon_code, created, archived, paused, last_modified, job_type_interface) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.version = version;
            this.description = description;
            this.is_system = is_system;
            this.is_long_running = is_long_running;
            this.is_active = is_active;
            this.is_operational = is_operational;
            this.is_paused = is_paused;
            this.uses_docker = uses_docker;
            this.docker_privileged = docker_privileged;
            this.docker_image = docker_image;
            this.priority = priority;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_out_const_required = disk_out_const_required;
            this.disk_out_mult_required = disk_out_mult_required;
            this.icon_code = icon_code;
            this.created = created;
            this.archived = archived;
            this.paused = paused;
            this.last_modified = last_modified;
            this.job_type_interface = JobTypeInterface.transformer(job_type_interface);
        };

        // public methods
        JobType.prototype = {
            toString: function () {
                return 'JobType';
            },
            getIcon: function () {
                return this.icon_code ? '<i class="fa fa-fw">&#x' + this.icon_code + '</i>' : '<i class="fa fa-fw">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getCellText: function () {
                return this.icon_code ? '&#x' + this.icon_code + ';' : '&#x' + scaleConfig.defaultIconCode + ';';
            },
            getCellTitle: function () {
                return this.title;
            }
        };

        // static methods, assigned to class
        JobType.build = function (data) {
            if (data) {
                return new JobType(
                    data.id,
                    data.name,
                    data.title,
                    data.version,
                    data.description,
                    data.is_system,
                    data.is_long_running,
                    data.is_active,
                    data.is_operational,
                    data.is_paused,
                    data.uses_docker,
                    data.docker_privileged,
                    data.docker_image,
                    data.priority,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_out_const_required,
                    data.disk_out_mult_required,
                    data.icon_code,
                    data.created,
                    data.archived,
                    data.paused,
                    data.last_modified,
                    data.interface
                );
            }
            return new JobType();
        };

        JobType.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobType.build)
                    .filter(Boolean);
            }
            return JobType.build(data);
        };

        return JobType;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeDetails', ['scaleConfig', 'JobTypeInterface', 'JobTypeErrorMapping', 'JobTypeError', 'scaleService', function (scaleConfig, JobTypeInterface, JobTypeErrorMapping, JobTypeError, scaleService) {
        var JobTypeDetails = function (id, name, version, title, description, category, author_name, author_url, is_system, is_long_running, is_active, is_operational, is_paused, icon_code, uses_docker, docker_privileged, docker_image, revision_num, priority, timeout, max_scheduled, max_tries, cpus_required, mem_required, shared_mem_required, disk_out_const_required, disk_out_mult_required, created, archived, paused, last_modified, job_type_interface, error_mapping, trigger_rule, errors, job_counts_6h, job_counts_12h, job_counts_24h) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.category = category;
            this.author_name = author_name;
            this.author_url = author_url;
            this.is_system = is_system;
            this.is_long_running = is_long_running;
            this.is_active = is_active;
            this.is_operational = is_operational;
            this.is_paused = is_paused;
            this.icon_code = icon_code;
            this.uses_docker = uses_docker;
            this.docker_privileged = docker_privileged;
            this.docker_image = docker_image;
            this.revision_num = revision_num;
            this.priority = priority;
            this.timeout = timeout;
            this.max_scheduled = max_scheduled;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.mem_required_formatted = scaleService.calculateFileSizeFromMib(mem_required);
            this.shared_mem_required = shared_mem_required;
            this.shared_mem_required_formatted = scaleService.calculateFileSizeFromMib(shared_mem_required);
            this.disk_out_const_required = disk_out_const_required;
            this.disk_out_const_required_formatted = scaleService.calculateFileSizeFromMib(disk_out_const_required);
            this.disk_out_mult_required = disk_out_mult_required;
            this.created = created;
            this.archived = archived;
            this.paused = paused;
            this.last_modified = last_modified;
            this.job_type_interface = job_type_interface;
            this.error_mapping = JobTypeErrorMapping.transformer(error_mapping);
            this.trigger_rule = trigger_rule;
            this.errors = JobTypeError.transformer(errors);
            this.job_counts_6h = job_counts_6h;
            this.job_counts_12h = job_counts_12h;
            this.job_counts_24h = job_counts_24h;
        };

        // public methods
        JobTypeDetails.prototype = {
            getIcon: function () {
                return this.icon_code ? '<i class="fa">&#x' + this.icon_code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getPerformance: function () {
                var failed6Arr = _.where(this.job_counts_6h, { 'status': 'FAILED' }),
                    failed12Arr = _.where(this.job_counts_12h, { 'status': 'FAILED' }),
                    failed24Arr = _.where(this.job_counts_24h, { 'status': 'FAILED' });

                var completed6 = _.find(this.job_counts_6h, 'status', 'COMPLETED') || { count: 0 },
                    failed6 = _.sum(failed6Arr, 'count'),
                    total6 = failed6Arr.length > 0 ? failed6 + completed6.count : completed6.count,
                    successRate6 = total6 === 0 ? 0 : 100 - ((failed6 / total6) * 100).toFixed(2),
                    completed12 = _.find(this.job_counts_12h, 'status', 'COMPLETED') || { count: 0 },
                    failed12 = _.sum(failed12Arr, 'count'),
                    total12 = failed12Arr.length > 0 ? failed12 + completed12.count : completed12.count,
                    successRate12 = total12 === 0 ? 0 : 100 - ((failed12 / total12) * 100).toFixed(2),
                    completed24 = _.find(this.job_counts_24h, 'status', 'COMPLETED') || { count: 0 },
                    failed24 = _.sum(failed24Arr, 'count'),
                    total24 = failed24Arr.length > 0 ? failed24 + completed24.count : completed24.count,
                    successRate24 = total24 === 0 ? 0 : 100 - ((failed24 / total24) * 100).toFixed(2);

                return {
                    hour6: {
                        rate: successRate6,
                        failed: failed6,
                        completed: completed6.count,
                        total: total6
                    },
                    hour12: {
                        rate: successRate12,
                        failed: failed12,
                        completed: completed12.count,
                        total: total12
                    },
                    hour24: {
                        rate: successRate24,
                        failed: failed24,
                        completed: completed24.count,
                        total: total24
                    }
                };
            },
            getFailures: function () {
                var failed6 = _.where(this.job_counts_6h, { 'status': 'FAILED' }),
                    failed6Values = _.values(_.groupBy(failed6, 'category')),
                    failed12 = _.where(this.job_counts_12h, { 'status': 'FAILED' }),
                    failed12Values = _.values(_.groupBy(failed12, 'category')),
                    failed24 = _.where(this.job_counts_24h, { 'status': 'FAILED' }),
                    failed24Values = _.values(_.groupBy(failed24, 'category'));

                var getFailureCounts = function (categories) {
                    var returnArr = [];
                    _.forEach(categories, function (category) {
                        _.forEach(category, function (val) {
                            returnArr.push({ status: val.category, count: val.count });
                        });
                    });
                    return returnArr;
                };

                return {
                    hour6: getFailureCounts(failed6Values),
                    hour12: getFailureCounts(failed12Values),
                    hour24: getFailureCounts(failed24Values)
                };
            }
        };

        // static methods, assigned to class
        JobTypeDetails.build = function (data) {
            if (data) {
                // TODO: change property returned by API from "interface" to "job_type_interface" because "interface" is a reserved word in JS
                var jobTypeInterface = data.interface ? data.interface : data.job_type_interface;
                return new JobTypeDetails(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.category,
                    data.author_name,
                    data.author_url,
                    data.is_system,
                    data.is_long_running,
                    data.is_active,
                    data.is_operational,
                    data.is_paused,
                    data.icon_code,
                    data.uses_docker,
                    data.docker_privileged,
                    data.docker_image,
                    data.revision_num,
                    data.priority,
                    data.timeout,
                    data.max_scheduled,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.shared_mem_required,
                    data.disk_out_const_required,
                    data.disk_out_mult_required,
                    data.created,
                    data.archived,
                    data.paused,
                    data.last_modified,
                    jobTypeInterface,
                    data.error_mapping,
                    data.trigger_rule,
                    data.errors,
                    data.job_counts_6h,
                    data.job_counts_12h,
                    data.job_counts_24h
                );
            }
            return new JobTypeDetails();
        };

        JobTypeDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeDetails.build);
            }
            return JobTypeDetails.build(data);
        };

        return JobTypeDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeError', ['moment', 'scaleConfig', function (moment, scaleConfig) {
        var JobTypeError = function (id, name, title, description, category, created, last_modified) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.category = category;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
        };

        // public methods
        JobTypeError.prototype = {

        };

        // static methods, assigned to class
        JobTypeError.build = function (data) {
            if (data) {
                return new JobTypeError(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.category,
                    data.created,
                    data.last_modified
                );
            }
            return new JobTypeError();
        };

        JobTypeError.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeError.build)
                    .filter(Boolean);
            }
            return JobTypeError.build(data);
        };

        return JobTypeError;
    }])
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').factory('JobTypeErrorMapping', function () {
        var JobTypeErrorMapping = function (version, exit_codes) {
            this.version = version;
            this.exit_codes = exit_codes;
        };

        // public methods
        JobTypeErrorMapping.prototype = {

        };

        // static methods, assigned to class
        JobTypeErrorMapping.build = function (data) {
            if (data) {
                return new JobTypeErrorMapping(
                    data.version,
                    data.exit_codes
                );
            }
            return new JobTypeErrorMapping();
        };

        JobTypeErrorMapping.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeErrorMapping.build)
                    .filter(Boolean);
            }
            return JobTypeErrorMapping.build(data);
        };

        return JobTypeErrorMapping;
    })
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeInputData', ['scaleConfig', function (scaleConfig) {
        var JobTypeInputData = function (media_types, required, type, name) {
            this.media_types = media_types;
            this.required = required;
            this.type = type;
            this.name = name;
        };

        // public methods
        JobTypeInputData.prototype = {

        };

        // static methods, assigned to class
        JobTypeInputData.build = function (data) {
            if (data) {
                return new JobTypeInputData(
                    data.media_types,
                    data.required,
                    data.type,
                    data.name
                );
            }
            return new JobTypeInputData();
        };

        JobTypeInputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeInputData.build);
            }
            return JobTypeInputData.build(data);
        };

        return JobTypeInputData;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeInterface', ['scaleConfig', 'JobTypeInputData', 'JobTypeOutputData', function (scaleConfig, JobTypeInputData, JobTypeOutputData) {
        var JobTypeInterface = function (version, command, command_arguments, input_data, output_data) {
            this.version = version;
            this.command = command;
            this.command_arguments = command_arguments;
            this.input_data = JobTypeInputData.transformer(input_data);
            this.output_data = JobTypeOutputData.transformer(output_data);
        };

        // public methods
        JobTypeInterface.prototype = {
            getIcon: function () {
                return this.iconCode ? '<i class="fa">&#x' + this.iconCode + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            }
        };

        // static methods, assigned to class
        JobTypeInterface.build = function (data) {
            if (data) {
                return new JobTypeInterface(
                    data.version,
                    data.command,
                    data.command_arguments,
                    data.input_data,
                    data.output_data
                );
            }
            return new JobTypeInterface();
        };

        JobTypeInterface.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeInterface.build)
                    .filter(Boolean);
            }
            return JobTypeInterface.build(data);
        };

        return JobTypeInterface;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeOutputData', function () {
        var JobTypeOutputData = function (name, type, required, media_type) {
            this.name = name;
            this.type = type;
            this.required = required;
            this.media_type = media_type;
        };

        // public methods
        JobTypeOutputData.prototype = {

        };

        // static methods, assigned to class
        JobTypeOutputData.build = function (data) {
            if (data) {
                return new JobTypeOutputData(
                    data.name,
                    data.type,
                    data.required,
                    data.media_type
                );
            }
            return new JobTypeOutputData();
        };

        JobTypeOutputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeOutputData.build)
                    .filter(Boolean);
            }
            return JobTypeOutputData.build(data);
        };

        return JobTypeOutputData;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeStatus', ['scaleConfig', 'JobType', 'JobExecution', function (scaleConfig, JobType, JobExecution) {
        var JobTypeStatus = function (job_type, job_counts) {
            this.job_type = JobType.transformer(job_type);
            this.job_counts = job_counts;
            this.has_running = _.find(job_counts, 'status', 'RUNNING');
            this.description = this.getPerformance().rateDescription;
        };

        // public methods
        JobTypeStatus.prototype = {
            toString: function () {
                return 'JobTypeStatus';
            },
            getPerformance: function () {
                var failedArr = _.sortByOrder(_.filter(this.job_counts, { status: 'FAILED' }), ['count'], ['desc']),
                    completed = _.find(this.job_counts, 'status', 'COMPLETED') || { count: 0 },
                    failed = _.sum(failedArr, 'count'),
                    failedCategory = failedArr.length > 0 ? failedArr[0].category : '',
                    total = failedArr.length > 0 ? failed + completed.count : completed.count,
                    successRate = total === 0 ? 0 : 100 - ((failed / total) * 100).toFixed(2),
                    successRateDescription = 'success';

                if (successRate <= 30 && total > 0) {
                    successRateDescription = 'error';
                } else if (successRate > 30 && successRate <= 60 && total > 0) {
                    successRateDescription = 'warning';
                } else if (total === 0 && !this.has_running) {
                    successRateDescription = 'z_inactive'; // prepend with 'z_' for ordering purposes
                }

                return {
                    rate: successRate,
                    rateDescription: successRateDescription,
                    failed: failed,
                    failedCategory: failedCategory,
                    completed: completed.count,
                    total: total
                };
            },
            getRunning: function () {
                return _.find(this.job_counts, 'status', 'RUNNING') || { count: 0 };
            },
            getFailures: function () {
                var failed = _.where(this.job_counts, { 'status': 'FAILED' });

                _.forEach(failed, function (f) {
                    var category = _.find(scaleConfig.errorCategories, { name: f.category });
                    f.order = category ? category.order : '';
                });

                var failedValues = _.values(_.groupBy(failed, 'order'));

                var getFailureCounts = function (categories) {
                    var returnArr = [];
                    _.forEach(categories, function (category) {
                        _.forEach(category, function (val) {
                            returnArr.push({ status: val.category, count: val.count, order: val.order });
                        });
                    });
                    return _.sortByOrder(returnArr, ['order'], ['desc']);
                };

                return getFailureCounts(failedValues);
            },
            getCellFill: function () {
                var status = this.getPerformance();
                if (status.rateDescription === 'z_inactive') {
                    return scaleConfig.colors.chart_gray_dark;
                }
                return scaleConfig.colors.chart_green;
            },
            getCellActivity: function () {
                var running = this.getRunning();
                if (running.count > 0) {
                    return '&#x' + scaleConfig.activityIconCode + ';';
                }
                return '';
            },
            getCellActivityTotal: function () {
                return this.getRunning().count > 0 ? this.getRunning().count : '';
            },
            getCellError: function () {
                var performance = this.getPerformance();
                return 'Failed: ' + (performance.failed);
            },
            getCellTotal: function () {
                var performance = this.getPerformance();
                return performance.completed;
            },
            getCellPauseResume: function () {
                return;
            },
            getCellFailures: function () {
                return _.map(this.getFailures(), 'status');
            }
        };

        // static methods, assigned to class
        JobTypeStatus.build = function (data) {
            if (data) {
                return new JobTypeStatus(
                    data.job_type,
                    data.job_counts
                );
            }
            return new JobTypeStatus();
        };

        JobTypeStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeStatus.build)
                    .filter(Boolean);
            }
            return JobTypeStatus.build(data);
        };

        return JobTypeStatus;
    }]);
})();

(function (){
    'use strict';

    angular.module('scaleApp').factory('Product', ['JobType', 'scaleService', 'scaleConfig', function (JobType, scaleService, scaleConfig) {
        var Product = function (id, workspace, file_name, media_type, file_size, data_type, is_deleted, uuid, url, created, deleted, data_started, data_ended, geometry, center_point, meta_data, countries, last_modified, is_operational, is_published, published, unpublished, job_type, job, job_exe, update, source_files) {
            this.id = id;
            this.workspace = workspace;
            this.file_name = file_name;
            this.media_type = media_type;
            this.file_size = file_size;
            this.file_size_readable = this.getReadableFileSize();
            this.data_type = data_type;
            this.is_deleted = is_deleted;
            this.uuid = uuid;
            this.url = url;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.deleted = deleted;
            this.data_started = data_started;
            this.data_ended = data_ended;
            this.geometry = geometry;
            this.center_point = center_point;
            this.meta_data = meta_data;
            this.countries = countries;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
            this.is_operational = is_operational;
            this.is_operational_label = is_operational ? 'Operational' : 'R&amp;D';
            this.is_published = is_published;
            this.published = published;
            this.unpublished = unpublished;
            this.job_type = JobType.transformer(job_type);
            this.job = job;
            this.job_exe = job_exe;
            this.update = update;
            this.source_files = source_files;
        };

        // public methods
        Product.prototype = {
            getDuration: function () {
                return moment.utc(this.last_modified).diff(moment.utc(this.created));
            },
            getReadableFileSize: function () {
                return scaleService.calculateFileSizeFromBytes(this.file_size);
            }
        };

        // static methods, assigned to class
        Product.build = function (data) {
            if (data) {
                return new Product(
                    data.id,
                    data.workspace,
                    data.file_name,
                    data.media_type,
                    data.file_size,
                    data.data_type,
                    data.is_deleted,
                    data.uuid,
                    data.url,
                    data.created,
                    data.deleted,
                    data.data_started,
                    data.data_ended,
                    data.geometry,
                    data.center_point,
                    data.meta_data,
                    data.countries,
                    data.last_modified,
                    data.is_operational,
                    data.is_published,
                    data.published,
                    data.unpublished,
                    data.job_type,
                    data.job,
                    data.job_exe,
                    data.update,
                    data.source_files
                );
            }
            return new Product();
        };

        Product.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Product.build)
                    .filter(Boolean);
            }
            return Product.build(data);
        };

        return Product;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RunningJob', ['scaleConfig', 'scaleService', 'JobType', function (scaleConfig, scaleService, JobType) {
        var RunningJob = function (count, longest_running, job_type) {
            this.count = count;
            this.longest_running = longest_running;
            this.job_type = JobType.transformer(job_type);
        };

        // public methods
        RunningJob.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.longest_running, moment.utc().toISOString());
            },
            getIcon: function () {
                var icon = this.job_type.icon_code ? '<i class="fa fa-fw">&#x' + this.job_type.icon_code + '</i>' : '<i class="fa fa-fw">&#x' + scaleConfig.defaultIconCode + '</i>';
                return icon;
            }
        };

        // static methods, assigned to class
        RunningJob.build = function (data) {
            if (data) {
                return new RunningJob(
                    data.count,
                    data.longest_running,
                    data.job_type
                );
            }
            return new RunningJob();
        };

        RunningJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RunningJob.build)
                    .filter(Boolean);
            }
            return RunningJob.build(data);
        };

        return RunningJob;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('SystemFailure', ['scaleConfig', 'scaleService', function (scaleConfig, scaleService) {
        var SystemFailure = function (count, job_type_name, job_type_version, error_name, first_error, last_error) {
            this.count = count;
            this.job_type_name = job_type_name;
            this.job_type_version = job_type_version;
            this.error_name = error_name;
            this.first_error = first_error;
            this.last_error = last_error;
        };

        // public methods
        SystemFailure.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.first_error, this.last_error);
            },
            getIcon: function () {
                var configJobType = _.find(scaleConfig.jobTypes, 'title', this.job_type_name);
                if (configJobType) {
                    return configJobType.icon;
                }
                return scaleConfig.defaultIcon;
            }
        };

        // static methods, assigned to class
        SystemFailure.build = function (data) {
            if (data) {
                return new SystemFailure(
                    data.count,
                    data.job_type_name,
                    data.job_type_version,
                    data.error_name,
                    data.first_error,
                    data.last_error
                );
            }
            return new SystemFailure();
        };

        SystemFailure.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(SystemFailure.build)
                    .filter(Boolean);
            }
            return SystemFailure.build(data);
        };

        return SystemFailure;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('loadController', ['$scope', '$location', 'scaleService', 'stateService', 'navService', 'loadService', 'uiGridConstants', 'scaleConfig', 'subnavService', 'QueueStatus', 'gridFactory', function($scope, $location, scaleService, stateService, navService, loadService, uiGridConstants, scaleConfig, subnavService, QueueStatus, gridFactory) {
        var vm = this;
        
        vm.loading = true;
        vm.queueStatusError = null;
        vm.queueStatusErrorStatus = null;
        vm.totalQueued = 0;
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/queued');
        
        var jobsParams = stateService.getJobsParams();

        vm.getPage = function (pageNumber, pageSize) {
            vm.loading = true;
            loadService.getQueueStatus(pageNumber - 1, pageSize).then(function (data) {
                var newData = [];
                for (var i = 0; i < vm.gridOptions.paginationPageSize; i++) {
                    newData.push(data.jobs[i]);
                }
                vm.gridOptions.minRowsToShow = newData.length;
                vm.gridOptions.virtualizationThreshold = newData.length;
                vm.gridOptions.data = newData;
            }).catch(function (error) {
                vm.status = 'Unable to load queue status: ' + error.message;
                console.error(vm.status);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            vm.gridOptions = gridFactory.defaultGridOptions();
            vm.gridOptions.enableSorting = false;
            vm.gridOptions.columnDefs = [
                {
                    field: 'job_type.title',
                    displayName: 'Job Type',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }}</div>'
                },
                { field: 'job_type.version', displayName: 'Version', enableFiltering: false },
                { field: 'highest_priority', enableFiltering: false },
                {
                    field: 'longestQueued',
                    displayName: 'Duration of Longest Queued Job',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
                },
                { field: 'count', enableFiltering: false }
            ];
            vm.gridOptions.data = [];
            vm.gridOptions.onRegisterApi = function (gridApi) {
                //set gridApi on scope
                vm.gridApi = gridApi;
                gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    stateService.setJobsParams({job_type_id: row.entity.job_type.id, status: 'QUEUED', page: jobsParams.page, page_size: jobsParams.page_size, order: jobsParams.order});
                    $location.path('/jobs');
                });
                vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    vm.getPage(currentPage, pageSize);
                });
            };


            loadService.getQueueStatus(0, vm.gridOptions.paginationPageSize).then(null, null, function (result) {
                if (result.$resolved) {
                    vm.gridOptions.minRowsToShow = result.results.length;
                    vm.gridOptions.virtualizationThreshold = result.results.length;
                    vm.gridOptions.data = result.results;
                    vm.gridOptions.totalItems = result.results.length;
                    vm.totalQueued = _.sum(result.results, 'count');
                    console.log('queue status updated');
                } else {
                    if (result.statusText && result.statusText !== '') {
                        vm.queueStatusErrorStatus = result.statusText;
                    }
                    vm.queueStatusError = 'Unable to retrieve queue status.';
                }
                vm.loading = false
            });

            navService.updateLocation('load');
        };
        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('loadDepthController', ['$scope', '$location', 'navService', 'scaleConfig', 'subnavService', function ($scope, $location, navService, scaleConfig, subnavService) {
        var vm = this;
        
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/depth');

        vm.loading = false;

        var initialize = function () {
            navService.updateLocation('load');
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('queueRunningController', ['$scope', '$location', 'scaleService', 'stateService', 'navService', 'jobService', 'gridFactory', 'uiGridConstants', 'scaleConfig', 'subnavService', function($scope, $location, scaleService, stateService, navService, jobService, gridFactory, uiGridConstants, scaleConfig, subnavService) {
        var vm = this;
        
        vm.loading = true;
        vm.runningJobsError = null;
        vm.runningJobsErrorStatus = null;
        vm.totalRunning = 0;
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/running');

        var jobsParams = stateService.getJobsParams();

        vm.getPage = function (pageNumber, pageSize){
            vm.loading = true;
            jobService.getRunningJobsOnce(pageNumber - 1, pageSize).then(function (data) {
                var newData = [];
                for(var i = 0; i < vm.gridOptions.paginationPageSize; i++){
                    newData.push(data.results[i]);
                }
                vm.gridOptions.minRowsToShow = newData.length;
                vm.gridOptions.virtualizationThreshold = newData.length;
                vm.gridOptions.data = newData;
            }).catch(function (error) {
                vm.status = 'Unable to load queue running status: ' + error.message;
                console.error(vm.status);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            vm.gridOptions = gridFactory.defaultGridOptions();
            vm.gridOptions.enableSorting = false;
            vm.gridOptions.columnDefs = [
                {
                    field: 'title',
                    displayName: 'Job Type',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.getIcon()"></span> {{ row.entity.job_type.title }}</div>'
                },
                {field: 'job_type.version', displayName: 'Version', enableFiltering: false},
                {field: 'count', displayName: 'Number of Jobs', enableFiltering: false},
                {
                    field: 'longestRunning',
                    displayName: 'Duration of Longest Running Job',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
                }
            ];
            vm.gridOptions.data = [];
            vm.gridOptions.onRegisterApi = function (gridApi) {
                // set gridApi on scope
                vm.gridApi = gridApi;
                gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    stateService.setJobsParams({job_type_id: row.entity.job_type.id, status: 'RUNNING', page: jobsParams.page, page_size: jobsParams.page_size, order: jobsParams.order});
                    $location.path('/jobs');
                });
                vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    vm.getPage(currentPage, pageSize);
                });
            };

            jobService.getRunningJobs(0, vm.gridOptions.paginationPageSize).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.gridOptions.minRowsToShow = data.results.length;
                    vm.gridOptions.virtualizationThreshold = data.results.length;
                    vm.gridOptions.data = data.results;
                    vm.gridOptions.totalItems = data.results.length;
                    vm.totalRunning = _.sum(data.results, 'count');
                    console.log('running jobs updated');
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.runningJobsErrorStatus = data.statusText;
                    }
                    vm.runningJobsError = 'Unable to retrieve running jobs.';
                }
                vm.loading = false;
            });
            navService.updateLocation('load');
        };
        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobExecutionService', ['$http', '$q', '$resource', 'stateService', 'poller', 'scaleConfig', 'JobExecution', 'JobExecutionLog', function ($http, $q, $resource, stateService, poller, scaleConfig, JobExecution, JobExecutionLog) {

        var getJobExecutionsParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, node_id) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                status: status,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                node_id: node_id
            };
        };

        return {
            getJobExecutions: function (params) {
                params = params || getJobExecutionsParams();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('job-executions') + 'job-executions/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobExecution.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobExecutionDetails: function (id) {
                var d = $q.defer();

                $http.get(scaleConfig.getUrlPrefix('job-executions') + 'job-executions/' + id + '/').success(function (data) {
                    d.resolve(JobExecution.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getLogOnce: function(execId){
                var d = $q.defer();

                $http({
                    method: 'GET',
                    url: scaleConfig.getUrlPrefix('job-executions') + 'job-executions/' + execId + '/logs/combined/'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getLog: function(execId){
                var url = url || scaleConfig.getUrlPrefix('job-executions') + 'job-executions/' + execId + '/logs/combined/';

                // Update view. Since a promise can only be resolved or rejected once but we want
                // to keep track of all requests, poller service uses the notifyCallback. By default
                // poller only gets notified of success responses.
                var jobExecutionLogResource = $resource(url,{},{
                    get:{
                        method:'GET',
                        interceptor: {
                            response: function (response) {
                                var result = response.resource;
                                result.$status = response.status;
                                result.$statusText = response.statusText;
                                return result;
                            }
                        }
                    }
                });

                var jobExecutionLogPoller = poller.get(jobExecutionLogResource, {
                    action: 'get',
                    delay: scaleConfig.pollIntervals.jobExecutionLog,
                    argumentsArray: function () {
                        return stateService.getLogArgs();
                    }
                });

                stateService.setJobExecutionLogPoller(jobExecutionLogPoller);

                return jobExecutionLogPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        // result.execution_log = JobExecutionLog.transformer(result);
                        // if(result.execution_log.status === 'COMPLETED' || result.execution_log.status === 'FAILED'){
                        //     jobExecutionLogPoller.stop();
                        // }
                        return result;
                    } else {
                        jobExecutionLogPoller.stop();
                        return result;
                    }

                });
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobService', ['$http', '$q', '$resource', 'scaleConfig', 'Job', 'JobDetails', 'RunningJob', 'poller', 'pollerFactory', function($http, $q, $resource, scaleConfig, Job, JobDetails, RunningJob, poller, pollerFactory) {

        var getJobsParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                status: status,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                url: url
            };
        };

        var getJobUpdateData = function (status) {
            return {
                status: status
            };
        };

        return {
            getJobs: function (params) {
                params = params || getJobsParams();
                params.url = params.url ? params.url : scaleConfig.getUrlPrefix('jobs') + 'jobs/';

                var jobsResource = $resource(params.url, params),
                    jobsPoller = pollerFactory.newPoller(jobsResource, scaleConfig.pollIntervals.jobs);

                return jobsPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = Job.transformer(data.results);
                    } else {
                        jobsPoller.stop();
                    }
                    return data;
                });
            },
            getJobsOnce: function (params) {
                params = params || getJobsParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.getUrlPrefix('jobs') + 'jobs/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Job.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getJobCountsByStatus: function (hour) {
                hour = hour || 3;
                var d = $q.defer();

                $http.get(scaleConfig.urls.getJobCountsByStatus(hour)).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobDetail: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('jobs') + 'jobs/' + id + '/').success(function (data) {
                    d.resolve(JobDetails.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getRunningJobs: function (pageNumber, pageSize) {
                var params = {
                    pageNumber: pageNumber,
                    pageSize: pageSize
                };
                var runningJobsResource = $resource(scaleConfig.getUrlPrefix('job-types') + 'job-types/running/', params),
                    runningJobsPoller = pollerFactory.newPoller(runningJobsResource, scaleConfig.pollIntervals.runningJobs);

                return runningJobsPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = RunningJob.transformer(data.results);
                    } else {
                        runningJobsPoller.stop();
                    }
                    return data;
                });
            },
            getRunningJobsOnce: function (pageNumber, pageSize) {
                var params = {
                    pageNumber: pageNumber,
                    pageSize: pageSize
                };
                var d = $q.defer();

                $http.get(scaleConfig.getUrlPrefix('job-types') + 'job-types/running/', params).success(function (data) {
                    data.results = RunningJob.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            updateJob: function (id, data) {
                data = data || getJobUpdateData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('jobs') + 'jobs/' + id + '/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobTypeService', ['$http', '$q', '$resource', 'poller', 'pollerFactory', 'scaleConfig', 'jobService', 'JobType', 'JobTypeDetails', 'JobTypeStatus', function ($http, $q, $resource, poller, pollerFactory, scaleConfig, jobService, JobType, JobTypeDetails, JobTypeStatus) {
        /*var totalJobTypes = 5;

        var getTotalJobTypes = function () {
            return totalJobTypes;
        };

        var setTotalJobTypes = function () {
            totalJobTypes = Math.floor(Math.random() * (20 - 1 + 1)) + 1;
        };

        setInterval(function () {
            setTotalJobTypes();
        }, 3100);*/

        var getJobTypeParams = function (page, page_size, started, ended, name, category, order) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended,
                name: name,
                category: category,
                order: order ? order : ['title', 'version']
            };
        };

        var getJobTypeStatusParams = function (page, page_size, started, ended) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended
            };
        };

        return {
            getJobTypes: function (params) {
                params = params || getJobTypeParams();
                // var params = {
                //     order: order || ['name','version']
                // };

                var jobTypesResource = $resource(scaleConfig.getUrlPrefix('job-types') + 'job-types/', params),
                    jobTypesPoller = pollerFactory.newPoller(jobTypesResource, scaleConfig.pollIntervals.jobTypes);

                return jobTypesPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returnResult = {
                            $resolved: true,
                            job_types: []
                        };
                        for (var i = 1; i < getTotalJobTypes(); i++) {
                            returnResult.job_types.push(
                                {
                                    "is_system": true,
                                    "paused": null,
                                    "disk": 64.0,
                                    "id": i,
                                    "docker_image": null,
                                    "archived": null,
                                    "uses_docker": false,
                                    "priority": 10,
                                    "version": "1.0",
                                    "icon_code": scaleConfig.jobTypes[i - 1].code,
                                    "description": "Ingests a source file into a workspace",
                                    "mem": 64.0,
                                    "is_active": true,
                                    "cpus": 1.0,
                                    "last_modified": "2015-03-11T00:00:00Z",
                                    "max_tries": 3,
                                    "is_paused": false,
                                    "name": scaleConfig.jobTypes[i - 1].title,
                                    "created": "2015-03-11T00:00:00Z",
                                    "timeout": 1800,
                                    "is_long_running": false
                                }
                            )
                        }
                        result = returnResult;*/

                        data.results = JobType.transformer(data.results);
                        return data;
                    } else {
                        jobTypesPoller.stop();
                        return data;
                    }
                });
            },
            getJobTypesOnce: function (params) {
                params = params || getJobTypeParams();

                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('job-types') + 'job-types/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobType.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobTypeStatus: function (params) {
                params = params || getJobTypeStatusParams();

                var jobTypeStatusResource = $resource(scaleConfig.getUrlPrefix('job-types') + 'job-types/status/', params),
                    jobTypeStatusPoller = pollerFactory.newPoller(jobTypeStatusResource, scaleConfig.pollIntervals.jobTypeStatus);

                return jobTypeStatusPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returndata = {
                            $resolved: true,
                            job_type_stats: []
                        };
                        for (var i = 0; i < getTotalJobTypes(); i++) {
                            returndata.job_type_stats.push(
                                {
                                    "id": i,
                                    "icon_code": "",
                                    "name": "",
                                    "version": "",
                                    "num_completed": Math.floor(Math.random() * (20000 - 10000 + 1)) + 10000,
                                    "num_canceled": Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                                    "num_error_DATA": Math.floor(Math.random() * (9000 - 20 + 1)) + 20,
                                    "num_error_SYSTEM": Math.floor(Math.random() * (9000 - 20 + 1)) + 20,
                                    "num_error_ALGORITHM": Math.floor(Math.random() * (9000 - 20 + 1)) + 20
                                }
                            )
                        }
                        data = returndata;*/

                        data.results = JobTypeStatus.transformer(data.results);
                    } else {
                        jobTypeStatusPoller.stop();
                    }
                    return data;
                });
            },
            getJobTypeStatusOnce: function (params) {
                var d = $q.defer();

                params = params || getJobTypeStatusParams();

                $http({
                    url: scaleConfig.getUrlPrefix('job-types') + 'job-types/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobTypeStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobTypeDetails: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('job-types') + 'job-types/' + id + '/').success(function (data) {
                    d.resolve(JobTypeDetails.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            updateJobType: function (data){
                var updatedJobType = function(data){
                    return {
                        error_mappings: data.error_mappings,
                        is_paused: data.is_paused
                    };
                };
                var updatedData = updatedJobType(data);
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('job-types') + 'job-types/' + data.id + '/',
                    method: 'PATCH',
                    data: updatedData
                }).success(function (result) {
                    d.resolve(JobTypeDetails.transformer(result));
                }).error(function (error) {
                    d.reject(error);
                });                
                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('QueueStatus', ['scaleConfig', 'scaleService', 'JobType', function (scaleConfig, scaleService, JobType) {
        var QueueStatus = function (job_type, count, longest_queued, highest_priority) {
            this.job_type = JobType.transformer(job_type);
            this.count = count;
            this.longest_queued = longest_queued;
            this.highest_priority = highest_priority;
        };

        // public methods
        QueueStatus.prototype = {
            getIcon: function () {
                return this.job_type.icon_code ? '<i class="fa">&#x' + this.job_type.icon_code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getDuration: function () {
                return scaleService.calculateDuration(this.longest_queued, moment.utc().toISOString());
            }
        };

        // static methods, assigned to class
        QueueStatus.build = function (data) {
            if (data) {
                return new QueueStatus(
                    data.job_type,
                    data.count,
                    data.longest_queued,
                    data.highest_priority
                );
            }
            return new QueueStatus();
        };

        QueueStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(QueueStatus.build);
            }
            return QueueStatus.build(data);
        };

        return QueueStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('loadService', ['$http', '$q', '$resource', 'scaleConfig', 'poller', 'pollerFactory', 'QueueStatus', function($http, $q, $resource, scaleConfig, poller, pollerFactory, QueueStatus) {
        var getJobLoadParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, url) {
            return {
                started: started,
                ended: ended,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                page_size: 1000,
                url: url
            };
        };

        var getRequeueJobsParams = function (started, ended, job_status, job_type_ids, job_type_names, job_type_categories, priority, url) {
            return {
                started: started,
                ended: ended,
                job_status: job_status,
                job_ids: job_ids,
                job_type_ids: job_type_ids,
                job_type_names: job_type_names,
                job_type_categories: job_type_categories,
                priority: priority,
                url: url
            };
        };

        return {
            getQueueStatus: function (pageNumber, pageSize) {
                var params = {
                    page_number: pageNumber,
                    page_size: pageSize
                };

                var queueStatusResource = $resource(scaleConfig.getUrlPrefix('queue') + 'queue/status/', params),
                    queueStatusPoller = pollerFactory.newPoller(queueStatusResource, scaleConfig.pollIntervals.queueStatus);

                return queueStatusPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        result.results = QueueStatus.transformer(result.results);
                    } else {
                        queueStatusPoller.stop();
                    }
                    return result;
                });
            },
            getQueueStatusOnce: function () {
                var d = $q.defer();

                $http.get(scaleConfig.getUrlPrefix('queue') + 'queue/status/').success(function (data) {
                    data.results = QueueStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            requeueJobs: function (params) {
                params = params || getRequeueJobsParams();
                params.url = params.url ? params.url : scaleConfig.getUrlPrefix('queue') + 'queue/requeue-jobs/';

                var d = $q.defer();

                $http.post(params.url, params).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            getJobLoad: function (params) {
                params = params || getJobLoadParams();
                params.url = params.url ? params.url : scaleConfig.getUrlPrefix('load') + 'load/';

                var jobLoadResource = $resource(params.url, params),
                    jobLoadPoller = pollerFactory.newPoller(jobLoadResource, scaleConfig.pollIntervals.jobLoad);

                return jobLoadPoller.promise.then(null, null, function (data) {
                    if (!data.$resolved) {
                        jobLoadPoller.stop();
                    }
                    return data;
                });
            },
            getJobLoadOnce: function (params) {
                params = params || getJobLoadParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.getUrlPrefix('load') + 'load/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('metricsService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        var getPlotDataParams = function (page, page_size, started, ended, choice_id, column, group, dataType) {
            console.log(choice_id);
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                choice_id: choice_id,
                column: column,
                group: group,
                dataType: dataType
            };
        };

        return {
            getDataTypes: function () {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('metrics') + 'metrics/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getDataTypeMetrics: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('metrics') + 'metrics/' + id + '/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getDataTypeOptions: function (name) {
                var d = $q.defer();
                var url = scaleConfig.getUrlPrefix('metrics') + 'metrics/' + name + '/';
                $http.get(url).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getPlotData: function (params) {
                var params = params || getPlotDataParams(),
                    d = $q.defer();

                $http({
                    method: 'GET',
                    url: scaleConfig.getUrlPrefix('metrics') + 'metrics/' + params.dataType + '/plot-data/',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getGeneratedPlotData: function (obj) {
                var d = $q.defer();

                var returnObj = {
                    count: 28,
                    next: null,
                    previous: null,
                    results: []
                };

                var numDays = moment.utc(obj.params.ended).diff(moment.utc(obj.params.started), 'd') + 1;

                _.forEach(obj.query.selectedMetrics, function (metric) {
                    var returnResult = {
                        column: metric,
                        min_x: moment.utc(obj.params.started).format('YYYY-MM-DD'),
                        max_x: moment.utc(obj.params.ended).format('YYYY-MM-DD'),
                        min_y: 1,
                        max_y: 100,
                        values: []
                    };

                    for (var i = 0; i < numDays; i++) {
                        if (obj.query.filtersApplied.length > 1) {
                            _.forEach(obj.query.filtersApplied, function (filter) {
                                returnResult.values.push({
                                    date: moment.utc(obj.params.started).add(i, 'd').format('YYYY-MM-DD'),
                                    value: Math.floor(Math.random() * (1000 - 1 + 1)) + 1,
                                    id: filter.id
                                });
                            });
                        } else {
                            returnResult.values.push({
                                date: moment.utc(obj.params.started).add(i, 'd').format('YYYY-MM-DD'),
                                value: Math.floor(Math.random() * (1000 - 1 + 1)) + 1
                            });
                        }
                    }
                    returnObj.results.push(returnResult);
                });

                d.resolve(returnObj);

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('navController', ['$scope', '$location', '$window', 'scaleConfig', 'scaleService', 'stateService', 'navService', function($scope, $location, $window, scaleConfig, scaleService, stateService, navService) {
        document.getElementsByTagName('body')[0].style.backgroundColor = scaleConfig.colors.nav_bg;

        var vm = this;

        vm.version = '';
        vm.activePage = 'overview';
        vm.docsUrl = scaleConfig.urls.documentation;

        vm.goto = function(loc) {
            $location.search('');
            $location.path(loc);
        };

        var locationUpdated = function() {
            vm.activePage = navService.location;
        };

        var initialize = function() {
            navService.registerObserver(locationUpdated);

            scaleService.getVersion().then(function (data) {
                vm.version = data.version;
                stateService.setVersion(data.version);
            });
        };
        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('metricsController', ['$scope', '$location', 'scaleConfig', 'scaleService', 'navService', 'metricsService', 'moment', function ($scope, $location, scaleConfig, scaleService, navService, metricsService, moment) {
        var vm = this,
            chart = null,
            colArr = [],
            colNames = {},
            xArr = [],
            removeIds = [],
            yUnits = [];

        vm._ = _;
        vm.moment = moment;
        vm.loadingMetrics = false;
        vm.chartArr = [];
        vm.chartData = [];
        vm.chartStyle = '';
        vm.selectedDataType = {};
        vm.inputStartDate = moment.utc().subtract(1, 'M').toDate();
        vm.inputEndDate = moment.utc().toDate();
        vm.openInputStart = function ($event) {
            $event.stopPropagation();
            vm.inputStartOpened = true;
        };
        vm.inputStartOpened = false;
        vm.openInputEnd = function ($event) {
            $event.stopPropagation();
            vm.inputEndOpened = true;
        };
        vm.inputEndOpened = false;
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.dataTypeFilterText = '';
        vm.filtersApplied = [];
        vm.filteredChoices = [];
        vm.filteredChoicesOptions = [];
        vm.selectedMetrics = [];
        vm.columnGroupsOptions = [];
        vm.columns = [];
        vm.groups = [];
        vm.chartTitle = '';
        vm.chartDisplay = 'stacked';
        vm.stackedClass = 'btn-primary';
        vm.groupedClass = 'btn-default';
        vm.subchartClass = 'btn-primary';
        vm.subchartEnabled = false;
        vm.chartType = 'bar';
        vm.chartTypeDisplay = 'Bar';
        vm.barClass = 'btn-primary';
        vm.areaClass = 'btn-default';
        vm.lineClass = 'btn-default';
        vm.splineClass = 'btn-default';
        vm.scatterClass = 'btn-default';
        vm.metricsTotal = null;

        vm.getPlotDataParams = function (obj) {
            return {
                page: null,
                page_size: null,
                started: obj.started,
                ended: obj.ended,
                choice_id: obj.choice_id,
                column: obj.column,
                group: obj.group,
                dataType: obj.dataType.name
            };
        };

        vm.resetSelections = function () {
            vm.inputStartDate = moment.utc().subtract(1, 'M').toDate();
            vm.inputEndDate = moment.utc().toDate();
            vm.selectedDataType = {};
            vm.changeDataTypeSelection();
        };

        vm.updateChart = function () {
            vm.chartData = [];
            if (vm.chartArr.length === 0) {
                // nothing to show on chart
                chart.destroy();
                chart = null;
            } else {
                var callInit = _.after(vm.chartArr.length, function () {
                    // only initChart after this function has been called for all datasets in chartArr
                    vm.loadingMetrics = false;
                    vm.initChart();
                });

                _.forEach(vm.chartArr, function (obj) {
                    var params = vm.getPlotDataParams(obj);
                    metricsService.getPlotData(params).then(function (data) {
                    //metricsService.getGeneratedPlotData({query: obj, params: params}).then(function (data) {
                        vm.chartData.push({
                            query: obj,
                            results: data.results
                        });
                        callInit();
                    }).catch(function (error) {
                        vm.loadingMetrics = false;
                        console.log(error);
                        toastr['error'](error);
                    });
                });
            }
        };

        vm.addToChart = function () {
            vm.chartArr = []; // comment this out if allowing multiple adds
            vm.loadingMetrics = true;
            var filteredChoices = [],
                selectedColumns = [];
            // find the filter object associated with the chosen filter IDs
            _.forEach(vm.filtersApplied, function (id) {
                filteredChoices.push(_.find(vm.filteredChoices, { id: parseInt(id) }));
            });
            if (angular.isArray(vm.selectedMetrics)) {
                _.forEach(vm.selectedMetrics, function (metric) {
                    selectedColumns.push(_.find(vm.columns, { name: metric }));
                });
            } else {
                selectedColumns.push(_.find(vm.columns, { name: vm.selectedMetrics }));
            }
            vm.chartArr.push({
                started: vm.inputStartDate.toISOString(),
                ended: vm.inputEndDate.toISOString(),
                choice_id: vm.filtersApplied,
                column: _.pluck(selectedColumns, 'name'),
                group: null,
                dataType: vm.selectedDataType,
                filtersApplied: filteredChoices,
                selectedMetrics: selectedColumns
            });
            vm.updateChart();
            //vm.resetSelections();
        };

        vm.deleteFromChart = function (objToDelete) {
            _.remove(vm.chartArr, function (obj) {
                return JSON.stringify(obj) === JSON.stringify(objToDelete);
            });
            vm.updateChart();
        };

        vm.getFilterOptions = function (param) {
            return _.uniq(_.pluck(vm.filteredChoices, param));
        };

        vm.changeDataTypeSelection = function () {
            // reset options
            vm.filtersApplied = [];
            vm.selectedDataTypeOptions = [];
            vm.dataTypeFilterText = '';
            vm.selectedMetrics = [];
            vm.columns = [];

            if (!vm.selectedDataType.name || vm.selectedDataType.name === '') {
                vm.selectedDataType = {};
                vm.getDataTypes();
            } else {
                vm.getDataTypeOptions(vm.selectedDataType);
            }
        };

        vm.areFiltersApplied = function () {
            return vm.filtersApplied.length > 0;
        };

        vm.updateChartDisplay = function (display) {
            vm.chartDisplay = display;
            vm.stackedClass = display === 'stacked' ? 'btn-primary' : 'btn-default';
            vm.groupedClass = display === 'grouped' ? 'btn-primary' : 'btn-default';
            vm.initChart();
        };

        vm.updateChartType = function (type) {
            vm.chartType = type;
            vm.chartTypeDisplay = _.capitalize(type);
            vm.barClass = type === 'bar' ? 'btn-primary' : 'btn-default';
            vm.areaClass = type === 'area' ? 'btn-primary' : 'btn-default';
            vm.lineClass = type === 'line' ? 'btn-primary' : 'btn-default';
            vm.splineClass = type === 'spline' ? 'btn-primary' : 'btn-default';
            vm.scatterClass = type === 'scatter' ? 'btn-primary' : 'btn-default';
            vm.initChart();
        };

        vm.toggleSubchart = function () {
            vm.subchartEnabled = !vm.subchartEnabled;
            if (vm.subchartEnabled) {
                vm.subchartClass = 'btn-primary';
            } else {
                vm.subchartClass = 'btn-default';
            }
        };

        vm.initialize = function () {
            navService.updateLocation('metrics');
            vm.getDataTypes();
        };

        vm.getDataTypes = function () {
            metricsService.getDataTypes().then(function (result) {
                vm.availableDataTypes = result.results;
            }).catch(function (error) {
                console.log(error);
                toastr['error'](error);
            });
        };

        vm.getDataType = function (id) {
            metricsService.getDataTypeMetrics(id).then(function (result) {
                vm.selectedDataTypeAvailableMetrics = result.metrics;
            }).catch(function (error) {
                console.log(error);
            });
        };

        vm.getDataTypeOptions = function (dataType) {
            metricsService.getDataTypeOptions(dataType.name).then(function (result) {
                vm.selectedDataTypeOptions = result;
                _.forEach(result.filters, function (filter) {
                    vm.dataTypeFilterText = vm.dataTypeFilterText.length === 0 ? _.capitalize(filter.param) : vm.dataTypeFilterText + ', ' + _.capitalize(filter.param);
                });
                vm.filteredChoices = _.sortByOrder(result.choices, ['title','version'], ['asc','asc']);
                // format filteredChoices for use with multiselect directive
                var filteredChoicesOptions = [];
                _.forEach(vm.filteredChoices, function (choice) {
                    filteredChoicesOptions.push({
                        label: choice.version ? choice.title + ' ' + choice.version : choice.title,
                        title: choice.version ? choice.title + ' ' + choice.version : choice.title,
                        value: choice.id
                    });
                });
                vm.filteredChoicesOptions = filteredChoicesOptions;
                vm.columns = _.sortByOrder(result.columns, ['title'], ['asc']);
                vm.groups = result.groups;

                // create an array of objects containing grouped columns
                var columnGroupsOptions = [],
                    columnGroups = _.pairs(_.groupBy(result.columns, 'group'));
                _.forEach(columnGroups, function (group) {
                    var option = {
                        label: _.find(vm.groups, { name: group[0] }).title,
                        children: []
                    };
                    _.forEach(group[1], function (column) {
                        var child = {
                            label: column.title,
                            title: column.title,
                            value: column.name
                        };
                        option.children.push(child);
                    });
                    columnGroupsOptions.push(option);
                });
                columnGroupsOptions.unshift({
                    label: 'None Selected',
                    title: 'None Selected',
                    value: ''
                });
                vm.columnGroupsOptions = columnGroupsOptions;
            }).catch(function (error){
                console.log(error);
                toastr['error'](error);
            });
        };

        vm.initialize();

        $scope.$watch('vm.inputEndDate', function (value) {
            console.log(value)
        });

        var formatYValues = function (data, noPadding) {
            noPadding = noPadding || false;
            if (yUnits[0] === 'seconds') {
                return scaleService.calculateDuration(moment.utc().startOf('d'), moment.utc().startOf('d').add(data, 's'), noPadding);
            } else if (yUnits[0] === 'bytes') {
                return scaleService.calculateFileSizeFromBytes(data, 1);
            }
            return data;
        };

        // set up chart
        vm.initChart = function () {
            // mark any existing data for removal
            // compare currCols (columns currently in the chart) with displayCols (columns to display)
            removeIds = [];
            vm.metricsTotal = null;
            var currCols = [],
                displayCols = [];
            _.forEach(colArr, function (col, idx) {
                if (idx > 0) {
                    currCols.push(col[0]);
                }
            });
            _.forEach(vm.chartData, function (d) {
                displayCols = displayCols.concat(_.pluck(d.query.filtersApplied, 'name'));
                // increase metrics total if selected metric produces a sum
                // for now it is only possible to select one metric at a time
                // so just check the first element from selectedMetrics
                if (d.query.selectedMetrics[0].aggregate === 'sum') {
                    vm.metricsTotal = vm.metricsTotal + _.sum(d.results[0].values, 'value');
                }
            });
            // determine the exact differences between currCols and displayCols
            // if none are found, then removeIds stays empty
            _.forEach(currCols, function (currCol) {
                var displayCol = _.find(displayCols, function (dCol) {
                    return dCol === currCol;
                });
                if (!displayCol) {
                    removeIds.push(currCol);
                }
            });

            // init with new data
            colArr = [];
            xArr = [];
            colNames = {};

            // create xArr
            var numDays = moment.utc(vm.inputEndDate).endOf('d').diff(moment.utc(vm.inputStartDate.toISOString()).startOf('d'), 'd') + 1; // add 1 to include starting day in count
            for (var i = 0; i < numDays; i++) {
                xArr.push(moment.utc(vm.inputStartDate.toISOString()).startOf('d').add(i, 'd').toDate());
            }

            // iterate over datatypes and add values to colArr
            _.forEach(vm.chartData, function (data) {
                var valueArr = [],
                    query = data.query,
                    queryFilter = {},
                    queryDates = [];

                yUnits = _.pluck(query.selectedMetrics, 'units');

                if (query.filtersApplied.length > 0) {
                    // filters were applied, so build data source accordingly
                    _.forEach(data.results, function (result) {
                        if (result.values.length > 0) {
                            // values for all filters are returned in one array of arrays,
                            // so group results by id to isolate filter values
                            var groupedResult = _.groupBy(result.values, 'id'),
                                resultObj = {},
                                filterIds = _.pluck(query.filtersApplied, 'id');
                            // try to get each filter id from groupedResult.
                            // if it's undefined, an empty array will be returned
                            // this allows a zeroed array to appear in the chart,
                            // since we want to include all filters selected by the user
                            // regardless of value
                            if (filterIds.length > 1) {
                                // when more than one filter is requested, then an id
                                // value is present within data.results
                                _.forEach(filterIds, function (id) {
                                    resultObj[id] = _.get(groupedResult, id, []);
                                });
                            } else {
                                // when one filter is requested, no id value is included
                                // in data.results, so build resultObj with the other
                                // info we have
                                resultObj[query.choice_id[0]] = _.pairs(groupedResult)[0][1];
                            }
                            _.forEach(_.pairs(resultObj), function (d) {
                                valueArr = [];
                                // d[0] will be choice id, d[1] will be values
                                // if only one filter was selected, d[0] will return as string 'undefined' since no id is included in this case
                                queryFilter = d[0] === 'undefined' ? query.filtersApplied[0] : _.find(query.filtersApplied, {id: parseInt(d[0])});
                                queryDates = d[1];

                                // add result values to valueArr
                                _.forEach(xArr, function (xDate) {
                                    var valueObj = _.find(queryDates, function (qDate) {
                                        return moment.utc(qDate.date).isSame(xDate, 'day');
                                    });
                                    // push 0 if data for xDate is not present in queryDates
                                    valueArr.push(valueObj ? valueObj.value : 0);
                                });

                                // prepend valueArr with filter title, and push onto colArr
                                valueArr.unshift(queryFilter.name + queryFilter.id);
                                colNames[queryFilter.name + queryFilter.id] = queryFilter.version ? queryFilter.title + ' ' + queryFilter.version : queryFilter.title;
                                colArr.push(valueArr);
                            });
                        }
                    });
                } else {
                    // no filters were applied, so show aggregate statistics
                    _.forEach(data.results, function (result) {
                        // add result values to valueArr
                        _.forEach(xArr, function (xDate) {
                            var valueObj = _.find(result.values, function (qDate) {
                                return moment.utc(qDate.date).isSame(xDate, 'day');
                            });
                            // push 0 if data for xDate is not present in result.values
                            valueArr.push(valueObj ? valueObj.value : 0);
                        });

                        // prepend valueArr with filter title, and push onto colArr
                        var columnLabel = result.column.title + ' for all ' + query.dataType.title;
                        valueArr.unshift(columnLabel);
                        colNames['aggregate'] = columnLabel;
                        colArr.push(valueArr);
                    });
                }
            });

            // inform the user if the metrics they selected are empty
            if (_.sum(_.flatten(colArr)) === 0) {
                toastr['info']('There is no data to display.');
            }

            // prepend xArr with an 'x' label and add to colArr
            xArr.unshift('x');
            colArr.unshift(xArr);

            var types = {},
                type = {},
                groups = [];

            _.forEach(colArr, function (col) {
                type = {};
                if (col[0] !== 'x') {
                    type[col[0]] = vm.chartType;
                    if (vm.chartDisplay === 'stacked') {
                        groups.push(col[0]);
                    }
                }
                angular.extend(types, type);
            });

            if (chart) {
                // chart already exists, so update values
                chart.groups([groups]);
                chart.data.names(colNames);
                chart.axis.labels({
                    y: _.capitalize(yUnits[0])
                });
                chart.load({
                    columns: colArr,
                    types: types,
                    unload: removeIds
                });
            } else {
                // no chart yet, so set it up
                chart = c3.generate({
                    bindto: '#metrics',
                    data: {
                        x: 'x',
                        columns: colArr,
                        types: types,
                        groups: [groups],
                        names: colNames
                    },
                    subchart: {
                        show: vm.subchartEnabled
                    },
                    transition: {
                        duration: 700
                    },
                    color: {
                        pattern: scaleConfig.colors.patternD320
                    },
                    axis: {
                        type: 'timeseries',
                        x: {
                            tick: {
                                format: function (d) {
                                    return moment.utc(d).toISOString();
                                }
                            },
                            label: {
                                text: 'Dates',
                                position: 'outer-center'
                            }
                        },
                        y: {
                            tick: {
                                format: function (d) {
                                    return formatYValues(d);
                                }
                            },
                            label: {
                                text: _.capitalize(yUnits[0]),
                                position: 'outer-middle'
                            }
                        }
                    }
                });
            }

            if (vm.metricsTotal) {
                vm.metricsTotal = formatYValues(vm.metricsTotal, true);
                vm.chartTitle = '<div class="label label-success">' + vm.metricsTotal.toLocaleString() + '</div> ' + vm.chartData[0].query.selectedMetrics[0].title + ' for ' + moment.utc(vm.inputStartDate).format('DD MMM YYYY') + ' - ' + moment.utc(vm.inputEndDate).format('DD MMM YYYY');
            } else {
                vm.chartTitle = vm.chartData[0].query.selectedMetrics[0].title + ' ' + moment.utc(vm.inputStartDate).format('DD MMM YYYY') + ' - ' + moment.utc(vm.inputEndDate).format('DD MMM YYYY');
            }
        };

        // set chart height
        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                chartMaxHeight = viewport.height - offset;

            vm.chartStyle = 'height: ' + chartMaxHeight + 'px; max-height: ' + chartMaxHeight + 'px;';
        });
    }]);
})();

(function () {
    'use strict';
    /**
     * See: http://stackoverflow.com/questions/12576798/angularjs-how-to-watch-service-variables/17558885#17558885
     * Doing things this way so that ssNavbarController can get notified
     * when the location changes. Then, our controllers just need to call into
     * this service to updateLocation.
     *
     * The only thing I don't like about this is that the individual
     * controllers have to call in and tell the ssNavigationService what
     * page they are showing.
     */
    angular.module('scaleApp').service('navService', ['$location', function ($location) {

        this.location = 'overview'; // where the app starts

        var observers = [];

        this.registerObserver = function(callback) {
            observers.push(callback);
        };

        this.notifyObservers = function() {
            angular.forEach(observers, function(observer) {
                observer();
            });
        };

        this.updateLocation = function(locationIn) {
            this.location = locationIn;
            this.notifyObservers();
        };

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('subnavService', ['$http', 'scaleConfig', function ($http, scaleConfig) {
        var currentPath = '';

        this.setCurrentPath = function (path) {
            currentPath = path;
        };

        this.getCurrentPath = function () {
            return currentPath;
        };
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('nodeDetailsController', ['$scope', '$location', '$routeParams', '$timeout', 'navService', 'nodeService', 'scaleConfig', 'scaleService', 'statusService', 'jobTypeService', 'moment', function($scope, $location, $routeParams, $timeout, navService, nodeService, scaleConfig, scaleService, statusService, jobTypeService, moment) {
        var vm = this,
            nodes = [],
            jobTypes = [];
        
        vm.scaleConfig = scaleConfig;
        vm.moment = moment;
        vm._ = _;
        vm.loading = true;
        vm.loadingStatus = true;
        vm.nodeStatus = null;
        vm.nodesError = null;
        vm.nodeId = parseInt($routeParams.id);
        vm.runningJobs = [];
        vm.completedJobs = [];
        vm.systemJobs = [];
        vm.algorithmJobs = [];
        vm.dataJobs = [];
        vm.scaleService = scaleService;

        var getNodes = function () {
            statusService.getStatus(true).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.nodesError = null;
                    vm.runningJobs = [];
                    vm.completedJobs = [];
                    nodes = data.nodes;
                    vm.nodeStatus = _.find(nodes, { id: vm.nodeId });
                    _.forEach(vm.nodeStatus.job_executions.running.by_job_type, function (running) {
                        vm.runningJobs.push({
                            jobType: _.find(jobTypes, { id: running.job_type_id }),
                            count: running.count
                        });
                    });
                    _.forEach(vm.nodeStatus.job_executions.completed.by_job_type, function (completed) {
                        vm.completedJobs.push({
                            jobType: _.find(jobTypes, { id: completed.job_type_id }),
                            count: completed.count
                        });
                    });
                    _.forEach(vm.nodeStatus.job_executions.failed.system.by_job_type, function (system) {
                        vm.systemJobs.push({
                            jobType: _.find(jobTypes, { id: system.job_type_id }),
                            count: system.count
                        });
                    });
                    _.forEach(vm.nodeStatus.job_executions.failed.algorithm.by_job_type, function (algorithm) {
                        vm.algorithmJobs.push({
                            jobType: _.find(jobTypes, { id: algorithm.job_type_id }),
                            count: algorithm.count
                        });
                    });
                    _.forEach(vm.nodeStatus.job_executions.failed.data.by_job_type, function (data) {
                        vm.dataJobs.push({
                            jobType: _.find(jobTypes, { id: data.job_type_id }),
                            count: data.count
                        });
                    });
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.nodesErrorStatus = data.statusText;
                    }
                    vm.nodesError = 'Unable to retrieve nodes.';
                }
                vm.loadingStatus = false;
            });
        };

        var getNodeDetails = function (nodeId) {
            nodeService.getNode(nodeId).then( function (data) {
                vm.node = data;
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function() {
            navService.updateLocation('nodes');
            jobTypeService.getJobTypesOnce().then(function (data) {
                jobTypes = data.results;
                getNodeDetails(vm.nodeId);
                getNodes();
            });
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('nodesController', ['$scope', '$location', '$timeout', '$uibModal', 'navService', 'nodeService', 'nodeUpdateService', 'statusService', 'stateService', 'userService', 'jobTypeService', 'gridFactory', 'toastr', 'poller', function($scope, $location, $timeout, $uibModal, navService, nodeService, nodeUpdateService, statusService, stateService, userService, jobTypeService, gridFactory, toastr, poller) {
        var vm = this;

        vm.nodesParams = stateService.getNodesParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.loadingStatus = true;
        vm.readonly = true;
        vm.actionClicked = false;
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.data = [];
        vm.showActive = vm.nodesParams.active === 'true';
        vm.nodeType = vm.showActive ? 'Active' : 'Deprecated';
        vm.nodeTotals = '';
        vm.nodeStates = [];
        vm.selectedNodeState = $location.search().state || 'All';

        $scope.pauseReason = '';

        var allNodes = [];
        var filteredByOrder = vm.nodesParams.order ? true : false;
        var jobTypes = null;

        vm.colDefs = [
            {
                field: 'hostname',
                displayName: 'Hostname',
                enableFiltering: false,
                width: '20%',
                cellTemplate: 'hostname.html'
            },
            {
                field: 'state.name',
                displayName: 'State',
                width: '10%',
                cellTemplate: '<div class="ui-grid-cell-contents"><div class="pull-right"><span class="fa fa-exclamation-triangle error" ng-show="row.entity.errors.length > 0" tooltip-append-to-body="true" uib-tooltip="{{ row.entity.errors.length === 1 ? row.entity.errors[0].description : row.entity.errors.length + \' Errors\' }}"></span> <span class="fa fa-exclamation-triangle warning" ng-show="row.entity.warnings.length > 0" tooltip-append-to-body="true" uib-tooltip="{{ row.entity.warnings.length === 1 ? row.entity.warnings[0].description : row.entity.warnings.length + \' Warnings\' }}"></span></div><span ng-bind-html="row.entity.state.title" tooltip-append-to-body="true" uib-tooltip="{{ row.entity.state.description }}"></span></div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container" ng-show="grid.appScope.vm.showActive"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedNodeState"><option ng-selected="{{ grid.appScope.vm.nodeStates[$index] == grid.appScope.vm.selectedNodeState }}" value="{{ grid.appScope.vm.nodeStates[$index] }}" ng-repeat="state in grid.appScope.vm.nodeStates track by $index">{{ state }}</option></select></div>'
            },
            {
                field: 'job_executions',
                displayName: 'Job Executions (Last 3 Hrs)',
                enableFiltering: false,
                enableSorting: false,
                width: '22%',
                cellTemplate: 'jobExecutions.html',
                headerCellTemplate: 'jobExecutionsHeader.html'
            },
            {
                field: 'running_jobs',
                displayName: 'Running Jobs',
                enableFiltering: false,
                enableSorting: false,
                cellTemplate: 'runningJobs.html'
            }
        ];

        vm.gridOptions.columnDefs = vm.colDefs;

        vm.toggleActive = function (entity) {
            vm.actionClicked = true;
            var isActive = !entity.is_active;
            nodeUpdateService.updateNode(entity.id, { pause_reason: '', is_paused: entity.is_paused, is_active: isActive }).then(function (result) {
                var node = _.find(vm.gridOptions.data, { id: result.id });
                entity.is_active = result.is_active;
                if (entity.is_active) {
                    toastr.info(node.hostname + ' Activated');
                } else {
                    toastr.info(node.hostname + ' Deactivated');
                }
            });
        };

        vm.resumeNode = function (entity) {
            vm.actionClicked = true;
            nodeUpdateService.updateNode(entity.id, { pause_reason: null, is_paused: false, is_active: entity.is_active }).then(function (result) {
                var node = _.find(vm.gridOptions.data, { id: result.id });
                entity.is_paused = result.is_paused;
                toastr.info(node.hostname + ' Resumed');
            });
        };

        vm.pauseNode = function (entity) {
            $scope.pauseReason = '';
            vm.actionClicked = true;

            $scope.updateReason = function (value) {
                $scope.pauseReason = value;
            };

            var modalInstance = $uibModal.open({
                animation: true,
                templateUrl: 'pauseDialog.html',
                scope: $scope
            });

            modalInstance.result.then(function () {
                nodeUpdateService.updateNode(entity.id, { pause_reason: $scope.pauseReason, is_paused: true, is_active: entity.is_active }).then(function (result) {
                    var node = _.find(vm.gridOptions.data, { id: result.id });
                    entity.is_paused = result.is_paused;
                    toastr.info(node.hostname + ' Paused');
                });
            });
        };

        vm.filterResults = function () {
            poller.stopAll();
            stateService.setNodesParams(vm.nodesParams);
            vm.loading = true;
            getNodes();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.nodesParams);
        };

        vm.updateNodeOrder = function (sortArr) {
            vm.nodesParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateNodeActive = function () {
            formatResults();
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.search({});
                    $location.path('/nodes/' + row.entity.id);
                }
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setNodesColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateNodeOrder(sortArr);
            });
        };

        var formatResults = function () {
            var currNodeType = vm.showActive ? 'Active' : 'Deprecated';
            var altNodeType = vm.showActive ? 'Deprecated' : 'Active';
            vm.nodes = _.filter(allNodes, { is_active: vm.showActive });
            vm.nodeTotals = vm.nodes.length + ' ' + currNodeType + ' Nodes / ' + (allNodes.length - vm.nodes.length) + ' ' + altNodeType + ' Nodes';
            vm.nodeStates = _.sortBy(_.uniq(_.map(vm.nodes, 'state.title')));
            var hasSelectedState = _.find(vm.nodeStates, function (s) { return s === vm.selectedNodeState; });
            if (!hasSelectedState && vm.selectedNodeState !== 'All') {
                vm.nodeStates.push(vm.selectedNodeState);
            }
            vm.nodeStates.unshift('All');
            var order = $location.search().order;
            var state = $location.search().state;
            if (order) {
                var fieldArr = [];
                var directionArr = [];
                _.forEach(order, function (o) {
                    fieldArr.push(_.startsWith(o, '-') ? _.tail(o).join('') : o);
                    directionArr.push(_.startsWith(order, '-') ? 'desc' : 'asc');
                });
                vm.nodes = _.sortByOrder(vm.nodes, fieldArr, directionArr);
            }
            _.forEach(vm.nodes, function (node) {
                node.running_jobs = getRunningJobs(node);
            });
            var filteredNodes = _.cloneDeep(vm.nodes);
            if (state) {
                filteredNodes = _.filter(filteredNodes, { state: { title: state }});
            }
            vm.gridOptions.totalItems = filteredNodes.length;
            vm.gridOptions.minRowsToShow = filteredNodes.length;
            vm.gridOptions.virtualizationThreshold = filteredNodes.length;
            vm.gridOptions.data = filteredNodes;

        };

        var getRunningJobs = function (entity) {
            var runningJobs = [];
            _.forEach(entity.job_executions.running.by_job_type, function (jobType) {
                runningJobs.push({
                    jobType: _.find(jobTypes, { id: jobType.job_type_id }),
                    count: jobType.count
                });
            });
            return runningJobs;
        };

        var getNodes = function () {
            poller.stopAll();
            statusService.getStatus(true).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.nodesError = null;
                    allNodes = data.nodes;
                    formatResults();
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.nodesErrorStatus = data.statusText;
                    }
                    vm.nodesError = 'Unable to retrieve nodes.';
                }
                vm.loading = false;
            });
        };

        var initialize = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                jobTypes = data.results;
                getNodes();
            });
            vm.nodesParams.state = vm.showActive ? vm.selectedNodeState !== 'All' ? vm.selectedNodeState : null : null;
            stateService.setNodesParams(vm.nodesParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            navService.updateLocation('nodes');
        };

        initialize();

        $scope.$watchCollection('vm.stateService.getNodesColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getNodesParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.nodesParams = newValue;
            vm.updateColDefs();
        });

        $scope.$watch('vm.showActive', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.nodesParams.active = newValue.toString();
            vm.nodesParams.state = newValue ? vm.selectedNodeState !== 'All' ? vm.selectedNodeState : null : null;
            vm.showActive = newValue;
            vm.nodeType = newValue ? 'Active' : 'Deprecated';
            stateService.setNodesParams(vm.nodesParams);
            formatResults();
        });

        $scope.$watch('vm.selectedNodeState', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.nodesParams.state = newValue !== 'All' ? newValue : null;
            getNodes();
            stateService.setNodesParams(vm.nodesParams);
        });
    }]);
})();

(function (){
    'use strict';

    angular.module('scaleApp').controller('aisNodeHealthController', ['$rootScope', '$scope', function ($rootScope, $scope) {
        var vm = this;

        vm.nodes = [];
        vm.groupedNodes = [];
        vm.totalNodes = 0;

        var getNodeStatus = function () {
            vm.totalNodes = vm.nodes.length;
            if (vm.totalNodes > 0) {
                vm.groupedNodes = _.pairs(_.groupBy(vm.nodes, 'state.title'));

                var donutData = [];

                _.forEach(vm.groupedNodes, function (group) {
                    donutData.push({
                        status: group[0],
                        count: group[1].length
                    });
                });

                vm.nodeHealth = donutData;
            } else {
                vm.nodeHealth = [];
            }
        };

        $scope.$watch('data', function (newValue) {
            if (newValue) {
                vm.nodes = newValue;
                vm.totalNodes = newValue.length;
                getNodeStatus();
            }
        });
    }]).directive('aisNodeHealth', function(){
        /**
         * Usage: <ais-node-health />
         **/
         return {
             controller: 'aisNodeHealthController',
             controllerAs: 'vm',
             templateUrl: 'modules/nodes/directives/nodeHealthTemplate.html',
             restrict: 'E',
             scope: {
                 data: '=',
                 showDescription: '=',
                 loading: '=',
                 nodeType: '@'
             }
         };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('nodeStatusGridController', ['$scope', '$location', function ($scope, $location) {
        var vm = this,
            cellSize = $scope.cellSize || '10px';

        vm.nodes = [];
        vm.hours = $scope.hours || 3;
        vm.cellStyle = {
            width: cellSize,
            height: cellSize
        };

        vm.getNodeClass = function (node) {
            console.log('getNodeClass');
            if (!node.is_online) {
                return 'offline';
            } else {
                if (node.node.is_paused) {
                    return 'is-paused';
                } else if (node.node.is_paused_errors) {
                    return 'is-paused-errors';
                }
            }
            return 'online';
        };

        vm.viewNode = function (id) {
            $location.path('nodes/' + id);
        };

        $scope.$watch('data', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            _.forEach(newValue, function (node) {
                if (!node.is_online) {
                    node.class = 'offline';
                } else {
                    if (node.node.is_paused) {
                        node.class = 'is-paused';
                    } else if (node.node.is_paused_errors) {
                        node.class = 'is-paused-errors';
                    } else {
                        node.class = 'online';
                    }
                }
            });
            vm.nodes = newValue;
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisNodeStatusGrid', function () {
        return {
            controller: 'nodeStatusGridController',
            controllerAs: 'vm',
            templateUrl: 'modules/nodes/directives/nodeStatusGridTemplate.html',
            restrict: 'E',
            scope: {
                data: '=',
                hours: '=',
                cellSize: '@'
            }
        };
    });
})();
(function(){
    'use strict';

    angular.module('scaleApp').factory('Node', ['NodeResources', 'scaleService', function (NodeResources, scaleService) {
        var Node = function (id, hostname, pause_reason, is_paused, is_active, deprecated, created, last_modified) {
            this.id = id;
            this.hostname = hostname;
            this.pause_reason = pause_reason;
            this.is_paused = is_paused;
            this.is_active = is_active;
            this.deprecated = deprecated;
            this.created = created;
            this.last_modified = last_modified;
        };

        //public methods
        Node.prototype = {
            toString: function () {
                return 'Node';
            },
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            },
            getCellText: function () {
                // this is only used reveal = true on gridChart directive
                return this.hostname;
            },
            getCellTitle: function () {
                return this.hostname;
            },
            isPaused: function () {
                return this.is_paused;
            }
        };

        // static methods, assigned to class
        Node.build = function (data) {
            if (data) {
                return new Node(
                    data.id,
                    data.hostname,
                    data.pause_reason,
                    data.is_paused,
                    data.is_active,
                    data.deprecated,
                    data.created,
                    data.last_modified
                );
            }
            return new Node();
        };

        Node.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Node.build);
            }
            return Node.build(data);
        };

        return Node;
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('NodeResources', function(){
        var NodeResources = function (total, scheduled, used) {
            this.total = total;
            this.scheduled = scheduled;
            this.used = used;
        };

        //public methods
        NodeResources.prototype = {
            // getDuration: function() {
                //return scaleService.calculateDuration(this.created, this.last_modified);
            // }
        };

        // static methods, assigned to class
        NodeResources.build = function (data) {
            if (data) {
                return new NodeResources(
                    data.total,
                    data.scheduled,
                    data.used
                );
            }
            return new NodeResources();
        };

        NodeResources.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(NodeResources.build)
                    .filter(Boolean);
            }
            return NodeResources.build(data);
        };

        return NodeResources;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('nodeService', ['$http', '$q', '$resource', 'scaleConfig', 'Node', 'poller', 'pollerFactory', function ($http, $q, $resource, scaleConfig, Node, poller, pollerFactory) {
        var getNodesParams = function (order, active) {
            return {
                order: order,
                active: active
            };
        };

        return {
            getNodes: function (params) {
                params = params || getNodesParams();

                var nodesResource = $resource(scaleConfig.getUrlPrefix('nodes') + 'nodes/', params),
                    nodesPoller = pollerFactory.newPoller(nodesResource, scaleConfig.pollIntervals.nodes);

                return nodesPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = Node.transformer(data.results);
                    } else {
                        nodesPoller.stop();
                    }
                    return data;
                });
            },
            getNodesOnce: function (params) {
                params = params || getNodesParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.getUrlPrefix('nodes') + 'nodes/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    var returnData = Node.transformer(data.nodes);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getNode: function (slaveId) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('nodes') + 'nodes/' + slaveId + '/').success(function (data) {
                    var returnData = Node.transformer(data);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getNodeData: function (slaveId, since) {
                var data = {},
                    self = this;

                since = since || 'PT3H';

                return self.getNodes().then(function (nodes) {
                    data.nodes = nodes;
                    return self.getNodeStatus(since).then(function (stats) {
                        data.stats = stats;
                        return data;
                    });
                });
            }
        };

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('nodeUpdateService', ['$http', '$q', 'scaleConfig', 'Node', function ($http, $q, scaleConfig, Node) {
        var getNodeUpdateData = function (pause_reason, is_paused, is_active) {
            return {
                pause_reason: pause_reason,
                is_paused: is_paused,
                is_active: is_active
            };
        };

        return {
            updateNode: function (id, data) {
                data = data || getNodeUpdateData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('nodes') + 'nodes/' + id + '/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(Node.transformer(result));
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }])
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('ovController', ['$rootScope', '$scope', 'navService', 'nodeService', 'jobService', 'jobTypeService', 'statusService', 'gaugeFactory', 'scaleConfig', 'scaleService', 'schedulerService', 'userService', function($rootScope, $scope, navService, nodeService, jobService, jobTypeService, statusService, gaugeFactory, scaleConfig, scaleService, schedulerService, userService) {
        var vm = this;
        
        vm.date = new Date();
        vm.jobError = null;
        vm.jobErrorStatus = null;
        vm.loadingJobs = true;
        vm.loadingNodeHealth = true;
        vm.jobTypes = [];
        vm.nodes = [];
        vm.nodeHealthError = null;
        vm.nodeHealthErrorStatus = '';
        vm.hourValue = 3;
        vm.jobData = {
            data: null,
            status: null
        };
        vm.jobErrorBreakdown = [];
        vm.status = null;
        vm.statusError = null;
        vm.loadingStatus = true;
        vm.masterStatus = '';
        vm.masterStatusClass = 'alert-success';
        vm.schedulerStatus = '';
        vm.schedulerStatusClass = 'alert-success';
        vm.memCalc = '';
        vm.diskCalc = '';
        vm.schedulerIsPaused = false;
        vm.user = userService.getUserCreds();
        vm.schedulerContainerClass = vm.user ? vm.user.is_admin ? 'col-xs-8 col-lg-10' : 'col-xs-12' : 'col-xs-12';
        vm.schedulerBtnClass = 'fa-pause';

        vm.toggleScheduler = function () {
            vm.schedulerIsPaused = !vm.schedulerIsPaused;
            var schedulerData = {
                is_paused: vm.schedulerIsPaused
            };
            schedulerService.updateScheduler(schedulerData).then(function (data) {
                vm.schedulerStatus = data.is_paused ? 'Paused' : 'Running';
                vm.schedulerStatusClass = data.is_paused ? 'alert-warning' : 'alert-success';
                vm.schedulerBtnClass = data.is_paused ? 'fa-play' : 'fa-pause';
            }).catch(function (error) {
                console.log(error);
            });
        };

        var redrawGrid = function () {
            $scope.$broadcast('redrawGrid', vm.jobData);
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypes().then(null, null, function (data) {
                if (data.$resolved) {
                    vm.jobError = null;
                    vm.jobData.data = data.results;
                    redrawGrid();
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.jobErrorStatus = data.statusText;
                    }
                    vm.jobError = 'Unable to retrieve job types.';
                }
                vm.loadingJobs = false;
            });
        };

        var getStatus = function () {
            var cpuGauge = gaugeFactory.createGauge('cpu', 'CPU', 0, 100, 180),
                memGauge = gaugeFactory.createGauge('memory', 'Memory', 0, 100, 180),
                diskGauge = gaugeFactory.createGauge('disk', 'Disk', 0, 100, 180);

            statusService.getStatus().then(null, null, function (result) {
                if (result.$resolved) {
                    vm.statusError = null;
                    vm.status = result;
                    cpuGauge.redraw(result.getCpuUsage());
                    memGauge.redraw(result.getMemUsage());
                    diskGauge.redraw(result.getDiskUsage());
                    vm.masterStatus = result.master.is_online ? 'Master is Online' : 'Master is Offline';
                    vm.masterStatusClass = result.master.is_online ? 'alert-success' : 'alert-danger';
                    if (result.scheduler.is_online) {
                        vm.schedulerStatus = result.scheduler.is_paused ? 'Scheduler is Paused' : 'Scheduler is Running';
                        vm.schedulerStatusClass = result.scheduler.is_paused ? 'alert-warning' : 'alert-success';
                        vm.schedulerIsPaused = result.scheduler.is_paused;
                        vm.schedulerBtnClass = result.scheduler.is_paused ? 'fa-play' : 'fa-pause';
                    } else {
                        vm.schedulerStatus = result.scheduler.is_paused ? 'Scheduler is Offline; Paused' : 'Scheduler is Offline';
                        vm.schedulerStatusClass = 'alert-danger';
                        vm.schedulerIsPaused = result.scheduler.is_paused;
                        vm.schedulerBtnClass = result.scheduler.is_paused ? 'fa-play' : 'fa-pause';
                    }
                    if (result.resources.scheduled.mem && result.resources.total.mem) {
                        vm.memCalc = scaleService.calculateFileSizeFromMib(result.resources.scheduled.mem) + ' / ' + scaleService.calculateFileSizeFromMib(result.resources.total.mem);
                    }
                    if (result.resources.scheduled.disk && result.resources.total.disk) {
                        vm.diskCalc = scaleService.calculateFileSizeFromMib(result.resources.scheduled.disk) + ' / ' + scaleService.calculateFileSizeFromMib(result.resources.total.disk);
                    }
                } else {
                    vm.statusError = result.statusText && result.statusText !== '' ? result.statusText : 'Unable to retrieve cluster status.';
                    cpuGauge.redraw(-1);
                    memGauge.redraw(-1);
                    diskGauge.redraw(-1);
                    vm.masterStatus = 'Master Status is Unknown';
                    vm.masterStatusClass = 'alert-danger';
                    vm.schedulerContainerClass = 'col-xs-12';
                    vm.schedulerStatus = 'Scheduler Status is Unknown';
                    vm.schedulerStatusClass = 'alert-danger';
                }
                vm.loadingStatus = false;
            });
        };

        var getNodeStatus = function () {
            statusService.getStatus(true).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.nodeHealthError = null;
                    vm.nodes = _.filter(data.nodes, { is_active: true });
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.nodeHealthErrorStatus = data.statusText;
                    }
                    vm.nodeHealthError = 'Unable to retrieve nodes.';
                }
                vm.loadingNodeHealth = false;
            });
        };

        $rootScope.$on('jobTypeStatus', function (event, data) {
            vm.jobData.status = data;
            redrawGrid();
        });

        var initialize = function () {
            getJobTypes();
            getStatus();
            getNodeStatus();
            navService.updateLocation('overview');
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('recipeDetailsController', ['$rootScope', '$scope', '$location', '$routeParams', 'navService', 'recipeService', 'scaleConfig', 'subnavService', 'userService', function ($rootScope, $scope, $location, $routeParams, navService, recipeService, scaleConfig, subnavService, userService) {

        var vm = this;

        vm.recipe = {};
        vm.recipeId = $routeParams.id;
        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes');
        vm.loadingRecipeDetail = true;
        vm.activeTab = 'status';
        vm.lastStatusChange = '';

        vm.getRecipeDetail = function (recipeId) {
            vm.loadingRecipeDetail = true;
            recipeService.getRecipeDetails(recipeId).then(function (data) {
                vm.recipe = data;
                recipeService.getRecipeTypeDetail(data.recipe_type.id).then(function(recipeType){
                    vm.recipeType = recipeType;
                }).catch(function(error){
                   console.log(error);
                });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loadingRecipeDetail = false;
            });
        };

        vm.initialize = function () {
            navService.updateLocation('recipes');
            vm.getRecipeDetail(vm.recipeId);
        };



        vm.switchTab = function (tab) {
            $('#' + vm.activeTab).hide();
            vm.activeTab = tab;
            $('#' + vm.activeTab).show();
        };

        vm.initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('recipeTypesController', ['$rootScope', '$scope', '$routeParams', '$location', '$uibModal', 'hotkeys', 'scaleService', 'navService', 'recipeService', 'subnavService', 'jobTypeService', 'scaleConfig', 'RecipeType', 'userService', 'localStorage', function ($rootScope, $scope, $routeParams, $location, $uibModal, hotkeys, scaleService, navService, recipeService, subnavService, jobTypeService, scaleConfig, RecipeType, userService, localStorage) {
        var vm = this;
        
        vm.loading = true;
        vm.containerStyle = '';
        vm.recipeTypes = [];
        vm.recipeTypeIds = [];
        vm.requestedRecipeTypeId = parseInt($routeParams.id);
        vm.activeRecipeType = null;
        vm.percentage = 73;
        vm.date = new Date();
        vm.recipes = null;
        vm.mode = 'view'; // valid values are add, view, and edit
        vm.addBtnText = 'New Recipe';
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.editBtnText = 'Edit';
        vm.editBtnClass = 'btn-success';
        vm.editBtnIcon = 'fa-edit';
        vm.jobTypeValues = [];
        vm.isRecipeModified = false;
        vm.saveBtnClass = 'btn-default';
        vm.masterClass = 'col-xs-3';
        vm.detailClass = 'col-xs-9';
        vm.minimizeMaster = false;
        vm.minimizeBtnClass = 'fa fa-chevron-left';
        vm.user = userService.getUserCreds();
        vm.scaleConfig = scaleConfig;
        vm.localRecipeTypes = [];

        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes/types');

        var initialize = function () {
            navService.updateLocation('recipes');
            getRecipeTypes();
        };
        
        var getRecipeTypes = function () {
            recipeService.getRecipeTypes().then(function (data) {
                vm.recipeTypes = data.results;
                if (scaleConfig.static) {
                    var i = 0,
                        oJson = {},
                        sKey;
                    for (; sKey = localStorage.key(i); i++) {
                        oJson[sKey] = localStorage.getItem(sKey);
                    }
                    _.filter(_.pairs(oJson), function (o) {
                        if (_.contains(o[0], 'recipeType')) {
                            var type = JSON.parse(o[1]);
                            vm.localRecipeTypes.push(type);
                            vm.recipeTypes.push(type);
                        }
                    });
                }
                vm.recipeTypeIds = _.pluck(data, 'id');
                vm.viewRecipeTypeDetail(vm.requestedRecipeTypeId);
                hotkeys.bindTo($scope)
                    .add({
                        combo: 'ctrl+up',
                        description: 'Previous Recipe Type',
                        callback: function () {
                            if (vm.activeRecipeType) {
                                var idx = _.indexOf(vm.recipeTypeIds, vm.activeRecipeType.id);
                                if (idx > 0) {
                                    vm.loadRecipeType(vm.recipeTypeIds[idx - 1]);
                                }
                            }
                        }
                    }).add({
                        combo: 'ctrl+down',
                        description: 'Next Recipe Type',
                        callback: function () {
                            if (vm.activeRecipeType) {
                                var idx = _.indexOf(vm.recipeTypeIds, vm.activeRecipeType.id);
                                if (idx < (vm.recipeTypeIds.length - 1)) {
                                    vm.loadRecipeType(vm.recipeTypeIds[idx + 1]);
                                }
                            }
                        }
                    });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                if (vm.loading) {
                    vm.loading = false;
                }
            })
        };

        vm.clearLocalRecipeTypes = function () {
            _.forEach(vm.localRecipeTypes, function (type) {
                localStorage.removeItem('recipeType' + type.id);
            });
            $location.path('/recipes/types');
        };

        vm.newRecipeType = function(){
            $location.path('/recipes/types/0');
        };

        vm.viewRecipeTypeDetail = function (recipeTypeId) {
            if (recipeTypeId > 0) {
                recipeService.getRecipeTypeDetail(recipeTypeId).then(function (data) {
                    vm.activeRecipeType = data;
                });
            } else if( recipeTypeId === 0) {
                vm.activeRecipeType = new RecipeType();
            }
        };

        vm.loadRecipeType = function (id) {
            if (vm.activeRecipeType && vm.activeRecipeType.modified) {
                confirmChangeRecipe().then(function () {
                    // OK
                    $location.path('/recipes/types/' + id);
                }, function () {
                    // Cancel

                });
            } else {
                $location.path('/recipes/types/' + id);
            }
        };

        var confirmChangeRecipe = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'confirmDialog.html',
                scope: $scope,
                size: 'sm'
            });

            return modalInstance.result;
        };

        vm.toggleMaster = function (minimizeMaster) {
            if (typeof minimizeMaster !== 'undefined') {
                vm.minimizeMaster = minimizeMaster;
            } else {
                vm.minimizeMaster = !vm.minimizeMaster;
            }
            vm.masterClass = vm.minimizeMaster ? 'col-xs-1 minimized' : 'col-xs-3';
            vm.detailClass = vm.minimizeMaster ? 'col-xs-11' : 'col-xs-9';
            vm.minimizeBtnClass = vm.minimizeMaster ? 'fa fa-chevron-right' : 'fa fa-chevron-left';
        };

        $rootScope.$on('toggleEdit', function (event, data) {
            vm.toggleMaster(data === 'edit');
        });

        initialize();

        $rootScope.$on('recipeModified', function () {
            vm.isRecipeModified = true;
            vm.saveBtnClass = 'btn-success';
        });

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('recipesController', ['$scope', '$location', 'scaleConfig', 'scaleService', 'stateService', 'recipeService', 'navService', 'subnavService', 'gridFactory', 'poller', function ($scope, $location, scaleConfig, scaleService, stateService, recipeService, navService, subnavService, gridFactory, poller) {
        subnavService.setCurrentPath('recipes');

        var vm = this,
            recipeTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.recipesParams = stateService.getRecipesParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.recipeTypeValues = [recipeTypeViewAll];
        vm.selectedRecipeType = vm.recipesParams.type_id ? vm.recipesParams.type_id : recipeTypeViewAll;
        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        vm.lastModifiedStart = moment.utc(vm.recipesParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.recipesParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.recipesParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.recipesParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByRecipeType = vm.recipesParams.type_id ? true : false,
            filteredByOrder = vm.recipesParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'recipe_type',
                displayName: 'Recipe Type',
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.recipe_type.title }} {{ row.entity.recipe_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedRecipeType" ng-options="recipeType as (recipeType.title + \' \' + recipeType.version) for recipeType in grid.appScope.vm.recipeTypeValues"></select>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'completed',
                enableFiltering: false,
                enableSorting: true,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.completed_formatted }}</div>'
            }
        ];

        vm.getRecipes = function () {
            recipeService.getRecipes(vm.recipesParams).then(function (data) {
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.getRecipeTypes = function () {
            recipeService.getRecipeTypes().then(function (data) {
                vm.recipeTypeValues.push(data.results);
                vm.recipeTypeValues = _.flatten(vm.recipeTypeValues);
                vm.selectedRecipeType = _.find(vm.recipeTypeValues, { id: vm.recipesParams.type_id }) || recipeTypeViewAll;
                vm.getRecipes();
            }).catch(function (error) {
                vm.loading = false;
            });
        };

        vm.filterResults = function () {
            poller.stopAll();
            stateService.setRecipesParams(vm.recipesParams);
            vm.loading = true;
            vm.getRecipes();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.recipesParams);
        };

        vm.updateRecipeOrder = function (sortArr) {
            vm.recipesParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateRecipeType = function (value) {
            if (value.id !== vm.recipesParams.type_id) {
                vm.recipesParams.page = 1;
            }
            vm.recipesParams.type_id = value.id === 0 ? null : value.id;
            vm.recipesParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                $location.path('/recipes/recipe/' + row.entity.id).search('');
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.recipesParams.page = currentPage;
                vm.recipesParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setRecipesColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateRecipeOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setRecipesParams(vm.recipesParams);
            vm.updateColDefs();
            vm.getRecipeTypes();
            navService.updateLocation('recipes');
        };

        vm.initialize();

        $scope.$watch('vm.selectedRecipeType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.recipeTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByRecipeType) {
                        vm.updateRecipeType(value);
                    }
                } else {
                    filteredByRecipeType = !angular.equals(value, recipeTypeViewAll);
                    vm.updateRecipeType(value);
                }
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.recipesParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.recipesParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getRecipesColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getRecipesParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.recipesParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();

/**
 * <ais-scale-recipe-viewer />
 */
(function () {
    angular.module('scaleApp').controller('aisScaleRecipeGraphViewerController', ['$rootScope', '$scope', '$location', '$uibModal', 'scaleConfig', 'scaleService', 'jobTypeService', 'recipeService', 'workspacesService', 'RecipeType', 'RecipeTypeDetail', 'JobType', 'localStorage', function ($rootScope, $scope, $location, $uibModal, scaleConfig, scaleService, jobTypeService, recipeService, workspacesService, RecipeType, RecipeTypeDetail, JobType, localStorage) {
        var vm = this;

        vm.vertices = [];
        vm.edges = [];
        vm.selectedJob = null;
        vm.selectedInputProvider = null;
        vm.mode = null;
        vm.editMode = null;
        vm.dependencyBtnClass = 'fa-plus';
        vm.addBtnText = 'New Recipe';
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.editBtnText = 'Edit';
        vm.editBtnClass = 'btn-success';
        vm.editBtnIcon = 'fa-edit';
        vm.jobTypeValues = [];
        vm.saveBtnClass = 'btn-default';
        vm.savingRecipe = false;
        vm.warnings = [];
        vm.readonly = true;
        vm.detailMaxHeight = 0;
        vm.recipeTypeTrigger = { dataTypes: '' };
        vm.detailContainerStyle = '';
        vm.containerClass = $scope.hasContainer ? '' : 'detail-container no-tabs';
        vm.lastStatusChange = '';
        vm.availableWorkspaces = [];
        vm.recipeInputTypes = [
            {
                name: 'property',
                title: 'Property',
                fields: []
            },
            {
                name: 'file',
                title: 'File',
                fields: [
                    {
                        name: 'media_types',
                        title: 'Media Types',
                        value: []
                    }
                ]
            },
            {
                name: 'files',
                title: 'Files',
                fields: [
                    {
                        name: 'media_types',
                        title: 'Media Types',
                        value: []
                    }
                ]
            }
        ];
        vm.availableTriggerTypes = scaleConfig.triggerTypes;
        vm.selectedRecipeInputType = {};
        vm.recipeInput = {
            name: '',
            required: true,
            type: ''
        };
        vm.isIE = scaleService.isIE();

        var startJob = null;
        var zoomScale = 0;

        // Dagre variables
        var svg = null;
        var inner = null;
        var graph = null;
        var zoom = null;
        var render = null;

        var getClosestNode = function (name) {
            return d3.selectAll('.nodeRect').filter(function (d) {
                return d === name;
            });
        };

        var getOtherNodes = function (name) {
            return d3.selectAll('.nodeRect').filter(function (d) {
                return d !== name;
            });
        };

        var resetEditBtn = function () {
            vm.editBtnText = vm.mode === 'edit' ? 'Cancel Edit' : 'Edit';
            vm.editBtnClass = vm.mode === 'edit' ? 'btn-warning' : 'btn-success';
            vm.editBtnIcon = vm.mode === 'edit' ? 'fa-close' : 'fa-edit';
        };

        var resetAddBtn = function () {
            vm.addBtnText = vm.mode === 'add' ? 'Cancel' : 'New Recipe';
            vm.addBtnClass = vm.mode === 'add' ? 'btn-warning' : 'btn-primary';
            vm.addBtnIcon = vm.mode === 'add' ? 'fa-close' : 'fa-plus-circle';
        };

        var toggleAddRecipe = function () {
            vm.mode = vm.mode === 'add' ? 'view' : 'add';
            resetAddBtn();
        };

        var toggleEditRecipe = function () {
            if (vm.mode === 'edit') {
                vm.mode = 'view';
                vm.reloadRecipeTypeDetail($scope.recipeType.id);
            } else {
                vm.mode = 'edit';
            }
            vm.editMode = '';
            resetEditBtn();
        };

        var enableSaveRecipe = function () {
            $scope.recipeType.modified = true;
            vm.saveBtnClass = 'btn-success';
        };

        var disableSaveRecipe = function () {
            $scope.recipeType.modified = false;
            vm.saveBtnClass = 'btn-default;'
        };

        var confirmChangeRecipe = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'confirmDialog.html',
                scope: $scope,
                size: 'sm'
            });

            return modalInstance.result;
        };

        var getRecipeTypeJobClassName = function (job) {
            // default to 'nostatus'
            var className = 'nostatus';
            // find the associated job in the recipe.jobs
            if ($scope.recipe) {
                var recipejob = _.find($scope.recipe.jobs,{job_name: job.name});
                if (recipejob) {
                    className = recipejob.job.status.toLowerCase();
                }
            }
            return className;
        };

        vm.reloadRecipeTypeDetail = function (id) {
            var getRecipeDetail = function () {
                recipeService.getRecipeTypeDetail(id).then(function (data) {
                    $scope.recipeType = data;

                });
            };

            if ($scope.recipeType.modified) {
                confirmChangeRecipe().then(function () {
                    // OK
                    disableSaveRecipe();
                    resetAddBtn();
                    if (vm.mode === 'edit') {
                        toggleEditRecipe();
                    }
                    getRecipeDetail();
                }, function () {
                    // Cancel

                });
            } else {
                if (vm.mode === 'edit') {
                    toggleEditRecipe();
                }
                resetAddBtn();
                getRecipeDetail();
            }
        };

        vm.redraw = function () {
            initialize();
            //$rootScope.$broadcast('recipeModified');
        };

        vm.nodeClick = function (name) {
            // Remove selection class
            //$('div').removeClass('selected-node');
            d3.selectAll('.nodeRect').classed('selected-node', false);

            // find the job in the recipe definition
            var job = _.find($scope.recipeType.definition.jobs, { name: name });

            if (name === 'start') {
                job = startJob;
            }
            var $name = $('#' + name);
            var pos = $name.position();

            // click node different from selectedJob
            if (!vm.selectedJob || job.name !== vm.selectedJob.name) {
                if (vm.editMode === 'addDependency') {
                    addDependency(name);
                    enableSaveRecipe();
                    vm.redraw();

                } else if (vm.editMode === 'addInput') {
                    var contentStr = '';
                    if (job.name === 'start') {
                        contentStr = '<ul class="list-group">';
                        _.forEach($scope.recipeType.definition.input_data, function (recipeInput) {
                            contentStr = contentStr + '<li class="list-group-item">';
                            contentStr = contentStr + '<a onclick="mapInputRecipeInput(\'' + recipeInput.name + '\')">' + recipeInput.name + '</a>';
                            if (recipeInput.media_types) {
                                contentStr = contentStr + '<div class="input-media-types">' + recipeInput.media_types.join(',') + '</div>';
                            }
                            contentStr = contentStr + '</li>';
                        });
                        contentStr = contentStr + '</ul>';
                        $name.popover({
                            container: 'body',
                            content: contentStr,
                            html: true,
                            title: 'Select provider/output'
                        });
                        $name.popover('show');
                    } else {
                        if (job.job_type.job_type_interface.output_data.length > 0) {
                            contentStr = '<ul class="list-group">';
                            _.forEach(job.job_type.job_type_interface.output_data, function (jobOutput) {
                                contentStr = contentStr + '<li class="list-group-item">';
                                contentStr = contentStr + '<a onclick="mapInput(\'' + job.name + '\', \'' + jobOutput.name + '\')">' + jobOutput.name + '</a>';
                                if (jobOutput.media_type) {
                                    contentStr = contentStr + '<div class="input-media-types">' + jobOutput.media_type + '</div>';
                                }
                                contentStr = contentStr + '</li>';
                            });
                            contentStr = contentStr + '</ul>';
                            $name.popover({
                                container: 'body',
                                content: contentStr,
                                html: true,
                                title: 'Select provider/output'
                            });
                            $name.popover('show');
                        }
                    }
                } else if (vm.editMode === 'addOutput') {
                    vm.selectedOutputReceiver = job;
                    if (job.job_type.job_type_interface.input_data.length > 0) {
                        contentStr = '<ul class="list-group">';
                        _.forEach(job.job_type.job_type_interface.input_data, function (jobInput) {
                            contentStr = contentStr + '<li class="list-group-item">';
                            contentStr = contentStr + '<a onclick="mapOutput(\'' + job.name + '\', \'' + jobInput.name + '\')">' + jobInput.name + '</a>';
                            if (jobInput.media_types) {
                                contentStr = contentStr + '<div class="input-media-types">' + jobInput.media_types.join(',') + '</div>';
                            }
                            contentStr = contentStr + '</li>';
                        });
                        contentStr = contentStr + '</ul>';
                        $name.popover({
                            container: 'body',
                            content: contentStr,
                            html: true,
                            title: 'Select receiver/input'
                        });
                        $name.popover('show');
                    }
                } else {
                    // update the selected job
                    vm.selectedJob = job;
                    if ($scope.recipe) {
                        vm.selectedRecipeJob = _.find($scope.recipe.jobs, { job_name: job.name });
                    }
                    // apply the selected-node class
                    //$name.addClass('selected-node');
                    getClosestNode(name).classed('selected-node', true);
                }
            }
            else { // click selected node
                //$('div').removeClass('selected-node');
                d3.selectAll('.nodeRect').classed('selected-node', false);
                vm.selectedJob = null;
                vm.selectedRecipeJob = null;
                vm.selectedOutputReceiver = null;
                vm.selectedInputProvider = null;
                vm.editMode = '';
                vm.dependencyBtnClass = 'fa-plus';

                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
                getOtherNodes(name).classed('selected-node-selectable', false);
            }
            if (vm.selectedJob) {
                //$('#' + vm.selectedJob.name).addClass('selected-node');
                getClosestNode(vm.selectedJob.name).classed('selected-node', true);
            }
        };
        vm.toggleEditMode = function () {
            if (vm.mode === 'edit') {
                vm.reloadRecipeTypeDetail($scope.recipeType.id);
            } else {
                toggleEditRecipe();
                resetAddBtn();
            }
            $rootScope.$broadcast('toggleEdit', vm.mode);
        };

        vm.openAddJob = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'addJobContent.html',
                scope: $scope,
                size: 'sm'
            });

            modalInstance.result.then(function () {
                if (vm.selectedJobType) {
                    jobTypeService.getJobTypeDetails(vm.selectedJobType.id).then(function (data) {
                        vm.addJobType(data);
                        enableSaveRecipe();
                    });
                }
            }, function () {

            });
        };

        vm.openEditTrigger = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'editTrigger.html',
                scope: $scope,
                size: 'md'
            });

            modalInstance.result.then(function () {
                if (vm.mode === 'edit' || vm.mode === 'add') {
                    $scope.recipeType.trigger_rule.configuration.condition.data_types = vm.recipeTypeTrigger.dataTypes ? vm.recipeTypeTrigger.dataTypes.split(',') : [];
                    enableSaveRecipe();
                }
            }, function () {

            });


        };

        vm.deleteRecipeInput = function (inputName) {
            var removedRecipeInput = _.remove($scope.recipeType.definition.input_data, function (recipeInput) {
                return recipeInput.name === inputName;
            });
            console.log('removed ' + removedRecipeInput.length + ' recipe inputs.');
            enableSaveRecipe();
            vm.redraw();

        };

        vm.openAddInput = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'addInput.html',
                scope: $scope
            });

            modalInstance.result.then(function () {
                // check for fields and add as necessary
                if ( vm.selectedRecipeInputType.fields.length > 0) {
                    var fieldArr = [];
                    _.forEach(vm.selectedRecipeInputType.fields, function (field) {
                        _.forEach(field.value.split(','), function (value) {
                            fieldArr.push(value);
                        });
                        vm.recipeInput[field.name] = fieldArr;
                    });
                }

                // add input to recipe type definition
                $scope.recipeType.definition.input_data.push(vm.recipeInput);
                _.forEach($scope.recipeType.definition.jobs, function (job) {
                    if (job.recipe_inputs.length === 0) {
                        job.recipe_inputs.push({
                            job_input: vm.recipeInput.name,
                            recipe_input: vm.recipeInput.name
                        });
                    }
                });
                getIoMappings();

                // reset form fields
                vm.recipeInput = {
                    name: '',
                    required: true,
                    type: ''
                };
                vm.selectedRecipeInputType = {};
            });
        };

        vm.changeInputType = function () {
            vm.selectedRecipeInputType = _.find(vm.recipeInputTypes, {'name': vm.recipeInput.type});
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateRecipeType = function () {
            recipeService.validateRecipeType($scope.recipeType).then(function (validationResult) {
                if (validationResult.warnings && validationResult.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(validationResult.warnings);
                    toastr["warning"](warningsHtml);
                } else {
                    toastr["success"]('Recipe is valid.');
                }
            }).catch(function (error) {
                if (error.detail) {
                    toastr["error"](error.detail);
                } else {
                    toastr["error"](error);
                }
            });

        };


        vm.saveRecipeType = function () {
            vm.savingRecipe = true;
            recipeService.validateRecipeType($scope.recipeType).then(function (validationResult) {
                if (validationResult.warnings && validationResult.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(validationResult.warnings);
                    toastr["warning"](warningsHtml);
                    vm.savingRecipe = false;
                }
                recipeService.saveRecipeType($scope.recipeType).then(function (saveResult) {
                    vm.savingRecipe = false;
                    $scope.recipeType = RecipeTypeDetail.transformer(saveResult);
                    if (scaleConfig.static) {
                        console.log(JSON.stringify($scope.recipeType));
                        localStorage.setItem('recipeType' + $scope.recipeType.id, JSON.stringify($scope.recipeType));
                    }
                    vm.redraw();
                    $location.path('/recipes/types/' + $scope.recipeType.id);
                });
            }).catch(function (error) {
                if (error && error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error'](error);
                }
                vm.savingRecipe = false;
            });

            disableSaveRecipe();
        };

        vm.addJobType = function (selectedJobType) {
            console.log(selectedJobType.name);
            $scope.recipeType.definition.addJob(selectedJobType);
            //$scope.$broadcast('redrawRecipes');
            vm.redraw();
        };

        vm.mapInput = function (providerName, providerOutput) {
            console.log('map selected job input to ' + providerName + '.' + providerOutput);
            var dependency = _.find(vm.selectedJob.dependencies, {name: providerName});

            if (dependency && dependency.connections && dependency.connections.length > 0) {
                var conn = _.find(dependency.connections, { output: providerOutput, input: vm.selectedJobInput.name });
                if (!conn) {
                    dependency.connections.push({ output: providerOutput, input: vm.selectedJobInput.name });
                }
            }
            else if (!dependency) {
                dependency = {name: providerName, connections: [{ output: providerOutput, input: vm.selectedJobInput.name }]};
                vm.selectedJob.dependencies.push(dependency);
            }
            else {
                dependency.connections = [{ output: providerOutput, input: vm.selectedJobInput.name }];
            }
            vm.selectedJob.depStart = false;
            vm.editMode = '';
            vm.selectedJobInput = null;
            vm.selectedInputProvider = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.mapInputRecipeInput = function (recipeInput) {
            console.log('map selected job to recipe input ' + recipeInput);
            var existingInput = _.find(vm.selectedJob.recipe_inputs, { job_input: vm.selectedJobInput.name });
            if ( existingInput && existingInput.recipe_name !== recipeInput) {
                // update it
                existingInput.recipe_input = recipeInput;
                enableSaveRecipe();
                vm.redraw();
            } else if ( !existingInput ) {
                // create it
                vm.selectedJob.recipe_inputs.push({
                    job_input: vm.selectedJobInput.name,
                    recipe_input: recipeInput
                });
                enableSaveRecipe();
                vm.redraw();
            }
            vm.editMode = '';
            vm.selectedJobInput = null;
            vm.selectedInputProvider = null;
        };

        vm.mapOutput = function (receiverName, receiverInput) {
            var dependency = _.find(vm.selectedOutputReceiver.dependencies, {name: vm.selectedJob.name});

            if (dependency && dependency.connections && dependency.connections.length > 0) {
                var conn = _.find(dependency.connections, { output: vm.selectedJobOutput.name, input: receiverInput });
                if (!conn) {
                    dependency.connections.push({output: vm.selectedJobOutput.name, input: receiverInput});
                }
            }
            else if (!dependency) {
                dependency = {name: vm.selectedJob.name, connections: [{output: vm.selectedJobOutput.name, input: receiverInput}]};
                vm.selectedOutputReceiver.dependencies.push(dependency);
            }
            else {
                dependency.connections = [{output: vm.selectedJobOutput.name, input: receiverInput}];
            }
            vm.selectedOutputReceiver.depStart = false;
            vm.editMode = '';
            vm.selectedJobOutput = null;
            vm.selectedOutputReceiver = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.toggleAddDependency = function () {
            if (vm.editMode === 'addDependency') {
                vm.editMode = '';
                vm.dependencyBtnClass = 'fa-plus';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                console.log('toggle addDependency mode');
                vm.editMode = 'addDependency';
                vm.dependencyBtnClass = 'fa-remove';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.toggleAddInput = function (jobinput) {
            if (vm.editMode === 'addInput') {
                vm.editMode = '';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                vm.selectedJobInput = jobinput;
                console.log('toggle addInput mode');
                vm.editMode = 'addInput';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.toggleAddOutput = function (joboutput) {
            if (vm.editMode === 'addOutput') {
                vm.editMode = '';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                vm.selectedJobOutput = joboutput;
                console.log('toggle addOutput mode');
                vm.editMode = 'addOutput';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.removeDependency = function (depName) {
            var removedDeps = _.remove(vm.selectedJob.dependencies, function (dep) {
                return dep.name === depName;
            });
            console.log('removed ' + removedDeps.length + ' dependencies.');
            enableSaveRecipe();
            vm.redraw();
        };

        vm.removeInputMapping = function (depName, depOutput) {
            if ( depName === 'recipe' ) {
                // remove it from selectedJob.recipe_inputs
                var dep = _.remove(vm.selectedJob.recipe_inputs, { recipe_input: depOutput });
                enableSaveRecipe();
                vm.redraw();
            } else {
                var dep = _.find(vm.selectedJob.dependencies, {name: depName});
                if (dep && dep.connections) {
                    // it's an input from another job
                    var removedCon = _.remove(dep.connections, function (conn) {
                        return conn.output === depOutput;
                    });
                    console.log('removed ' + removedCon.length + ' input connections.');
                    enableSaveRecipe();
                    vm.redraw();
                }
            }

        };

        vm.deleteRecipeJob = function (jobName) {
            // remove dependent connections
            _.forEach($scope.recipeType.definition.jobs, function (job) {
                _.remove(job.dependencies, {name: jobName});
            });
            // remove job from definition.jobs
            _.remove($scope.recipeType.definition.jobs, { name: jobName });
            // enable save and redraw
            vm.selectedJob = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.removeOutputMapping = function (jobName, depOutput) {
            // we have to remove output mapping from the job where the dependency is defined
            var receiver = _.find($scope.recipeType.definition.jobs,{name: jobName});
            // remove it from receiver.dependencies
            var dep = _.find(receiver.dependencies, {name: vm.selectedJob.name});
            if (dep && dep.connections) {
                var removedCon = _.remove(dep.connections, function (conn) {
                    return conn.output === depOutput;
                });
                console.log('removed ' + removedCon.length + ' output connections.');
                enableSaveRecipe();
                vm.redraw();
            }
        };

        vm.selectJobTypeToAdd = function (item) {
            vm.selectedJobType = item;
        };

        $scope.$on('redrawRecipes', function () {
            vm.redraw();
        });

        var addDependency = function (jobName) {
            console.log(vm.selectedJob.name + '->' + jobName);
            if (!vm.selectedJob.dependencies) {
                vm.selectedJob.dependencies = [];
            }
            var existingDependency = _.find(vm.selectedJob.dependencies, {name: jobName});

            if (!existingDependency) { vm.selectedJob.dependencies.push({name: jobName}); }
            vm.selectedJob.depStart = false;
            vm.editMode = '';
            vm.dependencyBtnClass = 'fa-plus';

        };

        var getIoMappings = function () {
            if ($scope.recipeType.definition) {
                _.forEach($scope.recipeType.definition.jobs, function (job) {
                    // populate the current jobType
                    /*var thisJobType = _.find($scope.recipeType.job_types,{id: job.job_type_id});
                     job.job_type = thisJobType;*/

                    // find dependents
                    if (job.job_type && job.job_type.job_type_interface) {
                        _.forEach(job.job_type.job_type_interface.output_data, function (jobOutput, key) {
                            if (jobOutput) {
                                var deps = getDependents(job.name,jobOutput.name);
                                jobOutput.dependents = deps;
                            }
                        });
                        // add dependency mappings
                        _.forEach(job.job_type.job_type_interface.input_data, function (jobInput, key) {
                            if (jobInput) {
                                var inputMappings = [];
                                _.forEach(job.dependencies, function (dependency,key) {
                                    _.forEach(dependency.connections, function (conn,key) {
                                        if (conn.input === jobInput.name) {
                                            inputMappings.push({
                                                name: dependency.name,
                                                output: conn.output,
                                                input: conn.input
                                            });
                                        }
                                    });
                                });
                                _.forEach(job.recipe_inputs, function (recipeInput, key) {
                                    if (recipeInput.job_input === jobInput.name) {
                                        inputMappings.push({
                                            name: 'recipe',
                                            output: recipeInput.recipe_input,
                                            input: recipeInput.job_input
                                        });
                                    }
                                });
                                jobInput.dependencies = inputMappings;
                            }
                        });

                    }
                });
            }

        };

        var initialize = function () {

            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues = data.results;
            });

            workspacesService.getWorkspaces().then(function (data) {
                vm.availableWorkspaces = data
            });

            $scope.$watchCollection('recipeType', function (newValue, oldValue) {
                if (!$scope.recipeType) {
                    $scope.recipeType = new RecipeType();
                }

                if (typeof $scope.recipeType.id === 'undefined' || $scope.recipeType.id === null || $scope.recipeType.id === 0) {
                    vm.mode = 'add';
                } else {
                    if (vm.mode !== 'edit') {
                        vm.mode = 'view'
                    }
                }
                _.forEach($scope.recipeType.definition.jobs, function (job, idx) {
                    if (!job.job_type.job_type_interface && $scope.recipeType.job_types) {
                        var jobTypeData = _.find($scope.recipeType.job_types, {name: job.job_type.name, version: job.job_type.version});
                        $scope.recipeType.definition.jobs[idx].job_type = jobTypeData;
                    }
                });

                // setup string to bind comma delimited list of trigger rule configuration condition data types
                if ($scope.recipeType.trigger_rule) {
                    if ($scope.recipeType.trigger_rule.configuration) {
                        if ($scope.recipeType.trigger_rule.configuration.condition) {
                            if ($scope.recipeType.trigger_rule.configuration.condition.data_types) {
                                vm.recipeTypeTrigger.dataTypes = $scope.recipeType.trigger_rule.configuration.condition.data_types.join(',');
                            }
                        }
                    }
                }

                initGraph();
                getIoMappings();
                drawGraph();
            });
            if ($scope.$parent.vm.user) {
                vm.readonly = false;
            }
        };

        var initGraph = function () {
            // ******
            // setup D3 container and Graph
            // ******
            //vm.selectedJob = null;
            function clicked() {
                var d = d3.event;
                var x = d3.event.x;
                var y = d3.event.y;
                var width = parseInt(svg.style("width").replace(/px/, ""));
                var height = parseInt(svg.style("height").replace(/px/, ""));

                inner.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(2)translate(" + -x + "," + -y + ")");

                //inner.attr("transform", "translate(50px, 50px)scale(2,3)");

                console.log(d);
            }

            svg = d3.select("svg");
            inner = svg.select("g"); //.on("click", clicked);
            // Set up zoom support
            zoom = d3.behavior.zoom().on("zoom", function () {
                zoomScale = d3.event.scale;
                inner.attr("transform", "translate(" + d3.event.translate + ")" +
                  "scale(" + zoomScale + ")");
            });
            svg.call(zoom);

            render = new dagreD3.render();

            // Left-to-right layout
            graph = new dagreD3.graphlib.Graph();
            graph.setGraph({
                nodesep: 70,
                ranksep: 50,
                rankdir: "TB",
                marginx: 20,
                marginy: 20
            });
        };

        drawGraph = function () {
            // globals because dagre needs a reference to angular scope
            window.nodeClick = function (name) {
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.nodeClick(name);
                });
            };

            window.mapInput = function (jobName, jobOutput) {
                $('#' + jobName).popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapInput(jobName, jobOutput);
                });
            };

            window.mapInputRecipeInput = function (recipeInputName) {
                $('#start').popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapInputRecipeInput(recipeInputName);
                });
            };

            window.mapOutput = function (jobName, jobInput) {
                $('#' + jobName).popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapOutput(jobName, jobInput);
                });
            };

            if ($scope.recipe) {
                vm.lastStatusChange = $scope.recipe.last_modified ? moment.duration(moment.utc($scope.recipe.last_modified).diff(moment.utc())).humanize(true) : '';
            }

            var jobs = [];
            if ($scope.recipeType.definition) {
                jobs = $scope.recipeType.definition.jobs;
            }
            var childCounts = [];
            // create graph objects
            for (var idx in jobs) {
                var job = jobs[idx];

                if (job.dependencies === undefined || job.dependencies.length < 1) {
                    job.depStart = true;
                }
                var className = getRecipeTypeJobClassName(job);

                var html = '<div class="recipeNode">';
                //var html = "<div onclick=\"console.log('" + job.job_type.name + "')\">";
                if (className !== 'nostatus') {
                    html += '<span class="status"></span>';
                }
                //   html += "<span class=consumers>"+worker.consumers+"</span>";
                html += '<span class="name">';
                if (job.job_type) {
                    //console.log(job.jobType);
                    html += '<div id="' + job.name + '" class="" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + job.job_type.getIcon() + ' ' + job.name + '</span></div>';
                    //if (jobType.name) {
                    //    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + jobType.getIcon() + ' ' + jobType.title + '</span></div>';
                    //} else {
                    //    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + jobType.getIcon() + ' ' + job.name + '</span></div>';
                    //}

                }
                html += '</span>';
                //   html += "<span class=queue><span class=counter>"+worker.count+"</span></span>";
                html += '</div>';
                graph.setNode(job.name, {
                    labelType: 'html',
                    label: html,
                    rx: 5,
                    ry: 5,
                    padding: 0,
                    class: className
                });
                // setup edges
                for (var d in job.dependencies) {
                    var dep = job.dependencies[d];

                    if (dep.name) {
                        graph.setEdge(dep.name, job.name, {
                            //labelType: 'html',
                            //label: dep.name + '-->' + job.name,
                            width: 20

                        });
                        if (childCounts[dep.name]) {
                            childCounts[dep.name] += 1;
                        } else {
                            childCounts[dep.name] = 1;
                        }
                    }
                }
            }

            // set start node and edges
            graph.setNode('start', {
                labelType: 'html',
                label: '<div id="start" class="recipeNode" onclick="nodeClick(\'start\')"><span class=name>Start</span></div>',
                rx: 5,
                ry: 5,
                padding: 0
            });
            startJob = {
                name: 'start',
                job_type: {
                    title: 'Start'
                },
                input_data: $scope.recipeType.input_data
            };
            var noDeps = _.filter(jobs, 'depStart', true);
            for (var n in noDeps) {
                graph.setEdge('start', noDeps[n].name, {
                    width: 20
                });
            }

            // set end node and edges
            graph.setNode('end', {
                labelType: 'html',
                label: '<div class="recipeNode"><span class="name">End</span></div>',
                rx: 5,
                ry: 5,
                padding: 0
            });
            var noChildren =_.filter(jobs, function (job) {
                return !childCounts[job.name];
            });
            for (var o in noChildren) {
                graph.setEdge(noChildren[o].name, 'end', {
                    width: 20
                });
            }

            // wait for current call stack to clear
            _.defer(function () {
                inner.call(render, graph);
                zoom.event(d3.select("svg"));

                $('.node rect').attr('class', 'nodeRect');

                // add selected class to appropriate node
                if (vm.selectedJob) {
                    //$('#' + vm.selectedJob.name).addClass('selected-node');
                    getClosestNode(vm.selectedJob.name).classed('selected-node', true);
                }
            });
        };

        var getDependents = function (name,outputName) {
            var results = [];

            _.forEach($scope.recipeType.definition.jobs, function (job, key) {
                if (job.name !== name) {
                    _.forEach(job.dependencies, function (dependency, key) {
                        if (dependency.name === name) {
                            _.forEach(dependency.connections, function (conn, key) {
                                if (conn.output === outputName) {
                                    results.push({
                                        name: job.name,
                                        output: conn.output,
                                        input: conn.input
                                    });
                                }
                            });
                        }
                    });
                }
            });
            return results;
        };

        initialize();

    }]).directive('aisScaleRecipeGraphViewer', function () {
        'use strict';
        /**
         * Usage: <ais-scale-recipe-viewer recipe="recipe" />
         */
        return {
            controller: 'aisScaleRecipeGraphViewerController',
            controllerAs: 'vm',
            templateUrl: 'modules/recipes/partials/recipeGraphViewerTemplate.html',
            restrict: 'E',
            scope: {
                recipeType: '=',
                recipe: '=',
                isModified: '=modified',
                allowEdit: '=',
                hasContainer: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Recipe', ['scaleConfig', 'RecipeType', 'scaleService', function (scaleConfig, RecipeType, scaleService) {
        var Recipe = function (id, created, completed, last_modified, recipe_type) {
            this.id = id;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.completed = completed;
            this.completed_formatted = completed ? moment.utc(completed).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.last_status_change = last_modified ? moment.duration(moment.utc(last_modified).diff(moment.utc())).humanize(true) : '';
            this.recipe_type = RecipeType.transformer(recipe_type);
        };

        // public methods
        Recipe.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            }
        };

        // static methods, assigned to class
        Recipe.build = function (data) {
            if (data) {
                return new Recipe(
                    data.id,
                    data.created,
                    data.completed,
                    data.last_modified,
                    data.recipe_type
                );
            }
            return new Recipe();
        };

        Recipe.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Recipe.build)
                    .filter(Boolean);
            }
            return Recipe.build(data);
        };

        return Recipe;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeData', function () {
        var RecipeData = function (input_data, version, workspace_id) {
            this.input_data = input_data;
            this.version = version;
            this.workspace_id = workspace_id;
        };

        // static methods, assigned to class
        RecipeData.build = function (data) {
            if (data) {
                return new RecipeData(
                    data.input_data,
                    data.version,
                    data.workspace_id
                );
            }
            return new RecipeData();
        };

        RecipeData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeData.build)
                    .filter(Boolean);
            }
            return RecipeData.build(data);
        };

        return RecipeData;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeDetails', ['RecipeData', 'RecipeTypeDefinition', 'RecipeType', 'RecipeTypeDetail', 'RecipeJobContainer', 'scaleConfig', function (RecipeData, RecipeTypeDefinition, RecipeType, RecipeTypeDetail, RecipeJobContainer, scaleConfig) {
        var RecipeDetails = function (id, created, completed, last_modified, data, recipe_type, recipe_type_rev, jobs,
                                      is_superseded, root_superseded_recipe, superseded_recipe,
                                      superseded_by_recipe, superseded) {
            this.id = id;
            this.created = created;
            this.completed = completed;
            this.completed_formatted = this.completed ? moment.utc(this.completed).format(scaleConfig.dateFormats.day_second_utc) : this.completed;
            this.last_modified = last_modified;
            this.data = RecipeData.transformer(data);
            this.recipe_type = RecipeType.transformer(recipe_type);
            this.recipe_type_rev = RecipeTypeDetail.transformer(recipe_type_rev);
            this.jobs = RecipeJobContainer.transformer(jobs);
            this.is_superseded = is_superseded;
            this.root_superseded_recipe = root_superseded_recipe;
            this.superseded_recipe = superseded_recipe;
            this.superseded_by_recipe = superseded_by_recipe;
            this.superseded = superseded;
        };

        // static methods, assigned to class
        RecipeDetails.build = function (data) {
            if (data) {
                return new RecipeDetails(
                  data.id,
                  data.created,
                  data.completed,
                  data.last_modified,
                  data.data,
                  data.recipe_type,
                  data.recipe_type_rev,
                  data.jobs,
                  data.is_superseded,
                  data.root_superseded_recipe,
                  data.superseded_recipe,
                  data.superseded_by_recipe,
                  data.superseded
                );
            }
            return new RecipeDetails();
        };

        RecipeDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                  .map(RecipeDetails.build)
                  .filter(Boolean);
            }
            return RecipeDetails.build(data);
        };

        return RecipeDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeJob', ['JobType', function (JobType) {
        var RecipeJob = function (id, status, job_type) {
            this.id = id;
            this.status = status;
            this.job_type = JobType.transformer(job_type);
        };

        // static methods, assigned to class
        RecipeJob.build = function (data) {
            if (data) {
                return new RecipeJob(
                    data.id,
                    data.status,
                    data.job_type
                );
            }
            return new RecipeJob();
        };

        RecipeJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeJob.build)
                    .filter(Boolean);
            }
            return RecipeJob.build(data);
        };

        return RecipeJob;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeJobContainer', ['RecipeJob', function (RecipeJob) {
        var RecipeJobContainer = function (job_name, job) {
            this.job_name = job_name;
            this.job = RecipeJob.transformer(job);
        };

        // static methods, assigned to class
        RecipeJobContainer.build = function (data) {
            if (data) {
                return new RecipeJobContainer(
                    data.job_name,
                    data.job
                );
            }
            return new RecipeJobContainer();
        };

        RecipeJobContainer.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeJobContainer.build)
                    .filter(Boolean);
            }
            return RecipeJobContainer.build(data);
        };

        return RecipeJobContainer;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeType', ['scaleConfig', 'RecipeTypeDefinition', function (scaleConfig, RecipeTypeDefinition) {
        var RecipeType = function (id, name, version, title, description, is_active, definition, revision_num, created,  last_modified, archived, trigger_rule) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.is_active = is_active;
            this.definition = definition ? RecipeTypeDefinition.transformer(definition) : new RecipeTypeDefinition();
            this.revision_num = revision_num;
            this.created = created;
            this.last_modified = last_modified;
            this.archived = archived;
            if (trigger_rule) {
                this.trigger_rule = trigger_rule;
            } else {
                this.trigger_rule = {
                    type: '',
                    name: '',
                    is_active: false,
                    configuration: {
                        condition: {
                            media_type: '',
                            data_types: []
                        },
                        data: {
                            workspace_name: '',
                            input_data_name: ''
                        }
                    }
                };
            }
            this.modified = false;
        };

        // static methods, assigned to class
        RecipeType.build = function (data) {
            if (data) {
                return new RecipeType(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.is_active,
                    data.definition,
                    data.revision_num,
                    data.created,
                    data.last_modified,
                    data.archived,
                    data.trigger_rule
                );
            }
            return new RecipeType();
        };

        RecipeType.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(RecipeType.build);
            }
            return RecipeType.build(data);
        };

        return RecipeType;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDefinition', ['scaleConfig', 'RecipeTypeDefinitionJob', 'JobTypeInputData', function (scaleConfig, RecipeTypeDefinitionJob, JobTypeInputData) {

        var self = this;
        // private methods
        var RecipeTypeDefinition = function (input_data, version, jobs) {
            this.input_data = input_data ? JobTypeInputData.transformer(input_data) : [];
            this.version = version || '1.0';
            this.jobs = jobs ? RecipeTypeDefinitionJob.transformer(jobs) : [];
        };

        var getJobName = function(jobs, jobName){
            var theName = jobName;
            var existing = _.find(jobs, { 'name': jobName });
            var idx = 2;
            while(existing){
                theName = jobName + '-' + idx;
                existing = _.find(jobs, { 'name': theName });
                idx++;
            }
            return theName;
        };

        // public methods
        RecipeTypeDefinition.prototype = {
            addJob: function (jobType) {
                var jname = getJobName(this.jobs, jobType.name);
                console.log(jname);
                var job = {
                    dependencies: [],
                    recipe_inputs: [],
                    name: jname,
                    job_type_id: jobType.id,
                    job_type: jobType
                };
                this.jobs.push(job);
            }
        };

        // static methods, assigned to class
        RecipeTypeDefinition.build = function (data) {
            if(data){
                return new RecipeTypeDefinition(
                    data.input_data,
                    data.version,
                    data.jobs
                );
            }
            return new RecipeTypeDefinition();
        };

        RecipeTypeDefinition.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDefinition.build);
            }
            return RecipeTypeDefinition.build(data);
        };

        return RecipeTypeDefinition;
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDefinitionJob', ['scaleConfig', 'JobTypeDetails', function (scaleConfig, JobTypeDetails) {
        // private methods
        var RecipeTypeDefinitionJob = function (recipe_inputs, name, job_type, dependencies) {
            this.recipe_inputs = recipe_inputs;
            this.name = name;
            this.job_type = job_type;
            //this.job_type = {
            //    name: job_type.name,
            //    version: job_type.version
            //};
            this.dependencies = dependencies || [];
        };

        // static methods, assigned to class
        RecipeTypeDefinitionJob.build = function (data) {
            if (data) {
                return new RecipeTypeDefinitionJob(
                    data.recipe_inputs,
                    data.name,
                    data.job_type,
                    data.dependencies
                );
            }
            return new RecipeTypeDefinitionJob();
        };

        RecipeTypeDefinitionJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDefinitionJob.build);
            }
            return RecipeTypeDefinitionJob.build(data);
        };


        return RecipeTypeDefinitionJob;

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDetail', ['scaleConfig', 'RecipeTypeDefinition', 'JobTypeDetails', function (scaleConfig, RecipeTypeDefinition, JobTypeDetails) {
        var RecipeTypeDetail = function (id, name, version, title, description, is_active, definition, created, last_modified, archived, trigger_rule, job_types) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.is_active = is_active;
            this.definition = RecipeTypeDefinition.transformer(definition);
            this.created = created;
            this.last_modified = last_modified;
            this.archived = archived;
            this.trigger_rule = trigger_rule;
            this.job_types = JobTypeDetails.transformer(job_types);
            this.modified = false;
        };

        // static methods, assigned to class
        RecipeTypeDetail.build = function (data) {
            if (data) {
                return new RecipeTypeDetail(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.is_active,
                    data.definition,
                    data.created,
                    data.last_modified,
                    data.archived,
                    data.trigger_rule,
                    data.job_types
                );
            }
            return new RecipeTypeDetail();
        };

        RecipeTypeDetail.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDetail.build);
            }
            return RecipeTypeDetail.build(data);
        };

        return RecipeTypeDetail;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeValidation', ['RecipeTypeDefinition', function (RecipeTypeDefinition) {

        var getRecipeTypeValidationJobs = function (jobs) {
            var jobsOut = [];
            _.forEach(jobs, function(job){
               jobsOut.push({
                   recipe_inputs: job.recipe_inputs,
                   name: job.name,
                   job_type: {
                       name: job.job_type.name,
                       version: job.job_type.version
                   },
                   dependencies: job.dependencies
               })
            });
            return jobsOut;
        };
        
        var RecipeTypeValidation = function (id, name, version, title, description, definition, trigger_rule) {
            if (id) {
                this.id = id;
            }
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.definition = {
                input_data: definition.input_data,
                jobs: getRecipeTypeValidationJobs(definition.jobs)
            };
            this.trigger_rule = trigger_rule;
        };

        // static methods, assigned to class
        RecipeTypeValidation.build = function (data) {
            if (data) {
                return new RecipeTypeValidation(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.definition,
                    data.trigger_rule
                );
            }
            return new RecipeTypeValidation();
        };

        RecipeTypeValidation.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeValidation.build);
            }
            return RecipeTypeValidation.build(data);
        };

        return RecipeTypeValidation;
    }]);
})();
(function () {
    'use strict';
    /**
     *
     */
    angular.module('scaleApp').service('recipeService', ['$http', '$q', '$timeout', 'scaleConfig', 'RecipeType', 'RecipeTypeDetail', 'Recipe', 'RecipeDetails', 'RecipeTypeValidation', function ($http, $q, $timeout, scaleConfig, RecipeType, RecipeTypeDetail, Recipe, RecipeDetails, RecipeTypeValidation) {
        var getRecipesParams = function (page, page_size, started, ended, order, completed, recipe_type_id, recipe_type_name, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                completed: completed,
                recipe_type_id: recipe_type_id,
                recipe_type_name: recipe_type_name,
                url: url
            };
        };

        var getRecipeTypesParams = function (page, page_size, started, ended, order) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order ? order : ['title', 'version']
            };
        };

        return {
            getRecipeTypes: function (params) {
                params = params || getRecipeTypesParams();
                var d = $q.defer();

                $http({
                    url: scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = RecipeType.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                
                return d.promise;
            },

            getRecipeTypeDetail: function (id) {
              var d = $q.defer();

              $http.get(scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/' + id + '/').success(function (data) {
                  var returnData = RecipeTypeDetail.transformer(data);
                  d.resolve(returnData);
              });
              return d.promise;
            },

            getRecipes: function (params) {
                params = params || getRecipesParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.getUrlPrefix('recipes') + 'recipes/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Recipe.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },

            getRecipeDetails: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.getUrlPrefix('recipes') + 'recipes/' + id + '/').success(function (details) {
                    console.log('getRecipeDetails');
                    console.log(details);
                    var result = RecipeDetails.transformer(details);
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },

            saveRecipeType: function (recipeType) {
                var d = $q.defer();
                var cleanRecipeType = RecipeTypeValidation.transformer(recipeType);

                if (!cleanRecipeType.id) {
                    $http.post(scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/', cleanRecipeType).success(function (result) {
                        d.resolve(result);
                    }).error(function(error){
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/' + cleanRecipeType.id + '/', cleanRecipeType).success(function (result) {
                        recipeType = result;
                        d.resolve(recipeType);
                    }).error(function(error){
                        d.reject(error);
                    });
                }

                return d.promise;
            },

            validateRecipeType: function (recipeType) {
                var d = $q.defer();
                var cleanRecipeType = RecipeTypeValidation.transformer(recipeType);

                $http.post(scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/validation/', cleanRecipeType).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('workspacesController', ['$scope', '$location', '$uibModal', '$routeParams', 'scaleConfig', 'navService', 'workspacesService', 'scaleService', 'stateService', 'userService', 'gridFactory', 'Workspace', 'toastr', function ($scope, $location, $uibModal, $routeParams, scaleConfig, navService, workspacesService, scaleService, stateService, userService, gridFactory, Workspace, toastr) {
        var vm = this,
            currWorkspace = {},
            activeWorkspaces = [],
            inactiveWorkspaces = [];

        vm.loading = true;
        vm.scaleConfig = scaleConfig;
        vm.showActive = stateService.getShowActiveWorkspaces();
        vm.workspaces = [];
        vm.localWorkspaces = [];
        vm.activeWorkspace = {};
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.saveBtnClass = 'btn-default';
        vm.mode = 'view';
        vm.user = userService.getUserCreds();
        vm.readonly = !(vm.user && vm.user.is_admin);
        vm.brokerDescription = '';
        vm.availableWorkspaceTypes = _.cloneDeep(scaleConfig.workspaceTypes);

        vm.cancelCreate = function () {
            vm.mode = 'view';
            // revert any changes to the workspace
            vm.activeWorkspace = Workspace.transformer(_.cloneDeep(currWorkspace));
            if ($routeParams.id === '0') {
                $location.path('/workspaces');
            }
        };

        vm.editWorkspace = function () {
            // store a reference of the workspace as it currently exists in case the user cancels the edit
            currWorkspace = Workspace.transformer(_.cloneDeep(vm.activeWorkspace));
            vm.mode = 'edit';
        };

        vm.saveWorkspace = function () {
            workspacesService.saveWorkspace(vm.activeWorkspace).then(function (workspace) {
                vm.activeWorkspace = Workspace.transformer(workspace);
                if (scaleConfig.static) {
                    localStorage.setItem('workspace' + vm.activeWorkspace.id, JSON.stringify(vm.activeWorkspace));
                }
                vm.mode = 'view';
                getWorkspaces();
            }).catch(function () {
                
            });
        };

        vm.clearLocalWorkspaces = function () {
            _.forEach(vm.localWorkspaces, function (workspace) {
                localStorage.removeItem('workspace' + workspace.id);
            });
            $location.path('/workspaces');
        };
        
        vm.newWorkspace = function () {
            vm.mode = 'add';
            vm.loadWorkspace(0);
        };

        vm.loadWorkspace = function (id) {
            $location.path('workspaces/' + id);
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateWorkspace = function () {
            vm.loading = true;
            workspacesService.validateWorkspace(vm.activeWorkspace).then(function (data) {
                if (data.warnings && data.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(data.warnings);
                    toastr['error'](warningsHtml);
                } else {
                    toastr['success']('Workspace is valid.');
                }
            }).catch(function (error) {
                if (error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error'](error);
                }
            }).finally(function () {
                vm.loading = false;
            });
        };

        $scope.$watch('vm.activeWorkspace.json_config.broker.type', function (newValue) {
            if (newValue === 'nfs') {
                vm.brokerDescription = scaleConfig.nfsBrokerDescription;
            } else if (newValue === 'host') {
                vm.brokerDescription = scaleConfig.hostBrokerDescription;
            } else if (newValue === 's3') {
                vm.brokerDescription = scaleConfig.s3BrokerDescription;
            }
        });

        $scope.$watch('vm.showActive', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.showActive = newValue;
            stateService.setShowActiveWorkspaces(newValue);
            vm.workspaces = vm.showActive ? _.cloneDeep(activeWorkspaces) : _.cloneDeep(inactiveWorkspaces);
        });

        var getWorkspaces = function () {
            vm.loading = true;
            workspacesService.getWorkspaces().then(function (data) {
                if (scaleConfig.static) {
                    var i = 0,
                        oJson = {},
                        sKey;
                    for (; sKey = localStorage.key(i); i++) {
                        oJson[sKey] = localStorage.getItem(sKey);
                    }
                    _.filter(_.pairs(oJson), function (o) {
                        if (_.contains(o[0], 'workspace')) {
                            var type = JSON.parse(o[1]);
                            vm.localWorkspaces.push(type);
                            data.push(type);
                        }
                    });
                }
                activeWorkspaces = _.filter(data, { 'is_active': true });
                inactiveWorkspaces = _.filter(data, { 'is_active': false });
                vm.workspaces = vm.showActive ? _.cloneDeep(activeWorkspaces) : _.cloneDeep(inactiveWorkspaces);
                vm.loading = false;
            }).catch(function (error) {
                vm.loading = false;
                console.log(error);
            });
        };

        var initialize = function () {
            getWorkspaces();
            vm.activeWorkspace = null;
            vm.mode = 'view';

            if ($routeParams.id) {
                var id = parseInt($routeParams.id);
                if (id === 0) {
                    vm.mode = 'add';
                    vm.activeWorkspace = new Workspace();
                } else {
                    // set activeWorkspace = workspace details for id
                    workspacesService.getWorkspaceDetails(id).then(function (data) {
                        vm.activeWorkspace = Workspace.transformer(data);
                    });
                }
            }
            navService.updateLocation('workspaces');
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset + 60;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('Workspace', ['scaleConfig', function (scaleConfig) {
        var Workspace = function (id, name, title, description, base_url, is_active, used_size, total_size, created, archived, last_modified, json_config) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.base_url = base_url;
            this.is_active = is_active;
            this.used_size = used_size;
            this.total_size = total_size;
            this.created = created;
            this.archived = archived;
            this.last_modified = last_modified;
            this.json_config = json_config || _.cloneDeep(scaleConfig.workspaceTypes[0]);
        };

        Workspace.prototype = {
            clean: function () {
                return {
                    name: this.name,
                    title: this.title,
                    description: this.description,
                    base_url: this.base_url,
                    is_active: this.is_active,
                    json_config: this.json_config
                };
            }
        };

        // static methods, assigned to class
        Workspace.build = function (data) {
            if (data) {
                return new Workspace(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.base_url,
                    data.is_active,
                    data.used_size,
                    data.total_size,
                    data.created,
                    data.archived,
                    data.last_modified,
                    data.json_config
                );
            }
            return new Workspace();
        };

        Workspace.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(Workspace.build);
            }
            return Workspace.build(data);
        };

        return Workspace;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('workspacesService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        return {
            getWorkspaces: function () {
                var d = $q.defer();
                var url = scaleConfig.getUrlPrefix('workspaces') + 'workspaces/';

                $http({
                    url: url,
                    method: 'GET',
                    params: { order: '-title' }
                }).success(function (data) {
                    d.resolve(data.results);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getWorkspaceDetails: function (id) {
                var d = $q.defer();
                var url = scaleConfig.getUrlPrefix('workspaces') + 'workspaces/' + id + '/';

                $http({
                    url: url,
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;

            },
            validateWorkspace: function (workspace) {
                var d = $q.defer();
                var cleanWorkspace = workspace.clean();

                $http.post(scaleConfig.getUrlPrefix('workspaces') + 'workspaces/validation/', cleanWorkspace).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            saveWorkspace: function (workspace) {
                var d = $q.defer();

                if (!workspace.id) {
                    $http.post(scaleConfig.getUrlPrefix('workspaces') + 'workspaces/', workspace.clean()).success(function (result) {
                        d.resolve(result);
                    }).error(function (error) {
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.getUrlPrefix('workspaces') + 'workspaces/' + workspace.id + '/', workspace.clean()).success(function (result) {
                        workspace = result;
                        d.resolve(workspace);
                    }).error(function (error) {
                        d.reject(error);
                    });
                }

                return d.promise;
            }
        };
    }]);
})();

/**
 * @author Dimitry Kudrayvtsev
 * @version 2.1
 */

 var updateWindow = function(){
    //  x = w.innerWidth || e.clientWidth || g.clientWidth;
    //  y = w.innerHeight|| e.clientHeight|| g.clientHeight;
     //
    //  svg.attr("width", x).attr("height", y);
    console.log('resize');
 };

 window.onresize = updateWindow;

d3.gantt = function() {
    var FIT_TIME_DOMAIN_MODE = "fit";
    var FIXED_TIME_DOMAIN_MODE = "fixed";

    var margin = {
		top : 20,
		right : 20,
		bottom : 20,
		left : 60
    };
    var timeDomainStart = d3.time.day.offset(new Date(),-3);
    var timeDomainEnd = d3.time.hour.offset(new Date(),+3);
    var timeDomainMode = FIT_TIME_DOMAIN_MODE;// fixed or fit
    var taskTypes = [];
    var taskStatus = [];
    var height = document.body.clientHeight - margin.top - margin.bottom-5;
    var width = document.body.clientWidth - margin.right - margin.left-5;
	var renderTo = "body";
	var begin = '';
	var ended = '';

    var tickFormat = "%H:%M:%S";

    var keyFunction = function(d) {
		return d[begin] + d.taskName + d[ended];
    };

    var rectTransform = function(d) {
		return "translate(" + x(d[begin]) + "," + y(d.taskName) + ")";
    };

    var x = d3.time.scale().domain([ timeDomainStart, timeDomainEnd ]).range([ 0, width ]).clamp(true);

    var y = d3.scale.ordinal().domain(taskTypes).rangeRoundBands([ 0, height - margin.top - margin.bottom ], .1);

    var xAxis = d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(tickFormat)).tickSubdivide(true)
	    .tickSize(8).tickPadding(8);

    var yAxis = d3.svg.axis().scale(y).orient("left").tickSize(0);

    var initTimeDomain = function(tasks) {
	if (timeDomainMode === FIT_TIME_DOMAIN_MODE) {
	    if (tasks === undefined || tasks.length < 1) {
		timeDomainStart = d3.time.day.offset(new Date(), -3);
		timeDomainEnd = d3.time.hour.offset(new Date(), +3);
		return;
	    }
	    tasks.sort(function(a, b) {
		return a[ended] - b[ended];
	    });
	    timeDomainEnd = tasks[tasks.length - 1][ended];
	    tasks.sort(function(a, b) {
		return a[begin] - b[begin];
	    });
	    timeDomainStart = tasks[0][begin];
	}
    };

    var initAxis = function() {
	x = d3.time.scale().domain([ timeDomainStart, timeDomainEnd ]).range([ 0, width ]).clamp(true);
	y = d3.scale.ordinal().domain(taskTypes).rangeRoundBands([ 0, height - margin.top - margin.bottom ], .1);
	xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(Math.ceil(width/150)).tickFormat(d3.time.format(tickFormat)).tickSubdivide(true)
		.tickSize(8).tickPadding(8);

	yAxis = d3.svg.axis().scale(y).orient("left").tickSize(0);
    };

    function gantt(tasks) {

	initTimeDomain(tasks);
	initAxis();

	var svg = d3.select(renderTo)
	.append("svg")
	.attr("class", "chart")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.append("g")
        .attr("class", "gantt-chart")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.attr("transform", "translate(" + margin.left + ", " + margin.top + ")");

      svg.selectAll(".chart")
	 .data(tasks, keyFunction).enter()
	 .append("rect")
	 .attr("rx", 5)
         .attr("ry", 5)
	 .attr("class", function(d){
	     if(taskStatus[d.status] == null){ return "bar";}
	     return taskStatus[d.status];
	     })
	 .attr("y", 0)
	 .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	 .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });


	 svg.append("g")
	 .attr("class", "x axis")
	 .attr("transform", "translate(0, " + (height - margin.top - margin.bottom) + ")")
	 .transition()
	 .call(xAxis);

	 svg.append("g").attr("class", "y axis").transition().call(yAxis);

	 return gantt;

    };

    gantt.redraw = function(tasks) {
        console.log('redraw');
	initTimeDomain(tasks);
	initAxis();

        var svg = d3.select("svg");

        var ganttChartGroup = svg.select(".gantt-chart");
        var rect = ganttChartGroup.selectAll("rect").data(tasks, keyFunction);

        rect.enter()
         .insert("rect",":first-child")
         .attr("rx", 5)
         .attr("ry", 5)
	 .attr("class", function(d){
	     if(taskStatus[d.status] == null){ return "bar";}
	     return taskStatus[d.status];
	     })
	 .transition()
	 .attr("y", 0)
	 .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	  .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });

        rect.transition()
          .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	 .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });

	rect.exit().remove();

	svg.select(".x").transition().call(xAxis);
	svg.select(".y").transition().call(yAxis);

	return gantt;
    };

    gantt.margin = function(value) {
	if (!arguments.length)
	    return margin;
	margin = value;
	return gantt;
    };

    gantt.timeDomain = function(value) {
	if (!arguments.length)
	    return [ timeDomainStart, timeDomainEnd ];
	timeDomainStart = +value[0], timeDomainEnd = +value[1];
	return gantt;
    };

    /**
     * @param {string}
     *                vale The value can be "fit" - the domain fits the data or
     *                "fixed" - fixed domain.
     */
    gantt.timeDomainMode = function(value) {
	if (!arguments.length)
	    return timeDomainMode;
        timeDomainMode = value;
        return gantt;

    };

    gantt.taskTypes = function(value) {
	if (!arguments.length)
	    return taskTypes;
	taskTypes = value;
	return gantt;
    };

    gantt.taskStatus = function(value) {
	if (!arguments.length)
	    return taskStatus;
	taskStatus = value;
	return gantt;
    };

	gantt.begin = function(value){
		if(!arguments.length){
			return begin;
		}
		begin = value;
		return gantt;
	};

	gantt.ended = function(value){
		if(!arguments.length){
			return ended;
		}
		ended = value;
		return gantt;
	};

    gantt.width = function(value) {
	if (!arguments.length)
	    return width;
	width = +value;
	return gantt;
    };

    gantt.height = function(value) {
	if (!arguments.length)
	    return height;
	height = +value;
	return gantt;
    };

    gantt.tickFormat = function(value) {
	if (!arguments.length)
	    return tickFormat;
	tickFormat = value;
	return gantt;
    };

	gantt.renderTo = function(value) {
		if(!arguments.length){
			return renderTo;
		}
		renderTo = value;
		return gantt;
	};



    return gantt;
};

function Gauge(placeholderName, configuration)
{
    this.placeholderName = placeholderName;

    var self = this; // for internal d3 functions

    this.configure = function(configuration)
    {
        this.config = configuration;

        this.config.size = this.config.size * 0.9;

        this.config.raduis = this.config.size * 0.97 / 2;
        this.config.cx = this.config.size / 2;
        this.config.cy = this.config.size / 2;

        this.config.min = undefined != configuration.min ? configuration.min : 0;
        this.config.max = undefined != configuration.max ? configuration.max : 100;
        this.config.range = this.config.max - this.config.min;

        this.config.majorTicks = configuration.majorTicks || 5;
        this.config.minorTicks = configuration.minorTicks || 2;

        this.config.greenColor 	= configuration.greenColor || "#8fca0e";
        this.config.yellowColor = configuration.yellowColor || "#ffc317";
        this.config.redColor 	= configuration.redColor || "#f54d36";

        this.config.transitionDuration = configuration.transitionDuration || 500;
    };

    this.render = function()
    {
        this.body = d3.select("#" + this.placeholderName)
            .append("svg:svg")
            .attr("class", "gauge")
            .attr("width", this.config.size)
            .attr("height", this.config.size);

        this.body.append("svg:circle")
            .attr("class", "outer-circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", this.config.raduis * 0.95)
            .style("fill", "#ccc");
            /*.style("stroke", "#000")
            .style("stroke-width", "0.5px");*/

        this.body.append("svg:circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", 0.9 * this.config.raduis)
            .style("fill", "#fff")
            .style("stroke", "#e0e0e0")
            .style("stroke-width", "2px");

        for (var greenIdx in this.config.greenZones)
        {
            this.drawBand(this.config.greenZones[greenIdx].from, this.config.greenZones[greenIdx].to, self.config.greenColor);
        }

        for (var yellowIdx in this.config.yellowZones)
        {
            this.drawBand(this.config.yellowZones[yellowIdx].from, this.config.yellowZones[yellowIdx].to, self.config.yellowColor);
        }

        for (var redIdx in this.config.redZones)
        {
            this.drawBand(this.config.redZones[redIdx].from, this.config.redZones[redIdx].to, self.config.redColor);
        }

        var fontSize = 0;

        if (undefined != this.config.label)
        {
            fontSize = Math.round(this.config.size / 9);
            this.body.append("svg:text")
                .attr("x", this.config.cx)
                .attr("y", this.config.cy / 2 + fontSize / 2)
                .attr("dy", fontSize / 2)
                .attr("text-anchor", "middle")
                .text(this.config.label)
                .style("font-size", fontSize + "px")
                .style("fill", "#333")
                .style("stroke-width", "0px");
        }

        fontSize = Math.round(this.config.size / 16);
        var majorDelta = this.config.range / (this.config.majorTicks - 1);
        for (var major = this.config.min; major <= this.config.max; major += majorDelta)
        {
            var minorDelta = majorDelta / this.config.minorTicks,
                point1 = 0,
                point2 = 0;
            for (var minor = major + minorDelta; minor < Math.min(major + majorDelta, this.config.max); minor += minorDelta)
            {
                point1 = this.valueToPoint(minor, 0.75);
                point2 = this.valueToPoint(minor, 0.85);

                this.body.append("svg:line")
                    .attr("x1", point1.x)
                    .attr("y1", point1.y)
                    .attr("x2", point2.x)
                    .attr("y2", point2.y)
                    .style("stroke", "#666")
                    .style("stroke-width", "1px");
            }

            point1 = this.valueToPoint(major, 0.7);
            point2 = this.valueToPoint(major, 0.85);

            this.body.append("svg:line")
                .attr("x1", point1.x)
                .attr("y1", point1.y)
                .attr("x2", point2.x)
                .attr("y2", point2.y)
                .style("stroke", "#333")
                .style("stroke-width", "2px");

            if (major == this.config.min || major == this.config.max)
            {
                var point = this.valueToPoint(major, 0.63);

                this.body.append("svg:text")
                    .attr("x", point.x)
                    .attr("y", point.y)
                    .attr("dy", fontSize / 3)
                    .attr("text-anchor", major == this.config.min ? "start" : "end")
                    .text(major)
                    .style("font-size", fontSize + "px")
                    .style("fill", "#333")
                    .style("stroke-width", "0px");
            }
        }

        var pointerContainer = this.body.append("svg:g").attr("class", "pointerContainer");

        var midValue = (this.config.min + this.config.max) / 2;

        var pointerPath = this.buildPointerPath(midValue);

        var pointerLine = d3.svg.line()
            .x(function(d) { return d.x })
            .y(function(d) { return d.y })
            .interpolate("basis");

        pointerContainer.selectAll("path")
            .data([pointerPath])
            .enter()
            .append("svg:path")
            .attr("d", pointerLine)
            .style("fill", "#888");

        pointerContainer.append("svg:circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", 0.12 * this.config.raduis)
            .style("fill", "#888");

        fontSize = Math.round(this.config.size / 10);
        pointerContainer.selectAll("text")
            .data([midValue])
            .enter()
            .append("svg:text")
            .attr("x", this.config.cx)
            .attr("y", this.config.size - this.config.cy / 4 - fontSize)
            .attr("dy", fontSize / 2)
            .attr("text-anchor", "middle")
            .style("font-size", fontSize + "px")
            .style("fill", "#000")
            .style("stroke-width", "0px");

        this.redraw(this.config.min, 0);
    };

    this.buildPointerPath = function(value)
    {
        var delta = this.config.range / 13;

        var head = valueToPoint(value, 0.85);
        var head1 = valueToPoint(value - delta, 0.12);
        var head2 = valueToPoint(value + delta, 0.12);

        var tailValue = value - (this.config.range * (1/(270/360)) / 2);
        var tail = valueToPoint(tailValue, 0.28);
        var tail1 = valueToPoint(tailValue - delta, 0.12);
        var tail2 = valueToPoint(tailValue + delta, 0.12);

        return [head, head1, tail2, tail, tail1, head2, head];

        function valueToPoint(value, factor)
        {
            var point = self.valueToPoint(value, factor);
            point.x -= self.config.cx;
            point.y -= self.config.cy;
            return point;
        }
    };

    this.drawBand = function(start, end, color)
    {
        if (0 >= end - start) return;

        this.body.append("svg:path")
            .style("fill", color)
            .attr("d", d3.svg.arc()
                .startAngle(this.valueToRadians(start))
                .endAngle(this.valueToRadians(end))
                .innerRadius(0.65 * this.config.raduis)
                .outerRadius(0.85 * this.config.raduis))
            .attr("transform", function() { return "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(270)" });
    };

    this.redraw = function(value, transitionDuration)
    {
        var pointerContainer = this.body.select(".pointerContainer");

        pointerContainer.selectAll("text").text(Math.round(value));

        var pointer = pointerContainer.selectAll("path");
        pointer.transition()
            .duration(undefined != transitionDuration ? transitionDuration : this.config.transitionDuration)
            //.delay(0)
            //.ease("linear")
            //.attr("transform", function(d)
            .attrTween("transform", function()
            {
                var pointerValue = value;
                if (value > self.config.max) pointerValue = self.config.max + 0.02*self.config.range;
                else if (value < self.config.min) pointerValue = self.config.min - 0.02*self.config.range;
                var targetRotation = (self.valueToDegrees(pointerValue) - 90);
                var currentRotation = self._currentRotation || targetRotation;
                self._currentRotation = targetRotation;

                return function(step)
                {
                    var rotation = currentRotation + (targetRotation-currentRotation)*step;
                    return "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(" + rotation + ")";
                }
            });

        var outerCircle = this.body.select(".outer-circle")
            .transition()
            .duration(750)
            .style("fill", function () {
                var i = parseInt(value);
                if (i > 0 && i < 75) {
                    return self.config.greenColor;
                } else if (i >= 75 && i < 90) {
                    return self.config.yellowColor;
                } else {
                    return self.config.redColor;
                }
            });
    };

    this.valueToDegrees = function(value)
    {
        // thanks @closealert
        //return value / this.config.range * 270 - 45;
        return value / this.config.range * 270 - (this.config.min / this.config.range * 270 + 45);
    };

    this.valueToRadians = function(value)
    {
        return this.valueToDegrees(value) * Math.PI / 180;
    };

    this.valueToPoint = function(value, factor)
    {
        return { 	x: this.config.cx - this.config.raduis * factor * Math.cos(this.valueToRadians(value)),
            y: this.config.cy - this.config.raduis * factor * Math.sin(this.valueToRadians(value)) 		};
    };

    // initialization
    this.configure(configuration);
}
/*! 
 * angular-hotkeys v1.5.0
 * https://chieffancypants.github.io/angular-hotkeys
 * Copyright (c) 2015 Wes Cruver
 * License: MIT
 */
!function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",["$injector",function(a){this.includeCheatSheet=!0,this.useNgRoute=a.has("ngViewDirective"),this.templateTitle="Keyboard Shortcuts:",this.templateHeader=null,this.templateFooter=null,this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title" ng-if="!header">{{ title }}</h4><div ng-bind-html="header" ng-if="header"></div><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div ng-bind-html="footer" ng-if="footer"></div><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()">×</div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(a,b,c,d,e){function f(a){var b={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓","return":"↩",backspace:"⌫"};a=a.split("+");for(var c=0;c<a.length;c++)"mod"===a[c]&&(d.navigator&&d.navigator.platform.indexOf("Mac")>=0?a[c]="command":a[c]="ctrl"),a[c]=b[a[c]]||a[c];return a.join(" + ")}function g(a,b,c,d,e,f){this.combo=a instanceof Array?a:[a],this.description=b,this.callback=c,this.action=d,this.allowIn=e,this.persistent=f,this._formated=null}function h(){for(var a=o.hotkeys.length;a--;){var b=o.hotkeys[a];b&&!b.persistent&&k(b)}}function i(){o.helpVisible=!o.helpVisible,o.helpVisible?(t=l("esc"),k("esc"),j("esc",t.description,i,null,["INPUT","SELECT","TEXTAREA"])):(k("esc"),t!==!1&&j(t))}function j(a,b,c,d,e,f){var h,i=["INPUT","SELECT","TEXTAREA"],j=Object.prototype.toString.call(a);if("[object Object]"===j&&(b=a.description,c=a.callback,d=a.action,f=a.persistent,e=a.allowIn,a=a.combo),b instanceof Function?(d=c,c=b,b="$$undefined$$"):angular.isUndefined(b)&&(b="$$undefined$$"),void 0===f&&(f=!0),"function"==typeof c){h=c,e instanceof Array||(e=[]);for(var k,l=0;l<e.length;l++)e[l]=e[l].toUpperCase(),k=i.indexOf(e[l]),-1!==k&&i.splice(k,1);c=function(a){var b=!0,c=a.target||a.srcElement,d=c.nodeName.toUpperCase();if((" "+c.className+" ").indexOf(" mousetrap ")>-1)b=!0;else for(var e=0;e<i.length;e++)if(i[e]===d){b=!1;break}b&&n(h.apply(this,arguments))}}"string"==typeof d?Mousetrap.bind(a,n(c),d):Mousetrap.bind(a,n(c));var m=new g(a,b,c,d,e,f);return o.hotkeys.push(m),m}function k(a){var b=a instanceof g?a.combo:a;if(Mousetrap.unbind(b),angular.isArray(b)){for(var c=!0,d=b.length;d--;)c=k(b[d])&&c;return c}var e=o.hotkeys.indexOf(l(b));return e>-1?(o.hotkeys[e].combo.length>1?o.hotkeys[e].combo.splice(o.hotkeys[e].combo.indexOf(b),1):o.hotkeys.splice(e,1),!0):!1}function l(a){if(!a)return o.hotkeys;for(var b,c=0;c<o.hotkeys.length;c++)if(b=o.hotkeys[c],b.combo.indexOf(a)>-1)return b;return!1}function m(a){return a.$id in p||(p[a.$id]=[],a.$on("$destroy",function(){for(var b=p[a.$id].length;b--;)k(p[a.$id].pop())})),{add:function(b){var c;return c=arguments.length>1?j.apply(this,arguments):j(b),p[a.$id].push(c),this}}}function n(a){return function(c,d){if(a instanceof Array){var e=a[0],f=a[1];a=function(a){f.scope.$eval(e)}}b.$apply(function(){a(c,l(d))})}}Mousetrap.prototype.stopCallback=function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:b.contentEditable&&"true"==b.contentEditable},g.prototype.format=function(){if(null===this._formated){for(var a=this.combo[0],b=a.split(/[\s]/),c=0;c<b.length;c++)b[c]=f(b[c]);this._formated=b}return this._formated};var o=b.$new();o.hotkeys=[],o.helpVisible=!1,o.title=this.templateTitle,o.header=this.templateHeader,o.footer=this.templateFooter,o.toggleCheatSheet=i;var p=[];if(this.useNgRoute&&b.$on("$routeChangeSuccess",function(a,b){h(),b&&b.hotkeys&&angular.forEach(b.hotkeys,function(a){var c=a[2];("string"==typeof c||c instanceof String)&&(a[2]=[c,b]),a[5]=!1,j.apply(this,a)})}),this.includeCheatSheet){var q=e[0],r=a[0],s=angular.element(this.template);j(this.cheatSheetHotkey,this.cheatSheetDescription,i),(r===q||r===q.documentElement)&&(r=q.body),angular.element(r).append(c(s)(o))}var t=!1,u={add:j,del:k,get:l,bindTo:m,template:this.template,toggleCheatSheet:i,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,useNgRoute:this.useNgRoute,purgeHotkeys:h,templateTitle:this.templateTitle};return u}]}]).directive("hotkey",["hotkeys",function(a){return{restrict:"A",link:function(b,c,d){var e,f;angular.forEach(b.$eval(d.hotkey),function(b,c){f="string"==typeof d.hotkeyAllowIn?d.hotkeyAllowIn.split(/[\s,]+/):[],e=c,a.add({combo:c,description:d.hotkeyDescription,callback:b,action:d.hotkeyAction,allowIn:f})}),c.bind("$destroy",function(){a.del(e)})}}}]).run(["hotkeys",function(a){}])}(),function(a,b,c){function d(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return r[a.which]?r[a.which]:s[a.which]?s[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a,b){return a.sort().join(",")===b.sort().join(",")}function g(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function h(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)}function i(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)}function j(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function k(){if(!q){q={};for(var a in r)a>95&&112>a||r.hasOwnProperty(a)&&(q[r[a]]=a)}return q}function l(a,b,c){return c||(c=k()[a]?"keydown":"keypress"),"keypress"==c&&b.length&&(c="keydown"),c}function m(a){return"+"===a?["+"]:(a=a.replace(/\+{2}/g,"+plus"),a.split("+"))}function n(a,b){var c,d,e,f=[];for(c=m(a),e=0;e<c.length;++e)d=c[e],u[d]&&(d=u[d]),b&&"keypress"!=b&&t[d]&&(d=t[d],f.push("shift")),j(d)&&f.push(d);return b=l(d,f,b),{key:d,modifiers:f,action:b}}function o(a,c){return a===b?!1:a===c?!0:o(a.parentNode,c)}function p(a){function c(a){a=a||{};var b,c=!1;for(b in u)a[b]?c=!0:u[b]=0;c||(x=!1)}function k(a,b,c,d,e,g){var h,i,k=[],l=c.type;if(!s._callbacks[a])return[];for("keyup"==l&&j(a)&&(b=[a]),h=0;h<s._callbacks[a].length;++h)if(i=s._callbacks[a][h],(d||!i.seq||u[i.seq]==i.level)&&l==i.action&&("keypress"==l&&!c.metaKey&&!c.ctrlKey||f(b,i.modifiers))){var m=!d&&i.combo==e,n=d&&i.seq==d&&i.level==g;(m||n)&&s._callbacks[a].splice(h,1),k.push(i)}return k}function l(a,b,c,d){s.stopCallback(b,b.target||b.srcElement,c,d)||a(b,c)===!1&&(h(b),i(b))}function m(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);if(b)return"keyup"==a.type&&v===b?void(v=!1):void s.handleKey(b,g(a),a)}function o(){clearTimeout(t),t=setTimeout(c,1e3)}function q(a,b,d,f){function g(b){return function(){x=b,++u[a],o()}}function h(b){l(d,b,a),"keyup"!==f&&(v=e(b)),setTimeout(c,10)}u[a]=0;for(var i=0;i<b.length;++i){var j=i+1===b.length,k=j?h:g(f||n(b[i+1]).action);r(b[i],k,f,a,i)}}function r(a,b,c,d,e){s._directMap[a+":"+c]=b,a=a.replace(/\s+/g," ");var f,g=a.split(" ");return g.length>1?void q(a,g,b,c):(f=n(a,c),s._callbacks[f.key]=s._callbacks[f.key]||[],k(f.key,f.modifiers,{type:f.action},d,a,e),void s._callbacks[f.key][d?"unshift":"push"]({callback:b,modifiers:f.modifiers,action:f.action,seq:d,level:e,combo:a}))}var s=this;if(a=a||b,!(s instanceof p))return new p(a);s.target=a,s._callbacks={},s._directMap={};var t,u={},v=!1,w=!1,x=!1;s._handleKey=function(a,b,d){var e,f=k(a,b,d),g={},h=0,i=!1;for(e=0;e<f.length;++e)f[e].seq&&(h=Math.max(h,f[e].level));for(e=0;e<f.length;++e)if(f[e].seq){if(f[e].level!=h)continue;i=!0,g[f[e].seq]=1,l(f[e].callback,d,f[e].combo,f[e].seq)}else i||l(f[e].callback,d,f[e].combo);var m="keypress"==d.type&&w;d.type!=x||j(a)||m||c(g),w=i&&"keydown"==d.type},s._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)r(a[d],b,c)},d(a,"keypress",m),d(a,"keydown",m),d(a,"keyup",m)}for(var q,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},s={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},v=1;20>v;++v)r[111+v]="f"+v;for(v=0;9>=v;++v)r[v+96]=v;p.prototype.bind=function(a,b,c){var d=this;return a=a instanceof Array?a:[a],d._bindMultiple.call(d,a,b,c),d},p.prototype.unbind=function(a,b){var c=this;return c.bind.call(c,a,function(){},b)},p.prototype.trigger=function(a,b){var c=this;return c._directMap[a+":"+b]&&c._directMap[a+":"+b]({},a),c},p.prototype.reset=function(){var a=this;return a._callbacks={},a._directMap={},a},p.prototype.stopCallback=function(a,b){var c=this;return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:o(b,c.target)?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},p.prototype.handleKey=function(){var a=this;return a._handleKey.apply(a,arguments)},p.init=function(){var a=p(b);for(var c in a)"_"!==c.charAt(0)&&(p[c]=function(b){return function(){return a[b].apply(a,arguments)}}(c))},p.init(),a.Mousetrap=p,"undefined"!=typeof module&&module.exports&&(module.exports=p),"function"==typeof define&&define.amd&&define(function(){return p})}(window,document);
if (!String.prototype.includes) {
    String.prototype.includes = function(search, start) {
        'use strict';
        if (typeof start !== 'number') {
            start = 0;
        }

        if (start + search.length > this.length) {
            return false;
        } else {
            return this.indexOf(search, start) !== -1;
        }
    };
}
(function () {
    'use strict';

    angular.module('scaleApp').config(['$provide', function ($provide) {
        $provide.decorator('$httpBackend', angular.mock.e2e.$httpBackendDecorator);
    }]).run(['$httpBackend', '$interval', 'scaleConfig', 'XMLHttpRequest', 'moment', function ($httpBackend, $interval, scaleConfig, XMLHttpRequest, moment) {

        var getSync = function (url) {
            var request = new XMLHttpRequest();
            request.open('GET', url, false);
            request.send(null);
            return [request.status, request.response, {}];
        };

        var getUrlParams = function (url) {
            var obj = {};

            if (url && url.split('?').length > 1) {
                url.split('?')[1].split('&').forEach(function (item) {
                    var s = item.split('='),
                        k = s[0],
                        v = s[1] && decodeURIComponent(s[1]);
                    (k in obj) ? obj[k].push(v) : obj[k] = [v]
                });
            }

            return obj;
        };

        // Ingests Status
        var ingestsStatusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('ingests') + 'ingests/status/', 'i');
        $httpBackend.whenGET(ingestsStatusRegex).respond(function () {
            var strikes = JSON.parse(getSync('test/data/ingestStrikes.json')[1]),
                startDate = moment.utc().subtract(1, 'w').startOf('d').toISOString(),
                endDate = moment.utc().add(1, 'd').startOf('d').toISOString(),
                numHours = moment.utc(endDate).diff(moment.utc(startDate), 'h'),
                thisTime = '',
                values = [],
                results = [];

            _.forEach(strikes.results, function (strike) {
                values = [];

                for (var i = 0; i < numHours; i++) {
                    thisTime = moment.utc(startDate).add(i, 'h').toISOString();
                    values.push({
                        time: thisTime,
                        files: Math.floor(Math.random() * (500 - 5 + 1)) + 5,
                        size: Math.floor(Math.random() * (500000000 - 5000000 + 1)) + 5000000
                    });
                }

                results.push({
                    strike: strike,
                    most_recent: moment.utc().startOf('h').toISOString(),
                    files: 2,
                    size: 123456789,
                    values: values
                });
            });

            var data = {
                count: 2,
                next: null,
                previous: null,
                results: results
            };

            return [200, data, {}];
        });

        // Ingests
        var ingestsOverrideUrl = 'test/data/ingests.json';
        var ingestsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('ingests') + 'ingests/', 'i');
        $httpBackend.whenGET(ingestsRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(ingestsOverrideUrl),
                ingests = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                ingests.results = _.sortByOrder(ingests.results, fields, orders);
            }

            if (urlParams.page && urlParams.page.length > 0) {
                var page = parseInt(urlParams.page[0]),
                    pageSize = parseInt(urlParams.page_size[0]);

                if (page === 1) {
                    ingests.results = _.take(ingests.results, pageSize);
                } else {
                    var startIdx = (page - 1) * pageSize,
                        idxArray = [];

                    for (var i = startIdx; i < ingests.results.length - 1; i++) {
                        idxArray.push(i);
                    }

                    ingests.results = _.at(ingests.results, idxArray);
                }
            }

            if (urlParams.status) {
                ingests.results = _.filter(ingests.results, function (ingest) {
                    return ingest.status === urlParams.status[0];
                });
            }

            if (urlParams.strike_id) {
                ingests.results = _.filter(ingests.results, function (ingest) {
                    return ingest.strike.id === parseInt(urlParams.strike_id[0]);
                });
            }

            returnObj[1] = JSON.stringify(ingests);

            return returnObj;
        });

        // Source details
        var sourceDetailsOverrideUrl = 'test/data/sourceDetails.json';
        var sourceDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('sources') + 'sources/.*/', 'i');
        $httpBackend.whenGET(sourceDetailsRegex).respond(function (method, url) {
            // // get the jobType.id from the url
            // url = url.toString();
            // var filename = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            // sourceDetailsOverrideUrl = 'test/data/source-details/' + filename + '.json';
            return getSync(sourceDetailsOverrideUrl);
        });

        // Sources
        var sourcesOverrideUrl = 'test/data/sources.json';
        var sourcesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('sources') + 'sources/', 'i');
        $httpBackend.whenGET(sourcesRegex).respond(function (method, url) {
            //return getSync(sourcesOverrideUrl);
            var urlParams = getUrlParams(url),
                returnObj = getSync(sourcesOverrideUrl),
                sources = JSON.parse(returnObj[1]);

            if (urlParams.file_name && urlParams.file_name.length > 0) {
                var orders = ['file_name'],
                    fields = ['asc'];

                sources.results = _.filter(sources.results, function (r) {
                    return r.file_name.toLowerCase().includes(urlParams.file_name[0].toLowerCase());
                });

                sources.results = _.sortByOrder(sources.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(sources);

            return returnObj;
        });

        // Job load
        var jobLoadRegex = new RegExp('^' + scaleConfig.getUrlPrefix('load') + 'load/', 'i');
        $httpBackend.whenGET(jobLoadRegex).respond(function () {
            var numHours = moment.utc().endOf('d').diff(moment.utc().subtract(7, 'd').startOf('d'), 'h');
            var startTime = moment.utc().subtract(7, 'd').startOf('d');
            var data = {
                count: numHours,
                next: null,
                previous: null,
                results: []
            };

            for (var i = 0; i < data.count; i++) {
                data.results.push({
                    time: moment.utc(startTime).add(i, 'h').toISOString(),
                    pending_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                    queued_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                    running_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20
                });
            }

            return [200, data, {}];
        });

        // Job details
        var jobDetailsOverrideUrl = 'test/data/jobDetails.json';
        var jobDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'jobs/.*/', 'i');
        $httpBackend.whenGET(jobDetailsRegex).respond(function (method, url) {
            // get the jobType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            jobDetailsOverrideUrl = 'test/data/job-details/jobDetails' + id + '.json';
            return getSync(jobDetailsOverrideUrl);
        });

        // Jobs
        var jobsOverrideUrl = 'test/data/jobs.json';
        var jobsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('jobs') + 'jobs/', 'i');
        $httpBackend.whenGET(jobsRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(jobsOverrideUrl),
                jobs = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    if (field === 'job_type') {
                        field = 'job_type.name';
                    }

                    orders.push(order);
                    fields.push(field);
                });

                jobs.results = _.sortByOrder(jobs.results, fields, orders);
            }

            if (urlParams.status) {
                jobs.results = _.filter(jobs.results, function (job) {
                    return job.status === urlParams.status[0];
                });
            }

            if (urlParams.page) {
                var pagedResults = _.chunk(jobs.results, urlParams.page_size);
                jobs.results = pagedResults[urlParams.page - 1];
            }

            returnObj[1] = JSON.stringify(jobs);

            return returnObj;
        });

        // Job type status
        var jobTypeStatusOverrideUrl = 'test/data/jobTypeStatus.json';
        var jobTypeStatusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-types') + 'job-types/status/', 'i');
        $httpBackend.whenGET(jobTypeStatusRegex).respond(function () {
            return getSync(jobTypeStatusOverrideUrl);
        });

        // Running job types
        var runningJobsOverrideUrl = 'test/data/runningJobs.json';
        var runningJobsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-types') + 'job-types/running/', 'i');
        $httpBackend.whenGET(runningJobsRegex).respond(function () {
            return getSync(runningJobsOverrideUrl);
        });

        // Job Type Details
        var jobTypeDetailsOverrideUrl = 'test/data/job-types/jobType1.json';
        var jobTypeDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-types') + 'job-types/.*/', 'i');
        $httpBackend.whenGET(jobTypeDetailsRegex).respond(function (method, url) {
            // get the jobType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            jobTypeDetailsOverrideUrl = 'test/data/job-types/jobType' + id + '.json';
            return getSync(jobTypeDetailsOverrideUrl);
        });

        // Job types
        var jobTypesOverrideUrl = 'test/data/jobTypes.json';
        var jobTypesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-types') + 'job-types/', 'i');
        $httpBackend.whenGET(jobTypesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(jobTypesOverrideUrl),
                jobTypes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                jobTypes.results = _.sortByOrder(jobTypes.results, fields, orders);
            }

            if (urlParams.name && urlParams.name.length > 0) {
                jobTypes.results = _.filter(jobTypes.results, { name: urlParams.name[0] });
            }

            returnObj[1] = JSON.stringify(jobTypes);

            return returnObj;
        });

        // Job execution logs
        var jobExecutionLogRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-executions') + 'job-executions/.*/logs/combined/', 'i');
        $httpBackend.whenGET(jobExecutionLogRegex).respond(function () {
            var log = {
                hits: {
                    hits: []
                }
            };
            var lines = Math.floor(Math.random() * ((500 - 5) + 1) + 5);
            for (var i = 0; i < lines; i++) {
                var rand = Math.floor(Math.random() * (2 - 1 + 1)) + 1;
                var lineType = rand === 1 ? 'stdout' : 'stderr';
                log.hits.hits.push({
                    _source: {
                        message: 'This is a ' + lineType + ' message',
                        '@timestamp': moment.utc().toISOString(),
                        scale_order_num: i,
                        scale_task: '',
                        scale_job_exe: '',
                        scale_node: 'node' + i,
                        stream: lineType
                    }
                });
            }
            return [200, JSON.stringify(log), {}];
            // return getSync(jobExecutionLogsOverrideUrl);
        });
        // var jobExecutionLogsOverrideUrl = 'test/data/jobExecutionLogCombined.json';

        // Job execution Details
        var jobExecutionDetailsOverrideUrl = 'test/data/jobExecutionDetails.json';
        var jobExecutionDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('job-executions') + 'job-executions/.*/', 'i');
        $httpBackend.whenGET(jobExecutionDetailsRegex).respond(function () {
            return getSync(jobExecutionDetailsOverrideUrl);
        });


        // Metrics Plot Data Detail
        //var metricsPlotDataOverrideUrl = 'test/data/metricsJobTypesPlotData.json';
        var metricsPlotDataRegex = new RegExp('^' + scaleConfig.getUrlPrefix('metrics') + 'metrics/.*/.*/','i');
        $httpBackend.whenGET(metricsPlotDataRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                random = 0;

            var returnObj = {
                count: 28,
                next: null,
                previous: null,
                results: []
            };

            var numDays = moment.utc(urlParams.ended[0]).diff(moment.utc(urlParams.started[0]), 'd') + 1;

            _.forEach(urlParams.column, function (metric) {
                var maxRandom = metric === 'total_count' ? 1000 : 200;
                var minRandom = metric === 'total_count' ? 800 : 10;
                var returnResult = {
                    column: { title: _.startCase(metric) },
                    min_x: moment.utc(urlParams.started[0]).format('YYYY-MM-DD'),
                    max_x: moment.utc(urlParams.ended[0]).format('YYYY-MM-DD'),
                    min_y: 1,
                    max_y: 1000,
                    values: []
                };

                for (var i = 0; i < numDays; i++) {
                    if (urlParams.choice_id && urlParams.choice_id.length > 1) {
                        _.forEach(urlParams.choice_id, function (id) {
                            random = Math.floor(Math.random() * (5 - 1 + 1)) + 1;
                            if (random <= 4) {
                                var value = Math.floor(Math.random() * (maxRandom - minRandom + 1)) + minRandom;
                                returnResult.values.push({
                                    date: moment.utc(urlParams.started[0]).add(i, 'd').format('YYYY-MM-DD'),
                                    value: value,
                                    id: parseInt(id)
                                });
                            }
                        });
                    } else {
                        random = Math.floor(Math.random() * (5 - 1 + 1)) + 1;
                        if (random <= 4) {
                            returnResult.values.push({
                                date: moment.utc(urlParams.started[0]).add(i, 'd').format('YYYY-MM-DD'),
                                value: Math.floor(Math.random() * (maxRandom - minRandom + 1)) + minRandom
                            });
                        }
                    }
                }
                returnObj.results.push(returnResult);
            });

            return [200, returnObj, {}];
        });

        // Metrics Detail
        var metricsDetailRegex = new RegExp('^' + scaleConfig.getUrlPrefix('metrics') + 'metrics/.*/','i');
        $httpBackend.whenGET(metricsDetailRegex).respond(function (method, url) {
            var urlArr = url.split('/'),
                detailType = urlArr[urlArr.length - 2];

            if (detailType === 'job-types') {
                return getSync('test/data/metricsJobTypes.json');
            } else if (detailType === 'error-types') {
                return getSync('test/data/metricsErrorTypes.json');
            }
            return getSync('test/data/metricsIngest.json');
        });

        // Metrics
        var metricsOverrideUrl = 'test/data/metrics.json';
        var metricsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('metrics') + 'metrics/','i');
        $httpBackend.whenGET(metricsRegex).respond(function () {
            return getSync(metricsOverrideUrl);
        });

        // Node details
        var nodeOverrideUrl = 'test/data/node.json';
        var nodeRegex = new RegExp('^' + scaleConfig.getUrlPrefix('nodes') + 'nodes/.*/', 'i');
        $httpBackend.whenGET(nodeRegex).respond(function () {
            return getSync(nodeOverrideUrl);
        });
        $httpBackend.whenPATCH(nodeRegex).respond(function () {
            return getSync(nodeOverrideUrl);
        });

        // Nodes
        var nodesOverrideUrl = 'test/data/nodes.json';
        var nodesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('nodes') + 'nodes/', 'i');
        $httpBackend.whenGET(nodesRegex).respond(function () {
            return getSync(nodesOverrideUrl);
        });

        // Queue Status service
        var queueStatusOverrideUrl = 'test/data/queueStatus.json';
        var queueStatusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('queue') + 'queue/status/', 'i');
        $httpBackend.whenGET(queueStatusRegex).respond(function () {
            return getSync(queueStatusOverrideUrl);
        });

        // Recipe Details
        var recipeDetailsOverrideUrl = 'test/data/recipeDetails.json';
        var recipeDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipes') + 'recipes/.*/', 'i');
        $httpBackend.whenGET(recipeDetailsRegex).respond(function (method, url) {
            // get the recipeDetail.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            recipeDetailsOverrideUrl = 'test/data/recipe-details/recipeDetail' + id + '.json';
            console.log(recipeDetailsOverrideUrl);
            return getSync(recipeDetailsOverrideUrl);
        });

        // Recipes service
        var recipesOverrideUrl = 'test/data/recipes.json';
        var recipesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipes') + 'recipes/', 'i');
        $httpBackend.whenGET(recipesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(recipesOverrideUrl),
                recipes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    if (field === 'recipe_type') {
                        field = 'recipe_type.name';
                    }

                    orders.push(order);
                    fields.push(field);
                });

                recipes.results = _.sortByOrder(recipes.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(recipes);

            return returnObj;
        });

        // Recipe type validation service
        var recipeTypeValidationOverrideUrl = 'test/data/recipeTypeValidationSuccess.json';
        var recipeTypeValidationRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/validation/', 'i');
        $httpBackend.whenPOST(recipeTypeValidationRegex).respond(function () {
            return getSync(recipeTypeValidationOverrideUrl);
        });

        // Recipe Type Details
        var recipeTypeDetailsOverrideUrl = 'test/data/recipe-types/recipeType1.json';
        var recipeTypeDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/.*/', 'i');
        $httpBackend.whenGET(recipeTypeDetailsRegex).respond(function (method, url) {
            // get the recipeType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            recipeTypeDetailsOverrideUrl = 'test/data/recipe-types/recipeType' + id + '.json';
            var returnValue = getSync(recipeTypeDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('recipeType' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });

        // Recipe Types service
        var recipeTypesOverrideUrl = 'test/data/recipeTypes.json';
        var recipeTypesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/', 'i');
        $httpBackend.whenGET(recipeTypesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(recipeTypesOverrideUrl),
                recipeTypes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                recipeTypes.results = _.sortByOrder(recipeTypes.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(recipeTypes);

            return returnObj;
        });

        // Save Recipe Type
        var recipeTypeSaveRegex = new RegExp('^' + scaleConfig.getUrlPrefix('recipe-types') + 'recipe-types/', 'i');
        $httpBackend.whenPOST(recipeTypeSaveRegex).respond(function (method, url, data) {
            var recipeJobTypes = [],
                recipeJobTypesDetails = [],
                jobTypeData = getSync('test/data/jobTypes.json'),
                jobTypes = JSON.parse(jobTypeData[1]).results,
                recipeType = JSON.parse(data),
                uniqueRecipeTypeJobs = _.uniq(recipeType.definition.jobs, 'job_type');
            _.forEach(uniqueRecipeTypeJobs, function (job) {
                recipeJobTypes.push(_.find(jobTypes, function (jobType) {
                    return jobType.name === job.job_type.name && jobType.version === job.job_type.version;
                }));
            });
            _.forEach(recipeJobTypes, function (jobType) {
                var jt = getSync('test/data/job-types/jobType' + jobType.id + '.json');
                recipeJobTypesDetails.push(JSON.parse(jt[1]));
            });
            var returnRecipe = {
                id: Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: recipeType.name,
                version: recipeType.version,
                title: recipeType.title,
                description: recipeType.description,
                is_active: true,
                definition: recipeType.definition,
                revision_num: 1,
                created: new Date().toISOString(),
                last_modified: new Date().toISOString(),
                archived: null,
                trigger_rule: recipeType.trigger_rule,
                job_types: recipeJobTypesDetails
            };
            return [200, JSON.stringify(returnRecipe), {}];
        });

        // Status service
        var statusOverrideUrl = 'test/data/status.json';
        var statusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('status') + 'status/', 'i');
        $httpBackend.whenGET(statusRegex).respond(function () {
            return getSync(statusOverrideUrl);
        });

        // Temp Node Status service
        var tempNodeStatusRegex = new RegExp('^' + scaleConfig.getUrlPrefix('nodeStatus') + 'status/', 'i');
        $httpBackend.whenGET(tempNodeStatusRegex).respond(function () {
            var jobTypeData = getSync('test/data/jobTypes.json'),
                jobTypes = JSON.parse(jobTypeData[1]).results,
                statusJobTypes = [];

            _.forEach(jobTypes, function (type) {
                var rand = Math.floor(Math.random() * (2 - 1 + 1)) + 1;
                if (rand === 1) {
                    statusJobTypes.push({
                        id: type.id,
                        name: type.name,
                        version: type.version,
                        title: type.title,
                        description: type.description,
                        is_system: type.is_system,
                        icon_code: type.icon_code
                    });
                }
            });

            var nodesData = getSync('test/data/nodes.json'),
                nodes = JSON.parse(nodesData[1]).results,
                statusNodes = [];

            var states = [
                {
                    name: 'READY',
                    title: 'Ready',
                    description: 'Node is ready to run new jobs.'
                },
                {
                    name: 'PAUSED',
                    title: 'Paused',
                    description: 'Node is paused.'
                },
                {
                    name: 'WAITING',
                    title: 'Waiting',
                    description: 'Node is waiting.'
                },
                {
                    name: 'BUSY',
                    title: 'Busy',
                    description: 'Node is busy.'
                },
                {
                    name: 'OFFLINE',
                    title: 'Offline',
                    description: 'Node is offline.'
                }
            ];

            var statesRand = Math.floor(Math.random() * (2 - 1 + 1)) + 1;
            var activeStates = statesRand === 1 ? [states[0],states[1],states[4]] : [states[2],states[3],states[4]];

            _.forEach(nodes, function (node) {
                var nodeErrors = [];

                for (var e = 0; e < Math.floor(Math.random() * (10 + 1)); e++) {
                    nodeErrors.push({
                        name: 'my-error',
                        title: 'My Error',
                        description: 'My Error Description',
                        started: moment.utc().toISOString(),
                        last_updated: moment.utc().toISOString()
                    });
                }

                var nodeWarnings = [];

                for (var w = 0; w < Math.floor(Math.random() * (10 + 1)); w++) {
                    nodeWarnings.push({
                        name: 'my-warning',
                        title: 'My Warning',
                        description: 'My Warning Description',
                        started: moment.utc().toISOString(),
                        last_updated: moment.utc().toISOString()
                    });
                }

                var runningJobs = Math.floor(Math.random() * (100 - 5 + 1)) + 5,
                    completedJobs = Math.floor(Math.random() * (200 - 5 + 1)) + 5,
                    failedJobs = Math.floor(Math.random() * (20 - 5 + 1)) + 5;

                var runningJobsBreakdown = [],
                    runningJobsChunk = Math.floor(runningJobs / 3),
                    rjDiff = runningJobs - (runningJobsChunk * 3);

                var maxRj = Math.floor(Math.random() * (12 - 1 + 1)) + 1;
                for (var rj = 0; rj < maxRj; rj++) {
                    runningJobsBreakdown.push({
                        job_type_id: jobTypes[rj].id,
                        count: rj === (maxRj - 1) ? runningJobsChunk + rjDiff : runningJobsChunk
                    });
                }

                var completedJobsBreakdown = [],
                    completedJobsChunk = Math.floor(completedJobs / 2),
                    cjDiff = completedJobs - (completedJobsChunk * 2);

                for (var cj = 0; cj < 2; cj++) {
                    completedJobsBreakdown.push({
                        job_type_id: jobTypes[cj].id,
                        count: cj === (completedJobsChunk - 1) ? completedJobsChunk + cjDiff : completedJobsChunk
                    });
                }

                var failedJobsBreakdown = {
                        data: {
                            total: 0,
                            by_job_type: []
                        },
                        algorithm: {
                            total: 0,
                            by_job_type: []
                        },
                        system: {
                            total: 0,
                            by_job_type: []
                        }
                    },
                    failedJobsChunk = Math.floor(failedJobs / 3),
                    fjDiff = failedJobs - (failedJobsChunk * 3);

                failedJobsBreakdown.data.total = failedJobsChunk;
                failedJobsBreakdown.algorithm.total = failedJobsChunk;
                failedJobsBreakdown.system.total = failedJobsChunk + fjDiff;

                var dataFailChunk = Math.floor(failedJobsBreakdown.data.total / 3),
                    dfDiff = failedJobsBreakdown.data.total - dataFailChunk,
                    algFailChunk = Math.floor(failedJobsBreakdown.algorithm.total / 3),
                    afDiff = failedJobsBreakdown.algorithm.total - algFailChunk,
                    sysFailChunk = Math.floor(failedJobsBreakdown.system.total / 3),
                    sfDiff = failedJobsBreakdown.algorithm.total - sysFailChunk;

                for (var fj = 0; fj < 3; fj++) {
                    failedJobsBreakdown.data.by_job_type.push({
                        job_type_id: jobTypes[fj].id,
                        count: fj === (failedJobsBreakdown.data.total - 1) ? dataFailChunk + dfDiff : dataFailChunk
                    });
                    failedJobsBreakdown.algorithm.by_job_type.push({
                        job_type_id: jobTypes[fj].id,
                        count: fj === (failedJobsBreakdown.algorithm.total - 1) ? algFailChunk + afDiff : algFailChunk
                    });
                    failedJobsBreakdown.system.by_job_type.push({
                        job_type_id: jobTypes[fj].id,
                        count: fj === (failedJobsBreakdown.system.total - 1) ? sysFailChunk + sfDiff : sysFailChunk
                    });
                }

                var rand = Math.floor(Math.random() * (2 - 1 + 1)) + 1;
                statusNodes.push({
                    id: node.id,
                    hostname: node.hostname,
                    agent_id: node.agent_id,
                    is_active: rand === 1,
                    state: rand === 1 ? activeStates[Math.floor(Math.random() * (1 - 0 + 1)) + 0] : activeStates[2],
                    errors: nodeErrors,
                    warnings: nodeWarnings,
                    job_executions: {
                        running: {
                            total: runningJobs,
                            by_job_type: runningJobsBreakdown
                        },
                        completed: {
                            total: completedJobs,
                            by_job_type: completedJobsBreakdown
                        },
                        failed: {
                            total: failedJobs,
                            data: failedJobsBreakdown.data,
                            algorithm: failedJobsBreakdown.algorithm,
                            system: failedJobsBreakdown.system
                        }
                    }

                });
            });

            var status = {
                timestamp: moment.utc().toISOString(),
                job_types: statusJobTypes,
                nodes: statusNodes
            };
            console.log(status);
            return [200, JSON.stringify(status), {}];
        });

        // Version
        var versionOverrideUrl = 'test/data/version.json';
        var versionRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'version/', 'i');
        $httpBackend.whenGET(versionRegex).respond(function () {
            return getSync(versionOverrideUrl);
        });

        // Workspace Details
        var workspaceDetailsOverrideUrl = 'test/data/workspaces/workspace1.json';
        var workspaceDetailsRegex = new RegExp('^' + scaleConfig.getUrlPrefix('workspaces') + 'workspaces/.*/', 'i');
        $httpBackend.whenGET(workspaceDetailsRegex).respond(function (method, url) {
            // get the workspace.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            workspaceDetailsOverrideUrl = 'test/data/workspaces/workspace' + id + '.json';
            var returnValue = getSync(workspaceDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('workspace' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });


        // Workspaces
        var workspacesOverrideUrl = 'test/data/workspaces.json';
        var workspacesRegex = new RegExp('^' + scaleConfig.getUrlPrefix('workspaces') + 'workspaces/', 'i');
        $httpBackend.whenGET(workspacesRegex).respond(function () {
            return getSync(workspacesOverrideUrl);
        });

        // Save Workspace
        var getWorkspaceReturn = function (data, id) {
            var workspace = JSON.parse(data);

            return {
                id: id || Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: workspace.name,
                title: workspace.title,
                description: workspace.description,
                base_url: workspace.base_url,
                is_active: workspace.is_active || false,
                used_size: 0,
                total_size: 0,
                created: new Date().toISOString(),
                archived: null,
                last_modified: new Date().toISOString(),
                json_config: workspace.json_config
            };
        };
        var workspaceCreateRegex = new RegExp('^' + scaleConfig.getUrlPrefix('workspaces') + 'workspaces/', 'i');
        $httpBackend.whenPOST(workspaceCreateRegex).respond(function (method, url, data) {
            var returnWorkspace = getWorkspaceReturn(data);
            return [200, JSON.stringify(returnWorkspace), {}];
        });
        $httpBackend.whenPATCH(workspaceDetailsRegex).respond(function (method, url, data) {
            // get the workspace.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            var returnWorkspace = getWorkspaceReturn(data, id);
            return [200, JSON.stringify(returnWorkspace), {}];
        });

        // Strike Details
        var strikeDetailsOverrideUrl = 'test/data/strikes/strike1.json';
        var strikeDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'strikes/.*/', 'i');
        $httpBackend.whenGET(strikeDetailsRegex).respond(function (method, url) {
            // get the strike.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            strikeDetailsOverrideUrl = 'test/data/strikes/strike' + id + '.json';
            var returnValue = getSync(strikeDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('strike' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });

        // Strikes
        var strikesOverrideUrl = 'test/data/strikes.json';
        var strikesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'strikes/', 'i');
        $httpBackend.whenGET(strikesRegex).respond(function () {
            return getSync(strikesOverrideUrl);
        });

        // Save Strike
        var getStrikeReturn = function (data, id) {
            var strike = JSON.parse(data);

            return {
                id: id || Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: strike.name,
                title: strike.title,
                description: strike.description,
                job: null,
                created: new Date().toISOString(),
                last_modified: new Date().toISOString(),
                configuration: strike.configuration
            };
        };
        var strikeCreateRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'strikes/', 'i');
        $httpBackend.whenPOST(strikeCreateRegex).respond(function (method, url, data) {
            var returnStrike = getStrikeReturn(data);
            return [200, JSON.stringify(returnStrike), {}];
        });
        $httpBackend.whenPATCH(strikeDetailsRegex).respond(function (method, url, data) {
            // get the strike.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            var returnStrike = getStrikeReturn(data, id);
            return [200, JSON.stringify(returnStrike), {}];
        });

        // Scan Details
        var scanDetailsOverrideUrl = 'test/data/scans/scan1.json';
        var scanDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'scans/.*/', 'i');
        $httpBackend.whenGET(scanDetailsRegex).respond(function (method, url) {
            // get the scan.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            scanDetailsOverrideUrl = 'test/data/scans/scan' + id + '.json';
            var returnValue = getSync(scanDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('scan' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });

        // Scans
        var scansOverrideUrl = 'test/data/scans.json';
        var scansRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'scans/', 'i');
        $httpBackend.whenGET(scansRegex).respond(function () {
            return getSync(scansOverrideUrl);
        });

        // Save Scan
        var getScanReturn = function (data, id) {
            var scan = JSON.parse(data);

            return {
                id: id || Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: scan.name,
                title: scan.title,
                description: scan.description,
                file_count: Math.floor(Math.random() * (100 - 1 + 1)) + 1,
                job: null,
                dry_run_job: null,
                created: new Date().toISOString(),
                last_modified: new Date().toISOString(),
                configuration: scan.configuration
            };
        };
        var scanCreateRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'scans/', 'i');
        $httpBackend.whenPOST(scanCreateRegex).respond(function (method, url, data) {
            var returnScan = getScanReturn(data);
            return [200, JSON.stringify(returnScan), {}];
        });
        $httpBackend.whenPATCH(scanDetailsRegex).respond(function (method, url, data) {
            // get the scan.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            var returnScan = getScanReturn(data, id);
            return [200, JSON.stringify(returnScan), {}];
        });

        // Batch
        var batchesOverrideUrl = 'test/data/batch/batches.json';
        var batchesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'batches/', 'i');
        $httpBackend.whenGET(batchesRegex).respond(function() {
            return getSync(batchesOverrideUrl);
        });

        // For everything else, don't mock
        $httpBackend.whenGET(/^\w+.*/).passThrough();
        $httpBackend.whenPOST(/^\w+.*/).passThrough();
    }]);
})();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjYWxlQ29uZmlnLmpzIiwiaGVhZGVyL2hlYWRlckRpcmVjdGl2ZS5qcyIsIm5hdmlnYXRpb24vbmF2RGlyZWN0aXZlLmpzIiwiYWJvdXQvY29udHJvbGxlcnMvYWJvdXRDb250cm9sbGVyLmpzIiwiYWRtaW4vY29udHJvbGxlcnMvYWRtaW5Mb2dpbkNvbnRyb2xsZXIuanMiLCJhZG1pbi9jb250cm9sbGVycy9sb2dvdXRDb250cm9sbGVyLmpzIiwiYmF0Y2gvY29udHJvbGxlcnMvYmF0Y2hEZXRhaWxzQ29udHJvbGxlci5qcyIsImJhdGNoL2NvbnRyb2xsZXJzL2JhdGNoZXNDb250cm9sbGVyLmpzIiwiYmF0Y2gvbW9kZWxzL0JhdGNoLmpzIiwiYmF0Y2gvc2VydmljZXMvYmF0Y2hTZXJ2aWNlLmpzIiwiY2hhcnRzL2RhdGFGZWVkL2RhdGFGZWVkRGlyZWN0aXZlLmpzIiwiY2hhcnRzL2RvbnV0L2RvbnV0Q29udHJvbGxlci5qcyIsImNoYXJ0cy9kb251dC9kb251dERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9yYWRpYWxQZXJjZW50YWdlL3JhZGlhbFBlcmNlbnRhZ2VDb250cm9sbGVyLmpzIiwiY2hhcnRzL3JhZGlhbFBlcmNlbnRhZ2UvcmFkaWFsUGVyY2VudGFnZURpcmVjdGl2ZS5qcyIsImNoYXJ0cy9qb2JMb2FkL2pvYkxvYWRDb250cm9sbGVyLmpzIiwiY2hhcnRzL2pvYkxvYWQvam9iTG9hZERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9ncmlkL2dyaWRDaGFydENvbnRyb2xsZXIuanMiLCJjaGFydHMvZ3JpZC9ncmlkQ2hhcnREaXJlY3RpdmUuanMiLCJjaGFydHMvaGVhbHRoL2hlYWx0aENvbnRyb2xsZXIuanMiLCJjaGFydHMvaGVhbHRoL2hlYWx0aERpcmVjdGl2ZS5qcyIsImNoYXJ0cy90aW1lbGluZS90aW1lbGluZURpcmVjdGl2ZS5qcyIsImNvbW1vbi9kaXJlY3RpdmVzL2Fpc0dyaWRQYWdpbmF0aW9uLmpzIiwiY29tbW9uL2RpcmVjdGl2ZXMvYWlzTXVsdGlzZWxlY3QuanMiLCJjb21tb24vc2VydmljZXMvc2NhbGVTZXJ2aWNlLmpzIiwiY29tbW9uL3NlcnZpY2VzL3NjaGVkdWxlclNlcnZpY2UuanMiLCJjb21tb24vc2VydmljZXMvc3RhdGVTZXJ2aWNlLmpzIiwiY29tbW9uL3NlcnZpY2VzL3N0YXR1c1NlcnZpY2UuanMiLCJjb21tb24vc2VydmljZXMvdXNlclNlcnZpY2UuanMiLCJjb21tb24vZmFjdG9yaWVzL2dhdWdlRmFjdG9yeS5qcyIsImNvbW1vbi9mYWN0b3JpZXMvZ3JpZEZhY3RvcnkuanMiLCJjb21tb24vZmFjdG9yaWVzL3BvbGxlckZhY3RvcnkuanMiLCJjb21tb24vbW9kZWxzL1N0YXR1cy5qcyIsImNvbW1vbi9tb2RlbHMvU3RhdHVzTWFzdGVyLmpzIiwiY29tbW9uL21vZGVscy9TdGF0dXNSZXNvdXJjZS5qcyIsImNvbW1vbi9tb2RlbHMvU3RhdHVzUmVzb3VyY2VzLmpzIiwiY29tbW9uL21vZGVscy9TdGF0dXNTY2hlZHVsZXIuanMiLCJmZWVkL2RpcmVjdGl2ZXMvZmlsZUFuY2VzdHJ5VHJlZURpcmVjdGl2ZS5qcyIsImZlZWQvY29udHJvbGxlcnMvZmVlZERldGFpbHNDb250cm9sbGVyLmpzIiwiZmVlZC9jb250cm9sbGVycy9pbmdlc3RSZWNvcmREZXRhaWxzQ29udHJvbGxlci5qcyIsImZlZWQvY29udHJvbGxlcnMvaW5nZXN0UmVjb3Jkc0NvbnRyb2xsZXIuanMiLCJmZWVkL2NvbnRyb2xsZXJzL3NjYW5EZXRhaWxzQ29udHJvbGxlci5qcyIsImZlZWQvY29udHJvbGxlcnMvc2NhbnNDb250cm9sbGVyLmpzIiwiZmVlZC9jb250cm9sbGVycy9zdHJpa2VzQ29udHJvbGxlci5qcyIsImZlZWQvbW9kZWxzL0ZlZWQuanMiLCJmZWVkL21vZGVscy9GZWVkU3RhdHVzLmpzIiwiZmVlZC9tb2RlbHMvSW5nZXN0LmpzIiwiZmVlZC9tb2RlbHMvU2Nhbi5qcyIsImZlZWQvbW9kZWxzL1NjYW5Db25maWd1cmF0aW9uLmpzIiwiZmVlZC9tb2RlbHMvU2NhbkluZ2VzdEZpbGUuanMiLCJmZWVkL21vZGVscy9TdHJpa2UuanMiLCJmZWVkL21vZGVscy9TdHJpa2VDb25maWd1cmF0aW9uLmpzIiwiZmVlZC9tb2RlbHMvU3RyaWtlSW5nZXN0RmlsZS5qcyIsImZlZWQvc2VydmljZXMvZmVlZFNlcnZpY2UuanMiLCJmZWVkL3NlcnZpY2VzL3NjYW5TZXJ2aWNlLmpzIiwiZmVlZC9zZXJ2aWNlcy9zdHJpa2VTZXJ2aWNlLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JEZXRhaWxDb250cm9sbGVyLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JFeGVjdXRpb25EZXRhaWxDb250cm9sbGVyLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JFeGVjdXRpb25zQ29udHJvbGxlci5qcyIsImpvYnMvY29udHJvbGxlcnMvam9iVHlwZXNDb250cm9sbGVyLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JUeXBlc0ZhaWx1cmVSYXRlc0NvbnRyb2xsZXIuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYnNDb250cm9sbGVyLmpzIiwiam9icy9kaXJlY3RpdmVzL2pvYkV4ZWN1dGlvbkxvZ0RpcmVjdGl2ZS5qcyIsImpvYnMvZGlyZWN0aXZlcy9qb2JIZWFsdGhEaXJlY3RpdmUuanMiLCJqb2JzL2RpcmVjdGl2ZXMvam9iVHlwZUludGVyZmFjZURpcmVjdGl2ZS5qcyIsImpvYnMvbW9kZWxzL0pvYi5qcyIsImpvYnMvbW9kZWxzL0pvYkRldGFpbEV2ZW50LmpzIiwiam9icy9tb2RlbHMvSm9iRGV0YWlsRXZlbnRSdWxlLmpzIiwiam9icy9tb2RlbHMvSm9iRGV0YWlsSW5wdXREYXRhLmpzIiwiam9icy9tb2RlbHMvSm9iRGV0YWlsT3V0cHV0RGF0YS5qcyIsImpvYnMvbW9kZWxzL0pvYkRldGFpbHMuanMiLCJqb2JzL21vZGVscy9Kb2JFeGVjdXRpb24uanMiLCJqb2JzL21vZGVscy9Kb2JFeGVjdXRpb25Mb2cuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZURldGFpbHMuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlRXJyb3IuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlRXJyb3JNYXBwaW5nLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZUlucHV0RGF0YS5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVJbnRlcmZhY2UuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlT3V0cHV0RGF0YS5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVTdGF0dXMuanMiLCJqb2JzL21vZGVscy9Qcm9kdWN0LmpzIiwiam9icy9tb2RlbHMvUnVubmluZ0pvYi5qcyIsImpvYnMvbW9kZWxzL1N5c3RlbUZhaWx1cmUuanMiLCJsb2FkL2NvbnRyb2xsZXJzL2xvYWRDb250cm9sbGVyLmpzIiwibG9hZC9jb250cm9sbGVycy9sb2FkRGVwdGhDb250cm9sbGVyLmpzIiwibG9hZC9jb250cm9sbGVycy9xdWV1ZVJ1bm5pbmdDb250cm9sbGVyLmpzIiwiam9icy9zZXJ2aWNlcy9qb2JFeGVjdXRpb25TZXJ2aWNlLmpzIiwiam9icy9zZXJ2aWNlcy9qb2JTZXJ2aWNlLmpzIiwiam9icy9zZXJ2aWNlcy9qb2JUeXBlU2VydmljZS5qcyIsImxvYWQvbW9kZWxzL1F1ZXVlU3RhdHVzLmpzIiwibG9hZC9zZXJ2aWNlcy9sb2FkU2VydmljZS5qcyIsIm1ldHJpY3Mvc2VydmljZXMvbWV0cmljc1NlcnZpY2UuanMiLCJuYXZpZ2F0aW9uL2NvbnRyb2xsZXJzL25hdkNvbnRyb2xsZXIuanMiLCJtZXRyaWNzL2NvbnRyb2xsZXJzL21ldHJpY3NDb250cm9sbGVyLmpzIiwibmF2aWdhdGlvbi9zZXJ2aWNlcy9uYXZTZXJ2aWNlLmpzIiwibmF2aWdhdGlvbi9zZXJ2aWNlcy9zdWJuYXZTZXJ2aWNlLmpzIiwibm9kZXMvY29udHJvbGxlcnMvbm9kZURldGFpbHNDb250cm9sbGVyLmpzIiwibm9kZXMvY29udHJvbGxlcnMvbm9kZXNDb250cm9sbGVyLmpzIiwibm9kZXMvZGlyZWN0aXZlcy9ub2RlSGVhbHRoRGlyZWN0aXZlLmpzIiwibm9kZXMvZGlyZWN0aXZlcy9ub2RlU3RhdHVzR3JpZENvbnRyb2xsZXIuanMiLCJub2Rlcy9kaXJlY3RpdmVzL25vZGVTdGF0dXNHcmlkRGlyZWN0aXZlLmpzIiwibm9kZXMvbW9kZWxzL05vZGUuanMiLCJub2Rlcy9tb2RlbHMvTm9kZVJlc291cmNlcy5qcyIsIm5vZGVzL3NlcnZpY2VzL25vZGVTZXJ2aWNlLmpzIiwibm9kZXMvc2VydmljZXMvbm9kZVVwZGF0ZVNlcnZpY2UuanMiLCJvdmVydmlldy9jb250cm9sbGVycy9vdkNvbnRyb2xsZXIuanMiLCJyZWNpcGVzL2NvbnRyb2xsZXJzL3JlY2lwZURldGFpbHNDb250cm9sbGVyLmpzIiwicmVjaXBlcy9jb250cm9sbGVycy9yZWNpcGVUeXBlc0NvbnRyb2xsZXIuanMiLCJyZWNpcGVzL2NvbnRyb2xsZXJzL3JlY2lwZXNDb250cm9sbGVyLmpzIiwicmVjaXBlcy9kaXJlY3RpdmVzL3JlY2lwZUdyYXBoVmlld2VyRGlyZWN0aXZlLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlRGF0YS5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZURldGFpbHMuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVKb2IuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVKb2JDb250YWluZXIuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVUeXBlLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlVHlwZURlZmluaXRpb24uanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVUeXBlRGVmaW5pdGlvbkpvYi5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZVR5cGVEZXRhaWwuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVUeXBlVmFsaWRhdGlvbi5qcyIsInJlY2lwZXMvc2VydmljZXMvcmVjaXBlU2VydmljZS5qcyIsIndvcmtzcGFjZXMvY29udHJvbGxlcnMvd29ya3NwYWNlc0NvbnRyb2xsZXIuanMiLCJ3b3Jrc3BhY2VzL21vZGVscy9Xb3Jrc3BhY2UuanMiLCJ3b3Jrc3BhY2VzL3NlcnZpY2VzL3dvcmtzcGFjZXNTZXJ2aWNlLmpzIiwiZ2FudHQtY2hhcnQtZDMuanMiLCJnYXVnZS5qcyIsImhvdGtleXMubWluLmpzIiwiaW5jbHVkZXMuanMiLCJiYWNrZW5kU3R1YnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsSUFBQSxNQUFBLFFBQUEsT0FBQSxZQUFBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTs7O0lBR0EsSUFBQSwyRUFBQSxTQUFBLGdCQUFBLG1CQUFBLFVBQUEsY0FBQTs7O1FBR0EsU0FBQSxVQUFBLG1DQUFBLFVBQUEsV0FBQTtZQUNBLE9BQUEsVUFBQSxXQUFBLE9BQUE7Z0JBQ0EsVUFBQSxXQUFBO2dCQUNBLFdBQUEsV0FBQTtvQkFDQSxNQUFBOzs7Ozs7UUFNQSxhQUFBLFNBQUE7UUFDQSxhQUFBLFFBQUE7OztRQUdBLGtCQUFBLFNBQUEsdUJBQUE7OztRQUdBO2FBQ0EsS0FBQSxLQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsZUFBQTtnQkFDQSxZQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxnQkFBQTtnQkFDQSxZQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxVQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsU0FBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTtnQkFDQSxnQkFBQTs7YUFFQSxLQUFBLGlCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBO2dCQUNBLGdCQUFBOzthQUVBLEtBQUEscUJBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxZQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBO2dCQUNBLGdCQUFBOzthQUVBLEtBQUEsVUFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTtnQkFDQSxnQkFBQTs7YUFFQSxLQUFBLGNBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxnQkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLGlCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsZUFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLFlBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsZ0JBQUE7O2FBRUEsS0FBQSx1QkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLHVCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsU0FBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTtnQkFDQSxnQkFBQTs7YUFFQSxLQUFBLGlCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsb0JBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsZ0JBQUE7O2FBRUEsS0FBQSx1QkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTtnQkFDQSxnQkFBQTs7YUFFQSxLQUFBLG9CQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsd0JBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxvQkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLHNCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxh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QUFBLEtBQUEsV0FBQSxRQUFBLFVBQUE7O1lBRUEsZ0JBQUE7WUFDQSxPQUFBOzs7UUFHQSxHQUFBLGVBQUEsWUFBQTtZQUNBLE9BQUEsT0FBQSxJQUFBLEdBQUEsTUFBQSxXQUFBLFdBQUEsU0FBQSxPQUFBLFlBQUEsWUFBQSxrQkFBQSxlQUFBLE9BQUEsSUFBQSxHQUFBLE1BQUEsV0FBQSxXQUFBLE9BQUEsT0FBQSxZQUFBLFlBQUE7OztRQUdBLEdBQUEsVUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFNBQUEsV0FBQTtnQkFDQSxHQUFBLFlBQUE7b0JBQ0EsTUFBQSxDQUFBLE1BQUEsT0FBQSxJQUFBLEdBQUEsTUFBQSxXQUFBLFdBQUEsT0FBQSxRQUFBLE1BQUEsQ0FBQTtvQkFDQSxRQUFBLENBQUEsTUFBQSxPQUFBLElBQUEsR0FBQSxNQUFBLFdBQUEsV0FBQSxPQUFBLFVBQUEsTUFBQSxDQUFBO29CQUNBLFFBQUEsQ0FBQSxNQUFBLE9BQUEsSUFBQSxHQUFBLE1BQUEsV0FBQSxXQUFBLE9BQUEsVUFBQSxNQUFBLENBQUE7O21CQUVBO2dCQUNBLEdBQUEsVUFBQTtvQkFDQSxNQUFBLENBQUEsTUFBQSxPQUFBLElBQUEsR0FBQSxNQUFBLFdBQUEsV0FBQSxPQUFBLFFBQUEsTUFBQSxDQUFBO29CQUNBLFFBQUEsQ0FBQSxNQUFBLE9BQUEsSUFBQSxHQUFBLE1BQUEsV0FBQSxXQUFBLE9BQUEsVUFBQSxNQUFBLENBQUE7b0JBQ0EsUUFBQSxDQUFBLE1BQUEsT0FBQSxJQUFBLEdBQUEsTUFBQSxXQUFBLFdBQUEsT0FBQSxVQUFBLE1BQUEsQ0FBQTs7Ozs7UUFLQSxHQUFBLGFBQUEsVUFBQSxNQUFBLE1BQUE7WUFDQSxJQUFBLEdBQUEsTUFBQSxXQUFBLFlBQUE7Z0JBQ0EsSUFBQSxHQUFBLE1BQUEsTUFBQSxTQUFBLEdBQUE7b0JBQ0EsR0FBQSxNQUFBLFFBQUEsQ0FBQSxNQUFBLEdBQUEsTUFBQSxNQUFBLE1BQUEsQ0FBQTs7Z0JBRUEsSUFBQSxDQUFBLE1BQUEsR0FBQSxNQUFBLFFBQUE7b0JBQ0EsSUFBQSxHQUFBLE1BQUEsT0FBQSxNQUFBLEdBQUEsTUFBQSxPQUFBLEdBQUE7d0JBQ0EsR0FBQSxNQUFBLE9BQUEsR0FBQSxNQUFBLE9BQUEsS0FBQSxLQUFBOztvQkFFQSxJQUFBLEdBQUEsTUFBQSxTQUFBLE1BQUEsR0FBQSxNQUFBLFNBQUEsR0FBQTt3QkFDQSxHQUFBLE1BQUEsU0FBQSxHQUFBLE1BQUEsU0FBQSxLQUFBLEtBQUE7O29CQUVBLElBQUEsR0FBQSxNQUFBLFNBQUEsTUFBQSxHQUFBLE1BQUEsU0FBQSxHQUFBO3dCQUNBLEdBQUEsTUFBQSxTQUFBLEdBQUEsTUFBQSxTQUFBLEtBQUEsS0FBQTs7b0JBRUEsSUFBQSxVQUFBLFNBQUEsY0FBQSxPQUFBLElBQUEsR0FBQSxNQUFBLFdBQUEsV0FBQSxRQUFBLGlCQUFBLE9BQUEsSUFBQSxHQUFBLE1BQUEsV0FBQSxXQUFBLE1BQUE7b0JBQ0EsUUFBQSxJQUFBO3dCQUNBLFFBQUEsQ0FBQSxNQUFBLEdBQUEsTUFBQSxNQUFBLE1BQUEsQ0FBQTt3QkFDQSxVQUFBLENBQUEsTUFBQSxHQUFBLE1BQUEsUUFBQSxNQUFBLENBQUE7d0JBQ0EsVUFBQSxDQUFBLE1BQUEsR0FBQSxNQUFBLFFBQUEsTUFBQSxDQUFBOztvQkFFQSxJQUFBLFNBQUEsYUFBQTt3QkFDQSxHQUFBLE1BQUEsV0FBQSxXQUFBLFVBQUEsUUFBQTt3QkFDQSxRQUFBLElBQUEsaUJBQUEsR0FBQSxNQUFBLFdBQUEsV0FBQSxRQUFBOzJCQUNBLElBQUEsU0FBQSxXQUFBO3dCQUNBLEdBQUEsTUFBQSxXQUFBLFdBQUEsUUFBQSxRQUFBO3dCQUNBLFFBQUEsSUFBQSxlQUFBLEdBQUEsTUFBQSxXQUFBLFdBQUEsTUFBQTs7Ozs7O1FBTUEsR0FBQSxVQUFBLFVBQUEsUUFBQSxNQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7WUFDQSxJQUFBLFNBQUEsUUFBQTtnQkFDQSxNQUFBO21CQUNBLElBQUEsU0FBQSxZQUFBLFNBQUEsVUFBQTtnQkFDQSxNQUFBOztZQUVBLElBQUEsT0FBQSxZQUFBLElBQUE7O2dCQUVBLElBQUEsTUFBQSxHQUFBLE1BQUEsUUFBQTtvQkFDQSxHQUFBLE1BQUEsUUFBQSxDQUFBLE1BQUEsR0FBQSxNQUFBLENBQUE7O2dCQUVBLEdBQUEsTUFBQSxRQUFBLE1BQUEsR0FBQSxNQUFBLFVBQUEsR0FBQSxNQUFBO2dCQUNBLEdBQUEsTUFBQSxRQUFBLENBQUEsTUFBQSxHQUFBLE1BQUEsT0FBQSxNQUFBLENBQUE7Z0JBQ0EsR0FBQSxXQUFBLE1BQUE7bUJBQ0EsSUFBQSxPQUFBLFlBQUEsSUFBQTs7Z0JBRUEsSUFBQSxNQUFBLEdBQUEsTUFBQSxRQUFBO29CQUNBLEdBQUEsTUFBQSxRQUFBLENBQUEsTUFBQSxHQUFBLE1BQUEsQ0FBQTs7Z0JBRUEsR0FBQSxNQUFBLFFBQUEsSUFBQSxHQUFBLE1BQUEsVUFBQSxHQUFBLE1BQUE7Z0JBQ0EsR0FBQSxNQUFBLFFBQUEsQ0FBQSxNQUFBLEdBQUEsTUFBQSxPQUFBLE1BQUEsQ0FBQTtnQkFDQSxHQUFBLFdBQUEsTUFBQTs7OztRQUlBLEdBQUEsZ0JBQUEsWUFBQTtZQUNBLEdBQUEsVUFBQTtZQUNBLGFBQUEsY0FBQSxHQUFBLE9BQUEsS0FBQSxVQUFBLE1BQUE7Z0JBQ0EsSUFBQSxLQUFBLFlBQUEsS0FBQSxTQUFBLFNBQUEsR0FBQTs7b0JBRUEsSUFBQSxlQUFBLGdCQUFBLEtBQUE7b0JBQ0EsT0FBQSxTQUFBO3VCQUNBO29CQUNBLE9BQUEsV0FBQTs7ZUFFQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxJQUFBLFNBQUEsTUFBQSxRQUFBO29CQUNBLE9BQUEsU0FBQSxNQUFBO3VCQUNBO29CQUNBLE9BQUEsU0FBQTs7ZUFFQSxRQUFBLFlBQUE7Z0JBQ0EsR0FBQSxVQUFBOzs7O1FBSUEsR0FBQSxZQUFBLFlBQUE7WUFDQSxHQUFBLFVBQUE7WUFDQSxhQUFBLFVBQUEsR0FBQSxPQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLE9BQUEsV0FBQTtlQUNBLE1BQUEsVUFBQSxPQUFBO2dCQUNBLElBQUEsU0FBQSxNQUFBLFFBQUE7b0JBQ0Es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ZUFBQSxZQUFBO1FBQ0EsT0FBQTtZQUNBLFlBQUE7WUFDQSxhQUFBO1lBQ0EsVUFBQTtZQUNBLE9BQUE7Z0JBQ0EsTUFBQTs7Ozs7OztBQ3hGQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLDREQUFBLFVBQUEsUUFBQSxVQUFBLGFBQUE7UUFDQSxJQUFBLFVBQUE7WUFDQSxRQUFBOztRQUVBLElBQUEsV0FBQSxZQUFBO1lBQ0EsSUFBQSxPQUFBO2dCQUNBLElBQUEsVUFBQTtvQkFDQSxZQUFBOzs7Z0JBR0EsRUFBQSxRQUFBLE1BQUEsUUFBQSxVQUFBLEdBQUE7b0JBQ0EsUUFBQSxLQUFBLENBQUEsRUFBQSxPQUFBLEdBQUEsSUFBQSxFQUFBLE9BQUEsR0FBQTs7OztnQkFJQSxFQUFBLFFBQUEsU0FBQSxVQUFBLElBQUE7b0JBQ0EsSUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLFVBQUEsSUFBQTt3QkFDQSxPQUFBLEdBQUEsT0FBQSxHQUFBOztvQkFFQSxJQUFBLENBQUEsTUFBQTt3QkFDQSxVQUFBLEtBQUEsR0FBQTs7Ozs7Z0JBS0EsTUFBQSxLQUFBO29CQUNBLFNBQUE7b0JBQ0EsUUFBQTs7bUJBRUE7Z0JBQ0EsUUFBQSxHQUFBLFNBQUE7b0JBQ0EsUUFBQSxTQUFBO29CQUNBLE1BQUE7d0JBQ0EsU0FBQTt3QkFDQSxNQUFBLE9BQUE7d0JBQ0EsUUFBQTs0QkFDQSxNQUFBLFlBQUEsT0FBQTs0QkFDQSxTQUFBLFlBQUEsT0FBQTs0QkFDQSxJQUFBLFlBQUEsT0FBQTs0QkFDQSxXQUFBLFlBQUEsT0FBQTs0QkFDQSxNQUFBOzRCQUNBLE9BQUEsWUFBQSxPQUFBOzRCQUNBLFFBQUEsWUFBQSxPQUFBOzRCQUNBLFdBQUEsWUFBQSxPQUFBOzRCQUNBLE1BQUEsWUFBQSxPQUFBOzRCQUNBLFFBQUEsWUFBQSxPQUFBOzRCQUNBLFNBQUEsWUFBQSxPQUFBOzRCQUNBLHFCQUFBLFlBQUEsT0FBQTs0QkFDQSxRQUFBLFlBQUEsT0FBQTs7O29CQUdBLFlBQUE7d0JBQ0EsVUFBQTs7b0JBRUEsS0FBQTt3QkFDQSxPQUFBOzRCQUNBLFFBQUEsR0FBQSxPQUFBOzs7b0JBR0EsT0FBQTt3QkFDQSxPQUFBOzRCQUNBLFFBQUEsT0FBQSxZQUFBLEdBQUEsT0FBQSxPQUFBLFlBQUE7Z0NBQ0EsT0FBQTs7O3dCQUdBLE9BQUEsT0FBQTt3QkFDQSxPQUFBLE9BQUE7O29CQUVBLFNBQUE7d0JBQ0EsUUFBQTs0QkFDQSxPQUFBLEdBQUEsT0FBQTs7O29CQUdBLE1BQUE7d0JBQ0EsUUFBQSxPQUFBLFFBQUE7Ozs7WUFJQSxTQUFBLEdBQUEsTUFBQSxXQUFBOzs7UUFHQSxJQUFBLGlCQUFBLFdBQUE7WUFDQSxVQUFBO1lBQ0EsT0FBQSxLQUFBLFFBQUEsVUFBQSxJQUFBO2dCQUNBLFFBQUEsS0FBQSxDQUFBLElBQUEsT0FBQSxJQUFBOzs7O1FBSUEsSUFBQSxhQUFBLFlBQUE7WUFDQTtZQUNBOzs7UUFHQSxPQUFBLE9BQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsSUFBQSxLQUFBLFNBQUEsR0FBQTtvQkFDQTt1QkFDQTtvQkFDQSxJQUFBLE9BQUE7d0JBQ0EsTUFBQTt3QkFDQSxRQUFBOzs7Ozs7UUFNQSxPQUFBLFdBQUEsWUFBQTtZQUNBOzs7OztBQzlHQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxVQUFBLFlBQUEsWUFBQTtRQUNBLE9BQUE7WUFDQSxZQUFBO1lBQ0EsVUFBQTtZQUNBLE9BQUE7Z0JBQ0EsTUFBQTtnQkFDQSxNQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxPQUFBO2dCQUNBLE1BQUE7Ozs7OztBQ2JBOztBQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsdUVBQUEsVUFBQSxRQUFBLFVBQUEsYUFBQTtJQUNBLElBQUEsZ0JBQUE7UUFDQSxhQUFBO1FBQ0EsT0FBQTtRQUNBLFdBQUE7UUFDQSxZQUFBOztJQUVBLElBQUEsZ0JBQUEsWUFBQTtRQUNBLElBQUEsUUFBQSxXQUFBLE9BQUE7UUFDQSxJQUFBLFNBQUEsSUFBQTtZQUNBLE9BQUEsWUFBQSxPQUFBO2VBQ0EsSUFBQSxRQUFBLE1BQUEsU0FBQSxJQUFBO1lBQ0EsT0FBQSxZQUFBLE9BQUE7ZUFDQTtZQUNBLE9BQUEsWUFBQSxPQUFBOzs7O0lBSUEsSUFBQSxhQUFBLFlBQUE7O1FBRUEsSUFBQSxhQUFBLE9BQUEsY0FBQTtRQUNBLElBQUEsYUFBQSxHQUFBO1lBQ0EsY0FBQTs7Ozs7UUFLQSxJQUFBLE9BQUEsU0FBQSxHQUFBLFdBQUE7UUFDQSxJQUFBLFNBQUEsR0FBQSxXQUFBLGVBQUEsTUFBQTtZQUNBLE9BQUEsU0FBQSxHQUFBLFdBQUE7OztRQUdBLElBQUEsZ0JBQUEsR0FBQSxPQUFBOztRQUVBLElBQUEsTUFBQSxHQUFBLElBQUE7YUFDQSxXQUFBO2FBQ0EsWUFBQSxPQUFBLE9BQUE7YUFDQSxZQUFBLE9BQUEsT0FBQTs7UUFFQSxJQUFBLE1BQUEsR0FBQSxPQUFBLFNBQUEsSUFBQSxPQUFBLE9BQUEsS0FBQTtZQUNBLE9BQUE7WUFDQSxRQUFBO1dBQ0EsT0FBQSxLQUFBLEtBQUE7WUFDQSxhQUFBLGVBQUEsT0FBQSxJQUFBLE1BQUEsT0FBQSxJQUFBO1lBQ0EsU0FBQTs7O1FBR0EsSUFBQSxRQUFBLElBQUEsT0FBQSxLQUFBLEtBQUE7WUFDQSxhQUFBOztRQUVBLE1BQUEsT0FBQTthQUNBLE1BQUE7Z0JBQ0EsV0FBQSxJQUFBLEtBQUE7O2FBRUEsS0FBQSxTQUFBO2FBQ0EsS0FBQSxLQUFBOztRQUVBLGFBQUEsTUFBQSxPQUFBO2FBQ0EsTUFBQTtnQkFDQSxVQUFBOzthQUVBLEtBQUE7Z0JBQ0EsS0FBQTs7YUFFQSxNQUFBLFFBQUEsWUFBQTtnQkFDQSxPQUFBOzs7UUFHQSxPQUFBLElBQUEsT0FBQTthQUNBLE1BQUE7Z0JBQ0EsWUFBQTs7YUFFQSxLQUFBLGVBQUE7YUFDQSxLQUFBLE1BQUE7OztRQUdBLFlBQUEsVUFBQSxZQUFBLGVBQUE7WUFDQSxXQUFBLFVBQUEsUUFBQSxVQUFBLEdBQUE7Z0JBQ0EsSUFBQSxPQUFBLE1BQUEsYUFBQTtvQkFDQSxJQUFBOztnQkFFQSxJQUFBLElBQUEsR0FBQSxZQUFBLEVBQUEsWUFBQTtnQkFDQSxPQUFBLFVBQUEsR0FBQTtvQkFDQSxFQUFBLGFBQUEsRUFBQTtvQkFDQSxLQUFBLEtBQUEsY0FBQSxFQUFBO29CQUNBLE9BQUE7Ozs7UUFJQSxXQUFBLFVBQUEsWUFBQSxVQUFBO1lBQ0EsV0FBQSxVQUFBLEtBQUEsVUFBQSxHQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBLFlBQUEsRUFBQSxVQUFBO2dCQUNBLE9BQUEsVUFBQSxHQUFBO29CQUNBLEVBQUEsV0FBQSxFQUFBO29CQUNBLE9BQUEsSUFBQTs7Ozs7UUFLQSxnQkFBQTs7UUFFQSxPQUFBOzs7SUFHQSxJQUFBLFNBQUEsVUFBQSxPQUFBO1FBQ0EsSUFBQSxlQUFBO1lBQ0EsSUFBQSxhQUFBO1lBQ0EsSUFBQSxhQUFBLEdBQUE7Z0JBQ0EsY0FBQTs7O1lBR0EsV0FBQSxhQUFBLFNBQUE7aUJBQ0EsTUFBQSxRQUFBLFlBQUE7b0JBQ0EsT0FBQTs7aUJBRUEsS0FBQSxVQUFBLENBQUEsS0FBQSxLQUFBLEtBQUE7WUFDQSxLQUFBLGFBQUEsU0FBQSxNQUFBLEtBQUEsV0FBQTs7OztJQUlBLE9BQUEsT0FBQSxjQUFBLFVBQUEsT0FBQTtRQUNBLElBQUEsU0FBQSxDQUFBLGVBQUE7WUFDQTtlQUNBO1lBQ0EsT0FBQTs7Ozs7QUM5SEE7O0FBRUEsUUFBQSxPQUFBLFlBQUEsVUFBQSx1QkFBQSxZQUFBO0lBQ0EsT0FBQTtRQUNBLFlBQUE7UUFDQSxVQUFBO1FBQ0EsT0FBQTtZQUNBLFlBQUE7Ozs7O0FDUEEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSxpRkFBQSxVQUFBLFFBQUEsYUFBQSxjQUFBLGFBQUE7UUFDQSxJQUFBLEtBQUE7WUFDQSxRQUFBO1lBQ0EsU0FBQTtZQUNBLE9BQUE7O1FBRUEsR0FBQSxjQUFBO1FBQ0EsR0FBQSxpQkFBQTtRQUNBLEdBQUEsa0JBQUEsQ0FBQSxLQUFBLEtBQUE7UUFDQSxHQUFBLGNBQUE7UUFDQSxHQUFBLFlBQUE7UUFDQSxHQUFBLFdBQUE7UUFDQSxHQUFBLGNBQUE7UUFDQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxlQUFBO1FBQ0EsR0FBQSxxQkFBQTtRQUNBLEdBQUEsUUFBQTtRQUNBLEdBQUEsYUFBQTs7UUFFQSxJQUFBLGdCQUFBO1lBQ0EsU0FBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLGFBQUEsR0FBQSxnQkFBQSxRQUFBLEtBQUEsVUFBQSxPQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUEsVUFBQSxhQUFBLE1BQUEsZUFBQSxNQUFBLG1CQUFBLE1BQUEsS0FBQTs7O1FBR0EsR0FBQSxhQUFBLFlBQUE7WUFDQSxHQUFBLGNBQUEsQ0FBQSxHQUFBO1lBQ0EsTUFBQSxLQUFBLE9BQUEsR0FBQTtZQUNBLElBQUEsR0FBQSxhQUFBO2dCQUNBLEdBQUEsWUFBQTtnQkFDQSxHQUFBLFdBQUE7bUJBQ0E7Z0JBQ0EsR0FBQSxZQUFBO2dCQUNBLEdBQUEsV0FBQTs7OztRQUlBLElBQUEsWUFBQSxZQUFBO1lBQ0EsT0FBQTs7WUFFQSxPQUFBLEVBQUEsTUFBQSxHQUFBLFlBQUEsU0FBQTtZQUNBLEVBQUEsUUFBQSxNQUFBLFVBQUEsR0FBQSxHQUFBO2dCQUNBLEtBQUEsS0FBQSxPQUFBLElBQUEsR0FBQTs7WUFFQSxLQUFBLFFBQUE7O1lBRUEsSUFBQSxhQUFBLEVBQUEsTUFBQSxHQUFBLFlBQUEsU0FBQTtnQkFDQSxZQUFBLEVBQUEsTUFBQSxHQUFBLFlBQUEsU0FBQTtnQkFDQSxhQUFBLEVBQUEsTUFBQSxHQUFBLFlBQUEsU0FBQTs7WUFFQSxXQUFBLFFBQUE7WUFDQSxVQUFBLFFBQUE7WUFDQSxXQUFBLFFBQUE7OztZQUdBLFNBQUEsQ0FBQSxNQUFBLFlBQUEsV0FBQTs7WUFFQSxJQUFBLFFBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxTQUFBOztZQUVBLEVBQUEsUUFBQSxRQUFBLFNBQUEsSUFBQTtnQkFDQSxPQUFBO2dCQUNBLElBQUEsSUFBQSxPQUFBLEtBQUE7b0JBQ0EsS0FBQSxJQUFBLE1BQUE7b0JBQ0EsT0FBQSxLQUFBLElB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QTtnQkFDQSxPQUFBLEVBQUEsT0FBQTs7WUFFQSxPQUFBOzs7UUFHQSxJQUFBLGNBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxHQUFBO2dCQUNBLE9BQUEsRUFBQTs7OztRQUlBLElBQUEsa0JBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxJQUFBLEVBQUEsZUFBQSxXQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBOzs7OztRQUtBLElBQUEscUJBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxPQUFBLEVBQUEsT0FBQTs7OztRQUlBLElBQUEsdUJBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxPQUFBLEVBQUEsT0FBQTs7OztRQUlBLElBQUEsZUFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEdBQUE7Z0JBQ0EsT0FBQSxFQUFBOzs7O1FBSUEsSUFBQSxlQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7O1lBRUEsT0FBQTs7O1FBR0EsSUFBQSxlQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7O1lBRUEsT0FBQTs7O1FBR0EsSUFBQSxnQkFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLElBQUEsRUFBQSxlQUFBLFFBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUE7OztZQUdBLE9BQUE7OztRQUdBLElBQUEsY0FBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLElBQUEsRUFBQSxlQUFBLFFBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUE7Ozs7O1FBS0EsSUFBQSxrQkFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLElBQUEsRUFBQSxlQUFBLFdBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUE7Ozs7O1FBS0EsSUFBQSxt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QSxFQUFBLE9BQUEsRUFBQTtpQkFDQSxLQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLGNBQUE7OztZQUdBLGVBQUEsVUFBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsWUFBQTs7O1lBR0EsZUFBQSxVQUFBO2lCQUNBLEtBQUEsVUFBQSxVQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7aUJBQ0EsR0FBQSxTQUFBLFVBQUEsUUFBQTtvQkFDQSxpQkFBQTs7Ozs7WUFLQSxJQUFBLFlBQUEsZUFBQTtpQkFDQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTs7WUFFQSxJQUFBLE9BQUEsVUFBQSxPQUFBO1lBQ0EsSUFBQSxXQUFBLEtBQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsRUFBQTs7aUJBRUEsS0FBQSxTQUFBO2lCQUNBLEtBQUEsTUFBQTtpQkFDQSxLQUFBLE1BQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLEtBQUEsTUFBQTtZQUNBLFNBQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxVQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLFdBQUEsZ0JBQUE7b0JBQ0EsSUFBQSxZQUFBLFNBQUEsU0FBQSxHQUFBO3dCQUNBLElBQUEsU0FBQSxXQUFBLEdBQUE7NEJBQ0EsT0FBQTs7d0JBRUEsT0FBQTs7b0JBRUEsT0FBQTs7aUJBRUEsS0FBQSxjQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLFdBQUEsZ0JBQUE7b0JBQ0EsSUFBQSxZQUFBLFNBQUEsU0FBQSxHQUFBO3dCQUNBLE9BQUEsU0FBQSxPQUFBLFdBQUEsWUFBQSxPQUFBLGlCQUFBLFNBQUEsT0FBQSxTQUFBLFlBQUEsT0FBQSxlQUFBLFlBQUEsT0FBQTs7b0JBRUEsT0FBQSxZQUFBOztZQUVBLFNBQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxVQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLFdBQUEsZ0JBQUE7b0JBQ0EsSUFBQSxZQUFBLFNBQUEsU0FBQSxHQUFBO3dCQUNBLElBQUEsU0FBQSxXQUFBLEdBQUE7NEJBQ0EsT0FBQTsrQkFDQSxJQUFBLFNBQUEsV0FBQSxHQUFBOzRCQUNBLE9BQUE7OztvQkFHQSxPQUFBOztpQkFFQSxLQUFBLGNBQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsV0FBQSxnQkFBQTtvQkFDQSxJQUFBLFlBQUEsU0FBQSxTQUFBLEdBQUE7d0JBQ0EsT0FBQSxTQUFBLE9BQUEsV0FBQSxZQUFBLE9BQUEsaUJBQUEsU0FBQSxPQUFBLFNBQUEsWUFBQSxPQUFBLGVBQUEsWUFBQSxPQUFBOztvQkFFQSxPQUFBLFlBQUE7O1lBRUEsU0FBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsV0FBQSxnQkFBQTtvQkFDQSxJQUFBLFlBQUEsU0FBQSxTQUFBLEdBQUE7d0JBQ0EsSUFBQSxTQUFBLFdBQUEsR0FBQTs0QkFDQSxPQUFBOzs7b0JBR0EsT0FBQTs7aUJBRUEsS0FBQSxjQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLFdBQUEsZ0JBQUE7b0JBQ0EsSUFBQSxZQUFBLFNBQUEsU0FBQSxHQUFBO3dCQUNBLE9BQUEsU0FBQSxPQUFBLFdBQUEsWUFBQSxPQUFBLGlCQUFBLFNBQUEsT0FBQSxTQUFBLFlBQUEsT0FBQSxlQUFBLFlBQUEsT0FBQTs7b0JBRUEsT0FBQSxZQUFBOzs7WUFHQSxVQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLFVBQUE7aUJBQ0EsTUFBQSxRQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLEVBQUEsZUFBQSxRQUFBO3dCQUNBLE9BQUEsWUFBQTs7O2lCQUdBLEtBQUEsUUFBQSxVQUFBLEdBQUE7b0JBQ0EsSUFBQSxFQUFBLGVBQUEsV0FBQTt3QkFDQSxPQUFBLFVBQUEsRUFBQSxPQUFBOzs7aUJBR0EsTUFBQSxVQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLElBQUEsU0FBQTs7aUJBRUE7aUJBQ0EsU0FBQTs7WUFFQSxVQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsWUFBQTs7aUJBRUEsS0FBQSxlQUFBO2lCQUNBLEtBQUEsS0FBQSxZQUFBO2lCQUNBLEtBQUEsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsSUFBQSxFQUFBLGVBQUEsV0FBQTt3QkFDQSxJQUFBLHFCQUFBLEtBQUEsR0FBQTs0QkFDQSxPQUFBLGFBQUE7O3dCQUVBLE9BQUEsQ0FBQSxhQUFBLEtBQUE7O29CQUVBLE9BQUEsYUFBQTs7aUJBRUEsTUFBQSxhQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLEVBQUEsZUFBQSxRQUFBO3dCQUNBLE9BQUEsT0FBQSxRQUFBLElBQUE7O29CQUVBLE9BQUE7O2lCQUVBLE1BQUEsV0FBQSxlQUFBLFVBQUE7O1lBRUEsVUFBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLEVBQUEsZUFBQSxXQUFBO3dCQUNBLE9BQUEscUJBQUE7OztpQkFHQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLGFBQUE7aUJBQ0EsTUFBQSxXQUFBLGVBQUEsVUFBQTs7WUFFQSxVQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsYUFBQTtpQkFDQSxLQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLGdCQUFBOztpQkFFQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBOztZQUVBLElBQUEsU0FBQSxVQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsZUFBQTtpQkFDQSxLQUFBLEtBQUEsWUFBQTtpQkFDQSxLQUFBLEtBQUEsS0FBQSxNQUFBLFlBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsV0FBQSxlQUFBLFNBQUE7O1lBRUEsT0FBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsTUFBQSxhQUFBO2lCQUNBLEtBQUEsTUFBQTtpQkFDQSxNQUFBLGFBQUEsYUFBQSxRQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsYUFBQTs7aUJBRUEsS0FBQTs7WUFFQSxPQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsZUFBQTtpQkFDQSxLQUFBLEtBQUEsWUFBQTtpQkFDQSxLQUFBLEtBQUEsS0FBQSxNQUFBLFlBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsYUFBQSxhQUFBLFFBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxhQUFBOztpQkFFQSxLQUFBOztZQUVBLE9BQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxlQUFBO2lCQUNBLEtBQUEsS0FBQSxZQUFBO2lCQUNBLEtBQUEsS0FBQSxLQUFBLE1BQUEsWUFBQTtpQkFDQSxLQUFBLE1BQUE7aUJBQ0EsTUFBQSxhQUFBLGFBQUEsUUFBQTtpQkFDQSxLQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLGFBQUE7O2lCQUVBLEtBQUE7O1lBRUEsT0FBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsTUFBQSxhQUFBO2lCQUNBLEtBQUEsTUFBQTtpQkFDQSxNQUFBLGFBQUEsYUFBQSxRQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsY0FBQTs7O1lBR0EsT0FBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsTUFBQSxhQUFBO2lCQUNBLEtBQUEsTUFBQTtpQkFDQSxNQUFBLGFBQUEsYUFBQSxRQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsWUFBQTs7aUJBRUEsS0FBQTs7WUFFQSxVQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLFVBQUE7aUJBQ0EsTUFBQSxRQUFBO2lCQUNBLEdBQUEsYUFBQSxZQUFBO29CQUNBLEdBQUEsT0FBQTt5QkFDQSxNQUFBLGdCQUFBOztpQkFFQSxHQUFBLFlBQUEsWUFBQTtvQkFDQSxHQUFBLE9BQUE7eUJBQ0EsTUFBQSxnQkFBQTs7aUJBRUEsR0FBQSxTQUFBLFVBQUEsR0FBQTtvQkFDQSxpQkFBQTs7aUJBRUEsS0FBQTs7WUFFQSxJQUFBLFFBQUEsS0FBQSxVQUFBO2dCQUNBLFVBQUEsT0FBQTtxQkFDQSxLQUFBLFNBQUE7cUJBQ0EsS0FBQSxVQUFBLEdBQUE7d0JBQ0EsT0FBQSxtQkFBQTs7cUJBRUEsS0FBQSxlQUFBO3FCQUNBLEtBQUEsS0FBQSxlQUFBLElBQUE7cUJBQ0EsS0FBQSxLQUFBLGVBQUEsT0FBQSxRQUFBLElBQUE7cUJBQ0EsTUFBQSxXQUFBLGVBQUEsU0FBQTtxQkFDQSxNQUFBLGFBQUEsZUFBQSxPQUFBLFFBQUEsSUFBQSxPQUFBO3FCQUNBLEdBQUEsYUFBQSxZQUFBO3dCQUNBLEdBQUEsT0FBQTs2QkFDQSxNQUFBLFVBQUE7NkJBQ0EsTUFBQSxRQUFBLFlBQUEsT0FBQTs7cUJBRUEsR0FBQSxZQUFBLFlBQUE7d0JBQ0EsR0FBQSxPQUFBOzZCQUNBLE1BQUEsUUFBQTs7Ozs7Ozs7WUFRQSxlQUFBO2lCQUNBLFNBQUE7aUJBQ0EsS0FBQSxhQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLGVBQUEsRUFBQSxTQUFBOzs7WUFHQSxJQUFBLGlCQUFBLFlBQUE7Z0JBQ0EsZUFBQSxVQUFBO3FCQUNBO3FCQUNBLFNBQUE7cUJBQ0EsTUFBQSxVQUFBLFVBQUEsR0FBQTt3QkFDQSxPQUFBLElBQUEsU0FBQTs7cUJBRUEsTUFBQSxRQUFBLFVBQUEsR0FBQTt3QkFDQSxPQUFBLFlBQUE7Ozs7WUFJQSxJQUFBLG9CQUFBLFlBQUE7Z0JBQ0EsZUFBQSxVQUFBO3FCQUNBLEtBQUEsVUFBQSxHQUFBO3dCQUNBLE9BQUEsbUJBQUE7Ozs7WUFJQSxJQUFBLG1CQUFBLFlBQUE7Z0JBQ0EsZUFBQSxVQUFBO3FCQUNBLEtBQUEsVUFBQSxHQUFBO3dCQUNBLE9BQUEsY0FBQTs7Ozs7O1lBTUEsZUFBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0E7aUJBQ0EsU0FBQTtpQkFDQSxLQUFBLGFBQUE7aUJBQ0E7O1lBRUEsU0FBQSxNQUFBLE1BQUEsT0FBQTtnQkFDQSxLQUFBLEtBQUEsWUFBQTtvQkFDQSxJQUFBLE9BQUEsR0FBQSxPQUFBO3dCQUNBLFFBQUEsS0FBQSxPQUFBLE1BQUEsT0FBQTt3QkFDQTt3QkFDQSxPQUFBO3dCQUNBLGFBQUE7d0JBQ0EsYUFBQTt3QkFDQSxJQUFBLEtBQUEsS0FBQTt3QkFDQSxLQUFBLFdBQUEsS0FBQSxLQUFBO3dCQUNBLFFBQUEsS0FBQSxLQUFBLE1BQUEsT0FBQSxTQUFBLEtBQUEsS0FBQSxZQUFBLEdBQUEsS0FBQSxLQUFBLEdBQUEsS0FBQSxNQUFBLEtBQUE7b0JBQ0EsT0FBQSxPQUFBLE1BQUEsT0FBQTt3QkFDQSxJQUFBLFNBQUEsYUFBQTs0QkFDQSxLQUFBLEtBQUE7NEJBQ0EsTUFBQSxLQUFBLEtBQUEsS0FBQTs0QkFDQSxJQUFBLE1BQUEsT0FBQSwyQkFBQSxZQUFBLEtBQUE7Z0NBQ0EsS0FBQTtnQ0FDQSxNQUFBLEtBQUEsS0FBQSxLQUFBO2dDQUNBLE9BQUEsQ0FBQTtnQ0FDQSxRQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsS0FBQSxZQUFBLEdBQUEsS0FBQSxLQUFBLEdBQUEsS0FBQSxNQUFBLEVBQUEsYUFBQSxhQUFBLEtBQUEsTUFBQSxLQUFBOzs7Ozs7OztRQVFBLE9BQUEsT0FBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsRUFBQSxLQUFBLE1BQUEsU0FBQSxHQUFBO2dCQUNBLEVBQUEsZUFBQTtnQkFDQSxXQUFBOzs7O1FBSUEsT0FBQSxJQUFBLGNBQUEsVUFBQSxPQUFBLE1BQUE7WUFDQSxjQUFBOzs7OztBQ255QkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsVUFBQSxnQkFBQSxZQUFBO1FBQ0EsT0FBQTtZQUNBLFlBQUE7WUFDQSxjQUFBO1lBQ0EsYUFBQTtZQUNBLFVBQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsT0FBQTtnQkFDQSxPQUFBO2dCQUNBLFFBQUE7Z0JBQ0EsTUFBQTtnQkFDQSxTQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsVUFBQTs7Ozs7O0FDakJBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsa0NBQUEsVUFBQSxRQUFBO1FBQ0EsSUFBQSxLQUFBO1lBQ0EsY0FBQTs7UUFFQSxJQUFBLGFBQUEsWUFBQTtZQUNBLGNBQUE7WUFDQSxJQUFBLFFBQUEsT0FBQSxTQUFBO1lBQ0EsR0FBQSxZQUFBLE1BQUE7WUFDQSxHQUFBLGFBQUEsS0FBQTs7O1FBR0EsT0FBQSxPQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLElBQUEsRUFBQSxLQUFBLE1BQUEsU0FBQSxHQUFBO29CQUNBLElBQUEsQ0FBQSxhQUFBO3dCQUNBOzs7Ozs7O0FDbEJBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFVBQUEsYUFBQSxZQUFBO1FBQ0EsT0FBQTtZQUNBLFlBQUE7WUFDQSxjQUFBO1lBQ0EsYUFBQTtZQUNBLFVBQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsTUFBQTtnQkFDQSxPQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsTUFBQTs7Ozs7O0FDZEEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSx3RUFBQSxVQUFBLFFBQUEsVUFBQSxhQUFBO1FBQ0EsSUFBQSxLQUFBO1lBQ0EsUUFBQTtZQUNBLFlBQUE7O1FBRUEsU0FBQSxHQUFBLFdBQUEsWUFBQTtZQUNBLFFBQUEsSUFBQTs7O1FBR0EsSUFBQSxhQUFBLFlBQUE7WUFDQSxPQUFBLE9BQUEsU0FBQSxVQUFBLE9BQUE7Z0JBQ0E7Ozs7UUFJQSxJQUFBLGVBQUEsWUFBQTtZQUNBLElBQUEsT0FBQSxTQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUE7Z0JBQ0EsT0FBQSxNQUFBLEtBQUEsVUFBQSxHQUFBLEdBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUEsU0FBQSxFQUFBLE9BQUE7OztnQkFHQSxZQUFBLEVBQUEsT0FBQSxPQUFBLE1BQUEsWUFBQSxPQUFBO2dCQUNBLElBQUEsU0FBQSxVQUFBLFNBQUEsS0FBQTs7Z0JBRUEsSUFBQSxRQUFBLFNBQUEsR0FBQTtnQkFDQSxJQUFBLENBQUEsU0FBQSxVQUFBLEdBQUEsRUFBQSxRQUFBOzs7Z0JBR0EsT0FBQSxNQUFBLEtBQUEsVUFBQSxHQUFBLEdBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUEsV0FBQSxFQUFBLE9BQUE7O2dCQUVBLElBQUEsVUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBO2dCQUNBLElBQUEsVUFBQSxPQUFBLE1BQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxPQUFBO2dCQUNBLElBQUEsV0FBQSxPQUFBLElBQUEsU0FBQSxLQUFBLE9BQUEsSUFBQSxTQUFBO2dCQUNBLElBQUEsU0FBQTtnQkFDQSxJQUFBLFdBQUEsR0FBQTtvQkFDQSxTQUFBOzs7Z0JBR0EsUUFBQSxHQUFBLFFBQUEsU0FBQSxpQkFBQSxVQUFBLFdBQUEsV0FBQSxZQUFBLGtCQUFBLFdBQUEsUUFBQSxNQUFBLE9BQUEsU0FBQSxNQUFBLE9BQUEsT0FBQSxPQUFBLFFBQUEsTUFBQTs7Z0JBRUEsTUFBQSxlQUFBOztnQkFFQSxNQUFBLE9BQUE7Ozs7O1FBS0EsR0FBQSxhQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLE9BQUEsSUFBQSxNQUFBOztpQkFFQTtnQkFDQSxPQUFBOzs7UUFHQTs7UUFFQSxVQUFBLGVBQUEsWUFBQTtRQUNBLE9BQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTtZQUNBLGFBQUE7WUFDQSxVQUFBO1lBQ0EsT0FBQTtnQkFDQSxPQUFBO2dCQUNBLFNBQUE7Z0JBQ0EsT0FBQTs7Ozs7OztBQ3RFQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxVQUFBLHFCQUFBLFlBQUE7UUFDQSxPQUFBO1lBQ0EsYUFBQTtZQUNBLFVBQUE7Ozs7QUNOQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxVQUFBLGtCQUFBLFlBQUE7UUFDQSxPQUFBO1lBQ0EsVUFBQTtZQUNBLFNBQUE7WUFDQSxPQUFBO2dCQUNBLHlCQUFBO2dCQUNBLGlCQUFBO2dCQUNBLFdBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0Esd0JBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsU0FBQTs7WUFFQSxNQUFBLFNBQUEsT0FBQSxTQUFBLFlBQUE7Z0JBQ0EsVUFBQSxFQUFBLFFBQUE7O2dCQUVBLFFBQUEsWUFBQTtvQkFDQSxpQkFBQSxNQUFBO29CQUNBLGdDQUFBO29CQUNBLFdBQUEsTUFBQSxhQUFBO29CQUNBLGlCQUFBLE1BQUEsbUJBQUE7b0JBQ0Esd0JBQUEsTUFBQTtvQkFDQSxpQkFBQSxNQUFBLG1CQUFBO29CQUNBLFVBQUEsVUFBQSxlQUFBLFNBQUE7d0JBQ0EsTUFBQSxPQUFBLFlBQUE7NEJBQ0EsTUFBQSxVQUFBLFFBQUE7Ozs7O2dCQUtBLE1BQUEsaUJBQUEsMkJBQUEsVUFBQSxVQUFBLFVBQUE7b0JBQ0EsSUFBQSxRQUFBLE9BQUEsVUFBQSxXQUFBO3dCQUNBOztvQkFFQSxRQUFBLFlBQUEsZ0JBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDckNBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsK0NBQUEsVUFBQSxJQUFBLE9BQUEsYUFBQTtRQUNBLFNBQUEsYUFBQSxPQUFBLFFBQUE7O1lBRUEsUUFBQSxLQUFBOztZQUVBLElBQUEsY0FBQSxLQUFBLElBQUEsR0FBQSxTQUFBLE1BQUE7WUFDQSxPQUFBLElBQUEsTUFBQSxjQUFBLElBQUEsY0FBQSxJQUFBLEdBQUEsS0FBQSxPQUFBOzs7UUFHQSxPQUFBO1lBQ0EsMEJBQUEsU0FBQSxJQUFBO2dCQUNBLElBQUEsTUFBQSxHQUFBO29CQUNBLElBQUEsTUFBQSxNQUFBO3dCQUNBLE9BQUEsSUFBQSxRQUFBLEtBQUE7O29CQUVBLElBQUEsT0FBQSxRQUFBLE1BQUEsS0FBQSxNQUFBO3dCQUNBLE9BQUEsQ0FBQSxJQUFBLE1BQUEsUUFBQSxLQUFBOztvQkFFQSxPQUFBLENBQUEsSUFBQSxLQUFBLE1BQUEsUUFBQSxLQUFBOztnQkFFQSxPQUFBOztZQUVBLDRCQUFBLFNBQUEsSUFBQSxTQUFBO2dCQUNBLElBQUEsTUFBQSxHQUFBO29CQUNBLElBQUEsTUFBQSxNQUFBO3dCQUNBLE9BQUEsSUFBQSxRQUFBLFlBQUE7O29CQUVBLElBQUEsT0FBQSxRQUFBLE1BQUEsS0FBQSxNQUFBO3dCQUNBLE9BQUEsQ0FBQSxJQUFBLE1BQUEsUUFBQSxZQUFBOztvQkFFQSxJQUFBLE9BQUEsS0FBQSxRQUFBLE1BQUEsS0FBQSxLQUFBLE1BQUE7d0JBQ0EsT0FBQSxDQUFBLElBQUEsS0FBQSxNQUFBLFFBQUEsWUFBQTs7b0JBRUEsSUFBQSxPQUFBLEtBQUEsS0FBQSxRQUFBLE1BQUEsS0FBQSxLQUFBLEtBQUEsTUFBQTt3QkFDQSxPQUFBLENBQUEsSUFBQSxLQUFBLEtBQUEsTUFBQSxRQUFBLFlBQUE7O29CQUVBLE9BQUEsQ0FBQSxJQUFBLEtBQUEsS0FBQSxLQUFBLE1BQUEsUUFBQSxZQUFBOztnQkFFQSxPQUFBOztZQUVBLGlCQUFBLFlBQUE7Z0JBQ0EsSUFBQSxJQUFBO29CQUNBLElBQUE7b0JBQ0EsSUFBQSxFQUFBO29CQUNBLElBQUEsU0FBQTtvQkFDQSxJQUFBLEVBQUEsY0FBQSxFQUFBLGVBQUEsRUFBQTtvQkFDQSxJQUFBLEVBQUEsZUFBQSxFQUFBLGdCQUFBLEVBQUE7O2dCQUVBLE9BQUE7b0JBQ0EsT0FBQTtvQkFDQSxRQUFBOzs7WUFHQSxtQkFBQSxVQUFBLE9BQUEsTUFBQSxXQUFBO2dCQUNBLElBQUEsS0FBQSxPQUFBLElBQUE7b0JBQ0EsT0FBQSxPQUFBLElBQUE7b0JBQ0EsT0FBQSxPQUFBLElBQUEsSUFBQSxLQUFBLE9BQUEsSUFBQTtvQkFDQSxjQUFBOztnQkFFQSxJQUFBLFdBQUEsT0FBQSxTQUFBOztnQkFFQSxJQUFBLENBQUEsV0FBQTtvQkFDQSxjQUFBLFNBQUEsVUFBQSxJQUFBLGNBQUEsWUFBQSxTQUFBLFNBQUEsS0FBQSxRQUFBO29CQUNBLGNBQUEsU0FBQSxXQUFBLElBQUEsY0FBQSxZQUFBLFNBQUEsVUFBQSxLQUFBLFFBQUE7b0JBQ0EsY0FBQSxTQUFBLFNBQUEsSUFBQSxjQUFBLFlBQUEsU0FBQSxRQUFBLEtBQUEsUUFBQTtvQkFDQSxjQUFBLFNBQUEsVUFBQSxJQUFBLGNBQUEsWUFBQSxTQUFBLFNBQUEsS0FBQSxRQUFBO29CQUNBLGNBQUEsU0FBQSxZQUFBLElBQUEsY0FBQSxZQUFBLFNBQUEsV0FBQSxLQUFBLFFBQUE7b0JBQ0EsY0FBQSxjQUFBLFlBQUEsU0FBQSxXQUFBLEtBQUE7dUJBQ0E7b0JBQ0EsY0FBQSxTQUFBLFVBQUEsSUFBQSxjQUFBLFNBQUEsVUFBQSxRQUFBO29CQUNBLGNBQUEsU0FBQSxXQUFBLElBQUEsY0FBQSxTQUFBLFdBQUEsUUFBQTtvQkFDQSxjQUFBLFNBQUEsU0FBQSxJQUFBLGNBQUEsU0FBQSxTQUFBLFFBQUE7b0JBQ0EsY0FBQSxTQUFBLFVBQUEsSUFBQSxjQUFBLFNBQUEsVUFBQSxRQUFBO29CQUNBLGNBQUEsU0FBQSxZQUFBLElBQUEsY0FBQSxTQUFBLFlBQUEsUUFBQTtvQkFDQSxjQUFBLGNBQUEsU0FBQSxZQUFBOzs7Z0JBR0EsT0FBQTs7WUFFQSxjQUFBLFNBQUEsVUFBQTtnQkFDQSxJQUFBLFNBQUEsQ0FBQSxTQUFBLFNBQUEsVUFBQSxZQUFBLFdBQUEsU0FBQTtnQkFDQSxPQUFBLE9BQUE7O1lBRUEsTUFBQSxZQUFBO2dCQUNBLElBQUEsS0FBQSxPQUFBLFVBQUE7b0JBQ0EsUUFBQSxHQUFBLFFBQUE7b0JBQ0EsUUFBQSxHQUFBLFFBQUE7O2dCQUVBLElBQUEsQ0FBQSxRQUFBLENBQUEsT0FBQSxRQUFBLENBQUEsSUFBQTtvQkFDQSxPQUFBOztnQkFFQSxPQUFBOztZQUVBLGtCQUFBLFNBQUEsVUFBQTtnQkFDQSxJQUFBLFdBQUEsa0JBQUEsWUFBQTtnQkFDQSxHQUFBLFVBQUE7b0JBQ0EsSUFBQSxLQUFBLEVBQUEsS0FBQSxZQUFBLFlBQUEsQ0FBQSxVQUFBO29CQUNBLEdBQUEsR0FBQTt3QkFDQSxXQUFBLGtCQUFBLEdBQUEsT0FBQTs7O2dCQUdBLE9BQUE7O1lBRUEsWUFBQSxZQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUEsWUFBQSxLQUFBLFlBQUE7b0JBQ0EsUUFBQTttQkFDQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOzs7Z0JBR0EsT0FBQSxFQUFBOztZQUVBLGVBQUEsVUFBQSxRQUFBOztnQkFFQSxTQUFBLFVBQUEsWUFBQTs7Z0JBRUEsSUFBQSxXQUFBLEtBQUE7b0JBQ0EsZ0JBQUEsU0FBQSxTQUFBOztnQkFFQSxPQUFBLGFBQUEsZ0JBQUEscUJBQUEsZ0JBQUE7Ozs7OztBQy9IQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLG1EQUFBLFVBQUEsT0FBQSxJQUFBLGFBQUE7UUFDQSxJQUFBLHlCQUFBLFVBQUEsV0FBQTtZQUNBLE9BQUE7Z0JBQ0EsV0FBQTs7OztRQUlBLE9BQUE7WUFDQSxpQkFBQSxVQUFBLE1BQUE7Z0JBQ0EsT0FBQSxRQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUEsWUFBQSxhQUFBLGVBQUE7b0JBQ0EsUUFBQTtvQkFDQSxNQUFBO21CQUNBLFFBQUEsVUFBQSxRQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLEVBQUE7Ozs7OztBQ3pCQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLDhCQUFBLFVBQUEsV0FBQTtRQUNBLElBQUEsVUFBQTtZQUNBLGNBQUE7WUFDQSxhQUFBO1lBQ0Esc0JBQUE7WUFDQSxpQkFBQTtZQUNBLGlCQUFBO1lBQ0EsNkJBQUE7WUFDQSxnQkFBQTtZQUNBLGlCQUFBO1lBQ0EsZ0JBQUE7WUFDQSxlQUFBO1lBQ0EsY0FBQTtZQUNBLGVBQUE7WUFDQSxpQkFBQTtZQUNBLGdCQUFBO1lBQ0EsdUJBQUE7WUFDQSxjQUFBO1lBQ0EsVUFBQTtZQUNBLHdCQUFBOztRQUVBLElBQUEsb0JBQUEsVUFBQSxNQUFBLGlCQUFBO1lBQ0Esa0JBQUEsbUJBQUE7WUFDQSxJQUFBLENBQUEsaUJBQUE7O2dCQUVBLEtBQUEsT0FBQSxLQUFBLFFBQUE7Z0JBQ0EsS0FBQSxZQUFBLEtBQUEsYUFBQTtnQkFDQSxLQUFBLFVBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsUUFBQSxLQUFBLFNBQUE7Z0JBQ0EsS0FBQSxRQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQTtnQkFDQSxLQUFBLFNBQUEsS0FBQSxVQUFBOzs7WUFHQSxFQUFBLFFBQUEsRUFBQSxNQUFBLE9BQUEsVUFBQSxPQUFBO2dCQUNBLFVBQUEsT0FBQSxNQUFBLElBQUEsTUFBQTs7OztRQUlBLElBQUEsaUJBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxLQUFBLFVBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxTQUFBLFFBQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQSxNQUFBLE1BQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQSxDQUFBO2dCQUNBLFFBQUEsS0FBQSxTQUFBLEtBQUEsU0FBQTtnQkFDQSxnQkFBQSxLQUFBLGlCQUFBLEtBQUEsaUJBQUE7Z0JBQ0EsYUFBQSxLQUFBLGNBQUEsU0FBQSxLQUFBLGVBQUE7Z0JBQ0EsZUFBQSxLQUFBLGdCQUFBLEtBQUEsZ0JBQUE7Z0JBQ0EsbUJBQUEsS0FBQSxvQkFBQSxLQUFBLG9CQUFBO2dCQUNBLEtBQUE7Ozs7UUFJQSxJQUFBLDBCQUFBLFVBQUEsTUFBQTtZQUNBLE9BQUE7Z0JBQ0EsTUFBQSxLQUFBLE9BQUEsU0FBQSxLQUFBLFFBQUE7Z0JBQ0EsV0FBQSxLQUFBLFlBQUEsU0FBQSxLQUFBLGFBQUE7Z0JBQ0EsU0FBQSxLQUFBLFVBQUEsS0FBQSxVQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsU0FBQSxRQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsS0FBQSxRQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsTUFBQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFFBQUEsQ0FBQSxLQUFBLFNBQUEsQ0FBQTtnQkFDQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFNBQUE7Z0JBQ0EsYUFBQSxLQUFBLGNBQUEsU0FBQSxLQUFBLGVBQUE7Z0JBQ0EsZUFBQSxLQUFBLGdCQUFBLEtBQUEsZ0JBQUE7Z0JBQ0EsbUJBQUEsS0FBQSxvQkFBQSxLQUFBLG9CQUFBO2dCQUNBLFNBQUEsS0FBQSxVQUFBLEtBQUEsVUFBQTs7OztRQUlBLElBQUEscUJBQUEsVUFBQSxLQUFBO1lBQ0EsT0FBQTtnQkFDQSxTQUFBLE9BQUEsS0FBQSxZQUFBLGNBQUEsS0FBQSxVQUFBOzs7O1FBSUEsSUFBQSxpQ0FBQSxVQUFBLE1BQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsTUFBQSxLQUFBLE9BQUEsS0FBQSxPQUFBO2dCQUNBLFNBQUEsS0FBQSxVQUFBLEtBQUEsVUFBQTtnQkFDQSxVQUFBO2dCQUNBLE9BQUEsS0FBQSxRQUFBLEtBQUEsUUFBQTtnQkFDQSxZQUFBLEtBQUEsYUFBQSxLQUFBLGFBQUE7Z0JBQ0EsZ0JBQUEsS0FBQSxpQkFBQSxLQUFBLGlCQUFBOzs7O1FBSUEsSUFBQSxvQkFBQSxVQUFBLE1BQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxRQUFBO2dCQUNBLFdBQUEsS0FBQSxZQUFBLFNBQUEsS0FBQSxhQUFBO2dCQUNBLFNBQUEsS0FBQSxVQUFBLEtBQUEsVUFBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLFNBQUEsUUFBQSxLQUFBO2dCQUNBLE9BQUEsS0FBQSxRQUFBLEtBQUEsUUFBQSxPQUFBLE1BQUEsTUFBQSxLQUFBO2dCQUNBLE9BQUEsS0FBQSxRQUFBLE1BQUEsUUFBQSxLQUFBLFNBQUEsS0FBQSxRQUFBLENBQUEsS0FBQSxTQUFBLENBQUE7Z0JBQ0EsU0FBQSxLQUFBLFVBQUEsU0FBQSxLQUFBLFdBQUE7Z0JBQ0EsV0FBQSxLQUFBLFlBQUEsS0FBQSxZQUFBO2dCQUNBLEtBQUE7Ozs7UUFJQSxJQUFBLG9CQUFBLFVBQUEsTUFBQTtZQUNBLE9BQUE7Z0JBQ0EsTUFBQSxLQUFBLE9BQUEsU0FBQSxLQUFBLFFBQUE7Z0JBQ0EsV0FBQSxLQUFBLFlBQUEsU0FBQSxLQUFBLGFBQUE7Z0JBQ0EsU0FBQSxLQUFBLFVBQUEsS0FBQSxVQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsU0FBQSxRQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsS0FBQSxRQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsTUFBQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFFBQUEsQ0FBQSxLQUFBLFNBQUEsQ0FBQTtnQkFDQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFNBQUE7Z0JBQ0EsV0FBQSxLQUFBLFlBQUEsS0FBQSxZQUFBO2dCQUNBLFdBQUEsS0FBQSxZQUFBLFNBQUEsS0FBQSxhQUFBOzs7O1FBSUEsSUFBQSxrQkFBQSxVQUFBLE1BQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxRQUFBO2dCQUNBLFdBQUEsS0FBQSxZQUFBLFNBQUEsS0FBQSxhQUFBO2dCQUNBLFNBQUEsS0FBQSxVQUFBLEtBQUEsVUFBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLFNBQUEsUUFBQSxLQUFBO2dCQUNBLE9BQUEsS0FBQSxRQUFBLEtBQUEsUUFBQSxPQUFBLE1BQUEsTUFBQSxLQUFBO2dCQUNBLE1BQUEsS0FBQSxPQUFBLEtBQUEsT0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQSxDQUFBOzs7O1FBSUEsSUFBQSxrQkFBQSxVQUFBLE1BQUE7WUFDQSxPQUFBOzs7Z0JBR0EsT0FBQSxLQUFBLFFBQUEsTUFBQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFFBQUEsQ0FBQSxLQUFBLFNBQUEsQ0FBQTtnQkFDQSxRQUFBLEtBQUEsVUFBQTtnQkFDQSxPQUFBLEtBQUEsU0FBQTs7Ozs7UUFLQSxJQUFBLG9CQUFBLFVBQUEsTUFBQTtZQUNBLE9BQUE7Z0JBQ0EsTUFBQSxLQUFBLE9BQUEsU0FBQSxLQUFBLFFBQUE7Z0JBQ0EsV0FBQSxLQUFBLFlBQUEsU0FBQSxLQUFBLGFBQUE7Z0JBQ0EsU0FBQSxLQUFBLFVBQUEsS0FBQSxVQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsU0FBQSxRQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsS0FBQSxRQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsTUFBQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFFBQUEsQ0FBQSxLQUFBLFNBQUEsQ0FBQTtnQkFDQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFNBQUE7Z0JBQ0EsZ0JBQUEsS0FBQSxpQkFBQSxTQUFBLEtBQUEsa0JBQUE7Z0JBQ0EsYUFBQSxLQUFBLGNBQUEsU0FBQSxLQUFBLGVBQUE7Z0JBQ0EsS0FBQTs7OztRQUlBLE9BQUE7WUFDQSxZQUFBLFlBQUE7Z0JBQ0EsT0FBQTs7WUFFQSxZQUFBLFVBQUEsTUFBQTtnQkFDQSxVQUFBOztZQUVBLGdCQUFBLFlBQUE7Z0JBQ0EsT0FBQTs7WUFFQSxnQkFBQSxVQUFBLE1B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QUFBO1FBQ0EsSUFBQSxRQUFBLFVBQUEsaUJBQUE7UUFDQTtZQUNBLEtBQUEsa0JBQUE7O1lBRUEsSUFBQSxPQUFBOztZQUVBLEtBQUEsWUFBQSxTQUFBO1lBQ0E7Z0JBQ0EsS0FBQSxTQUFBOztnQkFFQSxLQUFBLE9BQUEsT0FBQSxLQUFBLE9BQUEsT0FBQTs7Z0JBRUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBLE9BQUEsT0FBQTtnQkFDQSxLQUFBLE9BQUEsS0FBQSxLQUFBLE9BQUEsT0FBQTtnQkFDQSxLQUFBLE9BQUEsS0FBQSxLQUFBLE9BQUEsT0FBQTs7Z0JBRUEsS0FBQSxPQUFBLE1BQUEsYUFBQSxjQUFBLE1BQUEsY0FBQSxNQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsY0FBQSxNQUFBLGNBQUEsTUFBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxLQUFBLE9BQUEsTUFBQSxLQUFBLE9BQUE7O2dCQUVBLEtBQUEsT0FBQSxhQUFBLGNBQUEsY0FBQTtnQkFDQSxLQUFBLE9BQUEsYUFBQSxjQUFBLGNBQUE7O2dCQUVBLEtBQUEsT0FBQSxjQUFBLGNBQUEsY0FBQTtnQkFDQSxLQUFBLE9BQUEsY0FBQSxjQUFBLGVBQUE7Z0JBQ0EsS0FBQSxPQUFBLFlBQUEsY0FBQSxZQUFBO2dCQUNBLEtBQUEsT0FBQSxjQUFBLGNBQUEsYUFBQTs7Z0JBRUEsS0FBQSxPQUFBLHFCQUFBLGNBQUEsc0JBQUE7OztZQUdBLEtBQUEsU0FBQTtZQUNBO2dCQUNBLEtBQUEsT0FBQSxHQUFBLE9BQUEsTUFBQSxLQUFBO3FCQUNBLE9BQUE7cUJBQ0EsS0FBQSxTQUFBO3FCQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxVQUFBLEtBQUEsT0FBQTs7Z0JBRUEsS0FBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxTQUFBO3FCQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLE1BQUEsUUFBQTs7OztnQkFJQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBO3FCQUNBLE1BQUEsUUFBQTtxQkFDQSxNQUFBLFVBQUE7cUJBQ0EsTUFBQSxnQkFBQTs7Z0JBRUEsS0FBQSxJQUFBLFlBQUEsS0FBQSxPQUFBO2dCQUNBO29CQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUEsV0FBQSxVQUFBLE1BQUEsS0FBQSxPQUFBLFdBQUEsVUFBQSxJQUFBLEtBQUEsT0FBQTs7O2dCQUdBLEtBQUEsSUFBQSxhQUFBLEtBQUEsT0FBQTtnQkFDQTtvQkFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBLFlBQUEsV0FBQSxNQUFBLEtBQUEsT0FBQSxZQUFBLFdBQUEsSUFBQSxLQUFBLE9BQUE7OztnQkFHQSxLQUFBLElBQUEsVUFBQSxLQUFBLE9BQUE7Z0JBQ0E7b0JBQ0EsS0FBQSxTQUFBLEtBQUEsT0FBQSxTQUFBLFFBQUEsTUFBQSxLQUFBLE9BQUEsU0FBQSxRQUFBLElBQUEsS0FBQSxPQUFBOzs7Z0JBR0EsSUFBQSxXQUFBOztnQkFFQSxJQUFBLGFBQUEsS0FBQSxPQUFBO2dCQUNBO29CQUNBLFdBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBO29CQUNBLEtBQUEsS0FBQSxPQUFBO3lCQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUE7eUJBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQSxLQUFBLElBQUEsV0FBQTt5QkFDQSxLQUFBLE1BQUEsV0FBQTt5QkFDQSxLQUFBLGVBQUE7eUJBQ0EsS0FBQSxLQUFBLE9BQUE7eUJBQ0EsTUFBQSxhQUFBLFdBQUE7eUJBQ0EsTUFBQSxRQUFBO3lCQUNBLE1BQUEsZ0JBQUE7OztnQkFHQSxXQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUEsT0FBQTtnQkFDQSxJQUFBLGFBQUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBLGFBQUE7Z0JBQ0EsS0FBQSxJQUFBLFFBQUEsS0FBQSxPQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUEsS0FBQSxTQUFBO2dCQUNBO29CQUNBLElBQUEsYUFBQSxhQUFBLEtBQUEsT0FBQTt3QkFDQSxTQUFBO3dCQUNBLFNBQUE7b0JBQ0EsS0FBQSxJQUFBLFFBQUEsUUFBQSxZQUFBLFFBQUEsS0FBQSxJQUFBLFFBQUEsWUFBQSxLQUFBLE9BQUEsTUFBQSxTQUFBO29CQUNBO3dCQUNBLFNBQUEsS0FBQSxhQUFBLE9BQUE7d0JBQ0EsU0FBQSxLQUFBLGFBQUEsT0FBQTs7d0JBRUEsS0FBQSxLQUFBLE9BQUE7NkJBQ0EsS0FBQSxNQUFBLE9BQUE7NkJBQ0EsS0FBQSxNQUFBLE9BQUE7NkJBQ0EsS0FBQSxNQUFBLE9BQUE7NkJBQ0EsS0FBQSxNQUFBLE9BQUE7NkJBQ0EsTUFBQSxVQUFBOzZCQUNBLE1BQUEsZ0JBQUE7OztvQkFHQSxTQUFBLEtBQUEsYUFBQSxPQUFBO29CQUNBLFNBQUEsS0FBQSxhQUFBLE9BQUE7O29CQUVBLEtBQUEsS0FBQSxPQUFBO3lCQUNBLEtBQUEsTUFBQSxPQUFBO3lCQUNBLEtBQUEsTUFBQSxPQUFBO3lCQUNBLEtBQUEsTUFBQSxPQUFBO3lCQUNBLEtBQUEsTUFBQSxPQUFBO3lCQUNBLE1BQUEsVUFBQTt5QkFDQSxNQUFBLGdCQUFBOztvQkFFQSxJQUFBLFNBQUEsS0FBQSxPQUFBLE9BQUEsU0FBQSxLQUFBLE9BQUE7b0JBQ0E7d0JBQ0EsSUFBQSxRQUFBLEtBQUEsYUFBQSxPQUFBOzt3QkFFQSxLQUFBLEtBQUEsT0FBQTs2QkFDQSxLQUFBLEtBQUEsTUFBQTs2QkFDQSxLQUFBLEtBQUEsTUFBQTs2QkFDQSxLQUFBLE1BQUEsV0FBQTs2QkFDQSxLQUFBLGVBQUEsU0FBQSxLQUFBLE9BQUEsTUFBQSxVQUFBOzZCQUNBLEtBQUE7NkJBQ0EsTUFBQSxhQUFBLFdBQUE7NkJBQ0EsTUFBQSxRQUFBOzZCQUNBLE1BQUEsZ0JBQUE7Ozs7Z0JBSUEsSUFBQSxtQkFBQSxLQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsU0FBQTs7Z0JBRUEsSUFBQSxXQUFBLENBQUEsS0FBQSxPQUFBLE1BQUEsS0FBQSxPQUFBLE9BQUE7O2dCQUVBLElBQUEsY0FBQSxLQUFBLGlCQUFBOztnQkFFQSxJQUFBLGNBQUEsR0FBQSxJQUFBO3FCQUNBLEVBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO3FCQUNBLEVBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO3FCQUNBLFlBQUE7O2dCQUVBLGlCQUFBLFVBQUE7cUJBQ0EsS0FBQSxDQUFBO3FCQUNBO3FCQUNBLE9BQUE7cUJBQ0EsS0FBQSxLQUFBO3FCQUNBLE1BQUEsUUFBQTs7Z0JBRUEsaUJBQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxLQUFBLE9BQUEsS0FBQSxPQUFBO3FCQUNBLE1BQUEsUUFBQTs7Z0JBRUEsV0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBLE9BQUE7Z0JBQ0EsaUJBQUEsVUFBQTtxQkFDQSxLQUFBLENBQUE7cUJBQ0E7cUJBQ0EsT0FBQTtxQkFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUEsT0FBQSxLQUFBLE9BQUEsS0FBQSxJQUFBO3FCQUNBLEtBQUEsTUFBQSxXQUFBO3FCQUNBLEtBQUEsZUFBQTtxQkFDQSxNQUFBLGFBQUEsV0FBQTtxQkFDQSxNQUFBLFFBQUE7cUJBQ0EsTUFBQSxnQkFBQTs7Z0JBRUEsS0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBOzs7WUFHQSxLQUFBLG1CQUFBLFNBQUE7WUFDQTtnQkFDQSxJQUFBLFFBQUEsS0FBQSxPQUFBLFFBQUE7O2dCQUVBLElBQUEsT0FBQSxhQUFBLE9BQUE7Z0JBQ0EsSUFBQSxRQUFBLGFBQUEsUUFBQSxPQUFBO2dCQUNBLElBQUEsUUFBQSxhQUFBLFFBQUEsT0FBQTs7Z0JBRUEsSUFBQSxZQUFBLFNBQUEsS0FBQSxPQUFBLFNBQUEsR0FBQSxJQUFBLFFBQUE7Z0JBQ0EsSUFBQSxPQUFBLGFBQUEsV0FBQTtnQkFDQSxJQUFBLFFBQUEsYUFBQSxZQUFB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QUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBO2VBQ0EsUUFBQSxZQUFBO2dCQUNBLEdBQUEsVUFBQTs7OztRQUlBLElBQUEsYUFBQSxZQUFBO1lBQ0EsV0FBQSxlQUFBO1lBQ0EsY0FBQSxlQUFBO1lBQ0E7OztRQUdBLEdBQUEsb0JBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQSxhQUFBLDJCQUFBOzs7UUFHQTs7O0FDakNBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsc01BQUEsVUFBQSxRQUFBLFdBQUEsVUFBQSxhQUFBLGNBQUEsY0FBQSxhQUFBLGVBQUEsWUFBQSxlQUFBLGFBQUEsUUFBQTtRQUNBLGNBQUEsZUFBQTs7UUFFQSxJQUFBLEtBQUE7O1FBRUEsR0FBQSxnQkFBQSxhQUFBOztRQUVBLEdBQUEsZUFBQTtRQUNBLEdBQUEsVUFBQTtRQUNBLEdBQUEsY0FBQSxZQUFBLFlBQUE7UUFDQSxHQUFBLHFCQUFBLFlBQUE7UUFDQSxHQUFBLHVCQUFBLEdBQUEsY0FBQSxVQUFBLEdBQUEsbUJBQUE7UUFDQSxHQUFBLG9CQUFBLE9BQUEsSUFBQSxHQUFBLGNBQUEsU0FBQTtRQUNBLEdBQUEseUJBQUE7WUFDQSxRQUFBOztRQUVBLEdBQUEsNkJBQUEsVUFBQSxRQUFBO1lBQ0EsT0FBQTtZQUNBLEdBQUEsdUJBQUEsU0FBQTs7UUFFQSxHQUFBLG1CQUFBLE9BQUEsSUFBQSxHQUFBLGNBQUEsT0FBQTtRQUNBLEdBQUEsd0JBQUE7WUFDQSxRQUFBOztRQUVBLEdBQUEsNEJBQUEsVUFBQSxRQUFBO1lBQ0EsT0FBQTtZQUNBLEdBQUEsc0JBQUEsU0FBQTs7UUFFQSxHQUFBLG1CQUFBO1lBQ0EsVUFBQTs7UUFFQSxHQUFBLGFBQUE7UUFDQSxHQUFBLGFBQUE7UUFDQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxhQUFBLEdBQUEsY0FBQSxhQUFBO1FBQ0EsR0FBQSxjQUFBLFlBQUE7UUFDQSxHQUFBLFlBQUEsT0FBQTs7UUFFQSxTQUFBLFlBQUE7WUFDQSxHQUFBLFlB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QUVBLEVBQUEsT0FBQSxFQUFBLE1BQUEsUUFBQSxVQUFBLEdBQUE7d0JBQ0EsSUFBQSxFQUFBLFNBQUEsRUFBQSxJQUFBLFdBQUE7NEJBQ0EsSUFBQSxPQUFBLEtBQUEsTUFBQSxFQUFBOzRCQUNBLEdBQUEsYUFBQSxLQUFBOzRCQUNBLEtBQUEsS0FBQTs7OztnQkFJQSxHQUFBLFVBQUE7Z0JBQ0E7ZUFDQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7Z0JBQ0EsR0FBQSxVQUFBOzs7O1FBSUEsSUFBQSxhQUFBLFlBQUE7WUFDQTtZQUNBLEdBQUEsZUFBQTtZQUNBLEdBQUEsT0FBQTs7WUFFQSxJQUFBLGFBQUEsSUFBQTtnQkFDQSxJQUFBLEtBQUEsU0FBQSxhQUFBO2dCQUNBLElBQUEsT0FBQSxHQUFBO29CQUNBLEdBQUEsT0FBQTtvQkFDQSxHQUFBLGVBQUEsSUFBQTt1QkFDQTtvQkFDQSxjQUFBLGlCQUFBLElBQUEsS0FBQSxVQUFBLE1BQUE7d0JBQ0EsR0FBQSxlQUFBLE9BQUEsWUFBQTs7OztZQUlBLFdBQUEsZUFBQTtZQUNBLGNBQUEsZUFBQTs7O1FBR0E7O1FBRUEsUUFBQSxRQUFBLFVBQUEsTUFBQSxZQUFBOztZQUVBLElBQUEsV0FBQSxhQUFBO2dCQUNBLFNBQUEsWUFBQTtnQkFDQSxxQkFBQSxTQUFBLFNBQUEsU0FBQTs7WUFFQSxHQUFBLGlCQUFBLGFBQUEscUJBQUEscUJBQUEscUJBQUE7Ozs7O0FDblBBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsd0JBQUEsVUFBQSxhQUFBO1FBQ0EsSUFBQSxPQUFBLFVBQUEsT0FBQSxRQUFBO1lBQ0EsS0FBQSxRQUFBO1lBQ0EsS0FBQSxTQUFBOzs7O1FBSUEsS0FBQSxZQUFBO1lBQ0EsVUFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEsYUFBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQTs7WUFFQSxjQUFBLFlBQUE7Z0JBQ0EsT0FBQTs7Ozs7UUFLQSxLQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFB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QSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxvREFBQSxVQUFBLGFBQUEsS0FBQSxtQkFBQTtRQUNBLElBQUEsT0FBQSxVQUFBLElBQUEsTUFBQSxPQUFBLGFBQUEsWUFBQSxLQUFBLGFBQUEsU0FBQSxlQUFBLGVBQUE7WUFDQSxLQUFBLEtBQUE7WUFDQSxLQUFBLE9BQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLGFBQUE7WUFDQSxLQUFBLE1BQUEsSUFBQSxZQUFBO1lBQ0EsS0FBQSxjQUFBLElBQUEsWUFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsb0JBQUEsT0FBQSxJQUFBLFNBQUEsT0FBQSxZQUFBLFlBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSwwQkFBQSxPQUFBLElBQUEsZUFBQSxPQUFBLFlBQUEsWUFBQTtZQUNBLEtBQUEsZ0JBQUEsa0JBQUEsWUFBQTs7O1FBR0EsS0FBQSxZQUFBO1lBQ0EsT0FBQSxZQUFBO2dCQUNBLElBQUEsWUFBQTtvQkFDQSxNQUFBLEtBQUE7b0JBQ0EsT0FBQSxLQUFBO29CQUNBLGFBQUEsS0FBQTtvQkFDQSxlQUFBLEtBQUE7O2dCQUVBLElBQUEsVUFBQSxpQkFBQSxVQUFBLGNBQUEsUUFBQSxTQUFBLE1BQUE7b0JBQ0EsT0FBQSxVQUFBLGNBQUEsUUFBQTs7Z0JBRUEsSUFBQSxVQUFBLGNBQUEsaUJBQUE7b0JBQ0EsRUFBQSxRQUFBLFVBQUEsY0FBQSxpQkFBQSxVQUFBLEdBQUE7d0JBQ0EsT0FBQSxFQUFBOzs7O2dCQUlBLE9BQUEsRUFBQSxLQUFBLFdBQUEsRUFBQTs7Ozs7UUFLQSxLQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLEtBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUEsS0FBQSxJQUFBLEtBQUE7O1lBRUEsT0FBQSxLQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUNsRUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSx1REFBQSxVQUFBLGFBQUEsZ0JBQUE7UUFDQSxJQUFBLG9CQUFBLFVBQUEsU0FBQSxXQUFBLFNBQUEsaUJBQUE7WUFDQSxLQUFBLFVBQUEsWUFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsVUFBQSxVQUFBLFVBQUE7Z0JBQ0EsTUFBQTtnQkFDQSxpQkFBQTs7WUFFQSxLQUFBLGtCQUFBLGtCQUFBLGVBQUEsWUFBQSxtQkFBQTs7O1FBR0Esa0JBQUEsWUFBQTs7Ozs7UUFLQSxrQkFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxrQkFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQSxLQUFBLElBQUEsa0JBQUE7O1lBRUEsT0FBQSxrQkFBQSxNQUFBOzs7UUFHQSxPQUFBOzs7O0FDdENBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsa0JBQUEsWUFBQTtRQUNBLElBQUEsaUJBQUEsVUFBQSxnQkFBQSxZQUFBLGVBQUEsZUFBQTtZQUNBLEtBQUEsaUJBQUE7WUFDQSxLQUFBLGFBQUEsY0FBQTtZQUNBLEtBQUEsZ0JBQUEsaUJBQUE7WUFDQSxLQUFBLGdCQUFBLGlCQUFBOzs7UUFHQSxlQUFBLFlBQUE7Ozs7O1FBS0EsZUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxJQUFBLFlBQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOztnQkFFQSxJQUFBLEtBQUEsY0FBQSxLQUFBLFdBQUEsV0FBQSxHQUFBO29CQUNBLE9BQUEsVUFBQTs7O2dCQUdBLE9BQUEsRUFBQSxLQUFBLFdBQUEsRUFBQTs7WUFFQSxPQUFBLElBQUE7OztRQUdBLGVBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUEsS0FBQSxJQUFBLGVBQUE7O1lBRUEsT0FBQSxlQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUN4Q0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSx3REFBQSxVQUFBLGFBQUEsS0FBQSxxQkFBQTtRQUNBLElBQUEsU0FBQSxVQUFBLElBQUEsTUFBQSxPQUFBLGFBQUEsS0FBQSxTQUFBLGVBQUEsZUFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsT0FBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsTUFBQSxJQUFBLFlBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLG9CQUFBLE9BQUEsSUFBQSxTQUFBLE9BQUEsWUFBQSxZQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsMEJBQUEsT0FBQSxJQUFBLGVBQUEsT0FBQSxZQUFBLFlBQUE7WUFDQSxLQUFBLGdCQUFBLG9CQUFBLFlBQUE7OztRQUdBLE9BQUEsWUFBQTtZQUNBLE9BQUEsWUFBQTtnQkFDQSxPQUFBO29CQUNBLE1BQUEsS0FBQTtvQkFDQSxPQUFBLEtBQUE7b0JBQ0EsYUFBQSxLQUFBO29CQUNBLGVBQUEsS0FBQTs7Ozs7O1FBTUEsT0FBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLE9BQUEsY0FBQSxVQUFBLE1B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Q0EsSUFBQSxNQUFBLFlBQUEsS0FBQSxZQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUE7b0JBQ0EsUUFBQTtvQkFDQSxRQUFBO21CQUNBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7O2dCQUVBLE9BQUEsRUFBQTs7WUFFQSxnQkFBQSxVQUFBLElBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsSUFBQSxNQUFBLFlBQUEsS0FBQSxZQUFBLFdBQUEsS0FBQTs7Z0JBRUEsTUFBQTtvQkFDQSxLQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOzs7WUFHQSxjQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLFlBQUEsS0FBQTs7Z0JBRUEsTUFBQSxLQUFBLFlBQUEsS0FBQSxZQUFBLHFCQUFBLFdBQUEsUUFBQSxVQUFBLFFBQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsU0FBQSxNQUFBO29CQUNBLEVBQUEsT0FBQTs7O2dCQUdBLE9BQUEsRUFBQTs7WUFFQSxVQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsSUFBQSxDQUFBLEtBQUEsSUFBQTtvQkFDQSxNQUFBLEtBQUEsWUFBQSxLQUFBLFlBQUEsVUFBQSxNQUFBLFFBQUEsVUFBQSxRQUFBO3dCQUNBLEVBQUEsUUFBQTt1QkFDQSxNQUFBLFVBQUEsT0FBQTt3QkFDQSxFQUFBLE9BQUE7O3VCQUVBO29CQUNBLE1BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxXQUFBLEtBQUEsS0FBQSxLQUFBLE1BQUEsUUFBQSxVQUFBLFFBQUE7d0JBQ0EsT0FBQTt3QkFDQSxFQUFBLFFBQUE7dUJBQ0EsTUFBQSxVQUFBLE9BQUE7d0JBQ0EsRUFBQSxPQUFBOzs7O2dCQUlBLE9BQUEsRUFBQTs7Ozs7O0FDakVBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsNkRBQUEsVUFBQSxPQUFBLElBQUEsV0FBQSxhQUFBO1FBQ0EsT0FBQTtZQUNBLFlBQUEsWUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUE7O2dCQUVBLE1BQUE7b0JBQ0EsS0FBQTtvQkFDQSxRQUFBO29CQUNBLFFBQUEsRUFBQSxPQUFBO21CQUNBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQSxLQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLGtCQUFBLFVBQUEsSUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUEsYUFBQSxLQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUE7b0JBQ0EsUUFBQTttQkFDQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7OztZQUdBLGdCQUFBLFVBQUEsUUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLGNBQUEsT0FBQTs7Z0JBRUEsTUFBQSxLQUFBLFlBQUEsS0FBQSxZQUFBLHVCQUFBLGFBQUEsUUFBQSxVQUFBLFFBQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsU0FBQSxNQUFBO29CQUNBLEVBQUEsT0FBQTs7O2dCQUdBLE9BQUEsRUFBQTs7WUFFQSxZQUFBLFVBQUEsUUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsSUFBQSxDQUFBLE9BQUEsSUFBQTtvQkFDQSxNQUFBLEtBQUEsWUFBQSxLQUFBLFlBQUEsWUFBQSxPQUFBLFNBQUEsUUFBQSxVQUFBLFFBQUE7d0JBQ0EsRUFBQSxRQUFBO3VCQUNBLE1BQUEsVUFBQSxPQUFBO3dCQUNBLEVBQUEsT0FB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QUEsZ0JBQUE7Z0JBQ0EsR0FBQSxtQkFBQSxLQUFBLHFCQUFBLE9BQUEsU0FBQSxPQUFBLElBQUEsS0FBQSxvQkFBQSxLQUFBLE9BQUEsUUFBQSxTQUFBLFFBQUE7Z0JBQ0EsR0FBQSxtQkFBQSxLQUFBLGFBQUEsT0FBQSxTQUFBLE9BQUEsSUFBQSxLQUFBLFlBQUEsS0FBQSxPQUFBLFFBQUEsU0FBQSxRQUFBO2dCQUNBLEdBQUEsa0JBQUEsS0FBQSxNQUFBLFdBQUEsT0FBQSxTQUFBLE9BQUEsSUFBQSxLQUFBLE1BQUEsVUFBQSxLQUFBLE9BQUEsUUFBQSxTQUFBLFFBQUE7Z0JBQ0EsR0FBQSxTQUFBLEtBQUE7Z0JBQ0EsR0FBQSxVQUFBLEtBQUE7ZUFDQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7ZUFDQSxRQUFBLFlBQUE7Z0JBQ0EsR0FBQSxtQkFBQTs7OztRQUlBLElBQUEsb0JBQUEsVUFBQSxLQUFBO1lBQ0EsSUFBQSxLQUFBO1lBQ0EsR0FBQSxLQUFBLEVBQUEsVUFBQSxXQUFBLFNBQUEsSUFBQSxVQUFBLE9BQUEsSUFBQSxJQUFBLFNBQUEsV0FBQSxJQUFBLFNBQUEsT0FBQSxJQUFBLFNBQUEsT0FBQSxJQUFBLElBQUEsUUFBQSxXQUFBLElBQUE7WUFDQSxHQUFBLEtBQUEsRUFBQSxVQUFBLFVBQUEsU0FBQSxJQUFBLFNBQUEsT0FBQSxJQUFBLElBQUEsUUFBQSxXQUFBLElBQUEsUUFBQSxPQUFBLElBQUEsVUFBQSxPQUFBLElBQUEsSUFBQSxTQUFBLFdBQUEsSUFBQTtZQUNBLEdBQUEsS0FBQSxFQUFBLFVBQUEsWUFBQSxTQUFBLElBQUEsVUFBQSxPQUFBLElBQUEsSUFBQSxTQUFBLFdBQUEsSUFBQSxTQUFBLE9BQUEsSUFBQSxRQUFBLE9BQUEsSUFBQSxJQUFBLE9BQUEsV0FBQSxJQUFBOztZQUVBLE9BQUE7OztRQUdBLElBQUEsYUFBQSxZQUFBO1lBQ0EsV0FBQSxlQUFBO1lBQ0EsSUFBQSxPQUFBLFlBQUE7WUFDQSxHQUFBLFdBQUEsRUFBQSxRQUFBLEtBQUE7WUFDQSxh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SUFBQSxPQUFBLE1BQUE7WUFDQSxHQUFBLG9CQUFBLFlBQUEsR0FBQSxZQUFBO1lBQ0EsSUFBQSxDQUFBLEdBQUEsU0FBQTtnQkFDQSxHQUFBOzs7O1FBSUEsR0FBQSxrQkFBQSxVQUFBLE9BQUE7WUFDQSxJQUFBLFNBQUEsR0FBQSxvQkFBQSxRQUFBO2dCQUNBLEdBQUEsb0JBQUEsT0FBQTs7WUFFQSxHQUFBLG9CQUFBLFNBQUEsVUFBQSxhQUFBLE9BQUE7WUFDQSxHQUFBLG9CQUFBLFlBQUEsR0FBQSxZQUFBO1lBQ0EsSUFBQSxDQUFBLEdBQUEsU0FBQTtnQkFDQSxHQUFBOzs7O1FBSUEsR0FBQSxZQUFBLGdCQUFBLFVBQUEsU0FBQTs7WUFFQSxHQUFBLFVBQUE7WUFDQSxHQUFBLFFBQUEsVUFBQSxHQUFBLG9CQUFBLFFBQUEsVUFBQSxLQUFBO2dCQUNBLElBQUEsR0FBQSxlQUFBO29CQUNBLEdBQUEsZ0JBQUE7dUJBQ0E7b0JBQ0EsVUFBQSxLQUFBLGVBQUEsSUFBQSxPQUFBOzs7WUFHQSxHQUFBLFFBQUEsV0FBQSxHQUFBLGtCQUFBLFFBQUEsVUFBQSxhQUFBLFVBQUE7Z0JBQ0EsR0FBQSxvQkFBQSxPQUFBO2dCQUNBLEdBQUEsb0JBQUEsWUFBQTtnQkFDQSxHQUFBOztZQUVBLEdBQUEsUUFBQSxLQUFBLEdBQUEsWUFBQSxRQUFBLFVBQUEsTUFBQSxhQUFBO2dCQUNBLEVBQUEsUUFBQSxHQUFBLFFBQUEsS0FBQSxTQUFBLFVBQUEsS0FBQTtvQkFDQSxJQUFBLE9BQUEsT0FBQSxJQUFBOztnQkFFQSxhQUFBLGVBQUEsR0FBQSxRQUFBLEtBQUEsUUFBQTtnQkFDQSxJQUFBLFVBQUE7Z0JBQ0EsRUFBQSxRQUFBLGFBQUEsVUFBQSxLQUFBO29CQUNBLFFBQUEsS0FBQSxJQUFBLEtBQUEsY0FBQSxTQUFBLE1BQUEsSUFBQSxRQUFBLElBQUE7O2dCQUVBLEdBQUEsZUFBQTs7OztRQUlBLEdBQUEsYUFBQSxZQUFBO1lBQ0EsYUFBQSx1QkFBQSxHQUFBO1lBQ0EsR0FBQTtZQUNBLElBQUEsT0FBQSxZQUFB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QUE7Z0JBQ0EsR0FBQSxVQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBO2dCQUNBLE9BQUEsU0FBQTtnQkFDQSxHQUFBLFVBQUE7Ozs7UUFJQSxHQUFBLHNCQUFBLFNBQUEsVUFBQTtZQUNBLE9BQUEsWUFBQSxZQUFBOzs7UUFHQSxHQUFBLDBCQUFBLFNBQUEsUUFBQTtZQUNBLE9BQUEsUUFBQSxZQUFBLFdBQUE7OztRQUdBLElBQUEsaUJBQUEsVUFBQSxJQUFBO1lBQ0EsT0FBQSxPQUFBLElBQUEsSUFBQTs7O1FBR0EsSUFBQSxjQUFBLFlBQUE7WUFDQSxlQUFBLGtCQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLEdBQUEsV0FBQSxLQUFBO2dCQUNBLEdBQUEsYUFBQSxFQUFBLE1BQUEsR0FBQSxVQUFBO2dCQUNBLEdBQUEsZUFBQSxLQUFBO2dCQUNBLElBQUEsR0FBQSxvQkFBQTtvQkFDQSxHQUFBLFlBQUEsR0FBQTt1QkFDQTtvQkFDQSxHQUFBLFVBQUE7O2dCQUVBLFFBQUEsT0FBQTtxQkFDQSxJQUFBO3dCQUNBLE9BQUE7d0JBQ0EsYUFBQTt3QkFDQSxVQUFBLFlBQUE7NEJBQ0EsSUFBQSxHQUFBLGVBQUE7Z0NBQ0EsSUFBQSxNQUFBLEVBQUEsUUFBQSxHQUFBLFlBQUEsR0FBQSxjQUFBO2dDQUNBLElBQUEsTUFBQSxHQUFBO29DQUNBLEdBQUEsWUFBQSxHQUFBLFdBQUEsTUFBQTs7Ozt1QkFJQSxJQUFBO3dCQUNBLE9BQUE7d0JBQ0EsYUFBQTt3QkFDQSxVQUFBLFlBQUE7NEJBQ0EsSUFBQSxHQUFBLGVBQUE7Z0NBQ0EsSUFBQSxNQUFBLEVBQUEsUUFBQSxHQUFBLFlBQUEsR0FBQSxjQUFBO2dDQUNBLElBQUEsT0FBQSxHQUFBLFdBQUEsU0FBQSxJQUFBO29DQUNBLEdBQUEsWUFBQSxHQUFBLFdBQUEsTUFBQTs7Ozs7ZUFLQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7Z0JBQ0EsR0FBQSxVQUFBOzs7O1FBSUEsSUFBQSxvQkFBQSxVQUFBLElBQUE7WUFDQSxH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QkFBQSxlQUFBLE9BQUEsR0FBQSxpQkFBQTs7WUFFQSxHQUFBLGdCQUFBO1lBQ0EsR0FBQSxVQUFBO1lBQ0EsWUFBQSxZQUFBLFlBQUEsS0FBQSxZQUFBO2dCQUNBLE9BQUEsV0FBQTtnQkFDQSxHQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsT0FBQSxTQUFBO2dCQUNBLEdBQUEsVUFBQTs7OztRQUlBLEdBQUEsWUFBQSxVQUFBLEtBQUE7WUFDQSxHQUFBLGdCQUFBO1lBQ0EsR0FBQSxVQUFBO1lBQ0EsSUFBQSxpQkFBQSxJQUFBO1lBQ0EsSUFBQSxTQUFBO1lBQ0EsV0FBQSxVQUFBLElBQUEsSUFBQSxFQUFBLFFBQUEsY0FBQSxLQUFBLFlBQUE7Z0JBQ0EsT0FBQSxXQUFBO2dCQUNBLElBQUEsU0FBQTtlQUNBLE1BQUEsVUFBQSxPQUFBO2dCQUNBLE9BQUEsU0FBQTtnQkFDQSxJQUFBLFNBQUE7ZUFDQSxRQUFBLFlBQUE7Z0JBQ0EsR0FBQSxVQUFBOzs7O1FBSUEsR0FBQSxnQkFBQSxZQUFBO1lBQ0EsT0FBQTtZQUNBLGFBQUEsY0FBQSxHQUFBO1lBQ0EsR0FBQSxVQUFBO1lBQ0EsR0FBQTs7O1FBR0EsR0FBQSxnQkFBQSxZQUFBO1lBQ0EsR0FBQSxZQUFBLGFBQUEsWUFBQSxnQkFBQSxHQUFBLFNBQUEsR0FBQTs7O1FBR0EsR0FBQSxpQkFBQSxVQUFBLFNBQUE7WUFDQSxHQUFBLFdBQUEsUUFBQSxRQUFBLFNBQUEsSUFBQSxVQUFBO1lBQ0Esa0JBQUEsUUFBQSxTQUFBO1lBQ0EsR0FBQTs7O1FBR0EsR0FBQSxnQkFBQSxVQUFBLE9BQUE7WUFDQSxJQUFBLE1BQUEsT0FBQSxHQUFBLFdBQUEsYUFBQTtnQkFDQSxHQUFBLFdBQUEsT0FBQTs7WUFFQSxHQUFBLFdBQUEsY0FBQSxNQUFBLE9BQUEsSUFBQSxPQUFBLE1BQUE7WUFDQSxHQUFBLFdBQUEsWUFBQSxHQUFBLFlBQUE7WUFDQSxJQUFBLENBQUEsR0FBQSxTQUFBO2dCQUNBLEdBQUE7Ozs7UUFJQSxHQUFBLGtCQUFBLFVBQUEsT0FBQTtZ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QUFBLGNBQUEsU0FBQSxvQkFBQSxxQkFBQSxRQUFBLGdCQUFBLGNBQUE7UUFDQSxJQUFBLGFBQUEsVUFBQSxJQUFBLFVBQUEsY0FBQSxPQUFBLE9BQUE7bUNBQ0EsVUFBQSxVQUFBLFNBQUEsV0FBQSxlQUFBO21DQUNBLGtCQUFBLG1CQUFBLFNBQUEsUUFBQSxTQUFBO21DQUNBLG9CQUFBLGVBQUEsTUFBQSxTQUFBLFNBQUE7bUNBQ0EsUUFBQSxTQUFBLGVBQUEscUJBQUE7bUNBQ0EsbUJBQUEsWUFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsV0FBQSxRQUFBLFlBQUE7WUFDQSxLQUFBLGVBQUE7WUFDQSxLQUFBLFFBQUEsZUFBQSxZQUFBO1lBQ0EsS0FBQSxRQUFBO1lBQ0EsS0FBQSxTQUFBO1lBQ0EsS0FBQSxXQUFBO1lBQ0EsS0FBQSxXQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxZQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsZUFBQTtZQUNBLEtBQUEsbUJBQUE7WUFDQSxLQUFBLG9CQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxvQkFBQSxPQUFBLElBQUEsU0FBQSxPQUFBLFlBQUEsWUFBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsbUJBQUEsT0FBQSxJQUFBLFFBQUEsT0FBQSxZQUFBLFlBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLG9CQUFBLE9BQUEsSUFBQSxTQUFBLE9BQUEsWUFBQSxZQUFBO1lBQ0EsS0FBQSxRQUFBO1lBQ0EsS0FBQSxrQkFBQSxPQUFBLElBQUEsT0FBQSxPQUFBLFlBQUEsWUFBQTtZQUNBLEtBQUEscUJBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxPQUFBO2dCQUNBLFlBQUEsbUJBQUEsWUFBQSxLQUFBO2dCQUNBLFNBQUEsS0FBQTtnQkFDQSxhQUFBLG9CQUFBLFlBQUEsS0FBQTs7WUFFQSxLQUFBLFVBQUE7Z0JBQ0EsYUFBQSxvQkFBQSxZQUFBLFFBQUE7Z0JBQ0EsU0FBQSxRQUFBOztZQUVBLEtBQUEsVUFBQSxFQUFBLE9BQUEsT0FBQSxZQUFBLFVBQUEsQ0FBQSxZQUFBO1lBQ0EsS0FBQSxXQUFBLGFBQUEsWUFBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLHNCQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLGFBQUE7WUFDQSxLQUFBLHVCQUFBLE9BQUEsSUFBQSxZQUFBLE9BQUEsWUFBQSxZQUFBLGdCQUFBOzs7OztRQUtBLFdBQUEsWUFBQTtZQUNBLGFBQUEsWUFBQTtnQkFDQSxJQUFBLFFBQUEsS0FBQTtvQkFDQSxNQUFBLEtBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQSxNQUFBOztnQkFFQSxPQUFBLGFBQUEsa0JBQUEsT0FBQTs7WUFFQSxvQkFBQSxVQUFBO2dCQUNBLElBQUEsS0FBQSxXQUFBLElBQUE7b0JBQ0EsT0FBQSxLQUFBLFNBQUE7O2dCQUVBLE9BQUE7O1lBRUEsZ0JBQUEsVUFBQTs7Ozs7Ozs7OztnQkFVQSxPQUFBLEtBQUEsT0FBQTs7Ozs7UUFLQSxXQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLFdBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxXQUFBO3FCQUNBLE9BQUE7O1lBRUEsT0FBQSxXQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUNySUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSx5REFBQSxVQUFBLGFBQUEsS0FBQSxNQUFBLFFBQUE7UUFDQSxJQUFBLGVBQUEsVUFBQSxJQUFBLFFBQUEsbUJBQUEsU0FBQSxhQUFBLGVBQUEsZUFBQSxhQUFBLGVBQUEsZUFBQSxjQUFBLGdCQUFBLGdCQUFBLFNBQUEsUUFBQSxTQUFBLE9BQUEsZUFBQSxLQUFBLE1BQUEsT0FBQSxhQUFBLGdCQUFBLGVBQUEsbUJBQUEsb0JBQUEsc0JBQUEsU0FBQSxvQkFBQSxvQkFBQSxrQkFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsaUJBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLG9CQUFBLFVBQUEsT0FBQSxJQUFBLFNBQUEsZ0JBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLG1CQUFBLFNBQUEsT0FBQSxJQUFBLFFBQUEsZ0JBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLG9CQUFBLFVBQUEsT0FBQSxJQUFBLFNBQUEsZ0JBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGtCQUFBLFFBQUEsT0FBQSxJQUFBLE9BQUEsZ0JBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSwwQkFBQSxnQkFBQSxPQUFBLElBQUEsZUFBQSxnQkFBQTtZQUNBLEtBQUEsTUFBQSxJQUFBLFlBQUE7WUFDQSxLQUFBLE9BQUEsS0FBQSxZQUFBO1lBQ0EsS0FBQSxRQUFBO1lBQ0EsS0FBQSxjQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLG9CQUFBO1lBQ0EsS0FBQSxxQkFBQTtZQUNBLEtBQUEsdUJBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLHFCQUFBO1lBQ0EsS0FBQSxxQkFBQTtZQUNBLEtBQUEsbUJBQUE7Ozs7UUFJQSxhQUFBLFlBQUE7WUFDQSxhQUFBLFlBQUE7Z0JBQ0EsT0FBQSxPQUFBLElBQUEsS0FBQSxlQUFBLEtBQUEsT0FBQSxJQUFBLEtBQUE7O1lBRUEsU0FBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQSxJQUFBLFFBQUEsV0FBQSxzQkFBQSxLQUFBLElBQUEsUUFBQSxXQUFBLFNBQUEsc0JBQUEsWUFBQSxrQkFBQTs7Ozs7UUFLQSxhQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLGFBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxhQUFBO3FCQUNBLE9BQUE7O1lBRUEsT0FBQSxhQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUN0R0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxrREFBQSxVQUFBLGFBQUEsS0FBQSxNQUFBO1FBQ0EsSUFBQSxrQkFBQSxVQUFBLElBQUEsUUFBQSxtQkFBQSxTQUFBLFdBQUEsU0FBQSxRQUFBLFdBQUEsYUFBQSxlQUFBLGFBQUEsZUFBQSxjQUFBLGdCQUFBLE9BQUEsZUFBQSxLQUFBLE1BQUEsT0FBQSxhQUFBLFFBQUEsUUFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxjQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsZUFBQTtZQUNBLEtBQUEsaUJBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxNQUFBLElBQUEsWUFBQTtZQUNBLEtBQUEsT0FBQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLGFBQUEsU0FBQSxPQUFBLFFBQUEsSUFBQSxPQUFBLFFBQUEsTUFBQSxZQUFBO1lBQ0EsS0FBQSxTQUFBOzs7O1FBSUEsZ0JBQUEsWUFBQTtZQUNBLFFBQUEsU0FBQSxNQUFBO2dCQUNBLE9BQUE7Ozs7OztRQU1BLGdCQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtv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QUFBLEVBQUEsVUFBQTtvQkFDQSxjQUFBLEVBQUEsTUFBQSxLQUFBLGdCQUFBLEVBQUEsVUFBQTtvQkFDQSxjQUFBLEVBQUEsTUFBQSxLQUFBLGdCQUFBLEVBQUEsVUFBQTs7Z0JBRUEsSUFBQSxhQUFBLEVBQUEsS0FBQSxLQUFBLGVBQUEsVUFBQSxnQkFBQSxFQUFBLE9BQUE7b0JBQ0EsVUFBQSxFQUFBLElBQUEsWUFBQTtvQkFDQSxTQUFBLFdBQUEsU0FBQSxJQUFBLFVBQUEsV0FBQSxRQUFBLFdBQUE7b0JBQ0EsZUFBQSxXQUFBLElBQUEsSUFBQSxNQUFBLENBQUEsQ0FBQSxVQUFBLFVBQUEsS0FBQSxRQUFBO29CQUNBLGNBQUEsRUFBQSxLQUFBLEtBQUEsZ0JBQUEsVUFBQSxnQkFBQSxFQUFBLE9BQUE7b0JBQ0EsV0FBQSxFQUFBLElBQUEsYUFBQTtvQkFDQSxVQUFBLFlBQUEsU0FBQSxJQUFBLFdBQUEsWUFBQSxRQUFBLFlBQUE7b0JBQ0EsZ0JBQUEsWUFBQSxJQUFBLElBQUEsTUFBQSxDQUFBLENBQUEsV0FBQSxXQUFBLEtBQUEsUUFBQTtvQkFDQSxjQUFBLEVBQUEsS0FBQSxLQUFBLGdCQUFBLFVBQUEsZ0JBQUEsRUFBQSxPQUFBO29CQUNBLFdBQUEsRUFBQSxJQUFBLGFBQUE7b0JBQ0EsVUFBQSxZQUFBLFNBQUEsSUFBQSxXQUFBLFlBQUEsUUFBQSxZQUFBO29CQUNBLGdCQUFBLFlBQUEsSUFBQSxJQUFBLE1BQUEsQ0FBQSxDQUFBLFdBQUEsV0FBQSxLQUFBLFFBQUE7O2dCQUVBLE9BQUE7b0JBQ0EsT0FBQTt3QkFDQSxNQUFBO3dCQUNBLFFBQUE7d0JBQ0EsV0FBQSxXQUFBO3dCQUNBLE9BQUE7O29CQUVBLFFBQUE7d0JBQ0EsTUFBQTt3QkFDQSxRQUFBO3dCQUNBLFdBQUEsWUFBQTt3QkFDQSxPQUFBOztvQkFFQSxRQUFBO3dCQUNBLE1BQUE7d0JBQ0EsUUFBQTt3QkFDQSxXQUFBLFlBQUE7d0JBQ0EsT0FBQTs7OztZQUlBLGFBQUEsWUFBQTtnQkFDQSxJQUFBLFVBQUEsRUFBQSxNQUFBLEtBQUEsZUFBQSxFQUFBLFVBQUE7b0JBQ0EsZ0JBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxTQUFBO29CQUNBLFdBQUEsRUFBQSxNQUFBLEtBQUEsZ0JBQUEsRUFBQSxVQUFBO29CQUNBLGlCQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsVUFBQTtvQkFDQSxXQUFBLEVBQUEsTUFBQSxLQUFBLGdCQUFBLEVBQUEsVUFBQTtvQkFDQSxpQkFBQSxFQUFBLE9BQUEsRUFBQSxRQUFBLFVBQUE7O2dCQUVBLElBQUEsbUJBQUEsVUFBQSxZQUFBO29CQUNBLElBQUEsWUFBQTtvQkFDQSxFQUFBLFFBQUEsWUFBQSxVQUFBLFVBQUE7d0JBQ0EsRUFBQSxRQUFBLFVBQUEsVUFBQSxLQUFBOzRCQUNBLFVBQUEsS0FBQSxFQUFBLFFBQUEsSUFBQSxVQUFBLE9BQUEsSUFBQTs7O29CQUdBLE9BQUE7OztnQkFHQSxPQUFBO29CQUNBLE9BQUEsaUJBQUE7b0JBQ0EsUUFBQSxpQkFBQTtvQkFDQSxRQUFBLGlCQUFBOzs7Ozs7UUFNQSxlQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBOztnQkFFQSxJQUFBLG1CQUFBLEtBQUEsWUFBQSxLQUFBLFlBQUEsS0FBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQTtvQkFD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QSxPQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsUUFBQTtnQkFDQSxhQUFBO2dCQUNBLGVBQUE7Z0JBQ0EsbUJBQUE7Z0JBQ0EsU0FBQTs7OztRQUlBLE9BQUE7WUFDQSxrQkFBQSxVQUFBLFFBQUE7Z0JBQ0EsU0FBQSxVQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUEsWUFBQSxhQUFBLG9CQUFBO29CQUNBLFFBQUE7b0JBQ0EsUUFBQTttQkFDQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxLQUFBLFVBQUEsYUFBQSxZQUFBLEtBQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLHdCQUFBLFVBQUEsSUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsTUFBQSxJQUFBLFlBQUEsYUFBQSxvQkFBQSxvQkFBQSxLQUFBLEtBQUEsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBLGFBQUEsWUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7O2dCQUVBLE9BQUEsRUFBQTs7WUFFQSxZQUFBLFNBQUEsT0FBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsTUFBQTtvQkFDQSxRQUFBO29CQUNBLEtBQUEsWUFBQSxhQUFBLG9CQUFBLG9CQUFBLFNBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLFFBQUEsU0FBQSxPQUFBO2dCQUNBLElBQUEsTUFBQSxPQUFBLFlBQUEsYUFBQSxvQkFBQSxvQkFBQSxTQUFBOzs7OztnQkFLQSxJQUFBLDBCQUFBLFVBQUEsSUFBQSxHQUFBO29CQUNBLElBQUE7d0JBQ0EsT0FBQTt3QkFDQSxhQUFBOzRCQUNBLFVBQUEsVUFBQSxVQUFBO2dDQUNBLElBQUEsU0FBQSxTQUFBO2dDQUNBLE9BQUEs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QkFDQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsTUFBQTtvQkFDQSxLQUFBLE9BQUEsTUFBQSxPQUFBLE1BQUEsWUFBQSxhQUFBLFVBQUE7b0JBQ0EsUUFBQTtvQkFDQSxRQUFBO21CQUNBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLEVBQUE7Ozs7OztBQ3ZHQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLDhEQUFBLFVBQUEsT0FBQSxJQUFBLFdBQUEsYUFBQTtRQUNBLElBQUEsb0JBQUEsVUFBQSxNQUFBLFdBQUEsU0FBQSxPQUFBLFdBQUEsUUFBQSxPQUFBLFVBQUE7WUFDQSxRQUFBLElBQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxRQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsVUFBQTs7OztRQUlBLE9BQUE7WUFDQSxjQUFBLFlBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsTUFBQSxJQUFBLFlBQUEsYUFBQSxhQUFBLFlBQUEsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLG9CQUFBLFVBQUEsSUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxNQUFBLElBQUEsWUFBQSxhQUFBLGFBQUEsYUFBQSxLQUFBLEtBQUEsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLG9CQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLE1BQUEsWUFBQSxhQUFBLGFBQUEsYUFBQSxPQUFBO2dCQUNBLE1BQUEsSUFBQSxLQUFBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7O2dCQUVBLE9BQUEsRUFBQTs7WUFFQSxhQUFBLFVBQUEsUUFBQTtnQkFDQSxJQUFBLFNBQUEsVUFBQTtvQkFDQSxJQUFBLEdBQUE7O2dCQUVBLE1BQUE7b0JBQ0EsUUFBQTtvQkFDQSxLQUFBLFlBQUEsYUFBQSxhQUFBLGFBQUEsT0FBQSxXQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7O2dCQUdBLE9BQUEsRUFBQTs7WUFFQSxzQkFBQSxVQUFBLEtBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7O2dCQUVBLElBQUEsWUFBQTtvQkFDQSxPQUFBO29CQUNBLE1BQUE7b0JBQ0EsVUFBQTtvQkFDQSxTQUFBOzs7Z0JBR0EsSUFBQSxVQUFBLE9BQUEsSUFBQSxJQUFBLE9BQUEsT0FBQSxLQUFBLE9BQUEsSUFBQSxJQUFBLE9BQUEsVUFBQSxPQUFBOztnQkFFQSxFQUFBLFFBQUEsSUFBQSxNQUFBLGlCQUFBLFVBQUEsUUFBQTtvQkFDQSxJQUFBLGVBQUE7d0JBQ0EsUUFBQTt3QkFDQSxPQUFBLE9BQUEsSUFBQSxJQUFBLE9BQUEsU0FBQSxPQUFBO3dCQUNBLE9BQUEsT0FBQSxJQUFBLElBQUEsT0FBQSxPQUFBLE9BQUE7d0JBQ0EsT0FBQTt3QkFDQSxPQUFBO3dCQUNBLFFBQUE7OztvQkFHQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsU0FBQSxLQUFBO3dCQUNBLElBQUEsSUFBQSxNQUFBLGVBQUEsU0FBQSxHQUFBOzRCQUNBLEVBQUEsUUFBQSxJQUFBLE1BQUEsZ0JBQUEsVUFBQSxRQUFBO2dDQUNBLGFBQUEsT0FBQSxLQUFBO29DQUNBLE1BQUEsT0FBQSxJQUFBLElBQUEsT0FBQSxTQUFBLElBQUEsR0FBQSxLQUFBLE9BQUE7b0NBQ0EsT0FBQSxLQUFBLE1BQUEsS0FBQSxZ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LFlBQUE7WUFDQSxHQUFBLFlBQUE7WUFDQSxJQUFBLEdBQUEsU0FBQSxXQUFBLEdBQUE7O2dCQUVBLE1BQUE7Z0JBQ0EsUUFBQTttQkFDQTtnQkFDQSxJQUFBLFdBQUEsRUFBQSxNQUFBLEdBQUEsU0FBQSxRQUFBLFlBQUE7O29CQUVBLEdBQUEsaUJBQUE7b0JBQ0EsR0FBQTs7O2dCQUdBLEVBQUEsUUFBQSxHQUFBLFVBQUEsVUFBQSxLQUFBO29CQUNBLElBQUEsU0FBQSxHQUFBLGtCQUFBO29CQUNBLGVBQUEsWUFBQSxRQUFBLEtBQUEsVUFBQSxNQUFBOzt3QkFFQSxHQUFBLFVBQUEsS0FBQTs0QkFDQSxPQUFBOzRCQUNBLFNBQUEsS0FBQTs7d0JBRUE7dUJBQ0EsTUFBQSxVQUFBLE9BQUE7d0JBQ0EsR0FBQSxpQkFBQTt3QkFDQSxRQUFBLElBQUE7d0JBQ0EsT0FBQSxTQUFBOzs7Ozs7UUFNQSxHQUFBLGFBQUEsWUFBQTtZQUNBLEdBQUEsV0FBQTtZQUNBLEdBQUEsaUJBQUE7WUFDQSxJQUFBLGtCQUFBO2dCQUNBLGtCQUFBOztZQUVBLEVBQUEsUUFBQSxHQUFBLGdCQUFBLFVBQUEsSUFBQTtnQkFDQSxnQkFBQSxLQUFBLEVBQUEsS0FBQSxHQUFBLGlCQUFBLEVBQUEsSUFBQSxTQUFBOztZQUVBLElBQUEsUUFBQSxRQUFBLEdBQUEsa0JBQUE7Z0JBQ0EsRUFBQSxRQUFBLEdBQUEsaUJBQUEsVUFBQSxRQUFBO29CQUNBLGdCQUFBLEtBQUEsRUFBQSxLQUFBLEdBQUEsU0FBQSxFQUFBLE1BQUE7O21CQUVBO2dCQUNBLGdCQUFBLEtBQUEsRUFBQSxLQUFBLEdBQUEsU0FBQSxFQUFBLE1BQUEsR0FBQTs7WUFFQSxHQUFBLFNBQUEsS0FBQTtnQkFDQSxTQUFBLEdBQUEsZUFBQTtnQkFDQSxPQUFBLEdBQUEsYUFBQTtnQkFDQSxXQUFBLEdBQUE7Z0JBQ0EsUUFBQSxFQUFBLE1BQUEsaUJBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxVQUFBLEdBQUE7Z0JBQ0EsZ0JBQUE7Z0JBQ0EsaUJBQUE7O1lBRUEsR0FBQTs7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QSxJQUFBLEVBQUEsTUFBQSxnQkFBQSxHQUFBLGNBQUEsT0FBQTtvQkFDQSxHQUFBLGVBQUEsR0FBQSxlQUFBLEVBQUEsSUFBQSxFQUFBLFFBQUEsR0FBQSxRQUFBOzs7OztZQUtBLEVBQUEsUUFBQSxVQUFBLFVBQUEsU0FBQTtnQkFDQSxJQUFBLGFBQUEsRUFBQSxLQUFBLGFBQUEsVUFBQSxNQUFBO29CQUNBLE9BQUEsU0FBQTs7Z0JBRUEsSUFBQSxDQUFBLFlBQUE7b0JBQ0EsVUFBQSxLQUFBOzs7OztZQUtBLFNBQUE7WUFDQSxPQUFBO1lBQ0EsV0FBQTs7O1lBR0EsSUFBQSxVQUFBLE9BQUEsSUFBQSxHQUFBLGNBQUEsTUFBQSxLQUFBLEtBQUEsT0FBQSxJQUFBLEdBQUEsZUFBQSxlQUFBLFFBQUEsTUFBQSxPQUFBO1lBQ0EsS0FBQSxJQUFBLElBQUEsR0FBQSxJQUFBLFNBQUEsS0FBQTtnQkFDQSxLQUFBLEtBQUEsT0FBQSxJQUFBLEdBQUEsZUFBQSxlQUFBLFFBQUEsS0FBQSxJQUFBLEdBQUEsS0FBQTs7OztZQUlBLEVBQUEsUUFBQSxHQUFBLFdBQUEsVUFBQSxNQUFBO2dCQUNBLElBQUEsV0FBQTtvQkFDQSxRQUFBLEtBQUE7b0JBQ0EsY0FBQTtvQkFDQSxhQUFBOztnQkFFQSxTQUFBLEVBQUEsTUFBQSxNQUFBLGlCQUFBOztnQkFFQSxJQUFBLE1BQUEsZUFBQSxTQUFBLEdBQUE7O29CQUVBLEVBQUEsUUFBQSxLQUFBLFNBQUEsVUFBQSxRQUFBO3dCQUNBLElBQUEsT0FBQSxPQUFBLFNBQUEsR0FBQTs7OzRCQUdBLElBQUEsZ0JBQUEsRUFBQSxRQUFBLE9BQUEsUUFBQTtnQ0FDQSxZQUFBO2dDQUNBLFlBQUEsRUFBQSxNQUFBLE1BQUEsZ0JBQUE7Ozs7Ozs0QkFNQSxJQUFBLFVBQUEsU0FBQSxHQUFBOzs7Z0NBR0EsRUFBQSxRQUFBLFdBQUEsVUFBQSxJQUFBO29DQUNBLFVBQUEsTUFBQSxFQUFBLElBQUEsZUFBQSxJQUFBOzttQ0FFQTs7OztnQ0FJQSxVQUFBLE1BQUEsVUFBQSxNQUFBLEVBQUEsTUFBQSxlQUFBLEdBQUE7OzRCQUVBLEVBQUEsUUFBQSxFQUFBLE1BQUEsWUFBQSxVQUFBLEdBQUE7Z0NBQ0EsV0FBQTs7O2dDQUdBLGNBQUEsRUFBQSxPQUFBLGNBQUEsTUFBQSxlQUFBLEtBQUEsRUFBQSxLQUFBLE1BQUEsZ0JBQUEsQ0FBQSxJQUFBLFNBQUEsRUFBQTtnQ0FDQSxhQUFBLEVBQUE7OztnQ0FHQSxFQUFBLFFBQUEsTUFBQSxVQUFBLE9BQUE7b0NBQ0EsSUFBQSxXQUFBLEVBQUEsS0FBQSxZQUFBLFVBQUEsT0FBQTt3Q0FDQSxPQUFBLE9BQUEsSUFBQSxNQUFBLE1BQUEsT0FBQSxPQUFBOzs7b0NBR0EsU0FBQSxLQUFBLFdBQUEsU0FBQSxRQUFBOzs7O2dDQUlBLFNBQUEsUUFBQSxZQUFBLE9BQUEsWUFBQTtnQ0FDQSxTQUFBLFlBQUEsT0FBQSxZQUFBLE1BQUEsWUFBQSxVQUFBLFlBQUEsUUFBQSxNQUFBLFlBQUEsVUFBQSxZQUFBO2dDQUNBLE9BQUEsS0FBQTs7Ozt1QkFJQTs7b0JBRUEsRUFBQSxRQUFBLEtBQUEsU0FBQSxVQUFBLFFBQUE7O3dCQUVBLEVBQUEsUUFBQSxNQUFBLFVBQUEsT0FBQTs0QkFDQSxJQUFBLFdBQUEsRUFBQSxLQUFBLE9BQUEsUUFBQSxVQUFBLE9BQUE7Z0NBQ0EsT0FBQSxPQUFBLElBQUEsTUFBQSxNQUFBLE9BQUEsT0FBQTs7OzRCQUdBLFNBQUEsS0FBQSxXQUFBLFNBQUEsUUFBQTs7Ozt3QkFJQSxJQUFBLGNBQUEsT0FBQSxPQUFBLFFBQUEsY0FBQSxNQUFBLFNBQUE7d0JBQ0EsU0FBQSxRQUFBO3dCQUNBLFNBQUEsZUFBQTt3QkFDQSxPQUFBLEtBQUE7Ozs7OztZQU1BLElBQUEsRUFBQSxJQUFBLEVBQUEsUUFBQSxhQUFBLEdBQUE7Z0JBQ0EsT0FBQSxRQUFBOzs7O1lBSUEsS0FBQSxRQUFBO1lBQ0EsT0FBQSxRQUFBOztZQUVBLElBQUEsUUFBQTtnQkFDQSxPQUFBO2dCQUNBLFNBQUE7O1lBRUEsRUFBQSxRQUFBLFFBQUEsVUFBQSxLQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsSUFBQSxJQUFBLE9BQUEsS0FBQTtvQkFDQSxLQUFBLElBQUEsTUFBQSxHQUFBO29CQUNBLElBQUEsR0FBQSxpQkFBQSxXQUFBO3dCQUNBLE9BQUEsS0FBQSxJQUFBOzs7Z0JBR0EsUUFBQSxPQUFBLE9BQUE7OztZQUdBLElBQUEsT0FBQTs7Z0JBRUEsTUFBQSxPQUFBLENBQUE7Z0JBQ0EsTUFBQSxLQUFBLE1BQUE7Z0JBQ0EsTUFBQSxLQUFBLE9BQUE7b0JBQ0EsR0FBQSxFQUFBLFdBQUEsT0FBQTs7Z0JBRUEsTUFBQSxLQUFBO29CQUNBLFNBQUE7b0JBQ0EsT0FBQTtvQkFDQSxRQUFBOzttQkFFQTs7Z0JBRUEsUUFBQSxHQUFBLFNBQUE7b0JBQ0EsUUFBQTtvQkFDQSxNQUFBO3dCQUNBLEdBQUE7d0JBQ0EsU0FBQTt3QkFDQSxPQUFBO3dCQUNBLFFBQUEsQ0FBQTt3QkFDQSxPQUFBOztvQkFFQSxVQUFBO3dCQUNBLE1BQUEsR0FBQTs7b0JBRUEsWUFBQTt3QkFDQSxVQUFBOztvQkFFQSxPQUFBO3dCQUNBLFNBQUEsWUFBQSxPQUFBOztvQkFFQSxNQUFBO3dCQUNBLE1BQUE7d0JBQ0EsR0FBQTs0QkFDQSxNQUFBO2dDQUNBLFFBQUEsVUFBQSxHQUFBO29DQUNBLE9BQUEsT0FBQSxJQUFBLEdBQUE7Ozs0QkFHQSxPQUFBO2dDQUNBLE1BQUE7Z0NBQ0EsVUFBQTs7O3dCQUdBLEdBQUE7NEJBQ0EsTUFBQTtnQ0FDQSxRQUFBLFVBQUEsR0FBQTtvQ0FDQSxPQUFBLGNBQUE7Ozs0QkFHQSxPQUFBO2dDQUNBLE1BQUEsRUFBQSxXQUFBLE9BQUE7Z0NBQ0EsVUFBQTs7Ozs7OztZQU9BLElBQUEsR0FBQSxjQUFBO2dCQUNBLEdBQUEsZUFBQSxjQUFBLEdBQUEsY0FBQTtnQkFDQSxHQUFBLGFBQUEsc0NBQUEsR0FBQSxhQUFBLG1CQUFBLFlBQUEsR0FBQSxVQUFBLEdBQUEsTUFBQSxnQkFBQSxHQUFBLFFBQUEsVUFBQSxPQUFBLElBQUEsR0FBQSxnQkFBQSxPQUFBLGlCQUFBLFFBQUEsT0FBQSxJQUFBLEdBQUEsY0FBQSxPQUFBO21CQUNBO2dCQUNBLEdBQUEsYUFBQSxHQUFBLFVBQUEsR0FBQSxNQUFBLGdCQUFBLEdBQUEsUUFBQSxNQUFBLE9BQUEsSUFBQSxHQUFBLGdCQUFBLE9BQUEsaUJBQUEsUUFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLE9BQUE7Ozs7O1FBS0EsUUFBQSxRQUFBLFVBQUEsTUFBQSxZQUFBOztZQUVBLElBQUEsV0FBQSxhQUFBO2dCQUNBLFNBQUEsWUFBQTtnQkFDQSxpQkFBQSxTQUFBLFNBQUE7O1lBRUEsR0FBQSxhQUFBLGFBQUEsaUJBQUEscUJBQUEsaUJBQUE7Ozs7O0FDMWZBLENBQUEsWUFBQTtJQUNBOzs7Ozs7Ozs7OztJQVdBLFFBQUEsT0FBQSxZQUFBLFFBQUEsNEJBQUEsVUFBQSxXQUFBOztRQUVBLEtBQUEsV0FBQTs7UUFFQSxJQUFBLFlBQUE7O1FBRUEsS0FBQSxtQkFBQSxTQUFBLFVBQUE7WUFDQSxVQUFBLEtBQUE7OztRQUdBLEtBQUEsa0JBQUEsV0FBQTtZQUNBLFFBQUEsUUFBQSxXQUFBLFNBQUEsVUFBQTtnQkFDQTs7OztRQUlBLEtBQUEsaUJBQUEsU0FBQSxZQUFBO1lBQ0EsS0FBQSxXQUFBO1lBQ0EsS0FBQTs7Ozs7O0FDOUJBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsMENBQUEsVUFBQSxPQUFBLGFBQUE7UUFDQSxJQUFBLGNBQUE7O1FBRUEsS0FBQSxpQkFBQSxVQUFBLE1BQUE7WUFDQSxjQUFBOzs7UUFHQSxLQUFBLGlCQUFBLFlBQUE7WUFDQSxPQUFBOzs7O0FDWEEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSxzTEFBQSxTQUFBLFFBQUEsV0FBQSxjQUFBLFVBQUEsWUFBQSxhQUFBLGFBQUEsY0FBQSxlQUFBLGdCQUFBLFFBQUE7UUFDQSxJQUFBLEtBQUE7WUFDQSxRQUFBO1lBQ0EsV0FBQTs7UUFFQSxHQUFBLGNBQUE7UUFDQSxHQUFBLFNBQUE7UUFDQSxHQUFBLElBQUE7UUFDQSxHQUFBLFVBQUE7UUFDQSxHQUFBLGdCQUFBO1FBQ0EsR0FBQSxhQUFBO1FBQ0EsR0FBQSxhQUFBO1FBQ0EsR0FBQSxTQUFBLFNBQUEsYUFBQTtRQUNBLEdBQUEsY0FBQTtRQUNBLEdBQUEsZ0JBQUE7UUFDQSxHQUFBLGFBQUE7UUFDQSxHQUFBLGdCQUFBO1FBQ0EsR0FBQSxXQUFBO1FBQ0EsR0FBQSxlQUFBOztRQUVBLElBQUEsV0FBQSxZQUFBO1lBQ0EsY0FBQSxVQUFBLE1BQUEsS0FBQSxNQUFBLE1BQUEsVUFBQSxNQUFBO2dCQUNBLElBQUEsS0FBQSxXQUFBO29CQUNBLEdBQUEsYUFBQTtvQkFDQSxHQUFBLGNBQUE7b0JBQ0EsR0FBQSxnQkFBQTtvQkFDQSxRQUFBLEtBQUE7b0JBQ0EsR0FBQSxhQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsSUFBQSxHQUFBO29CQUNBLEVBQUEsUUFBQSxHQUFBLFdBQUEsZUFBQSxRQUFBLGFBQUEsVUFBQSxTQUFBO3dCQUNBLEdBQUEsWUFBQSxLQUFBOzRCQUNBLFNBQUEsRUFBQSxLQUFBLFVBQUEsRUFBQSxJQUFBLFFBQUE7NEJBQ0EsT0FBQSxRQUFBOzs7b0JBR0EsRUFBQSxRQUFBLEdBQUEsV0FBQSxlQUFBLFVBQUEsYUFBQSxVQUFBLFdBQUE7d0JBQ0EsR0FBQSxjQUFBLEtBQUE7NEJBQ0EsU0FBQSxFQUFBLEtBQUEsVUFBQSxFQUFBLElBQUEsVUFBQTs0QkFDQSxPQUFBLFVBQUE7OztvQkFHQSxFQUFBLFFBQUEsR0FBQSxXQUFBLGVBQUEsT0FBQSxPQUFBLGFBQUEsVUFBQSxRQUFBO3dCQUNBLEdBQUEsV0FBQSxLQUFBOzRCQUNBLFNBQUEsRUFBQSxLQUFBLFVBQUEsRUFBQSxJQUFBLE9BQUE7NEJBQ0EsT0FBQSxPQUFBOzs7b0JBR0EsRUFBQSxRQUFBLEdBQUEsV0FBQSxlQUFBLE9BQUEsVUFBQSxhQUFBLFVBQUEsV0FBQTt3QkFDQSxHQUFBLGNBQUEsS0FBQTs0QkFDQSxTQUFBLEVBQUEsS0FBQSxVQUFBLEVBQUEsSUFBQSxVQUFBOzRCQUNBLE9BQUEsVUFBQTs7O29CQUdBLEVBQUEsUUFBQSxHQUFBLFdBQUEsZUFBQSxPQUFBLEtBQUEsYUFBQSxVQUFBLE1BQUE7d0JBQ0EsR0FBQSxTQUFBLEtBQUE7NEJBQ0EsU0FBQSxFQUFBLEtBQUEsVUFBQSxFQUFBLElBQUEsS0FBQTs0QkFDQSxPQUFBLEtBQUE7Ozt1QkFHQTtvQkFDQSxJQUFBLEtBQUEsY0FBQSxLQUFBLGVBQUEsSUFBQTt3QkFDQSxHQUFBLG1CQUFBLEtBQUE7O29CQUVBLEdBQUEsYUFBQTs7Z0JBRUEsR0FBQSxnQkFBQTs7OztRQUlBLElBQUEsaUJBQUEsVUFBQSxRQUFBO1lBQ0EsWUFBQSxRQUFBLFFBQUEsTUFBQSxVQUFBLE1BQUE7Z0JBQ0EsR0FBQSxPQUFBO2VBQ0EsUUFBQSxZQUFBO2dCQUNBLEdBQUEsVUFBQTs7OztRQUlBLElBQUEsYUFBQSxXQUFBO1lBQ0EsV0FBQSxlQUFBO1lBQ0EsZUFBQSxrQkFBQSxLQUFBLFVBQUEsTUFBQTtnQkFDQSxXQUFBLEtBQUE7Z0JBQ0EsZUFBQSxHQUFBO2dCQUNBOzs7O1FBSUE7Ozs7QUN4RkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSwyTkFBQSxTQUFBLFFBQUEsV0FBQSxVQUFBLFdBQUEsWUFBQSxhQUFBLG1CQUFBLGVBQUEsY0FBQSxhQUFBLGdCQUFBLGFBQUEsUUFBQSxRQUFBO1FBQ0EsSUFBQSxLQUFBOztRQUVBLEdBQUEsY0FBQSxhQUFBOztRQUVBLEdBQUEsZUFBQTtRQUNBLEdBQUEsVUFBQTtRQUNBLEdBQUEsZ0JBQUE7UUFDQSxHQUFBLFdBQUE7UUFDQSxHQUFBLGdCQUFBO1FBQ0EsR0FBQSxjQUFBLFlBQUE7UUFDQSxHQUFBLFlBQUEsT0FBQTtRQUNBLEdBQUEsYUFBQSxHQUFBLFlBQUEsV0FBQTtRQUNBLEdBQUEsV0FBQSxHQUFBLGFBQUEsV0FBQTtRQUNBLEdBQUEsYUFBQTtRQUNBLEdBQUEsYUFBQTtRQUNBLEdBQUEsb0JBQUEsVUFBQSxTQUFBLFNBQUE7O1FBRUEsT0FBQSxjQUFBOztRQUVBLElBQUEsV0FBQTtRQUNBLElBQUEsa0JBQUEsR0FBQSxZQUFBLFFBQUEsT0FBQTtRQUNBLElBQUEsV0FBQTs7UUFFQSxHQUFBLFVBQUE7WUFDQTtnQkFDQSxPQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxjQUFBOztZQUVBO2dCQUNBLE9BQUE7Z0JBQ0EsYUFBQTtnQkFDQSxPQUFBO2dCQUNBLGNBQUE7Z0JBQ0Esc0JBQUE7O1lBRUE7Z0JBQ0EsT0FBQTtnQkFDQSxhQUFBO2dCQUNBLGlCQUFBO2dCQUNBLGVBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxjQUFBO2dCQUNBLG9CQUFBOztZQUVBO2dCQUNBLE9BQUE7Z0JBQ0EsYUFBQTtnQkFDQSxpQkFBQTtnQkFDQSxlQUFBO2dCQUNBLGNBQUE7Ozs7UUFJQSxHQUFBLFlBQUEsYUFBQSxHQUFBOztRQUVBLEdBQUEsZUFBQSxVQUFBLFFBQUE7WUFDQSxHQUFBLGdCQUFBO1lBQ0EsSUFBQSxXQUFBLENBQUEsT0FBQTtZQUNBLGtCQUFBLFdBQUEsT0FBQSxJQUFBLEVBQUEsY0FBQSxJQUFBLFdBQUEsT0FBQSxXQUFBLFdBQUEsWUFBQSxLQUFBLFVBQUEsUUFBQTtnQkFDQSxJQUFBLE9BQUEsRUFBQSxLQUFBLEdBQUEsWUFBQSxNQUFBLEVBQUEsSUFBQSxPQUFBO2dCQUNBLE9BQUEsWUFBQSxPQUFBO2dCQUNBLElBQUEsT0FBQSxXQUFBO29CQUNBLE9BQUEsS0FBQSxLQUFBLFdBQUE7dUJBQ0E7b0JBQ0EsT0FBQSxLQUFBLEtBQUEsV0FBQTs7Ozs7UUFLQSxHQUFBLGFBQUEsVUFBQSxRQUFBO1lBQ0EsR0FBQSxnQkFBQTtZQUNBLGtCQUFBLFdBQUEsT0FBQSxJQUFBLEVBQUEsY0FBQSxNQUFBLFdBQUEsT0FBQSxXQUFBLE9BQUEsYUFBQSxLQUFBLFVBQUEsUUFBQTtnQkFDQSxJQUFBLE9BQUEsRUFBQSxLQUFBLEdBQUEsWUFBQSxNQUFBLEVBQUEsSUFBQSxPQUFBO2dCQUNBLE9BQUEsWUFBQSxPQUFBO2dCQUNBLE9BQUEsS0FBQSxLQUFBLFdBQUE7Ozs7UUFJQSxHQUFBLFlBQUEsVUFBQSxRQUFBO1lBQ0EsT0FBQSxjQUFBO1lBQ0EsR0FBQSxnQkFBQTs7WUFFQSxPQUFBLGVBQUEsVUFBQSxPQUFBO2dCQUNBLE9BQUEsY0FBQTs7O1lBR0EsSUFBQSxnQkFBQSxVQUFBLEtBQUE7Z0JBQ0EsV0FBQTtnQkFDQSxhQUFBO2dCQUNBLE9BQUE7OztZQUdBLGNBQUEsT0FBQSxLQUFBLFlBQUE7Z0JBQ0Esa0JBQUEsV0FBQSxPQUFBLElBQUEsRUFBQSxjQUFBLE9BQUEsYUFBQSxXQUFBLE1BQUEsV0FBQSxPQUFBLGFBQUEsS0FBQSxVQUFBLFFBQUE7b0JBQ0EsSUFBQSxPQUFBLEVBQUEsS0FBQSxHQUFBLFlBQUEsTUFBQSxFQUFBLElBQUEsT0FBQTtvQkFDQSxPQUFBLFlBQUEsT0FBQTtvQkFDQSxPQUFBLEtBQUEsS0FBQSxXQUFBOzs7OztRQUtBLEdBQUEsZ0JBQUEsWUFBQTtZQUNBLE9BQUE7WUFDQSxhQUFBLGVBQUEsR0FBQTtZQUNBLEdBQUEsVUFBQTtZQUNBOzs7UUFHQSxHQUFBLGdCQUFBLFlBQUE7WUFDQSxHQUFBLFlBQUEsYUFBQSxZQUFBLGdCQUFBLEdBQUEsU0FBQSxHQUFBOzs7UUFHQSxHQUFBLGtCQUFBLFVBQUEsU0FBQTtZQUNBLEdBQUEsWUFBQSxRQUFBLFFBQUEsU0FBQSxJQUFBLFVBQUE7WUFDQSxrQkFBQSxRQUFBLFNBQUE7WUFDQSxHQUFBOzs7UUFHQSxHQUFBLG1CQUFBLFlBQUE7WUFDQTs7O1FBR0EsR0FBQSxZQUFBLGdCQUFBLFVBQUEsU0FBQTs7WUFFQSxHQUFBLFVBQUE7WUFDQSxHQUFBLFFBQUEsVUFBQSxHQUFBLG9CQUFBLFFBQUEsVUFBQSxLQUFBO2dCQUNBLElBQUEsR0FBQSxlQUFBO29CQUNBLEdBQUEsZ0JBQUE7dUJBQ0E7b0JBQ0EsVUFBQSxPQUFBO29CQUNBLFVBQUEsS0FBQSxZQUFBLElBQUEsT0FBQTs7O1lBR0EsR0FBQSxRQUFBLEtBQUEsR0FBQSxZQUFBLFFBQUEsVUFBQSxNQUFBLGFBQUE7Z0JBQ0EsRUFBQSxRQUFBLEdBQUEsUUFBQSxLQUFBLFNBQUEsVUFBQSxLQUFBO29CQUNBLElBQUEsT0FBQSxPQUFBLElBQUE7O2dCQUVBLGFBQUEsZ0JBQUEsR0FBQSxRQUFBLEtBQUEsUUFBQTtnQkFDQSxJQUFBLFVBQUE7Z0JBQ0EsRUFBQSxRQUFBLGFBQUEsVUFBQSxLQUFBO29CQUNBLFFBQUEsS0FBQSxJQUFBLEtBQUEsY0FBQSxTQUFBLE1BQUEsSUFBQSxRQUFBLElBQUE7O2dCQUVBLEdBQUEsZ0JBQUE7Ozs7UUFJQSxJQUFBLGdCQUFBLFlBQUE7WUFDQSxJQUFBLGVBQUEsR0FBQSxhQUFBLFdBQUE7WUFDQSxJQUFBLGNBQUEsR0FBQSxhQUFBLGVBQUE7WUFDQSxHQUFBLFFBQUEsRUFBQSxPQUFBLFVBQUEsRUFBQSxXQUFBLEdBQUE7WUFDQSxHQUFBLGFBQUEsR0FBQSxNQUFBLFNBQUEsTUFBQSxlQUFBLGVBQUEsU0FBQSxTQUFBLEdBQUEsTUFBQSxVQUFBLE1BQUEsY0FBQTtZQUNBLEdBQUEsYUFBQSxFQUFBLE9BQUEsRUFBQSxLQUFBLEVBQUEsSUFBQSxHQUFBLE9BQUE7WUFDQSxJQUFBLG1CQUFBLEVBQUEsS0FBQSxHQUFBLFlBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxNQUFBLEdBQUE7WUFDQSxJQUFBLENBQUEsb0JBQUEsR0FBQSxzQkFBQSxPQUFBO2dCQUNBLEdBQUEsV0FBQSxLQUFBLEdBQUE7O1lBRUEsR0FBQSxXQUFBLFFBQUE7WUFDQSxJQUFBLFFBQUEsVUFBQSxTQUFBO1lBQ0EsSUFBQSxRQUFBLFVBQUEsU0FBQTtZQUNBLElBQUEsT0FBQTtnQkFDQSxJQUFBLFdBQUE7Z0JBQ0EsSUFBQSxlQUFBO2dCQUNBLEVBQUEsUUFBQSxPQUFBLFVBQUEsR0FBQTtvQkFDQSxTQUFBLEtBQUEsRUFBQSxXQUFBLEdBQUEsT0FBQSxFQUFBLEtBQUEsR0FBQSxLQUFBLE1BQUE7b0JBQ0EsYUFBQSxLQUFBLEVBQUEsV0FBQSxPQUFBLE9BQUEsU0FBQTs7Z0JBRUEsR0FBQSxRQUFBLEVBQUEsWUFBQSxHQUFBLE9BQUEsVUFBQTs7WUFFQSxFQUFBLFFBQUEsR0FBQSxPQUFBLFVBQUEsTUFBQTtnQkFDQSxLQUFBLGVBQUEsZUFBQTs7WUFFQSxJQUFBLGdCQUFBLEVBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxPQUFBO2dCQUNBLGdCQUFBLEVBQUEsT0FBQSxlQUFBLEVBQUEsT0FBQSxFQUFBLE9BQUE7O1lBRUEsR0FBQSxZQUFBLGFBQUEsY0FBQTtZQUNBLEdBQUEsWUFBQSxnQkFBQSxjQUFBO1lBQ0EsR0FBQSxZQUFBLDBCQUFBLGNBQUE7WUFDQSxHQUFBLFlBQUEsT0FBQTs7OztRQUlBLElBQUEsaUJBQUEsVUFBQSxRQUFBO1lBQ0EsSUFBQSxjQUFBO1lBQ0EsRUFBQSxRQUFBLE9BQUEsZUFBQSxRQUFBLGFBQUEsVUFBQSxTQUFBO2dCQUNBLFlBQUEsS0FBQTtvQkFDQSxTQUFBLEVBQUEsS0FBQSxVQUFBLEVBQUEsSUFBQSxRQUFBO29CQUNBLE9BQUEsUUFBQTs7O1lBR0EsT0FBQTs7O1FBR0EsSUFBQSxXQUFBLFlBQUE7WUFDQSxPQUFBO1lBQ0EsY0FBQSxVQUFBLE1BQUEsS0FBQSxNQUFBLE1BQUEsVUFBQSxNQUFBO2dCQUNBLElBQUEsS0FBQSxXQUFBO29CQUNBLEdBQUEsYUFBQTtvQkFDQSxXQUFBLEtBQUE7b0JBQ0E7dUJBQ0E7b0JBQ0EsSUFBQSxLQUFBLGNBQUEsS0FBQSxlQUFBLElBQUE7d0JBQ0EsR0FBQSxtQkFBQSxLQUFBOztvQkFFQSxHQUFBLGFBQUE7O2dCQUVBLEdBQUEsVUFBQTs7OztRQUlBLElBQUEsYUFBQSxZQUFBO1lBQ0EsZUFBQSxrQkFBQSxLQUFBLFVBQUEsTUFBQTtnQkFDQSxXQUFBLEtBQUE7Z0JBQ0E7O1lBRUEsR0FBQSxZQUFBLFFBQUEsR0FBQSxhQUFBLEdBQUEsc0JBQUEsUUFBQSxHQUFBLG9CQUFBLE9BQUE7WUFDQSxhQUFBLGVBQUEsR0FBQTtZQUNBLEdBQUE7WUFDQSxJQUFBLE9BQUEsWUFBQTtZQUNBLEdBQUEsV0FBQSxFQUFBLFFBQUEsS0FBQTtZQUNBLFdBQUEsZUFBQTs7O1FBR0E7O1FBRUEsT0FBQSxpQkFBQSxxQ0FBQSxVQUFBLFVBQUEsVUFBQTtZQUNBLElBQUEsUUFBQSxPQUFBLFVBQUEsV0FBQTtnQkFDQTs7WUFFQSxHQUFBLFVBQUE7WUFDQSxHQUFBOzs7UUFHQSxPQUFBLGlCQUFBLG9DQUFBLFVBQUEsVUFBQSxVQUFBO1lBQ0EsSUFBQSxRQUFBLE9BQUEsVUFBQSxXQUFBO2dCQUNBOztZQUVBLEdBQUEsY0FBQTtZQUNBLEdBQUE7OztRQUdBLE9BQUEsT0FBQSxpQkFBQSxVQUFBLFVBQUEsVUFBQTtZQUNBLElBQUEsUUFBQSxPQUFBLFVBQUEsV0FBQTtnQkFDQTs7WUFFQSxHQUFBLFlBQUEsU0FBQSxTQUFBO1lBQ0EsR0FBQSxZQUFBLFFBQUEsV0FBQSxHQUFBLHNCQUFBLFFBQUEsR0FBQSxvQkFBQSxPQUFBO1lBQ0EsR0FBQSxhQUFBO1lBQ0EsR0FBQSxXQUFBLFdBQUEsV0FBQTtZQUNBLGFBQUEsZUFBQSxHQUFBO1lBQ0E7OztRQUdBLE9BQUEsT0FBQSx3QkFBQSxVQUFBLFVBQUEsVUFBQTtZQUNBLElBQUEsUUFBQSxPQUFBLFVBQUEsV0FBQTtnQkFDQTs7WUFFQSxHQUFBLFlBQUEsUUFBQSxhQUFBLFFBQUEsV0FBQTtZQUNBO1lBQ0EsYUFBQSxlQUFBLEdBQUE7Ozs7O0FDMVFBLENBQUEsV0FBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsb0RBQUEsVUFBQSxZQUFBLFFBQUE7UUFDQSxJQUFBLEtBQUE7O1FBRUEsR0FBQSxRQUFBO1FBQ0EsR0FBQSxlQUFBO1FBQ0EsR0FBQSxhQUFBOztRQUVBLElBQUEsZ0JBQUEsWUFBQTtZQUNBLEdBQUEsYUFBQSxHQUFBLE1BQUE7WUFDQSxJQUFBLEdBQUEsYUFBQSxHQUFBO2dCQUNBLEdBQUEsZUFBQSxFQUFBLE1BQUEsRUFBQSxRQUFBLEdBQUEsT0FBQTs7Z0JBRUEsSUFBQSxZQUFBOztnQkFFQSxFQUFBLFFBQUEsR0FBQSxjQUFBLFVBQUEsT0FBQTtvQkFDQSxVQUFBLEtBQUE7d0JBQ0EsUUFBQSxNQUFBO3dCQUNBLE9BQUEsTUFBQSxHQUFBOzs7O2dCQUlBLEdBQUEsYUFBQTttQkFDQTtnQkFDQSxHQUFBLGFBQUE7Ozs7UUFJQSxPQUFBLE9BQUEsUUFBQSxVQUFBLFVBQUE7WUFDQSxJQUFBLFVBQUE7Z0JBQ0EsR0FBQSxRQUFBO2dCQUNBLEdBQUEsYUFBQSxTQUFBO2dCQUNBOzs7UUFHQSxVQUFBLGlCQUFBLFVBQUE7Ozs7U0FJQSxPQUFBO2FBQ0EsWUFBQTthQUNBLGNBQUE7YUFDQSxhQUFBO2FBQ0EsVUFBQTthQUNBLE9BQUE7aUJBQ0EsTUFBQTtpQkFDQSxpQkFBQTtpQkFDQSxTQUFBO2lCQUNBLFVBQUE7Ozs7OztBQ2xEQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLG9EQUFBLFVBQUEsUUFBQSxXQUFBO1FBQ0EsSUFBQSxLQUFBO1lBQ0EsV0FBQSxPQUFBLFlBQUE7O1FBRUEsR0FBQSxRQUFBO1FBQ0EsR0FBQSxRQUFBLE9BQUEsU0FBQTtRQUNBLEdBQUEsWUFBQTtZQUNBLE9BQUE7WUFDQSxRQUFBOzs7UUFHQSxHQUFBLGVBQUEsVUFBQSxNQUFBO1lBQ0EsUUFBQSxJQUFBO1lBQ0EsSUFBQSxDQUFBLEtBQUEsV0FBQTtnQkFDQSxPQUFBO21CQUNBO2dCQUNBLElBQUEsS0FBQSxLQUFBLFdBQUE7b0JBQ0EsT0FBQTt1QkFDQSxJQUFBLEtBQUEsS0FBQSxrQkFBQTtvQkFDQSxPQUFBOzs7WUFHQSxPQUFBOzs7UUFHQSxHQUFBLFdBQUEsVUFBQSxJQUFBO1lBQ0EsVUFBQSxLQUFBLFdBQUE7OztRQUdBLE9BQUEsT0FBQSxRQUFBLFVBQUEsVUFBQSxVQUFBO1lBQ0EsSUFBQSxRQUFBLE9BQUEsVUFBQSxXQUFBO2dCQUNBOztZQUVBLEVBQUEsUUFBQSxVQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLENBQUEsS0FBQSxXQUFBO29CQUNBLEtBQUEsUUFBQTt1QkFDQTtvQkFDQSxJQUFBLEtBQUEsS0FBQSxXQUFBO3dCQUNBLEtBQUEsUUFBQTsyQkFDQSxJQUFBLEtBQUEsS0FBQSxrQkFBQTt3QkFDQSxLQUFBLFFBQUE7MkJBQ0E7d0JBQ0EsS0FBQSxRQUFBOzs7O1lBSUEsR0FBQSxRQUFBOzs7O0FDakRBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFVBQUEscUJBQUEsWUFBQTtRQUNBLE9BQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTtZQUNBLGFBQUE7WUFDQSxVQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsVUFBQTs7Ozs7QUNaQSxDQUFBLFVBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLDBDQUFBLFVBQUEsZUFBQSxjQUFBO1FBQ0EsSUFBQSxPQUFBLFVBQUEsSUFBQSxVQUFBLGNBQUEsV0FBQSxXQUFBLFlBQUEsU0FBQSxlQUFBO1lBQ0EsS0FBQSxLQUFBO1lBQ0EsS0FBQSxXQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSxZQUFBO1lBQ0EsS0FBQSxZQUFBO1lBQ0EsS0FBQSxhQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxnQkFBQTs7OztRQUlBLEtBQUEsWUFBQTtZQUNBLFVBQUEsWUFBQTtnQkFDQSxPQUFBOztZQUVBLGFBQUEsWUFBQTtnQkFDQSxPQUFBLGFBQUEsa0JBQUEsS0FBQSxTQUFBLEtBQUE7O1lBRUEsYUFBQSxZQUFBOztnQkFFQSxPQUFBLEtBQUE7O1lBRUEsY0FBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQTs7WUFFQSxVQUFBLFlBQUE7Z0JBQ0EsT0FBQSxLQUFBOzs7OztRQUtBLEtBQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxLQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxRQUFBLFFBQUEsT0FBQTtnQkFDQSxPQUFBO3FCQUNBLElBQUEsS0FBQTs7WUFFQSxPQUFBLEtBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQzVEQSxDQUFBLFVBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLGlCQUFBLFVBQUE7UUFDQSxJQUFBLGdCQUFBLFVBQUEsT0FBQSxXQUFBLE1BQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLE9BQUE7Ozs7UUFJQSxjQUFBLFlBQUE7Ozs7Ozs7UUFPQSxjQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxjQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxRQUFBLFFBQUEsT0FBQTtnQkFDQSxPQUFBO3FCQUNBLElBQUEsY0FBQTtxQkFDQSxPQUFBOztZQUVBLE9BQUEsY0FBQSxNQUFBOzs7UUFHQSxPQUFBOzs7O0FDdENBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsOEZBQUEsVUFBQSxPQUFBLElBQUEsV0FBQSxhQUFBLE1BQUEsUUFBQSxlQUFBO1FBQ0EsSUFBQSxpQkFBQSxVQUFBLE9BQUEsUUFBQTtZQUNBLE9BQUE7Z0JBQ0EsT0FBQTtnQkFDQSxRQUFBOzs7O1FBSUEsT0FBQTtZQUNBLFVBQUEsVUFBQSxRQUFBO2dCQUNBLFNBQUEsVUFBQTs7Z0JBRUEsSUFBQSxnQkFBQSxVQUFBLFlBQUEsYUFBQSxXQUFBLFVBQUE7b0JBQ0EsY0FBQSxjQUFBLFVBQUEsZUFBQSxZQUFBLGNBQUE7O2dCQUVBLE9BQUEsWUFBQSxRQUFBLEtBQUEsTUFBQSxNQUFBLFVBQUEsTUFBQTtvQkFDQSxJQUFBLEtBQUEsV0FBQTt3QkFDQSxLQUFBLFVBQUEsS0FBQSxZQUFBLEtBQUE7MkJBQ0E7d0JBQ0EsWUFBQTs7b0JBRUEsT0FBQTs7O1lBR0EsY0FBQSxVQUFBLFFBQUE7Z0JBQ0EsU0FBQSxVQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUEsT0FBQSxNQUFBLE9BQUEsTUFBQSxZQUFBLGFBQUEsV0FBQTtvQkFDQSxRQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsSUFBQSxhQUFBLEtBQUEsWUFBQSxLQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLEVBQUE7O1lBRUEsU0FBQSxVQUFBLFNBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsTUFBQSxJQUFBLFlBQUEsYUFBQSxXQUFBLFdBQUEsVUFBQSxLQUFBLFFBQUEsVUFBQSxNQUFBO29CQUNBLElBQUEsYUFBQSxLQUFBLFlBQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLGFBQUEsVUFBQSxTQUFBLE9BQUE7Z0JBQ0EsSUFBQSxPQUFBO29CQUNBLE9BQUE7O2dCQUVBLFFBQUEsU0FBQTs7Z0JBRUEsT0FBQSxLQUFBLFdBQUEsS0FBQSxVQUFBLE9BQUE7b0JBQ0EsS0FBQSxRQUFBO29CQUNBLE9BQUEsS0FBQSxjQUFBLE9BQUEsS0FBQSxVQUFBLE9BQUE7d0JBQ0EsS0FBQSxRQUFBO3dCQUNBLE9BQUE7Ozs7Ozs7OztBQ2hFQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLDREQUFBLFVBQUEsT0FBQSxJQUFBLGFBQUEsTUFBQTtRQUNBLElBQUEsb0JBQUEsVUFBQSxjQUFBLFdBQUEsV0FBQTtZQUNBLE9BQUE7Z0JBQ0EsY0FBQTtnQkFDQSxXQUFBO2dCQUNBLFdBQUE7Ozs7UUFJQSxPQUFBO1lBQ0EsWUFBQSxVQUFBLElBQUEsTUFBQTtnQkFDQSxPQUFBLFFBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7O2dCQUVBLE1BQUE7b0JBQ0EsS0FBQSxZQUFBLGFBQUEsV0FBQSxXQUFBLEtBQUE7b0JBQ0EsUUFBQTtvQkFDQSxNQUFBO21CQUNBLFFBQUEsVUFBQSxRQUFBO29CQUNBLEVBQUEsUUFBQSxLQUFBLFlBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOzs7Z0JBR0EsT0FBQSxFQUFBOzs7Ozs7QUMzQkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSx5TUFBQSxTQUFBLFlBQUEsUUFBQSxZQUFBLGFBQUEsWUFBQSxnQkFBQSxlQUFBLGNBQUEsYUFBQSxjQUFBLGtCQUFBLGFBQUE7UUFDQSxJQUFBLEtBQUE7O1FBRUEsR0FBQSxPQUFBLElBQUE7UUFDQSxHQUFBLFdBQUE7UUFDQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxvQkFBQTtRQUNBLEdBQUEsV0FBQTtRQUNBLEdBQUEsUUFBQTtRQUNBLEdBQUEsa0JBQUE7UUFDQSxHQUFBLHdCQUFBO1FBQ0EsR0FBQSxZQUFBO1FBQ0EsR0FBQSxVQUFBO1lBQ0EsTUFBQTtZQUNBLFFBQUE7O1FBRUEsR0FBQSxvQkFBQTtRQUNBLEdBQUEsU0FBQTtRQUNBLEdBQUEsY0FBQTtRQUNBLEdBQUEsZ0JBQUE7UUFDQSxHQUFBLGVBQUE7UUFDQSxHQUFBLG9CQUFBO1FBQ0EsR0FBQSxrQkFBQTtRQUNBLEdBQUEsdUJBQUE7UUFDQSxHQUFBLFVBQUE7UUFDQSxHQUFBLFdBQUE7UUFDQSxHQUFBLG9CQUFBO1FBQ0EsR0FBQSxPQUFBLFlBQUE7UUFDQSxHQUFBLDBCQUFBLEdBQUEsT0FBQSxHQUFBLEtBQUEsV0FBQSx1QkFBQSxjQUFBO1FBQ0EsR0FBQSxvQkFBQTs7UUFFQSxHQUFBLGtCQUFBLFlBQUE7WUFDQSxHQUFBLG9CQUFBLENBQUEsR0FBQTtZQUNBLElBQUEsZ0JBQUE7Z0JBQ0EsV0FBQSxHQUFBOztZQUVBLGlCQUFBLGdCQUFBLGVBQUEsS0FBQSxVQUFBLE1BQUE7Z0JBQ0EsR0FBQSxrQkFBQSxLQUFBLFlBQUEsV0FBQTtnQkFDQSxHQUFBLHVCQUFBLEtBQUEsWUFBQSxrQkFBQTtnQkFDQSxHQUFBLG9CQUFBLEtBQUEsWUFBQSxZQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBOzs7O1FBSUEsSUFBQSxhQUFBLFlBQUE7WUFDQSxPQUFBLFdBQUEsY0FBQSxHQUFBOzs7UUFHQSxJQUFBLGNBQUEsWUFBQTtZQUNBLGVBQUEsY0FBQSxLQUFBLE1BQUEsTUFBQSxVQUFBLE1BQUE7Z0JBQ0EsSUFBQSxLQUFBLFdBQUE7b0JBQ0EsR0FBQSxXQUFBO29CQUNBLEdBQUEsUUFBQSxPQUFBLEtBQUE7b0JBQ0E7dUJBQ0E7b0JBQ0EsSUFBQSxLQUFBLGNBQUEsS0FBQSxlQUFBLElBQUE7d0JBQ0EsR0FBQSxpQkFBQSxLQUFBOztvQkFFQSxHQUFBLFdBQUE7O2dCQUVBLEdBQUEsY0FBQTs7OztRQUlBLElBQUEsWUFBQSxZQUFBO1lBQ0EsSUFBQSxXQUFBLGFBQUEsWUFBQSxPQUFBLE9BQUEsR0FBQSxLQUFBO2dCQUNBLFdBQUEsYUFBQSxZQUFBLFVBQUEsVUFBQSxHQUFBLEtBQUE7Z0JBQ0EsWUFBQSxhQUFBLFlBQUEsUUFBQSxRQUFBLEdBQUEsS0FBQTs7WUFFQSxjQUFBLFlBQUEsS0FBQSxNQUFBLE1BQUEsVUFBQSxRQUFBO2dCQUNBLElBQUEsT0FBQSxXQUFBO29CQUNBLEdBQUEsY0FBQTtvQkFDQSxHQUFBLFNBQUE7b0JBQ0EsU0FBQSxPQUFBLE9BQUE7b0JBQ0EsU0FBQSxPQUFBLE9BQUE7b0JBQ0EsVUFBQSxPQUFBLE9BQUE7b0JBQ0EsR0FBQSxlQUFBLE9BQUEsT0FBQSxZQUFBLHFCQUFBO29CQUNBLEdBQUEsb0JBQUEsT0FBQSxPQUFBLFlBQUEsa0JBQUE7b0JBQ0EsSUFBQSxPQUFBLFVBQUEsV0FBQTt3QkFDQSxHQUFBLGtCQUFBLE9BQUEsVUFBQSxZQUFBLHdCQUFBO3dCQUNBLEdBQUEsdUJBQUEsT0FBQSxVQUFBLFlBQUEsa0JBQUE7d0JBQ0EsR0FBQSxvQkFBQSxPQUFBLFVBQUE7d0JBQ0EsR0FBQSxvQkFBQSxPQUFBLFVBQUEsWUFBQSxZQUFBOzJCQUNBO3dCQUNBLEdBQUEsa0JBQUEsT0FBQSxVQUFBLFlBQUEsaUNBQUE7d0JBQ0EsR0FBQSx1QkFBQTt3QkFDQSxHQUFBLG9CQUFBLE9BQUEsVUFBQTt3QkFDQSxHQUFBLG9CQUFBLE9BQUEsVUFBQSxZQUFBLFlBQUE7O29CQUVBLElBQUEsT0FBQSxVQUFBLFVBQUEsT0FBQSxPQUFBLFVBQUEsTUFBQSxLQUFBO3dCQUNBLEdBQUEsVUFBQSxhQUFBLHlCQUFBLE9BQUEsVUFBQSxVQUFBLE9BQUEsUUFBQSxhQUFBLHlCQUFBLE9BQUEsVUFBQSxNQUFBOztvQkFFQSxJQUFBLE9BQUEsVUFBQSxVQUFBLFFBQUEsT0FBQSxVQUFBLE1BQUEsTUFBQTt3QkFDQSxHQUFBLFdBQUEsYUFBQSx5QkFBQSxPQUFBLFVBQUEsVUFBQSxRQUFBLFFBQUEsYUFBQSx5QkFBQSxPQUFBLFVBQUEsTUFBQTs7dUJBRUE7b0JBQ0EsR0FBQSxjQUFBLE9BQUEsY0FBQSxPQUFBLGVBQUEsS0FBQSxPQUFBLGFBQUE7b0JBQ0EsU0FBQSxPQUFBLENBQUE7b0JBQ0EsU0FBQSxPQUFBLENBQUE7b0JBQ0EsVUFBQSxPQUFBLENBQUE7b0JBQ0EsR0FBQSxlQUFBO29CQUNBLEdBQUEsb0JBQUE7b0JBQ0EsR0FBQSwwQkFBQTtvQkFDQSxHQUFBLGtCQUFBO29CQUNBLEdBQUEsdUJBQUE7O2dCQUVBLEdBQUEsZ0JBQUE7Ozs7UUFJQSxJQUFBLGdCQUFBLFlBQUE7WUFDQSxjQUFBLFVBQUEsTUFBQSxLQUFBLE1BQUEsTUFBQSxVQUFBLE1BQUE7Z0JBQ0EsSUFBQSxLQUFBLFdBQUE7b0JBQ0EsR0FBQSxrQkFBQTtvQkFDQSxHQUFBLFFBQUEsRUFBQSxPQUFBLEtBQUEsT0FBQSxFQUFBLFdBQUE7dUJBQ0E7b0JBQ0EsSUFBQSxLQUFBLGNBQUEsS0FBQSxlQUFBLElBQUE7d0JBQ0EsR0FBQSx3QkFBQSxLQUFBOztvQkFFQSxHQUFBLGtCQUFBOztnQkFFQSxHQUFBLG9CQUFBOzs7O1FBSUEsV0FBQSxJQUFBLGlCQUFBLFVBQUEsT0FBQSxNQUFBO1lBQ0EsR0FBQSxRQUFBLFNBQUE7WUFDQTs7O1FBR0EsSUFBQSxhQUFBLFlBQUE7WUFDQTtZQUNBO1lBQ0E7WUFDQSxXQUFBLGVBQUE7OztRQUdBOzs7O0FDOUlBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsK0pBQUEsVUFBQSxZQUFBLFFBQUEsV0FBQSxjQUFBLFlBQUEsZUFBQSxhQUFBLGVBQUEsYUFBQTs7UUFFQSxJQUFBLEtBQUE7O1FBRUEsR0FBQSxTQUFBO1FBQ0EsR0FBQSxXQUFBLGFBQUE7UUFDQSxHQUFBLGNBQUEsWUFBQSxZQUFBO1FBQ0EsY0FBQSxlQUFBO1FBQ0EsR0FBQSxzQkFBQTtRQUNBLEdBQUEsWUFBQTtRQUNBLEdBQUEsbUJBQUE7O1FBRUEsR0FBQSxrQkFBQSxVQUFBLFVBQUE7WUFDQSxHQUFBLHNCQUFBO1lBQ0EsY0FBQSxpQkFBQSxVQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLEdBQUEsU0FBQTtnQkFDQSxjQUFBLG9CQUFBLEtBQUEsWUFBQSxJQUFBLEtBQUEsU0FBQSxXQUFBO29CQUNBLEdBQUEsYUFBQTttQkFDQSxNQUFBLFNBQUEsTUFBQTttQkFDQSxRQUFBLElBQUE7O2VBRUEsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBO2VBQ0EsUUFBQSxZQUFBO2dCQUNBLEdBQUEsc0JBQUE7Ozs7UUFJQSxHQUFBLGFBQUEsWUFBQTtZQUNBLFdBQUEsZUFBQTtZQUNBLEdBQUEsZ0JBQUEsR0FBQTs7Ozs7UUFLQSxHQUFBLFlBQUEsVUFBQSxLQUFBO1lBQ0EsRUFBQSxNQUFBLEdBQUEsV0FBQTtZQUNBLEdBQUEsWUFBQTtZQUNBLEVBQUEsTUFBQSxHQUFBLFdBQUE7OztRQUdBLEdBQUE7Ozs7QUM1Q0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSxxUEFBQSxVQUFBLFlBQUEsUUFBQSxjQUFBLFdBQUEsV0FBQSxTQUFBLGNBQUEsWUFBQSxlQUFBLGVBQUEsZ0JBQUEsYUFBQSxZQUFBLGFBQUEsY0FBQTtRQUNBLElBQUEsS0FBQTs7UUFFQSxHQUFBLFVBQUE7UUFDQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxnQkFBQTtRQUNBLEdBQUEsd0JBQUEsU0FBQSxhQUFBO1FBQ0EsR0FBQSxtQkFBQTtRQUNBLEdBQUEsYUFBQTtRQUNBLEdBQUEsT0FBQSxJQUFBO1FBQ0EsR0FBQSxVQUFBO1FBQ0EsR0FBQSxPQUFBO1FBQ0EsR0FBQSxhQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxhQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxlQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxnQkFBQTtRQUNBLEdBQUEsbUJBQUE7UUFDQSxHQUFBLGVBQUE7UUFDQSxHQUFBLGNBQUE7UUFDQSxHQUFBLGNBQUE7UUFDQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxtQkFBQTtRQUNBLEdBQUEsT0FBQSxZQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxtQkFBQTs7UUFFQSxHQUFBLGNBQUEsWUFBQSxZQUFBO1FBQ0EsY0FBQSxlQUFBOztRQUVBLElBQUEsYUFBQSxZQUFBO1lBQ0EsV0FBQSxlQUFBO1lBQ0E7OztRQUdBLElBQUEsaUJBQUEsWUFBQTtZQUNBLGNBQUEsaUJBQUEsS0FBQSxVQUFBLE1BQUE7Z0JBQ0EsR0FBQSxjQUFBLEtBQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUE7b0JBQ0EsSUFBQSxJQUFBO3dCQUNBLFFBQUE7d0JBQ0E7b0JBQ0EsT0FBQSxPQUFBLGFBQUEsSUFBQSxJQUFBLEtBQUE7d0JBQ0EsTUFBQSxRQUFBLGFBQUEsUUFBQTs7b0JBRUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxRQUFBLFVBQUEsR0FBQTt3QkFDQSxJQUFBLEVBQUEsU0FBQSxFQUFBLElBQUEsZUFBQTs0QkFDQSxJQUFBLE9BQUEsS0FBQSxNQUFBLEVBQUE7NEJBQ0EsR0FBQSxpQkFBQSxLQUFBOzRCQUNBLEdBQUEsWUFBQSxLQUFBOzs7O2dCQUlBLEdBQUEsZ0JBQUEsRUFBQSxNQUFBLE1BQUE7Z0JBQ0EsR0FBQSxxQkFBQSxHQUFBO2dCQUNBLFFBQUEsT0FBQTtxQkFDQSxJQUFBO3dCQUNBLE9BQUE7d0JBQ0EsYUFBQTt3QkFDQSxVQUFBLFlBQUE7NEJBQ0EsSUFBQSxHQUFBLGtCQUFBO2dDQUNBLElBQUEsTUFBQSxFQUFBLFFBQUEsR0FBQSxlQUFBLEdBQUEsaUJBQUE7Z0NBQ0EsSUFBQSxNQUFBLEdBQUE7b0NBQ0EsR0FBQSxlQUFBLEdBQUEsY0FBQSxNQUFBOzs7O3VCQUlBLElBQUE7d0JBQ0EsT0FBQTt3QkFDQSxhQUFBO3dCQUNBLFVBQUEsWUFBQTs0QkFDQSxJQUFBLEdBQUEsa0JBQUE7Z0NBQ0EsSUFBQSxNQUFBLEVBQUEsUUFBQSxHQUFBLGVBQUEsR0FBQSxpQkFBQTtnQ0FDQSxJQUFBLE9BQUEsR0FBQSxjQUFBLFNBQUEsSUFBQTtvQ0FDQSxHQUFBLGVBQUEsR0FBQSxjQUFBLE1BQUE7Ozs7O2VBS0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBO2VBQ0EsUUFBQSxZQUFBO2dCQUNBLElBQUEsR0FBQSxTQUFBO29CQUNBLEdBQUEsVUFBQTs7Ozs7UUFLQSxHQUFBLHdCQUFBLFlBQUE7WUFDQSxFQUFBLFFBQUEsR0FBQSxrQkFBQSxVQUFBLE1BQUE7Z0JBQ0EsYUFBQSxXQUFBLGVBQUEsS0FBQTs7WUFFQSxVQUFBLEtBQUE7OztRQUdBLEdBQUEsZ0JBQUEsVUFBQTtZQUNBLFVBQUEsS0FBQTs7O1FBR0EsR0FBQSx1QkFBQSxVQUFBLGNBQUE7WUFDQSxJQUFBLGVBQUEsR0FBQTtnQkFDQSxjQUFBLG9CQUFBLGNBQUEsS0FBQSxVQUFBLE1BQUE7b0JBQ0EsR0FBQSxtQkFBQTs7bUJBRUEsSUFBQSxpQkFBQSxHQUFBO2dCQUNBLEdBQUEsbUJBQUEsSUFBQTs7OztRQUlBLEdBQUEsaUJBQUEsVUFBQSxJQUFBO1lBQ0EsSUFBQSxHQUFBLG9CQUFBLEdBQUEsaUJBQUEsVUFBQTtnQkFDQSxzQkFBQSxLQUFBLFlBQUE7O29CQUVBLFVBQUEsS0FBQSxvQkFBQTttQkFDQSxZQUFBOzs7O21CQUlBO2dCQUNBLFVBQUEsS0FBQSxvQkFBQTs7OztRQUlBLElBQUEsc0JBQUEsWUFBQTtZQUNBLElBQUEsZ0JBQUEsVUFBQSxLQUFBO2dCQUNBLFdBQUEsR0FBQTtnQkFDQSxhQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsTUFBQTs7O1lBR0EsT0FBQSxjQUFBOzs7UUFHQSxHQUFBLGVBQUEsVUFBQSxnQkFBQTtZQUNBLElBQUEsT0FBQSxtQkFBQSxhQUFBO2dCQUNBLEdBQUEsaUJBQUE7bUJBQ0E7Z0JBQ0EsR0FBQSxpQkFBQSxDQUFBLEdBQUE7O1lBRUEsR0FBQSxjQUFBLEdBQUEsaUJBQUEsdUJBQUE7WUFDQSxHQUFBLGNBQUEsR0FBQSxpQkFBQSxjQUFBO1lBQ0EsR0FBQSxtQkFBQSxHQUFBLGlCQUFBLHdCQUFBOzs7UUFHQSxXQUFBLElBQUEsY0FBQSxVQUFBLE9BQUEsTUFBQTtZQUNBLEdBQUEsYUFBQSxTQUFBOzs7UUFHQTs7UUFFQSxXQUFBLElBQUEsa0JBQUEsWUFBQTtZQUNBLEdBQUEsbUJBQUE7WUFDQSxHQUFBLGVBQUE7OztRQUdBLFFBQUEsUUFBQSxVQUFBLE1BQUEsWUFBQTs7WUFFQSxJQUFBLFdBQUEsYUFBQTtnQkFDQSxTQUFBLFlBQUE7Z0JBQ0EscUJBQUEsU0FBQSxTQUFBOztZQUVBLEdBQUEsaUJBQUEsYUFBQSxxQkFBQSxxQkFBQSxxQkFBQTs7OztBQ3hLQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLHFLQUFBLFVBQUEsUUFBQSxXQUFBLGFBQUEsY0FBQSxjQUFBLGVBQUEsWUFBQSxlQUFBLGFBQUEsUUFBQTtRQUNBLGNBQUEsZUFBQTs7UUFFQSxJQUFBLEtBQUE7WUFDQSxvQkFBQSxFQUFBLE1BQUEsWUFBQSxPQUFBLFlBQUEsU0FBQSxJQUFBLElBQUE7O1FBRUEsR0FBQSxnQkFBQSxhQUFBOztRQUVBLEdBQUEsZUFBQTtRQUNBLEdBQUEsVUFBQTtRQUNBLEdBQUEsbUJBQUEsQ0FBQTtRQUNBLEdBQUEscUJBQUEsR0FBQSxjQUFBLFVBQUEsR0FBQSxjQUFBLFVBQUE7UUFDQSxHQUFBLGNBQUEsWUFBQSxZQUFBO1FBQ0EsR0FBQSxvQkFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLFNBQUE7UUFDQSxHQUFBLHlCQUFBO1lBQ0EsUUFBQTs7UUFFQSxHQUFBLDZCQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxHQUFBLHVCQUFBLFNBQUE7O1FBRUEsR0FBQSxtQkFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLE9BQUE7UUFDQSxHQUFBLHdCQUFBO1lBQ0EsUUFBQTs7UUFFQSxHQUFBLDRCQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxHQUFBLHNCQUFBLFNBQUE7O1FBRUEsR0FBQSxtQkFBQTtZQUNBLFVBQUE7O1FBRUEsR0FBQSxjQUFBLFlBQUE7UUFDQSxHQUFBLFlBQUEsd0JBQUEsR0FBQSxjQUFBLFFBQUE7UUFDQSxHQUFBLFlBQUEscUJBQUEsR0FBQSxjQUFBLGFBQUEsR0FBQSxZQUFBO1FBQ0EsR0FBQSxZQUFBLE9BQUE7O1FBRUEsSUFBQSx1QkFBQSxHQUFBLGNBQUEsVUFBQSxPQUFBO1lBQ0Esa0JBQUEsR0FBQSxjQUFBLFFBQUEsT0FBQTs7UUFFQSxHQUFBLFVBQUE7WUFDQTtnQkFDQSxPQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxzQkFBQTs7WUFFQTtnQkFDQSxPQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsY0FBQTs7WUFFQTtnQkFDQSxPQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsY0FBQTs7WUFFQTtnQkFDQSxPQUFBO2dCQUNBLGlCQUFBO2dCQUNBLGVBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxjQUFBOztZQUVBO2dCQUNBLE9BQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsZUFBQTtnQkFDQSxjQUFBOzs7O1FBSUEsR0FBQSxhQUFBLFlBQUE7WUFDQSxjQUFBLFdBQUEsR0FBQSxlQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLEdBQUEsWUFBQSxnQkFBQSxLQUFBLFFBQUE7Z0JBQ0EsR0FBQSxZQUFBLDBCQUFBLEtBQUEsUUFBQTtnQkFD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QUFBLG9CQUFBO1lBQ0EsR0FBQSx5QkFBQTtZQUNBO1lBQ0EsR0FBQTs7O1FBR0EsR0FBQSxzQkFBQSxZQUFBO1lBQ0EsSUFBQSxHQUFBLGFBQUEsaUJBQUE7Z0JBQ0EsR0FBQSxXQUFBO2dCQUNBLEdBQUEscUJBQUE7Z0JBQ0EsY0FBQSxHQUFBLFlBQUEsTUFBQSxRQUFBLDRCQUFBOzttQkFFQTtnQkFDQSxRQUFBLElBQUE7Z0JBQ0EsR0FBQSxXQUFBO2dCQUNBLEdBQUEscUJBQUE7Z0JBQ0EsY0FBQSxHQUFBLFlBQUEsTUFBQSxRQUFBLDRCQUFBOzs7OztRQUtBLEdBQUEsaUJBQUEsVUFBQSxVQUFBO1lBQ0EsSUFBQSxHQUFBLGFBQUEsWUFBQTtnQkFDQSxHQUFBLFdBQUE7Z0JBQ0EsY0FBQSxHQUFBLFlBQUEsTUFBQSxRQUFBLDRCQUFBOzttQkFFQTtnQkFDQSxHQUFBLG1CQUFBO2dCQUNBLFFBQUEsSUFBQTtnQkFDQSxHQUFBLFdBQUE7Z0JBQ0EsY0FBQSxHQUFBLFlBQUEsTUFBQSxRQUFBLDRCQUFBOzs7OztRQUtBLEdBQUEsa0JBQUEsVUFBQSxXQUFBO1lBQ0EsSUFBQSxHQUFBLGFBQUEsYUFBQTtnQkFDQSxHQUFBLFdBQUE7Z0JBQ0EsY0FBQSxHQUFBLFlBQUEsTUFBQSxRQUFBLDRCQUFBOzttQkFFQTtnQkFDQSxHQUFBLG9CQUFBO2dCQUNBLFFBQUEsSUFBQTtnQkFDQSxHQUFBLFdBQUE7Z0JBQ0EsY0FBQSxHQUFBLFlBQUEsTUFBQSxRQUFBLDRCQUFBOzs7OztRQUtBLEdBQUEsbUJBQUEsVUFBQSxTQUFBO1lBQ0EsSUFBQSxjQUFBLEVBQUEsT0FBQSxHQUFBLFlBQUEsY0FBQSxVQUFBLEtBQUE7Z0JBQ0EsT0FBQSxJQUFBLFNBQUE7O1lBRUEsUUFBQSxJQUFBLGFBQUEsWUFBQSxTQUFBO1lBQ0E7WUFDQSxHQUFBOzs7UUFHQSxHQUFBLHFCQUFBLFVBQUEsU0FBQSxXQUFBO1lBQ0EsS0FBQSxZQUFBLFdBQUE7O2dCQUVBLElBQUEsTUFBQSxFQUFBLE9BQUEsR0FBQSxZQUFBLGVBQUEsRUFB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QUEsUUFBQSxTQUFBLElBQUEsTUFBQSxTQUFBLFFBQUEsTUFBQTtnQkFDQSxJQUFBLFNBQUEsU0FBQSxJQUFBLE1BQUEsVUFBQSxRQUFBLE1BQUE7O2dCQUVBLE1BQUEsS0FBQSxhQUFBLGVBQUEsUUFBQSxJQUFBLE1BQUEsU0FBQSxJQUFBLHdCQUFBLENBQUEsSUFBQSxNQUFBLENBQUEsSUFBQTs7OztnQkFJQSxRQUFBLElBQUE7OztZQUdBLE1BQUEsR0FBQSxPQUFBO1lBQ0EsUUFBQSxJQUFBLE9BQUE7O1lBRUEsT0FBQSxHQUFBLFNBQUEsT0FBQSxHQUFBLFFBQUEsWUFBQTtnQkFDQSxZQUFBLEdBQUEsTUFBQTtnQkFDQSxNQUFBLEtBQUEsYUFBQSxlQUFBLEdBQUEsTUFBQSxZQUFBO2tCQUNBLFdBQUEsWUFBQTs7WUFFQSxJQUFBLEtBQUE7O1lBRUEsU0FBQSxJQUFBLFFBQUE7OztZQUdBLFFBQUEsSUFBQSxRQUFBLFNBQUE7WUFDQSxNQUFBLFNBQUE7Z0JBQ0EsU0FBQTtnQkFDQSxTQUFBO2dCQUNBLFNBQUE7Z0JBQ0EsU0FBQTtnQkFDQSxTQUFBOzs7O1FBSUEsWUFBQSxZQUFBOztZQUVBLE9BQUEsWUFBQSxVQUFBLE1BQUE7Z0JBQ0EsSUFBQSxRQUFBLFFBQUEsUUFBQSxTQUFBLGVBQUEsaUJBQUE7Z0JBQ0EsTUFBQSxPQUFBLFlBQUE7b0JBQ0EsTUFBQSxHQUFBLFVBQUE7Ozs7WUFJQSxPQUFBLFdBQUEsVUFBQSxTQUFBLFdBQUE7Z0JBQ0EsRUFBQSxNQUFBLFNBQUEsUUFBQTtnQkFDQSxJQUFBLFFBQUEsUUFBQSxRQUFBLFNBQUEsZUFBQSxpQkFBQTtnQkFDQSxNQUFBLE9BQUEsWUFBQTtvQkFDQSxNQUFBLEdBQUEsU0FBQSxTQUFBOzs7O1lBSUEsT0FBQSxzQkFBQSxVQUFBLGlCQUFBO2dCQUNBLEVBQUEsVUFBQSxRQUFBO2dCQUNBLElBQUEsUUFBQSxRQUFBLFFBQUEsU0FBQSxlQUFBLGlCQUFBO2dCQUNBLE1BQUEsT0FBQSxZQUFBO29CQUNBLE1BQUEsR0FBQSxvQkFBQTs7OztZQUlBLE9BQUEsWUFBQSxVQUFBLFNBQUEsVUFBQTtnQkFDQSxFQUFBLE1BQUEsU0FBQSxRQUFBO2dCQUNBLElBQUEsUUFBQSxRQUFBLFFBQUEsU0FBQSxlQUFBLGlCQUFBO2dCQUNBLE1BQUEsT0FBQSxZQUFBO29CQUNBLE1BQUEsR0FBQSxVQUFBLFNBQUE7Ozs7WUFJQSxJQUFBLE9BQUEsUUFBQTtnQkFDQSxHQUFBLG1CQUFBLE9BQUEsT0FBQSxnQkFBQSxPQUFBLFNBQUEsT0FBQSxJQUFBLE9BQUEsT0FBQSxlQUFBLEtBQUEsT0FBQSxRQUFBLFNBQUEsUUFBQTs7O1lBR0EsSUFBQSxPQUFBO1lBQ0EsSUFBQSxPQUFBLFdBQUEsWUFBQTtnQkFDQSxPQUFBLE9BQUEsV0FBQSxXQUFBOztZQUVBLElBQUEsY0FBQTs7WUFFQSxLQUFBLElBQUEsT0FBQSxNQUFBO2dCQUNBLElBQUEsTUFBQSxLQUFBOztnQkFFQSxJQUFBLElBQUEsaUJBQUEsYUFBQSxJQUFBLGFBQUEsU0FBQSxHQUFBO29CQUNBLElBQUEsV0FBQTs7Z0JBRUEsSUFBQSxZQUFBLDBCQUFBOztnQkFFQSxJQUFBLE9BQUE7O2dCQUVBLElBQUEsY0FBQSxZQUFBO29CQUNBLFFBQUE7OztnQkFHQSxRQUFBO2dCQUNBLElBQUEsSUFBQSxVQUFBOztvQkFFQSxRQUFBLGNBQUEsSUFBQSxPQUFBLHFDQUFBLElBQUEsT0FBQSw2QkFBQSxJQUFBLFNBQUEsWUFBQSxNQUFBLElBQUEsT0FBQTs7Ozs7Ozs7Z0JBUUEsUUFBQTs7Z0JBRUEsUUFBQTtnQkFDQSxNQUFBLFFBQUEsSUFBQSxNQUFBO29CQUNBLFdBQUE7b0JBQ0EsT0FBQTtvQkFDQSxJQUFBO29CQUNBLElBQUE7b0JBQ0EsU0FBQTtvQkFDQSxPQUFBOzs7Z0JBR0EsS0FBQSxJQUFBLEtBQUEsSUFBQSxjQUFBO29CQUNBLElBQUEsTUFBQSxJQUFBLGFBQUE7O29CQUVBLElBQUEsSUFBQSxNQUFBO3dCQUNBLE1BQUEsUUFBQSxJQUFBLE1BQUEsSUFBQSxNQUFBOzs7NEJBR0EsT0FBQTs7O3dCQUdBLElBQUEsWUFBQSxJQUFBLE9BQUE7NEJBQ0EsWUFBQSxJQUFBLFNBQUE7K0JBQ0E7NEJBQ0EsWUFBQSxJQUFBLFFBQUE7Ozs7Ozs7WUFPQSxNQUFBLFFBQUEsU0FBQTtnQkFDQSxXQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsSUFBQTtnQkFDQSxJQUFBO2dCQUNBLFNBQUE7O1lBRUEsV0FBQTtnQkFDQSxNQUFBO2dCQUNBLFVBQUE7b0JBQ0EsT0FBQTs7Z0JBRUEsWUFBQSxPQUFBLFdBQUE7O1lBRUEsSUFBQSxTQUFBLEVBQUEsT0FBQSxNQUFBLFlBQUE7WUFDQSxLQUFBLElBQUEsS0FBQSxRQUFBO2dCQUNBLE1BQUEsUUFBQSxTQUFBLE9BQUEsR0FBQSxNQUFBO29CQUNBLE9BQUE7Ozs7O1lBS0EsTUFBQSxRQUFBLE9BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxPQUFBO2dCQUNBLElBQUE7Z0JBQ0EsSUFBQTtnQkFDQSxTQUFBOztZQUVBLElBQUEsWUFBQSxFQUFBLE9BQUEsTUFBQSxVQUFBLEtBQUE7Z0JBQ0EsT0FBQSxDQUFBLFlBQUEsSUFBQTs7WUFFQSxLQUFBLElBQUEsS0FBQSxZQUFBO2dCQUNBLE1BQUEsUUFBQSxXQUFBLEdBQUEsTUFBQSxPQUFBO29CQUNBLE9BQUE7Ozs7O1lBS0EsRUFBQSxNQUFBLFlBQUE7Z0JBQ0EsTUFBQSxLQUFBLFFBQUE7Z0JBQ0EsS0FBQSxNQUFBLEdBQUEsT0FBQTs7Z0JBRUEsRUFBQSxjQUFBLEtBQUEsU0FBQTs7O2dCQUdBLElBQUEsR0FBQSxhQUFBOztvQkFFQSxlQUFBLEdBQUEsWUFBQSxNQUFBLFFBQUEsaUJBQUE7Ozs7O1FBS0EsSUFBQSxnQkFBQSxVQUFBLEtBQUEsWUFBQTtZQUNBLElBQUEsVUFBQTs7WUFFQSxFQUFBLFFBQUEsT0FBQSxXQUFBLFdBQUEsTUFBQSxVQUFBLEtBQUEsS0FBQTtnQkFDQSxJQUFBLElBQUEsU0FBQSxNQUFBO29CQUNBLEVBQUEsUUFBQSxJQUFBLGNBQUEsVUFBQSxZQUFBLEtBQUE7d0JBQ0EsSUFBQSxXQUFBLFNBQUEsTUFBQTs0QkFDQSxF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U0FBQSxNQUFBO3VCQUNBO29CQUNBLE9BQUEsU0FBQTs7ZUFFQSxRQUFBLFlBQUE7Z0JBQ0EsR0FBQSxVQUFBOzs7O1FBSUEsT0FBQSxPQUFBLDhDQUFBLFVBQUEsVUFBQTtZQUNBLElBQUEsYUFBQSxPQUFBO2dCQUNBLEdBQUEsb0JBQUEsWUFBQTttQkFDQSxJQUFBLGFBQUEsUUFBQTtnQkFDQSxHQUFBLG9CQUFBLFlBQUE7bUJBQ0EsSUFBQSxhQUFBLE1BQUE7Z0JBQ0EsR0FBQSxvQkFBQSxZQUFBOzs7O1FBSUEsT0FBQSxPQUFBLGlCQUFBLFVBQUEsVUFBQSxVQUFBO1lBQ0EsSUFBQSxRQUFBLE9BQUEsVUFBQSxXQUFBO2dCQUNBOztZQUVBLEdBQUEsYUFBQTtZQUNBLGFBQUEsd0JBQUE7WUFDQSxHQUFBLGFBQUEsR0FBQSxhQUFBLEVBQUEsVUFBQSxvQkFBQSxFQUFBLFVBQUE7OztRQUdBLElBQUEsZ0JBQUEsWUFBQTtZQUNBLEdBQUEsVUFBQTtZQUNBLGtCQUFBLGdCQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLElBQUEsWUFBQSxRQUFBO29CQUNBLElBQUEsSUFBQTt3QkFDQSxRQUFBO3dCQUNBO29CQUNBLE9BQUEsT0FBQSxhQUFBLElBQUEsSUFBQSxLQUFBO3dCQUNBLE1BQUEsUUFBQSxhQUFBLFFBQUE7O29CQUVBLEVBQUEsT0FBQSxFQUFBLE1BQUEsUUFBQSxVQUFBLEdBQUE7d0JBQ0EsSUFBQSxFQUFBLFNBQUEsRUFBQSxJQUFBLGNBQUE7NEJBQ0EsSUFBQSxPQUFBLEtBQUEsTUFBQSxFQUFBOzRCQUNBLEdBQUEsZ0JBQUEsS0FBQTs0QkFDQSxLQUFBLEtBQUE7Ozs7Z0JBSUEsbUJBQUEsRUFBQSxPQUFBLE1BQUEsRUFBQSxhQUFBO2dCQUNBLHFCQUFBLEVBQUEsT0FBQSxNQUFBLEVBQUEsYUFBQTtnQkFDQSxHQUFBLGFBQUEsR0FBQSxhQUFBLEVBQUEsVUFBQSxvQkFBQSxFQUFBLFVBQUE7Z0JBQ0EsR0FBQSxVQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsR0FBQSxVQUFBO2dCQUNBLFFBQUEsSUFBQTs7OztRQUlBLElBQUEsYUFBQSxZQUFBO1lBQ0E7WUFDQSxHQUFBLGtCQUFBO1lBQ0EsR0FBQSxPQUFBOztZQUVBLElBQUEsYUFBQSxJQUFBO2dCQUNBLElBQUEsS0FBQSxTQUFBLGFBQUE7Z0JBQ0EsSUFBQSxPQUFBLEdBQUE7b0JBQ0EsR0FBQSxPQUFBO29CQUNBLEdBQUEsa0JBQUEsSUFBQTt1QkFDQTs7b0JBRUEsa0JBQUEsb0JBQUEsSUFBQSxLQUFBLFVBQUEsTUFBQTt3QkFDQSxHQUFBLGtCQUFBLFVBQUEsWUFBQTs7OztZQUlBLFdBQUEsZUFBQTs7O1FBR0E7O1FBRUEsUUFBQSxRQUFBLFVBQUEsTUFBQSxZQUFBOztZQUVBLElBQUEsV0FBQSxhQUFBO2dCQUNBLFNBQUEsWUFBQTtnQkFDQSxxQkFBQSxTQUFBLFNBQUEsU0FBQTs7WUFFQSxHQUFBLGlCQUFBLGFBQUEscUJBQUEscUJBQUEscUJBQUE7Ozs7QUM3S0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSw2QkFBQSxVQUFBLGFBQUE7UUFDQSxJQUFBLFlBQUEsVUFBQSxJQUFBLE1BQUEsT0FBQSxhQUFBLFVBQUEsV0FBQSxXQUFBLFlBQUEsU0FBQSxVQUFBLGVBQUEsYUFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsT0FBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsV0FBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsYUFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsV0FBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLGNBQUEsZUFBQSxFQUFBLFVBQUEsWUFBQSxlQUFBOzs7UUFHQSxVQUFBLFlBQUE7WUFDQSxPQUFBLFlBQUE7Z0JBQ0EsT0FBQTtvQkFDQSxNQUFBLEtBQUE7b0JBQ0EsT0FBQSxLQUFBO29CQUNBLGFBQUEsS0FBQTtvQkFDQSxVQUFBLEtBQUE7b0JBQ0EsV0FBQSxLQUFBO29CQUNBLGFBQUEsS0FBQTs7Ozs7O1FBTUEsVUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsVUFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQSxLQUFBLElBQUEsVUFBQTs7WUFFQSxPQUFBLFVBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQzVEQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLGlFQUFBLFVBQUEsT0FBQSxJQUFBLFdBQUEsYUFBQTtRQUNBLE9BQUE7WUFDQSxlQUFBLFlBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsSUFBQSxNQUFBLFlBQUEsYUFBQSxnQkFBQTs7Z0JBRUEsTUFBQTtvQkFDQSxLQUFBO29CQUNBLFFBQUE7b0JBQ0EsUUFBQSxFQUFBLE9BQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBLEtBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEscUJBQUEsVUFBQSxJQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBO2dCQUNBLElBQUEsTUFBQSxZQUFBLGFBQUEsZ0JBQUEsZ0JBQUEsS0FBQTs7Z0JBRUEsTUFBQTtvQkFDQSxLQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOzs7WUFHQSxtQkFBQSxVQUFBLFdBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsSUFBQSxpQkFBQSxVQUFBOztnQkFFQSxNQUFBLEtBQUEsWUFBQSxhQUFBLGdCQUFBLDBCQUFBLGdCQUFBLFFBQUEsVUFBQSxRQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFNBQUEsTUFBQTtvQkFDQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLEVBQUE7O1lBRUEsZUFBQSxVQUFBLFdBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7O2dCQUVBLElBQUEsQ0FBQSxVQUFBLElBQUE7b0JBQ0EsTUFBQSxLQUFBLFlBQUEsYUFBQSxnQkFBQSxlQUFBLFVBQUEsU0FBQSxRQUFBLFVBQUEsUUFBQTt3QkFDQSxFQUFBLFFBQUE7dUJBQ0EsTUFBQSxVQUFBLE9BQUE7d0JBQ0EsRUFBQSxPQUFBOzt1QkFFQTtvQkFDQSxNQUFBLE1BQUEsWUFBQSxhQUFBLGdCQUFBLGdCQUFBLFVBQUEsS0FBQSxLQUFBLFVBQUEsU0FBQSxRQUFBLFVBQUEsUUFBQTt3QkFDQSxZQUFBO3dCQUNBLEVBQUEsUUFBQTt1QkFDQSxNQUFBLFVBQUEsT0FBQTt3QkFDQSxFQUFBLE9BQUE7Ozs7Z0JBSUEsT0FBQSxFQUFBOzs7Ozs7Ozs7OztDQzVEQSxJQUFBLGVBQUEsVUFBQTs7Ozs7SUFLQSxRQUFBLElBQUE7OztDQUdBLE9BQUEsV0FBQTs7QUFFQSxHQUFBLFFBQUEsV0FBQTtJQUNBLElBQUEsdUJBQUE7SUFDQSxJQUFBLHlCQUFBOztJQUVBLElBQUEsU0FBQTtFQUNBLE1BQUE7RUFDQSxRQUFBO0VBQ0EsU0FBQTtFQUNBLE9BQUE7O0lBRUEsSUFBQSxrQkFBQSxHQUFBLEtBQUEsSUFBQSxPQUFBLElBQUEsT0FBQSxDQUFBO0lBQ0EsSUFBQSxnQkFBQSxHQUFBLEtBQUEsS0FBQSxPQUFBLElBQUEsT0FBQSxDQUFBO0lBQ0EsSUFBQSxpQkFBQTtJQUNBLElBQUEsWUFBQTtJQUNBLElBQUEsYUFBQTtJQUNBLElBQUEsU0FBQSxTQUFBLEtBQUEsZUFBQSxPQUFBLE1BQUEsT0FBQSxPQUFBO0lBQ0EsSUFBQSxRQUFBLFNBQUEsS0FBQSxjQUFBLE9BQUEsUUFBQSxPQUFBLEtBQUE7Q0FDQSxJQUFBLFdBQUE7Q0FDQSxJQUFBLFFBQUE7Q0FDQSxJQUFBLFFBQUE7O0lBRUEsSUFBQSxhQUFBOztJQUVBLElBQUEsY0FBQSxTQUFBLEdBQUE7RUFDQSxPQUFBLEVBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQTs7O0lBR0EsSUFBQSxnQkFBQSxTQUFBLEdBQUE7RUFDQSxPQUFBLGVBQUEsRUFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLEVBQUEsWUFBQTs7O0lBR0EsSUFBQSxJQUFBLEdBQUEsS0FBQSxRQUFBLE9BQUEsRUFBQSxpQkFBQSxpQkFBQSxNQUFBLEVBQUEsR0FBQSxTQUFBLE1BQUE7O0lBRUEsSUFBQSxJQUFBLEdBQUEsTUFBQSxVQUFBLE9BQUEsV0FBQSxnQkFBQSxFQUFBLEdBQUEsU0FBQSxPQUFBLE1BQUEsT0FBQSxVQUFBOztJQUVBLElBQUEsUUFBQSxHQUFBLElBQUEsT0FBQSxNQUFBLEdBQUEsT0FBQSxVQUFBLFdBQUEsR0FBQSxLQUFBLE9BQUEsYUFBQSxjQUFBO01BQ0EsU0FBQSxHQUFBLFlBQUE7O0lBRUEsSUFBQSxRQUFBLEdBQUEsSUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBLFFBQUEsU0FBQTs7SUFFQSxJQUFBLGlCQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsbUJBQUEsc0JBQUE7S0FDQSxJQUFBLFVBQUEsYUFBQSxNQUFBLFNBQUEsR0FBQTtFQUNBLGtCQUFBLEdBQUEsS0FBQSxJQUFBLE9BQUEsSUFBQSxRQUFBLENBQUE7RUFDQSxnQkFBQSxHQUFBLEtBQUEsS0FBQSxPQUFBLElBQUEsUUFBQSxDQUFBO0VBQ0E7O0tBRUEsTUFBQSxLQUFBLFNBQUEsR0FBQSxHQUFBO0VBQ0EsT0FBQSxFQUFBLFNBQUEsRUFBQTs7S0FFQSxnQkFBQSxNQUFBLE1BQUEsU0FBQSxHQUFBO0tBQ0EsTUFBQSxLQUFBLFNBQUEsR0FBQSxHQUFBO0VBQ0EsT0FBQSxFQUFBLFNBQUEsRUFBQTs7S0FFQSxrQkFBQSxNQUFBLEdBQUE7Ozs7SUFJQSxJQUFBLFdBQUEsV0FBQTtDQUNBLElBQUEsR0FBQSxLQUFBLFFBQUEsT0FBQSxFQUFBLGlCQUFBLGlCQUFBLE1BQUEsRUFBQSxHQUFBLFNBQUEsTUFBQTtDQUNBLElBQUEsR0FBQSxNQUFBLFVBQUEsT0FBQSxXQUFBLGdCQUFBLEVBQUEsR0FBQSxTQUFBLE9BQUEsTUFBQSxPQUFBLFVBQUE7Q0FDQSxRQUFBLEdBQUEsSUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBLFVBQUEsTUFBQSxLQUFBLEtBQUEsTUFBQSxNQUFBLFdBQUEsR0FBQSxLQUFBLE9BQUEsYUFBQSxjQUFBO0dBQ0EsU0FBQSxHQUFBLFlBQUE7O0NBRUEsUUFBQSxHQUFBLElBQUEsT0FBQSxNQUFBLEdBQUEsT0FBQSxRQUFBLFNBQUE7OztJQUdBLFNBQUEsTUFBQSxPQUFBOztDQUVBLGVBQUE7Q0FDQTs7Q0FFQSxJQUFBLE1BQUEsR0FBQSxPQUFBO0VBQ0EsT0FBQTtFQUNBLEtBQUEsU0FBQTtFQUNBLEtBQUEsU0FBQSxRQUFBLE9BQUEsT0FBQSxPQUFBO0VBQ0EsS0FBQSxVQUFBLFNBQUEsT0FBQSxNQUFBLE9BQUE7RUFDQSxPQUFBO1NBQ0EsS0FBQSxTQUFBO0VBQ0EsS0FBQSxTQUFBLFFBQUEsT0FBQSxPQUFBLE9BQUE7RUFDQSxLQUFBLFVBQUEsU0FBQSxPQUFBLE1BQUEsT0FBQTtFQUNBLEtBQUEsYUFBQSxlQUFBLE9BQUEsT0FBQSxPQUFBLE9BQUEsTUFBQTs7TUFFQSxJQUFBLFVBQUE7R0FDQSxLQUFBLE9BQUEsYUFBQTtHQUNBLE9BQUE7R0FDQSxLQUFBLE1BQUE7VUFDQSxLQUFBLE1BQUE7R0FDQSxLQUFBLFNBQUEsU0FBQSxFQUFBO01BQ0EsR0FBQSxXQUFBLEVBQUEsV0FBQSxLQUFBLEVBQUEsT0FBQTtNQUNBLE9BQUEsV0FBQSxFQUFBOztHQUVBLEtBQUEsS0FBQTtHQUNBLEtBQUEsYUFBQTtHQUNBLEtBQUEsVUFBQSxTQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7R0FDQSxLQUFBLFNBQUEsU0FBQSxHQUFBO01BQ0EsUUFBQSxFQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUE7Ozs7RUFJQSxJQUFBLE9BQUE7R0FDQSxLQUFBLFNBQUE7R0FDQSxLQUFBLGFBQUEsbUJBQUEsU0FBQSxPQUFBLE1BQUEsT0FBQSxVQUFBO0dBQ0E7R0FDQSxLQUFBOztFQUVBLElBQUEsT0FBQSxLQUFBLEtBQUEsU0FBQSxVQUFBLGFBQUEsS0FBQTs7RUFFQSxPQUFBOztLQUVBOztJQUVBLE1BQUEsU0FBQSxTQUFBLE9BQUE7UUFDQSxRQUFBLElBQUE7Q0FDQSxlQUFBO0NBQ0E7O1FBRUEsSUFBQSxNQUFBLEdBQUEsT0FBQTs7UUFFQSxJQUFBLGtCQUFBLElBQUEsT0FBQTtRQUNBLElBQUEsT0FBQSxnQkFBQSxVQUFBLFFBQUEsS0FBQSxPQUFBOztRQUVBLEtBQUE7VUFDQSxPQUFBLE9BQUE7VUFDQSxLQUFBLE1BQUE7VUFDQSxLQUFBLE1BQUE7R0FDQSxLQUFBLFNBQUEsU0FBQSxFQUFBO01BQ0EsR0FBQSxXQUFBLEVBQUEsV0FBQSxLQUFBLEVBQUEsT0FBQTtNQUNBLE9BQUEsV0FBQSxFQUFBOztHQUVBO0dBQ0EsS0FBQSxLQUFBO0dBQ0EsS0FBQSxhQUFBO0dBQ0EsS0FBQSxVQUFBLFNBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtJQUNBLEtBQUEsU0FBQSxTQUFBLEdBQUE7TUFDQSxRQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQTs7O1FBR0EsS0FBQTtXQUNBLEtBQUEsYUFBQTtHQUNBLEtBQUEsVUFBQSxTQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7R0FDQSxLQUFBLFNBQUEsU0FBQSxHQUFBO01BQ0EsUUFBQSxFQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUE7OztDQUdBLEtBQUEsT0FBQTs7Q0FFQSxJQUFBLE9BQUEsTUFBQSxhQUFBLEtBQUE7Q0FDQSxJQUFBLE9BQUEsTUFBQSxhQUFBLEtBQUE7O0NBRUEsT0FBQTs7O0lBR0EsTUFBQSxTQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsQ0FBQSxVQUFBO0tBQ0EsT0FBQTtDQUNBLFNBQUE7Q0FDQSxPQUFBOzs7SUFHQSxNQUFBLGFBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBLEVBQUEsaUJBQUE7Q0FDQSxrQkFBQSxDQUFBLE1BQUEsSUFBQSxnQkFBQSxDQUFBLE1BQUE7Q0FDQSxPQUFBOzs7Ozs7OztJQVFBLE1BQUEsaUJBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO1FBQ0EsaUJBQUE7UUFDQSxPQUFBOzs7O0lBSUEsTUFBQSxZQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsQ0FBQSxVQUFBO0tBQ0EsT0FBQTtDQUNBLFlBQUE7Q0FDQSxPQUFBOzs7SUFHQSxNQUFBLGFBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsYUFBQTtDQUNBLE9BQUE7OztDQUdBLE1BQUEsUUFBQSxTQUFBLE1BQUE7RUFDQSxHQUFBLENBQUEsVUFBQSxPQUFBO0dBQ0EsT0FBQTs7RUFFQSxRQUFBO0VBQ0EsT0FBQTs7O0NBR0EsTUFBQSxRQUFBLFNBQUEsTUFBQTtFQUNBLEdBQUEsQ0FBQSxVQUFBLE9BQUE7R0FDQSxPQUFBOztFQUVBLFFBQUE7RUFDQSxPQUFBOzs7SUFHQSxNQUFBLFFBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsUUFBQSxDQUFBO0NBQ0EsT0FBQTs7O0lBR0EsTUFBQSxTQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsQ0FBQSxVQUFBO0tBQ0EsT0FBQTtDQUNBLFNBQUEsQ0FBQTtDQUNBLE9BQUE7OztJQUdBLE1BQUEsYUFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUE7Q0FDQSxhQUFBO0NBQ0EsT0FBQTs7O0NBR0EsTUFBQSxXQUFBLFNBQUEsT0FBQTtFQUNBLEdBQUEsQ0FBQSxVQUFBLE9BQUE7R0FDQSxPQUFBOztFQUVBLFdBQUE7RUFDQSxPQUFBOzs7OztJQUtBLE9BQUE7OztBQ2hRQSxTQUFBLE1BQUEsaUJBQUE7QUFDQTtJQUNBLEtBQUEsa0JBQUE7O0lBRUEsSUFBQSxPQUFBOztJQUVBLEtBQUEsWUFBQSxTQUFBO0lBQ0E7UUFDQSxLQUFBLFNBQUE7O1FBRUEsS0FBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLE9BQUE7O1FBRUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBLE9BQUEsT0FBQTtRQUNBLEtBQUEsT0FBQSxLQUFBLEtBQUEsT0FBQSxPQUFBO1FBQ0EsS0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUE7O1FBRUEsS0FBQSxPQUFBLE1BQUEsYUFBQSxjQUFBLE1BQUEsY0FBQSxNQUFBO1FBQ0EsS0FBQSxPQUFBLE1BQUEsYUFBQSxjQUFBLE1BQUEsY0FBQSxNQUFBO1FBQ0EsS0FBQSxPQUFBLFFBQUEsS0FBQSxPQUFBLE1BQUEsS0FBQSxPQUFBOztRQUVBLEtBQUEsT0FBQSxhQUFBLGNBQUEsY0FBQTtRQUNBLEtBQUEsT0FBQSxhQUFBLGNBQUEsY0FBQTs7UUFFQSxLQUFBLE9BQUEsY0FBQSxjQUFBLGNBQUE7UUFDQSxLQUFBLE9BQUEsY0FBQSxjQUFBLGVBQUE7UUFDQSxLQUFBLE9BQUEsWUFBQSxjQUFBLFlBQUE7O1FBRUEsS0FBQSxPQUFBLHFCQUFBLGNBQUEsc0JBQUE7OztJQUdBLEtBQUEsU0FBQTtJQUNBO1FBQ0EsS0FBQSxPQUFBLEdBQUEsT0FBQSxNQUFBLEtBQUE7YUFDQSxPQUFBO2FBQ0EsS0FBQSxTQUFBO2FBQ0EsS0FBQSxTQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsVUFBQSxLQUFBLE9BQUE7O1FBRUEsS0FBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLFNBQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUEsU0FBQTthQUNBLE1BQUEsUUFBQTs7OztRQUlBLEtBQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUE7YUFDQSxNQUFBLFFBQUE7YUFDQSxNQUFBLFVBQUE7YUFDQSxNQUFBLGdCQUFBOztRQUVBLEtBQUEsSUFBQSxZQUFBLEtBQUEsT0FBQTtRQUNBO1lBQ0EsS0FBQSxTQUFBLEtBQUEsT0FBQSxXQUFBLFVBQUEsTUFBQSxLQUFBLE9BQUEsV0FBQSxVQUFBLElBQUEsS0FBQSxPQUFBOzs7UUFHQSxLQUFBLElBQUEsYUFBQSxLQUFBLE9BQUE7UUFDQTtZQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUEsWUFBQSxXQUFBLE1BQUEsS0FBQSxPQUFBLFlBQUEsV0FBQSxJQUFBLEtBQUEsT0FBQTs7O1FBR0EsS0FBQSxJQUFBLFVBQUEsS0FBQSxPQUFBO1FBQ0E7WUFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBLFNBQUEsUUFBQSxNQUFBLEtBQUEsT0FBQSxTQUFBLFFBQUEsSUFBQSxLQUFBLE9BQUE7OztRQUdBLElBQUEsV0FBQTs7UUFFQSxJQUFBLGFBQUEsS0FBQSxPQUFBO1FBQ0E7WUFDQSxXQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUEsT0FBQTtZQUNBLEtBQUEsS0FBQSxPQUFBO2lCQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQSxLQUFBLElBQUEsV0FBQTtpQkFDQSxLQUFBLE1BQUEsV0FBQTtpQkFDQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLE9BQUE7aUJBQ0EsTUFBQSxhQUFBLFdBQUE7aUJBQ0EsTUFBQSxRQUFBO2lCQUNBLE1BQUEsZ0JBQUE7OztRQUdBLFdBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBO1FBQ0EsSUFBQSxhQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsT0FBQSxhQUFBO1FBQ0EsS0FBQSxJQUFBLFFBQUEsS0FBQSxPQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUEsS0FBQSxTQUFBO1FBQ0E7WUFDQSxJQUFBLGFBQUEsYUFBQSxLQUFBLE9BQUE7Z0JBQ0EsU0FBQTtnQkFDQSxTQUFBO1lBQ0EsS0FBQSxJQUFBLFFBQUEsUUFBQSxZQUFBLFFBQUEsS0FBQSxJQUFBLFFBQUEsWUFBQSxLQUFBLE9BQUEsTUFBQSxTQUFBO1lBQ0E7Z0JBQ0EsU0FBQSxLQUFBLGFBQUEsT0FBQTtnQkFDQSxTQUFBLEtBQUEsYUFBQSxPQUFBOztnQkFFQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsT0FBQTtxQkFDQSxNQUFBLFVBQUE7cUJBQ0EsTUFBQSxnQkFBQTs7O1lBR0EsU0FBQSxLQUFBLGFBQUEsT0FBQTtZQUNBLFNBQUEsS0FBQSxhQUFBLE9BQUE7O1lBRUEsS0FBQSxLQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLE9BQUE7aUJBQ0EsTUFBQSxVQUFBO2lCQUNBLE1BQUEsZ0JBQUE7O1lBRUEsSUFBQSxTQUFBLEtBQUEsT0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBO1lBQ0E7Z0JBQ0EsSUFBQSxRQUFBLEtBQUEsYUFBQSxPQUFBOztnQkFFQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLEtBQUEsTUFBQTtxQkFDQSxLQUFBLEtBQUEsTUFBQTtxQkFDQSxLQUFBLE1BQUEsV0FBQTtxQkFDQSxLQUFBLGVBQUEsU0FBQSxLQUFBLE9BQUEsTUFBQSxVQUFBO3FCQUNBLEtBQUE7cUJBQ0EsTUFBQSxhQUFBLFdBQUE7cUJBQ0EsTUFBQSxRQUFBO3FCQUNBLE1BQUEsZ0JBQUE7Ozs7UUFJQSxJQUFBLG1CQUFBLEtBQUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxTQUFBOztRQUVBLElBQUEsV0FBQSxDQUFBLEtBQUEsT0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBOztRQUVBLElBQUEsY0FBQSxLQUFBLGlCQUFBOztRQUVBLElBQUEsY0FBQSxHQUFBLElBQUE7YUFDQSxFQUFBLFNBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTthQUNBLEVBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2FBQ0EsWUFBQTs7UUFFQSxpQkFBQSxVQUFBO2FBQ0EsS0FBQSxDQUFBO2FBQ0E7YUFDQSxPQUFBO2FBQ0EsS0FBQSxLQUFBO2FBQ0EsTUFBQSxRQUFBOztRQUVBLGlCQUFBLE9BQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsS0FBQSxPQUFBLEtBQUEsT0FBQTthQUNBLE1BQUEsUUFBQTs7UUFFQSxXQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUEsT0FBQTtRQUNBLGlCQUFBLFVBQUE7YUFDQSxLQUFBLENBQUE7YUFDQTthQUNBLE9BQUE7YUFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBLElBQUE7YUFDQSxLQUFBLE1BQUEsV0FBQTthQUNBLEtBQUEsZUFBQTthQUNBLE1BQUEsYUFBQSxXQUFBO2FBQ0EsTUFBQSxRQUFBO2FBQ0EsTUFBQSxnQkFBQTs7UUFFQSxLQUFBLE9BQUEsS0FBQSxPQUFBLEtBQUE7OztJQUdBLEtBQUEsbUJBQUEsU0FBQTtJQUNBO1FBQ0EsSUFBQSxRQUFBLEtBQUEsT0FBQSxRQUFBOztRQUVBLElBQUEsT0FBQSxhQUFBLE9BQUE7UUFDQSxJQUFBLFFBQUEsYUFBQSxRQUFBLE9BQUE7UUFDQSxJQUFBLFFBQUEsYUFBQSxRQUFBLE9BQUE7O1FBRUEsSUFBQSxZQUFBLFNBQUEsS0FBQSxPQUFBLFNBQUEsR0FBQSxJQUFBLFFBQUE7UUFDQSxJQUFBLE9BQUEsYUFBQSxXQUFBO1FBQ0EsSUFBQSxRQUFBLGFBQUEsWUFBQSxPQUFBO1FBQ0EsSUFBQSxRQUFBLGFBQUEsWUFBQSxPQUFBOztRQUVBLE9BQUEsQ0FBQSxNQUFBLE9BQUEsT0FBQSxNQUFBLE9BQUEsT0FBQTs7UUFFQSxTQUFBLGFBQUEsT0FBQTtRQUNBO1lBQ0EsSUFBQSxRQUFBLEtBQUEsYUFBQSxPQUFBO1lBQ0EsTUFBQSxLQUFBLEtBQUEsT0FBQTtZQUNBLE1BQUEs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QUFBLE1BQUEsSUFBQSxHQUFBLElBQUEsS0FBQSxJQUFBLFNBQUEsSUFBQSxVQUFBLEtBQUEsRUFBQSxFQUFBLE1BQUEsS0FBQSxJQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLElBQUEsUUFBQSxFQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsVUFBQSxTQUFBLFFBQUEsUUFBQSxFQUFBLEVBQUEsR0FBQSxVQUFBLEVBQUEsR0FBQSxRQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsS0FBQSxFQUFBLEdBQUEsT0FBQSxFQUFBLEtBQUEsT0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxLQUFBLE1BQUEsYUFBQSxNQUFBLEVBQUEsQ0FBQSxHQUFBLEtBQUEsWUFBQSxFQUFBLEtBQUEsU0FBQSxFQUFBLEtBQUEsT0FBQSxFQUFBLEtBQUEsUUFBQSxFQUFBLEtBQUEsV0FBQSxFQUFBLEtBQUEsVUFBQSxLQUFBLFNBQUEsR0FBQSxDQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsUUFBQSxPQUFBLEtBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxRQUFBLEdBQUEsR0FBQSxDQUFBLEVBQUEsWUFBQSxFQUFBLElBQUEsU0FBQSxHQUFBLENBQUEsRUFBQSxZQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsYUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLE9BQUEsRUFBQSxNQUFBLEVBQUEsWUFBQSxFQUFBLEtBQUEsQ0FBQSxRQUFBLFNBQUEsZUFBQSxFQUFBLE9BQUEsSUFBQSxDQUFBLEdBQUEsRUFBQSxJQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLENBQUEsUUFBQSxTQUFBLFlBQUEsRUFBQSxPQUFBLFVBQUEsU0FBQSxLQUFBLEdBQUEsR0FBQSxvQkFBQSxJQUFBLEVBQUEsRUFBQSxZQUFBLEVBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxXQUFBLEVBQUEsRUFBQSxRQUFBLEVBQUEsRUFBQSxPQUFBLGFBQUEsVUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsaUJBQUEsUUFBQSxZQUFBLEtBQUEsRUFBQSxpQkFBQSxLQUFBLElBQUEsSUFBQSxFQUFBLENBQUEsR0FBQSxZQUFBLE9BQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxhQUFBLFFBQUEsRUFBQSxJQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsY0FBQSxFQUFBLEVBQUEsUUFBQSxFQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsR0FBQSxFQUFBLFNBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLFFBQUEsRUFBQSxXQUFBLEVBQUEsRUFBQSxTQUFBLGNBQUEsR0FBQSxDQUFBLElBQUEsRUFBQSxVQUFBLEtBQUEsUUFBQSxlQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxJQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLElBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLE1BQUEsR0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLGFBQUEsVUFBQSxPQUFBLEVBQUEsVUFBQSxLQUFBLEVBQUEsRUFBQSxHQUFBLEdBQUEsVUFBQSxLQUFBLEVBQUEsRUFBQSxJQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsT0FBQSxFQUFBLFFBQUEsS0FBQSxHQUFBLEVBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsYUFBQSxFQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsVUFBQSxPQUFBLEdBQUEsUUFBQSxRQUFBLEdBQUEsQ0FBQSxJQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxFQUFBLFFBQUEsUUFBQSxFQUFBLElBQUEsT0FBQSxFQUFBLENBQUEsR0FBQSxFQUFBLFFBQUEsR0FBQSxNQUFBLE9BQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxNQUFBLE9BQUEsRUFBQSxRQUFBLEdBQUEsTUFBQSxRQUFBLEdBQUEsR0FBQSxFQUFBLFFBQUEsT0FBQSxFQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLE9BQUEsRUFBQSxRQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsUUFBQSxPQUFBLElBQUEsR0FBQSxFQUFBLEVBQUEsUUFBQSxHQUFBLEVBQUEsTUFBQSxRQUFBLEdBQUEsQ0FBQSxFQUFBLE9BQUEsRUFBQSxNQUFBLENBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxPQUFBLElBQUEsRUFBQSxFQUFBLEtBQUEsR0FBQSxFQUFBLElBQUEsV0FBQSxVQUFBLENBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsT0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsVUFBQSxDQUFBLElBQUEsU0FBQSxFQUFBLENBQUEsSUFBQSxFQUFBLE9BQUEsRUFBQSxVQUFBLE9BQUEsRUFBQSxFQUFBLE1BQUEsS0FBQSxXQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsS0FBQSxLQUFBLEdBQUEsT0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLGFBQUEsTUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxTQUFBLEVBQUEsQ0FBQSxFQUFBLE1BQUEsTUFBQSxJQUFBLEVBQUEsT0FBQSxVQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxVQUFBLFVBQUEsYUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE1BQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxLQUFBLFFBQUEsZUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsaUJBQUEsUUFBQSxFQUFBLGlCQUFBLEVBQUEsVUFBQSxPQUFBLFVBQUEsQ0FBQSxHQUFBLE9BQUEsS0FBQSxVQUFBLENBQUEsSUFBQSxJQUFBLEVBQUEsS0FBQSxNQUFBLEdBQUEsRUFBQSxFQUFBLE1BQUEsUUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLElBQUEsS0FBQSxVQUFBLEVBQUEsT0FBQSxLQUFBLFdBQUEsSUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsR0FBQSxFQUFBLFlBQUEsQ0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLGNBQUEsRUFBQSxPQUFBLEtBQUEsZUFBQSxFQUFBLE9BQUEsS0FBQSxlQUFBLEVBQUEsaUJBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxHQUFBLEtBQUEsWUFBQSxFQUFBLElBQUEsc0JBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEdBQUEsRUFBQSxTQUFBLFFBQUEsUUFBQSxFQUFBLFFBQUEsU0FBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxDQUFBLFVBQUEsT0FBQSxHQUFBLGFBQUEsVUFBQSxFQUFBLEdBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxHQUFBLENBQUEsRUFBQSxFQUFBLE1BQUEsS0FBQSxPQUFBLEtBQUEsa0JBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsUUFBQSxRQUFBLEtBQUEsVUFBQSxFQUFBLEtBQUEsaUJBQUEsS0FBQSxzQkFBQSxHQUFBLENBQUEsSUFBQSxHQUFBLElBQUEsRUFBQSxtQkFBQSxFQUFBLEVBQUEsTUFBQSxRQUFBLFFBQUEsR0FBQSxPQUFBLEVBQUEsR0FBQSxJQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLE9BQUEsRUFBQSxTQUFBLEtBQUEsU0FBQSxpQkFBQSxFQUFBLGtCQUFBLEtBQUEsa0JBQUEsaUJBQUEsS0FBQSxpQkFBQSxzQkFBQSxLQUFBLHNCQUFBLFdBQUEsS0FBQSxXQUFBLGFBQUEsRUFBQSxjQUFBLEtBQUEsZUFBQSxPQUFBLE9BQUEsVUFBQSxTQUFBLENBQUEsVUFBQSxTQUFBLEVBQUEsQ0FBQSxNQUFBLENBQUEsU0FBQSxJQUFBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLFFBQUEsUUFBQSxFQUFBLE1BQUEsRUFBQSxRQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxVQUFBLE9BQUEsRUFBQSxjQUFBLEVBQUEsY0FBQSxNQUFBLFVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLENBQUEsTUFBQSxFQUFBLFlBQUEsRUFBQSxrQkFBQSxTQUFBLEVBQUEsT0FBQSxFQUFBLGFBQUEsUUFBQSxNQUFBLEVBQUEsS0FBQSxXQUFBLFVBQUEsQ0FBQSxFQUFBLElBQUEsVUFBQSxJQUFBLENBQUEsVUFBQSxTQUFBLEVBQUEsUUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLGlCQUFBLEtBQUEsRUFBQSxpQkFBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLEtBQUEsRUFBQSxZQUFBLEtBQUEsRUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsR0FBQSxZQUFBLEVBQUEsS0FBQSxDQUFBLElBQUEsRUFBQSxPQUFBLGFBQUEsRUFBQSxPQUFBLE9BQUEsRUFBQSxXQUFBLEVBQUEsRUFBQSxlQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsT0FBQSxPQUFBLGFBQUEsRUFBQSxPQUFBLGNBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxPQUFBLEtBQUEsT0FBQSxFQUFBLE9BQUEsS0FBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEdBQUEsT0FBQSxFQUFBLFVBQUEsRUFBQSxLQUFBLFNBQUEsRUFBQSxRQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsU0FBQSxFQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxlQUFBLEtBQUEsRUFBQSxpQkFBQSxLQUFBLEVBQUEsWUFBQSxDQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLEVBQUEsZ0JBQUEsS0FBQSxFQUFBLGtCQUFBLEtBQUEsRUFBQSxhQUFBLENBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE1BQUEsU0FBQSxHQUFBLFFBQUEsR0FBQSxPQUFBLEdBQUEsUUFBQSxFQUFBLFNBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLElBQUEsSUFBQSxLQUFBLEVBQUEsRUFBQSxJQUFBLElBQUEsR0FBQSxFQUFBLGVBQUEsS0FBQSxFQUFBLEVBQUEsSUFBQSxHQUFBLE9BQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLElBQUEsRUFBQSxJQUFBLEdBQUEsVUFBQSxZQUFBLFlBQUEsR0FBQSxFQUFBLFNBQUEsRUFBQSxXQUFBLEVBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxNQUFBLE1BQUEsRUFBQSxDQUFBLE1BQUEsRUFBQSxFQUFBLFFBQUEsU0FBQSxTQUFBLEVBQUEsTUFBQSxNQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxJQUFBLEdBQUEsWUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsVUFBQSxFQUFBLElBQUEsRUFBQSxLQUFBLEdBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxFQUFBLE9BQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLFdBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEdBQUEsSUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsS0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsQ0FBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsS0FBQSxHQUFBLENBQUEsRUFBQSxXQUFBLEdBQUEsTUFBQSxHQUFBLElBQUEsU0FBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLFdBQUEsR0FBQSxPQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxXQUFBLEdBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLE1BQUEsRUFBQSxRQUFBLEdBQUEsRUFBQSxTQUFBLFlBQUEsR0FBQSxDQUFBLEVBQUEsU0FBQSxDQUFBLEVBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxZQUFBLENBQUEsSUFBQSxFQUFBLENBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsQ0FBQSxHQUFBLElBQUEsRUFBQSxXQUFBLEdBQUEsT0FBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEdBQUEsT0FBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxhQUFBLEVBQUEsRUFBQSxRQUFBLEVBQUEsV0FBQSxFQUFBLElBQUEsRUFBQSxFQUFBLEtBQUEsQ0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxVQUFBLE9BQUEsRUFBQSxRQUFBLEVBQUEsTUFBQSxFQUFBLFNBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxHQUFBLEVBQUEsTUFBQSxTQUFBLEVBQUEsTUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsR0FBQSxLQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUEsR0FBQSxHQUFBLFNBQUEsR0FBQSxDQUFBLGFBQUEsR0FBQSxFQUFBLFdBQUEsRUFBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLFVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsS0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsVUFBQSxJQUFBLEVBQUEsRUFBQSxJQUFBLFdBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsUUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLFdBQUEsRUFBQSxJQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsUUFBQSxPQUFBLEtBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxNQUFBLEtBQUEsT0FBQSxFQUFBLE9BQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsV0FBQSxFQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsTUFBQSxHQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsVUFBQSxDQUFBLEtBQUEsRUFBQSxRQUFBLEVBQUEsRUFBQSxHQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsS0FBQSxFQUFBLFVBQUEsUUFBQSxDQUFBLFNBQUEsRUFBQSxVQUFBLEVBQUEsVUFBQSxPQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLE1BQUEsS0FBQSxJQUFBLEVBQUEsS0FBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsYUFBQSxHQUFBLE9BQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxXQUFBLEdBQUEsRUFBQSxXQUFBLEdBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLFdBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLE1BQUEsRUFBQSxLQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsUUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsSUFBQSxDQUFBLEdBQUEsRUFBQSxHQUFBLE9BQUEsRUFBQSxTQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxHQUFBLE1BQUEsRUFBQSxHQUFBLFVBQUEsR0FBQSxFQUFBLEVBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxHQUFBLE9BQUEsSUFBQSxFQUFBLFlBQUEsRUFBQSxNQUFBLEVBQUEsRUFBQSxNQUFBLEdBQUEsRUFBQSxJQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxXQUFBLEVBQUEsTUFBQSxFQUFBLGNBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsV0FBQSxHQUFBLEVBQUEsRUFBQSxVQUFBLEdBQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxJQUFBLElBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsTUFBQSxHQUFBLFFBQUEsR0FBQSxRQUFBLEdBQUEsT0FBQSxHQUFBLE1BQUEsR0FBQSxXQUFBLEdBQUEsTUFBQSxHQUFBLFFBQUEsR0FBQSxTQUFBLEdBQUEsV0FBQSxHQUFBLE1BQUEsR0FBQSxPQUFBLEdBQUEsT0FBQSxHQUFBLEtBQUEsR0FBQSxRQUFBLEdBQUEsT0FBQSxHQUFBLE1BQUEsR0FBQSxNQUFBLEdBQUEsT0FBQSxHQUFBLE9BQUEsSUFBQSxRQUFBLEVBQUEsQ0FBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxLQUFBLElBQUEsSUFBQSxJQUFBLEtBQUEsRUFBQSxDQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxFQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsRUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsTUFBQSxFQUFBLENBQUEsT0FBQSxNQUFBLFFBQUEsT0FBQSxTQUFBLFFBQUEsT0FBQSxNQUFBLEtBQUEsSUFBQSxJQUFBLHVCQUFBLEtBQUEsVUFBQSxVQUFBLE9BQUEsUUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsR0FBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsVUFBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsYUFBQSxNQUFBLEVBQUEsQ0FBQSxHQUFBLEVBQUEsY0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsR0FBQSxFQUFBLFVBQUEsT0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxLQUFBLEtBQUEsRUFBQSxFQUFBLFVBQUEsR0FBQSxJQUFBLEVBQUEsVUFBQSxRQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEtBQUEsT0FBQSxFQUFBLFdBQUEsRUFBQSxJQUFBLElBQUEsRUFBQSxXQUFBLEVBQUEsSUFBQSxHQUFBLEdBQUEsR0FBQSxHQUFBLEVBQUEsVUFBQSxNQUFBLFVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsV0FBQSxHQUFBLEVBQUEsV0FBQSxHQUFBLEdBQUEsRUFBQSxVQUFBLGFBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxFQUFBLFVBQUEsS0FBQSxRQUFBLGVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxRQUFBLENBQUEsRUFBQSxTQUFBLEVBQUEsU0FBQSxVQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsU0FBQSxFQUFBLG1CQUFBLEVBQUEsVUFBQSxVQUFBLFVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsV0FBQSxNQUFBLEVBQUEsWUFBQSxFQUFBLEtBQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsSUFBQSxJQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsT0FBQSxLQUFBLEVBQUEsR0FBQSxTQUFBLEVBQUEsQ0FBQSxPQUFBLFVBQUEsQ0FBQSxPQUFBLEVBQUEsR0FBQSxNQUFBLEVBQUEsYUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLFVBQUEsRUFBQSxhQUFBLE9BQUEsUUFBQSxPQUFBLFVBQUEsT0FBQSxRQUFBLEdBQUEsWUFBQSxPQUFBLFFBQUEsT0FBQSxLQUFBLE9BQUEsVUFBQSxDQUFBLE9BQUEsS0FBQSxPQUFBO0FDTkEsSUFBQSxDQUFBLE9BQUEsVUFBQSxVQUFBO0lBQ0EsT0FBQSxVQUFBLFdBQUEsU0FBQSxRQUFBLE9BQUE7UUFDQTtRQUNBLElBQUEsT0FBQSxVQUFBLFVBQUE7WUFDQSxRQUFBOzs7UUFHQSxJQUFBLFFBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtZQUNBLE9BQUE7ZUFDQTtZQUNBLE9BQUEsS0FBQSxRQUFBLFFBQUEsV0FBQSxDQUFBOzs7O0FDVkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsb0JBQUEsVUFBQSxVQUFBO1FBQ0EsU0FBQSxVQUFBLGdCQUFBLFFBQUEsS0FBQSxJQUFBO1FBQ0EsNkVBQUEsVUFBQSxjQUFBLFdBQUEsYUFBQSxnQkFBQSxRQUFBOztRQUVBLElBQUEsVUFBQSxVQUFBLEtBQUE7WUFDQSxJQUFBLFVBQUEsSUFBQTtZQUNBLFFBQUEsS0FBQSxPQUFBLEtBQUE7WUFDQSxRQUFBLEtBQUE7WUFDQSxPQUFBLENBQUEsUUFBQSxRQUFBLFFBQUEsVUFBQTs7O1FBR0EsSUFBQSxlQUFBLFVBQUEsS0FBQTtZQUNBLElBQUEsTUFBQTs7WUFFQSxJQUFBLE9BQUEsSUFBQSxNQUFBLEtBQUEsU0FBQSxHQUFBO2dCQUNBLElBQUEsTUFBQSxLQUFBLEdBQUEsTUFBQSxLQUFBLFFBQUEsVUFBQSxNQUFBO29CQUNBLElBQUEsSUFBQSxLQUFBLE1BQUE7d0JBQ0EsSUFBQSxFQUFBO3dCQUNBLElBQUEsRUFBQSxNQUFBLG1CQUFBLEVBQUE7b0JBQ0EsQ0FBQSxLQUFBLE9BQUEsSUFBQSxHQUFBLEtBQUEsS0FBQSxJQUFBLEtBQUEsQ0FBQTs7OztZQUlBLE9BQUE7Ozs7UUFJQSxJQUFBLHFCQUFBLElBQUEsT0FBQSxNQUFBLFlBQUEsYUFBQSxhQUFBLG1CQUFBO1FBQ0EsYUFBQSxRQUFBLG9CQUFBLFFBQUEsWUFBQTtZQUNBLElBQUEsVUFBQSxLQUFBLE1BQUEsUUFBQSxnQ0FBQTtnQkFDQSxZQUFBLE9BQUEsTUFBQSxTQUFB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UUFBQSxjQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUE7O1lBRUEsSUFBQSxZQUFBLGFBQUE7Z0JBQ0EsWUFBQSxRQUFBO2dCQUNBLFVBQUEsS0FBQSxNQUFBLFVBQUE7O1lBRUEsSUFBQSxVQUFBLGFBQUEsVUFBQSxVQUFBLFNBQUEsR0FBQTtnQkFDQSxJQUFBLFNBQUEsQ0FBQTtvQkFDQSxTQUFBLENBQUE7O2dCQUVBLFFBQUEsVUFBQSxFQUFBLE9BQUEsUUFBQSxTQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLEVBQUEsVUFBQSxjQUFBLFNBQUEsVUFBQSxVQUFBLEdBQUE7OztnQkFHQSxRQUFBLFVBQUEsRUFBQSxZQUFBLFFBQUEsU0FBQSxRQUFBOzs7WUFHQSxVQUFBLEtBQUEsS0FBQSxVQUFBOztZQUVBLE9BQUE7Ozs7UUFJQSxJQUFBLGVBQUEsSUFBQSxPQUFBLE1BQUEsWUFBQSxhQUFBLFVBQUEsU0FBQTtRQUNBLGFBQUEsUUFBQSxjQUFBLFFBQUEsWUFBQTtZQUNBLElBQUEsV0FBQSxPQUFBLE1BQUEsTUFBQSxLQUFBLEtBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxLQUFBLFFBQUEsTUFBQTtZQUNBLElBQUEsWUFBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLEtBQUEsUUFBQTtZQUNBLElBQUEsT0FBQTtnQkFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsVUFBQTtnQkFDQSxTQUFBOzs7WUFHQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsS0FBQSxPQUFBLEtBQUE7Z0JBQ0EsS0FBQSxRQUFBLEtBQUE7b0JBQ0EsTUFBQSxPQUFBLElBQUEsV0FBQSxJQUFBLEdBQUEsS0FBQTtvQkFDQSxlQUFBLEtBQUEsTUFBQSxLQUFBLFlBQUEsTUFBQSxLQUFBLE1BQUE7b0JBQ0EsY0FBQSxLQUFBLE1BQUEsS0FBQSxZQUFBLE1BQUEsS0FBQSxNQUFBO29CQUNBLGVBQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxNQUFBLEtBQUEsTUFBQTs7OztZQUlBLE9BQUEsQ0FBQSxLQUFBLE1BQUE7Ozs7UUFJQSxJQUFBLHdCQUFBO1FBQ0EsSUFBQSxrQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxZQUFBO1FBQ0EsYUFBQSxRQUFBLGlCQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUE7O1lBRUEsTUFBQSxJQUFBO1lBQ0EsSUFBQSxLQUFBLElBQUEsVUFBQSxJQUFBLFVBQUEsRUFBQSxJQUFBLFlBQUEsTUFBQSxZQUFBLEtBQUEsRUFBQSxJQUFBLE9BQUE7WUFDQSx3QkFBQSxxQ0FBQSxLQUFBO1lBQ0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSxrQkFBQTtRQUNBLElBQUEsWUFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLGFBQUEsVUFBQSxTQUFBO1FBQ0EsYUFBQSxRQUFBLFdBQUEsUUFBQSxVQUFBLFFBQUEsS0FBQTtZQUNBLElBQUEsWUFBQSxhQUFBO2dCQUNBLFlBQUEsUUFBQTtnQkFDQSxPQUFBLEtBQUEsTUFBQSxVQUFBOztZQUVBLElBQUEsVUFBQSxTQUFBLFVBQUEsTUFBQSxTQUFBLEdBQUE7Z0JBQ0EsSUFBQSxTQUFBO29CQUNBLFNBQUE7Z0JBQ0EsRUFBQSxRQUFBLFVBQUEsT0FBQSxVQUFBLEdBQUE7b0JBQ0EsSUFBQSxRQUFBLEVBQUEsT0FBQSxPQUFBLE1BQUEsU0FBQTt3QkFDQSxRQUFBLFVBQUEsU0FBQSxVQUFBLE1BQUEsR0FBQSxVQUFBLEtBQUEsVUFBQSxNQUFBOztvQkFFQSxJQUFBLFVBQUEsWUFBQTt3QkFDQSxRQUFBOzs7b0JBR0EsT0FBQSxLQUFBO29CQUNBLE9BQUEsS0FBQTs7O2dCQUdBLEtBQUEsVUFBQSxFQUFBLFlBQUEsS0FBQSxTQUFBLFFBQUE7OztZQUdBLElBQUEsVUFBQSxRQUFBO2dCQUNBLEtBQUEsVUFBQSxFQUFBLE9BQUEsS0FBQSxTQUFBLFVBQUEsS0FBQTtvQkFDQSxPQUFBLElBQUEsV0FBQSxVQUFBLE9BQUE7Ozs7WUFJQSxJQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLGVBQUEsRUFBQSxNQUFBLEtBQUEsU0FBQSxVQUFBO2dCQUNBLEtBQUEsVUFBQSxhQUFBLFVBQUEsT0FB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QUE7WUFDQSxJQUFBLFlBQUEsYUFBQTtnQkFDQSxTQUFBOztZQUVBLElBQUEsWUFBQTtnQkFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsVUFBQTtnQkFDQSxTQUFBOzs7WUFHQSxJQUFBLFVBQUEsT0FBQSxJQUFBLFVBQUEsTUFBQSxJQUFBLEtBQUEsT0FBQSxJQUFBLFVBQUEsUUFBQSxLQUFBLE9BQUE7O1lBRUEsRUFBQSxRQUFBLFVBQUEsUUFBQSxVQUFBLFFBQUE7Z0JBQ0EsSUFBQSxZQUFBLFdBQUEsZ0JBQUEsT0FBQTtnQkFDQSxJQUFBLFlBQUEsV0FBQSxnQkFBQSxNQUFBO2dCQUNBLElBQUEsZUFBQTtvQkFDQSxRQUFBLEVBQUEsT0FBQSxFQUFBLFVBQUE7b0JBQ0EsT0FBQSxPQUFBLElBQUEsVUFBQSxRQUFBLElBQUEsT0FBQTtvQkFDQSxPQUFBLE9BQUEsSUFBQSxVQUFBLE1BQUEsSUFBQSxPQUFBO29CQUNBLE9BQUE7b0JBQ0EsT0FBQTtvQkFDQSxRQUFBOzs7Z0JBR0EsS0FBQSxJQUFBLElBQUEsR0FBQSxJQUFBLFNBQUEsS0FBQTtvQkFDQSxJQUFBLFVBQUEsYUFBQSxVQUFBLFVBQUEsU0FBQSxHQUFBO3dCQUNBLEVBQUEsUUFBQSxVQUFBLFdBQUEsVUFBQSxJQUFBOzRCQUNBLFNBQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxJQUFBLElBQUEsTUFBQTs0QkFDQSxJQUFBLFVBQUEsR0FBQTtnQ0FDQSxJQUFBLFFBQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxZQUFBLFlBQUEsTUFBQTtnQ0FDQSxhQUFBLE9BQUEsS0FBQTtvQ0FDQSxNQUFBLE9BQUEsSUFBQSxVQUFBLFFBQUEsSUFBQSxJQUFBLEdBQUEsS0FBQSxPQUFBO29DQUNBLE9BQUE7b0NBQ0EsSUFBQSxTQUFBOzs7OzJCQUlBO3dCQUNBLFNBQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxJQUFBLElBQUEsTUFBQTt3QkFDQSxJQUFBLFVBQUEsR0FBQTs0QkFDQSxhQUFBLE9BQUEsS0FBQTtnQ0FDQSxNQUFBLE9BQUEsSUFBQSxVQUFBLFFB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QSxLQUFBLE1BQUE7WUFDQSxJQUFBLGlCQUFBO2dCQUNBLHdCQUFBO2dCQUNBLGNBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsTUFBQSxZQUFBLElBQUE7Z0JBQ0EsYUFBQSxLQUFBLE1BQUE7Z0JBQ0EsdUJBQUEsRUFBQSxLQUFBLFdBQUEsV0FBQSxNQUFBO1lBQ0EsRUFBQSxRQUFBLHNCQUFBLFVBQUEsS0FBQTtnQkFDQSxlQUFBLEtBQUEsRUFBQSxLQUFBLFVBQUEsVUFBQSxTQUFBO29CQUNBLE9BQUEsUUFBQSxTQUFBLElBQUEsU0FBQSxRQUFBLFFBQUEsWUFBQSxJQUFBLFNBQUE7OztZQUdBLEVBQUEsUUFBQSxnQkFBQSxVQUFBLFNBQUE7Z0JBQ0EsSUFBQSxLQUFBLFFBQUEsZ0NBQUEsUUFBQSxLQUFBO2dCQUNBLHNCQUFBLEtBQUEsS0FBQSxNQUFBLEdBQUE7O1lBRUEsSUFBQSxlQUFBO2dCQUNBLElBQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxRQUFBLElBQUEsTUFBQTtnQkFDQSxNQUFBLFdBQUE7Z0JBQ0EsU0FBQSxXQUFBO2dCQUNBLE9BQUEsV0FBQTtnQkFDQSxhQUFBLFdBQUE7Z0JBQ0EsV0FBQTtnQkFDQSxZQUFBLFdBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxTQUFBLElBQUEsT0FBQTtnQkFDQSxlQUFBLElBQUEsT0FBQTtnQkFDQSxVQUFBO2dCQUNBLGNBQUEsV0FBQTtnQkFDQSxXQUFBOztZQUVBLE9BQUEsQ0FBQSxLQUFBLEtBQUEsVUFBQSxlQUFBOzs7O1FBSUEsSUFBQSxvQkFBQTtRQUNBLElBQUEsY0FBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLGFBQUEsWUFBQSxXQUFBO1FBQ0EsYUFBQSxRQUFBLGFBQUEsUUFBQSxZQUFBO1lBQ0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSxzQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLGFBQUEsZ0JBQUEsV0FBQTtRQUNBLGFBQUEsUUFBQSxxQkFBQSxRQUFBLFlBQUE7WUFDQSxJQUFBLGNBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsTUFBQSxZQUFBLElBQUE7Z0JBQ0EsaUJBQUE7O1lBRUEsRUFBQSxRQUFBLFVBQUEsVUFBQSxNQUFBO2dCQUNBLElBQUEsT0FBQSxLQUFBLE1BQUEsS0FBQSxZQUFBLElBQUEsSUFBQSxNQUFBO2dCQUNBLElBQUEsU0FBQSxHQUFBO29CQUNBLGVBQUEsS0FBQTt3QkFDQSxJQUFBLEtBQUE7d0JBQ0EsTUFBQSxLQUFBO3dCQUNBLFNBQUEsS0FBQTt3QkFDQSxPQUFBLEtBQUE7d0JBQ0EsYUFBQSxLQUFBO3dCQUNBLFdBQUEsS0FBQTt3QkFDQSxXQUFBLEtBQUE7Ozs7O1lBS0EsSUFBQSxZQUFBLFFBQUE7Z0JBQ0EsUUFBQSxLQUFBLE1BQUEsVUFBQSxJQUFBO2dCQUNBLGNBQUE7O1lBRUEsSUFBQSxTQUFBO2dCQUNBO29CQUNBLE1BQUE7b0JBQ0EsT0FBQTtvQkFDQSxhQUFBOztnQkFFQTtvQkFDQSxNQUFBO29CQUNBLE9BQUE7b0JBQ0EsYUFBQTs7Z0JBRUE7b0JBQ0EsTUFBQTtvQkFDQSxPQUFBO29CQUNBLGFBQUE7O2dCQUVBO29CQUNBLE1BQUE7b0JBQ0EsT0FBQTtvQkFDQSxhQUFBOztnQkFFQTtvQkFDQSxNQUFBO29CQUNBLE9BQUE7b0JBQ0EsYUFBQTs7OztZQUlBLElBQUEsYUFBQSxLQUFBLE1BQUEsS0FBQSxZQUFBLElBQUEsSUFBQSxNQUFBO1lBQ0EsSUFBQSxlQUFBLGVBQUEsSUFBQSxDQUFBLE9BQUEsR0FBQSxPQUFBLEdBQUEsT0FBQSxNQUFBLENBQUEsT0FBQSxHQUFBLE9BQUEsR0FBQSxPQUFBOztZQUVBLEVBQUEsUUFBQSxPQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLGFBQUE7O2dCQUVBLEtBQUEsSUFBQSxJQUFBLEdBQUEsSUFBQSxLQUFBLE1BQUEsS0FBQSxZQUFBLEtBQUEsS0FBQSxLQUFBO29CQUNBLFdBQUEsS0FBQTt3QkFDQSxNQUFBO3dCQUNBLE9BQUE7d0JBQ0EsYUFBQTt3QkFDQSxTQUFBLE9BQUEsTUFBQTt3QkFDQSxjQUFBLE9BQUEsTUFBQTs7OztnQkFJQSxJQUFBLGVBQUE7O2dCQUVBLEtBQUEsSUFBQSxJQUFBLEdBQUEsSUFBQSxLQUFBLE1BQUEsS0FBQSxZQUFBLEtBQUEsS0FBQSxLQUFBO29CQUNBLGFBQUEsS0FBQTt3QkFDQSxNQUFBO3dCQUNBLE9BQUE7d0JBQ0EsYUFBQTt3QkFDQSxTQUFBLE9BQUEsTUFBQTt3QkFDQSxjQUFBLE9BQUEsTUFBQTs7OztnQkFJQSxJQUFBLGNBQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxNQUFBLElBQUEsTUFBQTtvQkFDQSxnQkFBQSxLQUFBLE1BQUEsS0FBQSxZQUFBLE1BQUEsSUFBQSxNQUFBO29CQUNBLGFBQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxLQUFBLElBQUEsTUFBQTs7Z0JBRUEsSUFBQSx1QkFBQTtvQkFDQSxtQkFBQSxLQUFBLE1BQUEsY0FBQTtvQkFDQSxTQUFBLGVBQUEsbUJBQUE7O2dCQUVBLElBQUEsUUFBQSxLQUFBLE1BQUEsS0FBQSxZQUFBLEtBQUEsSUFBQSxNQUFBO2dCQUNBLEtBQUEsSUFBQSxLQUFBLEdBQUEsS0FBQSxPQUFBLE1BQUE7b0JBQ0EscUJBQUEsS0FBQTt3QkFDQSxhQUFBLFNBQUEsSUFBQTt3QkFDQSxPQUFBLFFBQUEsUUFBQSxLQUFBLG1CQUFBLFNBQUE7Ozs7Z0JBSUEsSUFBQSx5QkFBQTtvQkFDQSxxQkFBQSxLQUFBLE1BQUEsZ0JBQUE7b0JBQ0EsU0FBQSxpQkFBQSxxQkFBQTs7Z0JBRUEsS0FBQSxJQUFBLEtBQUEsR0FBQSxLQUFBLEdBQUEsTUFBQTtvQkFDQSx1QkFBQSxLQUFBO3dCQUNBLGFBQUEsU0FBQSxJQUFBO3dCQUNBLE9BQUEsUUFBQSxxQkFBQSxLQUFBLHFCQUFBLFNBQUE7Ozs7Z0JBSUEsSUFBQSxzQkFBQTt3QkFDQSxNQUFBOzRCQUNBLE9BQUE7NEJBQ0EsYUFBQTs7d0JBRUEsV0FBQTs0QkFDQSxPQUFBOzRCQUNBLGFBQUE7O3dCQUVBLFFBQUE7NEJBQ0EsT0FBQTs0QkFDQSxhQUFBOzs7b0JBR0Esa0JBQUEsS0FBQSxNQUFBLGFBQUE7b0JBQ0EsU0FBQSxjQUFBLGtCQUFBOztnQkFFQSxvQkFBQSxLQUFBLFFBQUE7Z0JBQ0Esb0JBQUEsVUFBQSxRQUFBO2dCQUNBLG9CQUFBLE9BQUEsUUFBQSxrQkFBQTs7Z0JBRUEsSUFBQSxnQkFBQSxLQUFBLE1BQUEsb0JBQUEsS0FBQSxRQUFBO29CQUNBLFNBQUEsb0JBQUEsS0FBQSxRQUFBO29CQUNBLGVBQUEsS0FBQSxNQUFBLG9CQUFBLFVBQUEsUUFBQTtvQkFDQSxTQUFBLG9CQUFBLFVBQUEsUUFBQTtvQkFDQSxlQUFBLEtBQUEsTUFBQSxvQkFBQSxPQUFBLFFBQUE7b0JBQ0EsU0FBQSxvQkFBQSxVQUFBLFFBQUE7O2dCQUVBLEtBQUEsSUFBQSxLQUFBLEdBQUEsS0FBQSxHQUFBLE1BQUE7b0JBQ0Esb0JBQUEsS0FBQSxZQUFBLEtBQUE7d0JBQ0EsYUFBQSxTQUFBLElBQUE7d0JBQ0EsT0FBQSxRQUFBLG9CQUFBLEtBQUEsUUFBQSxLQUFBLGdCQUFBLFNBQUE7O29CQUVBLG9CQUFBLFVBQUEsWUFBQSxLQUFBO3dCQUNBLGFBQUEsU0FBQSxJQUFBO3dCQUNBLE9BQUEsUUFBQSxvQkFBQSxVQUFBLFFBQUEsS0FBQSxlQUFBLFNBQUE7O29CQUVBLG9CQUFBLE9BQUEsWUFBQSxLQUFBO3dCQUNBLGFBQUEsU0FBQSxJQUFBO3dCQUNBLE9BQUEsUUFBQSxvQkFBQSxPQUFBLFFBQUEsS0FBQSxlQUFBLFNBQUE7Ozs7Z0JBSUEsSUFBQSxPQUFBLEtBQUEsTUFBQSxLQUFBLFlBQUEsSUFBQSxJQUFBLE1BQUE7Z0JBQ0EsWUFBQSxLQUFBO29CQUNBLElBQUEsS0FBQTtvQkFDQSxVQUFBLEtBQUE7b0JBQ0EsVUFBQSxLQUFBO29CQUNBLFdBQUEsU0FBQTtvQkFDQSxPQUFBLFNBQUEsSUFBQSxhQUFBLEtBQUEsTUFBQSxLQUFBLFlBQUEsSUFBQSxJQUFBLE1BQUEsS0FBQSxhQUFBO29CQUNBLFFBQUE7b0JBQ0EsVUFBQTtvQkFDQSxnQkFBQTt3QkFDQSxTQUFBOzRCQUNBLE9BQUE7NEJBQ0EsYUFBQTs7d0JBRUEsV0FBQTs0QkFDQSxPQUFBOzRCQUNB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O1FBS0EsSUFBQSxxQkFBQTtRQUNBLElBQUEsZUFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxZQUFBO1FBQ0EsYUFBQSxRQUFBLGNBQUEsUUFBQSxZQUFBO1lBQ0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSxrQkFBQSxVQUFBLE1BQUEsSUFBQTtZQUNBLElBQUEsU0FBQSxLQUFBLE1BQUE7O1lBRUEsT0FBQTtnQkFDQSxJQUFBLE1BQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxRQUFBLElBQUEsTUFBQTtnQkFDQSxNQUFBLE9BQUE7Z0JBQ0EsT0FBQSxPQUFBO2dCQUNBLGFBQUEsT0FBQTtnQkFDQSxLQUFBO2dCQUNBLFNBQUEsSUFBQSxPQUFBO2dCQUNBLGVBQUEsSUFBQSxPQUFBO2dCQUNBLGVBQUEsT0FBQTs7O1FBR0EsSUFBQSxvQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxZQUFBO1FBQ0EsYUFBQSxTQUFBLG1CQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUEsTUFBQTtZQUNBLElBQUEsZUFBQSxnQkFBQTtZQUNBLE9BQUEsQ0FBQSxLQUFBLEtBQUEsVUFBQSxlQUFBOztRQUVBLGFBQUEsVUFBQSxvQkFBQSxRQUFBLFVBQUEsUUFBQSxLQUFBLE1BQUE7O1lBRUEsTUFBQSxJQUFBO1lBQ0EsSUFBQSxLQUFBLElBQUEsVUFBQSxJQUFBLFVBQUEsRUFBQSxJQUFBLFlBQUEsTUFBQSxZQUFBLEtBQUEsRUFBQSxJQUFBLE9BQUE7WUFDQSxJQUFBLGVBQUEsZ0JBQUEsTUFBQTtZQUNBLE9BQUEsQ0FBQSxLQUFBLEtBQUEsVUFBQSxlQUFBOzs7O1FBSUEsSUFBQSx5QkFBQTtRQUNBLElBQUEsbUJBQUEsSUFBQSxPQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUEsYUFBQTtRQUNBLGFBQUEsUUFBQSxrQkFBQSxRQUFBLFVBQUEsUUFBQSxLQUFBOztZQUVBLE1BQUEsSUFBQTtZQUNBLElBQUEsS0FBQSxJQUFBLFVBQUEsSUFBQSxVQUFBLEVBQUEsSUFBQSxZQUFBLE1BQUEsWUFBQSxLQUFBLEVBQUEsSUFBQSxPQUFBO1lBQ0EseUJBQUEseUJBQUEsS0FBQTtZQUNBLElBQUEsY0FBQSxRQUFBO1lBQ0EsSUFBQSxZQUFBLE9BQUEsS0FBQTtnQkFDQSxjQUFBLGFBQUEsUUFBQSxTQUFBO2dCQUNBLE9BQUEsQ0FBQSxLQUFBLEtBQUEsTUFBQSxjQUFBO21CQUNBO2dCQUNBLE9BQUE7Ozs7O1FBS0EsSUFBQSxtQkFBQTtRQUNBLElBQUEsYUFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxVQUFBO1FBQ0EsYUFBQSxRQUFBLFlBQUEsUUFBQSxZQUFBO1lBQ0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSxnQkFBQSxVQUFBLE1BQUEsSUFBQTtZQUNBLElBQUEsT0FBQSxLQUFBLE1BQUE7O1lBRUEsT0FBQTtnQkFDQSxJQUFBLE1BQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxRQUFBLElBQUEsTUFBQTtnQkFDQSxNQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBO2dCQUNBLGFBQUEsS0FBQTtnQkFDQSxZQUFBLEtBQUEsTUFBQSxLQUFBLFlBQUEsTUFBQSxJQUFBLE1BQUE7Z0JBQ0EsS0FBQTtnQkFDQSxhQUFBO2dCQUNBLFNBQUEsSUFBQSxPQUFBO2dCQUNBLGVBQUEsSUFBQSxPQUFBO2dCQUNBLGVBQUEsS0FBQTs7O1FBR0EsSUFBQSxrQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxVQUFBO1FBQ0EsYUFBQSxTQUFBLGlCQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUEsTUFBQTtZQUNBLElBQUEsYUFBQSxjQUFBO1lBQ0EsT0FBQSxDQUFBLEtBQUEsS0FBQSxVQUFBLGFBQUE7O1FBRUEsYUFBQSxVQUFBLGtCQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUEsTUFBQTs7WUFFQSxNQUFBLElBQUE7WUFDQSxJQUFBLEtBQUEsSUFBQSxVQUFBLElBQUEsVUFBQSxFQUFBLElBQUEsWUFBQSxNQUFBLFlBQUEsS0FBQSxFQUFBLElBQUEsT0FBQTtZQUNBLElBQUEsYUFBQSxjQUFBLE1BQUE7WUFDQSxPQUFBLENBQUEsS0FBQSxLQUFBLFVBQUEsYUFBQTs7OztRQUlBLElBQUEscUJBQUE7UUFDQSxJQUFBLGVBQUEsSUFBQSxPQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUEsWUFBQTtRQUNBLGFBQUEsUUFBQSxjQUFBLFFBQUEsV0FBQTtZQUNBLE9BQUEsUUFBQTs7OztRQUlBLGFBQUEsUUFBQSxVQUFBO1FBQ0EsYUFBQSxTQUFBLFVBQUE7OztBQUdBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcsIFtcbiAgICAgICAgJ3NjYWxlQ29uZmlnTW9kdWxlJyxcbiAgICAgICAgJ25nUmVzb3VyY2UnLFxuICAgICAgICAnbmdTYW5pdGl6ZScsXG4gICAgICAgICduZ1JvdXRlJyxcbiAgICAgICAgJ2VtZ3VvLnBvbGxlcicsXG4gICAgICAgICd1aS5ib290c3RyYXAnLFxuICAgICAgICAndWkuZ3JpZCcsXG4gICAgICAgICd1aS5ncmlkLnNlbGVjdGlvbicsXG4gICAgICAgICd1aS5ncmlkLnBhZ2luYXRpb24nLFxuICAgICAgICAndWkuZ3JpZC5yZXNpemVDb2x1bW5zJyxcbiAgICAgICAgJ3VpLnNvcnRhYmxlJyxcbiAgICAgICAgJ2NmcC5ob3RrZXlzJyxcbiAgICAgICAgJ3RvZ2dsZS1zd2l0Y2gnLFxuICAgICAgICAndWlTd2l0Y2gnXG4gICAgXSk7XG5cbiAgICBhcHAuY29uZmlnKGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkcmVzb3VyY2VQcm92aWRlciwgJHByb3ZpZGUsIHBvbGxlckNvbmZpZykge1xuICAgICAgICAvLyBGaXggc291cmNlbWFwc1xuICAgICAgICAvLyBAdXJsIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIuanMvaXNzdWVzLzUyMTcjaXNzdWVjb21tZW50LTUwOTkzNTEzXG4gICAgICAgICRwcm92aWRlLmRlY29yYXRvcignJGV4Y2VwdGlvbkhhbmRsZXInLCBmdW5jdGlvbiAoJGRlbGVnYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGV4Y2VwdGlvbiwgY2F1c2UpIHtcbiAgICAgICAgICAgICAgICAkZGVsZWdhdGUoZXhjZXB0aW9uLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc3RvcCBwb2xsZXJzIHdoZW4gcm91dGUgY2hhbmdlc1xuICAgICAgICBwb2xsZXJDb25maWcuc3RvcE9uID0gJyRyb3V0ZUNoYW5nZVN0YXJ0JztcbiAgICAgICAgcG9sbGVyQ29uZmlnLnNtYXJ0ID0gdHJ1ZTtcblxuICAgICAgICAvLyBwcmVzZXJ2ZSB0cmFpbGluZyBzbGFzaGVzXG4gICAgICAgICRyZXNvdXJjZVByb3ZpZGVyLmRlZmF1bHRzLnN0cmlwVHJhaWxpbmdTbGFzaGVzID0gZmFsc2U7XG5cbiAgICAgICAgLy9yb3V0aW5nXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgICAgICAud2hlbignLycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnb3ZDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL292ZXJ2aWV3L3BhcnRpYWxzL292VGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2xvZ2luJyx7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2FkbWluTG9naW5Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvYWRtaW4vcGFydGlhbHMvYWRtaW5Mb2dpblRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9sb2dvdXQnLHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbG9nb3V0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2FkbWluL3BhcnRpYWxzL2FkbWluTG9naW5UZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvYWJvdXQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fib3V0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9hYm91dC9wYXJ0aWFscy9hYm91dFRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9mZWVkJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdmZWVkRGV0YWlsc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvZmVlZC9wYXJ0aWFscy9mZWVkRGV0YWlsc1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvZmVlZC9pbmdlc3RzJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdpbmdlc3RSZWNvcmRzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9mZWVkL3BhcnRpYWxzL2luZ2VzdFJlY29yZHNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2ZlZWQvaW5nZXN0cy86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2luZ2VzdFJlY29yZERldGFpbHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2ZlZWQvcGFydGlhbHMvaW5nZXN0UmVjb3JkRGV0YWlsc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9tZXRyaWNzJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtZXRyaWNzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9tZXRyaWNzL3BhcnRpYWxzL21ldHJpY3NUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL25vZGVzJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdub2Rlc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbm9kZXMvcGFydGlhbHMvbm9kZXNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL25vZGVzLzppZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbm9kZURldGFpbHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL25vZGVzL3BhcnRpYWxzL25vZGVEZXRhaWxzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2xvYWQvcXVldWVkJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdsb2FkQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9sb2FkL3BhcnRpYWxzL2xvYWRUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvbG9hZC9ydW5uaW5nJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdxdWV1ZVJ1bm5pbmdDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2xvYWQvcGFydGlhbHMvcXVldWVSdW5uaW5nVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2xvYWQvZGVwdGgnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2xvYWREZXB0aENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbG9hZC9wYXJ0aWFscy9sb2FkRGVwdGhUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvcmVjaXBlcycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAncmVjaXBlc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVzVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9yZWNpcGVzL3JlY2lwZS86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3JlY2lwZURldGFpbHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL3JlY2lwZXMvcGFydGlhbHMvcmVjaXBlRGV0YWlsc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9yZWNpcGVzL3R5cGVzLzppZD8nLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3JlY2lwZVR5cGVzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9yZWNpcGVzL3BhcnRpYWxzL3JlY2lwZVR5cGVzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYnNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvcGFydGlhbHMvam9ic1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvam9icy9qb2IvOmlkJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdqb2JEZXRhaWxDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvcGFydGlhbHMvam9iRGV0YWlsVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvdHlwZXMvOmlkPycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iVHlwZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvcGFydGlhbHMvam9iVHlwZXNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZmFpbHVyZS1yYXRlcycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iVHlwZXNGYWlsdXJlUmF0ZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvcGFydGlhbHMvam9iVHlwZXNGYWlsdXJlUmF0ZXNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZXhlY3V0aW9ucycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRXhlY3V0aW9uc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9wYXJ0aWFscy9qb2JFeGVjdXRpb25zVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZXhlY3V0aW9ucy86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYkV4ZWN1dGlvbkRldGFpbENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9wYXJ0aWFscy9qb2JFeGVjdXRpb25EZXRhaWxUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvd29ya3NwYWNlcy86aWQ/Jywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd3b3Jrc3BhY2VzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy93b3Jrc3BhY2VzL3BhcnRpYWxzL3dvcmtzcGFjZXNUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvZmVlZC9zdHJpa2VzLzppZD8nLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3N0cmlrZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2ZlZWQvcGFydGlhbHMvc3RyaWtlc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9mZWVkL3NjYW5zLycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnc2NhbnNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2ZlZWQvcGFydGlhbHMvc2NhbnNUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvZmVlZC9zY2Fucy86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3NjYW5EZXRhaWxzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9mZWVkL3BhcnRpYWxzL3NjYW5EZXRhaWxzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2JhdGNoJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdiYXRjaGVzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9iYXRjaC9wYXJ0aWFscy9iYXRjaGVzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2JhdGNoLzppZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnYmF0Y2hEZXRhaWxzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9iYXRjaC9wYXJ0aWFscy9iYXRjaERldGFpbHNUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vdGhlcndpc2Uoe1xuICAgICAgICAgICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgICAgICAgICAgfSk7XG4gICAgfSlcbiAgICAudmFsdWUoJ21vbWVudCcsIHdpbmRvdy5tb21lbnQpXG4gICAgLnZhbHVlKCdsb2NhbFN0b3JhZ2UnLCB3aW5kb3cubG9jYWxTdG9yYWdlKVxuICAgIC52YWx1ZSgnWE1MSHR0cFJlcXVlc3QnLCB3aW5kb3cuWE1MSHR0cFJlcXVlc3QpXG4gICAgLnZhbHVlKCd0b2FzdHInLCB3aW5kb3cudG9hc3RyKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUNvbmZpZ01vZHVsZScsIFtdKS5wcm92aWRlcignc2NhbGVDb25maWcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzY2FsZUNvbmZpZyA9IHt9LFxuICAgICAgICAgICAgc2NhbGVDb25maWdMb2NhbCA9IHt9O1xuXG4gICAgICAgIHRoaXMuJGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgIHVybDogJ2NvbmZpZy9zY2FsZUNvbmZpZy5qc29uJyxcbiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChjb25maWcuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICBzY2FsZUNvbmZpZyA9IGNvbmZpZy5yZXNwb25zZUpTT04uc2NhbGVDb25maWc7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnTG9jYWwgPSAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnY29uZmlnL3NjYWxlQ29uZmlnLmxvY2FsLmpzb24nLFxuICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ0xvY2FsLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjYWxlQ29uZmlnTG9jYWwgPSBjb25maWdMb2NhbC5yZXNwb25zZUpTT04uc2NhbGVDb25maWdMb2NhbDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfLm1lcmdlKHNjYWxlQ29uZmlnLCBzY2FsZUNvbmZpZ0xvY2FsKTtcblxuICAgICAgICAgICAgICAgIC8vIGFkZCBmdW5jdGlvbiBmb3IgZ2V0QXBpUHJlZml4XG4gICAgICAgICAgICAgICAgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4ID0gZnVuY3Rpb24oc2VydmljZU5hbWUpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcudXJscy5vdmVycmlkZXMgJiYgc2NhbGVDb25maWcudXJscy5vdmVycmlkZXNbc2VydmljZU5hbWVdID8gc2NhbGVDb25maWcudXJscy5vdmVycmlkZXNbc2VydmljZU5hbWVdIDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWc7XG4gICAgICAgIH1cblxuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNIZWFkZXJDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgc3VibmF2U2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5jdXJyZW50UGF0aCA9IHN1Ym5hdlNlcnZpY2UuZ2V0Q3VycmVudFBhdGgoKTtcbiAgICAgICAgdm0ubG9hZGluZ0NsYXNzID0gJHNjb3BlLnNob3dTdWJuYXYgPyAnbG9hZGluZy1jb250ZW50LXN1Ym5hdicgOiAnbG9hZGluZy1jb250ZW50JztcbiAgICB9KVxuICAgIC5kaXJlY3RpdmUoJ2Fpc0hlYWRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzYWdlOiA8YWlzLWhlYWRlciBuYW1lPXtuYW1lfT48L2Fpcy1oZWFkZXI+XG4gICAgICAgICAqL1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0hlYWRlckNvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9oZWFkZXIvaGVhZGVyVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIG5hbWU6ICc9JyxcbiAgICAgICAgICAgICAgICBoaWRlVGl0bGU6ICc9JyxcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiAnPScsIC8vIG9wdGlvbmFsIC0gd2lsbCBvdmVybGF5IGEgbG9hZGluZyBzcGlubmVyIG9uIHRoZSBwYWdlIGJhc2VkIG9uIHRoZSBwYXNzZWQtaW4gdmFsdWVcbiAgICAgICAgICAgICAgICBzaG93U3VibmF2OiAnPScsXG4gICAgICAgICAgICAgICAgc3VibmF2TGlua3M6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ3NjYWxlTmF2aWdhdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbmF2aWdhdGlvbi9wYXJ0aWFscy9uYXZUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICduYXZDb250cm9sbGVyJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWJvdXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIG5hdlNlcnZpY2UsIHN0YXRlU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uc3RhdGVTZXJ2aWNlID0gc3RhdGVTZXJ2aWNlO1xuICAgICAgICB2bS52ZXJzaW9uID0gJyc7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2Fib3V0Jyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnN0YXRlU2VydmljZS5nZXRWZXJzaW9uKCknLCBmdW5jdGlvbiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHZtLnZlcnNpb24gPSBuZXdWYWx1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhZG1pbkxvZ2luQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkdGltZW91dCwgJGxvY2F0aW9uLCBzdGF0ZVNlcnZpY2UsIHVzZXJTZXJ2aWNlKSB7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICAgICAgICB1c2VyU2VydmljZS5sb2dpbignYWRtaW4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIEFueSBjb2RlIGluIGhlcmUgd2lsbCBhdXRvbWF0aWNhbGx5IGhhdmUgYW4gJHNjb3BlLmFwcGx5KCkgcnVuIGFmdGVyd2FyZHNcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2xvZ291dENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHRpbWVvdXQsICRyb290U2NvcGUsICRsb2NhdGlvbiwgdXNlclNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHVzZXJTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAvLyBBbnkgY29kZSBpbiBoZXJlIHdpbGwgYXV0b21hdGljYWxseSBoYXZlIGFuICRzY29wZS5hcHBseSgpIHJ1biBhZnRlcndhcmRzXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2JhdGNoRGV0YWlsc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UsIHVzZXJTZXJ2aWNlLCBiYXRjaFNlcnZpY2UsIHJlY2lwZVNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCBCYXRjaCwgdG9hc3RyLCBtb21lbnQpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5zY2FsZUNvbmZpZyA9IHNjYWxlQ29uZmlnO1xuICAgICAgICB2bS5tb21lbnQgPSBtb21lbnQ7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5tb2RlID0gJHJvdXRlUGFyYW1zLmlkID4gMCA/ICdkZXRhaWxzJyA6ICdjcmVhdGUnO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLmJhdGNoID0gJHJvdXRlUGFyYW1zLmlkID4gMCA/IHt9IDogbmV3IEJhdGNoKCk7XG4gICAgICAgIHZtLnJlY2lwZVR5cGVzID0gW107XG4gICAgICAgIHZtLnNlbGVjdGVkUmVjaXBlVHlwZSA9IHt9O1xuICAgICAgICB2bS5qb2JUeXBlcyA9IFtdO1xuICAgICAgICB2bS5zZWxlY3RlZEpvYlR5cGVzID0gW107XG4gICAgICAgIHZtLnN0YXJ0VGltZSA9IHtcbiAgICAgICAgICAgIGhvdXI6IG51bGwsXG4gICAgICAgICAgICBtaW51dGU6IG51bGwsXG4gICAgICAgICAgICBzZWNvbmQ6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZW5kVGltZSA9IHtcbiAgICAgICAgICAgIGhvdXI6IG51bGwsXG4gICAgICAgICAgICBtaW51dGU6IG51bGwsXG4gICAgICAgICAgICBzZWNvbmQ6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZGF0ZU1vZGVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpbWV6b25lOiAnKzAwMCdcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZGF0ZVJhbmdlU3RhcnRlZFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuRGF0ZVJhbmdlU3RhcnRlZFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0uZGF0ZVJhbmdlU3RhcnRlZFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmRhdGVSYW5nZUVuZGVkUG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5EYXRlUmFuZ2VFbmRlZFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0uZGF0ZVJhbmdlRW5kZWRQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNhbmNlbENyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgICAgICBpZiAoJHJvdXRlUGFyYW1zLmlkID09PSAnMCcpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2JhdGNoJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZGlzYWJsZVNhdmVCdG4gPSBmdW5jdGlvbiAoaW52YWxpZCkge1xuICAgICAgICAgICAgdmFyIHJldHVyblZhbCA9ICEoIWludmFsaWQpO1xuICAgICAgICAgICAgdm0uc2F2ZUJ0bkNsYXNzID0gcmV0dXJuVmFsID8gJ2J0bi1kZWZhdWx0JyA6ICdidG4tc3VjY2Vzcyc7XG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRXYXJuaW5nc0h0bWwgPSBmdW5jdGlvbiAod2FybmluZ3MpIHtcbiAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSAnJztcbiAgICAgICAgICAgIF8uZm9yRWFjaCh3YXJuaW5ncywgZnVuY3Rpb24gKHdhcm5pbmcpIHtcbiAgICAgICAgICAgICAgICB3YXJuaW5nc0h0bWwgKz0gJzxiPicgKyB3YXJuaW5nLmlkICsgJzo8L2I+ICcgKyB3YXJuaW5nLmRldGFpbHMgKyAnPGJyIC8+PGJyIC8+JztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd2FybmluZ3NIdG1sICs9ICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCBidG4teHMgY2xlYXJcIj5IaWRlPC9idXR0b24+JztcbiAgICAgICAgICAgIHJldHVybiB3YXJuaW5nc0h0bWw7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0RGF0ZVJhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGModm0uYmF0Y2guZGVmaW5pdGlvbi5kYXRlX3JhbmdlLnN0YXJ0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0YykgKyAnICZuZGFzaDsgJyArICBtb21lbnQudXRjKHZtLmJhdGNoLmRlZmluaXRpb24uZGF0ZV9yYW5nZS5lbmRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zZXRUaW1lID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAnc3RhcnRlZCcpIHtcbiAgICAgICAgICAgICAgICB2bS5zdGFydFRpbWUgPSB7XG4gICAgICAgICAgICAgICAgICAgIGhvdXI6ICgnMCcgKyBtb21lbnQudXRjKHZtLmJhdGNoLmRlZmluaXRpb24uZGF0ZV9yYW5nZVt0eXBlXSkuaG91cigpKS5zbGljZSgtMiksXG4gICAgICAgICAgICAgICAgICAgIG1pbnV0ZTogKCcwJyArIG1vbWVudC51dGModm0uYmF0Y2guZGVmaW5pdGlvbi5kYXRlX3JhbmdlW3R5cGVdKS5taW51dGUoKSkuc2xpY2UoLTIpLFxuICAgICAgICAgICAgICAgICAgICBzZWNvbmQ6ICgnMCcgKyBtb21lbnQudXRjKHZtLmJhdGNoLmRlZmluaXRpb24uZGF0ZV9yYW5nZVt0eXBlXSkuc2Vjb25kKCkpLnNsaWNlKC0yKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLmVuZFRpbWUgPSB7XG4gICAgICAgICAgICAgICAgICAgIGhvdXI6ICgnMCcgKyBtb21lbnQudXRjKHZtLmJhdGNoLmRlZmluaXRpb24uZGF0ZV9yYW5nZVt0eXBlXSkuaG91cigpKS5zbGljZSgtMiksXG4gICAgICAgICAgICAgICAgICAgIG1pbnV0ZTogKCcwJyArIG1vbWVudC51dGModm0uYmF0Y2guZGVmaW5pdGlvbi5kYXRlX3JhbmdlW3R5cGVdKS5taW51dGUoKSkuc2xpY2UoLTIpLFxuICAgICAgICAgICAgICAgICAgICBzZWNvbmQ6ICgnMCcgKyBtb21lbnQudXRjKHZtLmJhdGNoLmRlZmluaXRpb24uZGF0ZV9yYW5nZVt0eXBlXSkuc2Vjb25kKCkpLnNsaWNlKC0yKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2hhbmdlVGltZSA9IGZ1bmN0aW9uICh0eXBlLCB1bml0KSB7XG4gICAgICAgICAgICBpZiAodm0uYmF0Y2guZGVmaW5pdGlvbi5kYXRlX3JhbmdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtW3R5cGVdW3VuaXRdLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgdm1bdHlwZV1bdW5pdF0gPSAoJzAnICsgdm1bdHlwZV0uaG91cikuc2xpY2UoLTIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHZtW3R5cGVdW3VuaXRdKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodm1bdHlwZV0uaG91ciA+IDIzIHx8IHZtW3R5cGVdLmhvdXIgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bVt0eXBlXS5ob3VyID0gdm1bdHlwZV0uaG91ciA+IDIzID8gMjMgOiAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh2bVt0eXBlXS5taW51dGUgPiA1OSB8fCB2bVt0eXBlXS5taW51dGUgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bVt0eXBlXS5taW51dGUgPSB2bVt0eXBlXS5taW51dGUgPiA1OSA/IDU5IDogMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodm1bdHlwZV0uc2Vjb25kID4gNTkgfHwgdm1bdHlwZV0uc2Vjb25kIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm1bdHlwZV0uc2Vjb25kID0gdm1bdHlwZV0uc2Vjb25kID4gNTkgPyA1OSA6IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVTZXQgPSB0eXBlID09PSAnc3RhcnRUaW1lJyA/IG1vbWVudC51dGModm0uYmF0Y2guZGVmaW5pdGlvbi5kYXRlX3JhbmdlLnN0YXJ0ZWQudG9JU09TdHJpbmcoKSkgOiBtb21lbnQudXRjKHZtLmJhdGNoLmRlZmluaXRpb24uZGF0ZV9yYW5nZS5lbmRlZC50b0lTT1N0cmluZygpKTtcbiAgICAgICAgICAgICAgICAgICAgdGltZVNldC5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2hvdXInOiAoJzAnICsgdm1bdHlwZV0uaG91cikuc2xpY2UoLTIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ21pbnV0ZSc6ICgnMCcgKyB2bVt0eXBlXS5taW51dGUpLnNsaWNlKC0yKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzZWNvbmQnOiAoJzAnICsgdm1bdHlwZV0uc2Vjb25kKS5zbGljZSgtMilcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnc3RhcnRUaW1lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uYmF0Y2guZGVmaW5pdGlvbi5kYXRlX3JhbmdlLnN0YXJ0ZWQgPSB0aW1lU2V0LnRvRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YXJ0IHRpbWU6ICcgKyB2bS5iYXRjaC5kZWZpbml0aW9uLmRhdGVfcmFuZ2Uuc3RhcnRlZC50b0lTT1N0cmluZygpKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnZW5kVGltZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmJhdGNoLmRlZmluaXRpb24uZGF0ZV9yYW5nZS5lbmRlZCA9IHRpbWVTZXQudG9EYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZW5kIHRpbWU6ICcgKyB2bS5iYXRjaC5kZWZpbml0aW9uLmRhdGVfcmFuZ2UuZW5kZWQudG9JU09TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ua2V5ZG93biA9IGZ1bmN0aW9uICgkZXZlbnQsIHVuaXQsIHR5cGUpIHtcbiAgICAgICAgICAgIHZhciBtYXggPSAwO1xuICAgICAgICAgICAgaWYgKHVuaXQgPT09ICdob3VyJykge1xuICAgICAgICAgICAgICAgIG1heCA9IDIzO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh1bml0ID09PSAnbWludXRlJyB8fCB1bml0ID09PSAnc2Vjb25kJykge1xuICAgICAgICAgICAgICAgIG1heCA9IDYwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCRldmVudC5rZXlDb2RlID09PSAzOCkge1xuICAgICAgICAgICAgICAgIC8vIHVwIGFycm93XG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKHZtW3R5cGVdW3VuaXRdKSkge1xuICAgICAgICAgICAgICAgICAgICB2bVt0eXBlXVt1bml0XSA9ICgnMCcgKyAwKS5zbGljZSgtMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtW3R5cGVdW3VuaXRdIDwgbWF4ID8gdm1bdHlwZV1bdW5pdF0rKyA6IHZtW3R5cGVdW3VuaXRdO1xuICAgICAgICAgICAgICAgIHZtW3R5cGVdW3VuaXRdID0gKCcwJyArIHZtW3R5cGVdW3VuaXRdKS5zbGljZSgtMik7XG4gICAgICAgICAgICAgICAgdm0uY2hhbmdlVGltZSh0eXBlLCB1bml0KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJGV2ZW50LmtleUNvZGUgPT09IDQwKSB7XG4gICAgICAgICAgICAgICAgLy8gZG93biBhcnJvd1xuICAgICAgICAgICAgICAgIGlmIChpc05hTih2bVt0eXBlXVt1bml0XSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdm1bdHlwZV1bdW5pdF0gPSAoJzAnICsgMCkuc2xpY2UoLTIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bVt0eXBlXVt1bml0XSA+IDAgPyB2bVt0eXBlXVt1bml0XS0tIDogdm1bdHlwZV1bdW5pdF07XG4gICAgICAgICAgICAgICAgdm1bdHlwZV1bdW5pdF0gPSAoJzAnICsgdm1bdHlwZV1bdW5pdF0pLnNsaWNlKC0yKTtcbiAgICAgICAgICAgICAgICB2bS5jaGFuZ2VUaW1lKHR5cGUsIHVuaXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnZhbGlkYXRlQmF0Y2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGJhdGNoU2VydmljZS52YWxpZGF0ZUJhdGNoKHZtLmJhdGNoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEud2FybmluZ3MgJiYgZGF0YS53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdGhlIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSBnZXRXYXJuaW5nc0h0bWwoZGF0YS53YXJuaW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSh3YXJuaW5nc0h0bWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdCYXRjaCBpcyB2YWxpZC4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvci5kZXRhaWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSgnRXJyb3IgdmFsaWRhdGluZyBiYXRjaCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNhdmVCYXRjaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgYmF0Y2hTZXJ2aWNlLnNhdmVCYXRjaCh2bS5iYXRjaCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdCYXRjaCBzdWNjZXNzZnVsbHkgY3JlYXRlZC4nKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvciAmJiBlcnJvci5kZXRhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKGVycm9yLmRldGFpbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKCdFcnJvciBjcmVhdGluZyBiYXRjaCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2JhdGNoJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRSZWNpcGVUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVzKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcmV0cmlldmluZyByZWNpcGUgdHlwZXM6ICcgKyBlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRCYXRjaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGJhdGNoU2VydmljZS5nZXRCYXRjaEJ5SWQoJHJvdXRlUGFyYW1zLmlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZtLmJhdGNoID0gQmF0Y2gudHJhbnNmb3JtZXIoZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICB2bS5yZWFkb25seSA9ICEodXNlciAmJiB1c2VyLmlzX2FkbWluKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2JhdGNoJyk7XG5cbiAgICAgICAgICAgIGlmICh2bS5tb2RlID09PSAnY3JlYXRlJykge1xuICAgICAgICAgICAgICAgIGdldFJlY2lwZVR5cGVzKClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodm0ubW9kZSA9PT0gJ2RldGFpbHMnKSB7XG4gICAgICAgICAgICAgICAgZ2V0QmF0Y2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLmJhdGNoLnJlY2lwZV90eXBlJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlcyA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciByZWNpcGVKb2JzID0gXy5tYXAobmV3VmFsdWUuZGVmaW5pdGlvbi5qb2JzLCAnam9iX3R5cGUubmFtZScpO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChyZWNpcGVKb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGpvYixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBqb2IsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogam9iXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlcyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5iYXRjaC5kZWZpbml0aW9uLmRhdGVfcmFuZ2Uuc3RhcnRlZCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHZtLnN0YXJ0VGltZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaG91cjogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgbWludXRlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBzZWNvbmQ6IG51bGxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5iYXRjaC5kZWZpbml0aW9uLmRhdGVfcmFuZ2UuZW5kZWQnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2bS5lbmRUaW1lID0ge1xuICAgICAgICAgICAgICAgICAgICBob3VyOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBtaW51dGU6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHNlY29uZDogbnVsbFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYmF0Y2hlc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIHNjYWxlQ29uZmlnLCBncmlkRmFjdG9yeSwgc3VibmF2U2VydmljZSwgdXNlclNlcnZpY2UsIHJlY2lwZVNlcnZpY2UsIG5hdlNlcnZpY2UsIHN0YXRlU2VydmljZSwgYmF0Y2hTZXJ2aWNlLCBCYXRjaCwgbW9tZW50LCBwb2xsZXIpIHtcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnYmF0Y2gnKTtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgcmVjaXBlVHlwZVZpZXdBbGwgPSB7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfTtcblxuICAgICAgICB2bS5iYXRjaGVzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldEJhdGNoZXNQYXJhbXMoKTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLnJlY2lwZVR5cGVWYWx1ZXMgPSBbcmVjaXBlVHlwZVZpZXdBbGxdO1xuICAgICAgICB2bS5zZWxlY3RlZFJlY2lwZVR5cGUgPSB2bS5iYXRjaGVzUGFyYW1zLnJlY2lwZV90eXBlX2lkID8gdm0uYmF0Y2hlc1BhcmFtcy5yZWNpcGVfdHlwZV9pZCA6IHJlY2lwZVR5cGVWaWV3QWxsO1xuICAgICAgICB2bS5iYXRjaFN0YXR1c1ZhbHVlcyA9IHNjYWxlQ29uZmlnLmJhdGNoU3RhdHVzO1xuICAgICAgICB2bS5zZWxlY3RlZEJhdGNoU3RhdHVzID0gdm0uYmF0Y2hlc1BhcmFtcy5zdGF0dXMgfHwgdm0uYmF0Y2hTdGF0dXNWYWx1ZXNbMF07XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0ID0gbW9tZW50LnV0Yyh2bS5iYXRjaGVzUGFyYW1zLnN0YXJ0ZWQpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcCA9IG1vbWVudC51dGModm0uYmF0Y2hlc1BhcmFtcy5lbmRlZCkudG9EYXRlKCk7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3BQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0b3BQb3B1cCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3BQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5kYXRlTW9kZWxPcHRpb25zID0ge1xuICAgICAgICAgICAgdGltZXpvbmU6ICcrMDAwJ1xuICAgICAgICB9O1xuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uQ3VycmVudFBhZ2UgPSB2bS5iYXRjaGVzUGFyYW1zLnBhZ2UgfHwgMTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplID0gdm0uYmF0Y2hlc1BhcmFtcy5wYWdlX3NpemUgfHwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG5cbiAgICAgICAgdmFyIGZpbHRlcmVkQnlCYXRjaFN0YXR1cyA9IHZtLmJhdGNoZXNQYXJhbXMuc3RhdHVzID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeVJlY2lwZVR5cGUgPSB2bS5iYXRjaGVzUGFyYW1zLnJlY2lwZV90eXBlX2lkID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gdm0uYmF0Y2hlc1BhcmFtcy5vcmRlciA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICB2bS5jb2xEZWZzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAndGl0bGUnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdUaXRsZSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdyZWNpcGVfdHlwZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdSZWNpcGUgVHlwZScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkucmVjaXBlX3R5cGUudGl0bGUgfX0ge3sgcm93LmVudGl0eS5yZWNpcGVfdHlwZS52ZXJzaW9uIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkUmVjaXBlVHlwZVwiIG5nLW9wdGlvbnM9XCJyZWNpcGVUeXBlIGFzIChyZWNpcGVUeXBlLnRpdGxlICsgXFwnIFxcJyArIHJlY2lwZVR5cGUudmVyc2lvbikgZm9yIHJlY2lwZVR5cGUgaW4gZ3JpZC5hcHBTY29wZS52bS5yZWNpcGVUeXBlVmFsdWVzXCI+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3N0YXR1cycsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdTdGF0dXMnLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRCYXRjaFN0YXR1c1wiPjxvcHRpb24gbmctc2VsZWN0ZWQ9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmJhdGNoU3RhdHVzVmFsdWVzWyRpbmRleF0gPT0gZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZEJhdGNoU3RhdHVzIH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmJhdGNoU3RhdHVzVmFsdWVzWyRpbmRleF0gfX1cIiBuZy1yZXBlYXQ9XCJzdGF0dXMgaW4gZ3JpZC5hcHBTY29wZS52bS5iYXRjaFN0YXR1c1ZhbHVlcyB0cmFjayBieSAkaW5kZXhcIj57eyBzdGF0dXMudG9VcHBlckNhc2UoKSB9fTwvb3B0aW9uPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdjcmVhdGVkX2NvdW50JyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnSm9iIENyZWF0aW9uIFJhdGUnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJ2NvbXBsZXRlZFJhdGUuaHRtbCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdjcmVhdGVkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0NyZWF0ZWQgKFopJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmNyZWF0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2xhc3RfbW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnTGFzdCBNb2RpZmllZCAoWiknLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ2V0QmF0Y2hlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGJhdGNoU2VydmljZS5nZXRCYXRjaGVzKHZtLmJhdGNoZXNQYXJhbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGRhdGEuY291bnQgPyBkYXRhLmNvdW50IDogMDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gZGF0YS5yZXN1bHRzID8gZGF0YS5yZXN1bHRzLmxlbmd0aCA6IDA7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMgPyBkYXRhLnJlc3VsdHMubGVuZ3RoIDogMDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gZGF0YS5yZXN1bHRzID8gQmF0Y2gudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKSA6IFtdO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcmV0cmlldmluZyBiYXRjaGVzOiAnICsgZSk7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0UmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVjaXBlU2VydmljZS5nZXRSZWNpcGVUeXBlcygpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVUeXBlVmFsdWVzLnB1c2goZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVUeXBlVmFsdWVzID0gXy5mbGF0dGVuKHZtLnJlY2lwZVR5cGVWYWx1ZXMpO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVjaXBlVHlwZSA9IF8uZmluZCh2bS5yZWNpcGVUeXBlVmFsdWVzLCB7IGlkOiB2bS5iYXRjaGVzUGFyYW1zLnJlY2lwZV90eXBlX2lkIH0pIHx8IHJlY2lwZVR5cGVWaWV3QWxsO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcmV0cmlldmluZyByZWNpcGUgdHlwZXM6ICcgKyBlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZpbHRlclJlc3VsdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwb2xsZXIuc3RvcEFsbCgpO1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEJhdGNoZXNQYXJhbXModm0uYmF0Y2hlc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmdldEJhdGNoZXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDb2xEZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyh2bS5jb2xEZWZzLCB2bS5iYXRjaGVzUGFyYW1zKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVCYXRjaE9yZGVyID0gZnVuY3Rpb24gKHNvcnRBcnIpIHtcbiAgICAgICAgICAgIHZtLmJhdGNoZXNQYXJhbXMub3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDAgPyBzb3J0QXJyIDogbnVsbDtcbiAgICAgICAgICAgIGZpbHRlcmVkQnlPcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVSZWNpcGVUeXBlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUuaWQgIT09IHZtLmJhdGNoZXNQYXJhbXMucmVjaXBlX3R5cGVfaWQpIHtcbiAgICAgICAgICAgICAgICB2bS5iYXRjaGVzUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uYmF0Y2hlc1BhcmFtcy5yZWNpcGVfdHlwZV9pZCA9IHZhbHVlLmlkID09PSAwID8gbnVsbCA6IHZhbHVlLmlkO1xuICAgICAgICAgICAgdm0uYmF0Y2hlc1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQmF0Y2hTdGF0dXMgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB2bS5iYXRjaGVzUGFyYW1zLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHZtLmJhdGNoZXNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5iYXRjaGVzUGFyYW1zLnN0YXR1cyA9IHZhbHVlID09PSAnVklFVyBBTEwnID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgdm0uYmF0Y2hlc1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY29tcGxldGVkUmF0ZVN0eWxlID0gZnVuY3Rpb24gKGNyZWF0ZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICB2YXIgcGVyY2VudGFnZSA9ICgoY3JlYXRlZCAvIHRvdGFsKSAqIDEwMCkudG9GaXhlZCgwKTtcbiAgICAgICAgICAgIHJldHVybiBwZXJjZW50YWdlID4gMCA/ICd3aWR0aDogJyArIHBlcmNlbnRhZ2UgKyAnJScgOiAnZGlzcGxheTogbm9uZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICB2bS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuc2VsZWN0aW9uLm9uLnJvd1NlbGVjdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9iYXRjaC8nICsgcm93LmVudGl0eS5pZCkuc2VhcmNoKCcnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZtLmJhdGNoZXNQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgIHZtLmJhdGNoZXNQYXJhbXMucGFnZV9zaXplID0gcGFnZVNpemU7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEJhdGNoZXNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlQmF0Y2hPcmRlcihzb3J0QXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0QmF0Y2hlc1BhcmFtcyh2bS5iYXRjaGVzUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICB2bS5yZWFkb25seSA9ICEodXNlciAmJiB1c2VyLmlzX2FkbWluKTtcbiAgICAgICAgICAgIHZtLmdldFJlY2lwZVR5cGVzKClcbiAgICAgICAgICAgICAgICAudGhlbih2bS5nZXRCYXRjaGVzKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2JhdGNoJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkUmVjaXBlVHlwZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gXy5maW5kKHZtLnJlY2lwZVR5cGVWYWx1ZXMsIHtpZDogcGFyc2VJbnQodmFsdWUpfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeVJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZVJlY2lwZVR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRCeVJlY2lwZVR5cGUgPSAhYW5ndWxhci5lcXVhbHModmFsdWUsIHJlY2lwZVR5cGVWaWV3QWxsKTtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlUmVjaXBlVHlwZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEJhdGNoU3RhdHVzJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5QmF0Y2hTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlQmF0Y2hTdGF0dXModmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRCeUJhdGNoU3RhdHVzID0gdmFsdWUgIT09ICdWSUVXIEFMTCc7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlQmF0Y2hTdGF0dXModmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdGFydCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uYmF0Y2hlc1BhcmFtcy5zdGFydGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmxhc3RNb2RpZmllZFN0b3AnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmJhdGNoZXNQYXJhbXMuZW5kZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXRCYXRjaGVzQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0QmF0Y2hlc1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5iYXRjaGVzUGFyYW1zID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnQmF0Y2gnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGUsIFJlY2lwZVR5cGUpIHtcbiAgICAgICAgdmFyIEJhdGNoID0gZnVuY3Rpb24gKGlkLCB0aXRsZSwgZGVzY3JpcHRpb24sIHN0YXR1cywgcmVjaXBlX3R5cGUsIGV2ZW50LCBjcmVhdG9yX2pvYiwgZGVmaW5pdGlvbiwgY3JlYXRlZF9jb3VudCwgZmFpbGVkX2NvdW50LCB0b3RhbF9jb3VudCwgY3JlYXRlZCwgbGFzdF9tb2RpZmllZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkIHx8IG51bGw7XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGUgfHwgbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbiB8fCBudWxsO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXMgfHwgbnVsbDtcbiAgICAgICAgICAgIHRoaXMucmVjaXBlX3R5cGUgPSByZWNpcGVfdHlwZSA/IFJlY2lwZVR5cGUudHJhbnNmb3JtZXIocmVjaXBlX3R5cGUpIDogbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZXZlbnQgPSBldmVudCB8fCBudWxsO1xuICAgICAgICAgICAgdGhpcy5jcmVhdG9yX2pvYiA9IGNyZWF0b3Jfam9iID8ge1xuICAgICAgICAgICAgICAgIGlkOiBjcmVhdG9yX2pvYi5pZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlOiBjcmVhdG9yX2pvYi5qb2JfdHlwZSA/IEpvYlR5cGUudHJhbnNmb3JtZXIoY3JlYXRvcl9qb2Iuam9iX3R5cGUpIDogbnVsbCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9yZXY6IGNyZWF0b3Jfam9iLmpvYl90eXBlX3JldiB8fCBudWxsLFxuICAgICAgICAgICAgICAgIGV2ZW50OiBjcmVhdG9yX2pvYi5ldmVudCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHN0YXR1czogY3JlYXRvcl9qb2Iuc3RhdHVzIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IGNyZWF0b3Jfam9iLnByaW9yaXR5IHx8IG51bGwsXG4gICAgICAgICAgICAgICAgbnVtX2V4ZXM6IGNyZWF0b3Jfam9iLm51bV9leGVzIHx8IG51bGxcbiAgICAgICAgICAgIH0gOiB7fTtcbiAgICAgICAgICAgIHRoaXMuZGVmaW5pdGlvbiA9IGRlZmluaXRpb24gPyB7XG4gICAgICAgICAgICAgICAgdmVyc2lvbjogc2NhbGVDb25maWcuYmF0Y2hEZWZpbml0aW9uVmVyc2lvbixcbiAgICAgICAgICAgICAgICBkYXRlX3JhbmdlOiBkZWZpbml0aW9uLmRhdGVfcmFuZ2UgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBqb2JfbmFtZXM6IGRlZmluaXRpb24uam9iX25hbWVzIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgYWxsX2pvYnM6IGRlZmluaXRpb24uYWxsX2pvYnMgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogZGVmaW5pdGlvbi5wcmlvcml0eSB8fCBudWxsXG4gICAgICAgICAgICB9IDogeyB2ZXJzaW9uOiBzY2FsZUNvbmZpZy5iYXRjaERlZmluaXRpb25WZXJzaW9uIH07XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfY291bnQgPSBjcmVhdGVkX2NvdW50IHx8IDA7XG4gICAgICAgICAgICB0aGlzLmZhaWxlZF9jb3VudCA9IGZhaWxlZF9jb3VudCB8fCAwO1xuICAgICAgICAgICAgdGhpcy50b3RhbF9jb3VudCA9IHRvdGFsX2NvdW50IHx8IDA7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMoY3JlYXRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEJhdGNoLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGNsZWFuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldHVybk9iaiA9IHtcbiAgICAgICAgICAgICAgICAgICAgcmVjaXBlX3R5cGVfaWQ6IHRoaXMucmVjaXBlX3R5cGUgPyB0aGlzLnJlY2lwZV90eXBlLmlkIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkZWZpbml0aW9uOiB0aGlzLmRlZmluaXRpb25cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBlbXB0eS9udWxsL3VuZGVmaW5lZCB2YWx1ZXMgZnJvbSByZXR1cm5PYmpcbiAgICAgICAgICAgICAgICByZXR1cm4gXy5waWNrKHJldHVybk9iaiwgXy5pZGVudGl0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEJhdGNoLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldHVybk9iaiA9IG5ldyBCYXRjaChcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVjaXBlX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRvcl9qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVmaW5pdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZhaWxlZF9jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50b3RhbF9jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBlbXB0eS9udWxsL3VuZGVmaW5lZCB2YWx1ZXMgZnJvbSByZXR1cm5PYmpcbiAgICAgICAgICAgICAgICByZXR1cm5PYmogPSBfLnBpY2socmV0dXJuT2JqLCBfLmlkZW50aXR5KTtcbiAgICAgICAgICAgICAgICAvLyByZXN0b3JlIDAgY291bnRzIGlmIG5lY2Vzc2FyeVxuICAgICAgICAgICAgICAgIHJldHVybk9iai5jcmVhdGVkX2NvdW50ID0gdHlwZW9mIHJldHVybk9iai5jcmVhdGVkX2NvdW50ID09PSAndW5kZWZpbmVkJyA/IDAgOiByZXR1cm5PYmouY3JlYXRlZF9jb3VudDtcbiAgICAgICAgICAgICAgICByZXR1cm5PYmouZmFpbGVkX2NvdW50ID0gdHlwZW9mIHJldHVybk9iai5mYWlsZWRfY291bnQgPT09ICd1bmRlZmluZWQnID8gMCA6IHJldHVybk9iai5mYWlsZWRfY291bnQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqLnRvdGFsX2NvdW50ID0gdHlwZW9mIHJldHVybk9iai50b3RhbF9jb3VudCA9PT0gJ3VuZGVmaW5lZCcgPyAwIDogcmV0dXJuT2JqLnRvdGFsX2NvdW50O1xuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5PYmo7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEJhdGNoKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgQmF0Y2gudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChCYXRjaC5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gQmF0Y2guYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEJhdGNoO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnYmF0Y2hTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsICRxLCAkcmVzb3VyY2UsIHNjYWxlQ29uZmlnKSB7XG5cbiAgICAgICAgdmFyIGdldEJhdGNoZXNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIsIHN0YXR1cykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlcixcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1c1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0QmF0Y2hlczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRCYXRjaGVzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoKSArICdiYXRjaGVzLyc7XG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRCYXRjaEJ5SWQ6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoKSArICdiYXRjaGVzLycgKyBpZCArICcvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJ1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZhbGlkYXRlQmF0Y2g6IGZ1bmN0aW9uIChiYXRjaCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnYmF0Y2hlcy92YWxpZGF0aW9uLycsIGJhdGNoLmNsZWFuKCkpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2F2ZUJhdGNoOiBmdW5jdGlvbiAoYmF0Y2gpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2JhdGNoZXMvJywgYmF0Y2guY2xlYW4oKSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzRGF0YUZlZWRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgc2NhbGVDb25maWcsIGxvYWRTZXJ2aWNlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGRheXMgPSBbXSxcbiAgICAgICAgICAgIGhvdXJzID0gWzAsMSwyLDMsNCw1LDYsNyw4LDksMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMTgsMTksMjAsMjEsMjIsMjNdLFxuICAgICAgICAgICAgdmFsdWVzID0ge307XG4gICAgICAgIFxuICAgICAgICB2YXIgcHJvY2Vzc05ld0ZlZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkYXlzID0gW107XG4gICAgICAgICAgICB2YXIgZGF5ID0gJyc7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmZlZWQpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLmZlZWQudmFsdWVzLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWxkYXkgPSBtb21lbnQudXRjKHZhbC50aW1lKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbGhvdXIgPSBtb21lbnQudXRjKHZhbC50aW1lKS5ob3VyKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IHZhbGRheSArICdfJyArIHZhbGhvdXI7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpZF0gPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxkYXkgIT09IGRheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5ID0gdmFsZGF5O1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5cy5wdXNoKHZhbGRheSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBidWlsZFRhYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGJ1aWxkVGFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY3VyckRheSA9IG1vbWVudCgpLnV0YygpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXkpO1xuICAgICAgICAgICAgdmFyIGN1cnJIb3VyID0gbW9tZW50KCkudXRjKCkuaG91cigpO1xuXG4gICAgICAgICAgICB2YXIgdGFibGVfaHRtbCA9ICc8ZGl2IGNsYXNzPVwidGFibGUtcmVzcG9uc2l2ZVwiPjx0YWJsZT4nO1xuICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPHRyPjx0aD5Ib3VyIChVVEMpPC90aD4nO1xuICAgICAgICAgICAgZm9yKGRheSBpbiBkYXlzKSB7XG4gICAgICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPHRkIGNsYXNzPVwiZGF5LWxhYmVsXCIgdGl0bGU9XCInICsgZGF5c1tkYXldICsgJ1wiPjxkaXYgY2xhc3M9XCJkYXktb2Ytd2Vla1wiPicgKyBzY2FsZVNlcnZpY2UuZ2V0RGF5U3RyaW5nKG1vbWVudChkYXlzW2RheV0pLmRheSgpKSArICc8L2Rpdj4nICsgbW9tZW50KGRheXNbZGF5XSkuZm9ybWF0KCdNTS9ERCcpICsgJzwvdGQ+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzwvdHI+JztcbiAgICAgICAgICAgIGZvcih2YXIgaG91ciBpbiBob3Vycykge1xuICAgICAgICAgICAgICAgIGhvdXIgPSAyMy1ob3VyO1xuICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0cj4nO1xuICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0aCB0aXRsZT1cIicgKyBob3Vyc1tob3VyXSArICc6MDBcIj4nICsgaG91cnNbaG91cl0gKyAnPC90aD4nO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBkYXkgaW4gZGF5cykge1xuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gIGRheXNbZGF5XSArICdfJyArIGhvdXJzW2hvdXJdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZXMgPSB2YWx1ZXNba2V5XS5maWxlcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNpemUgPSB2YWx1ZXNba2V5XS5zaXplO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2xzID0gJ2dvb2QnO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF5c1tkYXldID09PSBjdXJyRGF5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG91cnNbaG91cl0gPT09IGN1cnJIb3VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xzID0gJ2N1cnJlbnQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaG91cnNbaG91cl0gPiBjdXJySG91cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNscyA9ICdmdXR1cmUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlcyA9PT0gMCAmJiBzaXplID09PSAwICYmIGNscyAhPT0gJ2N1cnJlbnQnICYmIGNscyAhPT0gJ2Z1dHVyZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNscyA9ICd1bmtub3duJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8dGQgaWQ9XCInICsga2V5ICsgJ1wiIHRpdGxlPVwiJyArIGRheXNbZGF5XSArICcgJyArIGhvdXJzW2hvdXJdICsgJzowMFwiPic7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjbHMgPT09ICdmdXR1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCIgaWQ9XCJzcGFuXycgKyBkYXlzW2RheV0gKyAnXycgKyBob3Vyc1tob3VyXSArICdcIiBzdHlsZT1cImRpc3BsYXk6IGJsb2NrO1wiPiZuYnNwOzwvc3Bhbj48L3RkPic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzxzcGFuIGNsYXNzPVwiJyArIGNscyArICdcIiBpZD1cInNwYW5fJyArIGRheXNbZGF5XSArICdfJyArIGhvdXJzW2hvdXJdICsgJ1wiIHN0eWxlPVwiZGlzcGxheTogYmxvY2s7XCI+JyArIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyhzaXplLDEpICsgJyAvICcgKyBmaWxlcyArICc8L3NwYW4+PC90ZD4nO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPC90cj4nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPC90YWJsZT48L2Rpdj4nO1xuICAgICAgICAgICAgJCgnI2hpc3RvcnknKS5odG1sKHRhYmxlX2h0bWwpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdmZWVkJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5mZWVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NOZXdGZWVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pLmRpcmVjdGl2ZSgnYWlzRGF0YUZlZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzRGF0YUZlZWRDb250cm9sbGVyJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jaGFydHMvZGF0YUZlZWQvZGF0YUZlZWRUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGZlZWQ6ICc9JyAvLyBGZWVkIGRhdGFcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzRG9udXRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBjb2xEYXRhID0gW10sXG4gICAgICAgICAgICBjaGFydCA9IG51bGw7XG5cbiAgICAgICAgdmFyIGdlbkNoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKGNoYXJ0KSB7XG4gICAgICAgICAgICAgICAgdmFyIG9sZERhdGEgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSWRzID0gW107XG5cbiAgICAgICAgICAgICAgICAvLyByZWFzc2VtYmxlIGN1cnJlbnRseSBkaXNwbGF5ZWQgZGF0YSB0byBtYXRjaCBjb2xEYXRhXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNoYXJ0LmRhdGEoKSwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgb2xkRGF0YS5wdXNoKFtkLnZhbHVlc1swXS5pZCwgZC52YWx1ZXNbMF0udmFsdWVdKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIGRldGVybWluZSB3aGljaCBlbGVtZW50cyB0byByZW1vdmVcbiAgICAgICAgICAgICAgICBfLmZvckVhY2gob2xkRGF0YSwgZnVuY3Rpb24gKG9kKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBrZWVwID0gXy5maW5kKGNvbERhdGEsIGZ1bmN0aW9uIChjZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNkWzBdID09PSBvZFswXTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICgha2VlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSWRzLnB1c2gob2RbMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgY2hhcnRcbiAgICAgICAgICAgICAgICBjaGFydC5sb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgdW5sb2FkOiByZW1vdmVJZHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2hhcnQgPSBjMy5nZW5lcmF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJpbmR0bzogJGVsZW1lbnRbMF0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IGNvbERhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAkc2NvcGUudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvd246IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9yZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZzogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3llbGxvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cDogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyZWVuLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbXBsZXRlZDogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyZWVuLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERvbmU6ICcjMzY4MWJmJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBRdWV1ZTogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3llbGxvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYWlsZWQ6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9yZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQUxHT1JJVEhNOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgREFUQTogc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTWVNURU06IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX3N5c3RlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPZmZsaW5lOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdIaWdoIEZhaWx1cmUgUmF0ZSc6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9vcmFuZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF1c2VkOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfeWVsbG93XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA3MDBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGllOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogZDMuZm9ybWF0KCcsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiAkc2NvcGUuc2hvd0xhYmVsID8gZDMuZm9ybWF0KCcsJykgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICRzY29wZS53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAkc2NvcGUubmFtZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZDMuZm9ybWF0KCcsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAkc2NvcGUuc2l6ZSB8fCAzMjBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGVsZW1lbnRbMF0uc3R5bGUucG9zaXRpb24gPSAnc3RhdGljJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdENvbHVtbkRhdGEgPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIGNvbERhdGEgPSBbXTtcbiAgICAgICAgICAgICRzY29wZS5kYXRhLmZvckVhY2goZnVuY3Rpb24gKG9iail7XG4gICAgICAgICAgICAgICAgY29sRGF0YS5wdXNoKFtvYmouc3RhdHVzLG9iai5jb3VudF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbml0Q29sdW1uRGF0YSgpO1xuICAgICAgICAgICAgZ2VuQ2hhcnQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFydCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHdpbmRvdy5vbnJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdlbkNoYXJ0KCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzRG9udXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzRG9udXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnPScsXG4gICAgICAgICAgICAgICAgc2l6ZTogJz0nLFxuICAgICAgICAgICAgICAgIHNob3dMYWJlbDogJz0nLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnPScsXG4gICAgICAgICAgICAgICAgbmFtZTogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNSYWRpYWxQZXJjZW50YWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCBzY2FsZUNvbmZpZykge1xuICAgIHZhciBpc0luaXRpYWxpemVkID0gZmFsc2UsXG4gICAgICAgIGZvcmVncm91bmQgPSAnJyxcbiAgICAgICAgdGV4dCA9ICcnLFxuICAgICAgICBhcmNUd2VlbiA9ICcnLFxuICAgICAgICB0ZXh0VHdlZW4gPSAnJztcblxuICAgIHZhciBnZXRGb3JlZ3JvdW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdmFsdWUgPSBwYXJzZUZsb2F0KCRzY29wZS5wZXJjZW50YWdlKTtcbiAgICAgICAgaWYgKHZhbHVlID49IDc1KSB7XG4gICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyZWVuO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgNzUgJiYgdmFsdWUgPj0gNTApIHtcbiAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfeWVsbG93O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9yZWQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGhhbmRsZSBpbnB1dCBlaXRoZXIgLjgzIG9yIDgzXG4gICAgICAgIHZhciBwZXJjZW50YWdlID0gJHNjb3BlLnBlcmNlbnRhZ2UgfHwgMDtcbiAgICAgICAgaWYgKHBlcmNlbnRhZ2UgPiAxKSB7XG4gICAgICAgICAgICBwZXJjZW50YWdlIC89IDEwMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNpemUgdGhlIGNoYXJ0IHRvIHRoZSBwYXJlbnQgY29udGFpbmVyLiBJdCdzIHNxdWFyZSwgc28gdGFrZSB0aGVcbiAgICAgICAgLy8gc21hbGxlciBvZiB3aWR0aC9oZWlnaHRcbiAgICAgICAgdmFyIHNpemUgPSAkZWxlbWVudFswXS5wYXJlbnROb2RlLmNsaWVudFdpZHRoO1xuICAgICAgICBpZiAoJGVsZW1lbnRbMF0ucGFyZW50Tm9kZS5jbGllbnRIZWlnaHQgPCBzaXplKSB7XG4gICAgICAgICAgICBzaXplID0gJGVsZW1lbnRbMF0ucGFyZW50Tm9kZS5jbGllbnRIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHZhciBmb3JtYXRQZXJjZW50ID0gZDMuZm9ybWF0KCcuMCUnKTtcblxuICAgICAgICB2YXIgYXJjID0gZDMuc3ZnLmFyYygpXG4gICAgICAgICAgICAuc3RhcnRBbmdsZSgwKVxuICAgICAgICAgICAgLm91dGVyUmFkaXVzKHNpemUgKiAwLjk1IC8gMilcbiAgICAgICAgICAgIC5pbm5lclJhZGl1cyhzaXplICogMC44MCAvIDIpO1xuXG4gICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoJGVsZW1lbnRbMF0pLmFwcGVuZCgnc3ZnJykuYXR0cih7XG4gICAgICAgICAgICB3aWR0aDogc2l6ZSxcbiAgICAgICAgICAgIGhlaWdodDogc2l6ZVxuICAgICAgICB9KS5hcHBlbmQoJ2cnKS5hdHRyKHtcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAndHJhbnNsYXRlKCcgKyBzaXplIC8gMiArICcsJyArIHNpemUgLyAyICsgJyknLFxuICAgICAgICAgICAgJ2NsYXNzJzogJ2Fpc1JhZGlhbCdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIG1ldGVyID0gc3ZnLmFwcGVuZCgnZycpLmF0dHIoe1xuICAgICAgICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMTgwKSdcbiAgICAgICAgfSk7XG4gICAgICAgIG1ldGVyLmFwcGVuZCgncGF0aCcpXG4gICAgICAgICAgICAuZGF0dW0oe1xuICAgICAgICAgICAgICAgIGVuZEFuZ2xlOiAoMiAqIE1hdGguUEkpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdiYWNrZ3JvdW5kJylcbiAgICAgICAgICAgIC5hdHRyKCdkJywgYXJjKTtcblxuICAgICAgICBmb3JlZ3JvdW5kID0gbWV0ZXIuYXBwZW5kKCdwYXRoJylcbiAgICAgICAgICAgIC5kYXR1bSh7XG4gICAgICAgICAgICAgICAgZW5kQW5nbGU6IDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAgICAgJ2QnOiBhcmNcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldEZvcmVncm91bmQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRleHQgPSBzdmcuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgIC5kYXR1bSh7XG4gICAgICAgICAgICAgICAgcGVyY2VudGFnZTogMFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgLmF0dHIoJ2R5JywgJy4zNWVtJyk7XG5cblxuICAgICAgICB0ZXh0VHdlZW4gPSBmdW5jdGlvbiAodHJhbnNpdGlvbiwgbmV3UGVyY2VudGFnZSkge1xuICAgICAgICAgICAgdHJhbnNpdGlvbi5hdHRyVHdlZW4oJ3RleHQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBpID0gZDMuaW50ZXJwb2xhdGUoZC5wZXJjZW50YWdlLCBuZXdQZXJjZW50YWdlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5wZXJjZW50YWdlID0gaSh0KTtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC50ZXh0KGZvcm1hdFBlcmNlbnQoaSh0KSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgYXJjVHdlZW4gPSBmdW5jdGlvbiAodHJhbnNpdGlvbiwgbmV3QW5nbGUpIHtcbiAgICAgICAgICAgIHRyYW5zaXRpb24uYXR0clR3ZWVuKCdkJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IGQzLmludGVycG9sYXRlKGQuZW5kQW5nbGUsIG5ld0FuZ2xlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5lbmRBbmdsZSA9IGkodCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcmMoZCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGlzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG4gICAgICAgIHJlZHJhdyhwZXJjZW50YWdlKTtcbiAgICB9O1xuXG4gICAgdmFyIHJlZHJhdyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBpZiAoaXNJbml0aWFsaXplZCkge1xuICAgICAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmIChwZXJjZW50YWdlID4gMSkge1xuICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2UgLz0gMTAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3JlZ3JvdW5kLnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEZvcmVncm91bmQoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYWxsKGFyY1R3ZWVuLCAoTWF0aC5QSSAqIDIpICogcGVyY2VudGFnZSk7XG4gICAgICAgICAgICB0ZXh0LnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDAwKS5jYWxsKHRleHRUd2VlbiwgcGVyY2VudGFnZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLiR3YXRjaCgncGVyY2VudGFnZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgJiYgIWlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIGluaXRpYWxpemUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlZHJhdyh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9KVxufSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzUmFkaWFsUGVyY2VudGFnZScsIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBjb250cm9sbGVyOiAnYWlzUmFkaWFsUGVyY2VudGFnZUNvbnRyb2xsZXInLFxuICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgcGVyY2VudGFnZTogJ0AnXG4gICAgICAgIH1cbiAgICB9O1xufSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0pvYkxvYWRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgbG9hZFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcyxcbiAgICAgICAgICAgIGNoYXJ0ID0gbnVsbCxcbiAgICAgICAgICAgIGNvbEFyciA9IFtdLFxuICAgICAgICAgICAgeEFyciA9IFtdO1xuXG4gICAgICAgIHZtLmZpbHRlclZhbHVlID0gMTtcbiAgICAgICAgdm0uZmlsdGVyRHVyYXRpb24gPSAndyc7XG4gICAgICAgIHZtLmZpbHRlckR1cmF0aW9ucyA9IFsnTScsICd3JywgJ2QnXTtcbiAgICAgICAgdm0uem9vbUVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdm0uem9vbUNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgdm0uem9vbVRleHQgPSAnRW5hYmxlIFpvb20nO1xuICAgICAgICB2bS5qb2JMb2FkRGF0YSA9IHt9O1xuICAgICAgICB2bS5sb2FkaW5nSm9iTG9hZCA9IHRydWU7XG4gICAgICAgIHZtLmpvYkxvYWRFcnJvciA9IG51bGw7XG4gICAgICAgIHZtLmpvYkxvYWRFcnJvclN0YXR1cyA9IG51bGw7XG4gICAgICAgIHZtLnRvdGFsID0gMDtcbiAgICAgICAgdm0uY2hhcnRTdHlsZSA9ICcnO1xuXG4gICAgICAgIHZhciBqb2JMb2FkUGFyYW1zID0ge1xuICAgICAgICAgICAgc3RhcnRlZDogbW9tZW50LnV0YygpLnN1YnRyYWN0KHZtLmZpbHRlclZhbHVlLCB2bS5maWx0ZXJEdXJhdGlvbikuc3RhcnRPZignZCcpLnRvRGF0ZSgpLCBlbmRlZDogbW9tZW50LnV0YygpLmVuZE9mKCdkJykudG9EYXRlKCksIGpvYl90eXBlX2lkOiBudWxsLCBqb2JfdHlwZV9uYW1lOiBudWxsLCBqb2JfdHlwZV9jYXRlZ29yeTogbnVsbCwgdXJsOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udG9nZ2xlWm9vbSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnpvb21FbmFibGVkID0gIXZtLnpvb21FbmFibGVkO1xuICAgICAgICAgICAgY2hhcnQuem9vbS5lbmFibGUodm0uem9vbUVuYWJsZWQpO1xuICAgICAgICAgICAgaWYgKHZtLnpvb21FbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgdm0uem9vbUNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgICAgICAgICB2bS56b29tVGV4dCA9ICdEaXNhYmxlIFpvb20nO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS56b29tQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgICAgIHZtLnpvb21UZXh0ID0gJ0VuYWJsZSBab29tJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdENoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgeEFyciA9IFtdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB4QXJyID0gXy5wbHVjayh2bS5qb2JMb2FkRGF0YS5yZXN1bHRzLCAndGltZScpO1xuICAgICAgICAgICAgXy5mb3JFYWNoKHhBcnIsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICAgICAgeEFycltpXSA9IG1vbWVudC51dGMoZCkudG9EYXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHhBcnIudW5zaGlmdCgneCcpO1xuXG4gICAgICAgICAgICB2YXIgcGVuZGluZ0FyciA9IF8ucGx1Y2sodm0uam9iTG9hZERhdGEucmVzdWx0cywgJ3BlbmRpbmdfY291bnQnKSxcbiAgICAgICAgICAgICAgICBxdWV1ZWRBcnIgPSBfLnBsdWNrKHZtLmpvYkxvYWREYXRhLnJlc3VsdHMsICdxdWV1ZWRfY291bnQnKSxcbiAgICAgICAgICAgICAgICBydW5uaW5nQXJyID0gXy5wbHVjayh2bS5qb2JMb2FkRGF0YS5yZXN1bHRzLCAncnVubmluZ19jb3VudCcpO1xuXG4gICAgICAgICAgICBwZW5kaW5nQXJyLnVuc2hpZnQoJ1BlbmRpbmcnKTtcbiAgICAgICAgICAgIHF1ZXVlZEFyci51bnNoaWZ0KCdRdWV1ZWQnKTtcbiAgICAgICAgICAgIHJ1bm5pbmdBcnIudW5zaGlmdCgnUnVubmluZycpO1xuXG4gICAgICAgICAgICAvLyBhZGQgdG8gY29sQXJyXG4gICAgICAgICAgICBjb2xBcnIgPSBbeEFyciwgcGVuZGluZ0FyciwgcXVldWVkQXJyLCBydW5uaW5nQXJyXTtcblxuICAgICAgICAgICAgdmFyIHR5cGVzID0ge30sXG4gICAgICAgICAgICAgICAgdHlwZSA9IHt9LFxuICAgICAgICAgICAgICAgIGdyb3VwcyA9IFtdO1xuXG4gICAgICAgICAgICBfLmZvckVhY2goY29sQXJyLCBmdW5jdGlvbihjb2wpe1xuICAgICAgICAgICAgICAgIHR5cGUgPSB7fTtcbiAgICAgICAgICAgICAgICBpZiAoY29sWzBdICE9PSAneCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZVtjb2xbMF1dID0gJ2FyZWEnO1xuICAgICAgICAgICAgICAgICAgICBncm91cHMucHVzaChjb2xbMF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh0eXBlcywgdHlwZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGNoYXJ0KSB7XG4gICAgICAgICAgICAgICAgY2hhcnQuZmx1c2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNoYXJ0IGNvbmZpZ1xuICAgICAgICAgICAgY2hhcnQgPSBjMy5nZW5lcmF0ZSh7XG4gICAgICAgICAgICAgICAgYmluZHRvOiAnI2pvYi1sb2FkJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHg6ICd4JyxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sQXJyLFxuICAgICAgICAgICAgICAgICAgICB0eXBlczogdHlwZXMsXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwczogW2dyb3Vwc10sXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgUGVuZGluZzogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3BpbmssXG4gICAgICAgICAgICAgICAgICAgICAgICBRdWV1ZWQ6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9wdXJwbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBSdW5uaW5nOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfYmx1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA3MDBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0Yyh4KS5zdGFydE9mKCdoJykuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBheGlzOiB7XG4gICAgICAgICAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0aW1lc2VyaWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpY2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKGQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0ubG9hZGluZ0pvYkxvYWQgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iTG9hZCA9IGZ1bmN0aW9uIChzaG93UGFnZUxvYWQpIHtcbiAgICAgICAgICAgIGlmIChzaG93UGFnZUxvYWQpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHBhcmVudC5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ0pvYkxvYWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgam9iTG9hZFBhcmFtcy5zdGFydGVkID0gbW9tZW50LnV0YygpLnN1YnRyYWN0KHZtLmZpbHRlclZhbHVlLCB2bS5maWx0ZXJEdXJhdGlvbikuc3RhcnRPZignZCcpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgam9iTG9hZFBhcmFtcy5lbmRlZCA9IG1vbWVudC51dGMoam9iTG9hZFBhcmFtcy5zdGFydGVkKS5hZGQoMSwgdm0uZmlsdGVyRHVyYXRpb24pLmVuZE9mKCdkJykudG9EYXRlKCk7XG4gICAgICAgICAgICBqb2JMb2FkUGFyYW1zLnBhZ2Vfc2l6ZSA9IDEwMDA7XG5cbiAgICAgICAgICAgIGxvYWRTZXJ2aWNlLmdldEpvYkxvYWQoam9iTG9hZFBhcmFtcykudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uam9iTG9hZERhdGEgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIGluaXRDaGFydCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzVGV4dCAmJiByZXN1bHQuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmpvYkxvYWRFcnJvclN0YXR1cyA9IHJlc3VsdC5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYkxvYWRFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgam9iIGxvYWQuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNob3dQYWdlTG9hZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJHBhcmVudC5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZ0pvYkxvYWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JMb2FkUmFuZ2UgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnb2xkZXInKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyVmFsdWUrKztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnbmV3ZXInKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmZpbHRlclZhbHVlID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5maWx0ZXJWYWx1ZS0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAndG9kYXknKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyVmFsdWUgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2V0Sm9iTG9hZCh0cnVlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5maWx0ZXJWYWx1ZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdmFyICRqb2JMb2FkTmV3ZXIgPSAkKCcuam9iLWxvYWQtbmV3ZXInKSxcbiAgICAgICAgICAgICAgICAkam9iTG9hZFRvZGF5ID0gJCgnLmpvYi1sb2FkLXRvZGF5Jyk7XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZSA+IDEpIHtcbiAgICAgICAgICAgICAgICAkam9iTG9hZE5ld2VyLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgJGpvYkxvYWRUb2RheS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkam9iTG9hZE5ld2VyLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgJGpvYkxvYWRUb2RheS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuXG4gICAgICAgIGlmICgkc2NvcGUuYXV0b0hlaWdodCkge1xuICAgICAgICAgICAgLy8gc2V0IGNoYXJ0IGhlaWdodFxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gc2V0IGNvbnRhaW5lciBoZWlnaHRzIGVxdWFsIHRvIGF2YWlsYWJsZSBwYWdlIGhlaWdodFxuICAgICAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJPZmZzZXQgPSAkKCcuam9iLWxvYWQtaGVhZGVyJykuaGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgIGxlZ2VuZE9mZnNldCA9ICQoJy5qb2ItbG9hZC1sZWdlbmQtbGFiZWwnKS5oZWlnaHQoKSxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyT2Zmc2V0ID0gJCgnLmpvYi1sb2FkLWZpbHRlcicpLm91dGVySGVpZ2h0KHRydWUpLFxuICAgICAgICAgICAgICAgICAgICBjaGFydE1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldCAtIGhlYWRlck9mZnNldCAtIGxlZ2VuZE9mZnNldCAtIGZpbHRlck9mZnNldCAtIDU7XG5cbiAgICAgICAgICAgICAgICB2bS5jaGFydFN0eWxlID0gJ2hlaWdodDogJyArIGNoYXJ0TWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY2hhcnRNYXhIZWlnaHQgKyAncHg7JztcbiAgICAgICAgICAgICAgICBnZXRKb2JMb2FkKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdldEpvYkxvYWQoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNKb2JMb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0pvYkxvYWRDb250cm9sbGVyJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jaGFydHMvam9iTG9hZC9qb2JMb2FkVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBzaG93RmlsdGVyOiAnPScsIC8vIHNob3cgdGltZSByYW5nZSBmaWx0ZXIgVUlcbiAgICAgICAgICAgICAgICBjdWxsTGVnZW5kOiAnPScsIC8vIG9ubHkgc2hvdyBqb2IgdHlwZXMgaW4gbGVnZW5kIHdob3NlIHZhbHVlIGlzID4gMFxuICAgICAgICAgICAgICAgIGhpZGVUaXRsZTogJz0nLFxuICAgICAgICAgICAgICAgIGF1dG9IZWlnaHQ6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzR3JpZENoYXJ0Q29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHVpYk1vZGFsLCB1c2VyU2VydmljZSwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgc3ZnID0gbnVsbCxcbiAgICAgICAgICAgIHJlY3QgPSBudWxsLFxuICAgICAgICAgICAgc2NhbGUgPSBwYXJzZUZsb2F0KCRzY29wZS5zY2FsZSksXG4gICAgICAgICAgICB0aXAgPSBkMy50aXAoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxuICAgICAgICAgICAgICAgIC5vZmZzZXQoWy0xMCwgMF0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBkLnN0YXR1cy5nZXRGYWlsdXJlcygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFN0ciA9IGZhaWx1cmVzLmxlbmd0aCA+IDAgPyAnPGJyIC8+PGJyIC8+JyA6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcnVubmluZyA9IGdldENlbGxBY3Rpdml0eVRvdGFsKGQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gZ2V0Q2VsbFRvdGFsKGQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzU3RyID0gcnVubmluZyA+IDAgfHwgY29tcGxldGVkID4gMCA/ICc8YnIgLz4nIDogJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bm5pbmcgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNTdHIgPSBzdGF0dXNTdHIgKyAnPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC1ydW5uaW5nXCI+UnVubmluZzogJyArIHJ1bm5pbmcgKyAnPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlZCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1N0ciA9IHN0YXR1c1N0ciArICcgPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC1jb21wbGV0ZWRcIj5Db21wbGV0ZWQ6ICcgKyBjb21wbGV0ZWQgKyAnPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmYWlsdXJlcyA9IF8uc29ydEJ5T3JkZXIoZmFpbHVyZXMsIFsnb3JkZXInXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZhaWx1cmVzLCBmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFN0ciA9IGZhaWxTdHIgKyAnPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC0nICsgZi5zdGF0dXMudG9Mb3dlckNhc2UoKSArICdcIj4nICsgXy5jYXBpdGFsaXplKGYuc3RhdHVzLnRvTG93ZXJDYXNlKCkpICsgJzogJyArIGYuY291bnQgKyAnPC9zcGFuPiAnO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQudGl0bGUgKyAnICcgKyBkLnZlcnNpb24gKyAnPGJyIC8+JyArIHN0YXR1c1N0ciArIGZhaWxTdHI7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjZWxsV2lkdGggPSA1MCAqIHNjYWxlLFxuICAgICAgICAgICAgY2VsbEhlaWdodCA9IDUwICogc2NhbGUsXG4gICAgICAgICAgICBlbmFibGVab29tID0gdHlwZW9mICRzY29wZS5tb2RlICE9PSAndW5kZWZpbmVkJyA/ICRzY29wZS5tb2RlID09PSAnem9vbScgOiB0cnVlLFxuICAgICAgICAgICAgZW5hYmxlVG9vbHRpcCA9IHR5cGVvZiAkc2NvcGUubW9kZSAhPT0gJ3VuZGVmaW5lZCcgPyAkc2NvcGUubW9kZSA9PT0gJ3Rvb2x0aXAnIDogZmFsc2UsXG4gICAgICAgICAgICBlbmFibGVSZXZlYWwgPSB0eXBlb2YgJHNjb3BlLnJldmVhbCAhPT0gJ3VuZGVmaW5lZCcgPyAkc2NvcGUucmV2ZWFsIDogdHJ1ZSxcbiAgICAgICAgICAgIHVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKSxcbiAgICAgICAgICAgIGdyaWREYXRhID0gW10sXG4gICAgICAgICAgICB3aWR0aCA9ICQoJy5ncmlkLWNoYXJ0Jykud2lkdGgoKSxcbiAgICAgICAgICAgIGhlaWdodCA9IChNYXRoLmNlaWwod2lkdGggLyBjZWxsV2lkdGgpICogY2VsbEhlaWdodCksXG4gICAgICAgICAgICBjb2xzID0gMCxcbiAgICAgICAgICAgIHJvd3MgPSAwLFxuICAgICAgICAgICAgY2VsbEZvbnRMZyA9IC40LFxuICAgICAgICAgICAgY2VsbEZvbnRTbSA9IC4zO1xuICAgICAgICBcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnBhdXNlUmVhc29uID0gJyc7XG4gICAgICAgIHZtLmRhdGFWYWx1ZXMgPSBbXTtcbiAgICAgICAgdm0uZ3JpZENsYXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5pY29ucyA9PT0gdHJ1ZSA/ICdpY29ucycgOiAnJztcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uZGF0YVZhbHVlcycsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaGVpZ2h0ID0gKE1hdGguY2VpbChuZXdWYWx1ZS5sZW5ndGggLyAoTWF0aC5mbG9vcih3aWR0aCAvIGNlbGxXaWR0aCkpKSAqIGNlbGxIZWlnaHQpO1xuICAgICAgICAgICAgaWYgKGVuYWJsZVpvb20pIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBoZWlnaHQgKiA2O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZDMuc2VsZWN0KCcuZ3JpZC1jaGFydC1jb250YWluZXIgc3ZnJykuYXR0cignaGVpZ2h0JywgaGVpZ2h0KTtcbiAgICAgICAgICAgIGQzLnNlbGVjdCgnLm92ZXJsYXknKS5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgZ2V0RGF0YVZhbHVlcyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBncmlkRGF0YSA9IFtdO1xuICAgICAgICAgICAgdm0uZGF0YVZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgaWYgKGRhdGEuZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhVHlwZSA9IGRhdGEuZGF0YS50b1N0cmluZygpLnNwbGl0KCcsJylbMF07XG4gICAgICAgICAgICAgICAgaWYgKGRhdGFUeXBlID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGF0YVZhbHVlcyA9IF8uc29ydEJ5T3JkZXIoXy52YWx1ZXMoZGF0YS5kYXRhKSwgWyduYW1lJ10sIFsnYXNjJ10pO1xuICAgICAgICAgICAgICAgICAgICAvLyBhc3NvY2lhdGUgSm9iVHlwZSB3aXRoIEpvYlR5cGVTdGF0dXNcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmRhdGFWYWx1ZXMsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5zdGF0dXMgPSBfLmZpbmQoZGF0YS5zdGF0dXMsICdqb2JfdHlwZS5pZCcsIHZhbC5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2bS5kYXRhVmFsdWVzID0gXy5zb3J0QnlPcmRlcihfLnZhbHVlcyhkYXRhLmRhdGEpLCBbJ3N0YXR1cy5oYXNfcnVubmluZycsICdzdGF0dXMuZGVzY3JpcHRpb24nLCAnbmFtZSddLCBbJ2FzYycsICdhc2MnLCAnYXNjJ10pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICB2bS5kYXRhVmFsdWVzID0gXy52YWx1ZXMoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgLy92bS5kYXRhVmFsdWVzID0gXy5zb3J0QnlPcmRlcihfLnZhbHVlcyhkYXRhLmRhdGEpLCBbJ2hvc3RuYW1lJ10sIFsnYXNjJ10pO1xuICAgICAgICAgICAgICAgICAgICAvLyBhc3NvY2lhdGUgTm9kZSB3aXRoIE5vZGVTdGF0dXNcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmRhdGFWYWx1ZXMsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5zdGF0dXMgPSBfLmZpbmQoZGF0YS5zdGF0dXMsICdub2RlLmlkJywgdmFsLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vdm0uZGF0YVZhbHVlcyA9IF8uc29ydEJ5T3JkZXIodm0uZGF0YVZhbHVlcywgWydob3N0bmFtZSddLCBbJ2FzYyddKTsgLy8gc29ydCBieSBob3N0TmFtZSBhc2NcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2bS5kYXRhVmFsdWVzID0gZGF0YS5kYXRhO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbHMgPSAkc2NvcGUuY29sdW1ucyA/ICRzY29wZS5jb2x1bW5zIDogTWF0aC5mbG9vcih3aWR0aCAvIGNlbGxXaWR0aCk7XG4gICAgICAgICAgICAgICAgcm93cyA9ICRzY29wZS5yb3dzID8gJHNjb3BlLnJvd3MgOiBNYXRoLmNlaWwodm0uZGF0YVZhbHVlcy5sZW5ndGggLyBjb2xzKTtcblxuICAgICAgICAgICAgICAgIGQzLnJhbmdlKHJvd3MpLm1hcChmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgICAgIGQzLnJhbmdlKGNvbHMpLm1hcChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sIDw9IHZtLmRhdGFWYWx1ZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhT2JqID0gdm0uZGF0YVZhbHVlc1soY29scyAqIHJvdykgKyBjb2xdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFPYmouY29vcmRzID0gW2NvbCAqIGNlbGxIZWlnaHQsIHJvdyAqIGNlbGxXaWR0aF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWREYXRhLnB1c2goZGF0YU9iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciByZXZlYWxEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcuY2VsbC10ZXh0JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcuY2VsbC10ZXh0LWRldGFpbCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXBhdXNlLXJlc3VtZS1pY29uJylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaGlkZURhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXRleHQnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcuY2VsbC10ZXh0LWRldGFpbCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLmNlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgY29scyA9ICRzY29wZS5jb2x1bW5zID8gJHNjb3BlLmNvbHVtbnMgOiBNYXRoLmZsb29yKHdpZHRoIC8gY2VsbFdpZHRoKTtcbiAgICAgICAgICAgIHJvd3MgPSAkc2NvcGUucm93cyA/ICRzY29wZS5yb3dzIDogTWF0aC5jZWlsKHZtLmRhdGFWYWx1ZXMubGVuZ3RoIC8gY29scyk7XG5cbiAgICAgICAgICAgIHZhciB0aWNrVmFsdWVzID0gQXJyYXkuYXBwbHkobnVsbCwge2xlbmd0aDogcm93c30pLm1hcChOdW1iZXIuY2FsbCwgTnVtYmVyKTtcblxuICAgICAgICAgICAgdmFyIHpvb20gPSBkMy5iZWhhdmlvci56b29tKClcbiAgICAgICAgICAgICAgICAuc2NhbGVFeHRlbnQoWzEsIDZdKVxuICAgICAgICAgICAgICAgIC8vLmNlbnRlcihbMCwgMF0pXG4gICAgICAgICAgICAgICAgLm9uKCd6b29tJywgem9vbWVkKTtcblxuICAgICAgICAgICAgaWYgKGVuYWJsZVpvb20pIHtcbiAgICAgICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoJy5ncmlkLWNoYXJ0JykuYXBwZW5kKCdzdmcnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignd2lkdGgnLCB3aWR0aClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGhlaWdodClcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKHpvb20pXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZW5hYmxlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdCgnLmdyaWQtY2hhcnQnKS5hcHBlbmQoJ3N2ZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0KVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwodGlwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KCcuZ3JpZC1jaGFydCcpLmFwcGVuZCgnc3ZnJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgd2lkdGgpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3ZnLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ292ZXJsYXknKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpO1xuXG4gICAgICAgICAgICBpZiAodm0uc2hvd0F4ZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGQzLnNjYWxlLmxpbmVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5kb21haW4oWzAsIHJvd3NdKVxuICAgICAgICAgICAgICAgICAgICAucmFuZ2UoWzAsIGhlaWdodC0xMF0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxuICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeSlcbiAgICAgICAgICAgICAgICAgICAgLm9yaWVudCgnbGVmdCcpXG4gICAgICAgICAgICAgICAgICAgIC50aWNrVmFsdWVzKHRpY2tWYWx1ZXMpO1xuXG4gICAgICAgICAgICAgICAgc3ZnLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIDI1ICsgJywnICsgMCArICcpJylcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICd5IGF4aXMnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgMCArICcsJyArIGNlbGxIZWlnaHQgLyAyICsgJyknKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbCh5QXhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdldERhdGFWYWx1ZXMoZGF0YSk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHpvb21lZCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcyA9IGQzLmV2ZW50LnNjYWxlO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVuYWJsZVJldmVhbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocyA+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldmVhbERhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHMgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zaG93QXhlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgem9vbS50cmFuc2xhdGUoWzI1LCAwXSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB6b29tLnRyYW5zbGF0ZShbMCwgMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN2Zy5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyB6b29tLnRyYW5zbGF0ZSgpICsgJylzY2FsZSgnICsgZDMuZXZlbnQuc2NhbGUgKyAnKScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGRyYWdPZmZzZXRYID0gMCxcbiAgICAgICAgICAgIGRyYWdPZmZzZXRZID0gMCxcbiAgICAgICAgICAgIGNsaWNrT2Zmc2V0WCA9IDAsXG4gICAgICAgICAgICBjbGlja09mZnNldFkgPSAwO1xuXG4gICAgICAgIHZhciBkcmFnID0gZDMuYmVoYXZpb3IuZHJhZygpXG4gICAgICAgICAgICAub24oJ2RyYWdzdGFydCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyB0cmFjayBvZmZzZXRYIGFuZCBvZmZzZXRZIHRvIGRpc3Rpbmd1aXNoIGJldHdlZW4gZHJhZyBhbmQgY2xpY2tcbiAgICAgICAgICAgICAgICBkcmFnT2Zmc2V0WCA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50LmxheWVyWDtcbiAgICAgICAgICAgICAgICBkcmFnT2Zmc2V0WSA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50LmxheWVyWTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBnZXRDZWxsRmlsbCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsRmlsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICdub25lJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFRleHQgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5nZXRDZWxsVGV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsQWN0aXZpdHkgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxBY3Rpdml0eSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFBhdXNlUmVzdW1lID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxQYXVzZVJlc3VtZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsQWN0aXZpdHlUb3RhbCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsQWN0aXZpdHlUb3RhbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsVGl0bGUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5nZXRDZWxsVGl0bGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbEVycm9yID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxFcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICdGYWlsZWQ6IFVuYXZhaWxhYmxlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFRvdGFsID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxUb3RhbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICdDb21wbGV0ZWQ6IFVuYXZhaWxhYmxlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFN0YXR1cyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbFN0YXR1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnU3RhdHVzIFVuYXZhaWxhYmxlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbEpvYnMgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnTm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxKb2JzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsRmFpbHVyZXMgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxGYWlsdXJlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY2VsbENsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICAgIC8vIHRyYWNrIG9mZnNldFggYW5kIG9mZnNldFkgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBkcmFnIGFuZCBjbGlja1xuICAgICAgICAgICAgY2xpY2tPZmZzZXRYID0gZDMuZXZlbnQubGF5ZXJYO1xuICAgICAgICAgICAgY2xpY2tPZmZzZXRZID0gZDMuZXZlbnQubGF5ZXJZO1xuICAgICAgICAgICAgaWYgKGRyYWdPZmZzZXRYID09PSBjbGlja09mZnNldFggJiYgZHJhZ09mZnNldFkgPT09IGNsaWNrT2Zmc2V0WSkge1xuICAgICAgICAgICAgICAgIC8vIG9mZnNldHMgYXJlIHRoZSBzYW1lOyBubyBkcmFnZ2luZyBvY2N1cnJlZDsgcHJvY2VzcyBhcyBjbGljayBldmVudFxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzJykuc2VhcmNoKCdqb2JfdHlwZV9pZCcsIHRhcmdldC5pZCkuc2VhcmNoKCdzdGF0dXMnLCB0YXJnZXQuc3RhdHVzLmhhc19ydW5uaW5nLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ub2Rlcy8nICsgdGFyZ2V0LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZWxlbSA9ICQoJy5jZWxsLWFjdGl2aXR5LWljb24nKTtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnRvKGVsZW0sIDEsIHtcbiAgICAgICAgICAgICAgICByb3RhdGlvbjogMzYwLFxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogJzUwJSA1MCUnLFxuICAgICAgICAgICAgICAgIHJlcGVhdDogLTEsXG4gICAgICAgICAgICAgICAgZWFzZTogTGluZWFyLmVhc2VOb25lXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gREFUQSBKT0lOXG4gICAgICAgICAgICAvLyBKb2luIG5ldyBkYXRhIHdpdGggb2xkIGVsZW1lbnRzLCBpZiBhbnkuXG4gICAgICAgICAgICBpZiAoZW5hYmxlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXJHcm91cCA9IHN2Zy5zZWxlY3RBbGwoJy5jZWxsLWdyb3VwJylcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCB0aXAuc2hvdylcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIHRpcC5oaWRlKVxuICAgICAgICAgICAgICAgICAgICAub24oJ2NsaWNrJywgdGlwLmhpZGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyR3JvdXAgPSBzdmcuc2VsZWN0QWxsKCcuY2VsbC1ncm91cCcpXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVUERBVEVcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBvbGQgZWxlbWVudHMgYXMgbmVlZGVkLlxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuc3RvcDEnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3N0b3AtY29sb3InLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZXNbMF0gPT09ICdTWVNURU0nID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfc3lzdGVtIDogZmFpbHVyZXNbMF0gPT09ICdEQVRBJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2RhdGEgOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5zdG9wMicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ29mZnNldCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcy5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzUwJSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZhaWx1cmVzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMTAwJSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignc3RvcC1jb2xvcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlc1sxXSA9PT0gJ1NZU1RFTScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9zeXN0ZW0gOiBmYWlsdXJlc1sxXSA9PT0gJ0RBVEEnID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSA6IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2FsZ29yaXRobTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLnN0b3AzJylcbiAgICAgICAgICAgICAgICAuYXR0cignb2Zmc2V0JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMgJiYgZmFpbHVyZXMubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMTAwJSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignc3RvcC1jb2xvcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlc1syXSA9PT0gJ1NZU1RFTScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9zeXN0ZW0gOiBmYWlsdXJlc1syXSA9PT0gJ0RBVEEnID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSA6IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2FsZ29yaXRobTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCA/ICcjZmZmJyA6ICdub25lJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBjZyA9IGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtZ3JhZGllbnQnKTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC10ZXh0JylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVGV4dChkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnICYmIGdldENlbGxBY3Rpdml0eVRvdGFsKGQpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbGxIZWlnaHQgLyAyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoY2VsbEhlaWdodCAvIDIpICsgMTA7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtdG90YWwtYWN0aXZlJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxBY3Rpdml0eVRvdGFsKGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxQYXVzZVJlc3VtZShkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1hY3Rpdml0eS1pY29uJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsQWN0aXZpdHkoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtdGl0bGUnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxUaXRsZShkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1lcnJvcicpXG4gICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEVycm9yKGQsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLXRvdGFsJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVG90YWwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtc3RhdHVzJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsU3RhdHVzKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLWpvYnMnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxKb2JzKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLW92ZXJsYXknKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbENsaWNrSGFuZGxlcih0YXJnZXQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBFTlRFUlxuICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBlbGVtZW50cyBhcyBuZWVkZWQuXG4gICAgICAgICAgICB2YXIgY2VsbEdyb3VwID0gY29udGFpbmVyR3JvdXAuZW50ZXIoKVxuICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWdyb3VwJyk7XG5cbiAgICAgICAgICAgIHZhciBkZWZzID0gY2VsbEdyb3VwLmFwcGVuZCgnZGVmcycpO1xuICAgICAgICAgICAgdmFyIGdyYWRpZW50ID0gZGVmcy5hcHBlbmQoJ2xpbmVhckdyYWRpZW50JylcbiAgICAgICAgICAgICAgICAuYXR0cignaWQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5uYW1lO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtZ3JhZGllbnQnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4MScsIDApXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3kxJywgMClcbiAgICAgICAgICAgICAgICAuYXR0cigneDInLCAwKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5MicsIDEpO1xuICAgICAgICAgICAgZ3JhZGllbnQuYXBwZW5kKCdzdG9wJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnc3RvcDEnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3N0b3AtY29sb3InLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZXNbMF0gPT09ICdTWVNURU0nID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfc3lzdGVtIDogZmFpbHVyZXNbMF0gPT09ICdEQVRBJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2RhdGEgOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ3JhZGllbnQuYXBwZW5kKCdzdG9wJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnc3RvcDInKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc1MCUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmYWlsdXJlcy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzEwMCUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3N0b3AtY29sb3InLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZXNbMV0gPT09ICdTWVNURU0nID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfc3lzdGVtIDogZmFpbHVyZXNbMV0gPT09ICdEQVRBJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2RhdGEgOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ3JhZGllbnQuYXBwZW5kKCdzdG9wJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnc3RvcDMnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzAlJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCdzdG9wLWNvbG9yJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMgJiYgZmFpbHVyZXMubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmVzWzJdID09PSAnU1lTVEVNJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX3N5c3RlbSA6IGZhaWx1cmVzWzJdID09PSAnREFUQScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9kYXRhIDogc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfYWxnb3JpdGhtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlsbChkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGNlbGxXaWR0aClcbiAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgY2VsbEhlaWdodClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnTm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlsbChkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAndXJsKCMnICsgZC5uYW1lICsgJyknO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gJyNmZmYnIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApO1xuXG4gICAgICAgICAgICBjZWxsR3JvdXAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10ZXh0JylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFRleHQoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRDZWxsQWN0aXZpdHlUb3RhbChkKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2VsbEhlaWdodCAvIDI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGNlbGxIZWlnaHQgLyAyKSArIDEwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjZWxsSGVpZ2h0IC8gMjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ05vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNjYWxlICogOCArICdweCc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZW5hYmxlUmV2ZWFsID8gJ2Jsb2NrJyA6ICdub25lJyk7XG5cbiAgICAgICAgICAgIGNlbGxHcm91cC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXRvdGFsLWFjdGl2ZScpXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEFjdGl2aXR5VG90YWwoZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIGNlbGxIZWlnaHQgLSA1KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsIGVuYWJsZVJldmVhbCA/ICdibG9jaycgOiAnbm9uZScpO1xuXG4gICAgICAgICAgICBjZWxsR3JvdXAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1hY3Rpdml0eScpXG4gICAgICAgICAgICAgICAgLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtYWN0aXZpdHktaWNvbicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIDExKVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsQWN0aXZpdHkoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnZW5kJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGNlbGxXaWR0aCAtIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCAxMyk7XG5cbiAgICAgICAgICAgIHZhciBkZXRhaWwgPSBjZWxsR3JvdXAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10ZXh0LWRldGFpbCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICouMTUpKSAvLyAxNSUgZnJvbSB0b3Agb2YgY2VsbFxuICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZW5hYmxlUmV2ZWFsID8gJ25vbmUnIDogJ2Jsb2NrJyk7XG5cbiAgICAgICAgICAgIGRldGFpbC5hcHBlbmQoJ3RzcGFuJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10aXRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICogLjE1KSkgLy8gMTUlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRTbSAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFRpdGxlKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwod3JhcCk7XG5cbiAgICAgICAgICAgIGRldGFpbC5hcHBlbmQoJ3RzcGFuJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1lcnJvcicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICouMykpIC8vIDMwJSBmcm9tIHRvcCBvZiBjZWxsXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGNlbGxGb250U20gKiBzY2FsZSArICdlbScpXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxFcnJvcihkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYWxsKHdyYXApO1xuXG4gICAgICAgICAgICBkZXRhaWwuYXBwZW5kKCd0c3BhbicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtdG90YWwnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIE1hdGguZmxvb3IoY2VsbEhlaWdodCAqLjQpKSAvLyA0MCUgZnJvbSB0b3Agb2YgY2VsbFxuICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBjZWxsRm9udFNtICogc2NhbGUgKyAnZW0nKVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVG90YWwoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2FsbCh3cmFwKTtcblxuICAgICAgICAgICAgZGV0YWlsLmFwcGVuZCgndHNwYW4nKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXN0YXR1cycpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICogLjU1KSkgLy8gNTUlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRMZyAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFN0YXR1cyhkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGV0YWlsLmFwcGVuZCgndHNwYW4nKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWpvYnMnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIE1hdGguZmxvb3IoY2VsbEhlaWdodCAqIC43NSkpIC8vIDc1JSBmcm9tIHRvcCBvZiBjZWxsXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGNlbGxGb250U20gKiBzY2FsZSArICdlbScpXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxKb2JzKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwod3JhcCk7XG5cbiAgICAgICAgICAgIGNlbGxHcm91cC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLW92ZXJsYXknKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGNlbGxXaWR0aClcbiAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgY2VsbEhlaWdodClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnI2ZmZicpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsLW9wYWNpdHknLCAnMC4yNScpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwtb3BhY2l0eScsICcwJyk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbENsaWNrSGFuZGxlcihkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYWxsKGRyYWcpO1xuXG4gICAgICAgICAgICBpZiAodXNlciAmJiB1c2VyLmlzX2FkbWluKSB7XG4gICAgICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXBhdXNlLXJlc3VtZS1pY29uJylcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsUGF1c2VSZXN1bWUoZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdzdGFydCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgZW5hYmxlUmV2ZWFsID8gMiA6IDUpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgZW5hYmxlUmV2ZWFsID8gJHNjb3BlLnNjYWxlICogOCA6IDIwKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCBlbmFibGVSZXZlYWwgPyAnbm9uZScgOiAnYmxvY2snKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGVuYWJsZVJldmVhbCA/ICRzY29wZS5zY2FsZSAqIDcgKyAncHgnIDogJzEuM2VtJylcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2N1cnNvcicsICdwb2ludGVyJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfYmx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnd2hpdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEVOVEVSICsgVVBEQVRFXG4gICAgICAgICAgICAvLyBBcHBlbmRpbmcgdG8gdGhlIGVudGVyIHNlbGVjdGlvbiBleHBhbmRzIHRoZSB1cGRhdGUgc2VsZWN0aW9uIHRvIGluY2x1ZGVcbiAgICAgICAgICAgIC8vIGVudGVyaW5nIGVsZW1lbnRzOyBzbywgb3BlcmF0aW9ucyBvbiB0aGUgdXBkYXRlIHNlbGVjdGlvbiBhZnRlciBhcHBlbmRpbmcgdG9cbiAgICAgICAgICAgIC8vIHRoZSBlbnRlciBzZWxlY3Rpb24gd2lsbCBhcHBseSB0byBib3RoIGVudGVyaW5nIGFuZCB1cGRhdGluZyBub2Rlcy5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyBkLmNvb3JkcyArICcpJztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIHVwZGF0ZUNlbGxGaWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwnKVxuICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbigyNTApXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gJyNmZmYnIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciB1cGRhdGVQYXVzZVJlc3VtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLXBhdXNlLXJlc3VtZS1pY29uJylcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsUGF1c2VSZXN1bWUoZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHVwZGF0ZUNlbGxTdGF0dXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1zdGF0dXMnKVxuICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxTdGF0dXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gRVhJVFxuICAgICAgICAgICAgLy8gUmVtb3ZlIG9sZCBlbGVtZW50cyBhcyBuZWVkZWQuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5leGl0KClcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1leGl0JylcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLDApJylcbiAgICAgICAgICAgICAgICAucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHdyYXAgKHRleHQsIHdpZHRoKSB7XG4gICAgICAgICAgICAgICAgdGV4dC5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBkMy5zZWxlY3QodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkcyA9IHRleHQudGV4dCgpLnNwbGl0KC9cXHMrLykucmV2ZXJzZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVOdW1iZXIgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodCA9IDEuMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSB0ZXh0LmF0dHIoJ3knKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0gcGFyc2VGbG9hdCh0ZXh0LmF0dHIoJ2R5JykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHNwYW4gPSB0ZXh0LnRleHQobnVsbCkuYXBwZW5kKCd0c3BhbicpLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKS5hdHRyKCd5JywgeSkuYXR0cignZHknLCBkeSArICdlbScpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAod29yZCA9IHdvcmRzLnBvcCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod29yZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHNwYW4udGV4dChsaW5lLmpvaW4oJyAnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRzcGFuLm5vZGUoKS5nZXRDb21wdXRlZFRleHRMZW5ndGgoKSA+IChjZWxsV2lkdGggLSAxMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZS5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHNwYW4udGV4dChsaW5lLmpvaW4oJyAnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBbd29yZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRzcGFuID0gdGV4dC5hcHBlbmQoJ3RzcGFuJykuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpLmF0dHIoJ3knLCB5KS5hdHRyKCdkeScsICsrbGluZU51bWJlciAqIGxpbmVIZWlnaHQgKyBkeSArICdlbScpLnRleHQod29yZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoXy5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAkKCcuZ3JpZC1jaGFydCcpLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgaW5pdGlhbGl6ZShkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiRvbigncmVkcmF3R3JpZCcsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xuICAgICAgICAgICAgZ2V0RGF0YVZhbHVlcyhkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ2Fpc0dyaWRDaGFydCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNHcmlkQ2hhcnRDb250cm9sbGVyJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jaGFydHMvZ3JpZC9ncmlkQ2hhcnRUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcbiAgICAgICAgICAgICAgICBpY29uczogJz0nLCAvLyBpbmRpY2F0ZXMgd2hldGhlciBjZWxsLXRleHQgaXMgZW50aXJlbHkgbWFkZSB1cCBvZiBpY29uc1xuICAgICAgICAgICAgICAgIHNjYWxlOiAnPScsIC8vIG11bHRpcGxpZXIgdG8gaW5jcmVhc2UgY2VsbCBzaXplXG4gICAgICAgICAgICAgICAgcmV2ZWFsOiAnPScsIC8vIGlmIHRydWUsIGxlc3MgZGF0YSB3aWxsIHNob3cgd2hlbiB6b29tZWQgb3V0XG4gICAgICAgICAgICAgICAgbW9kZTogJ0AnLCAvLyB2YWxpZCB2YWx1ZXMgYXJlIHpvb20gb3IgdG9vbHRpcFxuICAgICAgICAgICAgICAgIGNvbHVtbnM6ICc9JyxcbiAgICAgICAgICAgICAgICByb3dzOiAnPScsXG4gICAgICAgICAgICAgICAgc2hvd0F4ZXM6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzSGVhbHRoQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcyxcbiAgICAgICAgICAgIGluaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgICAgICB2YXIgc2NhbGUgPSAkc2NvcGUuc2NhbGUgfHwgMTtcbiAgICAgICAgICAgIHZtLmRvbnV0U2l6ZSA9IDI3NSAqIHNjYWxlO1xuICAgICAgICAgICAgdm0uZG9udXRXaWR0aCA9IDI1ICogc2NhbGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMoZGF0YSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzSGVhbHRoJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0hlYWx0aENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NoYXJ0cy9oZWFsdGgvaGVhbHRoVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnPScsXG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxuICAgICAgICAgICAgICAgIHNjYWxlOiAnPScsXG4gICAgICAgICAgICAgICAgZXJyb3JMYWJlbDogJz0nLFxuICAgICAgICAgICAgICAgIHR5cGU6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzVGltZWxpbmVEaXJlY3RpdmVDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBnYW50dCA9IG51bGwsXG4gICAgICAgICAgICB0YXNrTmFtZXMgPSBbXTtcblxuICAgICAgICAkZWxlbWVudFswXS5vbnJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlbGVtZW50IHJlc2l6ZScpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgndGFza3MnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBkcmF3VGltZWxpbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkcmF3VGltZWxpbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnRhc2tzICYmICRzY29wZS50YXNrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRhc2tzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFbJHNjb3BlLmVuZGVkXSAtIGJbJHNjb3BlLmVuZGVkXTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRhc2tOYW1lcyA9IF8oJHNjb3BlLnRhc2tzKS5wbHVjaygndGFza05hbWUnKS51bmlxKCkudmFsdWUoKTtcbiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gdGFza05hbWVzLmxlbmd0aCAqIDMwICsgMjA7XG5cbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSAkZWxlbWVudFswXS5jbGllbnRXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAoIXdpZHRoIHx8IHdpZHRoID09PSAwKSB7IHdpZHRoID0gNjAwOyB9XG5cblxuICAgICAgICAgICAgICAgICRzY29wZS50YXNrcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhWyRzY29wZS5zdGFydGVkXSAtIGJbJHNjb3BlLnN0YXJ0ZWRdO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBtaW5EYXRlID0gJHNjb3BlLnRhc2tzWzBdWyRzY29wZS5zdGFydGVkXTtcbiAgICAgICAgICAgICAgICB2YXIgbWF4RGF0ZSA9ICRzY29wZS50YXNrc1skc2NvcGUudGFza3MubGVuZ3RoIC0gMV1bJHNjb3BlLmVuZGVkXTtcbiAgICAgICAgICAgICAgICB2YXIgZGF5c0RpZmYgPSBtb21lbnQudXRjKG1heERhdGUpLmRpZmYobW9tZW50LnV0YyhtaW5EYXRlKSwnZGF5cycpO1xuICAgICAgICAgICAgICAgIHZhciBmb3JtYXQgPSAnJUg6JU06JVMuJW0nO1xuICAgICAgICAgICAgICAgIGlmIChkYXlzRGlmZiA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0ID0gXCIlbS8lZC8leSAlSDolTVwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGdhbnR0ID0gZDMuZ2FudHQoKS5yZW5kZXJUbyhcIiNhaXMtdGltZWxpbmVcIikudGFza1R5cGVzKHRhc2tOYW1lcykudGFza1N0YXR1cyhzY2FsZUNvbmZpZy50YXNrU3RhdHVzU3R5bGVzKS50aWNrRm9ybWF0KGZvcm1hdCkuYmVnaW4oJHNjb3BlLnN0YXJ0ZWQpLmVuZGVkKCRzY29wZS5lbmRlZCkuaGVpZ2h0KGhlaWdodCkud2lkdGgod2lkdGgpO1xuXG4gICAgICAgICAgICAgICAgZ2FudHQudGltZURvbWFpbk1vZGUoXCJmaXRcIik7XG5cbiAgICAgICAgICAgICAgICBnYW50dCgkc2NvcGUudGFza3MpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZm9ybWF0RGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgICAgICAgICBpZiAoZGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKGRhdGUpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgfSkuZGlyZWN0aXZlKCdhaXNUaW1lbGluZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNUaW1lbGluZURpcmVjdGl2ZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NoYXJ0cy90aW1lbGluZS90aW1lbGluZURpcmVjdGl2ZVRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgdGFza3M6ICc9JyxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiAnPScsXG4gICAgICAgICAgICAgICAgZW5kZWQ6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ2Fpc0dyaWRQYWdpbmF0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NvbW1vbi9kaXJlY3RpdmVzL2Fpc0dyaWRQYWdpbmF0aW9uVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnXG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNNdWx0aXNlbGVjdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICByZXF1aXJlOiAnXm5nTW9kZWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBtdWx0aXNlbGVjdERhdGFQcm92aWRlcjogJz0nLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogJz0nLFxuICAgICAgICAgICAgICAgIG1heEhlaWdodDogJz0nLFxuICAgICAgICAgICAgICAgIG51bWJlckRpc3BsYXllZDogJz0nLFxuICAgICAgICAgICAgICAgIGluY2x1ZGVTZWxlY3RBbGxPcHRpb246ICc9JyxcbiAgICAgICAgICAgICAgICBub25TZWxlY3RlZFRleHQ6ICc9JyxcbiAgICAgICAgICAgICAgICBuZ01vZGVsOiAnPSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnRbMF0pO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCh7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogc2NvcGUuZW5hYmxlRmlsdGVyaW5nLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVDYXNlSW5zZW5zaXRpdmVGaWx0ZXJpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogc2NvcGUubWF4SGVpZ2h0IHx8IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgbnVtYmVyRGlzcGxheWVkOiBzY29wZS5udW1iZXJEaXNwbGF5ZWQgfHwgMyxcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVNlbGVjdEFsbE9wdGlvbjogc2NvcGUuaW5jbHVkZVNlbGVjdEFsbE9wdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbm9uU2VsZWN0ZWRUZXh0OiBzY29wZS5ub25TZWxlY3RlZFRleHQgfHwgJ05vbmUgU2VsZWN0ZWQnLFxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKG9wdGlvbkVsZW1lbnQsIGNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmdNb2RlbCA9IGVsZW1lbnQudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoQ29sbGVjdGlvbignbXVsdGlzZWxlY3REYXRhUHJvdmlkZXInLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCgnZGF0YXByb3ZpZGVyJywgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAvLyBXYXRjaCBmb3IgYW55IGNoYW5nZXMgdG8gdGhlIGxlbmd0aCBvZiBvdXIgc2VsZWN0IGVsZW1lbnRcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudFswXTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgICAgICAgICAgIC8vZWxlbWVudC5tdWx0aXNlbGVjdCgnc2V0T3B0aW9ucycsIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgICAgICAvL2VsZW1lbnQubXVsdGlzZWxlY3QoJ3JlYnVpbGQnKTtcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIFdhdGNoIGZvciBhbnkgY2hhbmdlcyBmcm9tIG91dHNpZGUgdGhlIGRpcmVjdGl2ZSBhbmQgcmVmcmVzaFxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChhdHRyaWJ1dGVzLm5nTW9kZWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCgncmVmcmVzaCcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3NjYWxlU2VydmljZScsIGZ1bmN0aW9uICgkcSwgJGh0dHAsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIGZ1bmN0aW9uIHBhZFdpdGhaZXJvIChpbnB1dCwgbGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBDYXN0IGlucHV0IHRvIHN0cmluZ1xuICAgICAgICAgICAgaW5wdXQgPSAnJyArIGlucHV0O1xuXG4gICAgICAgICAgICB2YXIgcGFkZGluZ1NpemUgPSBNYXRoLm1heCgwLCBsZW5ndGggLSBpbnB1dC5sZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheShwYWRkaW5nU2l6ZSA+IDAgPyBwYWRkaW5nU2l6ZSArIDEgOiAwKS5qb2luKCcwJykgKyBpbnB1dDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWI6IGZ1bmN0aW9uKG51bSl7XG4gICAgICAgICAgICAgICAgaWYgKG51bSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bSA8IDEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudW0udG9GaXhlZCgyKSArICcgTUInO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW0gPj0gMTAyNCAmJiBudW0gPCAxMDI0KjEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQpLnRvRml4ZWQoMikgKyAnIEdCJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG51bS8xMDI0LzEwMjQpLnRvRml4ZWQoMikgKyAnIFRCJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlczogZnVuY3Rpb24obnVtLGRlY2ltYWxzKXtcbiAgICAgICAgICAgICAgICBpZiAobnVtID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobnVtIDwgMTAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bS50b0ZpeGVkKGRlY2ltYWxzKSArICcgQnl0ZXMnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW0gPj0gMTAyNCAmJiBudW0gPCAxMDI0KjEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQpLnRvRml4ZWQoZGVjaW1hbHMpICsgJyBLQic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bSA+PSAxMDI0KjEwMjQgJiYgbnVtIDwgMTAyNCoxMDI0KjEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQvMTAyNCkudG9GaXhlZChkZWNpbWFscykgKyAnIE1CJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobnVtID49IDEwMjQqMTAyNCoxMDI0ICYmIG51bSA8IDEwMjQqMTAyNCoxMDI0KjEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQvMTAyNC8xMDI0KS50b0ZpeGVkKGRlY2ltYWxzKSArICcgR0InO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQvMTAyNC8xMDI0LzEwMjQpLnRvRml4ZWQoZGVjaW1hbHMpICsgJyBUQic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudW07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Vmlld3BvcnRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHcgPSB3aW5kb3csXG4gICAgICAgICAgICAgICAgICAgIGQgPSBkb2N1bWVudCxcbiAgICAgICAgICAgICAgICAgICAgZSA9IGQuZG9jdW1lbnRFbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBnID0gZG9jdW1lbnQuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgeCA9IHcuaW5uZXJXaWR0aCB8fCBlLmNsaWVudFdpZHRoIHx8IGcuY2xpZW50V2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIHkgPSB3LmlubmVySGVpZ2h0IHx8IGUuY2xpZW50SGVpZ2h0IHx8IGcuY2xpZW50SGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHgsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogeVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FsY3VsYXRlRHVyYXRpb246IGZ1bmN0aW9uIChzdGFydCwgc3RvcCwgbm9QYWRkaW5nKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRvID0gbW9tZW50LnV0YyhzdG9wKSxcbiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IG1vbWVudC51dGMoc3RhcnQpLFxuICAgICAgICAgICAgICAgICAgICBkaWZmID0gbW9tZW50LnV0Yyh0bykuZGlmZihtb21lbnQudXRjKGZyb20pKSxcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSAnJztcblxuICAgICAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IG1vbWVudC5kdXJhdGlvbihkaWZmKTtcblxuICAgICAgICAgICAgICAgIGlmICghbm9QYWRkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24ueWVhcnMoKSA+IDAgPyBkdXJhdGlvblN0ciArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLnllYXJzKCksIDIpICsgJ1ksICcgOiBkdXJhdGlvblN0cjtcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSBkdXJhdGlvbi5tb250aHMoKSA+IDAgPyBkdXJhdGlvblN0ciArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLm1vbnRocygpLCAyKSArICdNLCAnIDogZHVyYXRpb25TdHI7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24uZGF5cygpID4gMCA/IGR1cmF0aW9uU3RyICsgcGFkV2l0aFplcm8oZHVyYXRpb24uZGF5cygpLCAyKSArICdELCAnIDogZHVyYXRpb25TdHI7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24uaG91cnMoKSA+IDAgPyBkdXJhdGlvblN0ciArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLmhvdXJzKCksIDIpICsgJ2gsICcgOiBkdXJhdGlvblN0cjtcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSBkdXJhdGlvbi5taW51dGVzKCkgPiAwID8gZHVyYXRpb25TdHIgKyBwYWRXaXRoWmVybyhkdXJhdGlvbi5taW51dGVzKCksIDIpICsgJ20sICcgOiBkdXJhdGlvblN0cjtcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSBkdXJhdGlvblN0ciArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLnNlY29uZHMoKSwgMikgKyAncyc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSBkdXJhdGlvbi55ZWFycygpID4gMCA/IGR1cmF0aW9uU3RyICsgZHVyYXRpb24ueWVhcnMoKSArICdZLCAnIDogZHVyYXRpb25TdHI7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24ubW9udGhzKCkgPiAwID8gZHVyYXRpb25TdHIgKyBkdXJhdGlvbi5tb250aHMoKSArICdNLCAnIDogZHVyYXRpb25TdHI7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24uZGF5cygpID4gMCA/IGR1cmF0aW9uU3RyICsgZHVyYXRpb24uZGF5cygpICsgJ0QsICcgOiBkdXJhdGlvblN0cjtcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSBkdXJhdGlvbi5ob3VycygpID4gMCA/IGR1cmF0aW9uU3RyICsgZHVyYXRpb24uaG91cnMoKSArICdoLCAnIDogZHVyYXRpb25TdHI7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24ubWludXRlcygpID4gMCA/IGR1cmF0aW9uU3RyICsgZHVyYXRpb24ubWludXRlcygpICsgJ20sICcgOiBkdXJhdGlvblN0cjtcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25TdHIgPSBkdXJhdGlvblN0ciArIGR1cmF0aW9uLnNlY29uZHMoKSArICdzJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZHVyYXRpb25TdHI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RGF5U3RyaW5nOiBmdW5jdGlvbihkYXlOdW1iZXIpe1xuICAgICAgICAgICAgICAgIHZhciBkYXlBcnIgPSBbJ1N1bmRheScsJ01vbmRheScsJ1R1ZXNkYXknLCdXZWRuZXNkYXknLCdUaHVyc2RheScsJ0ZyaWRheScsJ1NhdHVyZGF5J107XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRheUFycltkYXlOdW1iZXJdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzSUU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCxcbiAgICAgICAgICAgICAgICAgICAgb2xkSUUgPSB1YS5pbmRleE9mKCdNU0lFJyksXG4gICAgICAgICAgICAgICAgICAgIG5ld0lFID0gdWEuaW5kZXhPZignVHJpZGVudC8nKTtcblxuICAgICAgICAgICAgICAgIGlmICgob2xkSUUgPiAtMSkgfHwgKG5ld0lFID4gLTEpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TWVkaWFUeXBlSHRtbDogZnVuY3Rpb24obWVkaWFUeXBlKXtcbiAgICAgICAgICAgICAgICB2YXIgaWNvbkh0bWwgPSAnPGkgY2xhc3M9XCJmYSAnICsgJ2ZhLWZpbGUnICsgJ1wiPjwvaT4nO1xuICAgICAgICAgICAgICAgIGlmKG1lZGlhVHlwZSl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpYyA9IF8uZmluZChzY2FsZUNvbmZpZy5tZWRpYVR5cGVzLCB7bWltZVR5cGU6IG1lZGlhVHlwZX0pXG4gICAgICAgICAgICAgICAgICAgIGlmKGljKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb25IdG1sID0gJzxpIGNsYXNzPVwiZmEgJyArIGljLmljb24gKyAnXCI+PC9pPic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGljb25IdG1sO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFZlcnNpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAndmVyc2lvbi8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0R3JpZEhlaWdodDogZnVuY3Rpb24gKG9mZnNldCkge1xuICAgICAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgfHwgc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHRoaXMuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgICAgIGdyaWRNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBvZmZzZXQ7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gJ2hlaWdodDogJyArIGdyaWRNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBncmlkTWF4SGVpZ2h0ICsgJ3B4OyBvdmVyZmxvdy15OiBhdXRvOyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3NjaGVkdWxlclNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgZ2V0VXBkYXRlU2NoZWR1bGVyRGF0YSA9IGZ1bmN0aW9uIChpc19wYXVzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaXNfcGF1c2VkOiBpc19wYXVzZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVwZGF0ZVNjaGVkdWxlcjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YSB8fCBnZXRVcGRhdGVTY2hlZHVsZXJEYXRhKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnc2NoZWR1bGVyJykgKyAnc2NoZWR1bGVyLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnc3RhdGVTZXJ2aWNlJywgZnVuY3Rpb24gKCRsb2NhdGlvbikge1xuICAgICAgICB2YXIgdmVyc2lvbiA9ICcnLFxuICAgICAgICAgICAgam9ic0NvbERlZnMgPSBbXSxcbiAgICAgICAgICAgIGpvYnNQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIGpvYkV4ZWN1dGlvbnNQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIGpvYlR5cGVzUGFyYW1zID0ge30sXG4gICAgICAgICAgICByZWNpcGVzQ29sRGVmcyA9IFtdLFxuICAgICAgICAgICAgam9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIHJlY2lwZXNQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIGluZ2VzdHNDb2xEZWZzID0gW10sXG4gICAgICAgICAgICBpbmdlc3RzUGFyYW1zID0ge30sXG4gICAgICAgICAgICBzY2Fuc0NvbERlZnMgPSBbXSxcbiAgICAgICAgICAgIHNjYW5zUGFyYW1zID0ge30sXG4gICAgICAgICAgICBub2Rlc0NvbERlZnMgPSBbXSxcbiAgICAgICAgICAgIGJhdGNoZXNDb2xEZWZzID0gW10sXG4gICAgICAgICAgICBiYXRjaGVzUGFyYW1zID0ge30sXG4gICAgICAgICAgICBzaG93QWN0aXZlV29ya3NwYWNlcyA9IHRydWUsXG4gICAgICAgICAgICBub2Rlc1BhcmFtcyA9IHt9LFxuICAgICAgICAgICAgbG9nQXJncyA9IFtdLFxuICAgICAgICAgICAgam9iRXhlY3V0aW9uTG9nUG9sbGVyID0gW107XG5cbiAgICAgICAgdmFyIHVwZGF0ZVF1ZXJ5c3RyaW5nID0gZnVuY3Rpb24gKGRhdGEsIGV4Y2x1ZGVEZWZhdWx0cykge1xuICAgICAgICAgICAgZXhjbHVkZURlZmF1bHRzID0gZXhjbHVkZURlZmF1bHRzIHx8IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFleGNsdWRlRGVmYXVsdHMpIHtcbiAgICAgICAgICAgICAgICAvLyBzZXQgZGVmYXVsdHNcbiAgICAgICAgICAgICAgICBkYXRhLnBhZ2UgPSBkYXRhLnBhZ2UgfHwgMTtcbiAgICAgICAgICAgICAgICBkYXRhLnBhZ2Vfc2l6ZSA9IGRhdGEucGFnZV9zaXplIHx8IDI1O1xuICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRlZCA9IGRhdGEuc3RhcnRlZCB8fCBudWxsO1xuICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQgPSBkYXRhLmVuZGVkIHx8IG51bGw7XG4gICAgICAgICAgICAgICAgZGF0YS5vcmRlciA9IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IG51bGw7XG4gICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSBkYXRhLnN0YXR1cyB8fCBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY2hlY2sgZm9yIHBhcmFtcyBpbiBxdWVyeXN0cmluZywgYW5kIHVwZGF0ZSBhcyBuZWNlc3NhcnlcbiAgICAgICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKGRhdGEpLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKHBhcmFtWzBdLCBwYXJhbVsxXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEpvYnNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWxhc3RfbW9kaWZpZWQnXSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzID8gZGF0YS5zdGF0dXMgOiBudWxsLFxuICAgICAgICAgICAgICAgIGVycm9yX2NhdGVnb3J5OiBkYXRhLmVycm9yX2NhdGVnb3J5ID8gZGF0YS5lcnJvcl9jYXRlZ29yeSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfaWQ6IGRhdGEuam9iX3R5cGVfaWQgPyBwYXJzZUludChkYXRhLmpvYl90eXBlX2lkKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZTogZGF0YS5qb2JfdHlwZV9uYW1lID8gZGF0YS5qb2JfdHlwZV9uYW1lIDogbnVsbCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9jYXRlZ29yeTogZGF0YS5qb2JfdHlwZV9jYXRlZ29yeSA/IGRhdGEuam9iX3R5cGVfY2F0ZWdvcnkgOiBudWxsLFxuICAgICAgICAgICAgICAgIHVybDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWxhc3RfbW9kaWZpZWQnXSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzID8gZGF0YS5zdGF0dXMgOiBudWxsLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBkYXRhLmpvYl90eXBlX2lkID8gcGFyc2VJbnQoZGF0YS5qb2JfdHlwZV9pZCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX25hbWU6IGRhdGEuam9iX3R5cGVfbmFtZSA/IGRhdGEuam9iX3R5cGVfbmFtZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfY2F0ZWdvcnk6IGRhdGEuam9iX3R5cGVfY2F0ZWdvcnkgPyBkYXRhLmpvYl90eXBlX2NhdGVnb3J5IDogbnVsbCxcbiAgICAgICAgICAgICAgICBub2RlX2lkOiBkYXRhLm5vZGVfaWQgPyBkYXRhLm5vZGVfaWQgOiBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0Sm9iVHlwZXNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSl7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNob3dfcmQ6IHR5cGVvZiBkYXRhLnNob3dfcmQgIT09ICd1bmRlZmluZWQnID8gZGF0YS5zaG93X3JkIDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogbnVsbCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBudWxsLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBudWxsLFxuICAgICAgICAgICAgICAgIG5hbWU6IGRhdGEubmFtZSA/IGRhdGEubmFtZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogZGF0YS52ZXJzaW9uID8gZGF0YS52ZXJzaW9uIDogbnVsbCxcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogbnVsbCxcbiAgICAgICAgICAgICAgICBvcmRlcjogZGF0YS5vcmRlciA/IGRhdGEub3JkZXIgOiAnZGVzYycsXG4gICAgICAgICAgICAgICAgb3JkZXJGaWVsZDogZGF0YS5vcmRlckZpZWxkID8gZGF0YS5vcmRlckZpZWxkIDogJ3R3ZW50eWZvdXJfaG91cnMnLFxuICAgICAgICAgICAgICAgIG9yZGVyRXJyb3JUeXBlOiBkYXRhLm9yZGVyRXJyb3JUeXBlID8gZGF0YS5vcmRlckVycm9yVHlwZSA6ICdlcnJvclRvdGFsJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdFJlY2lwZXNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWxhc3RfbW9kaWZpZWQnXSxcbiAgICAgICAgICAgICAgICB0eXBlX2lkOiBkYXRhLnR5cGVfaWQgPyBwYXJzZUludChkYXRhLnR5cGVfaWQpIDogbnVsbCxcbiAgICAgICAgICAgICAgICB0eXBlX25hbWU6IGRhdGEudHlwZV9uYW1lID8gZGF0YS50eXBlX25hbWUgOiBudWxsLFxuICAgICAgICAgICAgICAgIHVybDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEluZ2VzdHNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWluZ2VzdF9zdGFydGVkJ10sXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBkYXRhLnN0YXR1cyA/IGRhdGEuc3RhdHVzIDogbnVsbCxcbiAgICAgICAgICAgICAgICBmaWxlX25hbWU6IGRhdGEuZmlsZV9uYW1lID8gZGF0YS5maWxlX25hbWUgOiBudWxsLFxuICAgICAgICAgICAgICAgIHN0cmlrZV9pZDogZGF0YS5zdHJpa2VfaWQgPyBwYXJzZUludChkYXRhLnN0cmlrZV9pZCkgOiBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0U2NhbnNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgbmFtZTogZGF0YS5uYW1lID8gZGF0YS5uYW1lIDogbnVsbCxcbiAgICAgICAgICAgICAgICBvcmRlcjogZGF0YS5vcmRlciA/IEFycmF5LmlzQXJyYXkoZGF0YS5vcmRlcikgPyBkYXRhLm9yZGVyIDogW2RhdGEub3JkZXJdIDogWyctbGFzdF9tb2RpZmllZCddXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0Tm9kZXNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAvLyBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICAvLyBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnaG9zdG5hbWUnXSxcbiAgICAgICAgICAgICAgICBhY3RpdmU6IGRhdGEuYWN0aXZlIHx8ICd0cnVlJyxcbiAgICAgICAgICAgICAgICBzdGF0ZTogZGF0YS5zdGF0ZSB8fCBudWxsXG4gICAgICAgICAgICAgICAgLy8gaW5jbHVkZV9pbmFjdGl2ZTogZGF0YS5pbmNsdWRlX2luYWN0aXZlID8gZGF0YS5pbmNsdWRlX2luYWN0aXZlIDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEJhdGNoZXNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWxhc3RfbW9kaWZpZWQnXSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzID8gZGF0YS5zdGF0dXMgOiBudWxsLFxuICAgICAgICAgICAgICAgIHJlY2lwZV90eXBlX2lkOiBkYXRhLnJlY2lwZV90eXBlX2lkID8gcGFyc2VJbnQoZGF0YS5yZWNpcGVfdHlwZV9pZCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBkYXRhLmpvYl90eXBlX2lkID8gcGFyc2VJbnQoZGF0YS5qb2JfdHlwZV9pZCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIHVybDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0VmVyc2lvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2ZXJzaW9uO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFZlcnNpb246IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmVyc2lvbiA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9ic0NvbERlZnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gam9ic0NvbERlZnM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Sm9ic0NvbERlZnM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgam9ic0NvbERlZnMgPSBkYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYnNQYXJhbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5rZXlzKGpvYnNQYXJhbXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5pdEpvYnNQYXJhbXMoJGxvY2F0aW9uLnNlYXJjaCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYnNQYXJhbXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Sm9ic1BhcmFtczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBqb2JzUGFyYW1zID0gaW5pdEpvYnNQYXJhbXMoZGF0YSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlUXVlcnlzdHJpbmcoam9ic1BhcmFtcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iRXhlY3V0aW9uc1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMoam9iRXhlY3V0aW9uc1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0Sm9iRXhlY3V0aW9uc1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gam9iRXhlY3V0aW9uc1BhcmFtcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRKb2JFeGVjdXRpb25zUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBpbml0Sm9iRXhlY3V0aW9uc1BhcmFtcyhkYXRhKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVRdWVyeXN0cmluZyhqb2JFeGVjdXRpb25zUGFyYW1zKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JUeXBlc1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMoam9iVHlwZXNQYXJhbXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBqb2JUeXBlc1BhcmFtcyA9IGluaXRKb2JUeXBlc1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGpvYlR5cGVzUGFyYW1zKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gam9iVHlwZXNQYXJhbXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Sm9iVHlwZXNQYXJhbXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgam9iVHlwZXNQYXJhbXMgPSBpbml0Sm9iVHlwZXNQYXJhbXMoZGF0YSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlUXVlcnlzdHJpbmcoam9iVHlwZXNQYXJhbXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhqb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMoJGxvY2F0aW9uLnNlYXJjaCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zID0gaW5pdEpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKGpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zKSwgZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gocGFyYW1bMF0sIHBhcmFtWzFdKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSZWNpcGVzQ29sRGVmczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNpcGVzQ29sRGVmcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRSZWNpcGVzQ29sRGVmczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVzQ29sRGVmcyA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UmVjaXBlc1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMocmVjaXBlc1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0UmVjaXBlc1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjaXBlc1BhcmFtcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRSZWNpcGVzUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJlY2lwZXNQYXJhbXMgPSBpbml0UmVjaXBlc1BhcmFtcyhkYXRhKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVRdWVyeXN0cmluZyhyZWNpcGVzUGFyYW1zKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJbmdlc3RzQ29sRGVmczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbmdlc3RzQ29sRGVmcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRJbmdlc3RzQ29sRGVmczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpbmdlc3RzQ29sRGVmcyA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0U2NhbnNDb2xEZWZzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYW5zQ29sRGVmcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRTY2Fuc0NvbERlZnM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgc2NhbnNDb2xEZWZzID0gZGF0YTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJbmdlc3RzUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhpbmdlc3RzUGFyYW1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaXRJbmdlc3RzUGFyYW1zKCRsb2NhdGlvbi5zZWFyY2goKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBpbmdlc3RzUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEluZ2VzdHNQYXJhbXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaW5nZXN0c1BhcmFtcyA9IGluaXRJbmdlc3RzUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5c3RyaW5nKGluZ2VzdHNQYXJhbXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFNjYW5zUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhzY2Fuc1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0U2NhbnNQYXJhbXMoJGxvY2F0aW9uLnNlYXJjaCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYW5zUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFNjYW5zUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHNjYW5zUGFyYW1zID0gaW5pdFNjYW5zUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5c3RyaW5nKHNjYW5zUGFyYW1zKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2Rlc0NvbERlZnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZXNDb2xEZWZzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldE5vZGVzQ29sRGVmczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBub2Rlc0NvbERlZnMgPSBkYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFNob3dBY3RpdmVXb3Jrc3BhY2VzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNob3dBY3RpdmVXb3Jrc3BhY2VzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFNob3dBY3RpdmVXb3Jrc3BhY2VzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHNob3dBY3RpdmVXb3Jrc3BhY2VzID0gZGF0YTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2Rlc1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMobm9kZXNQYXJhbXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5pdE5vZGVzUGFyYW1zKCRsb2NhdGlvbi5zZWFyY2goKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBub2Rlc1BhcmFtcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXROb2Rlc1BhcmFtczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBub2Rlc1BhcmFtcyA9IGluaXROb2Rlc1BhcmFtcyhkYXRhKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVRdWVyeXN0cmluZyhub2Rlc1BhcmFtcywgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TG9nQXJnczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBsb2dBcmdzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldExvZ0FyZ3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgbG9nQXJncyA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iRXhlY3V0aW9uTG9nUG9sbGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYkV4ZWN1dGlvbkxvZ1BvbGxlcjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRKb2JFeGVjdXRpb25Mb2dQb2xsZXI6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgam9iRXhlY3V0aW9uTG9nUG9sbGVyLnB1c2goZGF0YSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0QmF0Y2hlc0NvbERlZnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYmF0Y2hlc0NvbERlZnM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0QmF0Y2hlc0NvbERlZnM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgYmF0Y2hlc0NvbERlZnMgPSBkYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEJhdGNoZXNQYXJhbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5rZXlzKGJhdGNoZXNQYXJhbXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5pdEJhdGNoZXNQYXJhbXMoJGxvY2F0aW9uLnNlYXJjaCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJhdGNoZXNQYXJhbXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0QmF0Y2hlc1BhcmFtczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBiYXRjaGVzUGFyYW1zID0gaW5pdEJhdGNoZXNQYXJhbXMoZGF0YSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlUXVlcnlzdHJpbmcoYmF0Y2hlc1BhcmFtcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdzdGF0dXNTZXJ2aWNlJywgZnVuY3Rpb24gKCRyZXNvdXJjZSwgc2NhbGVDb25maWcsIHBvbGxlciwgcG9sbGVyRmFjdG9yeSwgU3RhdHVzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRTdGF0dXM6IGZ1bmN0aW9uIChpc05vZGVTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpc05vZGVTdGF0dXMgPSBpc05vZGVTdGF0dXMgfHwgZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1c1Jlc291cmNlID0gaXNOb2RlU3RhdHVzID8gJHJlc291cmNlKHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbm9kZVN0YXR1cycpICsgJ3N0YXR1cy8nKSA6ICRyZXNvdXJjZShzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3N0YXR1cycpICsgJ3N0YXR1cy8nKSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzUG9sbGVyID0gaXNOb2RlU3RhdHVzID8gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIoc3RhdHVzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMubm9kZVN0YXR1cykgOiBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihzdGF0dXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5zdGF0dXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXR1c1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gaXNOb2RlU3RhdHVzID8gcmVzdWx0IDogU3RhdHVzLnRyYW5zZm9ybWVyKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3VzZXJTZXJ2aWNlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0VXNlckNyZWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNyZWRzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJDcmVkcycpO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGNyZWRzKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBwYXJzaW5nIHVzZXIgY3JlZGVudGlhbHMnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWRzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRVc2VyQ3JlZHM6IGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXJDcmVkcycsIEpTT04uc3RyaW5naWZ5KHVzZXIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlckNyZWRzJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9naW46IGZ1bmN0aW9uICh1c2VybmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciB1c2VyID0ge1xuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGlzX2FkbWluOiB0cnVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFVzZXJDcmVkcyh1c2VyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlcjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2dvdXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFVzZXJDcmVkcyhudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnZ2F1Z2VGYWN0b3J5JywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBHYXVnZSA9IGZ1bmN0aW9uIChwbGFjZWhvbGRlck5hbWUsIGNvbmZpZ3VyYXRpb24pXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXJOYW1lID0gcGxhY2Vob2xkZXJOYW1lO1xuXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7IC8vIGZvciBpbnRlcm5hbCBkMyBmdW5jdGlvbnNcblxuICAgICAgICAgICAgdGhpcy5jb25maWd1cmUgPSBmdW5jdGlvbihjb25maWd1cmF0aW9uKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlndXJhdGlvbjtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnNpemUgPSB0aGlzLmNvbmZpZy5zaXplICogMC45O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcucmFkaXVzID0gdGhpcy5jb25maWcuc2l6ZSAqIDAuOTcgLyAyO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmN4ID0gdGhpcy5jb25maWcuc2l6ZSAvIDI7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcuY3kgPSB0aGlzLmNvbmZpZy5zaXplIC8gMjtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLm1pbiA9IHVuZGVmaW5lZCAhPSBjb25maWd1cmF0aW9uLm1pbiA/IGNvbmZpZ3VyYXRpb24ubWluIDogMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5tYXggPSB1bmRlZmluZWQgIT0gY29uZmlndXJhdGlvbi5tYXggPyBjb25maWd1cmF0aW9uLm1heCA6IDEwMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5yYW5nZSA9IHRoaXMuY29uZmlnLm1heCAtIHRoaXMuY29uZmlnLm1pbjtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLm1ham9yVGlja3MgPSBjb25maWd1cmF0aW9uLm1ham9yVGlja3MgfHwgNTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5taW5vclRpY2tzID0gY29uZmlndXJhdGlvbi5taW5vclRpY2tzIHx8IDI7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5ncmVlbkNvbG9yIFx0PSBjb25maWd1cmF0aW9uLmdyZWVuQ29sb3IgfHwgJyM4ZmNhMGUnO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnllbGxvd0NvbG9yID0gY29uZmlndXJhdGlvbi55ZWxsb3dDb2xvciB8fCAnI2ZmYzMxNyc7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcucmVkQ29sb3IgXHQ9IGNvbmZpZ3VyYXRpb24ucmVkQ29sb3IgfHwgJyNmNTRkMzYnO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmdyYXlDb2xvciAgID0gY29uZmlndXJhdGlvbi5ncmF5Q29sb3IgfHwgJyNhYWEnO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcudHJhbnNpdGlvbkR1cmF0aW9uID0gY29uZmlndXJhdGlvbi50cmFuc2l0aW9uRHVyYXRpb24gfHwgNTAwO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5yZW5kZXIgPSBmdW5jdGlvbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGhpcy5ib2R5ID0gZDMuc2VsZWN0KCcjJyArIHRoaXMucGxhY2Vob2xkZXJOYW1lKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdzdmc6c3ZnJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2dhdWdlJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgdGhpcy5jb25maWcuc2l6ZSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsIHRoaXMuY29uZmlnLnNpemUpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOmNpcmNsZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdvdXRlci1jaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY3gnLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2N5JywgdGhpcy5jb25maWcuY3kpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdyJywgdGhpcy5jb25maWcucmFkaXVzKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnI2NjYycpO1xuICAgICAgICAgICAgICAgIC8qLnN0eWxlKCdzdHJva2UnLCAnIzAwMCcpXG4gICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzAuNXB4Jyk7Ki9cblxuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpjaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY3gnLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2N5JywgdGhpcy5jb25maWcuY3kpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdyJywgMC45ICogdGhpcy5jb25maWcucmFkaXVzKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnI2ZmZicpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgJyNlMGUwZTAnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcycHgnKTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGdyZWVuSWR4IGluIHRoaXMuY29uZmlnLmdyZWVuWm9uZXMpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdCYW5kKHRoaXMuY29uZmlnLmdyZWVuWm9uZXNbZ3JlZW5JZHhdLmZyb20sIHRoaXMuY29uZmlnLmdyZWVuWm9uZXNbZ3JlZW5JZHhdLnRvLCBzZWxmLmNvbmZpZy5ncmVlbkNvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciB5ZWxsb3dJZHggaW4gdGhpcy5jb25maWcueWVsbG93Wm9uZXMpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdCYW5kKHRoaXMuY29uZmlnLnllbGxvd1pvbmVzW3llbGxvd0lkeF0uZnJvbSwgdGhpcy5jb25maWcueWVsbG93Wm9uZXNbeWVsbG93SWR4XS50bywgc2VsZi5jb25maWcueWVsbG93Q29sb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvciAodmFyIHJlZElkeCBpbiB0aGlzLmNvbmZpZy5yZWRab25lcylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQodGhpcy5jb25maWcucmVkWm9uZXNbcmVkSWR4XS5mcm9tLCB0aGlzLmNvbmZpZy5yZWRab25lc1tyZWRJZHhdLnRvLCBzZWxmLmNvbmZpZy5yZWRDb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGZvbnRTaXplID0gMDtcblxuICAgICAgICAgICAgICAgIGlmICh1bmRlZmluZWQgIT0gdGhpcy5jb25maWcubGFiZWwpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmb250U2l6ZSA9IE1hdGgucm91bmQodGhpcy5jb25maWcuc2l6ZSAvIDkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6dGV4dCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneCcsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3knLCB0aGlzLmNvbmZpZy5jeSAvIDIgKyBmb250U2l6ZSAvIDIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignZHknLCBmb250U2l6ZSAvIDIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KHRoaXMuY29uZmlnLmxhYmVsKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBmb250U2l6ZSArICdweCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnIzMzMycpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcwcHgnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb250U2l6ZSA9IE1hdGgucm91bmQodGhpcy5jb25maWcuc2l6ZSAvIDE2KTtcbiAgICAgICAgICAgICAgICB2YXIgbWFqb3JEZWx0YSA9IHRoaXMuY29uZmlnLnJhbmdlIC8gKHRoaXMuY29uZmlnLm1ham9yVGlja3MgLSAxKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBtYWpvciA9IHRoaXMuY29uZmlnLm1pbjsgbWFqb3IgPD0gdGhpcy5jb25maWcubWF4OyBtYWpvciArPSBtYWpvckRlbHRhKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1pbm9yRGVsdGEgPSBtYWpvckRlbHRhIC8gdGhpcy5jb25maWcubWlub3JUaWNrcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50MSA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDIgPSAwO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBtaW5vciA9IG1ham9yICsgbWlub3JEZWx0YTsgbWlub3IgPCBNYXRoLm1pbihtYWpvciArIG1ham9yRGVsdGEsIHRoaXMuY29uZmlnLm1heCk7IG1pbm9yICs9IG1pbm9yRGVsdGEpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50MSA9IHRoaXMudmFsdWVUb1BvaW50KG1pbm9yLCAwLjc1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50MiA9IHRoaXMudmFsdWVUb1BvaW50KG1pbm9yLCAwLjg1KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOmxpbmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4MScsIHBvaW50MS54KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5MScsIHBvaW50MS55KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4MicsIHBvaW50Mi54KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5MicsIHBvaW50Mi55KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgJyM2NjYnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzFweCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcG9pbnQxID0gdGhpcy52YWx1ZVRvUG9pbnQobWFqb3IsIDAuNyk7XG4gICAgICAgICAgICAgICAgICAgIHBvaW50MiA9IHRoaXMudmFsdWVUb1BvaW50KG1ham9yLCAwLjg1KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6bGluZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneDEnLCBwb2ludDEueClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5MScsIHBvaW50MS55KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gyJywgcG9pbnQyLngpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneTInLCBwb2ludDIueSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgJyMzMzMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMnB4Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1ham9yID09IHRoaXMuY29uZmlnLm1pbiB8fCBtYWpvciA9PSB0aGlzLmNvbmZpZy5tYXgpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludCA9IHRoaXMudmFsdWVUb1BvaW50KG1ham9yLCAwLjYzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOnRleHQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgcG9pbnQueClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneScsIHBvaW50LnkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgZm9udFNpemUgLyAzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsIG1ham9yID09IHRoaXMuY29uZmlnLm1pbiA/ICdzdGFydCcgOiAnZW5kJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGV4dChtYWpvcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGZvbnRTaXplICsgJ3B4JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnIzMzMycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMHB4Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRlckNvbnRhaW5lciA9IHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpnJykuYXR0cignY2xhc3MnLCAncG9pbnRlckNvbnRhaW5lcicpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG1pZFZhbHVlID0gKHRoaXMuY29uZmlnLm1pbiArIHRoaXMuY29uZmlnLm1heCkgLyAyO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJQYXRoID0gdGhpcy5idWlsZFBvaW50ZXJQYXRoKG1pZFZhbHVlKTtcblxuICAgICAgICAgICAgICAgIHZhciBwb2ludGVyTGluZSA9IGQzLnN2Zy5saW5lKClcbiAgICAgICAgICAgICAgICAgICAgLngoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC54IH0pXG4gICAgICAgICAgICAgICAgICAgIC55KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueSB9KVxuICAgICAgICAgICAgICAgICAgICAuaW50ZXJwb2xhdGUoJ2Jhc2lzJyk7XG5cbiAgICAgICAgICAgICAgICBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbCgncGF0aCcpXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKFtwb2ludGVyUGF0aF0pXG4gICAgICAgICAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ3N2ZzpwYXRoJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2QnLCBwb2ludGVyTGluZSlcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyM4ODgnKTtcblxuICAgICAgICAgICAgICAgIHBvaW50ZXJDb250YWluZXIuYXBwZW5kKCdzdmc6Y2lyY2xlJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2N4JywgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeScsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigncicsIDAuMDcgKiB0aGlzLmNvbmZpZy5yYWRpdXMpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjODg4Jyk7XG5cbiAgICAgICAgICAgICAgICBmb250U2l6ZSA9IE1hdGgucm91bmQodGhpcy5jb25maWcuc2l6ZSAvIDEwKTtcbiAgICAgICAgICAgICAgICBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbCgndGV4dCcpXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKFttaWRWYWx1ZV0pXG4gICAgICAgICAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ3N2Zzp0ZXh0JylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3knLCB0aGlzLmNvbmZpZy5zaXplIC0gdGhpcy5jb25maWcuY3kgLyA0IC0gZm9udFNpemUpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIGZvbnRTaXplIC8gMilcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgZm9udFNpemUgKyAncHgnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnIzAwMCcpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzBweCcpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5yZWRyYXcodGhpcy5jb25maWcubWluLCAwKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuYnVpbGRQb2ludGVyUGF0aCA9IGZ1bmN0aW9uKHZhbHVlKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBkZWx0YSA9IHRoaXMuY29uZmlnLnJhbmdlIC8gMTM7XG5cbiAgICAgICAgICAgICAgICB2YXIgaGVhZCA9IHZhbHVlVG9Qb2ludCh2YWx1ZSwgMC44NSk7XG4gICAgICAgICAgICAgICAgdmFyIGhlYWQxID0gdmFsdWVUb1BvaW50KHZhbHVlIC0gZGVsdGEsIDAuMTIpO1xuICAgICAgICAgICAgICAgIHZhciBoZWFkMiA9IHZhbHVlVG9Qb2ludCh2YWx1ZSArIGRlbHRhLCAwLjEyKTtcblxuICAgICAgICAgICAgICAgIHZhciB0YWlsVmFsdWUgPSB2YWx1ZSAtICh0aGlzLmNvbmZpZy5yYW5nZSAqICgxLygyNzAvMzYwKSkgLyAyKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFpbCA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUsIDAuMjgpO1xuICAgICAgICAgICAgICAgIHZhciB0YWlsMSA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUgLSBkZWx0YSwgMC4xMik7XG4gICAgICAgICAgICAgICAgdmFyIHRhaWwyID0gdmFsdWVUb1BvaW50KHRhaWxWYWx1ZSArIGRlbHRhLCAwLjEyKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBbaGVhZCwgaGVhZDEsIHRhaWwyLCB0YWlsLCB0YWlsMSwgaGVhZDIsIGhlYWRdO1xuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdmFsdWVUb1BvaW50KHZhbHVlLCBmYWN0b3IpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBzZWxmLnZhbHVlVG9Qb2ludCh2YWx1ZSwgZmFjdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgcG9pbnQueCAtPSBzZWxmLmNvbmZpZy5jeDtcbiAgICAgICAgICAgICAgICAgICAgcG9pbnQueSAtPSBzZWxmLmNvbmZpZy5jeTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQgPSBmdW5jdGlvbihzdGFydCwgZW5kLCBjb2xvcilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiAoMCA+PSBlbmQgLSBzdGFydCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOnBhdGgnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBjb2xvcilcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2QnLCBkMy5zdmcuYXJjKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdGFydEFuZ2xlKHRoaXMudmFsdWVUb1JhZGlhbnMoc3RhcnQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmVuZEFuZ2xlKHRoaXMudmFsdWVUb1JhZGlhbnMoZW5kKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5pbm5lclJhZGl1cygwLjY1ICogdGhpcy5jb25maWcucmFkaXVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm91dGVyUmFkaXVzKDAuODUgKiB0aGlzLmNvbmZpZy5yYWRpdXMpKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oKSB7IHJldHVybiAndHJhbnNsYXRlKCcgKyBzZWxmLmNvbmZpZy5jeCArICcsICcgKyBzZWxmLmNvbmZpZy5jeSArICcpIHJvdGF0ZSgyNzApJyB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMucmVkcmF3ID0gZnVuY3Rpb24odmFsdWUsIHRyYW5zaXRpb25EdXJhdGlvbilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgaXNEaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaXNEaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJDb250YWluZXIgPSB0aGlzLmJvZHkuc2VsZWN0KCcucG9pbnRlckNvbnRhaW5lcicpO1xuXG4gICAgICAgICAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoJ3RleHQnKS50ZXh0KHBhcnNlRmxvYXQodmFsdWUpLnRvRml4ZWQoMikgKyAnJScpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXIgPSBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbCgncGF0aCcpO1xuICAgICAgICAgICAgICAgIHBvaW50ZXIudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbih1bmRlZmluZWQgIT0gdHJhbnNpdGlvbkR1cmF0aW9uID8gdHJhbnNpdGlvbkR1cmF0aW9uIDogdGhpcy5jb25maWcudHJhbnNpdGlvbkR1cmF0aW9uKVxuICAgICAgICAgICAgICAgICAgICAvLy5kZWxheSgwKVxuICAgICAgICAgICAgICAgICAgICAvLy5lYXNlKCdsaW5lYXInKVxuICAgICAgICAgICAgICAgICAgICAvLy5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbihkKVxuICAgICAgICAgICAgICAgICAgICAuYXR0clR3ZWVuKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbigpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludGVyVmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IHNlbGYuY29uZmlnLm1heCkgcG9pbnRlclZhbHVlID0gc2VsZi5jb25maWcubWF4ICsgMC4wMipzZWxmLmNvbmZpZy5yYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlIDwgc2VsZi5jb25maWcubWluKSBwb2ludGVyVmFsdWUgPSBzZWxmLmNvbmZpZy5taW4gLSAwLjAyKnNlbGYuY29uZmlnLnJhbmdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldFJvdGF0aW9uID0gKHNlbGYudmFsdWVUb0RlZ3JlZXMocG9pbnRlclZhbHVlKSAtIDkwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Um90YXRpb24gPSBzZWxmLl9jdXJyZW50Um90YXRpb24gfHwgdGFyZ2V0Um90YXRpb247XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jdXJyZW50Um90YXRpb24gPSB0YXJnZXRSb3RhdGlvbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0ZXApXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uID0gY3VycmVudFJvdGF0aW9uICsgKHRhcmdldFJvdGF0aW9uLWN1cnJlbnRSb3RhdGlvbikqc3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgc2VsZi5jb25maWcuY3ggKyAnLCAnICsgc2VsZi5jb25maWcuY3kgKyAnKSByb3RhdGUoJyArIHJvdGF0aW9uICsgJyknO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBvdXRlckNpcmNsZSA9IHRoaXMuYm9keS5zZWxlY3QoJy5vdXRlci1jaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPj0gMCAmJiBpIDwgNzUgJiYgIWlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuZ3JlZW5Db2xvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+PSA3NSAmJiBpIDwgOTAgJiYgIWlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcueWVsbG93Q29sb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IDAgJiYgaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5yZWRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLnJlZENvbG9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWVUb0RlZ3JlZXMgPSBmdW5jdGlvbih2YWx1ZSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAvLyB0aGFua3MgQGNsb3NlYWxlcnRcbiAgICAgICAgICAgICAgICAvL3JldHVybiB2YWx1ZSAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwIC0gNDU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlIC8gdGhpcy5jb25maWcucmFuZ2UgKiAyNzAgLSAodGhpcy5jb25maWcubWluIC8gdGhpcy5jb25maWcucmFuZ2UgKiAyNzAgKyA0NSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnZhbHVlVG9SYWRpYW5zID0gZnVuY3Rpb24odmFsdWUpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVUb0RlZ3JlZXModmFsdWUpICogTWF0aC5QSSAvIDE4MDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWVUb1BvaW50ID0gZnVuY3Rpb24odmFsdWUsIGZhY3RvcilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBcdHg6IHRoaXMuY29uZmlnLmN4IC0gdGhpcy5jb25maWcucmFkaXVzICogZmFjdG9yICogTWF0aC5jb3ModGhpcy52YWx1ZVRvUmFkaWFucyh2YWx1ZSkpLFxuICAgICAgICAgICAgICAgICAgICB5OiB0aGlzLmNvbmZpZy5jeSAtIHRoaXMuY29uZmlnLnJhZGl1cyAqIGZhY3RvciAqIE1hdGguc2luKHRoaXMudmFsdWVUb1JhZGlhbnModmFsdWUpKSBcdFx0fTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGluaXRpYWxpemF0aW9uXG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyZShjb25maWd1cmF0aW9uKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY3JlYXRlR2F1Z2U6IGZ1bmN0aW9uIChuYW1lLCBsYWJlbCwgbWluLCBtYXgsIHNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgICAgICBzaXplOiBzaXplIHx8IHNjYWxlQ29uZmlnLmRlZmF1bHRHYXVnZVdpZHRoLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogbGFiZWwsXG4gICAgICAgICAgICAgICAgICAgIG1pbjogbWluIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIG1heDogbWF4IHx8IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgbWlub3JUaWNrczogNVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBjb25maWcubWF4IC0gY29uZmlnLm1pbjtcbiAgICAgICAgICAgICAgICBjb25maWcueWVsbG93Wm9uZXMgPSBbeyBmcm9tOiBjb25maWcubWluICsgcmFuZ2UqMC43NSwgdG86IGNvbmZpZy5taW4gKyByYW5nZSowLjkgfV07XG4gICAgICAgICAgICAgICAgY29uZmlnLnJlZFpvbmVzID0gW3sgZnJvbTogY29uZmlnLm1pbiArIHJhbmdlKjAuOSwgdG86IGNvbmZpZy5tYXggfV07XG5cbiAgICAgICAgICAgICAgICB2YXIgZ2F1Z2UgPSBuZXcgR2F1Z2UobmFtZSArICdHYXVnZUNvbnRhaW5lcicsIGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgZ2F1Z2UucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdhdWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnZ3JpZEZhY3RvcnknLCBmdW5jdGlvbiAodWlHcmlkQ29uc3RhbnRzKSB7XG5cbiAgICAgICAgdmFyIGdldFNvcnRDb25maWcgPSBmdW5jdGlvbiAob3JkZXJQYXJhbSkge1xuICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcblxuICAgICAgICAgICAgaWYgKG9yZGVyUGFyYW0pIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2gob3JkZXJQYXJhbSwgZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3J0RmllbGQgPSBwYXJhbTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNvcnREaXJlY3Rpb24gPSAnYXNjJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKF8uc3RhcnRzV2l0aChwYXJhbSwgJy0nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc29ydERpcmVjdGlvbiA9ICdkZXNjJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzb3J0QXJyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBzb3J0RGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHNvcnRGaWVsZFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc29ydEFycjtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGVmYXVsdEdyaWRPcHRpb25zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlUm93U2VsZWN0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVSb3dIZWFkZXJTZWxlY3Rpb246IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVIb3Jpem9udGFsU2Nyb2xsYmFyOiB1aUdyaWRDb25zdGFudHMuc2Nyb2xsYmFycy5ORVZFUixcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlVmVydGljYWxTY3JvbGxiYXI6IHVpR3JpZENvbnN0YW50cy5zY3JvbGxiYXJzLk5FVkVSLFxuICAgICAgICAgICAgICAgICAgICBtdWx0aVNlbGVjdDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdXNlRXh0ZXJuYWxTb3J0aW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB1c2VFeHRlcm5hbEZpbHRlcmluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbWluUm93c1RvU2hvdzogMTcsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25QYWdlU2l6ZXM6IFsyNSwgNTAsIDc1LCAxMDBdLFxuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uUGFnZVNpemU6IDI1LFxuICAgICAgICAgICAgICAgICAgICB1c2VFeHRlcm5hbFBhZ2luYXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVBhZ2luYXRpb25Db250cm9sczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25DdXJyZW50UGFnZTogMVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhcHBseVNvcnRDb25maWc6IGZ1bmN0aW9uIChjb2x1bW5EZWZzLCBncmlkUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRDb25maWcgPSBnZXRTb3J0Q29uZmlnKGdyaWRQYXJhbXMub3JkZXIpO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChzb3J0Q29uZmlnLCBmdW5jdGlvbiAoY29uZmlnLCBpZHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gXy5zdGFydHNXaXRoKGNvbmZpZy5maWVsZCwgJy0nKSA/IGNvbmZpZy5maWVsZC5zdWJzdHJpbmcoMSkgOiBjb25maWcuZmllbGQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xEZWYgPSBfLmZpbmQoY29sdW1uRGVmcywge2ZpZWxkOiBmaWVsZH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xEZWYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbERlZi5zb3J0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogY29uZmlnLmRpcmVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogaWR4XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbHVtbkRlZnM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ3BvbGxlckZhY3RvcnknLCBmdW5jdGlvbiAocG9sbGVyKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuZXdQb2xsZXI6IGZ1bmN0aW9uIChyZXNvdXJjZSwgaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcG9sbGVyLmdldChyZXNvdXJjZSwge1xuICAgICAgICAgICAgICAgICAgICBkZWxheTogaW50ZXJ2YWwsXG4gICAgICAgICAgICAgICAgICAgIGNhdGNoRXJyb3I6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N0YXR1cycsIGZ1bmN0aW9uIChTdGF0dXNNYXN0ZXIsIFN0YXR1c1NjaGVkdWxlciwgU3RhdHVzUmVzb3VyY2VzKSB7XG4gICAgICAgIHZhciBTdGF0dXMgPSBmdW5jdGlvbiAoJHJlc29sdmVkLCBtYXN0ZXIsIHNjaGVkdWxlciwgcXVldWVfZGVwdGgsIHJlc291cmNlcykge1xuICAgICAgICAgICAgdGhpcy4kcmVzb2x2ZWQgPSAkcmVzb2x2ZWQ7XG4gICAgICAgICAgICB0aGlzLm1hc3RlciA9IFN0YXR1c01hc3Rlci50cmFuc2Zvcm1lcihtYXN0ZXIpO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXIgPSBTdGF0dXNTY2hlZHVsZXIudHJhbnNmb3JtZXIoc2NoZWR1bGVyKTtcbiAgICAgICAgICAgIHRoaXMucXVldWVfZGVwdGggPSBxdWV1ZV9kZXB0aDtcbiAgICAgICAgICAgIHRoaXMucmVzb3VyY2VzID0gU3RhdHVzUmVzb3VyY2VzLnRyYW5zZm9ybWVyKHJlc291cmNlcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgU3RhdHVzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldENwdVVzYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzb3VyY2VzLnNjaGVkdWxlZC5jcHVzICYmIHRoaXMucmVzb3VyY2VzLnRvdGFsLmNwdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzb3VyY2VzLnRvdGFsLmNwdXMgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCh0aGlzLnJlc291cmNlcy5zY2hlZHVsZWQuY3B1cyAvIHRoaXMucmVzb3VyY2VzLnRvdGFsLmNwdXMpICogMTAwKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAwLjAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE1lbVVzYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzb3VyY2VzLnNjaGVkdWxlZC5tZW0gJiYgdGhpcy5yZXNvdXJjZXMudG90YWwubWVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc291cmNlcy50b3RhbC5tZW0gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCh0aGlzLnJlc291cmNlcy5zY2hlZHVsZWQubWVtIC8gdGhpcy5yZXNvdXJjZXMudG90YWwubWVtKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gMC4wMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREaXNrVXNhZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLmRpc2sgJiYgdGhpcy5yZXNvdXJjZXMudG90YWwuZGlzaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMudG90YWwuZGlzayA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHRoaXMucmVzb3VyY2VzLnNjaGVkdWxlZC5kaXNrIC8gdGhpcy5yZXNvdXJjZXMudG90YWwuZGlzaykgKiAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIDAuMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLiRyZXNvbHZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tYXN0ZXIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2NoZWR1bGVyLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnF1ZXVlX2RlcHRoLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc291cmNlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0YXR1cy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChTdGF0dXMuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3RhdHVzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTdGF0dXM7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIFxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N0YXR1c01hc3RlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIFN0YXR1c01hc3RlciA9IGZ1bmN0aW9uIChpc19vbmxpbmUsIGhvc3RuYW1lLCBwb3J0KSB7XG4gICAgICAgICAgICB0aGlzLmlzX29ubGluZSA9IGlzX29ubGluZTtcbiAgICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSBob3N0bmFtZTtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgU3RhdHVzTWFzdGVyLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTdGF0dXNNYXN0ZXIuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c01hc3RlcihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vbmxpbmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaG9zdG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9ydFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c01hc3RlcigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0YXR1c01hc3Rlci50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChTdGF0dXNNYXN0ZXIuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3RhdHVzTWFzdGVyLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTdGF0dXNNYXN0ZXI7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RhdHVzUmVzb3VyY2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBTdGF0dXNSZXNvdXJjZSA9IGZ1bmN0aW9uIChjcHVzLCBtZW0sIGRpc2spIHtcbiAgICAgICAgICAgIHRoaXMuY3B1cyA9IGNwdXM7XG4gICAgICAgICAgICB0aGlzLm1lbSA9IG1lbTtcbiAgICAgICAgICAgIHRoaXMuZGlzayA9IGRpc2s7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgU3RhdHVzUmVzb3VyY2UucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0YXR1c1Jlc291cmNlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNSZXNvdXJjZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzUmVzb3VyY2UoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdGF0dXNSZXNvdXJjZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChTdGF0dXNSZXNvdXJjZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdGF0dXNSZXNvdXJjZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RhdHVzUmVzb3VyY2U7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RhdHVzUmVzb3VyY2VzJywgZnVuY3Rpb24gKFN0YXR1c1Jlc291cmNlKSB7XG4gICAgICAgIHZhciBTdGF0dXNSZXNvdXJjZXMgPSBmdW5jdGlvbiAodG90YWwsIHNjaGVkdWxlZCwgdXNlZCkge1xuICAgICAgICAgICAgdGhpcy50b3RhbCA9IFN0YXR1c1Jlc291cmNlLnRyYW5zZm9ybWVyKHRvdGFsKTtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVkID0gU3RhdHVzUmVzb3VyY2UudHJhbnNmb3JtZXIoc2NoZWR1bGVkKTtcbiAgICAgICAgICAgIHRoaXMudXNlZCA9IFN0YXR1c1Jlc291cmNlLnRyYW5zZm9ybWVyKHVzZWQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFN0YXR1c1Jlc291cmNlcy5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RhdHVzUmVzb3VyY2VzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNSZXNvdXJjZXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudG90YWwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNSZXNvdXJjZXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdGF0dXNSZXNvdXJjZXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoU3RhdHVzUmVzb3VyY2VzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0YXR1c1Jlc291cmNlcy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RhdHVzUmVzb3VyY2VzO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N0YXR1c1NjaGVkdWxlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIFN0YXR1c1NjaGVkdWxlciA9IGZ1bmN0aW9uIChpc19vbmxpbmUsIGlzX3BhdXNlZCwgaG9zdG5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuaXNfb25saW5lID0gaXNfb25saW5lO1xuICAgICAgICAgICAgdGhpcy5pc19wYXVzZWQgPSBpc19wYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmhvc3RuYW1lID0gaG9zdG5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgU3RhdHVzU2NoZWR1bGVyLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTdGF0dXNTY2hlZHVsZXIuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1NjaGVkdWxlcihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vbmxpbmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfcGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmhvc3RuYW1lXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzU2NoZWR1bGVyKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RhdHVzU2NoZWR1bGVyLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN0YXR1c1NjaGVkdWxlci5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdGF0dXNTY2hlZHVsZXIuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0YXR1c1NjaGVkdWxlcjtcbiAgICB9KTtcbn0pKCk7IiwiLyoqXG4gKiA8c2NhbGUtZmlsZS1hbmNlc3RyeS10cmVlIC8+XG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignc2NhbGVGaWxlQW5jZXN0cnlUcmVlQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5zb3VyY2UgPSAkc2NvcGUuc291cmNlO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zb3VyY2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRyYXcoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gZm9ybWF0RmlsZU5hbWUoZmlsZW5hbWUpIHtcbiAgICAgICAgICAgIHZhciBtYXhsZW4gPSAyNTtcbiAgICAgICAgICAgIHZhciBuZXdmbmFtZSA9IGZpbGVuYW1lO1xuICAgICAgICAgICAgaWYgKGZpbGVuYW1lLmxlbmd0aCA+IDMwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4dCA9IGZpbGVuYW1lLnN1YnN0cmluZyhmaWxlbmFtZS5sYXN0SW5kZXhPZignLicpKzEpO1xuICAgICAgICAgICAgICAgIHZhciBmaXJzdHBhcnRMZW4gPSBtYXhsZW4gLSBleHQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIG5ld2ZuYW1lID0gZmlsZW5hbWUuc3Vic3RyaW5nKDAsZmlyc3RwYXJ0TGVuLTEpICsgJy4uLicgKyBleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3Zm5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXROb2RlSHRtbChmaWxlKSB7XG4gICAgICAgICAgICB2YXIgaWNvbkh0bWwgPSBzY2FsZVNlcnZpY2UuZ2V0TWVkaWFUeXBlSHRtbChmaWxlLm1lZGlhX3R5cGUpO1xuICAgICAgICAgICAgdmFyIGZuYW1lID0gZm9ybWF0RmlsZU5hbWUoZmlsZS5maWxlX25hbWUpO1xuICAgICAgICAgICAgdmFyIGh0bWwgPSBcIjxkaXYgY2xhc3M9J2dyYXBoJz5cIjtcbiAgICAgICAgICAgIGh0bWwgKz0gXCI8c3BhbiBjbGFzcz0nbmFtZScgdGl0bGU9J1wiICsgZmlsZS5maWxlX25hbWUgKyBcIic+XCI7XG4gICAgICAgICAgICBodG1sICs9IFwiPGEgbmctc2hvdz0nXCIgKyBmaWxlLnVybCArIFwiJyBocmVmPSdcIiArIGZpbGUudXJsICsgXCInIHRhcmdldD0nX2pvYmZpbGUnPlwiICsgaWNvbkh0bWwgKyBcIiBcIiArIGZuYW1lICsgXCI8L2E+XCI7XG4gICAgICAgICAgICBodG1sICs9IFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgaHRtbCArPSBcIjwvZGl2PlwiO1xuXG4gICAgICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEpvYk5vZGVIdG1sKGpvYnR5cGUsIGpvYmlkKSB7XG4gICAgICAgICAgICB2YXIgaHRtbCA9IFwiPGRpdj5cIjtcbiAgICAgICAgICAgIGh0bWwgKz0gXCI8c3BhbiBjbGFzcz0nc3RhdHVzJz48L3NwYW4+PHNwYW4gY2xhc3M9J2pvYi1uYW1lJz48YSBocmVmPScjL2pvYnMvam9iL1wiICsgam9iaWQgKyBcIic+XCIgKyBqb2J0eXBlLm5hbWUgKyBcIjwvYT48L3NwYW4+XCI7XG4gICAgICAgICAgICBodG1sICs9IFwiPC9kaXY+XCI7XG5cbiAgICAgICAgICAgIHJldHVybiBodG1sO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZHJhdygpIHtcbiAgICAgICAgICAgIGlmICh2bS5zb3VyY2UgJiYgdm0uc291cmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KCdzdmcnKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5uZXIgPSBzdmcuc2VsZWN0KCdnJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgdXAgem9vbSBzdXBwb3J0XG4gICAgICAgICAgICAgICAgdmFyIHpvb20gPSBkMy5iZWhhdmlvci56b29tKClcbiAgICAgICAgICAgICAgICAgICAgLm9uKCd6b29tJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbm5lci5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyBkMy5ldmVudC50cmFuc2xhdGUgKyAnKScgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzY2FsZSgnICsgZDMuZXZlbnQuc2NhbGUgKyAnKScpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN2Zy5jYWxsKHpvb20pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJlbmRlciA9IG5ldyBkYWdyZUQzLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgIC8vIExlZnQtdG8tcmlnaHQgbGF5b3V0XG4gICAgICAgICAgICAgICAgdmFyIGcgPSBuZXcgZGFncmVEMy5ncmFwaGxpYi5HcmFwaCh7bXVsdGlncmFwaDogdHJ1ZX0pO1xuICAgICAgICAgICAgICAgIGcuc2V0R3JhcGgoe1xuICAgICAgICAgICAgICAgICAgICBub2Rlc2VwOiAzMCxcbiAgICAgICAgICAgICAgICAgICAgcmFua3NlcDogNzAsXG4gICAgICAgICAgICAgICAgICAgIHJhbmtkaXI6ICdMUicsXG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbng6IDIwLFxuICAgICAgICAgICAgICAgICAgICBtYXJnaW55OiAwXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvL1N0YXJ0aW5nIG5vZGVcbiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IGdldE5vZGVIdG1sKHZtLnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgZy5zZXROb2RlKCdmaWxlLScgKyB2bS5zb3VyY2UuaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBodG1sLFxuICAgICAgICAgICAgICAgICAgICByeDogMTAsXG4gICAgICAgICAgICAgICAgICAgIHJ5OiAxMCxcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTAsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyNTAsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjBcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFByb2R1Y3RzXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaWQgaW4gdm0uc291cmNlLnByb2R1Y3RzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9kID0gdm0uc291cmNlLnByb2R1Y3RzW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGpvYk5vZGVIdG1sID0gZ2V0Sm9iTm9kZUh0bWwocHJvZC5qb2JfdHlwZSwgcHJvZC5qb2IuaWQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgbm9kZSBmb3IgdGhlIGpvYlxuICAgICAgICAgICAgICAgICAgICBnLnNldE5vZGUoJ2pvYi0nICsgcHJvZC5qb2IuaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGpvYk5vZGVIdG1sLFxuICAgICAgICAgICAgICAgICAgICAgICAgcng6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcnk6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZy5zZXRFZGdlKCdmaWxlLScrdm0uc291cmNlLmlkLCAnam9iLScrcHJvZC5qb2IuaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbGFiZWxUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2xhYmVsOiAnPGEgaHJlZj0nIy9qb2JzL2pvYi8nICsgcHJvZC5qb2IuaWQgKyAnJz4nICsgcHJvZC5qb2JfdHlwZS5uYW1lICsgJzwvYT4nXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3dpZHRoOiA0MFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBodG1sID0gZ2V0Tm9kZUh0bWwocHJvZCk7XG4gICAgICAgICAgICAgICAgICAgIGcuc2V0Tm9kZSgnZmlsZS0nICsgcHJvZC5pZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogaHRtbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ4OiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ5OiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDI1MCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGcuc2V0RWRnZSgnam9iLScrcHJvZC5qb2IuaWQsICdmaWxlLScrcHJvZC5pZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9sYWJlbFR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbGFiZWw6ICc8YSBocmVmPScjL2pvYnMvam9iLycgKyBwcm9kLmpvYi5pZCArICcnPicgKyBwcm9kLmpvYl90eXBlLm5hbWUgKyAnPC9hPidcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vd2lkdGg6IDQwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUnVuIHRoZSByZW5kZXJlci4gVGhpcyBpcyB3aGF0IGRyYXdzIHRoZSBmaW5hbCBncmFwaC5cbiAgICAgICAgICAgICAgICByZW5kZXIoaW5uZXIsIGcpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2VudGVyIHRoZSBncmFwaFxuICAgICAgICAgICAgICAgIHZhciB2YnggPSBzdmcuYXR0cigndmlld0JveCcpLnNwbGl0KCcgJyk7XG4gICAgICAgICAgICAgICAgdmFyIGd3aWR0aCA9IGcuZ3JhcGgoKS53aWR0aDtcbiAgICAgICAgICAgICAgICB2YXIgZ2hlaWdodCA9IGcuZ3JhcGgoKS5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgdmFyIHJhdGlvID0gZ2hlaWdodC9nd2lkdGg7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhnaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh2YnhbM10pO1xuXG4gICAgICAgICAgICAgICAgLy8gSWYgZ3JhcGggaXMgc2hvcnRlciB0aGFuIGNvbnRhaW5lciwgc2hyaW5rIHRoZSBjb250YWluZXIgaGVpZ2h0XG4gICAgICAgICAgICAgICAgaWYgKCBnaGVpZ2h0IDwgdmJ4WzNdICkge1xuICAgICAgICAgICAgICAgICAgICBzdmcuYXR0cigndmlld0JveCcsIHZieFswXSArICcgJyArIHZieFsxXSArICcgJyArIHZieFsyXSArICcgJyArIGdoZWlnaHQqMS4xKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTY2FsZSBncmFwaCBiYXNlZCBvbiB3aWR0aCBvciBoZWlnaHQgYmFzZWQgb24gd2hpY2ggZXhjZWVkc1xuICAgICAgICAgICAgICAgIC8vIHZpZXdib3ggYnkgbW9zdCBwaXhlbHNcbiAgICAgICAgICAgICAgICB2YXIgaW5pdGlhbFNjYWxlID0gTWF0aC5taW4oKHZieFsyXSowLjk1KS9nd2lkdGgsKHZieFszXSowLjk1KS9naGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB6b29tXG4gICAgICAgICAgICAgICAgICAgIC50cmFuc2xhdGUoWyh2YnhbMl0qMC4wMiksICh2YnhbM10qMC4wMildKVxuICAgICAgICAgICAgICAgICAgICAuc2NhbGUoaW5pdGlhbFNjYWxlKVxuICAgICAgICAgICAgICAgICAgICAuZXZlbnQoc3ZnKTtcblxuICAgICAgICAgICAgICAgIC8vIHNldCBhcHByb3ByaWF0ZSBjbGFzcyBmb3Igam9iIG5vZGVzXG4gICAgICAgICAgICAgICAgJCgnLmpvYi1uYW1lJykuY2xvc2VzdCgnLm5vZGUnKS5jaGlsZHJlbigncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2pvYicpOyAvLy5hZGRDbGFzcygnam9iJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG5cblxuICAgIH0pLmRpcmVjdGl2ZSgnc2NhbGVGaWxlQW5jZXN0cnlUcmVlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAndXNlIHN0cmljdCc7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2FnZTogPHNjYWxlLWZpbGUtYW5jZXN0cnktdHJlZSBzb3VyY2U9J3NvdXJjZScgLz5cbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnc2NhbGVGaWxlQW5jZXN0cnlUcmVlQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvZmVlZC9kaXJlY3RpdmVzL2ZpbGVBbmNlc3RyeVRyZWVUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHNvdXJjZTogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2ZlZWREZXRhaWxzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGZlZWRTZXJ2aWNlLCBtb21lbnQpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5mZWVkRGF0YSA9IHt9O1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmZlZWQ7XG4gICAgICAgIHZtLnVzZUluZ2VzdFRpbWUgPSAnZmFsc2UnO1xuICAgICAgICB2bS5maWx0ZXJWYWx1ZSA9IDE7XG4gICAgICAgIHZtLmZpbHRlckR1cmF0aW9uID0gJ3cnO1xuXG4gICAgICAgIHZtLmNoYW5nZUZlZWRTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIHNldEZlZWRVcmwoKTtcbiAgICAgICAgICAgIC8vZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNoYW5nZUluZ2VzdFRpbWVTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIHNldEZlZWRVcmwoKTtcbiAgICAgICAgICAgIGdldEZlZWQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0RmVlZFBhcmFtcyA9IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgdmFyIHN0cmlrZUlkID0gdm0uc2VsZWN0ZWRGZWVkID8gdm0uc2VsZWN0ZWRGZWVkLnN0cmlrZS5pZCA6IG51bGw7XG4gICAgICAgICAgICB2YXIgdXNlSW5nZXN0VGltZSA9IHZtLnVzZUluZ2VzdFRpbWUgPyB2bS51c2VJbmdlc3RUaW1lIDogbnVsbDtcblxuICAgICAgICAgICAgcGFyYW1zLnN0YXJ0ZWQgPSBtb21lbnQudXRjKCkuc3VidHJhY3Qodm0uZmlsdGVyVmFsdWUsIHZtLmZpbHRlckR1cmF0aW9uKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIHBhcmFtcy5lbmRlZCA9IG1vbWVudC51dGMocGFyYW1zLnN0YXJ0ZWQpLmFkZCgxLCB2bS5maWx0ZXJEdXJhdGlvbikuZW5kT2YoJ2QnKS50b0lTT1N0cmluZygpO1xuXG4gICAgICAgICAgICBpZiAoc3RyaWtlSWQgIT0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0cmlrZV9pZCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5zdHJpa2VfaWQgPSBzdHJpa2VJZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJGxvY2F0aW9uLnNlYXJjaCgpLnN0cmlrZV9pZCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5zdHJpa2VfaWQgPSAkbG9jYXRpb24uc2VhcmNoKCkuc3RyaWtlX2lkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXNlSW5nZXN0VGltZSAhPSAkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lKSB7XG4gICAgICAgICAgICAgICBwYXJhbXMudXNlX2luZ2VzdF90aW1lID0gdXNlSW5nZXN0VGltZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZSkge1xuICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2dldEZlZWRQYXJhbXMgdXNlX2luZ2VzdF90aW1lOiAnICsgJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZSk7XG4gICAgICAgICAgICAgICBwYXJhbXMudXNlX2luZ2VzdF90aW1lID0gJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0RmVlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKCRsb2NhdGlvbi5zZWFyY2goKS51c2VfaW5nZXN0X3RpbWUpIHtcbiAgICAgICAgICAgICAgICB2bS51c2VJbmdlc3RUaW1lID0gJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBmZWVkUGFyYW1zID0gZ2V0RmVlZFBhcmFtcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChmZWVkUGFyYW1zKTtcbiAgICAgICAgICAgIGZlZWRTZXJ2aWNlLmdldEZlZWQoZmVlZFBhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmFsbEZlZWRzID0gXy5zb3J0QnlPcmRlcihkYXRhLnJlc3VsdHMsIFsnc3RyaWtlLm5hbWUnXSwgWydhc2MnXSk7XG4gICAgICAgICAgICAgICAgdmFyIHN0cmlrZUlkID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0cmlrZV9pZDtcbiAgICAgICAgICAgICAgICBpZihzdHJpa2VJZCl7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBzZWxlY3RlZEZlZWQgPSBuZXcgZmVlZFxuICAgICAgICAgICAgICAgICAgICB2YXIgZmVlZCA9IF8uZmluZCh2bS5hbGxGZWVkcywgZnVuY3Rpb24gKGZlZWQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZlZWQuc3RyaWtlLmlkID09IHN0cmlrZUlkO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRGZWVkID0gZmVlZCA/IGZlZWQgOiBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRmVlZCA9IHZtLmFsbEZlZWRzWzBdO1xuICAgICAgICAgICAgICAgICAgICBzZXRGZWVkVXJsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVGZWVkUmFuZ2UgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnb2xkZXInKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyVmFsdWUrKztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnbmV3ZXInKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmZpbHRlclZhbHVlID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5maWx0ZXJWYWx1ZS0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAndG9kYXknKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyVmFsdWUgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZXRGZWVkVXJsID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAvLyBzZXQgcGFyYW0gaW4gVVJMXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0RmVlZFBhcmFtcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChwYXJhbXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignZmVlZCcpO1xuICAgICAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnZmVlZCcpO1xuICAgICAgICAgICAgZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5maWx0ZXJWYWx1ZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdmFyICRmZWVkTmV3ZXIgPSAkKCcuZmVlZC1uZXdlcicpLFxuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkgPSAkKCcuZmVlZC10b2RheScpO1xuXG4gICAgICAgICAgICBpZiAodmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgJGZlZWROZXdlci5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGZlZWROZXdlci5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignaW5nZXN0UmVjb3JkRGV0YWlsc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm91dGVQYXJhbXMsIHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGZlZWRTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MuZmVlZDtcbiAgICAgICAgdm0uc2NhbGVTZXJ2aWNlID0gc2NhbGVTZXJ2aWNlO1xuICAgICAgICB2bS5tb21lbnQgPSBtb21lbnQ7XG4gICAgICAgIHZtLmluZ2VzdFJlY29yZCA9IG51bGw7XG5cbiAgICAgICAgdmFyIGdldEluZ2VzdFJlY29yZERldGFpbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGZlZWRTZXJ2aWNlLmdldFNvdXJjZURldGFpbHMoJHJvdXRlUGFyYW1zLmlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0UmVjb3JkID0gZGF0YTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignZmVlZCcpO1xuICAgICAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnZmVlZC9pbmdlc3RzJyk7XG4gICAgICAgICAgICBnZXRJbmdlc3RSZWNvcmREZXRhaWxzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2FsY3VsYXRlRmlsZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyhzaXplKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignaW5nZXN0UmVjb3Jkc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sICR0aW1lb3V0LCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIGZlZWRTZXJ2aWNlLCBzdHJpa2VTZXJ2aWNlLCBuYXZTZXJ2aWNlLCBzdWJuYXZTZXJ2aWNlLCBncmlkRmFjdG9yeSwgcG9sbGVyKSB7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2ZlZWQvaW5nZXN0cycpO1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0uaW5nZXN0c1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRJbmdlc3RzUGFyYW1zKCk7XG5cbiAgICAgICAgdm0uc3RhdGVTZXJ2aWNlID0gc3RhdGVTZXJ2aWNlO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5mZWVkO1xuICAgICAgICB2bS5pbmdlc3RTdGF0dXNWYWx1ZXMgPSBzY2FsZUNvbmZpZy5pbmdlc3RTdGF0dXM7XG4gICAgICAgIHZtLnNlbGVjdGVkSW5nZXN0U3RhdHVzID0gdm0uaW5nZXN0c1BhcmFtcy5zdGF0dXMgfHwgdm0uaW5nZXN0U3RhdHVzVmFsdWVzWzBdO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydCA9IG1vbWVudC51dGModm0uaW5nZXN0c1BhcmFtcy5zdGFydGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3AgPSBtb21lbnQudXRjKHZtLmluZ2VzdHNQYXJhbXMuZW5kZWQpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZGF0ZU1vZGVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpbWV6b25lOiAnKzAwMCdcbiAgICAgICAgfTtcbiAgICAgICAgdm0uaW5nZXN0RGF0YSA9IFtdO1xuICAgICAgICB2bS5zdHJpa2VEYXRhID0gW107XG4gICAgICAgIHZtLnNlbGVjdGVkU3RyaWtlID0ge307XG4gICAgICAgIHZtLnNlYXJjaFRleHQgPSB2bS5pbmdlc3RzUGFyYW1zLmZpbGVfbmFtZSB8fCAnJztcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuXG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25DdXJyZW50UGFnZSA9IHZtLmluZ2VzdHNQYXJhbXMucGFnZSB8fCAxO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplID0gdm0uaW5nZXN0c1BhcmFtcy5wYWdlX3NpemUgfHwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICB9KTtcblxuICAgICAgICB2bS5yZWZyZXNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZERhdGEgPSBfLmZpbHRlcih2bS5pbmdlc3REYXRhLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmZpbGVfbmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZtLnNlYXJjaFRleHQudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBmaWx0ZXJlZERhdGEubGVuZ3RoID4gMCA/IGZpbHRlcmVkRGF0YSA6IHZtLmdyaWRPcHRpb25zLmRhdGE7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGZpbHRlcmVkQnlTdGF0dXMgPSB2bS5pbmdlc3RzUGFyYW1zLnN0YXR1cyA/IHRydWUgOiBmYWxzZSxcbiAgICAgICAgICAgIGZpbHRlcmVkQnlTdHJpa2UgPSB2bS5pbmdlc3RzUGFyYW1zLnN0cmlrZV9pZCA/IHRydWUgOiBmYWxzZSxcbiAgICAgICAgICAgIGZpbHRlcmVkQnlPcmRlciA9IHZtLmluZ2VzdHNQYXJhbXMub3JkZXIgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgdm0uY29sRGVmcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2ZpbGVfbmFtZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdGaWxlIE5hbWUnLFxuICAgICAgICAgICAgICAgIC8vZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PGlucHV0IG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS52bS5zZWFyY2hUZXh0XCIgbmctY2hhbmdlPVwiZ3JpZC5hcHBTY29wZS52bS5yZWZyZXNoRGF0YSgpXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBwbGFjZWhvbGRlcj1cIlNlYXJjaFwiPjwvZGl2PidcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnZmlsZV9zaXplJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0ZpbGUgU2l6ZScsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5maWxlX3NpemVfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3N0cmlrZS50aXRsZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdTdHJpa2UgUHJvY2VzcycsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkuc3RyaWtlLnRpdGxlIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkU3RyaWtlXCIgbmctb3B0aW9ucz1cInN0cmlrZSBhcyBzdHJpa2UudGl0bGUudG9VcHBlckNhc2UoKSBmb3Igc3RyaWtlIGluIGdyaWQuYXBwU2NvcGUudm0uc3RyaWtlRGF0YVwiPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdzdGF0dXMnLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRJbmdlc3RTdGF0dXNcIiBuZy1vcHRpb25zPVwic3RhdHVzLnRvVXBwZXJDYXNlKCkgZm9yIHN0YXR1cyBpbiBncmlkLmFwcFNjb3BlLnZtLmluZ2VzdFN0YXR1c1ZhbHVlc1wiPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICd0cmFuc2Zlcl9zdGFydGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnRyYW5zZmVyX3N0YXJ0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3RyYW5zZmVyX2VuZGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnRyYW5zZmVyX2VuZGVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpbmdlc3Rfc3RhcnRlZCcsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5pbmdlc3Rfc3RhcnRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5nZXN0X2VuZGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmluZ2VzdF9lbmRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ2V0SW5nZXN0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgZmVlZFNlcnZpY2UuZ2V0SW5nZXN0c09uY2Uodm0uaW5nZXN0c1BhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdERhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcG9sbGVyLnN0b3BBbGwoKTtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRJbmdlc3RzUGFyYW1zKHZtLmluZ2VzdHNQYXJhbXMpO1xuICAgICAgICAgICAgdm0uZ2V0SW5nZXN0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUNvbERlZnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZ3JpZEZhY3RvcnkuYXBwbHlTb3J0Q29uZmlnKHZtLmNvbERlZnMsIHZtLmluZ2VzdHNQYXJhbXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUluZ2VzdE9yZGVyID0gZnVuY3Rpb24gKHNvcnRBcnIpIHtcbiAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMub3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDAgPyBzb3J0QXJyIDogbnVsbDtcbiAgICAgICAgICAgIGZpbHRlcmVkQnlPcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVJbmdlc3RTdGF0dXMgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB2bS5pbmdlc3RzUGFyYW1zLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5pbmdlc3RzUGFyYW1zLnN0YXR1cyA9IHZhbHVlID09PSAnVklFVyBBTEwnID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSW5nZXN0U3RyaWtlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUudGl0bGUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuaWQgIT09IHZtLmluZ2VzdHNQYXJhbXMuc3RyaWtlX2lkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMuc3RyaWtlX2lkID0gdmFsdWUudGl0bGUgPT09ICdWSUVXIEFMTCcgPyBudWxsIDogdmFsdWUuaWQ7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0U3RyaWtlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN0cmlrZVNlcnZpY2UuZ2V0U3RyaWtlcygpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RyaWtlVmlld0FsbCA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICd2aWV3YWxsJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdWSUVXIEFMTCdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZtLnN0cmlrZURhdGEgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHZtLnN0cmlrZURhdGEudW5zaGlmdChzdHJpa2VWaWV3QWxsKTtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFN0cmlrZSA9IF8uZmluZCh2bS5zdHJpa2VEYXRhLCB7IGlkOiB2bS5pbmdlc3RzUGFyYW1zLnN0cmlrZV9pZCB9KSB8fCBkYXRhWzBdO1xuICAgICAgICAgICAgICAgIHZtLmdldEluZ2VzdHMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgLy9zZXQgZ3JpZEFwaSBvbiBzY29wZVxuICAgICAgICAgICAgdm0uZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5wYWdlID0gY3VycmVudFBhZ2U7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuc2VsZWN0aW9uLm9uLnJvd1NlbGVjdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgaWYocm93LmVudGl0eS5zb3VyY2VfZmlsZSAmJiByb3cuZW50aXR5LnNvdXJjZV9maWxlLmlkKXtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9mZWVkL2luZ2VzdHMvJyArIHJvdy5lbnRpdHkuc291cmNlX2ZpbGUuaWQpLnNlYXJjaCgnJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wiaW5mb1wiXSgnU291cmNlIGZpbGUgaXMgdW5kZWZpbmVkIGZvciAnICsgcm93LmVudGl0eS5maWxlX25hbWUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEluZ2VzdHNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSW5nZXN0T3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJCeUZpbGVuYW1lID0gZnVuY3Rpb24gKGtleUV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoIWtleUV2ZW50IHx8IChrZXlFdmVudCAmJiBrZXlFdmVudC53aGljaCA9PT0gMTMpKSB7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5maWxlX25hbWUgPSB2bS5zZWFyY2hUZXh0O1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEluZ2VzdHNQYXJhbXModm0uaW5nZXN0c1BhcmFtcyk7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgICAgICB2bS5nZXRTdHJpa2VzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdmZWVkJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkSW5nZXN0U3RhdHVzJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUluZ2VzdFN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5U3RhdHVzID0gdmFsdWUgIT09ICdWSUVXIEFMTCc7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSW5nZXN0U3RhdHVzKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uc2VsZWN0ZWRTdHJpa2UnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlTdHJpa2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlSW5nZXN0U3RyaWtlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlTdHJpa2UgPSB2YWx1ZS50aXRsZSAhPT0gJ1ZJRVcgQUxMJztcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVJbmdlc3RTdHJpa2UodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdGFydCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5zdGFydGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmxhc3RNb2RpZmllZFN0b3AnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMuZW5kZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXRJbmdlc3RzQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0SW5nZXN0c1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5pbmdlc3RzUGFyYW1zID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignc2NhbkRldGFpbHNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJHJvdXRlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgU2NhbiwgU2NhbkluZ2VzdEZpbGUsIHNjYWxlQ29uZmlnLCBuYXZTZXJ2aWNlLCBzdWJuYXZTZXJ2aWNlLCBzY2FuU2VydmljZSwgd29ya3NwYWNlc1NlcnZpY2UsIHNjYWxlU2VydmljZSwgc3RhdGVTZXJ2aWNlLCB1c2VyU2VydmljZSwgdG9hc3RyKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBjdXJyU2NhbiA9IHt9O1xuXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5zY2FsZUNvbmZpZyA9IHNjYWxlQ29uZmlnO1xuICAgICAgICB2bS53b3Jrc3BhY2VzID0gW107XG4gICAgICAgIHZtLm5ld1dvcmtzcGFjZXMgPSBbXTtcbiAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0ge307XG4gICAgICAgIHZtLmxvY2FsU2NhbnMgPSBbXTtcbiAgICAgICAgdm0uYWN0aXZlU2NhbiA9IG5ldyBTY2FuKCk7XG4gICAgICAgIHZtLmFjdGl2ZVNjYW5Jbmdlc3RGaWxlID0gbmV3IFNjYW5Jbmdlc3RGaWxlKCk7XG4gICAgICAgIHZtLmRhdGFUeXBlID0gJyc7XG4gICAgICAgIHZtLmF2YWlsYWJsZVdvcmtzcGFjZVR5cGVzID0gXy5jbG9uZURlZXAoc2NhbGVDb25maWcud29ya3NwYWNlVHlwZXMpO1xuICAgICAgICB2bS5hZGRCdG5DbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgIHZtLmFkZEJ0bkljb24gPSAnZmEtcGx1cy1jaXJjbGUnO1xuICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuICAgICAgICB2bS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgIHZtLnJlYWRvbmx5ID0gISh2bS51c2VyICYmIHZtLnVzZXIuaXNfYWRtaW4pO1xuICAgICAgICB2bS5KU09OID0gSlNPTjtcblxuICAgICAgICB2bS5jYW5jZWxDcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuICAgICAgICAgICAgLy8gcmV2ZXJ0IGFueSBjaGFuZ2VzIHRvIHRoZSBzY2FuXG4gICAgICAgICAgICB2bS5hY3RpdmVTY2FuID0gU2Nhbi50cmFuc2Zvcm1lcihfLmNsb25lRGVlcChjdXJyU2NhbikpO1xuICAgICAgICAgICAgaWYgKCRyb3V0ZVBhcmFtcy5pZCA9PT0gJzAnKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9mZWVkL3NjYW5zJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZWRpdFNjYW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzdG9yZSBhIHJlZmVyZW5jZSBvZiB0aGUgc2NhbiBhcyBpdCBjdXJyZW50bHkgZXhpc3RzIGluIGNhc2UgdGhlIHVzZXIgY2FuY2VscyB0aGUgZWRpdFxuICAgICAgICAgICAgY3VyclNjYW4gPSBTY2FuLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKHZtLmFjdGl2ZVNjYW4pKTtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAnZWRpdCc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2F2ZVNjYW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzY2FuU2VydmljZS5zYXZlU2Nhbih2bS5hY3RpdmVTY2FuKS50aGVuKGZ1bmN0aW9uIChzY2FuKSB7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU2NhbiA9IFNjYW4udHJhbnNmb3JtZXIoc2Nhbik7XG4gICAgICAgICAgICAgICAgLy8gb25seSBzdG9yZSB0aGUgbmV3IHdvcmtzcGFjZSBuYW1lLCBub3QgdGhlIGVudGlyZSBvYmplY3RcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uYWN0aXZlU2Nhbi5jb25maWd1cmF0aW9uLmZpbGVzX3RvX2luZ2VzdCwgZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUubmV3X3dvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5uZXdfd29ya3NwYWNlID0gZmlsZS5uZXdfd29ya3NwYWNlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoc2NhbGVDb25maWcuc3RhdGljKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzY2FuJyArIHZtLmFjdGl2ZVNjYW4uaWQsIEpTT04uc3RyaW5naWZ5KHZtLmFjdGl2ZVNjYW4pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCRyb3V0ZVBhcmFtcy5pZCA9PT0gJzAnKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZmVlZC9zY2Fucy8nICsgdm0uYWN0aXZlU2Nhbi5pZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHJvdXRlLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2xlYXJMb2NhbFNjYW5zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmxvY2FsU2NhbnMsIGZ1bmN0aW9uIChzY2FuKSB7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3NjYW4nICsgc2Nhbi5pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZmVlZC9zY2FucycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLm5ld1NjYW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICB2bS5sb2FkU2NhbigwKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5sb2FkU2NhbiA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2ZlZWQvc2NhbnMvJyArIGlkKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0V2FybmluZ3NIdG1sID0gZnVuY3Rpb24gKHdhcm5pbmdzKSB7XG4gICAgICAgICAgICB2YXIgd2FybmluZ3NIdG1sID0gJyc7XG4gICAgICAgICAgICBfLmZvckVhY2god2FybmluZ3MsIGZ1bmN0aW9uICh3YXJuaW5nKSB7XG4gICAgICAgICAgICAgICAgd2FybmluZ3NIdG1sICs9ICc8Yj4nICsgd2FybmluZy5pZCArICc6PC9iPiAnICsgd2FybmluZy5kZXRhaWxzICsgJzxiciAvPjxiciAvPic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHdhcm5pbmdzSHRtbCArPSAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLWRlZmF1bHQgYnRuLXhzIGNsZWFyXCI+SGlkZTwvYnV0dG9uPic7XG4gICAgICAgICAgICByZXR1cm4gd2FybmluZ3NIdG1sO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnZhbGlkYXRlU2NhbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgc2NhblNlcnZpY2UudmFsaWRhdGVTY2FuKHZtLmFjdGl2ZVNjYW4pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS53YXJuaW5ncyAmJiBkYXRhLndhcm5pbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzcGxheSB0aGUgd2FybmluZ3NcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdhcm5pbmdzSHRtbCA9IGdldFdhcm5pbmdzSHRtbChkYXRhLndhcm5pbmdzKTtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKHdhcm5pbmdzSHRtbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydzdWNjZXNzJ10oJ1NjYW4gaXMgdmFsaWQuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yICYmIGVycm9yLmRldGFpbCkge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IuZGV0YWlsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oJ0Vycm9yIHZhbGlkYXRpbmcgc2NhbicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRpc2FibGVTYXZlQnRuID0gZnVuY3Rpb24gKGludmFsaWQpIHtcbiAgICAgICAgICAgIHZhciByZXR1cm5WYWwgPSAhKCFpbnZhbGlkICYmIHZtLmFjdGl2ZVNjYW4uY29uZmlndXJhdGlvbi5maWxlc190b19pbmdlc3QubGVuZ3RoID4gMCk7XG4gICAgICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSByZXR1cm5WYWwgPyAnYnRuLWRlZmF1bHQnIDogJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWw7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkU2NhbkluZ2VzdEZpbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoXy5rZXlzKHZtLmFjdGl2ZVNjYW5Jbmdlc3RGaWxlKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU2Nhbi5jb25maWd1cmF0aW9uLmZpbGVzX3RvX2luZ2VzdC5wdXNoKFNjYW5Jbmdlc3RGaWxlLnRyYW5zZm9ybWVyKHZtLmFjdGl2ZVNjYW5Jbmdlc3RGaWxlKSk7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU2NhbkluZ2VzdEZpbGUgPSBuZXcgU2NhbkluZ2VzdEZpbGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5kZWxldGVTY2FuSW5nZXN0RmlsZSA9IGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgICAgICBfLnJlbW92ZSh2bS5hY3RpdmVTY2FuLmNvbmZpZ3VyYXRpb24uZmlsZXNfdG9faW5nZXN0LCBmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmVxdWFscyhmLCBmaWxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmFkZERhdGFUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHZtLmRhdGFUeXBlKSB7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU2NhbkluZ2VzdEZpbGUuZGF0YV90eXBlcy5wdXNoKHZtLmRhdGFUeXBlKTtcbiAgICAgICAgICAgICAgICB2bS5kYXRhVHlwZSA9ICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlbW92ZURhdGFUeXBlID0gZnVuY3Rpb24gKGRhdGFUeXBlKSB7XG4gICAgICAgICAgICBfLnJlbW92ZSh2bS5hY3RpdmVTY2FuSW5nZXN0RmlsZS5kYXRhX3R5cGVzLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkID09PSBkYXRhVHlwZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZVdvcmtzcGFjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTY2FuKSB7XG4gICAgICAgICAgICAgICAgdmFyIHdvcmtzcGFjZU9iaiA9IF8uZmluZCh2bS53b3Jrc3BhY2VzLCB7bmFtZTogdm0uYWN0aXZlU2Nhbi5jb25maWd1cmF0aW9uLndvcmtzcGFjZX0pO1xuICAgICAgICAgICAgICAgIGlmICh3b3Jrc3BhY2VPYmopIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubmV3V29ya3NwYWNlcyA9IF8uY2xvbmVEZWVwKHZtLndvcmtzcGFjZXMpO1xuICAgICAgICAgICAgICAgICAgICBfLnJlbW92ZSh2bS5uZXdXb3Jrc3BhY2VzLCB3b3Jrc3BhY2VPYmopO1xuICAgICAgICAgICAgICAgICAgICBnZXRXb3Jrc3BhY2VEZXRhaWxzKHdvcmtzcGFjZU9iai5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZvcm1hdEpTT04gPSBmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICAgICAgZmlsZSA9IF8ub21pdChmaWxlLCAnJCRoYXNoS2V5Jyk7XG4gICAgICAgICAgICBpZiAoZmlsZS5uZXdfd29ya3NwYWNlKSB7XG4gICAgICAgICAgICAgICAgZmlsZS5uZXdfd29ya3NwYWNlID0gZmlsZS5uZXdfd29ya3NwYWNlLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIganNvblN0ciA9IEpTT04uc3RyaW5naWZ5KGZpbGUsIG51bGwsIDQpO1xuICAgICAgICAgICAgcmV0dXJuIGpzb25TdHIucmVwbGFjZSgvXFxcXFxcXFwvZywgJ1xcXFwnKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0V29ya3NwYWNlRGV0YWlscyA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB3b3Jrc3BhY2VzU2VydmljZS5nZXRXb3Jrc3BhY2VEZXRhaWxzKGlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0gZGF0YTtcbiAgICAgICAgICAgICAgICBpZiAodm0uYWN0aXZlV29ya3NwYWNlLmpzb25fY29uZmlnLmJyb2tlci50eXBlID09PSAnaG9zdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uYWN0aXZlU2Nhbi5jb25maWd1cmF0aW9uLnNjYW5uZXIudHlwZSA9ICdkaXInO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodm0uYWN0aXZlV29ya3NwYWNlLmpzb25fY29uZmlnLmJyb2tlci50eXBlID09PSAnczMnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVNjYW4uY29uZmlndXJhdGlvbi5zY2FubmVyLnR5cGUgPSAnczMnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVNjYW4uY29uZmlndXJhdGlvbi5zY2FubmVyLnR5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRXb3Jrc3BhY2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2UuZ2V0V29ya3NwYWNlcygpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS53b3Jrc3BhY2VzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB2bS5uZXdXb3Jrc3BhY2VzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVXb3Jrc3BhY2UoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0V29ya3NwYWNlcygpO1xuICAgICAgICAgICAgdm0uYWN0aXZlU2NhbiA9IG51bGw7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuXG4gICAgICAgICAgICBpZiAoJHJvdXRlUGFyYW1zLmlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gcGFyc2VJbnQoJHJvdXRlUGFyYW1zLmlkKTtcbiAgICAgICAgICAgICAgICBpZiAoaWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubW9kZSA9ICdhZGQnO1xuICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVTY2FuID0gbmV3IFNjYW4oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzY2FuU2VydmljZS5nZXRTY2FuRGV0YWlscyhpZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWN0aXZlU2NhbiA9IFNjYW4udHJhbnNmb3JtZXIoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2ZlZWQnKTtcbiAgICAgICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2ZlZWQvc2NhbnMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdzY2Fuc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sICR0aW1lb3V0LCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIHNjYW5TZXJ2aWNlLCBTY2FuLCBuYXZTZXJ2aWNlLCBzdWJuYXZTZXJ2aWNlLCBncmlkRmFjdG9yeSkge1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdmZWVkL3NjYW5zJyk7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5zY2Fuc1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRTY2Fuc1BhcmFtcygpO1xuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmZlZWQ7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0ID0gbW9tZW50LnV0Yyh2bS5zY2Fuc1BhcmFtcy5zdGFydGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3AgPSBtb21lbnQudXRjKHZtLnNjYW5zUGFyYW1zLmVuZGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RvcFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmRhdGVNb2RlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lem9uZTogJyswMDAnXG4gICAgICAgIH07XG4gICAgICAgIHZtLnNjYW5EYXRhID0gW107XG4gICAgICAgIHZtLnNlYXJjaFRleHQgPSB2bS5zY2Fuc1BhcmFtcy5uYW1lIHx8ICcnO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG4gICAgICAgIHZtLnNvcnRhYmxlT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGhhbmRsZTogJy5zb3J0YWJsZS1oYW5kbGUnXG4gICAgICAgIH07XG5cbiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gdm0uc2NhbnNQYXJhbXMucGFnZSB8fCAxO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplID0gdm0uc2NhbnNQYXJhbXMucGFnZV9zaXplIHx8IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0ucmVmcmVzaERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZmlsdGVyZWREYXRhID0gXy5maWx0ZXIodm0uc2NhbkRhdGEsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZtLnNlYXJjaFRleHQudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBmaWx0ZXJlZERhdGEubGVuZ3RoID4gMCA/IGZpbHRlcmVkRGF0YSA6IHZtLmdyaWRPcHRpb25zLmRhdGE7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGZpbHRlcmVkQnlPcmRlciA9IHZtLnNjYW5zUGFyYW1zLm9yZGVyID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIHZtLmNvbERlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICduYW1lJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ05hbWUnLFxuICAgICAgICAgICAgICAgIC8vZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PGlucHV0IG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS52bS5zZWFyY2hUZXh0XCIgbmctY2hhbmdlPVwiZ3JpZC5hcHBTY29wZS52bS5yZWZyZXNoRGF0YSgpXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBwbGFjZWhvbGRlcj1cIlNlYXJjaFwiPjwvZGl2PidcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnZmlsZV9jb3VudCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdGaWxlIENvdW50JyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnam9iJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmpvYi5qb2JfdHlwZS50aXRsZSB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdjcmVhdGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmNyZWF0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2xhc3RfbW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ2V0U2NhbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHNjYW5TZXJ2aWNlLmdldFNjYW5zKHZtLnNjYW5zUGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uc2NhbkRhdGEgPSBTY2FuLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSB2bS5zY2FuRGF0YSA9IFNjYW4udHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTs7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFNjYW5zUGFyYW1zKHZtLnNjYW5zUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLmdldFNjYW5zKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ29sRGVmcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBncmlkRmFjdG9yeS5hcHBseVNvcnRDb25maWcodm0uY29sRGVmcywgdm0uc2NhbnNQYXJhbXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZVNjYW5PcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICB2bS5zY2Fuc1BhcmFtcy5vcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMCA/IHNvcnRBcnIgOiBudWxsO1xuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwO1xuICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgLy9zZXQgZ3JpZEFwaSBvbiBzY29wZVxuICAgICAgICAgICAgdm0uZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdm0uc2NhbnNQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgIHZtLnNjYW5zUGFyYW1zLnBhZ2Vfc2l6ZSA9IHBhZ2VTaXplO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2ZlZWQvc2NhbnMvJyArIHJvdy5lbnRpdHkuaWQpLnNlYXJjaCgnJyk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5jb3JlLm9uLnNvcnRDaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGdyaWQsIHNvcnRDb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmdyaWRBcGkuZ3JpZC5jb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbC5jb2xEZWYuc29ydCA9IGNvbC5zb3J0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRTY2Fuc0NvbERlZnModm0uZ3JpZEFwaS5ncmlkLm9wdGlvbnMuY29sdW1uRGVmcyk7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVTY2FuT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJCeU5hbWUgPSBmdW5jdGlvbiAoa2V5RXZlbnQpIHtcbiAgICAgICAgICAgIGlmICgha2V5RXZlbnQgfHwgKGtleUV2ZW50ICYmIGtleUV2ZW50LndoaWNoID09PSAxMykpIHtcbiAgICAgICAgICAgICAgICB2bS5zY2Fuc1BhcmFtcy5uYW1lID0gdm0uc2VhcmNoVGV4dDtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdldFNjYW5zKCk7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0U2NhbnNQYXJhbXModm0uc2NhbnNQYXJhbXMpO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignZmVlZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdGFydCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uc2NhbnNQYXJhbXMuc3RhcnRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdG9wJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5zY2Fuc1BhcmFtcy5lbmRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uc3RhdGVTZXJ2aWNlLmdldFNjYW5zQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0U2NhbnNQYXJhbXMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uc2NhbnNQYXJhbXMgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdzdHJpa2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRyb3V0ZSwgJGxvY2F0aW9uLCAkcm91dGVQYXJhbXMsIFN0cmlrZSwgU3RyaWtlSW5nZXN0RmlsZSwgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIHN0cmlrZVNlcnZpY2UsIHdvcmtzcGFjZXNTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgdXNlclNlcnZpY2UsIHRvYXN0cikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgY3VyclN0cmlrZSA9IHt9O1xuXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5zY2FsZUNvbmZpZyA9IHNjYWxlQ29uZmlnO1xuICAgICAgICB2bS5zdHJpa2VzID0gW107XG4gICAgICAgIHZtLndvcmtzcGFjZXMgPSBbXTtcbiAgICAgICAgdm0ubmV3V29ya3NwYWNlcyA9IFtdO1xuICAgICAgICB2bS5hY3RpdmVXb3Jrc3BhY2UgPSB7fTtcbiAgICAgICAgdm0ubG9jYWxTdHJpa2VzID0gW107XG4gICAgICAgIHZtLmFjdGl2ZVN0cmlrZSA9IG5ldyBTdHJpa2UoKTtcbiAgICAgICAgdm0uYWN0aXZlU3RyaWtlSW5nZXN0RmlsZSA9IG5ldyBTdHJpa2VJbmdlc3RGaWxlKCk7XG4gICAgICAgIHZtLmRhdGFUeXBlID0gJyc7XG4gICAgICAgIHZtLmF2YWlsYWJsZVdvcmtzcGFjZVR5cGVzID0gXy5jbG9uZURlZXAoc2NhbGVDb25maWcud29ya3NwYWNlVHlwZXMpO1xuICAgICAgICB2bS5hZGRCdG5DbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgIHZtLmFkZEJ0bkljb24gPSAnZmEtcGx1cy1jaXJjbGUnO1xuICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuICAgICAgICB2bS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgIHZtLnJlYWRvbmx5ID0gISh2bS51c2VyICYmIHZtLnVzZXIuaXNfYWRtaW4pO1xuICAgICAgICB2bS5KU09OID0gSlNPTjtcbiAgICAgICAgdm0uc29ydGFibGVPcHRpb25zID0ge1xuICAgICAgICAgICAgaGFuZGxlOiAnLnNvcnRhYmxlLWhhbmRsZSdcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jYW5jZWxDcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuICAgICAgICAgICAgLy8gcmV2ZXJ0IGFueSBjaGFuZ2VzIHRvIHRoZSBzdHJpa2VcbiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmlrZSA9IFN0cmlrZS50cmFuc2Zvcm1lcihfLmNsb25lRGVlcChjdXJyU3RyaWtlKSk7XG4gICAgICAgICAgICBpZiAoJHJvdXRlUGFyYW1zLmlkID09PSAnMCcpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2ZlZWQvc3RyaWtlcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmVkaXRTdHJpa2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzdG9yZSBhIHJlZmVyZW5jZSBvZiB0aGUgc3RyaWtlIGFzIGl0IGN1cnJlbnRseSBleGlzdHMgaW4gY2FzZSB0aGUgdXNlciBjYW5jZWxzIHRoZSBlZGl0XG4gICAgICAgICAgICBjdXJyU3RyaWtlID0gU3RyaWtlLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKHZtLmFjdGl2ZVN0cmlrZSkpO1xuICAgICAgICAgICAgdm0ubW9kZSA9ICdlZGl0JztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zYXZlU3RyaWtlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RyaWtlU2VydmljZS5zYXZlU3RyaWtlKHZtLmFjdGl2ZVN0cmlrZSkudGhlbihmdW5jdGlvbiAoc3RyaWtlKSB7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU3RyaWtlID0gU3RyaWtlLnRyYW5zZm9ybWVyKHN0cmlrZSk7XG4gICAgICAgICAgICAgICAgLy8gb25seSBzdG9yZSB0aGUgbmV3IHdvcmtzcGFjZSBuYW1lLCBub3QgdGhlIGVudGlyZSBvYmplY3RcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uYWN0aXZlU3RyaWtlLmNvbmZpZ3VyYXRpb24uZmlsZXNfdG9faW5nZXN0LCBmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5uZXdfd29ya3NwYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLm5ld193b3Jrc3BhY2UgPSBmaWxlLm5ld193b3Jrc3BhY2UubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3N0cmlrZScgKyB2bS5hY3RpdmVTdHJpa2UuaWQsIEpTT04uc3RyaW5naWZ5KHZtLmFjdGl2ZVN0cmlrZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkcm91dGUucmVsb2FkKCk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNsZWFyTG9jYWxTdHJpa2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmxvY2FsU3RyaWtlcywgZnVuY3Rpb24gKHN0cmlrZSkge1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdzdHJpa2UnICsgc3RyaWtlLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9mZWVkL3N0cmlrZXMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5uZXdTdHJpa2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICB2bS5sb2FkU3RyaWtlKDApO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmxvYWRTdHJpa2UgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdmZWVkL3N0cmlrZXMvJyArIGlkKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0V2FybmluZ3NIdG1sID0gZnVuY3Rpb24gKHdhcm5pbmdzKSB7XG4gICAgICAgICAgICB2YXIgd2FybmluZ3NIdG1sID0gJyc7XG4gICAgICAgICAgICBfLmZvckVhY2god2FybmluZ3MsIGZ1bmN0aW9uICh3YXJuaW5nKSB7XG4gICAgICAgICAgICAgICAgd2FybmluZ3NIdG1sICs9ICc8Yj4nICsgd2FybmluZy5pZCArICc6PC9iPiAnICsgd2FybmluZy5kZXRhaWxzICsgJzxiciAvPjxiciAvPic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHdhcm5pbmdzSHRtbCArPSAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLWRlZmF1bHQgYnRuLXhzIGNsZWFyXCI+SGlkZTwvYnV0dG9uPic7XG4gICAgICAgICAgICByZXR1cm4gd2FybmluZ3NIdG1sO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnZhbGlkYXRlU3RyaWtlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBzdHJpa2VTZXJ2aWNlLnZhbGlkYXRlU3RyaWtlKHZtLmFjdGl2ZVN0cmlrZSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLndhcm5pbmdzICYmIGRhdGEud2FybmluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBkaXNwbGF5IHRoZSB3YXJuaW5nc1xuICAgICAgICAgICAgICAgICAgICB2YXIgd2FybmluZ3NIdG1sID0gZ2V0V2FybmluZ3NIdG1sKGRhdGEud2FybmluZ3MpO1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10od2FybmluZ3NIdG1sKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ3N1Y2Nlc3MnXSgnU3RyaWtlIGlzIHZhbGlkLicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvciAmJiBlcnJvci5kZXRhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKGVycm9yLmRldGFpbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKCdFcnJvciB2YWxpZGF0aW5nIHN0cmlrZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRpc2FibGVTYXZlQnRuID0gZnVuY3Rpb24gKGludmFsaWQpIHtcbiAgICAgICAgICAgIHZhciByZXR1cm5WYWwgPSAhKCFpbnZhbGlkICYmIHZtLmFjdGl2ZVN0cmlrZS5jb25maWd1cmF0aW9uLmZpbGVzX3RvX2luZ2VzdC5sZW5ndGggPiAwKTtcbiAgICAgICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9IHJldHVyblZhbCA/ICdidG4tZGVmYXVsdCcgOiAnYnRuLXN1Y2Nlc3MnO1xuICAgICAgICAgICAgcmV0dXJuIHJldHVyblZhbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5hZGRTdHJpa2VJbmdlc3RGaWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKF8ua2V5cyh2bS5hY3RpdmVTdHJpa2VJbmdlc3RGaWxlKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU3RyaWtlLmNvbmZpZ3VyYXRpb24uZmlsZXNfdG9faW5nZXN0LnB1c2goU3RyaWtlSW5nZXN0RmlsZS50cmFuc2Zvcm1lcih2bS5hY3RpdmVTdHJpa2VJbmdlc3RGaWxlKSk7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU3RyaWtlSW5nZXN0RmlsZSA9IG5ldyBTdHJpa2VJbmdlc3RGaWxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZGVsZXRlU3RyaWtlSW5nZXN0RmlsZSA9IGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgICAgICBfLnJlbW92ZSh2bS5hY3RpdmVTdHJpa2UuY29uZmlndXJhdGlvbi5maWxlc190b19pbmdlc3QsIGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuZXF1YWxzKGYsIGZpbGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkRGF0YVR5cGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodm0uZGF0YVR5cGUpIHtcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVTdHJpa2VJbmdlc3RGaWxlLmRhdGFfdHlwZXMucHVzaCh2bS5kYXRhVHlwZSk7XG4gICAgICAgICAgICAgICAgdm0uZGF0YVR5cGUgPSAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZW1vdmVEYXRhVHlwZSA9IGZ1bmN0aW9uIChkYXRhVHlwZSkge1xuICAgICAgICAgICAgXy5yZW1vdmUodm0uYWN0aXZlU3RyaWtlSW5nZXN0RmlsZS5kYXRhX3R5cGVzLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkID09PSBkYXRhVHlwZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZVdvcmtzcGFjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJpa2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgd29ya3NwYWNlT2JqID0gXy5maW5kKHZtLndvcmtzcGFjZXMsIHtuYW1lOiB2bS5hY3RpdmVTdHJpa2UuY29uZmlndXJhdGlvbi53b3Jrc3BhY2V9KTtcbiAgICAgICAgICAgICAgICBpZiAod29ya3NwYWNlT2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5ld1dvcmtzcGFjZXMgPSBfLmNsb25lRGVlcCh2bS53b3Jrc3BhY2VzKTtcbiAgICAgICAgICAgICAgICAgICAgXy5yZW1vdmUodm0ubmV3V29ya3NwYWNlcywgd29ya3NwYWNlT2JqKTtcbiAgICAgICAgICAgICAgICAgICAgZ2V0V29ya3NwYWNlRGV0YWlscyh3b3Jrc3BhY2VPYmouaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5mb3JtYXRKU09OID0gZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgICAgIGZpbGUgPSBfLm9taXQoZmlsZSwgJyQkaGFzaEtleScpO1xuICAgICAgICAgICAgaWYgKGZpbGUubmV3X3dvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIGZpbGUubmV3X3dvcmtzcGFjZSA9IGZpbGUubmV3X3dvcmtzcGFjZS5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGZpbGUsIG51bGwsIDQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRXb3Jrc3BhY2VEZXRhaWxzID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZURldGFpbHMoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVXb3Jrc3BhY2UgPSBkYXRhO1xuICAgICAgICAgICAgICAgIGlmICh2bS5hY3RpdmVXb3Jrc3BhY2UuanNvbl9jb25maWcuYnJva2VyLnR5cGUgPT09ICdob3N0Jykge1xuICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVTdHJpa2UuY29uZmlndXJhdGlvbi5tb25pdG9yLnR5cGUgPSAnZGlyLXdhdGNoZXInO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodm0uYWN0aXZlV29ya3NwYWNlLmpzb25fY29uZmlnLmJyb2tlci50eXBlID09PSAnczMnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmlrZS5jb25maWd1cmF0aW9uLm1vbml0b3IudHlwZSA9ICdzMyc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uYWN0aXZlU3RyaWtlLmNvbmZpZ3VyYXRpb24ubW9uaXRvci50eXBlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0V29ya3NwYWNlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZXMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0ud29ya3NwYWNlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdm0ubmV3V29ya3NwYWNlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlV29ya3NwYWNlKCk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0U3RyaWtlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgc3RyaWtlU2VydmljZS5nZXRTdHJpa2VzKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb0pzb24gPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNLZXk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoOyBzS2V5ID0gbG9jYWxTdG9yYWdlLmtleShpKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvSnNvbltzS2V5XSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHNLZXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF8uZmlsdGVyKF8ucGFpcnMob0pzb24pLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8uY29udGFpbnMob1swXSwgJ3N0cmlrZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBKU09OLnBhcnNlKG9bMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvY2FsU3RyaWtlcy5wdXNoKHR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCh0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLnN0cmlrZXMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIGdldFdvcmtzcGFjZXMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdldFN0cmlrZXMoKTtcbiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmlrZSA9IG51bGw7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuXG4gICAgICAgICAgICBpZiAoJHJvdXRlUGFyYW1zLmlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gcGFyc2VJbnQoJHJvdXRlUGFyYW1zLmlkKTtcbiAgICAgICAgICAgICAgICBpZiAoaWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubW9kZSA9ICdhZGQnO1xuICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVTdHJpa2UgPSBuZXcgU3RyaWtlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3RyaWtlU2VydmljZS5nZXRTdHJpa2VEZXRhaWxzKGlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVTdHJpa2UgPSBTdHJpa2UudHJhbnNmb3JtZXIoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2ZlZWQnKTtcbiAgICAgICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2ZlZWQvc3RyaWtlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyTWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0ICsgNjA7XG5cbiAgICAgICAgICAgIHZtLmNvbnRhaW5lclN0eWxlID0gJ2hlaWdodDogJyArIGNvbnRhaW5lck1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGNvbnRhaW5lck1heEhlaWdodCArICdweDsnO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0ZlZWQnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIEZlZWQgPSBmdW5jdGlvbiAodmFsdWUsIHN0YXR1cykge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgRmVlZC5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnRmVlZCc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEZlZWQuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZlZWQoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgRmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEZlZWQudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoRmVlZC5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBGZWVkLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBGZWVkO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnRmVlZFN0YXR1cycsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgRmVlZFN0YXR1cyA9IGZ1bmN0aW9uIChzdGF0dXMpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEZlZWRTdGF0dXMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0ZlZWRTdGF0dXMnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxGaWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsQWN0aXZpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEFjdGl2aXR5VG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUb3RhbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgRmVlZFN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmVlZFN0YXR1cyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGZWVkU3RhdHVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgRmVlZFN0YXR1cy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChGZWVkU3RhdHVzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEZlZWRTdGF0dXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEZlZWRTdGF0dXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdJbmdlc3QnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgSW5nZXN0ID0gZnVuY3Rpb24gKGlkLCBmaWxlX25hbWUsIHN0cmlrZSwgc3RhdHVzLCBieXRlc190cmFuc2ZlcnJlZCwgdHJhbnNmZXJfc3RhcnRlZCwgdHJhbnNmZXJfZW5kZWQsIG1lZGlhX3R5cGUsIGZpbGVfc2l6ZSwgZGF0YV90eXBlLCBpbmdlc3Rfc3RhcnRlZCwgaW5nZXN0X2VuZGVkLCBzb3VyY2VfZmlsZSwgY3JlYXRlZCwgbGFzdF9tb2RpZmllZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5maWxlX25hbWUgPSBmaWxlX25hbWU7XG4gICAgICAgICAgICB0aGlzLnN0cmlrZSA9IHN0cmlrZTtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5ieXRlc190cmFuc2ZlcnJlZCA9IGJ5dGVzX3RyYW5zZmVycmVkO1xuICAgICAgICAgICAgdGhpcy50cmFuc2Zlcl9zdGFydGVkID0gdHJhbnNmZXJfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJfc3RhcnRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKHRyYW5zZmVyX3N0YXJ0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJfZW5kZWQgPSB0cmFuc2Zlcl9lbmRlZDtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmZXJfZW5kZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0Yyh0cmFuc2Zlcl9lbmRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpO1xuICAgICAgICAgICAgdGhpcy5tZWRpYV90eXBlID0gbWVkaWFfdHlwZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9zaXplID0gZmlsZV9zaXplO1xuICAgICAgICAgICAgdGhpcy5maWxlX3NpemVfZm9ybWF0dGVkID0gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbUJ5dGVzKGZpbGVfc2l6ZSk7XG4gICAgICAgICAgICB0aGlzLmRhdGFfdHlwZSA9IGRhdGFfdHlwZTtcbiAgICAgICAgICAgIHRoaXMuaW5nZXN0X3N0YXJ0ZWQgPSBpbmdlc3Rfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuaW5nZXN0X3N0YXJ0ZWRfZm9ybWF0dGVkID0gaW5nZXN0X3N0YXJ0ZWQgPyBtb21lbnQudXRjKGluZ2VzdF9zdGFydGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCkgOiAnJztcbiAgICAgICAgICAgIHRoaXMuaW5nZXN0X2VuZGVkID0gaW5nZXN0X2VuZGVkO1xuICAgICAgICAgICAgdGhpcy5pbmdlc3RfZW5kZWRfZm9ybWF0dGVkID0gaW5nZXN0X2VuZGVkID8gbW9tZW50LnV0Yyhpbmdlc3RfZW5kZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKSA6ICcnO1xuICAgICAgICAgICAgdGhpcy5zb3VyY2VfZmlsZSA9IHNvdXJjZV9maWxlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGNyZWF0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSW5nZXN0LnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBJbmdlc3QuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEluZ2VzdChcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RyaWtlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ieXRlc190cmFuc2ZlcnJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50cmFuc2Zlcl9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRyYW5zZmVyX2VuZGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lZGlhX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZV9zaXplLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRhdGFfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbmdlc3Rfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbmdlc3RfZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc291cmNlX2ZpbGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSW5nZXN0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSW5nZXN0LnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEluZ2VzdC5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSW5nZXN0LmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBJbmdlc3Q7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTY2FuJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2IsIFNjYW5Db25maWd1cmF0aW9uKSB7XG4gICAgICAgIHZhciBTY2FuID0gZnVuY3Rpb24gKGlkLCBuYW1lLCB0aXRsZSwgZGVzY3JpcHRpb24sIGZpbGVfY291bnQsIGpvYiwgZHJ5X3J1bl9qb2IsIGNyZWF0ZWQsIGxhc3RfbW9kaWZpZWQsIGNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmZpbGVfY291bnQgPSBmaWxlX2NvdW50O1xuICAgICAgICAgICAgdGhpcy5qb2IgPSBKb2IudHJhbnNmb3JtZXIoam9iKTtcbiAgICAgICAgICAgIHRoaXMuZHJ5X3J1bl9qb2IgPSBKb2IudHJhbnNmb3JtZXIoZHJ5X3J1bl9qb2IpO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGNyZWF0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Yyk7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMobGFzdF9tb2RpZmllZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJhdGlvbiA9IFNjYW5Db25maWd1cmF0aW9uLnRyYW5zZm9ybWVyKGNvbmZpZ3VyYXRpb24pO1xuICAgICAgICB9O1xuXG4gICAgICAgIFNjYW4ucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgY2xlYW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuT2JqID0ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvbjogdGhpcy5jb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAocmV0dXJuT2JqLmNvbmZpZ3VyYXRpb24gJiYgcmV0dXJuT2JqLmNvbmZpZ3VyYXRpb24uc2Nhbm5lci50eXBlID09PSAnczMnKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSByZXR1cm5PYmouY29uZmlndXJhdGlvbi5zY2FubmVyLnRyYW5zZmVyX3N1ZmZpeDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJldHVybk9iai5jb25maWd1cmF0aW9uLmZpbGVzX3RvX2luZ2VzdCkge1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2gocmV0dXJuT2JqLmNvbmZpZ3VyYXRpb24uZmlsZXNfdG9faW5nZXN0LCBmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGYuJCRoYXNoS2V5O1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGVtcHR5L251bGwvdW5kZWZpbmVkIHZhbHVlcyBmcm9tIHJldHVybk9ialxuICAgICAgICAgICAgICAgIHJldHVybiBfLnBpY2socmV0dXJuT2JqLCBfLmlkZW50aXR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU2Nhbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2NhbihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVfY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRyeV9ydW5fam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU2NhbigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFNjYW4udHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChTY2FuLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTY2FuLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTY2FuO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU2NhbkNvbmZpZ3VyYXRpb24nLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIFNjYW5Jbmdlc3RGaWxlKSB7XG4gICAgICAgIHZhciBTY2FuQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uICh2ZXJzaW9uLCB3b3Jrc3BhY2UsIHNjYW5uZXIsIGZpbGVzX3RvX2luZ2VzdCkge1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gc2NhbGVDb25maWcuc2NhbkNvbmZpZ3VyYXRpb25WZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2UgPSB3b3Jrc3BhY2U7XG4gICAgICAgICAgICB0aGlzLnNjYW5uZXIgPSBzY2FubmVyID8gc2Nhbm5lciA6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnJyxcbiAgICAgICAgICAgICAgICB0cmFuc2Zlcl9zdWZmaXg6ICcnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5maWxlc190b19pbmdlc3QgPSBmaWxlc190b19pbmdlc3QgPyBTY2FuSW5nZXN0RmlsZS50cmFuc2Zvcm1lcihmaWxlc190b19pbmdlc3QpIDogW107XG4gICAgICAgIH07XG5cbiAgICAgICAgU2NhbkNvbmZpZ3VyYXRpb24ucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFNjYW5Db25maWd1cmF0aW9uLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTY2FuQ29uZmlndXJhdGlvbihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLndvcmtzcGFjZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zY2FubmVyLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVzX3RvX2luZ2VzdFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFNjYW5Db25maWd1cmF0aW9uKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU2NhbkNvbmZpZ3VyYXRpb24udHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChTY2FuQ29uZmlndXJhdGlvbi5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU2NhbkNvbmZpZ3VyYXRpb24uYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFNjYW5Db25maWd1cmF0aW9uO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU2NhbkluZ2VzdEZpbGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBTY2FuSW5nZXN0RmlsZSA9IGZ1bmN0aW9uIChmaWxlbmFtZV9yZWdleCwgZGF0YV90eXBlcywgbmV3X3dvcmtzcGFjZSwgbmV3X2ZpbGVfcGF0aCkge1xuICAgICAgICAgICAgdGhpcy5maWxlbmFtZV9yZWdleCA9IGZpbGVuYW1lX3JlZ2V4O1xuICAgICAgICAgICAgdGhpcy5kYXRhX3R5cGVzID0gZGF0YV90eXBlcyB8fCBbXTtcbiAgICAgICAgICAgIHRoaXMubmV3X3dvcmtzcGFjZSA9IG5ld193b3Jrc3BhY2UgfHwgJyc7XG4gICAgICAgICAgICB0aGlzLm5ld19maWxlX3BhdGggPSBuZXdfZmlsZV9wYXRoIHx8ICcnO1xuICAgICAgICB9O1xuXG4gICAgICAgIFNjYW5Jbmdlc3RGaWxlLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTY2FuSW5nZXN0RmlsZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciByZXR1cm5PYmogPSBuZXcgU2NhbkluZ2VzdEZpbGUoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZW5hbWVfcmVnZXgsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YV90eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uZXdfd29ya3NwYWNlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5ld19maWxlX3BhdGhcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmRhdGFfdHlwZXMgJiYgZGF0YS5kYXRhX3R5cGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcmV0dXJuT2JqLmRhdGFfdHlwZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBlbXB0eS9udWxsL3VuZGVmaW5lZCB2YWx1ZXMgZnJvbSByZXR1cm5PYmpcbiAgICAgICAgICAgICAgICByZXR1cm4gXy5waWNrKHJldHVybk9iaiwgXy5pZGVudGl0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFNjYW5Jbmdlc3RGaWxlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU2NhbkluZ2VzdEZpbGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChTY2FuSW5nZXN0RmlsZS5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU2NhbkluZ2VzdEZpbGUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFNjYW5Jbmdlc3RGaWxlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RyaWtlJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2IsIFN0cmlrZUNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgdmFyIFN0cmlrZSA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdGl0bGUsIGRlc2NyaXB0aW9uLCBqb2IsIGNyZWF0ZWQsIGxhc3RfbW9kaWZpZWQsIGNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmpvYiA9IEpvYi50cmFuc2Zvcm1lcihqb2IpO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGNyZWF0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Yyk7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMobGFzdF9tb2RpZmllZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJhdGlvbiA9IFN0cmlrZUNvbmZpZ3VyYXRpb24udHJhbnNmb3JtZXIoY29uZmlndXJhdGlvbik7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RyaWtlLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGNsZWFuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb246IHRoaXMuY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0cmlrZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaWtlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaWtlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RyaWtlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5tYXAoU3RyaWtlLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdHJpa2UuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0cmlrZTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N0cmlrZUNvbmZpZ3VyYXRpb24nLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIFN0cmlrZUluZ2VzdEZpbGUpIHtcbiAgICAgICAgdmFyIFN0cmlrZUNvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAodmVyc2lvbiwgd29ya3NwYWNlLCBtb25pdG9yLCBmaWxlc190b19pbmdlc3QpIHtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHNjYWxlQ29uZmlnLnN0cmlrZUNvbmZpZ3VyYXRpb25WZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2UgPSB3b3Jrc3BhY2U7XG4gICAgICAgICAgICB0aGlzLm1vbml0b3IgPSBtb25pdG9yID8gbW9uaXRvciA6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnJyxcbiAgICAgICAgICAgICAgICByZWdpb25fbmFtZTogJycsXG4gICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzX2tleV9pZDogJycsXG4gICAgICAgICAgICAgICAgICAgIHNlY3JldF9hY2Nlc3Nfa2V5OiAnJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmZpbGVzX3RvX2luZ2VzdCA9IGZpbGVzX3RvX2luZ2VzdCA/IFN0cmlrZUluZ2VzdEZpbGUudHJhbnNmb3JtZXIoZmlsZXNfdG9faW5nZXN0KSA6IFtdO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0cmlrZUNvbmZpZ3VyYXRpb24ucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0cmlrZUNvbmZpZ3VyYXRpb24uYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0cmlrZUNvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS53b3Jrc3BhY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubW9uaXRvcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlc190b19pbmdlc3RcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpa2VDb25maWd1cmF0aW9uKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RyaWtlQ29uZmlndXJhdGlvbi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEubWFwKFN0cmlrZUNvbmZpZ3VyYXRpb24uYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0cmlrZUNvbmZpZ3VyYXRpb24uYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0cmlrZUNvbmZpZ3VyYXRpb247XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdHJpa2VJbmdlc3RGaWxlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgU3RyaWtlSW5nZXN0RmlsZSA9IGZ1bmN0aW9uIChmaWxlbmFtZV9yZWdleCwgZGF0YV90eXBlcywgbmV3X3dvcmtzcGFjZSwgbmV3X2ZpbGVfcGF0aCkge1xuICAgICAgICAgICAgdGhpcy5maWxlbmFtZV9yZWdleCA9IGZpbGVuYW1lX3JlZ2V4O1xuICAgICAgICAgICAgdGhpcy5kYXRhX3R5cGVzID0gZGF0YV90eXBlcyB8fCBbXTtcbiAgICAgICAgICAgIHRoaXMubmV3X3dvcmtzcGFjZSA9IG5ld193b3Jrc3BhY2UgfHwgJyc7XG4gICAgICAgICAgICB0aGlzLm5ld19maWxlX3BhdGggPSBuZXdfZmlsZV9wYXRoIHx8ICcnO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0cmlrZUluZ2VzdEZpbGUucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0cmlrZUluZ2VzdEZpbGUuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuT2JqID0gbmV3IFN0cmlrZUluZ2VzdEZpbGUoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZW5hbWVfcmVnZXgsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YV90eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uZXdfd29ya3NwYWNlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5ld19maWxlX3BhdGhcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmRhdGFfdHlwZXMgJiYgZGF0YS5kYXRhX3R5cGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcmV0dXJuT2JqLmRhdGFfdHlwZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBlbXB0eS9udWxsL3VuZGVmaW5lZCB2YWx1ZXMgZnJvbSByZXR1cm5PYmpcbiAgICAgICAgICAgICAgICByZXR1cm4gXy5waWNrKHJldHVybk9iaiwgXy5pZGVudGl0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN0cmlrZUluZ2VzdEZpbGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdHJpa2VJbmdlc3RGaWxlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5tYXAoU3RyaWtlSW5nZXN0RmlsZS5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3RyaWtlSW5nZXN0RmlsZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RyaWtlSW5nZXN0RmlsZTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdmZWVkU2VydmljZScsIGZ1bmN0aW9uICgkbG9jYXRpb24sICR0aW1lb3V0LCAkcSwgJGh0dHAsIHNjYWxlQ29uZmlnLCBJbmdlc3QpIHtcblxuICAgICAgICB2YXIgZ2V0RmVlZFBhcmFtcyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgIGlmKCFwYXJhbXMpIHsgcGFyYW1zID0ge307IH1cbiAgICAgICAgICAgIHZhciBwID0ge307XG4gICAgICAgICAgICBwLnBhZ2Vfc2l6ZSA9IDEwMDA7XG4gICAgICAgICAgICBwLnN0YXJ0ZWQgPSBwYXJhbXMuc3RhcnRlZCA/IHBhcmFtcy5zdGFydGVkIDogbW9tZW50LnV0YygpLmFkZCgtNywnZGF5cycpLnN0YXJ0T2YoJ2QnKS50b0RhdGUoKTtcbiAgICAgICAgICAgIHAuZW5kZWQgPSBwYXJhbXMuZW5kZWQgPyBwYXJhbXMuZW5kZWQgOiBtb21lbnQudXRjKCkudG9EYXRlKCk7XG4gICAgICAgICAgICBwLnVzZV9pbmdlc3RfdGltZSA9IHBhcmFtcy51c2VfaW5nZXN0X3RpbWUgPyBwYXJhbXMudXNlX2luZ2VzdF90aW1lIDogbnVsbDtcbiAgICAgICAgICAgIHJldHVybiBwO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRJbmdlc3RzUGFyYW1zID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0U291cmNlUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG9yZGVyLCBpc19wYXJzZWQsIGZpbGVfbmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplID8gcGFnZV9zaXplIDogMTAwMCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIgPyBvcmRlciA6ICctbGFzdF9tb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgaXNfcGFyc2VkOiBpc19wYXJzZWQsXG4gICAgICAgICAgICAgICAgZmlsZV9uYW1lOiBmaWxlX25hbWVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldEZlZWQ6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGdldEZlZWRQYXJhbXMocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdpbmdlc3RzJykgKyAnaW5nZXN0cy9zdGF0dXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SW5nZXN0c09uY2U6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGdldEluZ2VzdHNQYXJhbXMocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdpbmdlc3RzJykgKyAnaW5nZXN0cy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSW5nZXN0LnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0U291cmNlczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRTb3VyY2VQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnc291cmNlcycpICsgJ3NvdXJjZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0U291cmNlRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3NvdXJjZXMnKSArICdzb3VyY2VzLycgKyBpZCArICcvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJ1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3NjYW5TZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0U2NhbnM6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3NjYW5zLyc7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRTY2FuRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzY2Fucy8nICsgaWQgKyAnLyc7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsaWRhdGVTY2FuOiBmdW5jdGlvbiAoc2Nhbikge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgY2xlYW5TY2FuID0gc2Nhbi5jbGVhbigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzY2Fucy92YWxpZGF0aW9uLycsIGNsZWFuU2Nhbikuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzYXZlU2NhbjogZnVuY3Rpb24gKHNjYW4pIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXNjYW4uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzY2Fucy8nLCBzY2FuKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAucGF0Y2goc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc2NhbnMvJyArIHNjYW4uaWQgKyAnLycsIHNjYW4pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbiA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShzY2FuKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdzdHJpa2VTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0U3RyaWtlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc3RyaWtlcy8nO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7IG9yZGVyOiAnLXRpdGxlJyB9XG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0U3RyaWtlRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzdHJpa2VzLycgKyBpZCArICcvJztcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCdcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2YWxpZGF0ZVN0cmlrZTogZnVuY3Rpb24gKHN0cmlrZSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgY2xlYW5TdHJpa2UgPSBzdHJpa2UuY2xlYW4oKTtcblxuICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc3RyaWtlcy92YWxpZGF0aW9uLycsIGNsZWFuU3RyaWtlKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNhdmVTdHJpa2U6IGZ1bmN0aW9uIChzdHJpa2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXN0cmlrZS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3N0cmlrZXMvJywgc3RyaWtlLmNsZWFuKCkpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkaHR0cC5wYXRjaChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzdHJpa2VzLycgKyBzdHJpa2UuaWQgKyAnLycsIHN0cmlrZS5jbGVhbigpKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmlrZSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShzdHJpa2UpO1xuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYkRldGFpbENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgJHVpYk1vZGFsLCBzdGF0ZVNlcnZpY2UsIG5hdlNlcnZpY2UsIGpvYlNlcnZpY2UsIGpvYkV4ZWN1dGlvblNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBsb2FkU2VydmljZSwgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UsIHVzZXJTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHRvYXN0cikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uam9iID0ge307XG4gICAgICAgIHZtLmpvYklkID0gJHJvdXRlUGFyYW1zLmlkO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMnKTtcbiAgICAgICAgdm0ubG9hZGluZ0pvYkRldGFpbCA9IGZhbHNlO1xuICAgICAgICB2bS5sYXRlc3RFeGVjdXRpb24gPSBudWxsO1xuICAgICAgICB2bS5leGVjdXRpb25Mb2cgPSBudWxsO1xuICAgICAgICB2bS5leGVjdXRpb25EZXRhaWxzID0gbnVsbDtcbiAgICAgICAgdm0uc2VsZWN0ZWRFeGVjdXRpb25EZXRhaWxWYWx1ZXMgPSBudWxsO1xuICAgICAgICB2bS50aW1lbGluZSA9IFtdO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLmpvYkVycm9yQ3JlYXRlZCA9ICcnO1xuICAgICAgICB2bS5qb2JFcnJvckxhc3RNb2RpZmllZCA9ICcnO1xuICAgICAgICB2bS5sYXN0U3RhdHVzQ2hhbmdlID0gJyc7XG4gICAgICAgIHZtLnN1cGVyc2VkZWRTdGF0dXMgPSAnJztcbiAgICAgICAgdm0udHJpZ2dlck9jY3VycmVkID0gJyc7XG5cbiAgICAgICAgdm0uc2hvd0xvZyA9IGZ1bmN0aW9uIChleGVjdXRpb24pIHtcbiAgICAgICAgICAgIGpvYkV4ZWN1dGlvblNlcnZpY2UuZ2V0Sm9iRXhlY3V0aW9uRGV0YWlscyhleGVjdXRpb24uaWQpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV4ZWN1dGlvbkxvZyA9IHJlc3VsdDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaG93TG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgd2luZG93Q2xhc3M6ICdsb2ctbW9kYWwtd2luZG93J1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHN0YXRlU2VydmljZS5nZXRKb2JFeGVjdXRpb25Mb2dQb2xsZXIoKSwgZnVuY3Rpb24gKHBvbGxlcikge1xuICAgICAgICAgICAgICAgICAgICBwb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2hvd0V4ZWN1dGlvbkRldGFpbHMgPSBmdW5jdGlvbiAoZXhlY3V0aW9uSWQpIHtcbiAgICAgICAgICAgIGpvYkV4ZWN1dGlvblNlcnZpY2UuZ2V0Sm9iRXhlY3V0aW9uRGV0YWlscyhleGVjdXRpb25JZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXhlY3V0aW9uRGV0YWlscyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFeGVjdXRpb25EZXRhaWxWYWx1ZXMgPSBfLnBhaXJzKGRhdGEpO1xuICAgICAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3Nob3dFeGVjdXRpb25EZXRhaWxzLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnbGcnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZXF1ZXVlSm9iID0gZnVuY3Rpb24gKGpvYklkKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGxvYWRTZXJ2aWNlLnJlcXVldWVKb2JzKHsgam9iX2lkczogW2pvYklkXSB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydzdWNjZXNzJ10oJ1JlcXVldWVkIEpvYicpO1xuICAgICAgICAgICAgICAgIHZtLmpvYi5zdGF0dXMgPSBkYXRhLmpvYl9zdGF0dXM7XG4gICAgICAgICAgICAgICAgZ2V0Sm9iRGV0YWlsKGpvYklkKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSgnUmVxdWV1ZSByZXF1ZXN0IGZhaWxlZCcpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNhbmNlbEpvYiA9IGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbFN0YXR1cyA9IGpvYi5zdGF0dXM7XG4gICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTCc7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLnVwZGF0ZUpvYihqb2IuaWQsIHsgc3RhdHVzOiAnQ0FOQ0VMRUQnIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdKb2IgQ2FuY2VsZWQnKTtcbiAgICAgICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTEVEJztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIGpvYi5zdGF0dXMgPSBvcmlnaW5hbFN0YXR1cztcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdm0uY2FsY3VsYXRlRmlsZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyhzaXplKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iRGV0YWlsID0gZnVuY3Rpb24gKGpvYklkKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nSm9iRGV0YWlsID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0Sm9iRGV0YWlsKGpvYklkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iID0gZGF0YTtcbiAgICAgICAgICAgICAgICB2bS50aW1lbGluZSA9IGNhbGN1bGF0ZVRpbWVsaW5lKGRhdGEpO1xuICAgICAgICAgICAgICAgIHZtLmxhdGVzdEV4ZWN1dGlvbiA9IGRhdGEuZ2V0TGF0ZXN0RXhlY3V0aW9uKCk7XG4gICAgICAgICAgICAgICAgdm0uam9iRXJyb3JDcmVhdGVkID0gZGF0YS5lcnJvciA/IG1vbWVudC51dGMoZGF0YS5lcnJvci5jcmVhdGVkKS50b0lTT1N0cmluZygpIDogJyc7XG4gICAgICAgICAgICAgICAgdm0ubGFzdFN0YXR1c0NoYW5nZSA9IGRhdGEubGFzdF9zdGF0dXNfY2hhbmdlID8gbW9tZW50LmR1cmF0aW9uKG1vbWVudC51dGMoZGF0YS5sYXN0X3N0YXR1c19jaGFuZ2UpLmRpZmYobW9tZW50LnV0YygpKSkuaHVtYW5pemUodHJ1ZSkgOiAnJztcbiAgICAgICAgICAgICAgICB2bS5zdXBlcnNlZGVkQ2hhbmdlID0gZGF0YS5zdXBlcnNlZGVkID8gbW9tZW50LmR1cmF0aW9uKG1vbWVudC51dGMoZGF0YS5zdXBlcnNlZGVkKS5kaWZmKG1vbWVudC51dGMoKSkpLmh1bWFuaXplKHRydWUpIDogJyc7XG4gICAgICAgICAgICAgICAgdm0udHJpZ2dlck9jY3VycmVkID0gZGF0YS5ldmVudC5vY2N1cnJlZCA/IG1vbWVudC5kdXJhdGlvbihtb21lbnQudXRjKGRhdGEuZXZlbnQub2NjdXJyZWQpLmRpZmYobW9tZW50LnV0YygpKSkuaHVtYW5pemUodHJ1ZSkgOiAnJztcbiAgICAgICAgICAgICAgICB2bS5pbnB1dHMgPSBkYXRhLmlucHV0cztcbiAgICAgICAgICAgICAgICB2bS5vdXRwdXRzID0gZGF0YS5vdXRwdXRzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ0pvYkRldGFpbCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNhbGN1bGF0ZVRpbWVsaW5lID0gZnVuY3Rpb24gKGpvYikge1xuICAgICAgICAgICAgdmFyIHRsID0gW107XG4gICAgICAgICAgICB0bC5wdXNoKHsgdGFza05hbWU6ICdDcmVhdGVkJywgc3RhcnRlZDogam9iLmNyZWF0ZWQgPyBtb21lbnQudXRjKGpvYi5jcmVhdGVkKS50b0RhdGUoKSA6IGpvYi5jcmVhdGVkLCBlbmRlZDogam9iLnF1ZXVlZCA/IG1vbWVudC51dGMoam9iLnF1ZXVlZCkudG9EYXRlKCkgOiBqb2IucXVldWVkIH0pO1xuICAgICAgICAgICAgdGwucHVzaCh7IHRhc2tOYW1lOiAnUXVldWVkJywgc3RhcnRlZDogam9iLnF1ZXVlZCA/IG1vbWVudC51dGMoam9iLnF1ZXVlZCkudG9EYXRlKCkgOiBqb2IucXVldWVkLCBlbmRlZDogam9iLnN0YXJ0ZWQgPyBtb21lbnQudXRjKGpvYi5zdGFydGVkKS50b0RhdGUoKSA6IGpvYi5zdGFydGVkIH0pO1xuICAgICAgICAgICAgdGwucHVzaCh7IHRhc2tOYW1lOiAnRXhlY3V0ZWQnLCBzdGFydGVkOiBqb2Iuc3RhcnRlZCA/IG1vbWVudC51dGMoam9iLnN0YXJ0ZWQpLnRvRGF0ZSgpIDogam9iLnN0YXJ0ZWQsIGVuZGVkOiBqb2IuZW5kZWQgPyBtb21lbnQudXRjKGpvYi5lbmRlZCkudG9EYXRlKCkgOiBqb2IuZW5kZWQgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0bDtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2pvYnMnKTtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICB2bS5yZWFkb25seSA9ICEodXNlciAmJiB1c2VyLmlzX2FkbWluKTtcbiAgICAgICAgICAgIGdldEpvYkRldGFpbCh2bS5qb2JJZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9iRXhlY3V0aW9uRGV0YWlsQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCBuYXZTZXJ2aWNlLCBqb2JFeGVjdXRpb25TZXJ2aWNlLCBub2RlU2VydmljZSwgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmpvYkV4ZWN1dGlvbiA9IHt9O1xuICAgICAgICB2bS5qb2JFeGVjdXRpb25JZCA9ICRyb3V0ZVBhcmFtcy5pZDtcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3Muam9icztcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnam9icy9ydW5zJyk7XG5cbiAgICAgICAgdmFyIGdldEpvYkV4ZWN1dGlvbkRldGFpbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYkV4ZWN1dGlvblNlcnZpY2UuZ2V0Sm9iRXhlY3V0aW9uRGV0YWlsKGlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uID0gZGF0YTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0Sm9iRXhlY3V0aW9uRGV0YWlsKCRyb3V0ZVBhcmFtcy5pZCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdqb2JzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYkV4ZWN1dGlvbnNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBuYXZTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIGdyaWRGYWN0b3J5LCB1c2VyU2VydmljZSwgam9iRXhlY3V0aW9uU2VydmljZSwgam9iVHlwZVNlcnZpY2UsIHVpR3JpZENvbnN0YW50cywgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UpIHtcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnam9icycpO1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBqb2JUeXBlVmlld0FsbCA9IHsgbmFtZTogJ1ZJRVcgQUxMJywgdGl0bGU6ICdWSUVXIEFMTCcsIHZlcnNpb246ICcnLCBpZDogMCB9O1xuXG4gICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBzdGF0ZVNlcnZpY2UuZ2V0Sm9iRXhlY3V0aW9uc1BhcmFtcygpO1xuXG4gICAgICAgIHZtLnN0YXRlU2VydmljZSA9IHN0YXRlU2VydmljZTtcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnJlYWRvbmx5ID0gdHJ1ZTtcbiAgICAgICAgdm0uam9iVHlwZVZhbHVlcyA9IFtqb2JUeXBlVmlld0FsbF07XG4gICAgICAgIHZtLmpvYkV4ZWN1dGlvbiA9IG51bGw7XG4gICAgICAgIHZtLnNlbGVjdGVkSm9iVHlwZSA9IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuam9iX3R5cGVfaWQgPyB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLmpvYl90eXBlX2lkIDogam9iVHlwZVZpZXdBbGw7XG4gICAgICAgIHZtLmpvYlN0YXR1c1ZhbHVlcyA9IHNjYWxlQ29uZmlnLmpvYlN0YXR1cztcbiAgICAgICAgdm0uc2VsZWN0ZWRKb2JTdGF0dXMgPSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnN0YXR1cyB8fCB2bS5qb2JTdGF0dXNWYWx1ZXNbMF07XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3Muam9icztcbiAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydCA9IG1vbWVudC51dGModm0uam9iRXhlY3V0aW9uc1BhcmFtcy5zdGFydGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3AgPSBtb21lbnQudXRjKHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuZW5kZWQpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZGF0ZU1vZGVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpbWV6b25lOiAnKzAwMCdcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5wYWdlIHx8IDE7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSA9IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMucGFnZV9zaXplIHx8IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuXG4gICAgICAgIHZhciBmaWx0ZXJlZEJ5Sm9iVHlwZSA9IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuam9iX3R5cGVfaWQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5Sm9iU3RhdHVzID0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5zdGF0dXMgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLm9yZGVyID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIHZtLmNvbERlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdqb2JfdHlwZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxzcGFuIG5nLWJpbmQtaHRtbD1cInJvdy5lbnRpdHkuam9iX3R5cGUuZ2V0SWNvbigpXCI+PC9zcGFuPiB7eyByb3cuZW50aXR5LmpvYl90eXBlLnRpdGxlIH19IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudmVyc2lvbiB9fTwvZGl2PicsXG4gICAgICAgICAgICAgICAgZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZEpvYlR5cGVcIiBuZy1vcHRpb25zPVwiam9iVHlwZSBhcyAoam9iVHlwZS50aXRsZSArIFxcJyBcXCcgKyBqb2JUeXBlLnZlcnNpb24pIGZvciBqb2JUeXBlIGluIGdyaWQuYXBwU2NvcGUudm0uam9iVHlwZVZhbHVlc1wiPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdjcmVhdGVkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0NyZWF0ZWQgKFopJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmNyZWF0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2xhc3RfbW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnTGFzdCBNb2RpZmllZCAoWiknLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnZHVyYXRpb24nLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDEyMCxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzIHRleHQtcmlnaHRcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnc3RhdHVzJyxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTUwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48ZGl2IGNsYXNzPVwicHVsbC1yaWdodFwiPjxidXR0b24gbmctc2hvdz1cIigoIWdyaWQuYXBwU2NvcGUudm0ucmVhZG9ubHkpICYmIChyb3cuZW50aXR5LnN0YXR1cyA9PT0gXFwnRkFJTEVEXFwnIHx8IHJvdy5lbnRpdHkuc3RhdHVzID09PSBcXCdDQU5DRUxFRFxcJykpXCIgbmctY2xpY2s9XCJncmlkLmFwcFNjb3BlLnZtLnJlcXVldWVKb2JzKHsgam9iX2lkczogW3Jvdy5lbnRpdHkuaWRdIH0pXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIgdGl0bGU9XCJSZXF1ZXVlIEpvYlwiPjxpIGNsYXNzPVwiZmEgZmEtcmVwZWF0XCI+PC9pPjwvYnV0dG9uPiA8YnV0dG9uIG5nLXNob3c9XCIhZ3JpZC5hcHBTY29wZS52bS5yZWFkb25seSAmJiByb3cuZW50aXR5LnN0YXR1cyAhPT0gXFwnQ09NUExFVEVEXFwnICYmIHJvdy5lbnRpdHkuc3RhdHVzICE9PSBcXCdDQU5DRUxFRFxcJ1wiIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS52bS5jYW5jZWxKb2Iocm93LmVudGl0eSlcIiBjbGFzcz1cImJ0biBidG4teHMgYnRuLWRlZmF1bHRcIiB0aXRsZT1cIkNhbmNlbCBKb2JcIj48aSBjbGFzcz1cImZhIGZhLWJhblwiPjwvaT48L2J1dHRvbj48L2Rpdj4ge3sgcm93LmVudGl0eS5zdGF0dXMgfX08L2Rpdj4nLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRKb2JTdGF0dXNcIj48b3B0aW9uIG5nLXNlbGVjdGVkPVwie3sgZ3JpZC5hcHBTY29wZS52bS5qb2JTdGF0dXNWYWx1ZXNbJGluZGV4XSA9PSBncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkSm9iU3RhdHVzIH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmpvYlN0YXR1c1ZhbHVlc1skaW5kZXhdIH19XCIgbmctcmVwZWF0PVwic3RhdHVzIGluIGdyaWQuYXBwU2NvcGUudm0uam9iU3RhdHVzVmFsdWVzIHRyYWNrIGJ5ICRpbmRleFwiPnt7IHN0YXR1cy50b1VwcGVyQ2FzZSgpIH19PC9vcHRpb24+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2lkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0xvZycsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDYwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1jZW50ZXJcIj48YnV0dG9uIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS52bS5zaG93TG9nKHJvdy5lbnRpdHkpXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCI+PGkgY2xhc3M9XCJmYSBmYS1maWxlLXRleHRcIj48L2k+PC9idXR0b24+PC9kaXY+J1xuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHZtLmdldEpvYkV4ZWN1dGlvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldEpvYkV4ZWN1dGlvbnModm0uam9iRXhlY3V0aW9uc1BhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnZpcnR1YWxpemF0aW9uVGhyZXNob2xkID0gZGF0YS5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0Sm9iVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlc09uY2UoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iVHlwZVZhbHVlcy5wdXNoKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgdm0uam9iVHlwZVZhbHVlcyA9IF8uZmxhdHRlbih2bS5qb2JUeXBlVmFsdWVzKTtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYlR5cGUgPSBfLmZpbmQodm0uam9iVHlwZVZhbHVlcywgeyBpZDogdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5qb2JfdHlwZV9pZCB9KSB8fCBqb2JUeXBlVmlld0FsbDtcbiAgICAgICAgICAgICAgICB2bS5nZXRKb2JFeGVjdXRpb25zKCk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2hvd0xvZyA9IGZ1bmN0aW9uIChqb2JFeGVjdXRpb24pIHtcbiAgICAgICAgICAgIC8vIHNob3cgbG9nIG1vZGFsXG4gICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbiA9IGpvYkV4ZWN1dGlvbjtcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaG93TG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ2xnJyxcbiAgICAgICAgICAgICAgICB3aW5kb3dDbGFzczogJ2xvZy1tb2RhbC13aW5kb3cnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYnNQYXJhbXModm0uam9iRXhlY3V0aW9uc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmdldEpvYnMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDb2xEZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyh2bS5jb2xEZWZzLCB2bS5qb2JFeGVjdXRpb25zUGFyYW1zKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JPcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLm9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwID8gc29ydEFyciA6IG51bGw7XG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSm9iVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlLmlkICE9PSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLmpvYl90eXBlX2lkKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5wYWdlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuam9iX3R5cGVfaWQgPSB2YWx1ZS5pZCA9PT0gMCA/IG51bGwgOiB2YWx1ZS5pZDtcbiAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMucGFnZV9zaXplID0gdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUpvYlN0YXR1cyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5wYWdlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuc3RhdHVzID0gdmFsdWUgPT09ICdWSUVXIEFMTCcgPyBudWxsIDogdmFsdWU7XG4gICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uYWN0aW9uQ2xpY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzL2pvYi8nICsgcm93LmVudGl0eS5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5wYWdlID0gY3VycmVudFBhZ2U7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuY29yZS5vbi5zb3J0Q2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChncmlkLCBzb3J0Q29sdW1ucykge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5ncmlkQXBpLmdyaWQuY29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICBjb2wuY29sRGVmLnNvcnQgPSBjb2wuc29ydDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9ic0NvbERlZnModm0uZ3JpZEFwaS5ncmlkLm9wdGlvbnMuY29sdW1uRGVmcyk7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JPcmRlcihzb3J0QXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9iRXhlY3V0aW9uc1BhcmFtcyh2bS5qb2JFeGVjdXRpb25zUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICB2bS5yZWFkb25seSA9ICEodXNlciAmJiB1c2VyLmlzX2FkbWluKTtcbiAgICAgICAgICAgIHZtLmdldEpvYlR5cGVzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdqb2JzL2V4ZWN1dGlvbnMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplKCk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uc2VsZWN0ZWRKb2JUeXBlJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAocGFyc2VJbnQodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBfLmZpbmQodm0uam9iVHlwZVZhbHVlcywge2lkOiBwYXJzZUludCh2YWx1ZSl9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5Sm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iVHlwZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5Sm9iVHlwZSA9ICFhbmd1bGFyLmVxdWFscyh2YWx1ZSwgam9iVHlwZVZpZXdBbGwpO1xuICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkSm9iU3RhdHVzJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5Sm9iU3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5Sm9iU3RhdHVzID0gdmFsdWUgIT09ICdWSUVXIEFMTCc7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iU3RhdHVzKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0ubGFzdE1vZGlmaWVkU3RhcnQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuc3RhcnRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdG9wJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLmVuZGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0Sm9ic0NvbERlZnMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uY29sRGVmcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uc3RhdGVTZXJ2aWNlLmdldEpvYnNQYXJhbXMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdqb2JUeXBlc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgaG90a2V5cywgc2NhbGVTZXJ2aWNlLCBuYXZTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSwgbm9kZVNlcnZpY2UsIGxvY2FsU3RvcmFnZSwgdXNlclNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmNvbnRhaW5lclN0eWxlID0gJyc7XG4gICAgICAgIHZtLnJlcXVlc3RlZEpvYlR5cGVJZCA9IHBhcnNlSW50KCRyb3V0ZVBhcmFtcy5pZCk7XG4gICAgICAgIHZtLmpvYlR5cGVzID0gW107XG4gICAgICAgIHZtLmpvYlR5cGVJZHMgPSBbXTtcbiAgICAgICAgdm0uam9iVHlwZUNvdW50ID0gMDtcbiAgICAgICAgdm0uYWN0aXZlSm9iVHlwZURldGFpbHMgPSB7fTtcbiAgICAgICAgdm0uYWN0aXZlSm9iVHlwZUludGVyZmFjZVZhbHVlcyA9IFtdO1xuICAgICAgICB2bS5hY3RpdmVKb2JUeXBlRXJyb3JzID0gW107XG4gICAgICAgIHZtLmFjdGl2ZUpvYlR5cGVTdGF0cyA9IHt9O1xuICAgICAgICB2bS5qb2JUeXBlc1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JUeXBlc1BhcmFtcygpO1xuICAgICAgICB2bS5zaG93Sm9iVHlwZUVycm9ycyA9IGZhbHNlO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0uYWN0aXZlSm9iVHlwZSA9IG51bGw7XG4gICAgICAgIHZtLmhlYWx0aERhdGE2ID0ge307XG4gICAgICAgIHZtLmhlYWx0aERhdGExMiA9IHt9O1xuICAgICAgICB2bS5oZWFsdGhEYXRhMjQgPSB7fTtcbiAgICAgICAgdm0uYWN0aXZpdHlJY29uID0gJzxpIGNsYXNzPVwiZmEgZmEtcHVsc2VcIj4mI3gnICsgc2NhbGVDb25maWcuYWN0aXZpdHlJY29uQ29kZSArICc8L2k+JztcbiAgICAgICAgdm0uam9iRGV0YWlsc0NsYXNzID0gJ2hpZGRlbic7XG4gICAgICAgIHZtLnBhdXNlQnRuQ2xhc3MgPSAnZmEtcGF1c2UnO1xuICAgICAgICB2bS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3Muam9icztcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnam9icy90eXBlcycpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5qb2JUeXBlc1BhcmFtcycsZnVuY3Rpb24obmV3VmFsdWUpe1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYlR5cGVzUGFyYW1zKG5ld1ZhbHVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdm0udmlld0RldGFpbHMgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGUgPSBfLmZpbmQodm0uam9iVHlwZXMsICdpZCcsIGlkKTtcbiAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGUuY3JlYXRlZCA9IGZvcm1hdERhdGVUaW1lKHZtLmFjdGl2ZUpvYlR5cGUuY3JlYXRlZCk7XG4gICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlLmxhc3RNb2RpZmllZCA9IGZvcm1hdERhdGVUaW1lKHZtLmFjdGl2ZUpvYlR5cGUubGFzdE1vZGlmaWVkKTtcblxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2pvYnMvdHlwZXMvJyArIGlkKTtcblxuICAgICAgICAgICAgZ2V0Sm9iVHlwZURldGFpbHModm0uYWN0aXZlSm9iVHlwZS5pZCk7XG5cbiAgICAgICAgICAgIHZtLmpvYkRldGFpbHNDbGFzcyA9ICd2aXNpYmxlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVQYXVzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGUuaXNfcGF1c2VkID0gIXZtLmFjdGl2ZUpvYlR5cGUuaXNfcGF1c2VkO1xuICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZURldGFpbHMuaXNfcGF1c2VkID0gdm0uYWN0aXZlSm9iVHlwZS5pc19wYXVzZWQ7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLnVwZGF0ZUpvYlR5cGUodm0uYWN0aXZlSm9iVHlwZURldGFpbHMpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZURldGFpbHMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHZtLnBhdXNlQnRuQ2xhc3MgPSB2bS5nZXRQYXVzZUJ1dHRvbkNsYXNzKHZtLmFjdGl2ZUpvYlR5cGVEZXRhaWxzLmlzX3BhdXNlZCk7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0UGF1c2VCdXR0b25DbGFzcyA9IGZ1bmN0aW9uKGlzX3BhdXNlZCl7XG4gICAgICAgICAgICByZXR1cm4gaXNfcGF1c2VkID8gJ2ZhLXBsYXknIDogJ2ZhLXBhdXNlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXRKb2JUeXBlTGlzdEl0ZW1DbGFzcyA9IGZ1bmN0aW9uKGpvYlR5cGUpe1xuICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGUuaXNfcGF1c2VkID8gJ3BhdXNlZCcgOiAnJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZm9ybWF0RGF0ZVRpbWUgPSBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKGR0KS50b0lTT1N0cmluZygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzT25jZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlcyA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlSWRzID0gXy5wbHVjayh2bS5qb2JUeXBlcywgJ2lkJyk7XG4gICAgICAgICAgICAgICAgdm0uam9iVHlwZUNvdW50ID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICBpZiAodm0ucmVxdWVzdGVkSm9iVHlwZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnZpZXdEZXRhaWxzKHZtLnJlcXVlc3RlZEpvYlR5cGVJZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBob3RrZXlzLmJpbmRUbygkc2NvcGUpXG4gICAgICAgICAgICAgICAgICAgIC5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm86ICdjdHJsK3VwJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnUHJldmlvdXMgSm9iIFR5cGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uYWN0aXZlSm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gXy5pbmRleE9mKHZtLmpvYlR5cGVJZHMsIHZtLmFjdGl2ZUpvYlR5cGUuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udmlld0RldGFpbHModm0uam9iVHlwZUlkc1tpZHggLSAxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLmFkZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21ibzogJ2N0cmwrZG93bicsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ05leHQgSm9iIFR5cGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uYWN0aXZlSm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gXy5pbmRleE9mKHZtLmpvYlR5cGVJZHMsIHZtLmFjdGl2ZUpvYlR5cGUuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWR4IDwgKHZtLmpvYlR5cGVJZHMubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnZpZXdEZXRhaWxzKHZtLmpvYlR5cGVJZHNbaWR4ICsgMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZURldGFpbHMgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZURldGFpbHMoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlRGV0YWlscyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZUludGVyZmFjZVZhbHVlcyA9IF8ucGFpcnMoZGF0YS5qb2JfdHlwZV9pbnRlcmZhY2UpO1xuICAgICAgICAgICAgICAgIHZtLnBhdXNlQnRuQ2xhc3MgPSB2bS5nZXRQYXVzZUJ1dHRvbkNsYXNzKHZtLmFjdGl2ZUpvYlR5cGVEZXRhaWxzLmlzX3BhdXNlZCk7XG4gICAgICAgICAgICAgICAgLy8gZm9ybWF0IGVycm9yIG1hcHBpbmdcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlRXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgdm0uc2hvd0pvYlR5cGVFcnJvcnMgPSBfLmtleXMoZGF0YS5lcnJvcl9tYXBwaW5nLmV4aXRfY29kZXMpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAgICAgaWYgKHZtLnNob3dKb2JUeXBlRXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkYXRhLmVycm9yX21hcHBpbmcuZXhpdF9jb2RlcywgZnVuY3Rpb24gKGVycm9yX25hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IF8uZmluZChkYXRhLmVycm9ycywgJ25hbWUnLCBlcnJvcl9uYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGl0Q29kZSA9IF8uaW52ZXJ0KGRhdGEuZXJyb3JfbWFwcGluZy5leGl0X2NvZGVzKVtlcnJvcl9uYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGVFcnJvcnMucHVzaCh7Y29kZTogZXhpdENvZGUsIGRhdGE6IGVycm9yfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGZvcm1hdCBqb2IgdHlwZSBzdGF0c1xuICAgICAgICAgICAgICAgIHZhciBwZXJmb3JtYW5jZSA9IGRhdGEuZ2V0UGVyZm9ybWFuY2UoKSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbHVyZXMgPSBkYXRhLmdldEZhaWx1cmVzKCk7XG5cbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlU3RhdHMgPSBwZXJmb3JtYW5jZTtcblxuICAgICAgICAgICAgICAgIHZtLmhlYWx0aERhdGE2ID0ge1xuICAgICAgICAgICAgICAgICAgICBnYXVnZURhdGE6IHBlcmZvcm1hbmNlLmhvdXI2LnJhdGUsXG4gICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YTogZmFpbHVyZXMuaG91cjZcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZtLmhlYWx0aERhdGExMiA9IHtcbiAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiBwZXJmb3JtYW5jZS5ob3VyMTIucmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXREYXRhOiBmYWlsdXJlcy5ob3VyMTJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZtLmhlYWx0aERhdGEyNCA9IHtcbiAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiBwZXJmb3JtYW5jZS5ob3VyMjQucmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXREYXRhOiBmYWlsdXJlcy5ob3VyMjRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5qb2JUeXBlc1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JUeXBlc1BhcmFtcygpO1xuICAgICAgICAgICAgZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2pvYnMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lck1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4Oyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIFxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYlR5cGVzRmFpbHVyZVJhdGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVDb25maWcsIHN0YXRlU2VydmljZSwgc2NhbGVTZXJ2aWNlLCBzdWJuYXZTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgbWV0cmljc1NlcnZpY2UsIGdyaWRGYWN0b3J5LCBKb2JUeXBlLCB0b2FzdHIsIG1vbWVudCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgam9iVHlwZVZpZXdBbGwgPSB7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfTtcblxuICAgICAgICB2bS5qb2JUeXBlc1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcygpO1xuXG4gICAgICAgIHZhciBqb2JUeXBlcyA9IFtdLFxuICAgICAgICAgICAgc3RhcnRlZCA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgzMCwgJ2RheXMnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIGVuZGVkID0gbW9tZW50LnV0YygpLmVuZE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JUeXBlID0gdm0uam9iVHlwZXNQYXJhbXMubmFtZSA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLnNjYWxlU2VydmljZSA9IHNjYWxlU2VydmljZTtcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLmRhdGVzID0gW107XG4gICAgICAgIHZtLnBlcmZvcm1hbmNlRGF0YSA9IFtdO1xuICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gW2pvYlR5cGVWaWV3QWxsXTtcbiAgICAgICAgdm0uc2VsZWN0ZWRKb2JUeXBlID0gbnVsbDtcbiAgICAgICAgdm0uc29ydE9yZGVycyA9IHtcbiAgICAgICAgICAgIHR3ZW50eWZvdXJfaG91cnM6IHtcbiAgICAgICAgICAgICAgICBzeXN0ZW06IHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiB2bS5qb2JUeXBlc1BhcmFtcy5vcmRlciB8fCAnZGVzYycsXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdoaWRkZW4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhbGdvcml0aG06IHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiB2bS5qb2JUeXBlc1BhcmFtcy5vcmRlciB8fCAnZGVzYycsXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdoaWRkZW4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdm0uam9iVHlwZXNQYXJhbXMub3JkZXIgfHwgJ2Rlc2MnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdG90YWw6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiB2bS5qb2JUeXBlc1BhcmFtcy5vcmRlciB8fCAnZGVzYycsXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdoaWRkZW4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvclRvdGFsOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdm0uam9iVHlwZXNQYXJhbXMub3JkZXIgfHwgJ2Rlc2MnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3J0eWVpZ2h0X2hvdXJzOiB7XG4gICAgICAgICAgICAgICAgc3lzdGVtOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdm0uam9iVHlwZXNQYXJhbXMub3JkZXIgfHwgJ2Rlc2MnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYWxnb3JpdGhtOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdm0uam9iVHlwZXNQYXJhbXMub3JkZXIgfHwgJ2Rlc2MnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHZtLmpvYlR5cGVzUGFyYW1zLm9yZGVyIHx8ICdkZXNjJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2hpZGRlbidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRvdGFsOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdm0uam9iVHlwZXNQYXJhbXMub3JkZXIgfHwgJ2Rlc2MnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3JUb3RhbDoge1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHZtLmpvYlR5cGVzUGFyYW1zLm9yZGVyIHx8ICdkZXNjJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2hpZGRlbidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGhpcnR5X2RheXM6IHtcbiAgICAgICAgICAgICAgICBzeXN0ZW06IHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiB2bS5qb2JUeXBlc1BhcmFtcy5vcmRlciB8fCAnZGVzYycsXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdoaWRkZW4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhbGdvcml0aG06IHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiB2bS5qb2JUeXBlc1BhcmFtcy5vcmRlciB8fCAnZGVzYycsXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdoaWRkZW4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdm0uam9iVHlwZXNQYXJhbXMub3JkZXIgfHwgJ2Rlc2MnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdG90YWw6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiB2bS5qb2JUeXBlc1BhcmFtcy5vcmRlciB8fCAnZGVzYycsXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdoaWRkZW4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvclRvdGFsOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdm0uam9iVHlwZXNQYXJhbXMub3JkZXIgfHwgJ2Rlc2MnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdm0uY3VyclNvcnRGaWVsZCA9ICcnO1xuICAgICAgICB2bS5jdXJyU29ydEVycm9yVHlwZSA9ICcnO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMvZmFpbHVyZS1yYXRlcycpO1xuXG4gICAgICAgIHZhciBkZWZhdWx0Q29sdW1uRGVmcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2pvYl90eXBlJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0pvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PHNwYW4gbmctYmluZC1odG1sPVwicm93LmVudGl0eS5qb2JfdHlwZS5nZXRJY29uKClcIj48L3NwYW4+IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudGl0bGUgfX0ge3sgcm93LmVudGl0eS5qb2JfdHlwZS52ZXJzaW9uIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkSm9iVHlwZVwiIG5nLW9wdGlvbnM9XCJqb2JUeXBlIGFzIChqb2JUeXBlLnRpdGxlICsgXFwnIFxcJyArIGpvYlR5cGUudmVyc2lvbikgZm9yIGpvYlR5cGUgaW4gZ3JpZC5hcHBTY29wZS52bS5qb2JUeXBlVmFsdWVzXCI+PC9zZWxlY3Q+PC9kaXY+JyxcbiAgICAgICAgICAgICAgICB3aWR0aDogJzE2JScsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICd0d2VudHlmb3VyX2hvdXJzJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJzI0IEhvdXJzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnMjglJyxcbiAgICAgICAgICAgICAgICBoZWFkZXJDZWxsVGVtcGxhdGU6ICdncmlkSGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJ2dyaWRSb3cuaHRtbCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdmb3J0eWVpZ2h0X2hvdXJzJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJzQ4IEhvdXJzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnMjglJyxcbiAgICAgICAgICAgICAgICBoZWFkZXJDZWxsVGVtcGxhdGU6ICdncmlkSGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJ2dyaWRSb3cuaHRtbCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICd0aGlydHlfZGF5cycsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICczMCBEYXlzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnMjglJyxcbiAgICAgICAgICAgICAgICBoZWFkZXJDZWxsVGVtcGxhdGU6ICdncmlkSGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJ2dyaWRSb3cuaHRtbCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZGVmYXVsdENvbHVtbkRlZnM7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFjdGlvbkNsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFjdGlvbkNsaWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvam9icy90eXBlcy8nICsgcm93LmVudGl0eS5qb2JfdHlwZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdm0uc2V0U3R5bGUgPSBmdW5jdGlvbiAoY29sRmllbGQsIGVycm9yVHlwZSkge1xuICAgICAgICAgICAgdmFyIGVycm9yVmFsdWUgPSAoY29sRmllbGRbZXJyb3JUeXBlXSAvIGNvbEZpZWxkLnRvdGFsKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgdmFyIHRleHRDb2xvciA9IGVycm9yVmFsdWUgPj0gMC41ID8gJyNmZmYnIDogJyMwMDAnO1xuICAgICAgICAgICAgdmFyIHJnYiA9IGVycm9yVHlwZSA9PT0gJ3N5c3RlbScgPyAnMTAzLCAwLCAxMycgOiBlcnJvclR5cGUgPT09ICdhbGdvcml0aG0nID8gJzIwMywgMjQsIDI5JyA6ICcyNDEsIDEwNSwgMTknO1xuICAgICAgICAgICAgcmV0dXJuICdiYWNrZ3JvdW5kOiByZ2JhKCcgKyByZ2IgKyAnLCAnICsgZXJyb3JWYWx1ZSArICcpOyBjb2xvcjogJyArIHRleHRDb2xvcjtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5mYWlsUmF0ZVN0eWxlID0gZnVuY3Rpb24gKGVycm9yLCB0b3RhbCkge1xuICAgICAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSAoKGVycm9yIC8gdG90YWwpICogMTAwKS50b0ZpeGVkKDApO1xuICAgICAgICAgICAgcmV0dXJuIHBlcmNlbnRhZ2UgPiAwID8gJ3dpZHRoOiAnICsgcGVyY2VudGFnZSArICclJyA6ICdkaXNwbGF5OiBub25lJztcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZtLmdldFBlcmNlbnRhZ2VPZlRvdGFsID0gZnVuY3Rpb24gKGVycm9yVG90YWwsIHRvdGFsKSB7XG4gICAgICAgICAgICBpZiAodG90YWwgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJzAlJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAoKGVycm9yVG90YWwgLyB0b3RhbCkgKiAxMDApLnRvRml4ZWQoMCkgKyAnJSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZmlsdGVyUmVzdWx0cyA9IGZ1bmN0aW9uIChza2lwSW5pdCwgc2tpcFNvcnQpIHtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcyh2bS5qb2JUeXBlc1BhcmFtcyk7XG4gICAgICAgICAgICBfLmZvckVhY2goXy5wYWlycyh2bS5qb2JUeXBlc1BhcmFtcyksIGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gocGFyYW1bMF0sIHBhcmFtWzFdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFza2lwSW5pdCkge1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpbml0aWFsaXplKHNraXBTb3J0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JUeXBlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB2bS5qb2JUeXBlc1BhcmFtcy5uYW1lID0gdmFsdWUubmFtZSA9PT0gJ1ZJRVcgQUxMJyA/IG51bGwgOiB2YWx1ZS5uYW1lO1xuICAgICAgICAgICAgdm0uam9iVHlwZXNQYXJhbXMudmVyc2lvbiA9IHZhbHVlLm5hbWUgPT09ICdWSUVXIEFMTCcgPyBudWxsIDogdmFsdWUudmVyc2lvbjtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zb3J0QnkgPSBmdW5jdGlvbiAoZXJyb3JUeXBlLCBmaWVsZCwgb3JkZXIpIHtcbiAgICAgICAgICAgIG9yZGVyID0gb3JkZXIgfHwgdm0uc29ydE9yZGVyc1tmaWVsZF1bZXJyb3JUeXBlXS5kaXJlY3Rpb247XG4gICAgICAgICAgICB2bS5zb3J0T3JkZXJzW3ZtLmN1cnJTb3J0RmllbGRdW3ZtLmN1cnJTb3J0RXJyb3JUeXBlXS5pY29uID0gJ2hpZGRlbic7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gXy5zb3J0QnlPcmRlcih2bS5wZXJmb3JtYW5jZURhdGEsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yVHlwZSA9PT0gJ2Vycm9yVG90YWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkW2ZpZWxkXS50b3RhbCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkW2ZpZWxkXS5lcnJvclRvdGFsIC8gZFtmaWVsZF0udG90YWw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBkW2ZpZWxkXVtlcnJvclR5cGVdO1xuICAgICAgICAgICAgfSwgb3JkZXIpO1xuICAgICAgICAgICAgdm0uY3VyclNvcnRFcnJvclR5cGUgPSBlcnJvclR5cGU7XG4gICAgICAgICAgICB2bS5jdXJyU29ydEZpZWxkID0gZmllbGQ7XG4gICAgICAgICAgICB2bS5qb2JUeXBlc1BhcmFtcy5vcmRlciA9IG9yZGVyO1xuICAgICAgICAgICAgdm0uam9iVHlwZXNQYXJhbXMub3JkZXJGaWVsZCA9IGZpZWxkO1xuICAgICAgICAgICAgdm0uam9iVHlwZXNQYXJhbXMub3JkZXJFcnJvclR5cGUgPSBlcnJvclR5cGU7XG5cbiAgICAgICAgICAgIGlmIChvcmRlcikge1xuICAgICAgICAgICAgICAgIHZtLnNvcnRPcmRlcnNbZmllbGRdW2Vycm9yVHlwZV0uaWNvbiA9IG9yZGVyID09PSAnZGVzYycgPyAnZmEtY2FyZXQtZG93bicgOiAnZmEtY2FyZXQtdXAnO1xuICAgICAgICAgICAgICAgIHZtLnNvcnRPcmRlcnNbZmllbGRdW2Vycm9yVHlwZV0uZGlyZWN0aW9uID0gb3JkZXIgPT09ICdkZXNjJyA/ICdhc2MnIDogJ2Rlc2MnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zb3J0T3JkZXJzW2ZpZWxkXVtlcnJvclR5cGVdLmljb24gPSB2bS5zb3J0T3JkZXJzW2ZpZWxkXVtlcnJvclR5cGVdLmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJ2ZhLWNhcmV0LWRvd24nIDogJ2ZhLWNhcmV0LXVwJztcbiAgICAgICAgICAgICAgICB2bS5zb3J0T3JkZXJzW2ZpZWxkXVtlcnJvclR5cGVdLmRpcmVjdGlvbiA9IHZtLnNvcnRPcmRlcnNbZmllbGRdW2Vycm9yVHlwZV0uZGlyZWN0aW9uID09PSAnZGVzYycgPyAnYXNjJyA6ICdkZXNjJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cyh0cnVlKTtcbiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLmNvcmUucmVmcmVzaCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBmb3JtYXREYXRhID0gZnVuY3Rpb24gKGRhdGEsIG51bURheXMpIHtcbiAgICAgICAgICAgIHZhciBkYXRhQXJyID0gW107XG4gICAgICAgICAgICBfLmZvckVhY2goZGF0YSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJlZFJlc3VsdCA9IF8uZmlsdGVyKHJlc3VsdCwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBtb21lbnQudXRjKGQuZGF0ZSwgJ1lZWVktTU0tREQnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1vbWVudC51dGMoKS5kaWZmKG1vbWVudC51dGMoZGF0ZSksICdkJykgPD0gbnVtRGF5cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBkYXRhQXJyLnB1c2goZmlsdGVyZWRSZXN1bHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YUFycjtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZm9ybWF0Q29sdW1uID0gZnVuY3Rpb24gKGNEYXRhLCBpZCkge1xuICAgICAgICAgICAgdmFyIHN5c3RlbUVycm9ycyA9IGNEYXRhWzBdLFxuICAgICAgICAgICAgICAgIGFsZ29yaXRobUVycm9ycyA9IGNEYXRhWzFdLFxuICAgICAgICAgICAgICAgIGRhdGFFcnJvcnMgPSBjRGF0YVsyXSxcbiAgICAgICAgICAgICAgICB0b3RhbENvdW50ID0gY0RhdGFbM107XG5cbiAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgc3lzdGVtOiBfLnN1bShfLm1hcChfLmZpbHRlcihzeXN0ZW1FcnJvcnMsIHsgaWQ6IGlkIH0pLCAndmFsdWUnKSksXG4gICAgICAgICAgICAgICAgYWxnb3JpdGhtOiBfLnN1bShfLm1hcChfLmZpbHRlcihhbGdvcml0aG1FcnJvcnMsIHsgaWQ6IGlkIH0pLCAndmFsdWUnKSksXG4gICAgICAgICAgICAgICAgZGF0YTogXy5zdW0oXy5tYXAoXy5maWx0ZXIoZGF0YUVycm9ycywgeyBpZDogaWQgfSksICd2YWx1ZScpKSxcbiAgICAgICAgICAgICAgICB0b3RhbDogXy5zdW0oXy5tYXAoXy5maWx0ZXIodG90YWxDb3VudCwgeyBpZDogaWQgfSksICd2YWx1ZScpKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIG9iai5lcnJvclRvdGFsID0gb2JqLnN5c3RlbSArIG9iai5hbGdvcml0aG0gKyBvYmouZGF0YTtcblxuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChza2lwU29ydCkge1xuICAgICAgICAgICAgdm0ucGVyZm9ybWFuY2VEYXRhID0gW107XG4gICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gW2pvYlR5cGVWaWV3QWxsXTtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcyh2bS5qb2JUeXBlc1BhcmFtcyk7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlc09uY2UoKS50aGVuKGZ1bmN0aW9uIChqb2JUeXBlc0RhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uam9iVHlwZXNQYXJhbXMubmFtZSAmJiB2bS5qb2JUeXBlc1BhcmFtcy52ZXJzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGpvYlR5cGVzID0gXy5maWx0ZXIoam9iVHlwZXNEYXRhLnJlc3VsdHMsIHsgbmFtZTogdm0uam9iVHlwZXNQYXJhbXMubmFtZSwgdmVyc2lvbjogdm0uam9iVHlwZXNQYXJhbXMudmVyc2lvbiB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqb2JUeXBlcyA9IF8uY2xvbmVEZWVwKGpvYlR5cGVzRGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0uam9iVHlwZVZhbHVlcy5wdXNoKGpvYlR5cGVzRGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gXy5mbGF0dGVuKHZtLmpvYlR5cGVWYWx1ZXMpO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iVHlwZSA9IF8uZmluZCh2bS5qb2JUeXBlVmFsdWVzLCB7IG5hbWU6IHZtLmpvYlR5cGVzUGFyYW1zLm5hbWUsIHZlcnNpb246IHZtLmpvYlR5cGVzUGFyYW1zLnZlcnNpb24gfSkgfHwgam9iVHlwZVZpZXdBbGw7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGpvYlR5cGVzRGF0YS5jb3VudDtcblxuICAgICAgICAgICAgICAgIHZhciBtZXRyaWNzUGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICAgICBwYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBwYWdlX3NpemU6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgY2hvaWNlX2lkOiB2bS5zZWxlY3RlZEpvYlR5cGUuaWQgPiAwID8gW3ZtLnNlbGVjdGVkSm9iVHlwZS5pZF0gOiBfLm1hcChqb2JUeXBlcywgJ2lkJyksXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbjogWydlcnJvcl9zeXN0ZW1fY291bnQnLCAnZXJyb3JfYWxnb3JpdGhtX2NvdW50JywgJ2Vycm9yX2RhdGFfY291bnQnLCAndG90YWxfY291bnQnXSxcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnam9iLXR5cGVzJ1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBtZXRyaWNzU2VydmljZS5nZXRQbG90RGF0YShtZXRyaWNzUGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEzMERheXMgPSBfLm1hcChkYXRhLnJlc3VsdHMsICd2YWx1ZXMnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhNDhIb3VycyA9IGZvcm1hdERhdGEoZGF0YTMwRGF5cywgMiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTI0SG91cnMgPSBmb3JtYXREYXRhKGRhdGE0OEhvdXJzLCAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYlR5cGVzLCBmdW5jdGlvbiAoam9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBlcmZvcm1hbmNlRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX3R5cGU6IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iVHlwZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ZW50eWZvdXJfaG91cnM6IGZvcm1hdENvbHVtbihkYXRhMjRIb3Vycywgam9iVHlwZS5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcnR5ZWlnaHRfaG91cnM6IGZvcm1hdENvbHVtbihkYXRhNDhIb3Vycywgam9iVHlwZS5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXJ0eV9kYXlzOiBmb3JtYXRDb2x1bW4oZGF0YTMwRGF5cywgam9iVHlwZS5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5wZXJmb3JtYW5jZURhdGEgPSBfLnNvcnRCeU9yZGVyKHZtLnBlcmZvcm1hbmNlRGF0YSwgW2Z1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQudHdlbnR5Zm91cl9ob3Vycy50b3RhbCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQudHdlbnR5Zm91cl9ob3Vycy5lcnJvclRvdGFsIC8gZC50d2VudHlmb3VyX2hvdXJzLnRvdGFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sICd0d2VudHlmb3VyX2hvdXJzLnRvdGFsJ10sIFsnZGVzYycsICdkZXNjJ10pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gdm0ucGVyZm9ybWFuY2VEYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnZpcnR1YWxpemF0aW9uVGhyZXNob2xkID0gdm0ucGVyZm9ybWFuY2VEYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSB2bS5wZXJmb3JtYW5jZURhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNraXBTb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uY3VyclNvcnRGaWVsZCA9IHZtLmpvYlR5cGVzUGFyYW1zLm9yZGVyRmllbGQgfHwgJ3R3ZW50eWZvdXJfaG91cnMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmN1cnJTb3J0RXJyb3JUeXBlID0gdm0uam9iVHlwZXNQYXJhbXMub3JkZXJFcnJvclR5cGUgfHwgJ2Vycm9yVG90YWwnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5qb2JUeXBlc1BhcmFtcy5vcmRlciAmJiB2bS5qb2JUeXBlc1BhcmFtcy5vcmRlckZpZWxkICYmIHZtLmpvYlR5cGVzUGFyYW1zLm9yZGVyRXJyb3JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNvcnRCeSh2bS5qb2JUeXBlc1BhcmFtcy5vcmRlckVycm9yVHlwZSwgdm0uam9iVHlwZXNQYXJhbXMub3JkZXJGaWVsZCwgdm0uam9iVHlwZXNQYXJhbXMub3JkZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEpvYlR5cGUnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2bS5qb2JUeXBlVmFsdWVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUobmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlR5cGUgPSBuZXdWYWx1ZSAhPT0gJ1ZJRVcgQUxMJztcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iVHlwZShuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYnNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkdWliTW9kYWwsIHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgbmF2U2VydmljZSwgc3VibmF2U2VydmljZSwgdXNlclNlcnZpY2UsIGpvYlNlcnZpY2UsIGpvYkV4ZWN1dGlvblNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCBsb2FkU2VydmljZSwgZ3JpZEZhY3RvcnksIHRvYXN0ciwgcG9sbGVyKSB7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMnKTtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgam9iVHlwZVZpZXdBbGwgPSB7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfTtcblxuICAgICAgICB2bS5qb2JzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldEpvYnNQYXJhbXMoKTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBbam9iVHlwZVZpZXdBbGxdO1xuICAgICAgICB2bS5qb2JFeGVjdXRpb24gPSBudWxsO1xuICAgICAgICB2bS5zZWxlY3RlZEpvYlR5cGUgPSB2bS5qb2JzUGFyYW1zLmpvYl90eXBlX2lkID8gdm0uam9ic1BhcmFtcy5qb2JfdHlwZV9pZCA6IGpvYlR5cGVWaWV3QWxsO1xuICAgICAgICB2bS5qb2JTdGF0dXNWYWx1ZXMgPSBzY2FsZUNvbmZpZy5qb2JTdGF0dXM7XG4gICAgICAgIHZtLnNlbGVjdGVkSm9iU3RhdHVzID0gdm0uam9ic1BhcmFtcy5zdGF0dXMgfHwgdm0uam9iU3RhdHVzVmFsdWVzWzBdO1xuICAgICAgICB2bS5lcnJvckNhdGVnb3J5VmFsdWVzID0gXy5tYXAoc2NhbGVDb25maWcuZXJyb3JDYXRlZ29yaWVzLCAnbmFtZScpO1xuICAgICAgICB2bS5zZWxlY3RlZEVycm9yQ2F0ZWdvcnkgPSB2bS5qb2JzUGFyYW1zLmVycm9yX2NhdGVnb3J5IHx8IHZtLmVycm9yQ2F0ZWdvcnlWYWx1ZXNbMF07XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3Muam9icztcbiAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydCA9IG1vbWVudC51dGModm0uam9ic1BhcmFtcy5zdGFydGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3AgPSBtb21lbnQudXRjKHZtLmpvYnNQYXJhbXMuZW5kZWQpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZGF0ZU1vZGVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpbWV6b25lOiAnKzAwMCdcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gdm0uam9ic1BhcmFtcy5wYWdlIHx8IDE7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSA9IHZtLmpvYnNQYXJhbXMucGFnZV9zaXplIHx8IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuXG4gICAgICAgIHZhciBmaWx0ZXJlZEJ5Sm9iVHlwZSA9IHZtLmpvYnNQYXJhbXMuam9iX3R5cGVfaWQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5Sm9iU3RhdHVzID0gdm0uam9ic1BhcmFtcy5zdGF0dXMgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5RXJyb3JDYXRlZ29yeSA9IHZtLmpvYnNQYXJhbXMuZXJyb3JfY2F0ZWdvcnkgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSB2bS5qb2JzUGFyYW1zLm9yZGVyID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIHZtLmNvbERlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdqb2JfdHlwZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxzcGFuIG5nLWJpbmQtaHRtbD1cInJvdy5lbnRpdHkuam9iX3R5cGUuZ2V0SWNvbigpXCI+PC9zcGFuPiB7eyByb3cuZW50aXR5LmpvYl90eXBlLnRpdGxlIH19IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudmVyc2lvbiB9fTwvZGl2PicsXG4gICAgICAgICAgICAgICAgZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZEpvYlR5cGVcIiBuZy1vcHRpb25zPVwiam9iVHlwZSBhcyAoam9iVHlwZS50aXRsZSArIFxcJyBcXCcgKyBqb2JUeXBlLnZlcnNpb24pIGZvciBqb2JUeXBlIGluIGdyaWQuYXBwU2NvcGUudm0uam9iVHlwZVZhbHVlc1wiPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdjcmVhdGVkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0NyZWF0ZWQgKFopJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmNyZWF0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2xhc3RfbW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnTGFzdCBNb2RpZmllZCAoWiknLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnZHVyYXRpb24nLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDEyMCxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzIHRleHQtcmlnaHRcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnc3RhdHVzJyxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTUwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJwdWxsLXJpZ2h0XCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGJ1dHRvbiBuZy1zaG93PVwiKCghZ3JpZC5hcHBTY29wZS52bS5yZWFkb25seSAmJiAhcm93LmVudGl0eS5pc19zdXBlcnNlZGVkKSAmJiAocm93LmVudGl0eS5zdGF0dXMgPT09IFxcJ0ZBSUxFRFxcJyB8fCByb3cuZW50aXR5LnN0YXR1cyA9PT0gXFwnQ0FOQ0VMRURcXCcpKVwiIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS52bS5yZXF1ZXVlSm9icyh7IGpvYl9pZHM6IFtyb3cuZW50aXR5LmlkXSB9KVwiIGNsYXNzPVwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiIHRpdGxlPVwiUmVxdWV1ZSBKb2JcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJmYSBmYS1yZXBlYXRcIj48L2k+PC9idXR0b24+ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gbmctc2hvdz1cIiFncmlkLmFwcFNjb3BlLnZtLnJlYWRvbmx5ICYmICFyb3cuZW50aXR5LmlzX3N1cGVyc2VkZWQgJiYgcm93LmVudGl0eS5zdGF0dXMgIT09IFxcJ0NPTVBMRVRFRFxcJyAmJiByb3cuZW50aXR5LnN0YXR1cyAhPT0gXFwnQ0FOQ0VMRURcXCdcIiBuZy1jbGljaz1cImdyaWQuYXBwU2NvcGUudm0uY2FuY2VsSm9iKHJvdy5lbnRpdHkpXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIgdGl0bGU9XCJDYW5jZWwgSm9iXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwiZmEgZmEtYmFuXCI+PC9pPjwvYnV0dG9uPicgK1xuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+IHt7IHJvdy5lbnRpdHkuc3RhdHVzIH19IDxzcGFuIHR5cGU9XCJidXR0b25cIiAgbmctaWY9XCJyb3cuZW50aXR5LmlzX3N1cGVyc2VkZWRcIiBjbGFzcz1cImxhYmVsIGxhYmVsLWluZm8gcHVsbC1yaWdodFwiIHRvb2x0aXAtYXBwZW5kLXRvLWJvZHk9XCJ0cnVlXCIgdWliLXRvb2x0aXA9XCJTdXBlcnNlZGVkXCI+Uzwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRKb2JTdGF0dXNcIj48b3B0aW9uIG5nLXNlbGVjdGVkPVwie3sgZ3JpZC5hcHBTY29wZS52bS5qb2JTdGF0dXNWYWx1ZXNbJGluZGV4XSA9PSBncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkSm9iU3RhdHVzIH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmpvYlN0YXR1c1ZhbHVlc1skaW5kZXhdIH19XCIgbmctcmVwZWF0PVwic3RhdHVzIGluIGdyaWQuYXBwU2NvcGUudm0uam9iU3RhdHVzVmFsdWVzIHRyYWNrIGJ5ICRpbmRleFwiPnt7IHN0YXR1cy50b1VwcGVyQ2FzZSgpIH19PC9vcHRpb24+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2Vycm9yLmNhdGVnb3J5JyxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTUwLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRXJyb3IgQ2F0ZWdvcnknLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRFcnJvckNhdGVnb3J5XCI+PG9wdGlvbiBuZy1zZWxlY3RlZD1cInt7IGdyaWQuYXBwU2NvcGUudm0uZXJyb3JDYXRlZ29yeVZhbHVlc1skaW5kZXhdID09IGdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRFcnJvckNhdGVnb3J5IH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmVycm9yQ2F0ZWdvcnlWYWx1ZXNbJGluZGV4XSB9fVwiIG5nLXJlcGVhdD1cImVycm9yIGluIGdyaWQuYXBwU2NvcGUudm0uZXJyb3JDYXRlZ29yeVZhbHVlcyB0cmFjayBieSAkaW5kZXhcIj57eyBlcnJvci50b1VwcGVyQ2FzZSgpIH19PC9vcHRpb24+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2Vycm9yLnRpdGxlJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0Vycm9yJyxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PGRpdiB1aWItdG9vbHRpcD1cInt7IHJvdy5lbnRpdHkuZXJyb3IuZGVzY3JpcHRpb24gfX1cIiB0b29sdGlwLWFwcGVuZC10by1ib2R5PVwidHJ1ZVwiPnt7IHJvdy5lbnRpdHkuZXJyb3IudGl0bGUgfX08L2Rpdj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAyMDAsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2lkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0xvZycsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDYwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1jZW50ZXJcIj48YnV0dG9uIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS52bS5zaG93TG9nKHJvdy5lbnRpdHkuaWQpXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCI+PGkgY2xhc3M9XCJmYSBmYS1maWxlLXRleHRcIj48L2k+PC9idXR0b24+PC9kaXY+J1xuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHZtLmdldEpvYnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLmdldEpvYnModm0uam9ic1BhcmFtcykudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25DdXJyZW50UGFnZSA9IHZtLmpvYnNQYXJhbXMucGFnZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplID0gdm0uam9ic1BhcmFtcy5wYWdlX3NpemU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldEpvYlR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZXNPbmNlKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMucHVzaChkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBfLmZsYXR0ZW4odm0uam9iVHlwZVZhbHVlcyk7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2JUeXBlID0gXy5maW5kKHZtLmpvYlR5cGVWYWx1ZXMsIHsgaWQ6IHZtLmpvYnNQYXJhbXMuam9iX3R5cGVfaWQgfSkgfHwgam9iVHlwZVZpZXdBbGw7XG4gICAgICAgICAgICAgICAgdm0uZ2V0Sm9icygpO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnNob3dMb2cgPSBmdW5jdGlvbiAoam9iSWQpIHtcbiAgICAgICAgICAgIC8vIHNob3cgbG9nIG1vZGFsXG4gICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0Sm9iRGV0YWlsKGpvYklkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uID0gZGF0YS5nZXRMYXRlc3RFeGVjdXRpb24oKTtcbiAgICAgICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldEpvYkV4ZWN1dGlvbkRldGFpbHModm0uam9iRXhlY3V0aW9uLmlkKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbiA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaG93TG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3dDbGFzczogJ2xvZy1tb2RhbC13aW5kb3cnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZXF1ZXVlSm9icyA9IGZ1bmN0aW9uIChqb2JzUGFyYW1zKSB7XG4gICAgICAgICAgICBpZiAoIWpvYnNQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBqb2JzUGFyYW1zID0gdm0uam9ic1BhcmFtcyA/IHZtLmpvYnNQYXJhbXMgOiB7IHN0YXJ0ZWQ6IHZtLmxhc3RNb2RpZmllZFN0YXJ0LnRvSVNPU3RyaW5nKCksIGVuZGVkOiB2bS5sYXN0TW9kaWZpZWRTdG9wLnRvSVNPU3RyaW5nKCkgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBsb2FkU2VydmljZS5yZXF1ZXVlSm9icyhqb2JzUGFyYW1zKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ3N1Y2Nlc3MnXSgnUmVxdWV1ZSBTdWNjZXNzZnVsJyk7XG4gICAgICAgICAgICAgICAgdm0uZ2V0Sm9icygpO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKCdSZXF1ZXVlIHJlcXVlc3QgZmFpbGVkJyk7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2FuY2VsSm9iID0gZnVuY3Rpb24gKGpvYikge1xuICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbFN0YXR1cyA9IGpvYi5zdGF0dXM7XG4gICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTCc7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLnVwZGF0ZUpvYihqb2IuaWQsIHsgc3RhdHVzOiAnQ0FOQ0VMRUQnIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdKb2IgQ2FuY2VsZWQnKTtcbiAgICAgICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTEVEJztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgam9iLnN0YXR1cyA9IG9yaWdpbmFsU3RhdHVzO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcG9sbGVyLnN0b3BBbGwoKTtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JzUGFyYW1zKHZtLmpvYnNQYXJhbXMpO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB2bS5nZXRKb2JzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ29sRGVmcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBncmlkRmFjdG9yeS5hcHBseVNvcnRDb25maWcodm0uY29sRGVmcywgdm0uam9ic1BhcmFtcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSm9iT3JkZXIgPSBmdW5jdGlvbiAoc29ydEFycikge1xuICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5vcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMCA/IHNvcnRBcnIgOiBudWxsO1xuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwO1xuICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZS5pZCAhPT0gdm0uam9ic1BhcmFtcy5qb2JfdHlwZV9pZCkge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLmpvYl90eXBlX2lkID0gdmFsdWUuaWQgPT09IDAgPyBudWxsIDogdmFsdWUuaWQ7XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JTdGF0dXMgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB2bS5qb2JzUGFyYW1zLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLnN0YXR1cyA9IHZhbHVlID09PSAnVklFVyBBTEwnID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlRXJyb3JDYXRlZ29yeSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHZtLmpvYnNQYXJhbXMuZXJyb3JfY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JzUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5lcnJvcl9jYXRlZ29yeSA9IHZhbHVlID09PSAnVklFVyBBTEwnID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICB2bS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuc2VsZWN0aW9uLm9uLnJvd1NlbGVjdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmFjdGlvbkNsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvam9icy9qb2IvJyArIHJvdy5lbnRpdHkuaWQpLnNlYXJjaCgnJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlID0gY3VycmVudFBhZ2U7XG4gICAgICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuY29yZS5vbi5zb3J0Q2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChncmlkLCBzb3J0Q29sdW1ucykge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5ncmlkQXBpLmdyaWQuY29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICBjb2wuY29sRGVmLnNvcnQgPSBjb2wuc29ydDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9ic0NvbERlZnModm0uZ3JpZEFwaS5ncmlkLm9wdGlvbnMuY29sdW1uRGVmcyk7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JPcmRlcihzb3J0QXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9ic1BhcmFtcyh2bS5qb2JzUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICB2bS5yZWFkb25seSA9ICEodXNlciAmJiB1c2VyLmlzX2FkbWluKTtcbiAgICAgICAgICAgIHZtLmdldEpvYlR5cGVzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdqb2JzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkSm9iVHlwZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gXy5maW5kKHZtLmpvYlR5cGVWYWx1ZXMsIHtpZDogcGFyc2VJbnQodmFsdWUpfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlR5cGUgPSAhYW5ndWxhci5lcXVhbHModmFsdWUsIGpvYlR5cGVWaWV3QWxsKTtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iVHlwZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEpvYlN0YXR1cycsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUpvYlN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JTdGF0dXModmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlN0YXR1cyA9IHZhbHVlICE9PSAnVklFVyBBTEwnO1xuICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkRXJyb3JDYXRlZ29yeScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUVycm9yQ2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlRXJyb3JDYXRlZ29yeSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5RXJyb3JDYXRlZ29yeSA9IHZhbHVlICE9PSAnVklFVyBBTEwnO1xuICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUVycm9yQ2F0ZWdvcnkodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdGFydCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5zdGFydGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmxhc3RNb2RpZmllZFN0b3AnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMuZW5kZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXRKb2JzQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0Sm9ic1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIFxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYkV4ZWN1dGlvbkxvZ0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sICRlbGVtZW50LCAkdGltZW91dCwgc2NhbGVDb25maWcsIGpvYkV4ZWN1dGlvblNlcnZpY2UsIHN0YXRlU2VydmljZSwgcG9sbGVyKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICAgICAgIGxhdGVzdFNjYWxlT3JkZXJOdW0gPSAwO1xuICAgICAgICBcbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5mb3JjZVNjcm9sbCA9IHRydWU7XG4gICAgICAgICAgICB2bS5qb2JMb2dFcnJvciA9IG51bGw7XG4gICAgICAgICAgICB2bS5leGVjTG9nID0gW107XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0TG9nQXJncyhbXSk7XG5cbiAgICAgICAgICAgIC8vIGRlYm91bmNlIHRoaXMgd2F0Y2ggb3BlcmF0aW9uIHRvIHByZXZlbnQgZHVwbGljYXRlIGNhbGxzXG4gICAgICAgICAgICAvLyBzZXQgdGhlIHRpbWVyIGZvciAxMDBtcyBsZXNzIHRoYW4gdGhlIGpvYiBleGUgbG9nIHBvbGwgaW50ZXJ2YWxcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ2V4ZWN1dGlvbicsIF8uZGVib3VuY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZXhlY3V0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXR1cyA9ICRzY29wZS5leGVjdXRpb24uc3RhdHVzLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5leGVjdXRpb24pO1xuICAgICAgICAgICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldExvZygkc2NvcGUuZXhlY3V0aW9uLmlkKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC4kc3RhdHVzICE9PSAyMDQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udGVudCB3YXMgcmV0dXJuZWQsIHNvIGFkZCBpdCB0byB0aGUgbG9nIGFycmF5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdldCBkaWZmZXJlbmNlIG9mIG1heCBzY3JvbGwgbGVuZ3RoIGFuZCBjdXJyZW50IHNjcm9sbCBsZW5ndGgudmFyICA9IHJlc3VsdC5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGl2ID0gJCgkZWxlbWVudFswXSkuZmluZCgnLmJhc2gnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2Nyb2xsRGlmZiA9IChkaXYuc2Nyb2xsVG9wKCkgKyBkaXYucHJvcCgnb2Zmc2V0SGVpZ2h0JykpIC0gZGl2LnByb3AoJ3Njcm9sbEhlaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uc2Nyb2xsRGlmZiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5mb3JjZVNjcm9sbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uY2F0IG5ldyBjb250ZW50IGFuZCBzb3J0IGxvZyBhcnJheSBieSB0aW1lc3RhbXAgYW5kIHRoZW4gYnkgb3JkZXIgbnVtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmV4ZWNMb2cgPSBfLnNvcnRCeSh2bS5leGVjTG9nLmNvbmNhdChyZXN1bHQuaGl0cy5oaXRzKSwgWydfc291cmNlLkB0aW1lc3RhbXAnLCAnX3NvdXJjZS5zY2FsZV9vcmRlcl9udW0nXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5leGVjTG9nICYmIHZtLmV4ZWNMb2cubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RMb2cgPSBfLmxhc3Qodm0uZXhlY0xvZykuX3NvdXJjZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0TG9nLnNjYWxlX29yZGVyX251bSAhPT0gbGF0ZXN0U2NhbGVPcmRlck51bSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5ldyBlbnRyaWVzLCBzbyBsZWF2ZSB0aGVtIG9uIHRoZSBhcnJheSBhbmQgcmVwb3J0IHRoZSBuZXcgdGltZXN0YW1wXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05ldyBlbnRyaWVzIC0gJyArIGxhc3RMb2cuc2NhbGVfb3JkZXJfbnVtICsgJyA6ICcgKyBsYXRlc3RTY2FsZU9yZGVyTnVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRlc3RTY2FsZU9yZGVyTnVtID0gbGFzdExvZy5zY2FsZV9vcmRlcl9udW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldExvZ0FyZ3MoW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGFydGVkOiBtb21lbnQudXRjKGxhc3RMb2dbJ0B0aW1lc3RhbXAnXSkuc3VidHJhY3QoMSwgJ3MnKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydGVkOiBsYXN0TG9nWydAdGltZXN0YW1wJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkdXBsaWNhdGUgZW50cmllcywgc28gcmVtb3ZlIHRoZW0gZnJvbSB0aGUgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRHVwbGljYXRlIGVudHJpZXMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5leGVjTG9nID0gXy50YWtlKHZtLmV4ZWNMb2csIHZtLmV4ZWNMb2cubGVuZ3RoIC0gcmVzdWx0LmhpdHMuaGl0cy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRzdGF0dXNUZXh0ICYmIHJlc3VsdC4kc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uam9iTG9nRXJyb3JTdGF0dXMgPSByZXN1bHQuJHN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5qb2JMb2dFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgam9iIGxvZ3MuJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kb24oJ21vZGFsLmNsb3NpbmcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb2xsZXIuc3RvcEFsbCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLmpvYkV4ZWN1dGlvbkxvZyAtIDEwMCkpO1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uZXhlY0xvZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uZXhlY0xvZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodm0uZm9yY2VTY3JvbGwgfHwgdm0uc2Nyb2xsRGlmZiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZm9yY2VTY3JvbGwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2NybEhlaWdodCA9ICQoJGVsZW1lbnRbMF0pLmZpbmQoJy5iYXNoJykucHJvcCgnc2Nyb2xsSGVpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgkZWxlbWVudFswXSkuZmluZCgnLmJhc2gnKS5zY3JvbGxUb3Aoc2NybEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zY3JvbGxpdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGl0ZW0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnN0ZG91dENoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3Rkb3V0IGNoYW5nZWQuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgfSkuZGlyZWN0aXZlKCdqb2JFeGVjdXRpb25Mb2cnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRXhlY3V0aW9uTG9nQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9kaXJlY3RpdmVzL2pvYkV4ZWN1dGlvbkxvZ1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZXhlY3V0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0pvYkhlYWx0aENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCBqb2JUeXBlU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0ubG9hZGluZ0pvYkhlYWx0aCA9IHRydWU7XG4gICAgICAgIHZtLmpvYkhlYWx0aEVycm9yID0gbnVsbDtcbiAgICAgICAgdm0uam9iSGVhbHRoRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS5qb2JIZWFsdGggPSB7fTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZVN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVTdGF0dXMoe1xuICAgICAgICAgICAgICAgIHBhZ2U6IG51bGwsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiAxMDAwLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6ICRzY29wZS5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBlbmRlZDogbnVsbFxuICAgICAgICAgICAgfSkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5qb2JIZWFsdGhFcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVTdGF0dXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIHZtLnRvdGFsID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdm0uZmFpbGVkID0gMDtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVzID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEucmVzdWx0cywgZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGVyZm9ybWFuY2UgPSBzdGF0dXMuZ2V0UGVyZm9ybWFuY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRvdGFsID0gdm0udG90YWwgKyBwZXJmb3JtYW5jZS50b3RhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmZhaWxlZCA9IHZtLmZhaWxlZCArIHBlcmZvcm1hbmNlLmZhaWxlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVzLnB1c2goc3RhdHVzLmdldEZhaWx1cmVzKCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZURhdGEgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5c3RlbUZhaWx1cmVzID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFGYWlsdXJlcyA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGdvcml0aG1GYWlsdXJlcyA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZhaWx1cmVzLCBmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGYsIGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUuc3RhdHVzID09PSAnU1lTVEVNJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeXN0ZW1GYWlsdXJlcyA9IHN5c3RlbUZhaWx1cmVzICsgdHlwZS5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUuc3RhdHVzID09PSAnREFUQScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUZhaWx1cmVzID0gZGF0YUZhaWx1cmVzICsgdHlwZS5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUuc3RhdHVzID09PSAnQUxHT1JJVEhNJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGdvcml0aG1GYWlsdXJlcyA9IGFsZ29yaXRobUZhaWx1cmVzICsgdHlwZS5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN5c3RlbUZhaWx1cmVzID4gMCB8fCBkYXRhRmFpbHVyZXMgPiAwIHx8IGFsZ29yaXRobUZhaWx1cmVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN5c3RlbUZhaWx1cmVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdTWVNURU0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogc3lzdGVtRmFpbHVyZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGdvcml0aG1GYWlsdXJlcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnQUxHT1JJVEhNJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGFsZ29yaXRobUZhaWx1cmVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUZhaWx1cmVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdEQVRBJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGRhdGFGYWlsdXJlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uam9iSGVhbHRoID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiB2bS50b3RhbCA9PT0gMCA/IDAgOiAxMDAgLSAoKHZtLmZhaWxlZCAvIHZtLnRvdGFsKSAqIDEwMCkudG9GaXhlZCgyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YTogZmFpbHVyZURhdGFcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmJyb2FkY2FzdERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnam9iVHlwZVN0YXR1cycsIHZtLmpvYlR5cGVTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5qb2JIZWFsdGhFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5qb2JIZWFsdGhFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgam9iIHN0YXRpc3RpY3MuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ0pvYkhlYWx0aCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZ2V0Sm9iVHlwZVN0YXR1cygpO1xuICAgIH0pLmRpcmVjdGl2ZSgnYWlzSm9iSGVhbHRoJywgZnVuY3Rpb24oKXtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzYWdlOiA8YWlzLWpvYi1oZWFsdGggLz5cbiAgICAgICAgICoqL1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0pvYkhlYWx0aENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvZGlyZWN0aXZlcy9qb2JIZWFsdGhUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAnPScsXG4gICAgICAgICAgICAgICAgYnJvYWRjYXN0RGF0YTogJz0nLCAvLyBzZXQgdG8gdHJ1ZSB3aGVuIHVzaW5nIGFub3RoZXIgd2lkZ2V0IGluIHRoZSBzYW1lIHZpZXcgdGhhdCBhbHNvIGNhbGxzIGdldEpvYlR5cGVTdGF0dXNcbiAgICAgICAgICAgICAgICBzaG93RGVzY3JpcHRpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYlR5cGVJbnRlcmZhY2VEaXJlY3RpdmVDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgam9iVHlwZVNlcnZpY2UpIHtcblxuICAgIH0pLmRpcmVjdGl2ZSgnYWlzSm9iVHlwZUludGVyZmFjZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2FnZTogPGFpcy1qb2ItaGVhbHRoIC8+XG4gICAgICAgICAqKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdqb2JUeXBlSW50ZXJmYWNlRGlyZWN0aXZlQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9kaXJlY3RpdmVzL2pvYlR5cGVJbnRlcmZhY2VUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGpvYlR5cGVJbnRlcmZhY2U6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIEpvYiA9IGZ1bmN0aW9uIChpZCwgam9iX3R5cGUsIGpvYl90eXBlX3JldiwgZXZlbnQsIGVycm9yLCBzdGF0dXMsIHByaW9yaXR5LCBudW1fZXhlcywgdGltZW91dCwgbWF4X3RyaWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdXNfcmVxdWlyZWQsIG1lbV9yZXF1aXJlZCwgZGlza19pbl9yZXF1aXJlZCwgZGlza19vdXRfcmVxdWlyZWQsIGNyZWF0ZWQsIHF1ZXVlZCwgc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRlZCwgbGFzdF9zdGF0dXNfY2hhbmdlLCBsYXN0X21vZGlmaWVkLCBpc19zdXBlcnNlZGVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlX3JldiA9IGpvYl90eXBlX3JldjtcbiAgICAgICAgICAgIHRoaXMuZXZlbnQgPSBldmVudDtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICAgICAgdGhpcy5udW1fZXhlcyA9IG51bV9leGVzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMubWF4X3RyaWVzID0gbWF4X3RyaWVzO1xuICAgICAgICAgICAgdGhpcy5jcHVzX3JlcXVpcmVkID0gY3B1c19yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVtX3JlcXVpcmVkID0gbWVtX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX2luX3JlcXVpcmVkID0gZGlza19pbl9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfcmVxdWlyZWQgPSBkaXNrX291dF9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhjcmVhdGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCk7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZCA9IHF1ZXVlZDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9IHN0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLmVuZGVkID0gZW5kZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3Rfc3RhdHVzX2NoYW5nZSA9IGxhc3Rfc3RhdHVzX2NoYW5nZTtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCk7XG4gICAgICAgICAgICB0aGlzLmlzX3N1cGVyc2VkZWQgPSBpc19zdXBlcnNlZGVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYi5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IHRoaXMuc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZW5kID0gdGhpcy5lbmRlZCA/IHRoaXMuZW5kZWQgOiBtb21lbnQudXRjKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKHN0YXJ0LCBlbmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2IuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZV9yZXYsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm51bV9leGVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWF4X3RyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXNfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfaW5fcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGlza19vdXRfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X3N0YXR1c19jaGFuZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19zdXBlcnNlZGVkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYi5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2IuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYjtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkRldGFpbEV2ZW50JywgZnVuY3Rpb24gKEpvYkRldGFpbEV2ZW50UnVsZSkge1xuICAgICAgICB2YXIgSm9iRGV0YWlsRXZlbnQgPSBmdW5jdGlvbiAoaWQsIHR5cGUsIHJ1bGUsIG9jY3VycmVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgdGhpcy5ydWxlID0gSm9iRGV0YWlsRXZlbnRSdWxlLnRyYW5zZm9ybWVyKHJ1bGUpO1xuICAgICAgICAgICAgdGhpcy5vY2N1cnJlZCA9IG9jY3VycmVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkRldGFpbEV2ZW50LnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JEZXRhaWxFdmVudC5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsRXZlbnQoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ydWxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm9jY3VycmVkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsRXZlbnQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JEZXRhaWxFdmVudC50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JEZXRhaWxFdmVudC5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JEZXRhaWxFdmVudC5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRGV0YWlsRXZlbnQ7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JEZXRhaWxFdmVudFJ1bGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBKb2JEZXRhaWxFdmVudFJ1bGUgPSBmdW5jdGlvbiAoaWQsIHR5cGUsIGlzX2FjdGl2ZSwgY3JlYXRlZCwgYXJjaGl2ZWQsIGxhc3RfbW9kaWZpZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmFyY2hpdmVkID0gYXJjaGl2ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkRldGFpbEV2ZW50UnVsZS5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRGV0YWlsRXZlbnRSdWxlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxFdmVudFJ1bGUoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19hY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsRXZlbnRSdWxlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRGV0YWlsRXZlbnRSdWxlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbEV2ZW50UnVsZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JEZXRhaWxFdmVudFJ1bGUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkRldGFpbEV2ZW50UnVsZTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkRldGFpbElucHV0RGF0YScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEpvYkRldGFpbElucHV0RGF0YSA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgZmlsZV9pZCwgZmlsZV9pZHMsIGZpbGVzKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5maWxlX2lkID0gZmlsZV9pZDtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9pZHMgPSBmaWxlX2lkcztcbiAgICAgICAgICAgIHRoaXMuZmlsZXMgPSBmaWxlcztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JEZXRhaWxJbnB1dERhdGEucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZmlsZV9pZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZV9pZDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5maWxlX2lkcylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZV9pZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkRldGFpbElucHV0RGF0YS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsSW5wdXREYXRhKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZV9pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX2lkcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbElucHV0RGF0YSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkRldGFpbElucHV0RGF0YS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JEZXRhaWxJbnB1dERhdGEuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRGV0YWlsSW5wdXREYXRhLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JEZXRhaWxJbnB1dERhdGE7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JEZXRhaWxPdXRwdXREYXRhJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgSm9iRGV0YWlsT3V0cHV0RGF0YSA9IGZ1bmN0aW9uIChuYW1lLCB3b3Jrc3BhY2VfaWQsIGZpbGVzKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2VfaWQgPSB3b3Jrc3BhY2VfaWQ7XG4gICAgICAgICAgICB0aGlzLmZpbGVzID0gZmlsZXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRGV0YWlsT3V0cHV0RGF0YS5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRGV0YWlsT3V0cHV0RGF0YS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsT3V0cHV0RGF0YShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLndvcmtzcGFjZV9pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbE91dHB1dERhdGEoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JEZXRhaWxPdXRwdXREYXRhLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbE91dHB1dERhdGEuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRGV0YWlsT3V0cHV0RGF0YS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRGV0YWlsT3V0cHV0RGF0YTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkRldGFpbHMnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGUsIEpvYkV4ZWN1dGlvbiwgUHJvZHVjdCwgSm9iRGV0YWlsSW5wdXREYXRhLCBKb2JEZXRhaWxPdXRwdXREYXRhLCBSZWNpcGUsIEpvYkRldGFpbEV2ZW50LCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIEpvYkRldGFpbHMgPSBmdW5jdGlvbiAoaWQsIGpvYl90eXBlLCBqb2JfdHlwZV9yZXYsIGV2ZW50LCBlcnJvciwgc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eSwgbnVtX2V4ZXMsIHRpbWVvdXQsIG1heF90cmllcywgY3B1c19yZXF1aXJlZCwgbWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNrX2luX3JlcXVpcmVkLCBkaXNrX291dF9yZXF1aXJlZCwgY3JlYXRlZCwgcXVldWVkLCBzdGFydGVkLCBlbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9zdGF0dXNfY2hhbmdlLCBsYXN0X21vZGlmaWVkLCBkYXRhLCByZXN1bHRzLCByZWNpcGVzLCBqb2JfZXhlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRzLCBvdXRwdXRzLCBpc19zdXBlcnNlZGVkLCByb290X3N1cGVyc2VkZWRfam9iLCBzdXBlcnNlZGVkX2pvYixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXJzZWRlZF9ieV9qb2IsIHN1cGVyc2VkZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfcmV2ID0gam9iX3R5cGVfcmV2O1xuICAgICAgICAgICAgdGhpcy5ldmVudCA9IEpvYkRldGFpbEV2ZW50LnRyYW5zZm9ybWVyKGV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICAgICAgdGhpcy5udW1fZXhlcyA9IG51bV9leGVzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMubWF4X3RyaWVzID0gbWF4X3RyaWVzO1xuICAgICAgICAgICAgdGhpcy5jcHVzX3JlcXVpcmVkID0gY3B1c19yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVtX3JlcXVpcmVkID0gbWVtX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX2luX3JlcXVpcmVkID0gZGlza19pbl9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfcmVxdWlyZWQgPSBkaXNrX291dF9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhjcmVhdGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpO1xuICAgICAgICAgICAgdGhpcy5xdWV1ZWQgPSBxdWV1ZWQ7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKHF1ZXVlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9IHN0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhzdGFydGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpO1xuICAgICAgICAgICAgdGhpcy5lbmRlZCA9IGVuZGVkO1xuICAgICAgICAgICAgdGhpcy5lbmRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGVuZGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpO1xuICAgICAgICAgICAgdGhpcy5sYXN0X3N0YXR1c19jaGFuZ2UgPSBsYXN0X3N0YXR1c19jaGFuZ2U7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0ge1xuICAgICAgICAgICAgICAgIGlucHV0X2RhdGE6IEpvYkRldGFpbElucHV0RGF0YS50cmFuc2Zvcm1lcihkYXRhLmlucHV0X2RhdGEpLFxuICAgICAgICAgICAgICAgIHZlcnNpb246IGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICBvdXRwdXRfZGF0YTogSm9iRGV0YWlsT3V0cHV0RGF0YS50cmFuc2Zvcm1lcihkYXRhLm91dHB1dF9kYXRhKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0cyA9IHtcbiAgICAgICAgICAgICAgICBvdXRwdXRfZGF0YTogSm9iRGV0YWlsT3V0cHV0RGF0YS50cmFuc2Zvcm1lcihyZXN1bHRzLm91dHB1dF9kYXRhKSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiByZXN1bHRzLnZlcnNpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnJlY2lwZXMgPSBfLnNvcnRCeShSZWNpcGUudHJhbnNmb3JtZXIocmVjaXBlcyksIFsnY3JlYXRlZCddKS5yZXZlcnNlKCk7XG4gICAgICAgICAgICB0aGlzLmpvYl9leGVzID0gSm9iRXhlY3V0aW9uLnRyYW5zZm9ybWVyKGpvYl9leGVzKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzID0gaW5wdXRzO1xuICAgICAgICAgICAgdGhpcy5vdXRwdXRzID0gb3V0cHV0cztcbiAgICAgICAgICAgIHRoaXMuaXNfc3VwZXJzZWRlZCA9IGlzX3N1cGVyc2VkZWQ7XG4gICAgICAgICAgICB0aGlzLnJvb3Rfc3VwZXJzZWRlZF9qb2IgPSByb290X3N1cGVyc2VkZWRfam9iO1xuICAgICAgICAgICAgdGhpcy5zdXBlcnNlZGVkX2pvYiA9IHN1cGVyc2VkZWRfam9iO1xuICAgICAgICAgICAgdGhpcy5zdXBlcnNlZGVkX2J5X2pvYiA9IHN1cGVyc2VkZWRfYnlfam9iO1xuICAgICAgICAgICAgdGhpcy5zdXBlcnNlZGVkID0gc3VwZXJzZWRlZDtcbiAgICAgICAgICAgIHRoaXMuc3VwZXJzZWRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKHN1cGVyc2VkZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Yyk7O1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRGV0YWlscy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IHRoaXMuc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZW5kID0gdGhpcy5lbmRlZCA/IHRoaXMuZW5kZWQgOiBtb21lbnQudXRjKCkudG9JU09TdHJpbmcoKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24oc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TGF0ZXN0RXhlY3V0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm51bV9leGVzID4gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuam9iX2V4ZXNbMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFN0YXR1c0NsYXNzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIC8vIGlmKHRoaXMuc3RhdHVzID09PSAnQ09NUExFVEVEJyl7XG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAnbGFiZWwtc3VjY2Vzcyc7XG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgIC8vIGVsc2UgaWYoIHRoaXMuc3RhdHVzID09PSAnRkFJTEVEJyl7XG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAnbGFiZWwtZGVmYXVsdCc7Ly8gICAgcmV0dXJuICdsYWJlbC1kYW5nZXInO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICAvLyBlbHNle1xuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJ2xhYmVsLWRlZmF1bHQnO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXMudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRGV0YWlscy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlscyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZV9yZXYsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm51bV9leGVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWF4X3RyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXNfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfaW5fcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGlza19vdXRfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X3N0YXR1c19jaGFuZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVjaXBlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbnB1dHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEub3V0cHV0cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19zdXBlcnNlZGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJvb3Rfc3VwZXJzZWRlZF9qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3VwZXJzZWRlZF9qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3VwZXJzZWRlZF9ieV9qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3VwZXJzZWRlZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JEZXRhaWxzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbHMuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRGV0YWlscy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRGV0YWlscztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkV4ZWN1dGlvbicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgSm9iLCBOb2RlLCBtb21lbnQpIHtcbiAgICAgICAgdmFyIEpvYkV4ZWN1dGlvbiA9IGZ1bmN0aW9uIChpZCwgc3RhdHVzLCBjb21tYW5kX2FyZ3VtZW50cywgdGltZW91dCwgcHJlX3N0YXJ0ZWQsIHByZV9jb21wbGV0ZWQsIHByZV9leGl0X2NvZGUsIGpvYl9zdGFydGVkLCBqb2JfY29tcGxldGVkLCBqb2JfZXhpdF9jb2RlLCBwb3N0X3N0YXJ0ZWQsIHBvc3RfY29tcGxldGVkLCBwb3N0X2V4aXRfY29kZSwgY3JlYXRlZCwgcXVldWVkLCBzdGFydGVkLCBlbmRlZCwgbGFzdF9tb2RpZmllZCwgam9iLCBub2RlLCBlcnJvciwgZW52aXJvbm1lbnQsIGNwdXNfc2NoZWR1bGVkLCBtZW1fc2NoZWR1bGVkLCBkaXNrX2luX3NjaGVkdWxlZCwgZGlza19vdXRfc2NoZWR1bGVkLCBkaXNrX3RvdGFsX3NjaGVkdWxlZCwgcmVzdWx0cywgY3VycmVudF9zdGRvdXRfdXJsLCBjdXJyZW50X3N0ZGVycl91cmwsIHJlc3VsdHNfbWFuaWZlc3QpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kX2FyZ3VtZW50cyA9IGNvbW1hbmRfYXJndW1lbnRzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMucHJlX3N0YXJ0ZWQgPSBwcmVfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMucHJlX2NvbXBsZXRlZCA9IHByZV9jb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9leGl0X2NvZGUgPSBwcmVfZXhpdF9jb2RlO1xuICAgICAgICAgICAgdGhpcy5qb2Jfc3RhcnRlZCA9IGpvYl9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfY29tcGxldGVkID0gam9iX2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMuam9iX2V4aXRfY29kZSA9IGpvYl9leGl0X2NvZGU7XG4gICAgICAgICAgICB0aGlzLnBvc3Rfc3RhcnRlZCA9IHBvc3Rfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9jb21wbGV0ZWQgPSBwb3N0X2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9leGl0X2NvZGUgPSBwb3N0X2V4aXRfY29kZTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gY3JlYXRlZCA/IG1vbWVudC51dGMoY3JlYXRlZCkudG9JU09TdHJpbmcoKSA6IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZCA9IHF1ZXVlZDtcbiAgICAgICAgICAgIHRoaXMucXVldWVkX2Zvcm1hdHRlZCA9IHF1ZXVlZCA/IG1vbWVudC51dGMocXVldWVkKS50b0lTT1N0cmluZygpIDogcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5zdGFydGVkID0gc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZF9mb3JtYXR0ZWQgPSBzdGFydGVkID8gbW9tZW50LnV0YyhzdGFydGVkKS50b0lTT1N0cmluZygpIDogc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBlbmRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWRfZm9ybWF0dGVkID0gZW5kZWQgPyBtb21lbnQudXRjKGVuZGVkKS50b0lTT1N0cmluZygpIDogZW5kZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IGxhc3RfbW9kaWZpZWQgPyBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLnRvSVNPU3RyaW5nKCkgOiBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5qb2IgPSBKb2IudHJhbnNmb3JtZXIoam9iKTtcbiAgICAgICAgICAgIHRoaXMubm9kZSA9IE5vZGUudHJhbnNmb3JtZXIobm9kZSk7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICB0aGlzLmVudmlyb25tZW50ID0gZW52aXJvbm1lbnQ7XG4gICAgICAgICAgICB0aGlzLmNwdXNfc2NoZWR1bGVkID0gY3B1c19zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLm1lbV9zY2hlZHVsZWQgPSBtZW1fc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX2luX3NjaGVkdWxlZCA9IGRpc2tfaW5fc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9zY2hlZHVsZWQgPSBkaXNrX291dF9zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfdG90YWxfc2NoZWR1bGVkID0gZGlza190b3RhbF9zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdHMgPSByZXN1bHRzO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50X3N0ZG91dF91cmwgPSBjdXJyZW50X3N0ZG91dF91cmw7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRfc3RkZXJyX3VybCA9IGN1cnJlbnRfc3RkZXJyX3VybDtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0c19tYW5pZmVzdCA9IHJlc3VsdHNfbWFuaWZlc3Q7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRXhlY3V0aW9uLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGModGhpcy5qb2JfY29tcGxldGVkKS5kaWZmKG1vbWVudC51dGModGhpcy5qb2Jfc3RhcnRlZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5qb2Iuam9iVHlwZS5pY29uQ29kZSA/ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHRoaXMuam9iLmpvYlR5cGUuaWNvbkNvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkV4ZWN1dGlvbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRXhlY3V0aW9uKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21tYW5kX2FyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJlX2V4aXRfY29kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2Jfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9leGl0X2NvZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9zdF9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvc3RfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvc3RfZXhpdF9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lbnZpcm9ubWVudCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZW1fc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfaW5fc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX3RvdGFsX3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmN1cnJlbnRfc3Rkb3V0X3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jdXJyZW50X3N0ZGVycl91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0c19tYW5pZmVzdFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkV4ZWN1dGlvbigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkV4ZWN1dGlvbi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JFeGVjdXRpb24uYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRXhlY3V0aW9uLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JFeGVjdXRpb247XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JFeGVjdXRpb25Mb2cnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYiwgTm9kZSkge1xuICAgICAgICB2YXIgSm9iRXhlY3V0aW9uTG9nID0gZnVuY3Rpb24gKGlkLCBzdGF0dXMsIGNvbW1hbmRfYXJndW1lbnRzLCB0aW1lb3V0LCBleGl0X2NvZGUsIGNyZWF0ZWQsIHF1ZXVlZCwgc2NoZWR1bGVkLCBwcmVfc3RhcnRlZCwgcHJlX2NvbXBsZXRlZCwgam9iX3N0YXJ0ZWQsIGpvYl9jb21wbGV0ZWQsIHBvc3Rfc3RhcnRlZCwgcG9zdF9jb21wbGV0ZWQsIGVuZGVkLCBsYXN0X21vZGlmaWVkLCBqb2IsIG5vZGUsIGVycm9yLCBpc19maW5pc2hlZCwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kX2FyZ3VtZW50cyA9IGNvbW1hbmRfYXJndW1lbnRzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMuZXhpdF9jb2RlID0gZXhpdF9jb2RlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMucXVldWVkID0gcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWQgPSBzY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9zdGFydGVkID0gcHJlX3N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9jb21wbGV0ZWQgPSBwcmVfY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5qb2Jfc3RhcnRlZCA9IGpvYl9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfY29tcGxldGVkID0gam9iX2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9zdGFydGVkID0gcG9zdF9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5wb3N0X2NvbXBsZXRlZCA9IHBvc3RfY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5lbmRlZCA9IGVuZGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuam9iID0gSm9iLnRyYW5zZm9ybWVyKGpvYik7XG4gICAgICAgICAgICB0aGlzLm5vZGUgPSBOb2RlLnRyYW5zZm9ybWVyKG5vZGUpO1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgICAgICAgdGhpcy5pc19maW5pc2hlZCA9IGlzX2ZpbmlzaGVkO1xuICAgICAgICAgICAgdGhpcy5zdGRvdXQgPSBzdGRvdXQ7XG4gICAgICAgICAgICB0aGlzLnN0ZG91dEh0bWwgPSBzdGRvdXQgPyBzdGRvdXQucmVwbGFjZShuZXcgUmVnRXhwKCdcXHI/XFxuJywnZycpLCAnPGJyIC8+JykgOiAnJztcbiAgICAgICAgICAgIHRoaXMuc3RkZXJyID0gc3RkZXJyO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkV4ZWN1dGlvbkxvZy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b0h0bWw6IGZ1bmN0aW9uKGluc3RyKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdHJcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JFeGVjdXRpb25Mb2cuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkV4ZWN1dGlvbkxvZyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29tbWFuZF9hcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5leGl0X2NvZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvbXBsZXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3N0X3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9zdF9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19maW5pc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGRvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RkZXJyXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRXhlY3V0aW9uTG9nKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRXhlY3V0aW9uTG9nLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkV4ZWN1dGlvbkxvZy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JFeGVjdXRpb25Mb2cuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkV4ZWN1dGlvbkxvZztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGUnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGVJbnRlcmZhY2UpIHtcbiAgICAgICAgdmFyIEpvYlR5cGUgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHRpdGxlLCB2ZXJzaW9uLCBkZXNjcmlwdGlvbiwgaXNfc3lzdGVtLCBpc19sb25nX3J1bm5pbmcsIGlzX2FjdGl2ZSwgaXNfb3BlcmF0aW9uYWwsIGlzX3BhdXNlZCwgdXNlc19kb2NrZXIsIGRvY2tlcl9wcml2aWxlZ2VkLCBkb2NrZXJfaW1hZ2UsIHByaW9yaXR5LCB0aW1lb3V0LCBtYXhfdHJpZXMsIGNwdXNfcmVxdWlyZWQsIG1lbV9yZXF1aXJlZCwgZGlza19vdXRfY29uc3RfcmVxdWlyZWQsIGRpc2tfb3V0X211bHRfcmVxdWlyZWQsIGljb25fY29kZSwgY3JlYXRlZCwgYXJjaGl2ZWQsIHBhdXNlZCwgbGFzdF9tb2RpZmllZCwgam9iX3R5cGVfaW50ZXJmYWNlKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuaXNfc3lzdGVtID0gaXNfc3lzdGVtO1xuICAgICAgICAgICAgdGhpcy5pc19sb25nX3J1bm5pbmcgPSBpc19sb25nX3J1bm5pbmc7XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuaXNfb3BlcmF0aW9uYWwgPSBpc19vcGVyYXRpb25hbDtcbiAgICAgICAgICAgIHRoaXMuaXNfcGF1c2VkID0gaXNfcGF1c2VkO1xuICAgICAgICAgICAgdGhpcy51c2VzX2RvY2tlciA9IHVzZXNfZG9ja2VyO1xuICAgICAgICAgICAgdGhpcy5kb2NrZXJfcHJpdmlsZWdlZCA9IGRvY2tlcl9wcml2aWxlZ2VkO1xuICAgICAgICAgICAgdGhpcy5kb2NrZXJfaW1hZ2UgPSBkb2NrZXJfaW1hZ2U7XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICAgICAgdGhpcy5tYXhfdHJpZXMgPSBtYXhfdHJpZXM7XG4gICAgICAgICAgICB0aGlzLmNwdXNfcmVxdWlyZWQgPSBjcHVzX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5tZW1fcmVxdWlyZWQgPSBtZW1fcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkID0gZGlza19vdXRfY29uc3RfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X211bHRfcmVxdWlyZWQgPSBkaXNrX291dF9tdWx0X3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5pY29uX2NvZGUgPSBpY29uX2NvZGU7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy5wYXVzZWQgPSBwYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZV9pbnRlcmZhY2UgPSBKb2JUeXBlSW50ZXJmYWNlLnRyYW5zZm9ybWVyKGpvYl90eXBlX2ludGVyZmFjZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnSm9iVHlwZSc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SWNvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmljb25fY29kZSA/ICc8aSBjbGFzcz1cImZhIGZhLWZ3XCI+JiN4JyArIHRoaXMuaWNvbl9jb2RlICsgJzwvaT4nIDogJzxpIGNsYXNzPVwiZmEgZmEtZndcIj4mI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzwvaT4nO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNvbl9jb2RlID8gJyYjeCcgKyB0aGlzLmljb25fY29kZSArICc7JyA6ICcmI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzsnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUaXRsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRpdGxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19zeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfbG9uZ19ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vcGVyYXRpb25hbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXNlc19kb2NrZXIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZG9ja2VyX3ByaXZpbGVnZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZG9ja2VyX2ltYWdlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWF4X3RyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXNfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X211bHRfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWNvbl9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaW50ZXJmYWNlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVEZXRhaWxzJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlSW50ZXJmYWNlLCBKb2JUeXBlRXJyb3JNYXBwaW5nLCBKb2JUeXBlRXJyb3IsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgSm9iVHlwZURldGFpbHMgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2F0ZWdvcnksIGF1dGhvcl9uYW1lLCBhdXRob3JfdXJsLCBpc19zeXN0ZW0sIGlzX2xvbmdfcnVubmluZywgaXNfYWN0aXZlLCBpc19vcGVyYXRpb25hbCwgaXNfcGF1c2VkLCBpY29uX2NvZGUsIHVzZXNfZG9ja2VyLCBkb2NrZXJfcHJpdmlsZWdlZCwgZG9ja2VyX2ltYWdlLCByZXZpc2lvbl9udW0sIHByaW9yaXR5LCB0aW1lb3V0LCBtYXhfc2NoZWR1bGVkLCBtYXhfdHJpZXMsIGNwdXNfcmVxdWlyZWQsIG1lbV9yZXF1aXJlZCwgc2hhcmVkX21lbV9yZXF1aXJlZCwgZGlza19vdXRfY29uc3RfcmVxdWlyZWQsIGRpc2tfb3V0X211bHRfcmVxdWlyZWQsIGNyZWF0ZWQsIGFyY2hpdmVkLCBwYXVzZWQsIGxhc3RfbW9kaWZpZWQsIGpvYl90eXBlX2ludGVyZmFjZSwgZXJyb3JfbWFwcGluZywgdHJpZ2dlcl9ydWxlLCBlcnJvcnMsIGpvYl9jb3VudHNfNmgsIGpvYl9jb3VudHNfMTJoLCBqb2JfY291bnRzXzI0aCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgICAgICAgICB0aGlzLmF1dGhvcl9uYW1lID0gYXV0aG9yX25hbWU7XG4gICAgICAgICAgICB0aGlzLmF1dGhvcl91cmwgPSBhdXRob3JfdXJsO1xuICAgICAgICAgICAgdGhpcy5pc19zeXN0ZW0gPSBpc19zeXN0ZW07XG4gICAgICAgICAgICB0aGlzLmlzX2xvbmdfcnVubmluZyA9IGlzX2xvbmdfcnVubmluZztcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5pc19vcGVyYXRpb25hbCA9IGlzX29wZXJhdGlvbmFsO1xuICAgICAgICAgICAgdGhpcy5pc19wYXVzZWQgPSBpc19wYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmljb25fY29kZSA9IGljb25fY29kZTtcbiAgICAgICAgICAgIHRoaXMudXNlc19kb2NrZXIgPSB1c2VzX2RvY2tlcjtcbiAgICAgICAgICAgIHRoaXMuZG9ja2VyX3ByaXZpbGVnZWQgPSBkb2NrZXJfcHJpdmlsZWdlZDtcbiAgICAgICAgICAgIHRoaXMuZG9ja2VyX2ltYWdlID0gZG9ja2VyX2ltYWdlO1xuICAgICAgICAgICAgdGhpcy5yZXZpc2lvbl9udW0gPSByZXZpc2lvbl9udW07XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICAgICAgdGhpcy5tYXhfc2NoZWR1bGVkID0gbWF4X3NjaGVkdWxlZDtcbiAgICAgICAgICAgIHRoaXMubWF4X3RyaWVzID0gbWF4X3RyaWVzO1xuICAgICAgICAgICAgdGhpcy5jcHVzX3JlcXVpcmVkID0gY3B1c19yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVtX3JlcXVpcmVkID0gbWVtX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5tZW1fcmVxdWlyZWRfZm9ybWF0dGVkID0gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbU1pYihtZW1fcmVxdWlyZWQpO1xuICAgICAgICAgICAgdGhpcy5zaGFyZWRfbWVtX3JlcXVpcmVkID0gc2hhcmVkX21lbV9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuc2hhcmVkX21lbV9yZXF1aXJlZF9mb3JtYXR0ZWQgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHNoYXJlZF9tZW1fcmVxdWlyZWQpO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9jb25zdF9yZXF1aXJlZCA9IGRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9jb25zdF9yZXF1aXJlZF9mb3JtYXR0ZWQgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKGRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkKTtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfbXVsdF9yZXF1aXJlZCA9IGRpc2tfb3V0X211bHRfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy5wYXVzZWQgPSBwYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZV9pbnRlcmZhY2UgPSBqb2JfdHlwZV9pbnRlcmZhY2U7XG4gICAgICAgICAgICB0aGlzLmVycm9yX21hcHBpbmcgPSBKb2JUeXBlRXJyb3JNYXBwaW5nLnRyYW5zZm9ybWVyKGVycm9yX21hcHBpbmcpO1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyX3J1bGUgPSB0cmlnZ2VyX3J1bGU7XG4gICAgICAgICAgICB0aGlzLmVycm9ycyA9IEpvYlR5cGVFcnJvci50cmFuc2Zvcm1lcihlcnJvcnMpO1xuICAgICAgICAgICAgdGhpcy5qb2JfY291bnRzXzZoID0gam9iX2NvdW50c182aDtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50c18xMmggPSBqb2JfY291bnRzXzEyaDtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50c18yNGggPSBqb2JfY291bnRzXzI0aDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlRGV0YWlscy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNvbl9jb2RlID8gJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgdGhpcy5pY29uX2NvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UGVyZm9ybWFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmFpbGVkNkFyciA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzZoLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMTJBcnIgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c18xMmgsIHsgJ3N0YXR1cyc6ICdGQUlMRUQnIH0pLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQyNEFyciA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzI0aCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29tcGxldGVkNiA9IF8uZmluZCh0aGlzLmpvYl9jb3VudHNfNmgsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQ2ID0gXy5zdW0oZmFpbGVkNkFyciwgJ2NvdW50JyksXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsNiA9IGZhaWxlZDZBcnIubGVuZ3RoID4gMCA/IGZhaWxlZDYgKyBjb21wbGV0ZWQ2LmNvdW50IDogY29tcGxldGVkNi5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGU2ID0gdG90YWw2ID09PSAwID8gMCA6IDEwMCAtICgoZmFpbGVkNiAvIHRvdGFsNikgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDEyID0gXy5maW5kKHRoaXMuam9iX2NvdW50c18xMmgsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQxMiA9IF8uc3VtKGZhaWxlZDEyQXJyLCAnY291bnQnKSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWwxMiA9IGZhaWxlZDEyQXJyLmxlbmd0aCA+IDAgPyBmYWlsZWQxMiArIGNvbXBsZXRlZDEyLmNvdW50IDogY29tcGxldGVkMTIuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlMTIgPSB0b3RhbDEyID09PSAwID8gMCA6IDEwMCAtICgoZmFpbGVkMTIgLyB0b3RhbDEyKSAqIDEwMCkudG9GaXhlZCgyKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkMjQgPSBfLmZpbmQodGhpcy5qb2JfY291bnRzXzI0aCwgJ3N0YXR1cycsICdDT01QTEVURUQnKSB8fCB7IGNvdW50OiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDI0ID0gXy5zdW0oZmFpbGVkMjRBcnIsICdjb3VudCcpLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDI0ID0gZmFpbGVkMjRBcnIubGVuZ3RoID4gMCA/IGZhaWxlZDI0ICsgY29tcGxldGVkMjQuY291bnQgOiBjb21wbGV0ZWQyNC5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGUyNCA9IHRvdGFsMjQgPT09IDAgPyAwIDogMTAwIC0gKChmYWlsZWQyNCAvIHRvdGFsMjQpICogMTAwKS50b0ZpeGVkKDIpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaG91cjY6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkNi5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbDZcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjEyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXRlOiBzdWNjZXNzUmF0ZTEyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkOiBmYWlsZWQxMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkMTIuY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWwxMlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBob3VyMjQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlMjQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWQ6IGZhaWxlZDI0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiBjb21wbGV0ZWQyNC5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbDI0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZhaWx1cmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZhaWxlZDYgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c182aCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDZWYWx1ZXMgPSBfLnZhbHVlcyhfLmdyb3VwQnkoZmFpbGVkNiwgJ2NhdGVnb3J5JykpLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQxMiA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzEyaCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDEyVmFsdWVzID0gXy52YWx1ZXMoXy5ncm91cEJ5KGZhaWxlZDEyLCAnY2F0ZWdvcnknKSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDI0ID0gXy53aGVyZSh0aGlzLmpvYl9jb3VudHNfMjRoLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMjRWYWx1ZXMgPSBfLnZhbHVlcyhfLmdyb3VwQnkoZmFpbGVkMjQsICdjYXRlZ29yeScpKTtcblxuICAgICAgICAgICAgICAgIHZhciBnZXRGYWlsdXJlQ291bnRzID0gZnVuY3Rpb24gKGNhdGVnb3JpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcmllcywgZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcnksIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnIucHVzaCh7IHN0YXR1czogdmFsLmNhdGVnb3J5LCBjb3VudDogdmFsLmNvdW50IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuQXJyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBob3VyNjogZ2V0RmFpbHVyZUNvdW50cyhmYWlsZWQ2VmFsdWVzKSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjEyOiBnZXRGYWlsdXJlQ291bnRzKGZhaWxlZDEyVmFsdWVzKSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjI0OiBnZXRGYWlsdXJlQ291bnRzKGZhaWxlZDI0VmFsdWVzKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVEZXRhaWxzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogY2hhbmdlIHByb3BlcnR5IHJldHVybmVkIGJ5IEFQSSBmcm9tIFwiaW50ZXJmYWNlXCIgdG8gXCJqb2JfdHlwZV9pbnRlcmZhY2VcIiBiZWNhdXNlIFwiaW50ZXJmYWNlXCIgaXMgYSByZXNlcnZlZCB3b3JkIGluIEpTXG4gICAgICAgICAgICAgICAgdmFyIGpvYlR5cGVJbnRlcmZhY2UgPSBkYXRhLmludGVyZmFjZSA/IGRhdGEuaW50ZXJmYWNlIDogZGF0YS5qb2JfdHlwZV9pbnRlcmZhY2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRGV0YWlscyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXV0aG9yX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXV0aG9yX3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19zeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfbG9uZ19ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vcGVyYXRpb25hbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWNvbl9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZXNfZG9ja2VyLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY2tlcl9wcml2aWxlZ2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY2tlcl9pbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXZpc2lvbl9udW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tYXhfc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zaGFyZWRfbWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X211bHRfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgam9iVHlwZUludGVyZmFjZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcl9tYXBwaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRyaWdnZXJfcnVsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcnMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvdW50c182aCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfY291bnRzXzEyaCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfY291bnRzXzI0aFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVEZXRhaWxzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZURldGFpbHMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZURldGFpbHMuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVEZXRhaWxzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlRGV0YWlscztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVFcnJvcicsIGZ1bmN0aW9uIChtb21lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBKb2JUeXBlRXJyb3IgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2F0ZWdvcnksIGNyZWF0ZWQsIGxhc3RfbW9kaWZpZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IGNyZWF0ZWQgPyBtb21lbnQudXRjKGNyZWF0ZWQpLnRvSVNPU3RyaW5nKCkgOiBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBsYXN0X21vZGlmaWVkID8gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS50b0lTT1N0cmluZygpIDogbGFzdF9tb2RpZmllZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlRXJyb3IucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVFcnJvci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUVycm9yKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUVycm9yKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZUVycm9yLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYlR5cGVFcnJvci5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlRXJyb3IuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVFcnJvcjtcbiAgICB9KVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIFxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVFcnJvck1hcHBpbmcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBKb2JUeXBlRXJyb3JNYXBwaW5nID0gZnVuY3Rpb24gKHZlcnNpb24sIGV4aXRfY29kZXMpIHtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLmV4aXRfY29kZXMgPSBleGl0X2NvZGVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGVFcnJvck1hcHBpbmcucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVFcnJvck1hcHBpbmcuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVFcnJvck1hcHBpbmcoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5leGl0X2NvZGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUVycm9yTWFwcGluZygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVFcnJvck1hcHBpbmcudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZUVycm9yTWFwcGluZy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlRXJyb3JNYXBwaW5nLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlRXJyb3JNYXBwaW5nO1xuICAgIH0pXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iVHlwZUlucHV0RGF0YScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgSm9iVHlwZUlucHV0RGF0YSA9IGZ1bmN0aW9uIChtZWRpYV90eXBlcywgcmVxdWlyZWQsIHR5cGUsIG5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubWVkaWFfdHlwZXMgPSBtZWRpYV90eXBlcztcbiAgICAgICAgICAgIHRoaXMucmVxdWlyZWQgPSByZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGVJbnB1dERhdGEucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVJbnB1dERhdGEuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVJbnB1dERhdGEoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVkaWFfdHlwZXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUlucHV0RGF0YSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVJbnB1dERhdGEudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZUlucHV0RGF0YS5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iVHlwZUlucHV0RGF0YS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iVHlwZUlucHV0RGF0YTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlSW50ZXJmYWNlJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlSW5wdXREYXRhLCBKb2JUeXBlT3V0cHV0RGF0YSkge1xuICAgICAgICB2YXIgSm9iVHlwZUludGVyZmFjZSA9IGZ1bmN0aW9uICh2ZXJzaW9uLCBjb21tYW5kLCBjb21tYW5kX2FyZ3VtZW50cywgaW5wdXRfZGF0YSwgb3V0cHV0X2RhdGEpIHtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLmNvbW1hbmQgPSBjb21tYW5kO1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kX2FyZ3VtZW50cyA9IGNvbW1hbmRfYXJndW1lbnRzO1xuICAgICAgICAgICAgdGhpcy5pbnB1dF9kYXRhID0gSm9iVHlwZUlucHV0RGF0YS50cmFuc2Zvcm1lcihpbnB1dF9kYXRhKTtcbiAgICAgICAgICAgIHRoaXMub3V0cHV0X2RhdGEgPSBKb2JUeXBlT3V0cHV0RGF0YS50cmFuc2Zvcm1lcihvdXRwdXRfZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZUludGVyZmFjZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNvbkNvZGUgPyAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyB0aGlzLmljb25Db2RlICsgJzwvaT4nIDogJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzwvaT4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlSW50ZXJmYWNlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlSW50ZXJmYWNlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29tbWFuZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21tYW5kX2FyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbnB1dF9kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm91dHB1dF9kYXRhXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUludGVyZmFjZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVJbnRlcmZhY2UudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZUludGVyZmFjZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlSW50ZXJmYWNlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlSW50ZXJmYWNlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iVHlwZU91dHB1dERhdGEnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBKb2JUeXBlT3V0cHV0RGF0YSA9IGZ1bmN0aW9uIChuYW1lLCB0eXBlLCByZXF1aXJlZCwgbWVkaWFfdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB0aGlzLnJlcXVpcmVkID0gcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLm1lZGlhX3R5cGUgPSBtZWRpYV90eXBlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGVPdXRwdXREYXRhLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlT3V0cHV0RGF0YS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZU91dHB1dERhdGEoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lZGlhX3R5cGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlT3V0cHV0RGF0YSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVPdXRwdXREYXRhLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYlR5cGVPdXRwdXREYXRhLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVPdXRwdXREYXRhLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlT3V0cHV0RGF0YTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlU3RhdHVzJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlLCBKb2JFeGVjdXRpb24pIHtcbiAgICAgICAgdmFyIEpvYlR5cGVTdGF0dXMgPSBmdW5jdGlvbiAoam9iX3R5cGUsIGpvYl9jb3VudHMpIHtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50cyA9IGpvYl9jb3VudHM7XG4gICAgICAgICAgICB0aGlzLmhhc19ydW5uaW5nID0gXy5maW5kKGpvYl9jb3VudHMsICdzdGF0dXMnLCAnUlVOTklORycpO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IHRoaXMuZ2V0UGVyZm9ybWFuY2UoKS5yYXRlRGVzY3JpcHRpb247XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZVN0YXR1cy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnSm9iVHlwZVN0YXR1cyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UGVyZm9ybWFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmFpbGVkQXJyID0gXy5zb3J0QnlPcmRlcihfLmZpbHRlcih0aGlzLmpvYl9jb3VudHMsIHsgc3RhdHVzOiAnRkFJTEVEJyB9KSwgWydjb3VudCddLCBbJ2Rlc2MnXSksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZCA9IF8uZmluZCh0aGlzLmpvYl9jb3VudHMsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQgPSBfLnN1bShmYWlsZWRBcnIsICdjb3VudCcpLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWRDYXRlZ29yeSA9IGZhaWxlZEFyci5sZW5ndGggPiAwID8gZmFpbGVkQXJyWzBdLmNhdGVnb3J5IDogJycsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsID0gZmFpbGVkQXJyLmxlbmd0aCA+IDAgPyBmYWlsZWQgKyBjb21wbGV0ZWQuY291bnQgOiBjb21wbGV0ZWQuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlID0gdG90YWwgPT09IDAgPyAwIDogMTAwIC0gKChmYWlsZWQgLyB0b3RhbCkgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnc3VjY2Vzcyc7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzc1JhdGUgPD0gMzAgJiYgdG90YWwgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnZXJyb3InO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VjY2Vzc1JhdGUgPiAzMCAmJiBzdWNjZXNzUmF0ZSA8PSA2MCAmJiB0b3RhbCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGVEZXNjcmlwdGlvbiA9ICd3YXJuaW5nJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRvdGFsID09PSAwICYmICF0aGlzLmhhc19ydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnel9pbmFjdGl2ZSc7IC8vIHByZXBlbmQgd2l0aCAnel8nIGZvciBvcmRlcmluZyBwdXJwb3Nlc1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlLFxuICAgICAgICAgICAgICAgICAgICByYXRlRGVzY3JpcHRpb246IHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWRDYXRlZ29yeTogZmFpbGVkQ2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJ1bm5pbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXy5maW5kKHRoaXMuam9iX2NvdW50cywgJ3N0YXR1cycsICdSVU5OSU5HJykgfHwgeyBjb3VudDogMCB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZhaWx1cmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZhaWxlZCA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KTtcblxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChmYWlsZWQsIGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IF8uZmluZChzY2FsZUNvbmZpZy5lcnJvckNhdGVnb3JpZXMsIHsgbmFtZTogZi5jYXRlZ29yeSB9KTtcbiAgICAgICAgICAgICAgICAgICAgZi5vcmRlciA9IGNhdGVnb3J5ID8gY2F0ZWdvcnkub3JkZXIgOiAnJztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBmYWlsZWRWYWx1ZXMgPSBfLnZhbHVlcyhfLmdyb3VwQnkoZmFpbGVkLCAnb3JkZXInKSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZ2V0RmFpbHVyZUNvdW50cyA9IGZ1bmN0aW9uIChjYXRlZ29yaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5BcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNhdGVnb3JpZXMsIGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNhdGVnb3J5LCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuQXJyLnB1c2goeyBzdGF0dXM6IHZhbC5jYXRlZ29yeSwgY291bnQ6IHZhbC5jb3VudCwgb3JkZXI6IHZhbC5vcmRlciB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uc29ydEJ5T3JkZXIocmV0dXJuQXJyLCBbJ29yZGVyJ10sIFsnZGVzYyddKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldEZhaWx1cmVDb3VudHMoZmFpbGVkVmFsdWVzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRmlsbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSB0aGlzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cy5yYXRlRGVzY3JpcHRpb24gPT09ICd6X2luYWN0aXZlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyYXlfZGFyaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsQWN0aXZpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcnVubmluZyA9IHRoaXMuZ2V0UnVubmluZygpO1xuICAgICAgICAgICAgICAgIGlmIChydW5uaW5nLmNvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyYjeCcgKyBzY2FsZUNvbmZpZy5hY3Rpdml0eUljb25Db2RlICsgJzsnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEFjdGl2aXR5VG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSdW5uaW5nKCkuY291bnQgPiAwID8gdGhpcy5nZXRSdW5uaW5nKCkuY291bnQgOiAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB0aGlzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdGYWlsZWQ6ICcgKyAocGVyZm9ybWFuY2UuZmFpbGVkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB0aGlzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBlcmZvcm1hbmNlLmNvbXBsZXRlZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsUGF1c2VSZXN1bWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEZhaWx1cmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8ubWFwKHRoaXMuZ2V0RmFpbHVyZXMoKSwgJ3N0YXR1cycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlU3RhdHVzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlU3RhdHVzKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9jb3VudHNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlU3RhdHVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZVN0YXR1cy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlU3RhdHVzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVTdGF0dXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVTdGF0dXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpe1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1Byb2R1Y3QnLCBmdW5jdGlvbiAoSm9iVHlwZSwgc2NhbGVTZXJ2aWNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgUHJvZHVjdCA9IGZ1bmN0aW9uIChpZCwgd29ya3NwYWNlLCBmaWxlX25hbWUsIG1lZGlhX3R5cGUsIGZpbGVfc2l6ZSwgZGF0YV90eXBlLCBpc19kZWxldGVkLCB1dWlkLCB1cmwsIGNyZWF0ZWQsIGRlbGV0ZWQsIGRhdGFfc3RhcnRlZCwgZGF0YV9lbmRlZCwgZ2VvbWV0cnksIGNlbnRlcl9wb2ludCwgbWV0YV9kYXRhLCBjb3VudHJpZXMsIGxhc3RfbW9kaWZpZWQsIGlzX29wZXJhdGlvbmFsLCBpc19wdWJsaXNoZWQsIHB1Ymxpc2hlZCwgdW5wdWJsaXNoZWQsIGpvYl90eXBlLCBqb2IsIGpvYl9leGUsIHVwZGF0ZSwgc291cmNlX2ZpbGVzKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLndvcmtzcGFjZSA9IHdvcmtzcGFjZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9uYW1lID0gZmlsZV9uYW1lO1xuICAgICAgICAgICAgdGhpcy5tZWRpYV90eXBlID0gbWVkaWFfdHlwZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9zaXplID0gZmlsZV9zaXplO1xuICAgICAgICAgICAgdGhpcy5maWxlX3NpemVfcmVhZGFibGUgPSB0aGlzLmdldFJlYWRhYmxlRmlsZVNpemUoKTtcbiAgICAgICAgICAgIHRoaXMuZGF0YV90eXBlID0gZGF0YV90eXBlO1xuICAgICAgICAgICAgdGhpcy5pc19kZWxldGVkID0gaXNfZGVsZXRlZDtcbiAgICAgICAgICAgIHRoaXMudXVpZCA9IHV1aWQ7XG4gICAgICAgICAgICB0aGlzLnVybCA9IHVybDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gY3JlYXRlZCA/IG1vbWVudC51dGMoY3JlYXRlZCkudG9JU09TdHJpbmcoKSA6IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmRlbGV0ZWQgPSBkZWxldGVkO1xuICAgICAgICAgICAgdGhpcy5kYXRhX3N0YXJ0ZWQgPSBkYXRhX3N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLmRhdGFfZW5kZWQgPSBkYXRhX2VuZGVkO1xuICAgICAgICAgICAgdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5O1xuICAgICAgICAgICAgdGhpcy5jZW50ZXJfcG9pbnQgPSBjZW50ZXJfcG9pbnQ7XG4gICAgICAgICAgICB0aGlzLm1ldGFfZGF0YSA9IG1ldGFfZGF0YTtcbiAgICAgICAgICAgIHRoaXMuY291bnRyaWVzID0gY291bnRyaWVzO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBsYXN0X21vZGlmaWVkID8gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS50b0lTT1N0cmluZygpIDogbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuaXNfb3BlcmF0aW9uYWwgPSBpc19vcGVyYXRpb25hbDtcbiAgICAgICAgICAgIHRoaXMuaXNfb3BlcmF0aW9uYWxfbGFiZWwgPSBpc19vcGVyYXRpb25hbCA/ICdPcGVyYXRpb25hbCcgOiAnUiZhbXA7RCc7XG4gICAgICAgICAgICB0aGlzLmlzX3B1Ymxpc2hlZCA9IGlzX3B1Ymxpc2hlZDtcbiAgICAgICAgICAgIHRoaXMucHVibGlzaGVkID0gcHVibGlzaGVkO1xuICAgICAgICAgICAgdGhpcy51bnB1Ymxpc2hlZCA9IHVucHVibGlzaGVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5qb2IgPSBqb2I7XG4gICAgICAgICAgICB0aGlzLmpvYl9leGUgPSBqb2JfZXhlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUgPSB1cGRhdGU7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZV9maWxlcyA9IHNvdXJjZV9maWxlcztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBQcm9kdWN0LnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGModGhpcy5sYXN0X21vZGlmaWVkKS5kaWZmKG1vbWVudC51dGModGhpcy5jcmVhdGVkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UmVhZGFibGVGaWxlU2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXModGhpcy5maWxlX3NpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBQcm9kdWN0LmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9kdWN0KFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLndvcmtzcGFjZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVkaWFfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX3NpemUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YV90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2RlbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXVpZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZWxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRhdGFfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhX2VuZGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmdlb21ldHJ5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNlbnRlcl9wb2ludCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZXRhX2RhdGEsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY291bnRyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfb3BlcmF0aW9uYWwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfcHVibGlzaGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1Ymxpc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51bnB1Ymxpc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2V4ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51cGRhdGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc291cmNlX2ZpbGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvZHVjdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFByb2R1Y3QudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUHJvZHVjdC5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQcm9kdWN0LmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBQcm9kdWN0O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUnVubmluZ0pvYicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBKb2JUeXBlKSB7XG4gICAgICAgIHZhciBSdW5uaW5nSm9iID0gZnVuY3Rpb24gKGNvdW50LCBsb25nZXN0X3J1bm5pbmcsIGpvYl90eXBlKSB7XG4gICAgICAgICAgICB0aGlzLmNvdW50ID0gY291bnQ7XG4gICAgICAgICAgICB0aGlzLmxvbmdlc3RfcnVubmluZyA9IGxvbmdlc3RfcnVubmluZztcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBSdW5uaW5nSm9iLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmxvbmdlc3RfcnVubmluZywgbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IHRoaXMuam9iX3R5cGUuaWNvbl9jb2RlID8gJzxpIGNsYXNzPVwiZmEgZmEtZndcIj4mI3gnICsgdGhpcy5qb2JfdHlwZS5pY29uX2NvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYSBmYS1md1wiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGljb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJ1bm5pbmdKb2IuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJ1bm5pbmdKb2IoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubG9uZ2VzdF9ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUnVubmluZ0pvYigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJ1bm5pbmdKb2IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUnVubmluZ0pvYi5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSdW5uaW5nSm9iLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSdW5uaW5nSm9iO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1N5c3RlbUZhaWx1cmUnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgU3lzdGVtRmFpbHVyZSA9IGZ1bmN0aW9uIChjb3VudCwgam9iX3R5cGVfbmFtZSwgam9iX3R5cGVfdmVyc2lvbiwgZXJyb3JfbmFtZSwgZmlyc3RfZXJyb3IsIGxhc3RfZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfbmFtZSA9IGpvYl90eXBlX25hbWU7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlX3ZlcnNpb24gPSBqb2JfdHlwZV92ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy5lcnJvcl9uYW1lID0gZXJyb3JfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RfZXJyb3IgPSBmaXJzdF9lcnJvcjtcbiAgICAgICAgICAgIHRoaXMubGFzdF9lcnJvciA9IGxhc3RfZXJyb3I7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgU3lzdGVtRmFpbHVyZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24odGhpcy5maXJzdF9lcnJvciwgdGhpcy5sYXN0X2Vycm9yKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZ0pvYlR5cGUgPSBfLmZpbmQoc2NhbGVDb25maWcuam9iVHlwZXMsICd0aXRsZScsIHRoaXMuam9iX3R5cGVfbmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ0pvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ0pvYlR5cGUuaWNvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTeXN0ZW1GYWlsdXJlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTeXN0ZW1GYWlsdXJlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVfdmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcl9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpcnN0X2Vycm9yLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfZXJyb3JcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTeXN0ZW1GYWlsdXJlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3lzdGVtRmFpbHVyZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChTeXN0ZW1GYWlsdXJlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN5c3RlbUZhaWx1cmUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN5c3RlbUZhaWx1cmU7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdsb2FkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgbmF2U2VydmljZSwgbG9hZFNlcnZpY2UsIHVpR3JpZENvbnN0YW50cywgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UsIFF1ZXVlU3RhdHVzLCBncmlkRmFjdG9yeSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnF1ZXVlU3RhdHVzRXJyb3IgPSBudWxsO1xuICAgICAgICB2bS5xdWV1ZVN0YXR1c0Vycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgdm0udG90YWxRdWV1ZWQgPSAwO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmxvYWQ7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2xvYWQvcXVldWVkJyk7XG4gICAgICAgIFxuICAgICAgICB2YXIgam9ic1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JzUGFyYW1zKCk7XG5cbiAgICAgICAgdm0uZ2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBsb2FkU2VydmljZS5nZXRRdWV1ZVN0YXR1cyhwYWdlTnVtYmVyIC0gMSwgcGFnZVNpemUpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3RGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RGF0YS5wdXNoKGRhdGEuam9ic1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBuZXdEYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IG5ld0RhdGEubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBuZXdEYXRhO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdm0uc3RhdHVzID0gJ1VuYWJsZSB0byBsb2FkIHF1ZXVlIHN0YXR1czogJyArIGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih2bS5zdGF0dXMpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZW5hYmxlU29ydGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnam9iX3R5cGUudGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0pvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxzcGFuIG5nLWJpbmQtaHRtbD1cInJvdy5lbnRpdHkuam9iX3R5cGUuZ2V0SWNvbigpXCI+PC9zcGFuPiB7eyByb3cuZW50aXR5LmpvYl90eXBlLnRpdGxlIH19PC9kaXY+J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgeyBmaWVsZDogJ2pvYl90eXBlLnZlcnNpb24nLCBkaXNwbGF5TmFtZTogJ1ZlcnNpb24nLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH0sXG4gICAgICAgICAgICAgICAgeyBmaWVsZDogJ2hpZ2hlc3RfcHJpb3JpdHknLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ2xvbmdlc3RRdWV1ZWQnLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0R1cmF0aW9uIG9mIExvbmdlc3QgUXVldWVkIEpvYicsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1yaWdodFwiPnt7IHJvdy5lbnRpdHkuZ2V0RHVyYXRpb24oKSB9fTwvZGl2PidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdjb3VudCcsIGVuYWJsZUZpbHRlcmluZzogZmFsc2UgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgICAgICB2bS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgICAgICBncmlkQXBpLnNlbGVjdGlvbi5vbi5yb3dTZWxlY3Rpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9ic1BhcmFtcyh7am9iX3R5cGVfaWQ6IHJvdy5lbnRpdHkuam9iX3R5cGUuaWQsIHN0YXR1czogJ1FVRVVFRCcsIHBhZ2U6IGpvYnNQYXJhbXMucGFnZSwgcGFnZV9zaXplOiBqb2JzUGFyYW1zLnBhZ2Vfc2l6ZSwgb3JkZXI6IGpvYnNQYXJhbXMub3JkZXJ9KTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5nZXRQYWdlKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIGxvYWRTZXJ2aWNlLmdldFF1ZXVlU3RhdHVzKDAsIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IHJlc3VsdC5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSByZXN1bHQucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSByZXN1bHQucmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IHJlc3VsdC5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgdm0udG90YWxRdWV1ZWQgPSBfLnN1bShyZXN1bHQucmVzdWx0cywgJ2NvdW50Jyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdxdWV1ZSBzdGF0dXMgdXBkYXRlZCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzVGV4dCAmJiByZXN1bHQuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnF1ZXVlU3RhdHVzRXJyb3JTdGF0dXMgPSByZXN1bHQuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5xdWV1ZVN0YXR1c0Vycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBxdWV1ZSBzdGF0dXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbG9hZCcpO1xuICAgICAgICB9O1xuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdsb2FkRGVwdGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBuYXZTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5sb2FkO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdsb2FkL2RlcHRoJyk7XG5cbiAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbG9hZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3F1ZXVlUnVubmluZ0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIG5hdlNlcnZpY2UsIGpvYlNlcnZpY2UsIGdyaWRGYWN0b3J5LCB1aUdyaWRDb25zdGFudHMsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0ucnVubmluZ0pvYnNFcnJvciA9IG51bGw7XG4gICAgICAgIHZtLnJ1bm5pbmdKb2JzRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS50b3RhbFJ1bm5pbmcgPSAwO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmxvYWQ7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2xvYWQvcnVubmluZycpO1xuXG4gICAgICAgIHZhciBqb2JzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldEpvYnNQYXJhbXMoKTtcblxuICAgICAgICB2bS5nZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKXtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgam9iU2VydmljZS5nZXRSdW5uaW5nSm9ic09uY2UocGFnZU51bWJlciAtIDEsIHBhZ2VTaXplKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld0RhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICBuZXdEYXRhLnB1c2goZGF0YS5yZXN1bHRzW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IG5ld0RhdGEubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnZpcnR1YWxpemF0aW9uVGhyZXNob2xkID0gbmV3RGF0YS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IG5ld0RhdGE7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB2bS5zdGF0dXMgPSAnVW5hYmxlIHRvIGxvYWQgcXVldWUgcnVubmluZyBzdGF0dXM6ICcgKyBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3Iodm0uc3RhdHVzKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmVuYWJsZVNvcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ3RpdGxlJyxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48c3BhbiBuZy1iaW5kLWh0bWw9XCJyb3cuZW50aXR5LmdldEljb24oKVwiPjwvc3Bhbj4ge3sgcm93LmVudGl0eS5qb2JfdHlwZS50aXRsZSB9fTwvZGl2PidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtmaWVsZDogJ2pvYl90eXBlLnZlcnNpb24nLCBkaXNwbGF5TmFtZTogJ1ZlcnNpb24nLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlfSxcbiAgICAgICAgICAgICAgICB7ZmllbGQ6ICdjb3VudCcsIGRpc3BsYXlOYW1lOiAnTnVtYmVyIG9mIEpvYnMnLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnbG9uZ2VzdFJ1bm5pbmcnLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0R1cmF0aW9uIG9mIExvbmdlc3QgUnVubmluZyBKb2InLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzIHRleHQtcmlnaHRcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgICAgIC8vIHNldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAgICAgdm0uZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICAgICAgZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYnNQYXJhbXMoe2pvYl90eXBlX2lkOiByb3cuZW50aXR5LmpvYl90eXBlLmlkLCBzdGF0dXM6ICdSVU5OSU5HJywgcGFnZTogam9ic1BhcmFtcy5wYWdlLCBwYWdlX3NpemU6IGpvYnNQYXJhbXMucGFnZV9zaXplLCBvcmRlcjogam9ic1BhcmFtcy5vcmRlcn0pO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2pvYnMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdldFBhZ2UoY3VycmVudFBhZ2UsIHBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0UnVubmluZ0pvYnMoMCwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS50b3RhbFJ1bm5pbmcgPSBfLnN1bShkYXRhLnJlc3VsdHMsICdjb3VudCcpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncnVubmluZyBqb2JzIHVwZGF0ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXNUZXh0ICYmIGRhdGEuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJ1bm5pbmdKb2JzRXJyb3JTdGF0dXMgPSBkYXRhLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdm0ucnVubmluZ0pvYnNFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgcnVubmluZyBqb2JzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbG9hZCcpO1xuICAgICAgICB9O1xuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdqb2JFeGVjdXRpb25TZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBzdGF0ZVNlcnZpY2UsIHBvbGxlciwgc2NhbGVDb25maWcsIEpvYkV4ZWN1dGlvbiwgSm9iRXhlY3V0aW9uTG9nKSB7XG5cbiAgICAgICAgdmFyIGdldEpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIsIHN0YXR1cywgam9iX3R5cGVfaWQsIGpvYl90eXBlX25hbWUsIGpvYl90eXBlX2NhdGVnb3J5LCBub2RlX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyLFxuICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBqb2JfdHlwZV9pZCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9uYW1lOiBqb2JfdHlwZV9uYW1lLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2NhdGVnb3J5OiBqb2JfdHlwZV9jYXRlZ29yeSxcbiAgICAgICAgICAgICAgICBub2RlX2lkOiBub2RlX2lkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRKb2JFeGVjdXRpb25zOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYkV4ZWN1dGlvbnNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItZXhlY3V0aW9ucycpICsgJ2pvYi1leGVjdXRpb25zLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JFeGVjdXRpb24udHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JFeGVjdXRpb25EZXRhaWxzOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItZXhlY3V0aW9ucycpICsgJ2pvYi1leGVjdXRpb25zLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoSm9iRXhlY3V0aW9uLnRyYW5zZm9ybWVyKGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TG9nT25jZTogZnVuY3Rpb24oZXhlY0lkKXtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItZXhlY3V0aW9ucycpICsgJ2pvYi1leGVjdXRpb25zLycgKyBleGVjSWQgKyAnL2xvZ3MvY29tYmluZWQvJ1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRMb2c6IGZ1bmN0aW9uKGV4ZWNJZCl7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHVybCB8fCBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi1leGVjdXRpb25zJykgKyAnam9iLWV4ZWN1dGlvbnMvJyArIGV4ZWNJZCArICcvbG9ncy9jb21iaW5lZC8nO1xuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHZpZXcuIFNpbmNlIGEgcHJvbWlzZSBjYW4gb25seSBiZSByZXNvbHZlZCBvciByZWplY3RlZCBvbmNlIGJ1dCB3ZSB3YW50XG4gICAgICAgICAgICAgICAgLy8gdG8ga2VlcCB0cmFjayBvZiBhbGwgcmVxdWVzdHMsIHBvbGxlciBzZXJ2aWNlIHVzZXMgdGhlIG5vdGlmeUNhbGxiYWNrLiBCeSBkZWZhdWx0XG4gICAgICAgICAgICAgICAgLy8gcG9sbGVyIG9ubHkgZ2V0cyBub3RpZmllZCBvZiBzdWNjZXNzIHJlc3BvbnNlcy5cbiAgICAgICAgICAgICAgICB2YXIgam9iRXhlY3V0aW9uTG9nUmVzb3VyY2UgPSAkcmVzb3VyY2UodXJsLHt9LHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0OntcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDonR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyY2VwdG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzcG9uc2UucmVzb3VyY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC4kc3RhdHVzID0gcmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuJHN0YXR1c1RleHQgPSByZXNwb25zZS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGpvYkV4ZWN1dGlvbkxvZ1BvbGxlciA9IHBvbGxlci5nZXQoam9iRXhlY3V0aW9uTG9nUmVzb3VyY2UsIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0JyxcbiAgICAgICAgICAgICAgICAgICAgZGVsYXk6IHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9iRXhlY3V0aW9uTG9nLFxuICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHNBcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlU2VydmljZS5nZXRMb2dBcmdzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JFeGVjdXRpb25Mb2dQb2xsZXIoam9iRXhlY3V0aW9uTG9nUG9sbGVyKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBqb2JFeGVjdXRpb25Mb2dQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlc3VsdC5leGVjdXRpb25fbG9nID0gSm9iRXhlY3V0aW9uTG9nLnRyYW5zZm9ybWVyKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZihyZXN1bHQuZXhlY3V0aW9uX2xvZy5zdGF0dXMgPT09ICdDT01QTEVURUQnIHx8IHJlc3VsdC5leGVjdXRpb25fbG9nLnN0YXR1cyA9PT0gJ0ZBSUxFRCcpe1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIGpvYkV4ZWN1dGlvbkxvZ1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgam9iRXhlY3V0aW9uTG9nUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnam9iU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZywgSm9iLCBKb2JEZXRhaWxzLCBSdW5uaW5nSm9iLCBwb2xsZXIsIHBvbGxlckZhY3RvcnkpIHtcblxuICAgICAgICB2YXIgZ2V0Sm9ic1BhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBvcmRlciwgc3RhdHVzLCBqb2JfdHlwZV9pZCwgam9iX3R5cGVfbmFtZSwgam9iX3R5cGVfY2F0ZWdvcnksIHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlcixcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1cyxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iX3R5cGVfaWQsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZTogam9iX3R5cGVfbmFtZSxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9jYXRlZ29yeTogam9iX3R5cGVfY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYlVwZGF0ZURhdGEgPSBmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRKb2JzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYnNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMudXJsID0gcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYnMnKSArICdqb2JzLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgam9ic1Jlc291cmNlID0gJHJlc291cmNlKHBhcmFtcy51cmwsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIGpvYnNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihqb2JzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9icyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gam9ic1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2IudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYnNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYnNPbmNlOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYnNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYnMnKSArICdqb2JzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2IudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYkNvdW50c0J5U3RhdHVzOiBmdW5jdGlvbiAoaG91cikge1xuICAgICAgICAgICAgICAgIGhvdXIgPSBob3VyIHx8IDM7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuZ2V0Sm9iQ291bnRzQnlTdGF0dXMoaG91cikpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JEZXRhaWw6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2JzJykgKyAnam9icy8nICsgaWQgKyAnLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKEpvYkRldGFpbHMudHJhbnNmb3JtZXIoZGF0YSkpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSdW5uaW5nSm9iczogZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZU51bWJlcjogcGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgcnVubmluZ0pvYnNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi10eXBlcycpICsgJ2pvYi10eXBlcy9ydW5uaW5nLycsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIHJ1bm5pbmdKb2JzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIocnVubmluZ0pvYnNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5ydW5uaW5nSm9icyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcnVubmluZ0pvYnNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gUnVubmluZ0pvYi50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcnVubmluZ0pvYnNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJ1bm5pbmdKb2JzT25jZTogZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZU51bWJlcjogcGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvcnVubmluZy8nLCBwYXJhbXMpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gUnVubmluZ0pvYi50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZUpvYjogZnVuY3Rpb24gKGlkLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEgfHwgZ2V0Sm9iVXBkYXRlRGF0YSgpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYnMnKSArICdqb2JzLycgKyBpZCArICcvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnam9iVHlwZVNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkcmVzb3VyY2UsIHBvbGxlciwgcG9sbGVyRmFjdG9yeSwgc2NhbGVDb25maWcsIGpvYlNlcnZpY2UsIEpvYlR5cGUsIEpvYlR5cGVEZXRhaWxzLCBKb2JUeXBlU3RhdHVzKSB7XG4gICAgICAgIC8qdmFyIHRvdGFsSm9iVHlwZXMgPSA1O1xuXG4gICAgICAgIHZhciBnZXRUb3RhbEpvYlR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRvdGFsSm9iVHlwZXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNldFRvdGFsSm9iVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0b3RhbEpvYlR5cGVzID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDIwIC0gMSArIDEpKSArIDE7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2V0VG90YWxKb2JUeXBlcygpO1xuICAgICAgICB9LCAzMTAwKTsqL1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG5hbWUsIGNhdGVnb3J5LCBvcmRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplID8gcGFnZV9zaXplIDogMTAwMCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIgPyBvcmRlciA6IFsndGl0bGUnLCAndmVyc2lvbiddXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlU3RhdHVzUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSA/IHBhZ2Vfc2l6ZSA6IDEwMDAsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldEpvYlR5cGVzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYlR5cGVQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICAvLyB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIC8vICAgICBvcmRlcjogb3JkZXIgfHwgWyduYW1lJywndmVyc2lvbiddXG4gICAgICAgICAgICAgICAgLy8gfTtcblxuICAgICAgICAgICAgICAgIHZhciBqb2JUeXBlc1Jlc291cmNlID0gJHJlc291cmNlKHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9iLXR5cGVzJykgKyAnam9iLXR5cGVzLycsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIGpvYlR5cGVzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIoam9iVHlwZXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5qb2JUeXBlcyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gam9iVHlwZXNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLyp2YXIgcmV0dXJuUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXNvbHZlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZXM6IFtdXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBnZXRUb3RhbEpvYlR5cGVzKCk7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblJlc3VsdC5qb2JfdHlwZXMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpc19zeXN0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGF1c2VkXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRpc2tcIjogNjQuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZG9ja2VyX2ltYWdlXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFyY2hpdmVkXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInVzZXNfZG9ja2VyXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcmlvcml0eVwiOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmVyc2lvblwiOiBcIjEuMFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpY29uX2NvZGVcIjogc2NhbGVDb25maWcuam9iVHlwZXNbaSAtIDFdLmNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IFwiSW5nZXN0cyBhIHNvdXJjZSBmaWxlIGludG8gYSB3b3Jrc3BhY2VcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVtXCI6IDY0LjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlzX2FjdGl2ZVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcHVzXCI6IDEuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFzdF9tb2RpZmllZFwiOiBcIjIwMTUtMDMtMTFUMDA6MDA6MDBaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1heF90cmllc1wiOiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpc19wYXVzZWRcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogc2NhbGVDb25maWcuam9iVHlwZXNbaSAtIDFdLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkXCI6IFwiMjAxNS0wMy0xMVQwMDowMDowMFpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGltZW91dFwiOiAxODAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpc19sb25nX3J1bm5pbmdcIjogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJldHVyblJlc3VsdDsqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYlR5cGVzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iVHlwZXNPbmNlOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYlR5cGVQYXJhbXMoKTtcblxuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi10eXBlcycpICsgJ2pvYi10eXBlcy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSm9iVHlwZS50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYlR5cGVTdGF0dXM6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0Sm9iVHlwZVN0YXR1c1BhcmFtcygpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGpvYlR5cGVTdGF0dXNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi10eXBlcycpICsgJ2pvYi10eXBlcy9zdGF0dXMvJywgcGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgam9iVHlwZVN0YXR1c1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKGpvYlR5cGVTdGF0dXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5qb2JUeXBlU3RhdHVzKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBqb2JUeXBlU3RhdHVzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qdmFyIHJldHVybmRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlc29sdmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl90eXBlX3N0YXRzOiBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ2V0VG90YWxKb2JUeXBlcygpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5kYXRhLmpvYl90eXBlX3N0YXRzLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWNvbl9jb2RlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmVyc2lvblwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJudW1fY29tcGxldGVkXCI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgyMDAwMCAtIDEwMDAwICsgMSkpICsgMTAwMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm51bV9jYW5jZWxlZFwiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtX2Vycm9yX0RBVEFcIjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDkwMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJudW1fZXJyb3JfU1lTVEVNXCI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5MDAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtX2Vycm9yX0FMR09SSVRITVwiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoOTAwMCAtIDIwICsgMSkpICsgMjBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSByZXR1cm5kYXRhOyovXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IEpvYlR5cGVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYlR5cGVTdGF0dXNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYlR5cGVTdGF0dXNPbmNlOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYlR5cGVTdGF0dXNQYXJhbXMoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi10eXBlcycpICsgJ2pvYi10eXBlcy9zdGF0dXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IEpvYlR5cGVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JUeXBlRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi10eXBlcycpICsgJ2pvYi10eXBlcy8nICsgaWQgKyAnLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKEpvYlR5cGVEZXRhaWxzLnRyYW5zZm9ybWVyKGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlSm9iVHlwZTogZnVuY3Rpb24gKGRhdGEpe1xuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVkSm9iVHlwZSA9IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbWFwcGluZ3M6IGRhdGEuZXJyb3JfbWFwcGluZ3MsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc19wYXVzZWQ6IGRhdGEuaXNfcGF1c2VkXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlZERhdGEgPSB1cGRhdGVkSm9iVHlwZShkYXRhKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvJyArIGRhdGEuaWQgKyAnLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogdXBkYXRlZERhdGFcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKEpvYlR5cGVEZXRhaWxzLnRyYW5zZm9ybWVyKHJlc3VsdCkpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdRdWV1ZVN0YXR1cycsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBKb2JUeXBlKSB7XG4gICAgICAgIHZhciBRdWV1ZVN0YXR1cyA9IGZ1bmN0aW9uIChqb2JfdHlwZSwgY291bnQsIGxvbmdlc3RfcXVldWVkLCBoaWdoZXN0X3ByaW9yaXR5KSB7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgICAgICB0aGlzLmNvdW50ID0gY291bnQ7XG4gICAgICAgICAgICB0aGlzLmxvbmdlc3RfcXVldWVkID0gbG9uZ2VzdF9xdWV1ZWQ7XG4gICAgICAgICAgICB0aGlzLmhpZ2hlc3RfcHJpb3JpdHkgPSBoaWdoZXN0X3ByaW9yaXR5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFF1ZXVlU3RhdHVzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5qb2JfdHlwZS5pY29uX2NvZGUgPyAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyB0aGlzLmpvYl90eXBlLmljb25fY29kZSArICc8L2k+JyA6ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uQ29kZSArICc8L2k+JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24odGhpcy5sb25nZXN0X3F1ZXVlZCwgbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBRdWV1ZVN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUXVldWVTdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubG9uZ2VzdF9xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaGlnaGVzdF9wcmlvcml0eVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFF1ZXVlU3RhdHVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUXVldWVTdGF0dXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUXVldWVTdGF0dXMuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFF1ZXVlU3RhdHVzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBRdWV1ZVN0YXR1cztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2xvYWRTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsICRxLCAkcmVzb3VyY2UsIHNjYWxlQ29uZmlnLCBwb2xsZXIsIHBvbGxlckZhY3RvcnksIFF1ZXVlU3RhdHVzKSB7XG4gICAgICAgIHZhciBnZXRKb2JMb2FkUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG9yZGVyLCBzdGF0dXMsIGpvYl90eXBlX2lkLCBqb2JfdHlwZV9uYW1lLCBqb2JfdHlwZV9jYXRlZ29yeSwgdXJsKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBqb2JfdHlwZV9pZCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9uYW1lOiBqb2JfdHlwZV9uYW1lLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2NhdGVnb3J5OiBqb2JfdHlwZV9jYXRlZ29yeSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IDEwMDAsXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFJlcXVldWVKb2JzUGFyYW1zID0gZnVuY3Rpb24gKHN0YXJ0ZWQsIGVuZGVkLCBqb2Jfc3RhdHVzLCBqb2JfdHlwZV9pZHMsIGpvYl90eXBlX25hbWVzLCBqb2JfdHlwZV9jYXRlZ29yaWVzLCBwcmlvcml0eSwgdXJsKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIGpvYl9zdGF0dXM6IGpvYl9zdGF0dXMsXG4gICAgICAgICAgICAgICAgam9iX2lkczogam9iX2lkcyxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZHM6IGpvYl90eXBlX2lkcyxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9uYW1lczogam9iX3R5cGVfbmFtZXMsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfY2F0ZWdvcmllczogam9iX3R5cGVfY2F0ZWdvcmllcyxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogcHJpb3JpdHksXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFF1ZXVlU3RhdHVzOiBmdW5jdGlvbiAocGFnZU51bWJlciwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICAgICBwYWdlX251bWJlcjogcGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlU2l6ZVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcXVldWVTdGF0dXNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3F1ZXVlJykgKyAncXVldWUvc3RhdHVzLycsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlU3RhdHVzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIocXVldWVTdGF0dXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5xdWV1ZVN0YXR1cyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcXVldWVTdGF0dXNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZXN1bHRzID0gUXVldWVTdGF0dXMudHJhbnNmb3JtZXIocmVzdWx0LnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVTdGF0dXNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UXVldWVTdGF0dXNPbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncXVldWUnKSArICdxdWV1ZS9zdGF0dXMvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBRdWV1ZVN0YXR1cy50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVxdWV1ZUpvYnM6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0UmVxdWV1ZUpvYnNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMudXJsID0gcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3F1ZXVlJykgKyAncXVldWUvcmVxdWV1ZS1qb2JzLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHBhcmFtcy51cmwsIHBhcmFtcykuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JMb2FkOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYkxvYWRQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMudXJsID0gcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2xvYWQnKSArICdsb2FkLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgam9iTG9hZFJlc291cmNlID0gJHJlc291cmNlKHBhcmFtcy51cmwsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIGpvYkxvYWRQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihqb2JMb2FkUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9iTG9hZCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gam9iTG9hZFBvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgam9iTG9hZFBvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iTG9hZE9uY2U6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0Sm9iTG9hZFBhcmFtcygpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXJhbXMudXJsID8gcGFyYW1zLnVybCA6IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbG9hZCcpICsgJ2xvYWQvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ21ldHJpY3NTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgZ2V0UGxvdERhdGFQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgY2hvaWNlX2lkLCBjb2x1bW4sIGdyb3VwLCBkYXRhVHlwZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coY2hvaWNlX2lkKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBjaG9pY2VfaWQ6IGNob2ljZV9pZCxcbiAgICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbixcbiAgICAgICAgICAgICAgICBncm91cDogZ3JvdXAsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IGRhdGFUeXBlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXREYXRhVHlwZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbWV0cmljcycpICsgJ21ldHJpY3MvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERhdGFUeXBlTWV0cmljczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ21ldHJpY3MnKSArICdtZXRyaWNzLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERhdGFUeXBlT3B0aW9uczogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbWV0cmljcycpICsgJ21ldHJpY3MvJyArIG5hbWUgKyAnLyc7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybCkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFBsb3REYXRhOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRQbG90RGF0YVBhcmFtcygpLFxuICAgICAgICAgICAgICAgICAgICBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ21ldHJpY3MnKSArICdtZXRyaWNzLycgKyBwYXJhbXMuZGF0YVR5cGUgKyAnL3Bsb3QtZGF0YS8nLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEdlbmVyYXRlZFBsb3REYXRhOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJldHVybk9iaiA9IHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IDI4LFxuICAgICAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBwcmV2aW91czogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogW11cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIG51bURheXMgPSBtb21lbnQudXRjKG9iai5wYXJhbXMuZW5kZWQpLmRpZmYobW9tZW50LnV0YyhvYmoucGFyYW1zLnN0YXJ0ZWQpLCAnZCcpICsgMTtcblxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChvYmoucXVlcnkuc2VsZWN0ZWRNZXRyaWNzLCBmdW5jdGlvbiAobWV0cmljKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5SZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IG1ldHJpYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbl94OiBtb21lbnQudXRjKG9iai5wYXJhbXMuc3RhcnRlZCkuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhfeDogbW9tZW50LnV0YyhvYmoucGFyYW1zLmVuZGVkKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbl95OiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3k6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczogW11cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURheXM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5xdWVyeS5maWx0ZXJzQXBwbGllZC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKG9iai5xdWVyeS5maWx0ZXJzQXBwbGllZCwgZnVuY3Rpb24gKGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQudmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbW9tZW50LnV0YyhvYmoucGFyYW1zLnN0YXJ0ZWQpLmFkZChpLCAnZCcpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAwIC0gMSArIDEpKSArIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZmlsdGVyLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQudmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBtb21lbnQudXRjKG9iai5wYXJhbXMuc3RhcnRlZCkuYWRkKGksICdkJykuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwMCAtIDEgKyAxKSkgKyAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqLnJlc3VsdHMucHVzaChyZXR1cm5SZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybk9iaik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbmF2Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkd2luZG93LCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIG5hdlNlcnZpY2UpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBzY2FsZUNvbmZpZy5jb2xvcnMubmF2X2JnO1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0udmVyc2lvbiA9ICcnO1xuICAgICAgICB2bS5hY3RpdmVQYWdlID0gJ292ZXJ2aWV3JztcbiAgICAgICAgdm0uZG9jc1VybCA9IHNjYWxlQ29uZmlnLnVybHMuZG9jdW1lbnRhdGlvbjtcblxuICAgICAgICB2bS5nb3RvID0gZnVuY3Rpb24obG9jKSB7XG4gICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCcnKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGxvYyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGxvY2F0aW9uVXBkYXRlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0uYWN0aXZlUGFnZSA9IG5hdlNlcnZpY2UubG9jYXRpb247XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UucmVnaXN0ZXJPYnNlcnZlcihsb2NhdGlvblVwZGF0ZWQpO1xuXG4gICAgICAgICAgICBzY2FsZVNlcnZpY2UuZ2V0VmVyc2lvbigpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS52ZXJzaW9uID0gZGF0YS52ZXJzaW9uO1xuICAgICAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRWZXJzaW9uKGRhdGEudmVyc2lvbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbWV0cmljc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIG5hdlNlcnZpY2UsIG1ldHJpY3NTZXJ2aWNlLCBtb21lbnQpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcyxcbiAgICAgICAgICAgIGNoYXJ0ID0gbnVsbCxcbiAgICAgICAgICAgIGNvbEFyciA9IFtdLFxuICAgICAgICAgICAgY29sTmFtZXMgPSB7fSxcbiAgICAgICAgICAgIHhBcnIgPSBbXSxcbiAgICAgICAgICAgIHJlbW92ZUlkcyA9IFtdLFxuICAgICAgICAgICAgeVVuaXRzID0gW107XG5cbiAgICAgICAgdm0uXyA9IF87XG4gICAgICAgIHZtLm1vbWVudCA9IG1vbWVudDtcbiAgICAgICAgdm0ubG9hZGluZ01ldHJpY3MgPSBmYWxzZTtcbiAgICAgICAgdm0uY2hhcnRBcnIgPSBbXTtcbiAgICAgICAgdm0uY2hhcnREYXRhID0gW107XG4gICAgICAgIHZtLmNoYXJ0U3R5bGUgPSAnJztcbiAgICAgICAgdm0uc2VsZWN0ZWREYXRhVHlwZSA9IHt9O1xuICAgICAgICB2bS5pbnB1dFN0YXJ0RGF0ZSA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgxLCAnTScpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5pbnB1dEVuZERhdGUgPSBtb21lbnQudXRjKCkudG9EYXRlKCk7XG4gICAgICAgIHZtLm9wZW5JbnB1dFN0YXJ0ID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0uaW5wdXRTdGFydE9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmlucHV0U3RhcnRPcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgdm0ub3BlbklucHV0RW5kID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0uaW5wdXRFbmRPcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5pbnB1dEVuZE9wZW5lZCA9IGZhbHNlO1xuICAgICAgICB2bS5kYXRlTW9kZWxPcHRpb25zID0ge1xuICAgICAgICAgICAgdGltZXpvbmU6ICcrMDAwJ1xuICAgICAgICB9O1xuICAgICAgICB2bS5kYXRhVHlwZUZpbHRlclRleHQgPSAnJztcbiAgICAgICAgdm0uZmlsdGVyc0FwcGxpZWQgPSBbXTtcbiAgICAgICAgdm0uZmlsdGVyZWRDaG9pY2VzID0gW107XG4gICAgICAgIHZtLmZpbHRlcmVkQ2hvaWNlc09wdGlvbnMgPSBbXTtcbiAgICAgICAgdm0uc2VsZWN0ZWRNZXRyaWNzID0gW107XG4gICAgICAgIHZtLmNvbHVtbkdyb3Vwc09wdGlvbnMgPSBbXTtcbiAgICAgICAgdm0uY29sdW1ucyA9IFtdO1xuICAgICAgICB2bS5ncm91cHMgPSBbXTtcbiAgICAgICAgdm0uY2hhcnRUaXRsZSA9ICcnO1xuICAgICAgICB2bS5jaGFydERpc3BsYXkgPSAnc3RhY2tlZCc7XG4gICAgICAgIHZtLnN0YWNrZWRDbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgIHZtLmdyb3VwZWRDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLnN1YmNoYXJ0Q2xhc3MgPSAnYnRuLXByaW1hcnknO1xuICAgICAgICB2bS5zdWJjaGFydEVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdm0uY2hhcnRUeXBlID0gJ2Jhcic7XG4gICAgICAgIHZtLmNoYXJ0VHlwZURpc3BsYXkgPSAnQmFyJztcbiAgICAgICAgdm0uYmFyQ2xhc3MgPSAnYnRuLXByaW1hcnknO1xuICAgICAgICB2bS5hcmVhQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5saW5lQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5zcGxpbmVDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLnNjYXR0ZXJDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLm1ldHJpY3NUb3RhbCA9IG51bGw7XG5cbiAgICAgICAgdm0uZ2V0UGxvdERhdGFQYXJhbXMgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IG51bGwsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBudWxsLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IG9iai5zdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBvYmouZW5kZWQsXG4gICAgICAgICAgICAgICAgY2hvaWNlX2lkOiBvYmouY2hvaWNlX2lkLFxuICAgICAgICAgICAgICAgIGNvbHVtbjogb2JqLmNvbHVtbixcbiAgICAgICAgICAgICAgICBncm91cDogb2JqLmdyb3VwLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBvYmouZGF0YVR5cGUubmFtZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZXNldFNlbGVjdGlvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5pbnB1dFN0YXJ0RGF0ZSA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgxLCAnTScpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgdm0uaW5wdXRFbmREYXRlID0gbW9tZW50LnV0YygpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWREYXRhVHlwZSA9IHt9O1xuICAgICAgICAgICAgdm0uY2hhbmdlRGF0YVR5cGVTZWxlY3Rpb24oKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDaGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmNoYXJ0RGF0YSA9IFtdO1xuICAgICAgICAgICAgaWYgKHZtLmNoYXJ0QXJyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIC8vIG5vdGhpbmcgdG8gc2hvdyBvbiBjaGFydFxuICAgICAgICAgICAgICAgIGNoYXJ0LmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICBjaGFydCA9IG51bGw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBjYWxsSW5pdCA9IF8uYWZ0ZXIodm0uY2hhcnRBcnIubGVuZ3RoLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgaW5pdENoYXJ0IGFmdGVyIHRoaXMgZnVuY3Rpb24gaGFzIGJlZW4gY2FsbGVkIGZvciBhbGwgZGF0YXNldHMgaW4gY2hhcnRBcnJcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZ01ldHJpY3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uaW5pdENoYXJ0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uY2hhcnRBcnIsIGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHZtLmdldFBsb3REYXRhUGFyYW1zKG9iaik7XG4gICAgICAgICAgICAgICAgICAgIG1ldHJpY3NTZXJ2aWNlLmdldFBsb3REYXRhKHBhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAvL21ldHJpY3NTZXJ2aWNlLmdldEdlbmVyYXRlZFBsb3REYXRhKHtxdWVyeTogb2JqLCBwYXJhbXM6IHBhcmFtc30pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNoYXJ0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogb2JqLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IGRhdGEucmVzdWx0c1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsSW5pdCgpO1xuICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdNZXRyaWNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5hZGRUb0NoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uY2hhcnRBcnIgPSBbXTsgLy8gY29tbWVudCB0aGlzIG91dCBpZiBhbGxvd2luZyBtdWx0aXBsZSBhZGRzXG4gICAgICAgICAgICB2bS5sb2FkaW5nTWV0cmljcyA9IHRydWU7XG4gICAgICAgICAgICB2YXIgZmlsdGVyZWRDaG9pY2VzID0gW10sXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zID0gW107XG4gICAgICAgICAgICAvLyBmaW5kIHRoZSBmaWx0ZXIgb2JqZWN0IGFzc29jaWF0ZWQgd2l0aCB0aGUgY2hvc2VuIGZpbHRlciBJRHNcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5maWx0ZXJzQXBwbGllZCwgZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRDaG9pY2VzLnB1c2goXy5maW5kKHZtLmZpbHRlcmVkQ2hvaWNlcywgeyBpZDogcGFyc2VJbnQoaWQpIH0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheSh2bS5zZWxlY3RlZE1ldHJpY3MpKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLnNlbGVjdGVkTWV0cmljcywgZnVuY3Rpb24gKG1ldHJpYykge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZENvbHVtbnMucHVzaChfLmZpbmQodm0uY29sdW1ucywgeyBuYW1lOiBtZXRyaWMgfSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvbHVtbnMucHVzaChfLmZpbmQodm0uY29sdW1ucywgeyBuYW1lOiB2bS5zZWxlY3RlZE1ldHJpY3MgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uY2hhcnRBcnIucHVzaCh7XG4gICAgICAgICAgICAgICAgc3RhcnRlZDogdm0uaW5wdXRTdGFydERhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBlbmRlZDogdm0uaW5wdXRFbmREYXRlLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY2hvaWNlX2lkOiB2bS5maWx0ZXJzQXBwbGllZCxcbiAgICAgICAgICAgICAgICBjb2x1bW46IF8ucGx1Y2soc2VsZWN0ZWRDb2x1bW5zLCAnbmFtZScpLFxuICAgICAgICAgICAgICAgIGdyb3VwOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiB2bS5zZWxlY3RlZERhdGFUeXBlLFxuICAgICAgICAgICAgICAgIGZpbHRlcnNBcHBsaWVkOiBmaWx0ZXJlZENob2ljZXMsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRNZXRyaWNzOiBzZWxlY3RlZENvbHVtbnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0udXBkYXRlQ2hhcnQoKTtcbiAgICAgICAgICAgIC8vdm0ucmVzZXRTZWxlY3Rpb25zKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZGVsZXRlRnJvbUNoYXJ0ID0gZnVuY3Rpb24gKG9ialRvRGVsZXRlKSB7XG4gICAgICAgICAgICBfLnJlbW92ZSh2bS5jaGFydEFyciwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmopID09PSBKU09OLnN0cmluZ2lmeShvYmpUb0RlbGV0ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNoYXJ0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0RmlsdGVyT3B0aW9ucyA9IGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgcmV0dXJuIF8udW5pcShfLnBsdWNrKHZtLmZpbHRlcmVkQ2hvaWNlcywgcGFyYW0pKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jaGFuZ2VEYXRhVHlwZVNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHJlc2V0IG9wdGlvbnNcbiAgICAgICAgICAgIHZtLmZpbHRlcnNBcHBsaWVkID0gW107XG4gICAgICAgICAgICB2bS5zZWxlY3RlZERhdGFUeXBlT3B0aW9ucyA9IFtdO1xuICAgICAgICAgICAgdm0uZGF0YVR5cGVGaWx0ZXJUZXh0ID0gJyc7XG4gICAgICAgICAgICB2bS5zZWxlY3RlZE1ldHJpY3MgPSBbXTtcbiAgICAgICAgICAgIHZtLmNvbHVtbnMgPSBbXTtcblxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZERhdGFUeXBlLm5hbWUgfHwgdm0uc2VsZWN0ZWREYXRhVHlwZS5uYW1lID09PSAnJykge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRGF0YVR5cGUgPSB7fTtcbiAgICAgICAgICAgICAgICB2bS5nZXREYXRhVHlwZXMoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0uZ2V0RGF0YVR5cGVPcHRpb25zKHZtLnNlbGVjdGVkRGF0YVR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmFyZUZpbHRlcnNBcHBsaWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHZtLmZpbHRlcnNBcHBsaWVkLmxlbmd0aCA+IDA7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ2hhcnREaXNwbGF5ID0gZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgICAgICAgICAgIHZtLmNoYXJ0RGlzcGxheSA9IGRpc3BsYXk7XG4gICAgICAgICAgICB2bS5zdGFja2VkQ2xhc3MgPSBkaXNwbGF5ID09PSAnc3RhY2tlZCcgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIHZtLmdyb3VwZWRDbGFzcyA9IGRpc3BsYXkgPT09ICdncm91cGVkJyA/ICdidG4tcHJpbWFyeScgOiAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgdm0uaW5pdENoYXJ0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ2hhcnRUeXBlID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICAgIHZtLmNoYXJ0VHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB2bS5jaGFydFR5cGVEaXNwbGF5ID0gXy5jYXBpdGFsaXplKHR5cGUpO1xuICAgICAgICAgICAgdm0uYmFyQ2xhc3MgPSB0eXBlID09PSAnYmFyJyA/ICdidG4tcHJpbWFyeScgOiAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgdm0uYXJlYUNsYXNzID0gdHlwZSA9PT0gJ2FyZWEnID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB2bS5saW5lQ2xhc3MgPSB0eXBlID09PSAnbGluZScgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIHZtLnNwbGluZUNsYXNzID0gdHlwZSA9PT0gJ3NwbGluZScgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIHZtLnNjYXR0ZXJDbGFzcyA9IHR5cGUgPT09ICdzY2F0dGVyJyA/ICdidG4tcHJpbWFyeScgOiAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgdm0uaW5pdENoYXJ0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udG9nZ2xlU3ViY2hhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5zdWJjaGFydEVuYWJsZWQgPSAhdm0uc3ViY2hhcnRFbmFibGVkO1xuICAgICAgICAgICAgaWYgKHZtLnN1YmNoYXJ0RW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHZtLnN1YmNoYXJ0Q2xhc3MgPSAnYnRuLXByaW1hcnknO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zdWJjaGFydENsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbWV0cmljcycpO1xuICAgICAgICAgICAgdm0uZ2V0RGF0YVR5cGVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0RGF0YVR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbWV0cmljc1NlcnZpY2UuZ2V0RGF0YVR5cGVzKCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdm0uYXZhaWxhYmxlRGF0YVR5cGVzID0gcmVzdWx0LnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldERhdGFUeXBlID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICBtZXRyaWNzU2VydmljZS5nZXREYXRhVHlwZU1ldHJpY3MoaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRGF0YVR5cGVBdmFpbGFibGVNZXRyaWNzID0gcmVzdWx0Lm1ldHJpY3M7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXREYXRhVHlwZU9wdGlvbnMgPSBmdW5jdGlvbiAoZGF0YVR5cGUpIHtcbiAgICAgICAgICAgIG1ldHJpY3NTZXJ2aWNlLmdldERhdGFUeXBlT3B0aW9ucyhkYXRhVHlwZS5uYW1lKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZERhdGFUeXBlT3B0aW9ucyA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2gocmVzdWx0LmZpbHRlcnMsIGZ1bmN0aW9uIChmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGF0YVR5cGVGaWx0ZXJUZXh0ID0gdm0uZGF0YVR5cGVGaWx0ZXJUZXh0Lmxlbmd0aCA9PT0gMCA/IF8uY2FwaXRhbGl6ZShmaWx0ZXIucGFyYW0pIDogdm0uZGF0YVR5cGVGaWx0ZXJUZXh0ICsgJywgJyArIF8uY2FwaXRhbGl6ZShmaWx0ZXIucGFyYW0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlcmVkQ2hvaWNlcyA9IF8uc29ydEJ5T3JkZXIocmVzdWx0LmNob2ljZXMsIFsndGl0bGUnLCd2ZXJzaW9uJ10sIFsnYXNjJywnYXNjJ10pO1xuICAgICAgICAgICAgICAgIC8vIGZvcm1hdCBmaWx0ZXJlZENob2ljZXMgZm9yIHVzZSB3aXRoIG11bHRpc2VsZWN0IGRpcmVjdGl2ZVxuICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJlZENob2ljZXNPcHRpb25zID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmZpbHRlcmVkQ2hvaWNlcywgZnVuY3Rpb24gKGNob2ljZSkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZENob2ljZXNPcHRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGNob2ljZS52ZXJzaW9uID8gY2hvaWNlLnRpdGxlICsgJyAnICsgY2hvaWNlLnZlcnNpb24gOiBjaG9pY2UudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogY2hvaWNlLnZlcnNpb24gPyBjaG9pY2UudGl0bGUgKyAnICcgKyBjaG9pY2UudmVyc2lvbiA6IGNob2ljZS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjaG9pY2UuaWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyZWRDaG9pY2VzT3B0aW9ucyA9IGZpbHRlcmVkQ2hvaWNlc09wdGlvbnM7XG4gICAgICAgICAgICAgICAgdm0uY29sdW1ucyA9IF8uc29ydEJ5T3JkZXIocmVzdWx0LmNvbHVtbnMsIFsndGl0bGUnXSwgWydhc2MnXSk7XG4gICAgICAgICAgICAgICAgdm0uZ3JvdXBzID0gcmVzdWx0Lmdyb3VwcztcblxuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhbiBhcnJheSBvZiBvYmplY3RzIGNvbnRhaW5pbmcgZ3JvdXBlZCBjb2x1bW5zXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbkdyb3Vwc09wdGlvbnMgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uR3JvdXBzID0gXy5wYWlycyhfLmdyb3VwQnkocmVzdWx0LmNvbHVtbnMsICdncm91cCcpKTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goY29sdW1uR3JvdXBzLCBmdW5jdGlvbiAoZ3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBfLmZpbmQodm0uZ3JvdXBzLCB7IG5hbWU6IGdyb3VwWzBdIH0pLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChncm91cFsxXSwgZnVuY3Rpb24gKGNvbHVtbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBjb2x1bW4udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGNvbHVtbi50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY29sdW1uLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24uY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW5Hcm91cHNPcHRpb25zLnB1c2gob3B0aW9uKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb2x1bW5Hcm91cHNPcHRpb25zLnVuc2hpZnQoe1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ05vbmUgU2VsZWN0ZWQnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ05vbmUgU2VsZWN0ZWQnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJydcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS5jb2x1bW5Hcm91cHNPcHRpb25zID0gY29sdW1uR3JvdXBzT3B0aW9ucztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcil7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplKCk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uaW5wdXRFbmREYXRlJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2YWx1ZSlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGZvcm1hdFlWYWx1ZXMgPSBmdW5jdGlvbiAoZGF0YSwgbm9QYWRkaW5nKSB7XG4gICAgICAgICAgICBub1BhZGRpbmcgPSBub1BhZGRpbmcgfHwgZmFsc2U7XG4gICAgICAgICAgICBpZiAoeVVuaXRzWzBdID09PSAnc2Vjb25kcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKG1vbWVudC51dGMoKS5zdGFydE9mKCdkJyksIG1vbWVudC51dGMoKS5zdGFydE9mKCdkJykuYWRkKGRhdGEsICdzJyksIG5vUGFkZGluZyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHlVbml0c1swXSA9PT0gJ2J5dGVzJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXMoZGF0YSwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzZXQgdXAgY2hhcnRcbiAgICAgICAgdm0uaW5pdENoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gbWFyayBhbnkgZXhpc3RpbmcgZGF0YSBmb3IgcmVtb3ZhbFxuICAgICAgICAgICAgLy8gY29tcGFyZSBjdXJyQ29scyAoY29sdW1ucyBjdXJyZW50bHkgaW4gdGhlIGNoYXJ0KSB3aXRoIGRpc3BsYXlDb2xzIChjb2x1bW5zIHRvIGRpc3BsYXkpXG4gICAgICAgICAgICByZW1vdmVJZHMgPSBbXTtcbiAgICAgICAgICAgIHZtLm1ldHJpY3NUb3RhbCA9IG51bGw7XG4gICAgICAgICAgICB2YXIgY3VyckNvbHMgPSBbXSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q29scyA9IFtdO1xuICAgICAgICAgICAgXy5mb3JFYWNoKGNvbEFyciwgZnVuY3Rpb24gKGNvbCwgaWR4KSB7XG4gICAgICAgICAgICAgICAgaWYgKGlkeCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VyckNvbHMucHVzaChjb2xbMF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmNoYXJ0RGF0YSwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q29scyA9IGRpc3BsYXlDb2xzLmNvbmNhdChfLnBsdWNrKGQucXVlcnkuZmlsdGVyc0FwcGxpZWQsICduYW1lJykpO1xuICAgICAgICAgICAgICAgIC8vIGluY3JlYXNlIG1ldHJpY3MgdG90YWwgaWYgc2VsZWN0ZWQgbWV0cmljIHByb2R1Y2VzIGEgc3VtXG4gICAgICAgICAgICAgICAgLy8gZm9yIG5vdyBpdCBpcyBvbmx5IHBvc3NpYmxlIHRvIHNlbGVjdCBvbmUgbWV0cmljIGF0IGEgdGltZVxuICAgICAgICAgICAgICAgIC8vIHNvIGp1c3QgY2hlY2sgdGhlIGZpcnN0IGVsZW1lbnQgZnJvbSBzZWxlY3RlZE1ldHJpY3NcbiAgICAgICAgICAgICAgICBpZiAoZC5xdWVyeS5zZWxlY3RlZE1ldHJpY3NbMF0uYWdncmVnYXRlID09PSAnc3VtJykge1xuICAgICAgICAgICAgICAgICAgICB2bS5tZXRyaWNzVG90YWwgPSB2bS5tZXRyaWNzVG90YWwgKyBfLnN1bShkLnJlc3VsdHNbMF0udmFsdWVzLCAndmFsdWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGRldGVybWluZSB0aGUgZXhhY3QgZGlmZmVyZW5jZXMgYmV0d2VlbiBjdXJyQ29scyBhbmQgZGlzcGxheUNvbHNcbiAgICAgICAgICAgIC8vIGlmIG5vbmUgYXJlIGZvdW5kLCB0aGVuIHJlbW92ZUlkcyBzdGF5cyBlbXB0eVxuICAgICAgICAgICAgXy5mb3JFYWNoKGN1cnJDb2xzLCBmdW5jdGlvbiAoY3VyckNvbCkge1xuICAgICAgICAgICAgICAgIHZhciBkaXNwbGF5Q29sID0gXy5maW5kKGRpc3BsYXlDb2xzLCBmdW5jdGlvbiAoZENvbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZENvbCA9PT0gY3VyckNvbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIWRpc3BsYXlDb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSWRzLnB1c2goY3VyckNvbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGluaXQgd2l0aCBuZXcgZGF0YVxuICAgICAgICAgICAgY29sQXJyID0gW107XG4gICAgICAgICAgICB4QXJyID0gW107XG4gICAgICAgICAgICBjb2xOYW1lcyA9IHt9O1xuXG4gICAgICAgICAgICAvLyBjcmVhdGUgeEFyclxuICAgICAgICAgICAgdmFyIG51bURheXMgPSBtb21lbnQudXRjKHZtLmlucHV0RW5kRGF0ZSkuZW5kT2YoJ2QnKS5kaWZmKG1vbWVudC51dGModm0uaW5wdXRTdGFydERhdGUudG9JU09TdHJpbmcoKSkuc3RhcnRPZignZCcpLCAnZCcpICsgMTsgLy8gYWRkIDEgdG8gaW5jbHVkZSBzdGFydGluZyBkYXkgaW4gY291bnRcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtRGF5czsgaSsrKSB7XG4gICAgICAgICAgICAgICAgeEFyci5wdXNoKG1vbWVudC51dGModm0uaW5wdXRTdGFydERhdGUudG9JU09TdHJpbmcoKSkuc3RhcnRPZignZCcpLmFkZChpLCAnZCcpLnRvRGF0ZSgpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIGRhdGF0eXBlcyBhbmQgYWRkIHZhbHVlcyB0byBjb2xBcnJcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5jaGFydERhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlQXJyID0gW10sXG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gZGF0YS5xdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlGaWx0ZXIgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlEYXRlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgeVVuaXRzID0gXy5wbHVjayhxdWVyeS5zZWxlY3RlZE1ldHJpY3MsICd1bml0cycpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXJ5LmZpbHRlcnNBcHBsaWVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZmlsdGVycyB3ZXJlIGFwcGxpZWQsIHNvIGJ1aWxkIGRhdGEgc291cmNlIGFjY29yZGluZ2x5XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkYXRhLnJlc3VsdHMsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZXMgZm9yIGFsbCBmaWx0ZXJzIGFyZSByZXR1cm5lZCBpbiBvbmUgYXJyYXkgb2YgYXJyYXlzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIGdyb3VwIHJlc3VsdHMgYnkgaWQgdG8gaXNvbGF0ZSBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwZWRSZXN1bHQgPSBfLmdyb3VwQnkocmVzdWx0LnZhbHVlcywgJ2lkJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9iaiA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJJZHMgPSBfLnBsdWNrKHF1ZXJ5LmZpbHRlcnNBcHBsaWVkLCAnaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0cnkgdG8gZ2V0IGVhY2ggZmlsdGVyIGlkIGZyb20gZ3JvdXBlZFJlc3VsdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBpdCdzIHVuZGVmaW5lZCwgYW4gZW1wdHkgYXJyYXkgd2lsbCBiZSByZXR1cm5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgYWxsb3dzIGEgemVyb2VkIGFycmF5IHRvIGFwcGVhciBpbiB0aGUgY2hhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2luY2Ugd2Ugd2FudCB0byBpbmNsdWRlIGFsbCBmaWx0ZXJzIHNlbGVjdGVkIGJ5IHRoZSB1c2VyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVnYXJkbGVzcyBvZiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJJZHMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIG1vcmUgdGhhbiBvbmUgZmlsdGVyIGlzIHJlcXVlc3RlZCwgdGhlbiBhbiBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZSBpcyBwcmVzZW50IHdpdGhpbiBkYXRhLnJlc3VsdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZpbHRlcklkcywgZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRPYmpbaWRdID0gXy5nZXQoZ3JvdXBlZFJlc3VsdCwgaWQsIFtdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBvbmUgZmlsdGVyIGlzIHJlcXVlc3RlZCwgbm8gaWQgdmFsdWUgaXMgaW5jbHVkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gZGF0YS5yZXN1bHRzLCBzbyBidWlsZCByZXN1bHRPYmogd2l0aCB0aGUgb3RoZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5mbyB3ZSBoYXZlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9ialtxdWVyeS5jaG9pY2VfaWRbMF1dID0gXy5wYWlycyhncm91cGVkUmVzdWx0KVswXVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKF8ucGFpcnMocmVzdWx0T2JqKSwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZFswXSB3aWxsIGJlIGNob2ljZSBpZCwgZFsxXSB3aWxsIGJlIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBvbmx5IG9uZSBmaWx0ZXIgd2FzIHNlbGVjdGVkLCBkWzBdIHdpbGwgcmV0dXJuIGFzIHN0cmluZyAndW5kZWZpbmVkJyBzaW5jZSBubyBpZCBpcyBpbmNsdWRlZCBpbiB0aGlzIGNhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlGaWx0ZXIgPSBkWzBdID09PSAndW5kZWZpbmVkJyA/IHF1ZXJ5LmZpbHRlcnNBcHBsaWVkWzBdIDogXy5maW5kKHF1ZXJ5LmZpbHRlcnNBcHBsaWVkLCB7aWQ6IHBhcnNlSW50KGRbMF0pfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5RGF0ZXMgPSBkWzFdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCByZXN1bHQgdmFsdWVzIHRvIHZhbHVlQXJyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh4QXJyLCBmdW5jdGlvbiAoeERhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZU9iaiA9IF8uZmluZChxdWVyeURhdGVzLCBmdW5jdGlvbiAocURhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhxRGF0ZS5kYXRlKS5pc1NhbWUoeERhdGUsICdkYXknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHVzaCAwIGlmIGRhdGEgZm9yIHhEYXRlIGlzIG5vdCBwcmVzZW50IGluIHF1ZXJ5RGF0ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlQXJyLnB1c2godmFsdWVPYmogPyB2YWx1ZU9iai52YWx1ZSA6IDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmVwZW5kIHZhbHVlQXJyIHdpdGggZmlsdGVyIHRpdGxlLCBhbmQgcHVzaCBvbnRvIGNvbEFyclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUFyci51bnNoaWZ0KHF1ZXJ5RmlsdGVyLm5hbWUgKyBxdWVyeUZpbHRlci5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE5hbWVzW3F1ZXJ5RmlsdGVyLm5hbWUgKyBxdWVyeUZpbHRlci5pZF0gPSBxdWVyeUZpbHRlci52ZXJzaW9uID8gcXVlcnlGaWx0ZXIudGl0bGUgKyAnICcgKyBxdWVyeUZpbHRlci52ZXJzaW9uIDogcXVlcnlGaWx0ZXIudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbEFyci5wdXNoKHZhbHVlQXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm8gZmlsdGVycyB3ZXJlIGFwcGxpZWQsIHNvIHNob3cgYWdncmVnYXRlIHN0YXRpc3RpY3NcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEucmVzdWx0cywgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHJlc3VsdCB2YWx1ZXMgdG8gdmFsdWVBcnJcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh4QXJyLCBmdW5jdGlvbiAoeERhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVPYmogPSBfLmZpbmQocmVzdWx0LnZhbHVlcywgZnVuY3Rpb24gKHFEYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKHFEYXRlLmRhdGUpLmlzU2FtZSh4RGF0ZSwgJ2RheScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHB1c2ggMCBpZiBkYXRhIGZvciB4RGF0ZSBpcyBub3QgcHJlc2VudCBpbiByZXN1bHQudmFsdWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcnIucHVzaCh2YWx1ZU9iaiA/IHZhbHVlT2JqLnZhbHVlIDogMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJlcGVuZCB2YWx1ZUFyciB3aXRoIGZpbHRlciB0aXRsZSwgYW5kIHB1c2ggb250byBjb2xBcnJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5MYWJlbCA9IHJlc3VsdC5jb2x1bW4udGl0bGUgKyAnIGZvciBhbGwgJyArIHF1ZXJ5LmRhdGFUeXBlLnRpdGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcnIudW5zaGlmdChjb2x1bW5MYWJlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xOYW1lc1snYWdncmVnYXRlJ10gPSBjb2x1bW5MYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEFyci5wdXNoKHZhbHVlQXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGluZm9ybSB0aGUgdXNlciBpZiB0aGUgbWV0cmljcyB0aGV5IHNlbGVjdGVkIGFyZSBlbXB0eVxuICAgICAgICAgICAgaWYgKF8uc3VtKF8uZmxhdHRlbihjb2xBcnIpKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnaW5mbyddKCdUaGVyZSBpcyBubyBkYXRhIHRvIGRpc3BsYXkuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHByZXBlbmQgeEFyciB3aXRoIGFuICd4JyBsYWJlbCBhbmQgYWRkIHRvIGNvbEFyclxuICAgICAgICAgICAgeEFyci51bnNoaWZ0KCd4Jyk7XG4gICAgICAgICAgICBjb2xBcnIudW5zaGlmdCh4QXJyKTtcblxuICAgICAgICAgICAgdmFyIHR5cGVzID0ge30sXG4gICAgICAgICAgICAgICAgdHlwZSA9IHt9LFxuICAgICAgICAgICAgICAgIGdyb3VwcyA9IFtdO1xuXG4gICAgICAgICAgICBfLmZvckVhY2goY29sQXJyLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgdHlwZSA9IHt9O1xuICAgICAgICAgICAgICAgIGlmIChjb2xbMF0gIT09ICd4Jykge1xuICAgICAgICAgICAgICAgICAgICB0eXBlW2NvbFswXV0gPSB2bS5jaGFydFR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5jaGFydERpc3BsYXkgPT09ICdzdGFja2VkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goY29sWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh0eXBlcywgdHlwZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGNoYXJ0KSB7XG4gICAgICAgICAgICAgICAgLy8gY2hhcnQgYWxyZWFkeSBleGlzdHMsIHNvIHVwZGF0ZSB2YWx1ZXNcbiAgICAgICAgICAgICAgICBjaGFydC5ncm91cHMoW2dyb3Vwc10pO1xuICAgICAgICAgICAgICAgIGNoYXJ0LmRhdGEubmFtZXMoY29sTmFtZXMpO1xuICAgICAgICAgICAgICAgIGNoYXJ0LmF4aXMubGFiZWxzKHtcbiAgICAgICAgICAgICAgICAgICAgeTogXy5jYXBpdGFsaXplKHlVbml0c1swXSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjaGFydC5sb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sQXJyLFxuICAgICAgICAgICAgICAgICAgICB0eXBlczogdHlwZXMsXG4gICAgICAgICAgICAgICAgICAgIHVubG9hZDogcmVtb3ZlSWRzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG5vIGNoYXJ0IHlldCwgc28gc2V0IGl0IHVwXG4gICAgICAgICAgICAgICAgY2hhcnQgPSBjMy5nZW5lcmF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJpbmR0bzogJyNtZXRyaWNzJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogJ3gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sQXJyLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXM6IHR5cGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzOiBbZ3JvdXBzXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzOiBjb2xOYW1lc1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWJjaGFydDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdzogdm0uc3ViY2hhcnRFbmFibGVkXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA3MDBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm46IHNjYWxlQ29uZmlnLmNvbG9ycy5wYXR0ZXJuRDMyMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBheGlzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGltZXNlcmllcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGljazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhkKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGF0ZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ291dGVyLWNlbnRlcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdFlWYWx1ZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF8uY2FwaXRhbGl6ZSh5VW5pdHNbMF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ291dGVyLW1pZGRsZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLm1ldHJpY3NUb3RhbCkge1xuICAgICAgICAgICAgICAgIHZtLm1ldHJpY3NUb3RhbCA9IGZvcm1hdFlWYWx1ZXModm0ubWV0cmljc1RvdGFsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2bS5jaGFydFRpdGxlID0gJzxkaXYgY2xhc3M9XCJsYWJlbCBsYWJlbC1zdWNjZXNzXCI+JyArIHZtLm1ldHJpY3NUb3RhbC50b0xvY2FsZVN0cmluZygpICsgJzwvZGl2PiAnICsgdm0uY2hhcnREYXRhWzBdLnF1ZXJ5LnNlbGVjdGVkTWV0cmljc1swXS50aXRsZSArICcgZm9yICcgKyBtb21lbnQudXRjKHZtLmlucHV0U3RhcnREYXRlKS5mb3JtYXQoJ0REIE1NTSBZWVlZJykgKyAnIC0gJyArIG1vbWVudC51dGModm0uaW5wdXRFbmREYXRlKS5mb3JtYXQoJ0REIE1NTSBZWVlZJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLmNoYXJ0VGl0bGUgPSB2bS5jaGFydERhdGFbMF0ucXVlcnkuc2VsZWN0ZWRNZXRyaWNzWzBdLnRpdGxlICsgJyAnICsgbW9tZW50LnV0Yyh2bS5pbnB1dFN0YXJ0RGF0ZSkuZm9ybWF0KCdERCBNTU0gWVlZWScpICsgJyAtICcgKyBtb21lbnQudXRjKHZtLmlucHV0RW5kRGF0ZSkuZm9ybWF0KCdERCBNTU0gWVlZWScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHNldCBjaGFydCBoZWlnaHRcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGNoYXJ0TWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0O1xuXG4gICAgICAgICAgICB2bS5jaGFydFN0eWxlID0gJ2hlaWdodDogJyArIGNoYXJ0TWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY2hhcnRNYXhIZWlnaHQgKyAncHg7JztcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLyoqXG4gICAgICogU2VlOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEyNTc2Nzk4L2FuZ3VsYXJqcy1ob3ctdG8td2F0Y2gtc2VydmljZS12YXJpYWJsZXMvMTc1NTg4ODUjMTc1NTg4ODVcbiAgICAgKiBEb2luZyB0aGluZ3MgdGhpcyB3YXkgc28gdGhhdCBzc05hdmJhckNvbnRyb2xsZXIgY2FuIGdldCBub3RpZmllZFxuICAgICAqIHdoZW4gdGhlIGxvY2F0aW9uIGNoYW5nZXMuIFRoZW4sIG91ciBjb250cm9sbGVycyBqdXN0IG5lZWQgdG8gY2FsbCBpbnRvXG4gICAgICogdGhpcyBzZXJ2aWNlIHRvIHVwZGF0ZUxvY2F0aW9uLlxuICAgICAqXG4gICAgICogVGhlIG9ubHkgdGhpbmcgSSBkb24ndCBsaWtlIGFib3V0IHRoaXMgaXMgdGhhdCB0aGUgaW5kaXZpZHVhbFxuICAgICAqIGNvbnRyb2xsZXJzIGhhdmUgdG8gY2FsbCBpbiBhbmQgdGVsbCB0aGUgc3NOYXZpZ2F0aW9uU2VydmljZSB3aGF0XG4gICAgICogcGFnZSB0aGV5IGFyZSBzaG93aW5nLlxuICAgICAqL1xuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ25hdlNlcnZpY2UnLCBmdW5jdGlvbiAoJGxvY2F0aW9uKSB7XG5cbiAgICAgICAgdGhpcy5sb2NhdGlvbiA9ICdvdmVydmlldyc7IC8vIHdoZXJlIHRoZSBhcHAgc3RhcnRzXG5cbiAgICAgICAgdmFyIG9ic2VydmVycyA9IFtdO1xuXG4gICAgICAgIHRoaXMucmVnaXN0ZXJPYnNlcnZlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBvYnNlcnZlcnMucHVzaChjYWxsYmFjayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5ub3RpZnlPYnNlcnZlcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChvYnNlcnZlcnMsIGZ1bmN0aW9uKG9ic2VydmVyKSB7XG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMudXBkYXRlTG9jYXRpb24gPSBmdW5jdGlvbihsb2NhdGlvbkluKSB7XG4gICAgICAgICAgICB0aGlzLmxvY2F0aW9uID0gbG9jYXRpb25JbjtcbiAgICAgICAgICAgIHRoaXMubm90aWZ5T2JzZXJ2ZXJzKCk7XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3N1Ym5hdlNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBjdXJyZW50UGF0aCA9ICcnO1xuXG4gICAgICAgIHRoaXMuc2V0Q3VycmVudFBhdGggPSBmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAgICAgY3VycmVudFBhdGggPSBwYXRoO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZ2V0Q3VycmVudFBhdGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFBhdGg7XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbm9kZURldGFpbHNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgJHRpbWVvdXQsIG5hdlNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0dXNTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgbW9tZW50KSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBub2RlcyA9IFtdLFxuICAgICAgICAgICAgam9iVHlwZXMgPSBbXTtcbiAgICAgICAgXG4gICAgICAgIHZtLnNjYWxlQ29uZmlnID0gc2NhbGVDb25maWc7XG4gICAgICAgIHZtLm1vbWVudCA9IG1vbWVudDtcbiAgICAgICAgdm0uXyA9IF87XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5sb2FkaW5nU3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgdm0ubm9kZVN0YXR1cyA9IG51bGw7XG4gICAgICAgIHZtLm5vZGVzRXJyb3IgPSBudWxsO1xuICAgICAgICB2bS5ub2RlSWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICB2bS5ydW5uaW5nSm9icyA9IFtdO1xuICAgICAgICB2bS5jb21wbGV0ZWRKb2JzID0gW107XG4gICAgICAgIHZtLnN5c3RlbUpvYnMgPSBbXTtcbiAgICAgICAgdm0uYWxnb3JpdGhtSm9icyA9IFtdO1xuICAgICAgICB2bS5kYXRhSm9icyA9IFtdO1xuICAgICAgICB2bS5zY2FsZVNlcnZpY2UgPSBzY2FsZVNlcnZpY2U7XG5cbiAgICAgICAgdmFyIGdldE5vZGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdHVzU2VydmljZS5nZXRTdGF0dXModHJ1ZSkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5ub2Rlc0Vycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdm0ucnVubmluZ0pvYnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdm0uY29tcGxldGVkSm9icyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBub2RlcyA9IGRhdGEubm9kZXM7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVTdGF0dXMgPSBfLmZpbmQobm9kZXMsIHsgaWQ6IHZtLm5vZGVJZCB9KTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLm5vZGVTdGF0dXMuam9iX2V4ZWN1dGlvbnMucnVubmluZy5ieV9qb2JfdHlwZSwgZnVuY3Rpb24gKHJ1bm5pbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJ1bm5pbmdKb2JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYlR5cGU6IF8uZmluZChqb2JUeXBlcywgeyBpZDogcnVubmluZy5qb2JfdHlwZV9pZCB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogcnVubmluZy5jb3VudFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2godm0ubm9kZVN0YXR1cy5qb2JfZXhlY3V0aW9ucy5jb21wbGV0ZWQuYnlfam9iX3R5cGUsIGZ1bmN0aW9uIChjb21wbGV0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNvbXBsZXRlZEpvYnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iVHlwZTogXy5maW5kKGpvYlR5cGVzLCB7IGlkOiBjb21wbGV0ZWQuam9iX3R5cGVfaWQgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGNvbXBsZXRlZC5jb3VudFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2godm0ubm9kZVN0YXR1cy5qb2JfZXhlY3V0aW9ucy5mYWlsZWQuc3lzdGVtLmJ5X2pvYl90eXBlLCBmdW5jdGlvbiAoc3lzdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zeXN0ZW1Kb2JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYlR5cGU6IF8uZmluZChqb2JUeXBlcywgeyBpZDogc3lzdGVtLmpvYl90eXBlX2lkIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBzeXN0ZW0uY291bnRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLm5vZGVTdGF0dXMuam9iX2V4ZWN1dGlvbnMuZmFpbGVkLmFsZ29yaXRobS5ieV9qb2JfdHlwZSwgZnVuY3Rpb24gKGFsZ29yaXRobSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxnb3JpdGhtSm9icy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2JUeXBlOiBfLmZpbmQoam9iVHlwZXMsIHsgaWQ6IGFsZ29yaXRobS5qb2JfdHlwZV9pZCB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogYWxnb3JpdGhtLmNvdW50XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5ub2RlU3RhdHVzLmpvYl9leGVjdXRpb25zLmZhaWxlZC5kYXRhLmJ5X2pvYl90eXBlLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZGF0YUpvYnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iVHlwZTogXy5maW5kKGpvYlR5cGVzLCB7IGlkOiBkYXRhLmpvYl90eXBlX2lkIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBkYXRhLmNvdW50XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5ub2Rlc0Vycm9yU3RhdHVzID0gZGF0YS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVzRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIG5vZGVzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdTdGF0dXMgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXROb2RlRGV0YWlscyA9IGZ1bmN0aW9uIChub2RlSWQpIHtcbiAgICAgICAgICAgIG5vZGVTZXJ2aWNlLmdldE5vZGUobm9kZUlkKS50aGVuKCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLm5vZGUgPSBkYXRhO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ25vZGVzJyk7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlc09uY2UoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgam9iVHlwZXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgZ2V0Tm9kZURldGFpbHModm0ubm9kZUlkKTtcbiAgICAgICAgICAgICAgICBnZXROb2RlcygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbm9kZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICR0aW1lb3V0LCAkdWliTW9kYWwsIG5hdlNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBub2RlVXBkYXRlU2VydmljZSwgc3RhdHVzU2VydmljZSwgc3RhdGVTZXJ2aWNlLCB1c2VyU2VydmljZSwgam9iVHlwZVNlcnZpY2UsIGdyaWRGYWN0b3J5LCB0b2FzdHIsIHBvbGxlcikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLm5vZGVzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldE5vZGVzUGFyYW1zKCk7XG5cbiAgICAgICAgdm0uc3RhdGVTZXJ2aWNlID0gc3RhdGVTZXJ2aWNlO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0ubG9hZGluZ1N0YXR1cyA9IHRydWU7XG4gICAgICAgIHZtLnJlYWRvbmx5ID0gdHJ1ZTtcbiAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG4gICAgICAgIHZtLnNob3dBY3RpdmUgPSB2bS5ub2Rlc1BhcmFtcy5hY3RpdmUgPT09ICd0cnVlJztcbiAgICAgICAgdm0ubm9kZVR5cGUgPSB2bS5zaG93QWN0aXZlID8gJ0FjdGl2ZScgOiAnRGVwcmVjYXRlZCc7XG4gICAgICAgIHZtLm5vZGVUb3RhbHMgPSAnJztcbiAgICAgICAgdm0ubm9kZVN0YXRlcyA9IFtdO1xuICAgICAgICB2bS5zZWxlY3RlZE5vZGVTdGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGF0ZSB8fCAnQWxsJztcblxuICAgICAgICAkc2NvcGUucGF1c2VSZWFzb24gPSAnJztcblxuICAgICAgICB2YXIgYWxsTm9kZXMgPSBbXTtcbiAgICAgICAgdmFyIGZpbHRlcmVkQnlPcmRlciA9IHZtLm5vZGVzUGFyYW1zLm9yZGVyID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB2YXIgam9iVHlwZXMgPSBudWxsO1xuXG4gICAgICAgIHZtLmNvbERlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdob3N0bmFtZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdIb3N0bmFtZScsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB3aWR0aDogJzIwJScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnaG9zdG5hbWUuaHRtbCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdzdGF0ZS5uYW1lJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1N0YXRlJyxcbiAgICAgICAgICAgICAgICB3aWR0aDogJzEwJScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxkaXYgY2xhc3M9XCJwdWxsLXJpZ2h0XCI+PHNwYW4gY2xhc3M9XCJmYSBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBlcnJvclwiIG5nLXNob3c9XCJyb3cuZW50aXR5LmVycm9ycy5sZW5ndGggPiAwXCIgdG9vbHRpcC1hcHBlbmQtdG8tYm9keT1cInRydWVcIiB1aWItdG9vbHRpcD1cInt7IHJvdy5lbnRpdHkuZXJyb3JzLmxlbmd0aCA9PT0gMSA/IHJvdy5lbnRpdHkuZXJyb3JzWzBdLmRlc2NyaXB0aW9uIDogcm93LmVudGl0eS5lcnJvcnMubGVuZ3RoICsgXFwnIEVycm9yc1xcJyB9fVwiPjwvc3Bhbj4gPHNwYW4gY2xhc3M9XCJmYSBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSB3YXJuaW5nXCIgbmctc2hvdz1cInJvdy5lbnRpdHkud2FybmluZ3MubGVuZ3RoID4gMFwiIHRvb2x0aXAtYXBwZW5kLXRvLWJvZHk9XCJ0cnVlXCIgdWliLXRvb2x0aXA9XCJ7eyByb3cuZW50aXR5Lndhcm5pbmdzLmxlbmd0aCA9PT0gMSA/IHJvdy5lbnRpdHkud2FybmluZ3NbMF0uZGVzY3JpcHRpb24gOiByb3cuZW50aXR5Lndhcm5pbmdzLmxlbmd0aCArIFxcJyBXYXJuaW5nc1xcJyB9fVwiPjwvc3Bhbj48L2Rpdj48c3BhbiBuZy1iaW5kLWh0bWw9XCJyb3cuZW50aXR5LnN0YXRlLnRpdGxlXCIgdG9vbHRpcC1hcHBlbmQtdG8tYm9keT1cInRydWVcIiB1aWItdG9vbHRpcD1cInt7IHJvdy5lbnRpdHkuc3RhdGUuZGVzY3JpcHRpb24gfX1cIj48L3NwYW4+PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIiBuZy1zaG93PVwiZ3JpZC5hcHBTY29wZS52bS5zaG93QWN0aXZlXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZE5vZGVTdGF0ZVwiPjxvcHRpb24gbmctc2VsZWN0ZWQ9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLm5vZGVTdGF0ZXNbJGluZGV4XSA9PSBncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkTm9kZVN0YXRlIH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLm5vZGVTdGF0ZXNbJGluZGV4XSB9fVwiIG5nLXJlcGVhdD1cInN0YXRlIGluIGdyaWQuYXBwU2NvcGUudm0ubm9kZVN0YXRlcyB0cmFjayBieSAkaW5kZXhcIj57eyBzdGF0ZSB9fTwvb3B0aW9uPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdqb2JfZXhlY3V0aW9ucycsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgRXhlY3V0aW9ucyAoTGFzdCAzIEhycyknLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6ICcyMiUnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJ2pvYkV4ZWN1dGlvbnMuaHRtbCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyQ2VsbFRlbXBsYXRlOiAnam9iRXhlY3V0aW9uc0hlYWRlci5odG1sJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3J1bm5pbmdfam9icycsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdSdW5uaW5nIEpvYnMnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAncnVubmluZ0pvYnMuaHRtbCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gdm0uY29sRGVmcztcblxuICAgICAgICB2bS50b2dnbGVBY3RpdmUgPSBmdW5jdGlvbiAoZW50aXR5KSB7XG4gICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9ICFlbnRpdHkuaXNfYWN0aXZlO1xuICAgICAgICAgICAgbm9kZVVwZGF0ZVNlcnZpY2UudXBkYXRlTm9kZShlbnRpdHkuaWQsIHsgcGF1c2VfcmVhc29uOiAnJywgaXNfcGF1c2VkOiBlbnRpdHkuaXNfcGF1c2VkLCBpc19hY3RpdmU6IGlzQWN0aXZlIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gXy5maW5kKHZtLmdyaWRPcHRpb25zLmRhdGEsIHsgaWQ6IHJlc3VsdC5pZCB9KTtcbiAgICAgICAgICAgICAgICBlbnRpdHkuaXNfYWN0aXZlID0gcmVzdWx0LmlzX2FjdGl2ZTtcbiAgICAgICAgICAgICAgICBpZiAoZW50aXR5LmlzX2FjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuaW5mbyhub2RlLmhvc3RuYW1lICsgJyBBY3RpdmF0ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuaW5mbyhub2RlLmhvc3RuYW1lICsgJyBEZWFjdGl2YXRlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlc3VtZU5vZGUgPSBmdW5jdGlvbiAoZW50aXR5KSB7XG4gICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIG5vZGVVcGRhdGVTZXJ2aWNlLnVwZGF0ZU5vZGUoZW50aXR5LmlkLCB7IHBhdXNlX3JlYXNvbjogbnVsbCwgaXNfcGF1c2VkOiBmYWxzZSwgaXNfYWN0aXZlOiBlbnRpdHkuaXNfYWN0aXZlIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gXy5maW5kKHZtLmdyaWRPcHRpb25zLmRhdGEsIHsgaWQ6IHJlc3VsdC5pZCB9KTtcbiAgICAgICAgICAgICAgICBlbnRpdHkuaXNfcGF1c2VkID0gcmVzdWx0LmlzX3BhdXNlZDtcbiAgICAgICAgICAgICAgICB0b2FzdHIuaW5mbyhub2RlLmhvc3RuYW1lICsgJyBSZXN1bWVkJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5wYXVzZU5vZGUgPSBmdW5jdGlvbiAoZW50aXR5KSB7XG4gICAgICAgICAgICAkc2NvcGUucGF1c2VSZWFzb24gPSAnJztcbiAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAkc2NvcGUudXBkYXRlUmVhc29uID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhdXNlUmVhc29uID0gdmFsdWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXVzZURpYWxvZy5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbm9kZVVwZGF0ZVNlcnZpY2UudXBkYXRlTm9kZShlbnRpdHkuaWQsIHsgcGF1c2VfcmVhc29uOiAkc2NvcGUucGF1c2VSZWFzb24sIGlzX3BhdXNlZDogdHJ1ZSwgaXNfYWN0aXZlOiBlbnRpdHkuaXNfYWN0aXZlIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IF8uZmluZCh2bS5ncmlkT3B0aW9ucy5kYXRhLCB7IGlkOiByZXN1bHQuaWQgfSk7XG4gICAgICAgICAgICAgICAgICAgIGVudGl0eS5pc19wYXVzZWQgPSByZXN1bHQuaXNfcGF1c2VkO1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuaW5mbyhub2RlLmhvc3RuYW1lICsgJyBQYXVzZWQnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZpbHRlclJlc3VsdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwb2xsZXIuc3RvcEFsbCgpO1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldE5vZGVzUGFyYW1zKHZtLm5vZGVzUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgZ2V0Tm9kZXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDb2xEZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyh2bS5jb2xEZWZzLCB2bS5ub2Rlc1BhcmFtcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlTm9kZU9yZGVyID0gZnVuY3Rpb24gKHNvcnRBcnIpIHtcbiAgICAgICAgICAgIHZtLm5vZGVzUGFyYW1zLm9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwID8gc29ydEFyciA6IG51bGw7XG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlTm9kZUFjdGl2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvcm1hdFJlc3VsdHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uYWN0aW9uQ2xpY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCh7fSk7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbm9kZXMvJyArIHJvdy5lbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5jb3JlLm9uLnNvcnRDaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGdyaWQsIHNvcnRDb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmdyaWRBcGkuZ3JpZC5jb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbC5jb2xEZWYuc29ydCA9IGNvbC5zb3J0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXROb2Rlc0NvbERlZnModm0uZ3JpZEFwaS5ncmlkLm9wdGlvbnMuY29sdW1uRGVmcyk7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVOb2RlT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZm9ybWF0UmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjdXJyTm9kZVR5cGUgPSB2bS5zaG93QWN0aXZlID8gJ0FjdGl2ZScgOiAnRGVwcmVjYXRlZCc7XG4gICAgICAgICAgICB2YXIgYWx0Tm9kZVR5cGUgPSB2bS5zaG93QWN0aXZlID8gJ0RlcHJlY2F0ZWQnIDogJ0FjdGl2ZSc7XG4gICAgICAgICAgICB2bS5ub2RlcyA9IF8uZmlsdGVyKGFsbE5vZGVzLCB7IGlzX2FjdGl2ZTogdm0uc2hvd0FjdGl2ZSB9KTtcbiAgICAgICAgICAgIHZtLm5vZGVUb3RhbHMgPSB2bS5ub2Rlcy5sZW5ndGggKyAnICcgKyBjdXJyTm9kZVR5cGUgKyAnIE5vZGVzIC8gJyArIChhbGxOb2Rlcy5sZW5ndGggLSB2bS5ub2Rlcy5sZW5ndGgpICsgJyAnICsgYWx0Tm9kZVR5cGUgKyAnIE5vZGVzJztcbiAgICAgICAgICAgIHZtLm5vZGVTdGF0ZXMgPSBfLnNvcnRCeShfLnVuaXEoXy5tYXAodm0ubm9kZXMsICdzdGF0ZS50aXRsZScpKSk7XG4gICAgICAgICAgICB2YXIgaGFzU2VsZWN0ZWRTdGF0ZSA9IF8uZmluZCh2bS5ub2RlU3RhdGVzLCBmdW5jdGlvbiAocykgeyByZXR1cm4gcyA9PT0gdm0uc2VsZWN0ZWROb2RlU3RhdGU7IH0pO1xuICAgICAgICAgICAgaWYgKCFoYXNTZWxlY3RlZFN0YXRlICYmIHZtLnNlbGVjdGVkTm9kZVN0YXRlICE9PSAnQWxsJykge1xuICAgICAgICAgICAgICAgIHZtLm5vZGVTdGF0ZXMucHVzaCh2bS5zZWxlY3RlZE5vZGVTdGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5ub2RlU3RhdGVzLnVuc2hpZnQoJ0FsbCcpO1xuICAgICAgICAgICAgdmFyIG9yZGVyID0gJGxvY2F0aW9uLnNlYXJjaCgpLm9yZGVyO1xuICAgICAgICAgICAgdmFyIHN0YXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXRlO1xuICAgICAgICAgICAgaWYgKG9yZGVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpZWxkQXJyID0gW107XG4gICAgICAgICAgICAgICAgdmFyIGRpcmVjdGlvbkFyciA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChvcmRlciwgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRBcnIucHVzaChfLnN0YXJ0c1dpdGgobywgJy0nKSA/IF8udGFpbChvKS5qb2luKCcnKSA6IG8pO1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25BcnIucHVzaChfLnN0YXJ0c1dpdGgob3JkZXIsICctJykgPyAnZGVzYycgOiAnYXNjJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0ubm9kZXMgPSBfLnNvcnRCeU9yZGVyKHZtLm5vZGVzLCBmaWVsZEFyciwgZGlyZWN0aW9uQXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5ub2RlcywgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBub2RlLnJ1bm5pbmdfam9icyA9IGdldFJ1bm5pbmdKb2JzKG5vZGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgZmlsdGVyZWROb2RlcyA9IF8uY2xvbmVEZWVwKHZtLm5vZGVzKTtcbiAgICAgICAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkTm9kZXMgPSBfLmZpbHRlcihmaWx0ZXJlZE5vZGVzLCB7IHN0YXRlOiB7IHRpdGxlOiBzdGF0ZSB9fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZmlsdGVyZWROb2Rlcy5sZW5ndGg7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gZmlsdGVyZWROb2Rlcy5sZW5ndGg7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IGZpbHRlcmVkTm9kZXMubGVuZ3RoO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IGZpbHRlcmVkTm9kZXM7XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0UnVubmluZ0pvYnMgPSBmdW5jdGlvbiAoZW50aXR5KSB7XG4gICAgICAgICAgICB2YXIgcnVubmluZ0pvYnMgPSBbXTtcbiAgICAgICAgICAgIF8uZm9yRWFjaChlbnRpdHkuam9iX2V4ZWN1dGlvbnMucnVubmluZy5ieV9qb2JfdHlwZSwgZnVuY3Rpb24gKGpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICBydW5uaW5nSm9icy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgam9iVHlwZTogXy5maW5kKGpvYlR5cGVzLCB7IGlkOiBqb2JUeXBlLmpvYl90eXBlX2lkIH0pLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogam9iVHlwZS5jb3VudFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcnVubmluZ0pvYnM7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldE5vZGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcG9sbGVyLnN0b3BBbGwoKTtcbiAgICAgICAgICAgIHN0YXR1c1NlcnZpY2UuZ2V0U3RhdHVzKHRydWUpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubm9kZXNFcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGFsbE5vZGVzID0gZGF0YS5ub2RlcztcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0UmVzdWx0cygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1c1RleHQgJiYgZGF0YS5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubm9kZXNFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5ub2Rlc0Vycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBub2Rlcy4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzT25jZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBqb2JUeXBlcyA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICBnZXROb2RlcygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ub2Rlc1BhcmFtcy5zdGF0ZSA9IHZtLnNob3dBY3RpdmUgPyB2bS5zZWxlY3RlZE5vZGVTdGF0ZSAhPT0gJ0FsbCcgPyB2bS5zZWxlY3RlZE5vZGVTdGF0ZSA6IG51bGwgOiBudWxsO1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldE5vZGVzUGFyYW1zKHZtLm5vZGVzUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICB2bS5yZWFkb25seSA9ICEodXNlciAmJiB1c2VyLmlzX2FkbWluKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ25vZGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0Tm9kZXNDb2xEZWZzKCknLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmNvbERlZnMgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXROb2Rlc1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5ub2Rlc1BhcmFtcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zaG93QWN0aXZlJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5ub2Rlc1BhcmFtcy5hY3RpdmUgPSBuZXdWYWx1ZS50b1N0cmluZygpO1xuICAgICAgICAgICAgdm0ubm9kZXNQYXJhbXMuc3RhdGUgPSBuZXdWYWx1ZSA/IHZtLnNlbGVjdGVkTm9kZVN0YXRlICE9PSAnQWxsJyA/IHZtLnNlbGVjdGVkTm9kZVN0YXRlIDogbnVsbCA6IG51bGw7XG4gICAgICAgICAgICB2bS5zaG93QWN0aXZlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS5ub2RlVHlwZSA9IG5ld1ZhbHVlID8gJ0FjdGl2ZScgOiAnRGVwcmVjYXRlZCc7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Tm9kZXNQYXJhbXModm0ubm9kZXNQYXJhbXMpO1xuICAgICAgICAgICAgZm9ybWF0UmVzdWx0cygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZE5vZGVTdGF0ZScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0ubm9kZXNQYXJhbXMuc3RhdGUgPSBuZXdWYWx1ZSAhPT0gJ0FsbCcgPyBuZXdWYWx1ZSA6IG51bGw7XG4gICAgICAgICAgICBnZXROb2RlcygpO1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldE5vZGVzUGFyYW1zKHZtLm5vZGVzUGFyYW1zKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpe1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc05vZGVIZWFsdGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLm5vZGVzID0gW107XG4gICAgICAgIHZtLmdyb3VwZWROb2RlcyA9IFtdO1xuICAgICAgICB2bS50b3RhbE5vZGVzID0gMDtcblxuICAgICAgICB2YXIgZ2V0Tm9kZVN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnRvdGFsTm9kZXMgPSB2bS5ub2Rlcy5sZW5ndGg7XG4gICAgICAgICAgICBpZiAodm0udG90YWxOb2RlcyA+IDApIHtcbiAgICAgICAgICAgICAgICB2bS5ncm91cGVkTm9kZXMgPSBfLnBhaXJzKF8uZ3JvdXBCeSh2bS5ub2RlcywgJ3N0YXRlLnRpdGxlJykpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRvbnV0RGF0YSA9IFtdO1xuXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmdyb3VwZWROb2RlcywgZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogZ3JvdXBbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogZ3JvdXBbMV0ubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdm0ubm9kZUhlYWx0aCA9IGRvbnV0RGF0YTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0ubm9kZUhlYWx0aCA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHZtLm5vZGVzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgdm0udG90YWxOb2RlcyA9IG5ld1ZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBnZXROb2RlU3RhdHVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pLmRpcmVjdGl2ZSgnYWlzTm9kZUhlYWx0aCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2FnZTogPGFpcy1ub2RlLWhlYWx0aCAvPlxuICAgICAgICAgKiovXG4gICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNOb2RlSGVhbHRoQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9ub2Rlcy9kaXJlY3RpdmVzL25vZGVIZWFsdGhUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcbiAgICAgICAgICAgICAgICAgc2hvd0Rlc2NyaXB0aW9uOiAnPScsXG4gICAgICAgICAgICAgICAgIGxvYWRpbmc6ICc9JyxcbiAgICAgICAgICAgICAgICAgbm9kZVR5cGU6ICdAJ1xuICAgICAgICAgICAgIH1cbiAgICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdub2RlU3RhdHVzR3JpZENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24pIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcyxcbiAgICAgICAgICAgIGNlbGxTaXplID0gJHNjb3BlLmNlbGxTaXplIHx8ICcxMHB4JztcblxuICAgICAgICB2bS5ub2RlcyA9IFtdO1xuICAgICAgICB2bS5ob3VycyA9ICRzY29wZS5ob3VycyB8fCAzO1xuICAgICAgICB2bS5jZWxsU3R5bGUgPSB7XG4gICAgICAgICAgICB3aWR0aDogY2VsbFNpemUsXG4gICAgICAgICAgICBoZWlnaHQ6IGNlbGxTaXplXG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0Tm9kZUNsYXNzID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnZXROb2RlQ2xhc3MnKTtcbiAgICAgICAgICAgIGlmICghbm9kZS5pc19vbmxpbmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ29mZmxpbmUnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlLmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2lzLXBhdXNlZCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2lzLXBhdXNlZC1lcnJvcnMnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnb25saW5lJztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS52aWV3Tm9kZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ25vZGVzLycgKyBpZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXy5mb3JFYWNoKG5ld1ZhbHVlLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgICAgIGlmICghbm9kZS5pc19vbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5jbGFzcyA9ICdvZmZsaW5lJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlLmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jbGFzcyA9ICdpcy1wYXVzZWQnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUubm9kZS5pc19wYXVzZWRfZXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLmNsYXNzID0gJ2lzLXBhdXNlZC1lcnJvcnMnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jbGFzcyA9ICdvbmxpbmUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ub2RlcyA9IG5ld1ZhbHVlO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ2Fpc05vZGVTdGF0dXNHcmlkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ25vZGVTdGF0dXNHcmlkQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbm9kZXMvZGlyZWN0aXZlcy9ub2RlU3RhdHVzR3JpZFRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxuICAgICAgICAgICAgICAgIGhvdXJzOiAnPScsXG4gICAgICAgICAgICAgICAgY2VsbFNpemU6ICdAJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24oKXtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdOb2RlJywgZnVuY3Rpb24gKE5vZGVSZXNvdXJjZXMsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgTm9kZSA9IGZ1bmN0aW9uIChpZCwgaG9zdG5hbWUsIHBhdXNlX3JlYXNvbiwgaXNfcGF1c2VkLCBpc19hY3RpdmUsIGRlcHJlY2F0ZWQsIGNyZWF0ZWQsIGxhc3RfbW9kaWZpZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSBob3N0bmFtZTtcbiAgICAgICAgICAgIHRoaXMucGF1c2VfcmVhc29uID0gcGF1c2VfcmVhc29uO1xuICAgICAgICAgICAgdGhpcy5pc19wYXVzZWQgPSBpc19wYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuZGVwcmVjYXRlZCA9IGRlcHJlY2F0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIE5vZGUucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ05vZGUnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIG9ubHkgdXNlZCByZXZlYWwgPSB0cnVlIG9uIGdyaWRDaGFydCBkaXJlY3RpdmVcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0bmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0bmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1BhdXNlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzX3BhdXNlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgTm9kZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wYXVzZV9yZWFzb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfcGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXByZWNhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5vZGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBOb2RlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKE5vZGUuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5vZGUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIE5vZGU7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnTm9kZVJlc291cmNlcycsIGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBOb2RlUmVzb3VyY2VzID0gZnVuY3Rpb24gKHRvdGFsLCBzY2hlZHVsZWQsIHVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMudG90YWwgPSB0b3RhbDtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVkID0gc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy51c2VkID0gdXNlZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIE5vZGVSZXNvdXJjZXMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgLy8gZ2V0RHVyYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIE5vZGVSZXNvdXJjZXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5vZGVSZXNvdXJjZXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudG90YWwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBOb2RlUmVzb3VyY2VzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgTm9kZVJlc291cmNlcy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChOb2RlUmVzb3VyY2VzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5vZGVSZXNvdXJjZXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIE5vZGVSZXNvdXJjZXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdub2RlU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsICRyZXNvdXJjZSwgc2NhbGVDb25maWcsIE5vZGUsIHBvbGxlciwgcG9sbGVyRmFjdG9yeSkge1xuICAgICAgICB2YXIgZ2V0Tm9kZXNQYXJhbXMgPSBmdW5jdGlvbiAob3JkZXIsIGFjdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIsXG4gICAgICAgICAgICAgICAgYWN0aXZlOiBhY3RpdmVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldE5vZGVzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldE5vZGVzUGFyYW1zKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbm9kZXNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ25vZGVzJykgKyAnbm9kZXMvJywgcGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgbm9kZXNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihub2Rlc1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLm5vZGVzKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBub2Rlc1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBOb2RlLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Tm9kZXNPbmNlOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldE5vZGVzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdub2RlcycpICsgJ25vZGVzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IE5vZGUudHJhbnNmb3JtZXIoZGF0YS5ub2Rlcyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXR1cm5EYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2RlOiBmdW5jdGlvbiAoc2xhdmVJZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdub2RlcycpICsgJ25vZGVzLycgKyBzbGF2ZUlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gTm9kZS50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybkRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2RlRGF0YTogZnVuY3Rpb24gKHNsYXZlSWQsIHNpbmNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICBzaW5jZSA9IHNpbmNlIHx8ICdQVDNIJztcblxuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldE5vZGVzKCkudGhlbihmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ub2RlcyA9IG5vZGVzO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXROb2RlU3RhdHVzKHNpbmNlKS50aGVuKGZ1bmN0aW9uIChzdGF0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0cyA9IHN0YXRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdub2RlVXBkYXRlU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsIHNjYWxlQ29uZmlnLCBOb2RlKSB7XG4gICAgICAgIHZhciBnZXROb2RlVXBkYXRlRGF0YSA9IGZ1bmN0aW9uIChwYXVzZV9yZWFzb24sIGlzX3BhdXNlZCwgaXNfYWN0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhdXNlX3JlYXNvbjogcGF1c2VfcmVhc29uLFxuICAgICAgICAgICAgICAgIGlzX3BhdXNlZDogaXNfcGF1c2VkLFxuICAgICAgICAgICAgICAgIGlzX2FjdGl2ZTogaXNfYWN0aXZlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1cGRhdGVOb2RlOiBmdW5jdGlvbiAoaWQsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YSB8fCBnZXROb2RlVXBkYXRlRGF0YSgpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ25vZGVzJykgKyAnbm9kZXMvJyArIGlkICsgJy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKE5vZGUudHJhbnNmb3JtZXIocmVzdWx0KSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ292Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgbmF2U2VydmljZSwgbm9kZVNlcnZpY2UsIGpvYlNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCBzdGF0dXNTZXJ2aWNlLCBnYXVnZUZhY3RvcnksIHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIHNjaGVkdWxlclNlcnZpY2UsIHVzZXJTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5kYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgdm0uam9iRXJyb3IgPSBudWxsO1xuICAgICAgICB2bS5qb2JFcnJvclN0YXR1cyA9IG51bGw7XG4gICAgICAgIHZtLmxvYWRpbmdKb2JzID0gdHJ1ZTtcbiAgICAgICAgdm0ubG9hZGluZ05vZGVIZWFsdGggPSB0cnVlO1xuICAgICAgICB2bS5qb2JUeXBlcyA9IFtdO1xuICAgICAgICB2bS5ub2RlcyA9IFtdO1xuICAgICAgICB2bS5ub2RlSGVhbHRoRXJyb3IgPSBudWxsO1xuICAgICAgICB2bS5ub2RlSGVhbHRoRXJyb3JTdGF0dXMgPSAnJztcbiAgICAgICAgdm0uaG91clZhbHVlID0gMztcbiAgICAgICAgdm0uam9iRGF0YSA9IHtcbiAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgICBzdGF0dXM6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgdm0uam9iRXJyb3JCcmVha2Rvd24gPSBbXTtcbiAgICAgICAgdm0uc3RhdHVzID0gbnVsbDtcbiAgICAgICAgdm0uc3RhdHVzRXJyb3IgPSBudWxsO1xuICAgICAgICB2bS5sb2FkaW5nU3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgdm0ubWFzdGVyU3RhdHVzID0gJyc7XG4gICAgICAgIHZtLm1hc3RlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LXN1Y2Nlc3MnO1xuICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXMgPSAnJztcbiAgICAgICAgdm0uc2NoZWR1bGVyU3RhdHVzQ2xhc3MgPSAnYWxlcnQtc3VjY2Vzcyc7XG4gICAgICAgIHZtLm1lbUNhbGMgPSAnJztcbiAgICAgICAgdm0uZGlza0NhbGMgPSAnJztcbiAgICAgICAgdm0uc2NoZWR1bGVySXNQYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgdm0udXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICB2bS5zY2hlZHVsZXJDb250YWluZXJDbGFzcyA9IHZtLnVzZXIgPyB2bS51c2VyLmlzX2FkbWluID8gJ2NvbC14cy04IGNvbC1sZy0xMCcgOiAnY29sLXhzLTEyJyA6ICdjb2wteHMtMTInO1xuICAgICAgICB2bS5zY2hlZHVsZXJCdG5DbGFzcyA9ICdmYS1wYXVzZSc7XG5cbiAgICAgICAgdm0udG9nZ2xlU2NoZWR1bGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uc2NoZWR1bGVySXNQYXVzZWQgPSAhdm0uc2NoZWR1bGVySXNQYXVzZWQ7XG4gICAgICAgICAgICB2YXIgc2NoZWR1bGVyRGF0YSA9IHtcbiAgICAgICAgICAgICAgICBpc19wYXVzZWQ6IHZtLnNjaGVkdWxlcklzUGF1c2VkXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2NoZWR1bGVyU2VydmljZS51cGRhdGVTY2hlZHVsZXIoc2NoZWR1bGVyRGF0YSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1cyA9IGRhdGEuaXNfcGF1c2VkID8gJ1BhdXNlZCcgOiAnUnVubmluZyc7XG4gICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyU3RhdHVzQ2xhc3MgPSBkYXRhLmlzX3BhdXNlZCA/ICdhbGVydC13YXJuaW5nJyA6ICdhbGVydC1zdWNjZXNzJztcbiAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJCdG5DbGFzcyA9IGRhdGEuaXNfcGF1c2VkID8gJ2ZhLXBsYXknIDogJ2ZhLXBhdXNlJztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciByZWRyYXdHcmlkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3JlZHJhd0dyaWQnLCB2bS5qb2JEYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlcygpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uam9iRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2bS5qb2JEYXRhLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIHJlZHJhd0dyaWQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXNUZXh0ICYmIGRhdGEuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmpvYkVycm9yU3RhdHVzID0gZGF0YS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYkVycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBqb2IgdHlwZXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ0pvYnMgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRTdGF0dXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY3B1R2F1Z2UgPSBnYXVnZUZhY3RvcnkuY3JlYXRlR2F1Z2UoJ2NwdScsICdDUFUnLCAwLCAxMDAsIDE4MCksXG4gICAgICAgICAgICAgICAgbWVtR2F1Z2UgPSBnYXVnZUZhY3RvcnkuY3JlYXRlR2F1Z2UoJ21lbW9yeScsICdNZW1vcnknLCAwLCAxMDAsIDE4MCksXG4gICAgICAgICAgICAgICAgZGlza0dhdWdlID0gZ2F1Z2VGYWN0b3J5LmNyZWF0ZUdhdWdlKCdkaXNrJywgJ0Rpc2snLCAwLCAxMDAsIDE4MCk7XG5cbiAgICAgICAgICAgIHN0YXR1c1NlcnZpY2UuZ2V0U3RhdHVzKCkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdHVzRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2bS5zdGF0dXMgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIGNwdUdhdWdlLnJlZHJhdyhyZXN1bHQuZ2V0Q3B1VXNhZ2UoKSk7XG4gICAgICAgICAgICAgICAgICAgIG1lbUdhdWdlLnJlZHJhdyhyZXN1bHQuZ2V0TWVtVXNhZ2UoKSk7XG4gICAgICAgICAgICAgICAgICAgIGRpc2tHYXVnZS5yZWRyYXcocmVzdWx0LmdldERpc2tVc2FnZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgdm0ubWFzdGVyU3RhdHVzID0gcmVzdWx0Lm1hc3Rlci5pc19vbmxpbmUgPyAnTWFzdGVyIGlzIE9ubGluZScgOiAnTWFzdGVyIGlzIE9mZmxpbmUnO1xuICAgICAgICAgICAgICAgICAgICB2bS5tYXN0ZXJTdGF0dXNDbGFzcyA9IHJlc3VsdC5tYXN0ZXIuaXNfb25saW5lID8gJ2FsZXJ0LXN1Y2Nlc3MnIDogJ2FsZXJ0LWRhbmdlcic7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc2NoZWR1bGVyLmlzX29ubGluZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyU3RhdHVzID0gcmVzdWx0LnNjaGVkdWxlci5pc19wYXVzZWQgPyAnU2NoZWR1bGVyIGlzIFBhdXNlZCcgOiAnU2NoZWR1bGVyIGlzIFJ1bm5pbmcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyU3RhdHVzQ2xhc3MgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZCA/ICdhbGVydC13YXJuaW5nJyA6ICdhbGVydC1zdWNjZXNzJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlcklzUGF1c2VkID0gcmVzdWx0LnNjaGVkdWxlci5pc19wYXVzZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJCdG5DbGFzcyA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkID8gJ2ZhLXBsYXknIDogJ2ZhLXBhdXNlJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1cyA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkID8gJ1NjaGVkdWxlciBpcyBPZmZsaW5lOyBQYXVzZWQnIDogJ1NjaGVkdWxlciBpcyBPZmZsaW5lJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LWRhbmdlcic7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJJc1BhdXNlZCA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyQnRuQ2xhc3MgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZCA/ICdmYS1wbGF5JyA6ICdmYS1wYXVzZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5yZXNvdXJjZXMuc2NoZWR1bGVkLm1lbSAmJiByZXN1bHQucmVzb3VyY2VzLnRvdGFsLm1lbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubWVtQ2FsYyA9IHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWIocmVzdWx0LnJlc291cmNlcy5zY2hlZHVsZWQubWVtKSArICcgLyAnICsgc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbU1pYihyZXN1bHQucmVzb3VyY2VzLnRvdGFsLm1lbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5yZXNvdXJjZXMuc2NoZWR1bGVkLmRpc2sgJiYgcmVzdWx0LnJlc291cmNlcy50b3RhbC5kaXNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5kaXNrQ2FsYyA9IHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWIocmVzdWx0LnJlc291cmNlcy5zY2hlZHVsZWQuZGlzaykgKyAnIC8gJyArIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWIocmVzdWx0LnJlc291cmNlcy50b3RhbC5kaXNrKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXR1c0Vycm9yID0gcmVzdWx0LnN0YXR1c1RleHQgJiYgcmVzdWx0LnN0YXR1c1RleHQgIT09ICcnID8gcmVzdWx0LnN0YXR1c1RleHQgOiAnVW5hYmxlIHRvIHJldHJpZXZlIGNsdXN0ZXIgc3RhdHVzLic7XG4gICAgICAgICAgICAgICAgICAgIGNwdUdhdWdlLnJlZHJhdygtMSk7XG4gICAgICAgICAgICAgICAgICAgIG1lbUdhdWdlLnJlZHJhdygtMSk7XG4gICAgICAgICAgICAgICAgICAgIGRpc2tHYXVnZS5yZWRyYXcoLTEpO1xuICAgICAgICAgICAgICAgICAgICB2bS5tYXN0ZXJTdGF0dXMgPSAnTWFzdGVyIFN0YXR1cyBpcyBVbmtub3duJztcbiAgICAgICAgICAgICAgICAgICAgdm0ubWFzdGVyU3RhdHVzQ2xhc3MgPSAnYWxlcnQtZGFuZ2VyJztcbiAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyQ29udGFpbmVyQ2xhc3MgPSAnY29sLXhzLTEyJztcbiAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyU3RhdHVzID0gJ1NjaGVkdWxlciBTdGF0dXMgaXMgVW5rbm93bic7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LWRhbmdlcic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdTdGF0dXMgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXROb2RlU3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdHVzU2VydmljZS5nZXRTdGF0dXModHJ1ZSkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5ub2RlSGVhbHRoRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2bS5ub2RlcyA9IF8uZmlsdGVyKGRhdGEubm9kZXMsIHsgaXNfYWN0aXZlOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1c1RleHQgJiYgZGF0YS5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubm9kZUhlYWx0aEVycm9yU3RhdHVzID0gZGF0YS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVIZWFsdGhFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgbm9kZXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ05vZGVIZWFsdGggPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdqb2JUeXBlU3RhdHVzJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICB2bS5qb2JEYXRhLnN0YXR1cyA9IGRhdGE7XG4gICAgICAgICAgICByZWRyYXdHcmlkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgICAgIGdldFN0YXR1cygpO1xuICAgICAgICAgICAgZ2V0Tm9kZVN0YXR1cygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignb3ZlcnZpZXcnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdyZWNpcGVEZXRhaWxzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCBuYXZTZXJ2aWNlLCByZWNpcGVTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSwgdXNlclNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnJlY2lwZSA9IHt9O1xuICAgICAgICB2bS5yZWNpcGVJZCA9ICRyb3V0ZVBhcmFtcy5pZDtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5yZWNpcGVzO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdyZWNpcGVzJyk7XG4gICAgICAgIHZtLmxvYWRpbmdSZWNpcGVEZXRhaWwgPSB0cnVlO1xuICAgICAgICB2bS5hY3RpdmVUYWIgPSAnc3RhdHVzJztcbiAgICAgICAgdm0ubGFzdFN0YXR1c0NoYW5nZSA9ICcnO1xuXG4gICAgICAgIHZtLmdldFJlY2lwZURldGFpbCA9IGZ1bmN0aW9uIChyZWNpcGVJZCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZ1JlY2lwZURldGFpbCA9IHRydWU7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZURldGFpbHMocmVjaXBlSWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGUgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlVHlwZURldGFpbChkYXRhLnJlY2lwZV90eXBlLmlkKS50aGVuKGZ1bmN0aW9uKHJlY2lwZVR5cGUpe1xuICAgICAgICAgICAgICAgICAgICB2bS5yZWNpcGVUeXBlID0gcmVjaXBlVHlwZTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ1JlY2lwZURldGFpbCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgIHZtLmdldFJlY2lwZURldGFpbCh2bS5yZWNpcGVJZCk7XG4gICAgICAgIH07XG5cblxuXG4gICAgICAgIHZtLnN3aXRjaFRhYiA9IGZ1bmN0aW9uICh0YWIpIHtcbiAgICAgICAgICAgICQoJyMnICsgdm0uYWN0aXZlVGFiKS5oaWRlKCk7XG4gICAgICAgICAgICB2bS5hY3RpdmVUYWIgPSB0YWI7XG4gICAgICAgICAgICAkKCcjJyArIHZtLmFjdGl2ZVRhYikuc2hvdygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3JlY2lwZVR5cGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkdWliTW9kYWwsIGhvdGtleXMsIHNjYWxlU2VydmljZSwgbmF2U2VydmljZSwgcmVjaXBlU2VydmljZSwgc3VibmF2U2VydmljZSwgam9iVHlwZVNlcnZpY2UsIHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlLCB1c2VyU2VydmljZSwgbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnJztcbiAgICAgICAgdm0ucmVjaXBlVHlwZXMgPSBbXTtcbiAgICAgICAgdm0ucmVjaXBlVHlwZUlkcyA9IFtdO1xuICAgICAgICB2bS5yZXF1ZXN0ZWRSZWNpcGVUeXBlSWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICB2bS5hY3RpdmVSZWNpcGVUeXBlID0gbnVsbDtcbiAgICAgICAgdm0ucGVyY2VudGFnZSA9IDczO1xuICAgICAgICB2bS5kYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgdm0ucmVjaXBlcyA9IG51bGw7XG4gICAgICAgIHZtLm1vZGUgPSAndmlldyc7IC8vIHZhbGlkIHZhbHVlcyBhcmUgYWRkLCB2aWV3LCBhbmQgZWRpdFxuICAgICAgICB2bS5hZGRCdG5UZXh0ID0gJ05ldyBSZWNpcGUnO1xuICAgICAgICB2bS5hZGRCdG5DbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgIHZtLmFkZEJ0bkljb24gPSAnZmEtcGx1cy1jaXJjbGUnO1xuICAgICAgICB2bS5lZGl0QnRuVGV4dCA9ICdFZGl0JztcbiAgICAgICAgdm0uZWRpdEJ0bkNsYXNzID0gJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgdm0uZWRpdEJ0bkljb24gPSAnZmEtZWRpdCc7XG4gICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBbXTtcbiAgICAgICAgdm0uaXNSZWNpcGVNb2RpZmllZCA9IGZhbHNlO1xuICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5tYXN0ZXJDbGFzcyA9ICdjb2wteHMtMyc7XG4gICAgICAgIHZtLmRldGFpbENsYXNzID0gJ2NvbC14cy05JztcbiAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSBmYWxzZTtcbiAgICAgICAgdm0ubWluaW1pemVCdG5DbGFzcyA9ICdmYSBmYS1jaGV2cm9uLWxlZnQnO1xuICAgICAgICB2bS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgIHZtLnNjYWxlQ29uZmlnID0gc2NhbGVDb25maWc7XG4gICAgICAgIHZtLmxvY2FsUmVjaXBlVHlwZXMgPSBbXTtcblxuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLnJlY2lwZXM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ3JlY2lwZXMvdHlwZXMnKTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgIGdldFJlY2lwZVR5cGVzKCk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgZ2V0UmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVzKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb0pzb24gPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNLZXk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoOyBzS2V5ID0gbG9jYWxTdG9yYWdlLmtleShpKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvSnNvbltzS2V5XSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHNLZXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF8uZmlsdGVyKF8ucGFpcnMob0pzb24pLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8uY29udGFpbnMob1swXSwgJ3JlY2lwZVR5cGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gSlNPTi5wYXJzZShvWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2NhbFJlY2lwZVR5cGVzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVjaXBlVHlwZXMucHVzaCh0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVJZHMgPSBfLnBsdWNrKGRhdGEsICdpZCcpO1xuICAgICAgICAgICAgICAgIHZtLnZpZXdSZWNpcGVUeXBlRGV0YWlsKHZtLnJlcXVlc3RlZFJlY2lwZVR5cGVJZCk7XG4gICAgICAgICAgICAgICAgaG90a2V5cy5iaW5kVG8oJHNjb3BlKVxuICAgICAgICAgICAgICAgICAgICAuYWRkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJvOiAnY3RybCt1cCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1ByZXZpb3VzIFJlY2lwZSBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IF8uaW5kZXhPZih2bS5yZWNpcGVUeXBlSWRzLCB2bS5hY3RpdmVSZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRSZWNpcGVUeXBlKHZtLnJlY2lwZVR5cGVJZHNbaWR4IC0gMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm86ICdjdHJsK2Rvd24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOZXh0IFJlY2lwZSBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IF8uaW5kZXhPZih2bS5yZWNpcGVUeXBlSWRzLCB2bS5hY3RpdmVSZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA8ICh2bS5yZWNpcGVUeXBlSWRzLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2FkUmVjaXBlVHlwZSh2bS5yZWNpcGVUeXBlSWRzW2lkeCArIDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jbGVhckxvY2FsUmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfLmZvckVhY2godm0ubG9jYWxSZWNpcGVUeXBlcywgZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncmVjaXBlVHlwZScgKyB0eXBlLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ubmV3UmVjaXBlVHlwZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvdHlwZXMvMCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnZpZXdSZWNpcGVUeXBlRGV0YWlsID0gZnVuY3Rpb24gKHJlY2lwZVR5cGVJZCkge1xuICAgICAgICAgICAgaWYgKHJlY2lwZVR5cGVJZCA+IDApIHtcbiAgICAgICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVEZXRhaWwocmVjaXBlVHlwZUlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVJlY2lwZVR5cGUgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmKCByZWNpcGVUeXBlSWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVSZWNpcGVUeXBlID0gbmV3IFJlY2lwZVR5cGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5sb2FkUmVjaXBlVHlwZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUgJiYgdm0uYWN0aXZlUmVjaXBlVHlwZS5tb2RpZmllZCkge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1DaGFuZ2VSZWNpcGUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT0tcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzLycgKyBpZCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDYW5jZWxcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvdHlwZXMvJyArIGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY29uZmlybUNoYW5nZVJlY2lwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb25maXJtRGlhbG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ3NtJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBtb2RhbEluc3RhbmNlLnJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVNYXN0ZXIgPSBmdW5jdGlvbiAobWluaW1pemVNYXN0ZXIpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbWluaW1pemVNYXN0ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSBtaW5pbWl6ZU1hc3RlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSAhdm0ubWluaW1pemVNYXN0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5tYXN0ZXJDbGFzcyA9IHZtLm1pbmltaXplTWFzdGVyID8gJ2NvbC14cy0xIG1pbmltaXplZCcgOiAnY29sLXhzLTMnO1xuICAgICAgICAgICAgdm0uZGV0YWlsQ2xhc3MgPSB2bS5taW5pbWl6ZU1hc3RlciA/ICdjb2wteHMtMTEnIDogJ2NvbC14cy05JztcbiAgICAgICAgICAgIHZtLm1pbmltaXplQnRuQ2xhc3MgPSB2bS5taW5pbWl6ZU1hc3RlciA/ICdmYSBmYS1jaGV2cm9uLXJpZ2h0JyA6ICdmYSBmYS1jaGV2cm9uLWxlZnQnO1xuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCd0b2dnbGVFZGl0JywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICB2bS50b2dnbGVNYXN0ZXIoZGF0YSA9PT0gJ2VkaXQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdyZWNpcGVNb2RpZmllZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmlzUmVjaXBlTW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0uc2F2ZUJ0bkNsYXNzID0gJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lck1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4Oyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3JlY2lwZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIHJlY2lwZVNlcnZpY2UsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGdyaWRGYWN0b3J5LCBwb2xsZXIpIHtcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgncmVjaXBlcycpO1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICByZWNpcGVUeXBlVmlld0FsbCA9IHsgbmFtZTogJ1ZJRVcgQUxMJywgdGl0bGU6ICdWSUVXIEFMTCcsIHZlcnNpb246ICcnLCBpZDogMCB9O1xuXG4gICAgICAgIHZtLnJlY2lwZXNQYXJhbXMgPSBzdGF0ZVNlcnZpY2UuZ2V0UmVjaXBlc1BhcmFtcygpO1xuXG4gICAgICAgIHZtLnN0YXRlU2VydmljZSA9IHN0YXRlU2VydmljZTtcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnJlY2lwZVR5cGVWYWx1ZXMgPSBbcmVjaXBlVHlwZVZpZXdBbGxdO1xuICAgICAgICB2bS5zZWxlY3RlZFJlY2lwZVR5cGUgPSB2bS5yZWNpcGVzUGFyYW1zLnR5cGVfaWQgPyB2bS5yZWNpcGVzUGFyYW1zLnR5cGVfaWQgOiByZWNpcGVUeXBlVmlld0FsbDtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5yZWNpcGVzO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydCA9IG1vbWVudC51dGModm0ucmVjaXBlc1BhcmFtcy5zdGFydGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3AgPSBtb21lbnQudXRjKHZtLnJlY2lwZXNQYXJhbXMuZW5kZWQpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZGF0ZU1vZGVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpbWV6b25lOiAnKzAwMCdcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gdm0ucmVjaXBlc1BhcmFtcy5wYWdlIHx8IDE7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSA9IHZtLnJlY2lwZXNQYXJhbXMucGFnZV9zaXplIHx8IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuXG4gICAgICAgIHZhciBmaWx0ZXJlZEJ5UmVjaXBlVHlwZSA9IHZtLnJlY2lwZXNQYXJhbXMudHlwZV9pZCA/IHRydWUgOiBmYWxzZSxcbiAgICAgICAgICAgIGZpbHRlcmVkQnlPcmRlciA9IHZtLnJlY2lwZXNQYXJhbXMub3JkZXIgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgdm0uY29sRGVmcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3JlY2lwZV90eXBlJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1JlY2lwZSBUeXBlJyxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5yZWNpcGVfdHlwZS50aXRsZSB9fSB7eyByb3cuZW50aXR5LnJlY2lwZV90eXBlLnZlcnNpb24gfX08L2Rpdj4nLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRSZWNpcGVUeXBlXCIgbmctb3B0aW9ucz1cInJlY2lwZVR5cGUgYXMgKHJlY2lwZVR5cGUudGl0bGUgKyBcXCcgXFwnICsgcmVjaXBlVHlwZS52ZXJzaW9uKSBmb3IgcmVjaXBlVHlwZSBpbiBncmlkLmFwcFNjb3BlLnZtLnJlY2lwZVR5cGVWYWx1ZXNcIj48L3NlbGVjdD4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnY3JlYXRlZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdDcmVhdGVkIChaKScsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5jcmVhdGVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdsYXN0X21vZGlmaWVkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0xhc3QgTW9kaWZpZWQgKFopJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5Lmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2R1cmF0aW9uJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAxMjAsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50cyB0ZXh0LXJpZ2h0XCI+e3sgcm93LmVudGl0eS5nZXREdXJhdGlvbigpIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2NvbXBsZXRlZCcsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmNvbXBsZXRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ2V0UmVjaXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlcyh2bS5yZWNpcGVzUGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXRSZWNpcGVUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlVHlwZXMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVjaXBlVHlwZVZhbHVlcy5wdXNoKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgdm0ucmVjaXBlVHlwZVZhbHVlcyA9IF8uZmxhdHRlbih2bS5yZWNpcGVUeXBlVmFsdWVzKTtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFJlY2lwZVR5cGUgPSBfLmZpbmQodm0ucmVjaXBlVHlwZVZhbHVlcywgeyBpZDogdm0ucmVjaXBlc1BhcmFtcy50eXBlX2lkIH0pIHx8IHJlY2lwZVR5cGVWaWV3QWxsO1xuICAgICAgICAgICAgICAgIHZtLmdldFJlY2lwZXMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZpbHRlclJlc3VsdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwb2xsZXIuc3RvcEFsbCgpO1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFJlY2lwZXNQYXJhbXModm0ucmVjaXBlc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmdldFJlY2lwZXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDb2xEZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyh2bS5jb2xEZWZzLCB2bS5yZWNpcGVzUGFyYW1zKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVSZWNpcGVPcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLm9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwID8gc29ydEFyciA6IG51bGw7XG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlUmVjaXBlVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlLmlkICE9PSB2bS5yZWNpcGVzUGFyYW1zLnR5cGVfaWQpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0ucmVjaXBlc1BhcmFtcy50eXBlX2lkID0gdmFsdWUuaWQgPT09IDAgPyBudWxsIDogdmFsdWUuaWQ7XG4gICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvcmVjaXBlLycgKyByb3cuZW50aXR5LmlkKS5zZWFyY2goJycpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVjaXBlc1BhcmFtcy5wYWdlID0gY3VycmVudFBhZ2U7XG4gICAgICAgICAgICAgICAgdm0ucmVjaXBlc1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuY29yZS5vbi5zb3J0Q2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChncmlkLCBzb3J0Q29sdW1ucykge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5ncmlkQXBpLmdyaWQuY29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICBjb2wuY29sRGVmLnNvcnQgPSBjb2wuc29ydDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0UmVjaXBlc0NvbERlZnModm0uZ3JpZEFwaS5ncmlkLm9wdGlvbnMuY29sdW1uRGVmcyk7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVSZWNpcGVPcmRlcihzb3J0QXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0UmVjaXBlc1BhcmFtcyh2bS5yZWNpcGVzUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgICAgIHZtLmdldFJlY2lwZVR5cGVzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdyZWNpcGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkUmVjaXBlVHlwZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gXy5maW5kKHZtLnJlY2lwZVR5cGVWYWx1ZXMsIHtpZDogcGFyc2VJbnQodmFsdWUpfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeVJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZVJlY2lwZVR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRCeVJlY2lwZVR5cGUgPSAhYW5ndWxhci5lcXVhbHModmFsdWUsIHJlY2lwZVR5cGVWaWV3QWxsKTtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlUmVjaXBlVHlwZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdGFydCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVjaXBlc1BhcmFtcy5zdGFydGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmxhc3RNb2RpZmllZFN0b3AnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZXNQYXJhbXMuZW5kZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXRSZWNpcGVzQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0UmVjaXBlc1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIi8qKlxuICogPGFpcy1zY2FsZS1yZWNpcGUtdmlld2VyIC8+XG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzU2NhbGVSZWNpcGVHcmFwaFZpZXdlckNvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCAkbG9jYXRpb24sICR1aWJNb2RhbCwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgam9iVHlwZVNlcnZpY2UsIHJlY2lwZVNlcnZpY2UsIHdvcmtzcGFjZXNTZXJ2aWNlLCBSZWNpcGVUeXBlLCBSZWNpcGVUeXBlRGV0YWlsLCBKb2JUeXBlLCBsb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS52ZXJ0aWNlcyA9IFtdO1xuICAgICAgICB2bS5lZGdlcyA9IFtdO1xuICAgICAgICB2bS5zZWxlY3RlZEpvYiA9IG51bGw7XG4gICAgICAgIHZtLnNlbGVjdGVkSW5wdXRQcm92aWRlciA9IG51bGw7XG4gICAgICAgIHZtLm1vZGUgPSBudWxsO1xuICAgICAgICB2bS5lZGl0TW9kZSA9IG51bGw7XG4gICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1wbHVzJztcbiAgICAgICAgdm0uYWRkQnRuVGV4dCA9ICdOZXcgUmVjaXBlJztcbiAgICAgICAgdm0uYWRkQnRuQ2xhc3MgPSAnYnRuLXByaW1hcnknO1xuICAgICAgICB2bS5hZGRCdG5JY29uID0gJ2ZhLXBsdXMtY2lyY2xlJztcbiAgICAgICAgdm0uZWRpdEJ0blRleHQgPSAnRWRpdCc7XG4gICAgICAgIHZtLmVkaXRCdG5DbGFzcyA9ICdidG4tc3VjY2Vzcyc7XG4gICAgICAgIHZtLmVkaXRCdG5JY29uID0gJ2ZhLWVkaXQnO1xuICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gW107XG4gICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICB2bS53YXJuaW5ncyA9IFtdO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLmRldGFpbE1heEhlaWdodCA9IDA7XG4gICAgICAgIHZtLnJlY2lwZVR5cGVUcmlnZ2VyID0geyBkYXRhVHlwZXM6ICcnIH07XG4gICAgICAgIHZtLmRldGFpbENvbnRhaW5lclN0eWxlID0gJyc7XG4gICAgICAgIHZtLmNvbnRhaW5lckNsYXNzID0gJHNjb3BlLmhhc0NvbnRhaW5lciA/ICcnIDogJ2RldGFpbC1jb250YWluZXIgbm8tdGFicyc7XG4gICAgICAgIHZtLmxhc3RTdGF0dXNDaGFuZ2UgPSAnJztcbiAgICAgICAgdm0uYXZhaWxhYmxlV29ya3NwYWNlcyA9IFtdO1xuICAgICAgICB2bS5yZWNpcGVJbnB1dFR5cGVzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdwcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdQcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgZmllbGRzOiBbXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZmlsZScsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdGaWxlJyxcbiAgICAgICAgICAgICAgICBmaWVsZHM6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ21lZGlhX3R5cGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTWVkaWEgVHlwZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFtdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdmaWxlcycsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdGaWxlcycsXG4gICAgICAgICAgICAgICAgZmllbGRzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdtZWRpYV90eXBlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ01lZGlhIFR5cGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuICAgICAgICB2bS5hdmFpbGFibGVUcmlnZ2VyVHlwZXMgPSBzY2FsZUNvbmZpZy50cmlnZ2VyVHlwZXM7XG4gICAgICAgIHZtLnNlbGVjdGVkUmVjaXBlSW5wdXRUeXBlID0ge307XG4gICAgICAgIHZtLnJlY2lwZUlucHV0ID0ge1xuICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIHR5cGU6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHZtLmlzSUUgPSBzY2FsZVNlcnZpY2UuaXNJRSgpO1xuXG4gICAgICAgIHZhciBzdGFydEpvYiA9IG51bGw7XG4gICAgICAgIHZhciB6b29tU2NhbGUgPSAwO1xuXG4gICAgICAgIC8vIERhZ3JlIHZhcmlhYmxlc1xuICAgICAgICB2YXIgc3ZnID0gbnVsbDtcbiAgICAgICAgdmFyIGlubmVyID0gbnVsbDtcbiAgICAgICAgdmFyIGdyYXBoID0gbnVsbDtcbiAgICAgICAgdmFyIHpvb20gPSBudWxsO1xuICAgICAgICB2YXIgcmVuZGVyID0gbnVsbDtcblxuICAgICAgICB2YXIgZ2V0Q2xvc2VzdE5vZGUgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIGQzLnNlbGVjdEFsbCgnLm5vZGVSZWN0JykuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQgPT09IG5hbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0T3RoZXJOb2RlcyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gZDMuc2VsZWN0QWxsKCcubm9kZVJlY3QnKS5maWx0ZXIoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZCAhPT0gbmFtZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciByZXNldEVkaXRCdG4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5lZGl0QnRuVGV4dCA9IHZtLm1vZGUgPT09ICdlZGl0JyA/ICdDYW5jZWwgRWRpdCcgOiAnRWRpdCc7XG4gICAgICAgICAgICB2bS5lZGl0QnRuQ2xhc3MgPSB2bS5tb2RlID09PSAnZWRpdCcgPyAnYnRuLXdhcm5pbmcnIDogJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgICAgIHZtLmVkaXRCdG5JY29uID0gdm0ubW9kZSA9PT0gJ2VkaXQnID8gJ2ZhLWNsb3NlJyA6ICdmYS1lZGl0JztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcmVzZXRBZGRCdG4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5hZGRCdG5UZXh0ID0gdm0ubW9kZSA9PT0gJ2FkZCcgPyAnQ2FuY2VsJyA6ICdOZXcgUmVjaXBlJztcbiAgICAgICAgICAgIHZtLmFkZEJ0bkNsYXNzID0gdm0ubW9kZSA9PT0gJ2FkZCcgPyAnYnRuLXdhcm5pbmcnIDogJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgICAgIHZtLmFkZEJ0bkljb24gPSB2bS5tb2RlID09PSAnYWRkJyA/ICdmYS1jbG9zZScgOiAnZmEtcGx1cy1jaXJjbGUnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB0b2dnbGVBZGRSZWNpcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5tb2RlID0gdm0ubW9kZSA9PT0gJ2FkZCcgPyAndmlldycgOiAnYWRkJztcbiAgICAgICAgICAgIHJlc2V0QWRkQnRuKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHRvZ2dsZUVkaXRSZWNpcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodm0ubW9kZSA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgdm0ubW9kZSA9ICd2aWV3JztcbiAgICAgICAgICAgICAgICB2bS5yZWxvYWRSZWNpcGVUeXBlRGV0YWlsKCRzY29wZS5yZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0ubW9kZSA9ICdlZGl0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJyc7XG4gICAgICAgICAgICByZXNldEVkaXRCdG4oKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZW5hYmxlU2F2ZVJlY2lwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLm1vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9ICdidG4tc3VjY2Vzcyc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGRpc2FibGVTYXZlUmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUubW9kaWZpZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9ICdidG4tZGVmYXVsdDsnXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNvbmZpcm1DaGFuZ2VSZWNpcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHZtLmFuaW1hdGlvbnNFbmFibGVkLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29uZmlybURpYWxvZy5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIHNpemU6ICdzbSdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbW9kYWxJbnN0YW5jZS5yZXN1bHQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFJlY2lwZVR5cGVKb2JDbGFzc05hbWUgPSBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAvLyBkZWZhdWx0IHRvICdub3N0YXR1cydcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSAnbm9zdGF0dXMnO1xuICAgICAgICAgICAgLy8gZmluZCB0aGUgYXNzb2NpYXRlZCBqb2IgaW4gdGhlIHJlY2lwZS5qb2JzXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZSkge1xuICAgICAgICAgICAgICAgIHZhciByZWNpcGVqb2IgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZS5qb2JzLHtqb2JfbmFtZTogam9iLm5hbWV9KTtcbiAgICAgICAgICAgICAgICBpZiAocmVjaXBlam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9IHJlY2lwZWpvYi5qb2Iuc3RhdHVzLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNsYXNzTmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZWxvYWRSZWNpcGVUeXBlRGV0YWlsID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICB2YXIgZ2V0UmVjaXBlRGV0YWlsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlVHlwZURldGFpbChpZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZSA9IGRhdGE7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlVHlwZS5tb2RpZmllZCkge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1DaGFuZ2VSZWNpcGUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT0tcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRBZGRCdG4oKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLm1vZGUgPT09ICdlZGl0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRWRpdFJlY2lwZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGdldFJlY2lwZURldGFpbCgpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsXG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLm1vZGUgPT09ICdlZGl0Jykge1xuICAgICAgICAgICAgICAgICAgICB0b2dnbGVFZGl0UmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc2V0QWRkQnRuKCk7XG4gICAgICAgICAgICAgICAgZ2V0UmVjaXBlRGV0YWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgICAgICAgICAgLy8kcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlY2lwZU1vZGlmaWVkJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ubm9kZUNsaWNrID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIC8vIFJlbW92ZSBzZWxlY3Rpb24gY2xhc3NcbiAgICAgICAgICAgIC8vJCgnZGl2JykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUnKTtcbiAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLm5vZGVSZWN0JykuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZScsIGZhbHNlKTtcblxuICAgICAgICAgICAgLy8gZmluZCB0aGUgam9iIGluIHRoZSByZWNpcGUgZGVmaW5pdGlvblxuICAgICAgICAgICAgdmFyIGpvYiA9IF8uZmluZCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMsIHsgbmFtZTogbmFtZSB9KTtcblxuICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdzdGFydCcpIHtcbiAgICAgICAgICAgICAgICBqb2IgPSBzdGFydEpvYjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciAkbmFtZSA9ICQoJyMnICsgbmFtZSk7XG4gICAgICAgICAgICB2YXIgcG9zID0gJG5hbWUucG9zaXRpb24oKTtcblxuICAgICAgICAgICAgLy8gY2xpY2sgbm9kZSBkaWZmZXJlbnQgZnJvbSBzZWxlY3RlZEpvYlxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZEpvYiB8fCBqb2IubmFtZSAhPT0gdm0uc2VsZWN0ZWRKb2IubmFtZSkge1xuICAgICAgICAgICAgICAgIGlmICh2bS5lZGl0TW9kZSA9PT0gJ2FkZERlcGVuZGVuY3knKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZERlcGVuZGVuY3kobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdm0ucmVkcmF3KCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZtLmVkaXRNb2RlID09PSAnYWRkSW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50U3RyID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2IubmFtZSA9PT0gJ3N0YXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9ICc8dWwgY2xhc3M9XCJsaXN0LWdyb3VwXCI+JztcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmlucHV0X2RhdGEsIGZ1bmN0aW9uIChyZWNpcGVJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxsaSBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbVwiPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGEgb25jbGljaz1cIm1hcElucHV0UmVjaXBlSW5wdXQoXFwnJyArIHJlY2lwZUlucHV0Lm5hbWUgKyAnXFwnKVwiPicgKyByZWNpcGVJbnB1dC5uYW1lICsgJzwvYT4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWNpcGVJbnB1dC5tZWRpYV90eXBlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8ZGl2IGNsYXNzPVwiaW5wdXQtbWVkaWEtdHlwZXNcIj4nICsgcmVjaXBlSW5wdXQubWVkaWFfdHlwZXMuam9pbignLCcpICsgJzwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzwvbGk+JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPC91bD4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgJG5hbWUucG9wb3Zlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiAnYm9keScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29udGVudFN0cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnU2VsZWN0IHByb3ZpZGVyL291dHB1dCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJG5hbWUucG9wb3Zlcignc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2Uub3V0cHV0X2RhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSAnPHVsIGNsYXNzPVwibGlzdC1ncm91cFwiPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2Uub3V0cHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JPdXRwdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGxpIGNsYXNzPVwibGlzdC1ncm91cC1pdGVtXCI+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGEgb25jbGljaz1cIm1hcElucHV0KFxcJycgKyBqb2IubmFtZSArICdcXCcsIFxcJycgKyBqb2JPdXRwdXQubmFtZSArICdcXCcpXCI+JyArIGpvYk91dHB1dC5uYW1lICsgJzwvYT4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoam9iT3V0cHV0Lm1lZGlhX3R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxkaXYgY2xhc3M9XCJpbnB1dC1tZWRpYS10eXBlc1wiPicgKyBqb2JPdXRwdXQubWVkaWFfdHlwZSArICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzwvbGk+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8L3VsPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5hbWUucG9wb3Zlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogJ2JvZHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50U3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1NlbGVjdCBwcm92aWRlci9vdXRwdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5hbWUucG9wb3Zlcignc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5lZGl0TW9kZSA9PT0gJ2FkZE91dHB1dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRPdXRwdXRSZWNlaXZlciA9IGpvYjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2UuaW5wdXRfZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gJzx1bCBjbGFzcz1cImxpc3QtZ3JvdXBcIj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2UuaW5wdXRfZGF0YSwgZnVuY3Rpb24gKGpvYklucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGxpIGNsYXNzPVwibGlzdC1ncm91cC1pdGVtXCI+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8YSBvbmNsaWNrPVwibWFwT3V0cHV0KFxcJycgKyBqb2IubmFtZSArICdcXCcsIFxcJycgKyBqb2JJbnB1dC5uYW1lICsgJ1xcJylcIj4nICsgam9iSW5wdXQubmFtZSArICc8L2E+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoam9iSW5wdXQubWVkaWFfdHlwZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGRpdiBjbGFzcz1cImlucHV0LW1lZGlhLXR5cGVzXCI+JyArIGpvYklucHV0Lm1lZGlhX3R5cGVzLmpvaW4oJywnKSArICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8L2xpPic7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzwvdWw+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogJ2JvZHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRTdHIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1NlbGVjdCByZWNlaXZlci9pbnB1dCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJG5hbWUucG9wb3Zlcignc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBzZWxlY3RlZCBqb2JcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2IgPSBqb2I7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFJlY2lwZUpvYiA9IF8uZmluZCgkc2NvcGUucmVjaXBlLmpvYnMsIHsgam9iX25hbWU6IGpvYi5uYW1lIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGFwcGx5IHRoZSBzZWxlY3RlZC1ub2RlIGNsYXNzXG4gICAgICAgICAgICAgICAgICAgIC8vJG5hbWUuYWRkQ2xhc3MoJ3NlbGVjdGVkLW5vZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q2xvc2VzdE5vZGUobmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZScsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgeyAvLyBjbGljayBzZWxlY3RlZCBub2RlXG4gICAgICAgICAgICAgICAgLy8kKCdkaXYnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQtbm9kZScpO1xuICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLm5vZGVSZWN0JykuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYiA9IG51bGw7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVKb2IgPSBudWxsO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkT3V0cHV0UmVjZWl2ZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSW5wdXRQcm92aWRlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICB2bS5kZXBlbmRlbmN5QnRuQ2xhc3MgPSAnZmEtcGx1cyc7XG5cbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgICAgIGdldE90aGVyTm9kZXMobmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJywgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkSm9iKSB7XG4gICAgICAgICAgICAgICAgLy8kKCcjJyArIHZtLnNlbGVjdGVkSm9iLm5hbWUpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlJyk7XG4gICAgICAgICAgICAgICAgZ2V0Q2xvc2VzdE5vZGUodm0uc2VsZWN0ZWRKb2IubmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZScsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2bS50b2dnbGVFZGl0TW9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh2bS5tb2RlID09PSAnZWRpdCcpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWxvYWRSZWNpcGVUeXBlRGV0YWlsKCRzY29wZS5yZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlRWRpdFJlY2lwZSgpO1xuICAgICAgICAgICAgICAgIHJlc2V0QWRkQnRuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3RvZ2dsZUVkaXQnLCB2bS5tb2RlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5vcGVuQWRkSm9iID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB2bS5hbmltYXRpb25zRW5hYmxlZCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FkZEpvYkNvbnRlbnQuaHRtbCcsXG4gICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICBzaXplOiAnc20nXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkSm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlRGV0YWlscyh2bS5zZWxlY3RlZEpvYlR5cGUuaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFkZEpvYlR5cGUoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ub3BlbkVkaXRUcmlnZ2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB2bS5hbmltYXRpb25zRW5hYmxlZCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2VkaXRUcmlnZ2VyLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh2bS5tb2RlID09PSAnZWRpdCcgfHwgdm0ubW9kZSA9PT0gJ2FkZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLmNvbmZpZ3VyYXRpb24uY29uZGl0aW9uLmRhdGFfdHlwZXMgPSB2bS5yZWNpcGVUeXBlVHJpZ2dlci5kYXRhVHlwZXMgPyB2bS5yZWNpcGVUeXBlVHJpZ2dlci5kYXRhVHlwZXMuc3BsaXQoJywnKSA6IFtdO1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB9KTtcblxuXG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZGVsZXRlUmVjaXBlSW5wdXQgPSBmdW5jdGlvbiAoaW5wdXROYW1lKSB7XG4gICAgICAgICAgICB2YXIgcmVtb3ZlZFJlY2lwZUlucHV0ID0gXy5yZW1vdmUoJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5pbnB1dF9kYXRhLCBmdW5jdGlvbiAocmVjaXBlSW5wdXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjaXBlSW5wdXQubmFtZSA9PT0gaW5wdXROYW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlZCAnICsgcmVtb3ZlZFJlY2lwZUlucHV0Lmxlbmd0aCArICcgcmVjaXBlIGlucHV0cy4nKTtcbiAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ub3BlbkFkZElucHV0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB2bS5hbmltYXRpb25zRW5hYmxlZCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FkZElucHV0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBmb3IgZmllbGRzIGFuZCBhZGQgYXMgbmVjZXNzYXJ5XG4gICAgICAgICAgICAgICAgaWYgKCB2bS5zZWxlY3RlZFJlY2lwZUlucHV0VHlwZS5maWVsZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLnNlbGVjdGVkUmVjaXBlSW5wdXRUeXBlLmZpZWxkcywgZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZmllbGQudmFsdWUuc3BsaXQoJywnKSwgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRBcnIucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJlY2lwZUlucHV0W2ZpZWxkLm5hbWVdID0gZmllbGRBcnI7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFkZCBpbnB1dCB0byByZWNpcGUgdHlwZSBkZWZpbml0aW9uXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5pbnB1dF9kYXRhLnB1c2godm0ucmVjaXBlSW5wdXQpO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMsIGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpvYi5yZWNpcGVfaW5wdXRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgam9iLnJlY2lwZV9pbnB1dHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX2lucHV0OiB2bS5yZWNpcGVJbnB1dC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2lwZV9pbnB1dDogdm0ucmVjaXBlSW5wdXQubmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBnZXRJb01hcHBpbmdzKCk7XG5cbiAgICAgICAgICAgICAgICAvLyByZXNldCBmb3JtIGZpZWxkc1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZUlucHV0ID0ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICcnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFJlY2lwZUlucHV0VHlwZSA9IHt9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2hhbmdlSW5wdXRUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVJbnB1dFR5cGUgPSBfLmZpbmQodm0ucmVjaXBlSW5wdXRUeXBlcywgeyduYW1lJzogdm0ucmVjaXBlSW5wdXQudHlwZX0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRXYXJuaW5nc0h0bWwgPSBmdW5jdGlvbiAod2FybmluZ3MpIHtcbiAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSAnJztcbiAgICAgICAgICAgIF8uZm9yRWFjaCh3YXJuaW5ncywgZnVuY3Rpb24gKHdhcm5pbmcpIHtcbiAgICAgICAgICAgICAgICB3YXJuaW5nc0h0bWwgKz0gJzxiPicgKyB3YXJuaW5nLmlkICsgJzo8L2I+ICcgKyB3YXJuaW5nLmRldGFpbHMgKyAnPGJyIC8+PGJyIC8+JztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd2FybmluZ3NIdG1sICs9ICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCBidG4teHMgY2xlYXJcIj5IaWRlPC9idXR0b24+JztcbiAgICAgICAgICAgIHJldHVybiB3YXJuaW5nc0h0bWw7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udmFsaWRhdGVSZWNpcGVUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmVjaXBlU2VydmljZS52YWxpZGF0ZVJlY2lwZVR5cGUoJHNjb3BlLnJlY2lwZVR5cGUpLnRoZW4oZnVuY3Rpb24gKHZhbGlkYXRpb25SZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyAmJiB2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzcGxheSB0aGUgd2FybmluZ3NcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdhcm5pbmdzSHRtbCA9IGdldFdhcm5pbmdzSHRtbCh2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzKTtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wid2FybmluZ1wiXSh3YXJuaW5nc0h0bWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0cltcInN1Y2Nlc3NcIl0oJ1JlY2lwZSBpcyB2YWxpZC4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0cltcImVycm9yXCJdKGVycm9yLmRldGFpbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wiZXJyb3JcIl0oZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH07XG5cblxuICAgICAgICB2bS5zYXZlUmVjaXBlVHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IHRydWU7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLnZhbGlkYXRlUmVjaXBlVHlwZSgkc2NvcGUucmVjaXBlVHlwZSkudGhlbihmdW5jdGlvbiAodmFsaWRhdGlvblJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzICYmIHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBkaXNwbGF5IHRoZSB3YXJuaW5nc1xuICAgICAgICAgICAgICAgICAgICB2YXIgd2FybmluZ3NIdG1sID0gZ2V0V2FybmluZ3NIdG1sKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MpO1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbXCJ3YXJuaW5nXCJdKHdhcm5pbmdzSHRtbCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZWNpcGVTZXJ2aWNlLnNhdmVSZWNpcGVUeXBlKCRzY29wZS5yZWNpcGVUeXBlKS50aGVuKGZ1bmN0aW9uIChzYXZlUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZSA9IFJlY2lwZVR5cGVEZXRhaWwudHJhbnNmb3JtZXIoc2F2ZVJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KCRzY29wZS5yZWNpcGVUeXBlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncmVjaXBlVHlwZScgKyAkc2NvcGUucmVjaXBlVHlwZS5pZCwgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlY2lwZVR5cGUpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzLycgKyAkc2NvcGUucmVjaXBlVHlwZS5pZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvci5kZXRhaWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRpc2FibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkSm9iVHlwZSA9IGZ1bmN0aW9uIChzZWxlY3RlZEpvYlR5cGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkSm9iVHlwZS5uYW1lKTtcbiAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uYWRkSm9iKHNlbGVjdGVkSm9iVHlwZSk7XG4gICAgICAgICAgICAvLyRzY29wZS4kYnJvYWRjYXN0KCdyZWRyYXdSZWNpcGVzJyk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBJbnB1dCA9IGZ1bmN0aW9uIChwcm92aWRlck5hbWUsIHByb3ZpZGVyT3V0cHV0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFwIHNlbGVjdGVkIGpvYiBpbnB1dCB0byAnICsgcHJvdmlkZXJOYW1lICsgJy4nICsgcHJvdmlkZXJPdXRwdXQpO1xuICAgICAgICAgICAgdmFyIGRlcGVuZGVuY3kgPSBfLmZpbmQodm0uc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLCB7bmFtZTogcHJvdmlkZXJOYW1lfSk7XG5cbiAgICAgICAgICAgIGlmIChkZXBlbmRlbmN5ICYmIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMgJiYgZGVwZW5kZW5jeS5jb25uZWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbm4gPSBfLmZpbmQoZGVwZW5kZW5jeS5jb25uZWN0aW9ucywgeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH0pO1xuICAgICAgICAgICAgICAgIGlmICghY29ubikge1xuICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLnB1c2goeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFkZXBlbmRlbmN5KSB7XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jeSA9IHtuYW1lOiBwcm92aWRlck5hbWUsIGNvbm5lY3Rpb25zOiBbeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH1dfTtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMucHVzaChkZXBlbmRlbmN5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMgPSBbeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH1dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2IuZGVwU3RhcnQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJyc7XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYklucHV0ID0gbnVsbDtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSW5wdXRQcm92aWRlciA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBJbnB1dFJlY2lwZUlucHV0ID0gZnVuY3Rpb24gKHJlY2lwZUlucHV0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFwIHNlbGVjdGVkIGpvYiB0byByZWNpcGUgaW5wdXQgJyArIHJlY2lwZUlucHV0KTtcbiAgICAgICAgICAgIHZhciBleGlzdGluZ0lucHV0ID0gXy5maW5kKHZtLnNlbGVjdGVkSm9iLnJlY2lwZV9pbnB1dHMsIHsgam9iX2lucHV0OiB2bS5zZWxlY3RlZEpvYklucHV0Lm5hbWUgfSk7XG4gICAgICAgICAgICBpZiAoIGV4aXN0aW5nSW5wdXQgJiYgZXhpc3RpbmdJbnB1dC5yZWNpcGVfbmFtZSAhPT0gcmVjaXBlSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaXRcbiAgICAgICAgICAgICAgICBleGlzdGluZ0lucHV0LnJlY2lwZV9pbnB1dCA9IHJlY2lwZUlucHV0O1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoICFleGlzdGluZ0lucHV0ICkge1xuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBpdFxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iLnJlY2lwZV9pbnB1dHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGpvYl9pbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICByZWNpcGVfaW5wdXQ6IHJlY2lwZUlucHV0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZW5hYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iSW5wdXQgPSBudWxsO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRJbnB1dFByb3ZpZGVyID0gbnVsbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBPdXRwdXQgPSBmdW5jdGlvbiAocmVjZWl2ZXJOYW1lLCByZWNlaXZlcklucHV0KSB7XG4gICAgICAgICAgICB2YXIgZGVwZW5kZW5jeSA9IF8uZmluZCh2bS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyLmRlcGVuZGVuY2llcywge25hbWU6IHZtLnNlbGVjdGVkSm9iLm5hbWV9KTtcblxuICAgICAgICAgICAgaWYgKGRlcGVuZGVuY3kgJiYgZGVwZW5kZW5jeS5jb25uZWN0aW9ucyAmJiBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubiA9IF8uZmluZChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCB7IG91dHB1dDogdm0uc2VsZWN0ZWRKb2JPdXRwdXQubmFtZSwgaW5wdXQ6IHJlY2VpdmVySW5wdXQgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb25uKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMucHVzaCh7b3V0cHV0OiB2bS5zZWxlY3RlZEpvYk91dHB1dC5uYW1lLCBpbnB1dDogcmVjZWl2ZXJJbnB1dH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFkZXBlbmRlbmN5KSB7XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jeSA9IHtuYW1lOiB2bS5zZWxlY3RlZEpvYi5uYW1lLCBjb25uZWN0aW9uczogW3tvdXRwdXQ6IHZtLnNlbGVjdGVkSm9iT3V0cHV0Lm5hbWUsIGlucHV0OiByZWNlaXZlcklucHV0fV19O1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkT3V0cHV0UmVjZWl2ZXIuZGVwZW5kZW5jaWVzLnB1c2goZGVwZW5kZW5jeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zID0gW3tvdXRwdXQ6IHZtLnNlbGVjdGVkSm9iT3V0cHV0Lm5hbWUsIGlucHV0OiByZWNlaXZlcklucHV0fV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyLmRlcFN0YXJ0ID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2JPdXRwdXQgPSBudWxsO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRPdXRwdXRSZWNlaXZlciA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGREZXBlbmRlbmN5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHZtLmVkaXRNb2RlID09PSAnYWRkRGVwZW5kZW5jeScpIHtcbiAgICAgICAgICAgICAgICB2bS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1wbHVzJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG9nZ2xlIGFkZERlcGVuZGVuY3kgbW9kZScpO1xuICAgICAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJ2FkZERlcGVuZGVuY3knO1xuICAgICAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1yZW1vdmUnO1xuICAgICAgICAgICAgICAgIGdldE90aGVyTm9kZXModm0uc2VsZWN0ZWRKb2IubmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy8kKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGRJbnB1dCA9IGZ1bmN0aW9uIChqb2JpbnB1dCkge1xuICAgICAgICAgICAgaWYgKHZtLmVkaXRNb2RlID09PSAnYWRkSW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYklucHV0ID0gam9iaW5wdXQ7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZ2dsZSBhZGRJbnB1dCBtb2RlJyk7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnYWRkSW5wdXQnO1xuICAgICAgICAgICAgICAgIGdldE90aGVyTm9kZXModm0uc2VsZWN0ZWRKb2IubmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy8kKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGRPdXRwdXQgPSBmdW5jdGlvbiAoam9ib3V0cHV0KSB7XG4gICAgICAgICAgICBpZiAodm0uZWRpdE1vZGUgPT09ICdhZGRPdXRwdXQnKSB7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYk91dHB1dCA9IGpvYm91dHB1dDtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG9nZ2xlIGFkZE91dHB1dCBtb2RlJyk7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnYWRkT3V0cHV0JztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIHRydWUpO1xuICAgICAgICAgICAgICAgIC8vJCgnLnJlY2lwZU5vZGU6bm90KFwiLnNlbGVjdGVkLW5vZGVcIiknKS5hZGRDbGFzcygnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVtb3ZlRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIChkZXBOYW1lKSB7XG4gICAgICAgICAgICB2YXIgcmVtb3ZlZERlcHMgPSBfLnJlbW92ZSh2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMsIGZ1bmN0aW9uIChkZXApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVwLm5hbWUgPT09IGRlcE5hbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVkICcgKyByZW1vdmVkRGVwcy5sZW5ndGggKyAnIGRlcGVuZGVuY2llcy4nKTtcbiAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlbW92ZUlucHV0TWFwcGluZyA9IGZ1bmN0aW9uIChkZXBOYW1lLCBkZXBPdXRwdXQpIHtcbiAgICAgICAgICAgIGlmICggZGVwTmFtZSA9PT0gJ3JlY2lwZScgKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGl0IGZyb20gc2VsZWN0ZWRKb2IucmVjaXBlX2lucHV0c1xuICAgICAgICAgICAgICAgIHZhciBkZXAgPSBfLnJlbW92ZSh2bS5zZWxlY3RlZEpvYi5yZWNpcGVfaW5wdXRzLCB7IHJlY2lwZV9pbnB1dDogZGVwT3V0cHV0IH0pO1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlcCA9IF8uZmluZCh2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMsIHtuYW1lOiBkZXBOYW1lfSk7XG4gICAgICAgICAgICAgICAgaWYgKGRlcCAmJiBkZXAuY29ubmVjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaXQncyBhbiBpbnB1dCBmcm9tIGFub3RoZXIgam9iXG4gICAgICAgICAgICAgICAgICAgIHZhciByZW1vdmVkQ29uID0gXy5yZW1vdmUoZGVwLmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbm4ub3V0cHV0ID09PSBkZXBPdXRwdXQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlZCAnICsgcmVtb3ZlZENvbi5sZW5ndGggKyAnIGlucHV0IGNvbm5lY3Rpb25zLicpO1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRlbGV0ZVJlY2lwZUpvYiA9IGZ1bmN0aW9uIChqb2JOYW1lKSB7XG4gICAgICAgICAgICAvLyByZW1vdmUgZGVwZW5kZW50IGNvbm5lY3Rpb25zXG4gICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgXy5yZW1vdmUoam9iLmRlcGVuZGVuY2llcywge25hbWU6IGpvYk5hbWV9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gcmVtb3ZlIGpvYiBmcm9tIGRlZmluaXRpb24uam9ic1xuICAgICAgICAgICAgXy5yZW1vdmUoJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCB7IG5hbWU6IGpvYk5hbWUgfSk7XG4gICAgICAgICAgICAvLyBlbmFibGUgc2F2ZSBhbmQgcmVkcmF3XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYiA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZW1vdmVPdXRwdXRNYXBwaW5nID0gZnVuY3Rpb24gKGpvYk5hbWUsIGRlcE91dHB1dCkge1xuICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byByZW1vdmUgb3V0cHV0IG1hcHBpbmcgZnJvbSB0aGUgam9iIHdoZXJlIHRoZSBkZXBlbmRlbmN5IGlzIGRlZmluZWRcbiAgICAgICAgICAgIHZhciByZWNlaXZlciA9IF8uZmluZCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMse25hbWU6IGpvYk5hbWV9KTtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBpdCBmcm9tIHJlY2VpdmVyLmRlcGVuZGVuY2llc1xuICAgICAgICAgICAgdmFyIGRlcCA9IF8uZmluZChyZWNlaXZlci5kZXBlbmRlbmNpZXMsIHtuYW1lOiB2bS5zZWxlY3RlZEpvYi5uYW1lfSk7XG4gICAgICAgICAgICBpZiAoZGVwICYmIGRlcC5jb25uZWN0aW9ucykge1xuICAgICAgICAgICAgICAgIHZhciByZW1vdmVkQ29uID0gXy5yZW1vdmUoZGVwLmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29ubi5vdXRwdXQgPT09IGRlcE91dHB1dDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlZCAnICsgcmVtb3ZlZENvbi5sZW5ndGggKyAnIG91dHB1dCBjb25uZWN0aW9ucy4nKTtcbiAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgdm0ucmVkcmF3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2VsZWN0Sm9iVHlwZVRvQWRkID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iVHlwZSA9IGl0ZW07XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiRvbigncmVkcmF3UmVjaXBlcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgYWRkRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIChqb2JOYW1lKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2bS5zZWxlY3RlZEpvYi5uYW1lICsgJy0+JyArIGpvYk5hbWUpO1xuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBleGlzdGluZ0RlcGVuZGVuY3kgPSBfLmZpbmQodm0uc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLCB7bmFtZTogam9iTmFtZX0pO1xuXG4gICAgICAgICAgICBpZiAoIWV4aXN0aW5nRGVwZW5kZW5jeSkgeyB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMucHVzaCh7bmFtZTogam9iTmFtZX0pOyB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBTdGFydCA9IGZhbHNlO1xuICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1wbHVzJztcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRJb01hcHBpbmdzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24pIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBvcHVsYXRlIHRoZSBjdXJyZW50IGpvYlR5cGVcbiAgICAgICAgICAgICAgICAgICAgLyp2YXIgdGhpc0pvYlR5cGUgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZVR5cGUuam9iX3R5cGVzLHtpZDogam9iLmpvYl90eXBlX2lkfSk7XG4gICAgICAgICAgICAgICAgICAgICBqb2Iuam9iX3R5cGUgPSB0aGlzSm9iVHlwZTsqL1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGZpbmQgZGVwZW5kZW50c1xuICAgICAgICAgICAgICAgICAgICBpZiAoam9iLmpvYl90eXBlICYmIGpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLm91dHB1dF9kYXRhLCBmdW5jdGlvbiAoam9iT3V0cHV0LCBrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoam9iT3V0cHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZXBzID0gZ2V0RGVwZW5kZW50cyhqb2IubmFtZSxqb2JPdXRwdXQubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYk91dHB1dC5kZXBlbmRlbnRzID0gZGVwcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBkZXBlbmRlbmN5IG1hcHBpbmdzXG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goam9iLmpvYl90eXBlLmpvYl90eXBlX2ludGVyZmFjZS5pbnB1dF9kYXRhLCBmdW5jdGlvbiAoam9iSW5wdXQsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqb2JJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5wdXRNYXBwaW5ncyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goam9iLmRlcGVuZGVuY2llcywgZnVuY3Rpb24gKGRlcGVuZGVuY3ksa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZGVwZW5kZW5jeS5jb25uZWN0aW9ucywgZnVuY3Rpb24gKGNvbm4sa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbm4uaW5wdXQgPT09IGpvYklucHV0Lm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRNYXBwaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGRlcGVuZGVuY3kubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dDogY29ubi5vdXRwdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogY29ubi5pbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2IucmVjaXBlX2lucHV0cywgZnVuY3Rpb24gKHJlY2lwZUlucHV0LCBrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWNpcGVJbnB1dC5qb2JfaW5wdXQgPT09IGpvYklucHV0Lm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dE1hcHBpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAncmVjaXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiByZWNpcGVJbnB1dC5yZWNpcGVfaW5wdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiByZWNpcGVJbnB1dC5qb2JfaW5wdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYklucHV0LmRlcGVuZGVuY2llcyA9IGlucHV0TWFwcGluZ3M7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzT25jZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZXMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uYXZhaWxhYmxlV29ya3NwYWNlcyA9IGRhdGFcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigncmVjaXBlVHlwZScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5yZWNpcGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlID0gbmV3IFJlY2lwZVR5cGUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mICRzY29wZS5yZWNpcGVUeXBlLmlkID09PSAndW5kZWZpbmVkJyB8fCAkc2NvcGUucmVjaXBlVHlwZS5pZCA9PT0gbnVsbCB8fCAkc2NvcGUucmVjaXBlVHlwZS5pZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLm1vZGUgIT09ICdlZGl0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubW9kZSA9ICd2aWV3J1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMsIGZ1bmN0aW9uIChqb2IsIGlkeCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2UgJiYgJHNjb3BlLnJlY2lwZVR5cGUuam9iX3R5cGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgam9iVHlwZURhdGEgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZVR5cGUuam9iX3R5cGVzLCB7bmFtZTogam9iLmpvYl90eXBlLm5hbWUsIHZlcnNpb246IGpvYi5qb2JfdHlwZS52ZXJzaW9ufSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnNbaWR4XS5qb2JfdHlwZSA9IGpvYlR5cGVEYXRhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBzZXR1cCBzdHJpbmcgdG8gYmluZCBjb21tYSBkZWxpbWl0ZWQgbGlzdCBvZiB0cmlnZ2VyIHJ1bGUgY29uZmlndXJhdGlvbiBjb25kaXRpb24gZGF0YSB0eXBlc1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlVHlwZS50cmlnZ2VyX3J1bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLmNvbmZpZ3VyYXRpb24uY29uZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uLmNvbmRpdGlvbi5kYXRhX3R5cGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVUcmlnZ2VyLmRhdGFUeXBlcyA9ICRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uLmNvbmRpdGlvbi5kYXRhX3R5cGVzLmpvaW4oJywnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpbml0R3JhcGgoKTtcbiAgICAgICAgICAgICAgICBnZXRJb01hcHBpbmdzKCk7XG4gICAgICAgICAgICAgICAgZHJhd0dyYXBoKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuJHBhcmVudC52bS51c2VyKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVhZG9ubHkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEdyYXBoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gKioqKioqXG4gICAgICAgICAgICAvLyBzZXR1cCBEMyBjb250YWluZXIgYW5kIEdyYXBoXG4gICAgICAgICAgICAvLyAqKioqKipcbiAgICAgICAgICAgIC8vdm0uc2VsZWN0ZWRKb2IgPSBudWxsO1xuICAgICAgICAgICAgZnVuY3Rpb24gY2xpY2tlZCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGQzLmV2ZW50O1xuICAgICAgICAgICAgICAgIHZhciB4ID0gZDMuZXZlbnQueDtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGQzLmV2ZW50Lnk7XG4gICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gcGFyc2VJbnQoc3ZnLnN0eWxlKFwid2lkdGhcIikucmVwbGFjZSgvcHgvLCBcIlwiKSk7XG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcnNlSW50KHN2Zy5zdHlsZShcImhlaWdodFwiKS5yZXBsYWNlKC9weC8sIFwiXCIpKTtcblxuICAgICAgICAgICAgICAgIGlubmVyLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyB3aWR0aCAvIDIgKyBcIixcIiArIGhlaWdodCAvIDIgKyBcIilzY2FsZSgyKXRyYW5zbGF0ZShcIiArIC14ICsgXCIsXCIgKyAteSArIFwiKVwiKTtcblxuICAgICAgICAgICAgICAgIC8vaW5uZXIuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSg1MHB4LCA1MHB4KXNjYWxlKDIsMylcIik7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KFwic3ZnXCIpO1xuICAgICAgICAgICAgaW5uZXIgPSBzdmcuc2VsZWN0KFwiZ1wiKTsgLy8ub24oXCJjbGlja1wiLCBjbGlja2VkKTtcbiAgICAgICAgICAgIC8vIFNldCB1cCB6b29tIHN1cHBvcnRcbiAgICAgICAgICAgIHpvb20gPSBkMy5iZWhhdmlvci56b29tKCkub24oXCJ6b29tXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB6b29tU2NhbGUgPSBkMy5ldmVudC5zY2FsZTtcbiAgICAgICAgICAgICAgICBpbm5lci5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgZDMuZXZlbnQudHJhbnNsYXRlICsgXCIpXCIgK1xuICAgICAgICAgICAgICAgICAgXCJzY2FsZShcIiArIHpvb21TY2FsZSArIFwiKVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc3ZnLmNhbGwoem9vbSk7XG5cbiAgICAgICAgICAgIHJlbmRlciA9IG5ldyBkYWdyZUQzLnJlbmRlcigpO1xuXG4gICAgICAgICAgICAvLyBMZWZ0LXRvLXJpZ2h0IGxheW91dFxuICAgICAgICAgICAgZ3JhcGggPSBuZXcgZGFncmVEMy5ncmFwaGxpYi5HcmFwaCgpO1xuICAgICAgICAgICAgZ3JhcGguc2V0R3JhcGgoe1xuICAgICAgICAgICAgICAgIG5vZGVzZXA6IDcwLFxuICAgICAgICAgICAgICAgIHJhbmtzZXA6IDUwLFxuICAgICAgICAgICAgICAgIHJhbmtkaXI6IFwiVEJcIixcbiAgICAgICAgICAgICAgICBtYXJnaW54OiAyMCxcbiAgICAgICAgICAgICAgICBtYXJnaW55OiAyMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZHJhd0dyYXBoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gZ2xvYmFscyBiZWNhdXNlIGRhZ3JlIG5lZWRzIGEgcmVmZXJlbmNlIHRvIGFuZ3VsYXIgc2NvcGVcbiAgICAgICAgICAgIHdpbmRvdy5ub2RlQ2xpY2sgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVjaXBldmlld2VyJykpLnNjb3BlKCk7XG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudm0ubm9kZUNsaWNrKG5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgd2luZG93Lm1hcElucHV0ID0gZnVuY3Rpb24gKGpvYk5hbWUsIGpvYk91dHB1dCkge1xuICAgICAgICAgICAgICAgICQoJyMnICsgam9iTmFtZSkucG9wb3ZlcignZGVzdHJveScpO1xuICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVjaXBldmlld2VyJykpLnNjb3BlKCk7XG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudm0ubWFwSW5wdXQoam9iTmFtZSwgam9iT3V0cHV0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHdpbmRvdy5tYXBJbnB1dFJlY2lwZUlucHV0ID0gZnVuY3Rpb24gKHJlY2lwZUlucHV0TmFtZSkge1xuICAgICAgICAgICAgICAgICQoJyNzdGFydCcpLnBvcG92ZXIoJ2Rlc3Ryb3knKTtcbiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXZpZXdlcicpKS5zY29wZSgpO1xuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnZtLm1hcElucHV0UmVjaXBlSW5wdXQocmVjaXBlSW5wdXROYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHdpbmRvdy5tYXBPdXRwdXQgPSBmdW5jdGlvbiAoam9iTmFtZSwgam9iSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAkKCcjJyArIGpvYk5hbWUpLnBvcG92ZXIoJ2Rlc3Ryb3knKTtcbiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXZpZXdlcicpKS5zY29wZSgpO1xuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnZtLm1hcE91dHB1dChqb2JOYW1lLCBqb2JJbnB1dCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZSkge1xuICAgICAgICAgICAgICAgIHZtLmxhc3RTdGF0dXNDaGFuZ2UgPSAkc2NvcGUucmVjaXBlLmxhc3RfbW9kaWZpZWQgPyBtb21lbnQuZHVyYXRpb24obW9tZW50LnV0Yygkc2NvcGUucmVjaXBlLmxhc3RfbW9kaWZpZWQpLmRpZmYobW9tZW50LnV0YygpKSkuaHVtYW5pemUodHJ1ZSkgOiAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGpvYnMgPSBbXTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uKSB7XG4gICAgICAgICAgICAgICAgam9icyA9ICRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uam9icztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjaGlsZENvdW50cyA9IFtdO1xuICAgICAgICAgICAgLy8gY3JlYXRlIGdyYXBoIG9iamVjdHNcbiAgICAgICAgICAgIGZvciAodmFyIGlkeCBpbiBqb2JzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGpvYiA9IGpvYnNbaWR4XTtcblxuICAgICAgICAgICAgICAgIGlmIChqb2IuZGVwZW5kZW5jaWVzID09PSB1bmRlZmluZWQgfHwgam9iLmRlcGVuZGVuY2llcy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGpvYi5kZXBTdGFydCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBnZXRSZWNpcGVUeXBlSm9iQ2xhc3NOYW1lKGpvYik7XG5cbiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICc8ZGl2IGNsYXNzPVwicmVjaXBlTm9kZVwiPic7XG4gICAgICAgICAgICAgICAgLy92YXIgaHRtbCA9IFwiPGRpdiBvbmNsaWNrPVxcXCJjb25zb2xlLmxvZygnXCIgKyBqb2Iuam9iX3R5cGUubmFtZSArIFwiJylcXFwiPlwiO1xuICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWUgIT09ICdub3N0YXR1cycpIHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPHNwYW4gY2xhc3M9XCJzdGF0dXNcIj48L3NwYW4+JztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gICBodG1sICs9IFwiPHNwYW4gY2xhc3M9Y29uc3VtZXJzPlwiK3dvcmtlci5jb25zdW1lcnMrXCI8L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnPHNwYW4gY2xhc3M9XCJuYW1lXCI+JztcbiAgICAgICAgICAgICAgICBpZiAoam9iLmpvYl90eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coam9iLmpvYlR5cGUpO1xuICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8ZGl2IGlkPVwiJyArIGpvYi5uYW1lICsgJ1wiIGNsYXNzPVwiXCIgb25jbGljaz1cIm5vZGVDbGljayhcXCcnICsgam9iLm5hbWUgKyAnXFwnKVwiPjxzcGFuIGNsYXNzPVwibmFtZVwiPicgKyBqb2Iuam9iX3R5cGUuZ2V0SWNvbigpICsgJyAnICsgam9iLm5hbWUgKyAnPC9zcGFuPjwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKGpvYlR5cGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICBodG1sICs9ICc8ZGl2IGlkPVwiJyArIGpvYi5uYW1lICsgJ1wiIGNsYXNzPVwicmVjaXBlTm9kZVwiIG9uY2xpY2s9XCJub2RlQ2xpY2soXFwnJyArIGpvYi5uYW1lICsgJ1xcJylcIj48c3BhbiBjbGFzcz1cIm5hbWVcIj4nICsgam9iVHlwZS5nZXRJY29uKCkgKyAnICcgKyBqb2JUeXBlLnRpdGxlICsgJzwvc3Bhbj48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAvL30gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgIGh0bWwgKz0gJzxkaXYgaWQ9XCInICsgam9iLm5hbWUgKyAnXCIgY2xhc3M9XCJyZWNpcGVOb2RlXCIgb25jbGljaz1cIm5vZGVDbGljayhcXCcnICsgam9iLm5hbWUgKyAnXFwnKVwiPjxzcGFuIGNsYXNzPVwibmFtZVwiPicgKyBqb2JUeXBlLmdldEljb24oKSArICcgJyArIGpvYi5uYW1lICsgJzwvc3Bhbj48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAvL31cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBodG1sICs9ICc8L3NwYW4+JztcbiAgICAgICAgICAgICAgICAvLyAgIGh0bWwgKz0gXCI8c3BhbiBjbGFzcz1xdWV1ZT48c3BhbiBjbGFzcz1jb3VudGVyPlwiK3dvcmtlci5jb3VudCtcIjwvc3Bhbj48L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICBncmFwaC5zZXROb2RlKGpvYi5uYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogaHRtbCxcbiAgICAgICAgICAgICAgICAgICAgcng6IDUsXG4gICAgICAgICAgICAgICAgICAgIHJ5OiA1LFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAwLFxuICAgICAgICAgICAgICAgICAgICBjbGFzczogY2xhc3NOYW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gc2V0dXAgZWRnZXNcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBkIGluIGpvYi5kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlcCA9IGpvYi5kZXBlbmRlbmNpZXNbZF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlcC5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmFwaC5zZXRFZGdlKGRlcC5uYW1lLCBqb2IubmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbGFiZWxUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9sYWJlbDogZGVwLm5hbWUgKyAnLS0+JyArIGpvYi5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZENvdW50c1tkZXAubmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZENvdW50c1tkZXAubmFtZV0gKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRDb3VudHNbZGVwLm5hbWVdID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2V0IHN0YXJ0IG5vZGUgYW5kIGVkZ2VzXG4gICAgICAgICAgICBncmFwaC5zZXROb2RlKCdzdGFydCcsIHtcbiAgICAgICAgICAgICAgICBsYWJlbFR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJzxkaXYgaWQ9XCJzdGFydFwiIGNsYXNzPVwicmVjaXBlTm9kZVwiIG9uY2xpY2s9XCJub2RlQ2xpY2soXFwnc3RhcnRcXCcpXCI+PHNwYW4gY2xhc3M9bmFtZT5TdGFydDwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIHJ4OiA1LFxuICAgICAgICAgICAgICAgIHJ5OiA1LFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc3RhcnRKb2IgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N0YXJ0JyxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZToge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1N0YXJ0J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5wdXRfZGF0YTogJHNjb3BlLnJlY2lwZVR5cGUuaW5wdXRfZGF0YVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBub0RlcHMgPSBfLmZpbHRlcihqb2JzLCAnZGVwU3RhcnQnLCB0cnVlKTtcbiAgICAgICAgICAgIGZvciAodmFyIG4gaW4gbm9EZXBzKSB7XG4gICAgICAgICAgICAgICAgZ3JhcGguc2V0RWRnZSgnc3RhcnQnLCBub0RlcHNbbl0ubmFtZSwge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2V0IGVuZCBub2RlIGFuZCBlZGdlc1xuICAgICAgICAgICAgZ3JhcGguc2V0Tm9kZSgnZW5kJywge1xuICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnPGRpdiBjbGFzcz1cInJlY2lwZU5vZGVcIj48c3BhbiBjbGFzcz1cIm5hbWVcIj5FbmQ8L3NwYW4+PC9kaXY+JyxcbiAgICAgICAgICAgICAgICByeDogNSxcbiAgICAgICAgICAgICAgICByeTogNSxcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBub0NoaWxkcmVuID1fLmZpbHRlcihqb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFjaGlsZENvdW50c1tqb2IubmFtZV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZvciAodmFyIG8gaW4gbm9DaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGdyYXBoLnNldEVkZ2Uobm9DaGlsZHJlbltvXS5uYW1lLCAnZW5kJywge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gd2FpdCBmb3IgY3VycmVudCBjYWxsIHN0YWNrIHRvIGNsZWFyXG4gICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpbm5lci5jYWxsKHJlbmRlciwgZ3JhcGgpO1xuICAgICAgICAgICAgICAgIHpvb20uZXZlbnQoZDMuc2VsZWN0KFwic3ZnXCIpKTtcblxuICAgICAgICAgICAgICAgICQoJy5ub2RlIHJlY3QnKS5hdHRyKCdjbGFzcycsICdub2RlUmVjdCcpO1xuXG4gICAgICAgICAgICAgICAgLy8gYWRkIHNlbGVjdGVkIGNsYXNzIHRvIGFwcHJvcHJpYXRlIG5vZGVcbiAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRKb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8kKCcjJyArIHZtLnNlbGVjdGVkSm9iLm5hbWUpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlJyk7XG4gICAgICAgICAgICAgICAgICAgIGdldENsb3Nlc3ROb2RlKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0RGVwZW5kZW50cyA9IGZ1bmN0aW9uIChuYW1lLG91dHB1dE5hbWUpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHRzID0gW107XG5cbiAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMsIGZ1bmN0aW9uIChqb2IsIGtleSkge1xuICAgICAgICAgICAgICAgIGlmIChqb2IubmFtZSAhPT0gbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goam9iLmRlcGVuZGVuY2llcywgZnVuY3Rpb24gKGRlcGVuZGVuY3ksIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlcGVuZGVuY3kubmFtZSA9PT0gbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubiwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25uLm91dHB1dCA9PT0gb3V0cHV0TmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBqb2IubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6IGNvbm4ub3V0cHV0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBjb25uLmlucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgIH0pLmRpcmVjdGl2ZSgnYWlzU2NhbGVSZWNpcGVHcmFwaFZpZXdlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICAvKipcbiAgICAgICAgICogVXNhZ2U6IDxhaXMtc2NhbGUtcmVjaXBlLXZpZXdlciByZWNpcGU9XCJyZWNpcGVcIiAvPlxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNTY2FsZVJlY2lwZUdyYXBoVmlld2VyQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVHcmFwaFZpZXdlclRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgcmVjaXBlVHlwZTogJz0nLFxuICAgICAgICAgICAgICAgIHJlY2lwZTogJz0nLFxuICAgICAgICAgICAgICAgIGlzTW9kaWZpZWQ6ICc9bW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGFsbG93RWRpdDogJz0nLFxuICAgICAgICAgICAgICAgIGhhc0NvbnRhaW5lcjogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgUmVjaXBlVHlwZSwgc2NhbGVTZXJ2aWNlKSB7XG4gICAgICAgIHZhciBSZWNpcGUgPSBmdW5jdGlvbiAoaWQsIGNyZWF0ZWQsIGNvbXBsZXRlZCwgbGFzdF9tb2RpZmllZCwgcmVjaXBlX3R5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhjcmVhdGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCk7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlZCA9IGNvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVkX2Zvcm1hdHRlZCA9IGNvbXBsZXRlZCA/IG1vbWVudC51dGMoY29tcGxldGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCkgOiAnJztcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCk7XG4gICAgICAgICAgICB0aGlzLmxhc3Rfc3RhdHVzX2NoYW5nZSA9IGxhc3RfbW9kaWZpZWQgPyBtb21lbnQuZHVyYXRpb24obW9tZW50LnV0YyhsYXN0X21vZGlmaWVkKS5kaWZmKG1vbWVudC51dGMoKSkpLmh1bWFuaXplKHRydWUpIDogJyc7XG4gICAgICAgICAgICB0aGlzLnJlY2lwZV90eXBlID0gUmVjaXBlVHlwZS50cmFuc2Zvcm1lcihyZWNpcGVfdHlwZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgUmVjaXBlLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVjaXBlX3R5cGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZURhdGEnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBSZWNpcGVEYXRhID0gZnVuY3Rpb24gKGlucHV0X2RhdGEsIHZlcnNpb24sIHdvcmtzcGFjZV9pZCkge1xuICAgICAgICAgICAgdGhpcy5pbnB1dF9kYXRhID0gaW5wdXRfZGF0YTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLndvcmtzcGFjZV9pZCA9IHdvcmtzcGFjZV9pZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlRGF0YS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlRGF0YShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbnB1dF9kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEud29ya3NwYWNlX2lkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlRGF0YSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZURhdGEudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlRGF0YS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGVEYXRhLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVEYXRhO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZURldGFpbHMnLCBmdW5jdGlvbiAoUmVjaXBlRGF0YSwgUmVjaXBlVHlwZURlZmluaXRpb24sIFJlY2lwZVR5cGUsIFJlY2lwZVR5cGVEZXRhaWwsIFJlY2lwZUpvYkNvbnRhaW5lciwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIFJlY2lwZURldGFpbHMgPSBmdW5jdGlvbiAoaWQsIGNyZWF0ZWQsIGNvbXBsZXRlZCwgbGFzdF9tb2RpZmllZCwgZGF0YSwgcmVjaXBlX3R5cGUsIHJlY2lwZV90eXBlX3Jldiwgam9icyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfc3VwZXJzZWRlZCwgcm9vdF9zdXBlcnNlZGVkX3JlY2lwZSwgc3VwZXJzZWRlZF9yZWNpcGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cGVyc2VkZWRfYnlfcmVjaXBlLCBzdXBlcnNlZGVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWQgPSBjb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlZF9mb3JtYXR0ZWQgPSB0aGlzLmNvbXBsZXRlZCA/IG1vbWVudC51dGModGhpcy5jb21wbGV0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0YykgOiB0aGlzLmNvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBSZWNpcGVEYXRhLnRyYW5zZm9ybWVyKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVfdHlwZSA9IFJlY2lwZVR5cGUudHJhbnNmb3JtZXIocmVjaXBlX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVfdHlwZV9yZXYgPSBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyKHJlY2lwZV90eXBlX3Jldik7XG4gICAgICAgICAgICB0aGlzLmpvYnMgPSBSZWNpcGVKb2JDb250YWluZXIudHJhbnNmb3JtZXIoam9icyk7XG4gICAgICAgICAgICB0aGlzLmlzX3N1cGVyc2VkZWQgPSBpc19zdXBlcnNlZGVkO1xuICAgICAgICAgICAgdGhpcy5yb290X3N1cGVyc2VkZWRfcmVjaXBlID0gcm9vdF9zdXBlcnNlZGVkX3JlY2lwZTtcbiAgICAgICAgICAgIHRoaXMuc3VwZXJzZWRlZF9yZWNpcGUgPSBzdXBlcnNlZGVkX3JlY2lwZTtcbiAgICAgICAgICAgIHRoaXMuc3VwZXJzZWRlZF9ieV9yZWNpcGUgPSBzdXBlcnNlZGVkX2J5X3JlY2lwZTtcbiAgICAgICAgICAgIHRoaXMuc3VwZXJzZWRlZCA9IHN1cGVyc2VkZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZURldGFpbHMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZURldGFpbHMoXG4gICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgZGF0YS5jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICBkYXRhLmRhdGEsXG4gICAgICAgICAgICAgICAgICBkYXRhLnJlY2lwZV90eXBlLFxuICAgICAgICAgICAgICAgICAgZGF0YS5yZWNpcGVfdHlwZV9yZXYsXG4gICAgICAgICAgICAgICAgICBkYXRhLmpvYnMsXG4gICAgICAgICAgICAgICAgICBkYXRhLmlzX3N1cGVyc2VkZWQsXG4gICAgICAgICAgICAgICAgICBkYXRhLnJvb3Rfc3VwZXJzZWRlZF9yZWNpcGUsXG4gICAgICAgICAgICAgICAgICBkYXRhLnN1cGVyc2VkZWRfcmVjaXBlLFxuICAgICAgICAgICAgICAgICAgZGF0YS5zdXBlcnNlZGVkX2J5X3JlY2lwZSxcbiAgICAgICAgICAgICAgICAgIGRhdGEuc3VwZXJzZWRlZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZURldGFpbHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVEZXRhaWxzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVEZXRhaWxzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGVEZXRhaWxzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVEZXRhaWxzO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlSm9iJywgZnVuY3Rpb24gKEpvYlR5cGUpIHtcbiAgICAgICAgdmFyIFJlY2lwZUpvYiA9IGZ1bmN0aW9uIChpZCwgc3RhdHVzLCBqb2JfdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZUpvYi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlSm9iKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZUpvYigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZUpvYi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVKb2IuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlSm9iLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVKb2I7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlSm9iQ29udGFpbmVyJywgZnVuY3Rpb24gKFJlY2lwZUpvYikge1xuICAgICAgICB2YXIgUmVjaXBlSm9iQ29udGFpbmVyID0gZnVuY3Rpb24gKGpvYl9uYW1lLCBqb2IpIHtcbiAgICAgICAgICAgIHRoaXMuam9iX25hbWUgPSBqb2JfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuam9iID0gUmVjaXBlSm9iLnRyYW5zZm9ybWVyKGpvYik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZUpvYkNvbnRhaW5lci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlSm9iQ29udGFpbmVyKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZUpvYkNvbnRhaW5lcigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZUpvYkNvbnRhaW5lci50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVKb2JDb250YWluZXIuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlSm9iQ29udGFpbmVyLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVKb2JDb250YWluZXI7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlVHlwZScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgUmVjaXBlVHlwZURlZmluaXRpb24pIHtcbiAgICAgICAgdmFyIFJlY2lwZVR5cGUgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgaXNfYWN0aXZlLCBkZWZpbml0aW9uLCByZXZpc2lvbl9udW0sIGNyZWF0ZWQsICBsYXN0X21vZGlmaWVkLCBhcmNoaXZlZCwgdHJpZ2dlcl9ydWxlKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5kZWZpbml0aW9uID0gZGVmaW5pdGlvbiA/IFJlY2lwZVR5cGVEZWZpbml0aW9uLnRyYW5zZm9ybWVyKGRlZmluaXRpb24pIDogbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLnJldmlzaW9uX251bSA9IHJldmlzaW9uX251bTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgaWYgKHRyaWdnZXJfcnVsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcl9ydWxlID0gdHJpZ2dlcl9ydWxlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJfcnVsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJycsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgICAgICAgICBpc19hY3RpdmU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYV90eXBlOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhX3R5cGVzOiBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VfbmFtZTogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRfZGF0YV9uYW1lOiAnJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubW9kaWZpZWQgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlVHlwZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfYWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlZmluaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmV2aXNpb25fbnVtLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50cmlnZ2VyX3J1bGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlVHlwZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEubWFwKFJlY2lwZVR5cGUuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGU7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGVUeXBlRGVmaW5pdGlvbicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IsIEpvYlR5cGVJbnB1dERhdGEpIHtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIC8vIHByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgUmVjaXBlVHlwZURlZmluaXRpb24gPSBmdW5jdGlvbiAoaW5wdXRfZGF0YSwgdmVyc2lvbiwgam9icykge1xuICAgICAgICAgICAgdGhpcy5pbnB1dF9kYXRhID0gaW5wdXRfZGF0YSA/IEpvYlR5cGVJbnB1dERhdGEudHJhbnNmb3JtZXIoaW5wdXRfZGF0YSkgOiBbXTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb24gfHwgJzEuMCc7XG4gICAgICAgICAgICB0aGlzLmpvYnMgPSBqb2JzID8gUmVjaXBlVHlwZURlZmluaXRpb25Kb2IudHJhbnNmb3JtZXIoam9icykgOiBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iTmFtZSA9IGZ1bmN0aW9uKGpvYnMsIGpvYk5hbWUpe1xuICAgICAgICAgICAgdmFyIHRoZU5hbWUgPSBqb2JOYW1lO1xuICAgICAgICAgICAgdmFyIGV4aXN0aW5nID0gXy5maW5kKGpvYnMsIHsgJ25hbWUnOiBqb2JOYW1lIH0pO1xuICAgICAgICAgICAgdmFyIGlkeCA9IDI7XG4gICAgICAgICAgICB3aGlsZShleGlzdGluZyl7XG4gICAgICAgICAgICAgICAgdGhlTmFtZSA9IGpvYk5hbWUgKyAnLScgKyBpZHg7XG4gICAgICAgICAgICAgICAgZXhpc3RpbmcgPSBfLmZpbmQoam9icywgeyAnbmFtZSc6IHRoZU5hbWUgfSk7XG4gICAgICAgICAgICAgICAgaWR4Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhlTmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbi5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBhZGRKb2I6IGZ1bmN0aW9uIChqb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGpuYW1lID0gZ2V0Sm9iTmFtZSh0aGlzLmpvYnMsIGpvYlR5cGUubmFtZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coam5hbWUpO1xuICAgICAgICAgICAgICAgIHZhciBqb2IgPSB7XG4gICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogW10sXG4gICAgICAgICAgICAgICAgICAgIHJlY2lwZV9pbnB1dHM6IFtdLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBqbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgam9iX3R5cGVfaWQ6IGpvYlR5cGUuaWQsXG4gICAgICAgICAgICAgICAgICAgIGpvYl90eXBlOiBqb2JUeXBlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmpvYnMucHVzaChqb2IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZihkYXRhKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlucHV0X2RhdGEsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURlZmluaXRpb24oKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVUeXBlRGVmaW5pdGlvbi5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURlZmluaXRpb24uYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZWZpbml0aW9uO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpe1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZVR5cGVEZWZpbml0aW9uSm9iJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlRGV0YWlscykge1xuICAgICAgICAvLyBwcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iID0gZnVuY3Rpb24gKHJlY2lwZV9pbnB1dHMsIG5hbWUsIGpvYl90eXBlLCBkZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgIHRoaXMucmVjaXBlX2lucHV0cyA9IHJlY2lwZV9pbnB1dHM7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IGpvYl90eXBlO1xuICAgICAgICAgICAgLy90aGlzLmpvYl90eXBlID0ge1xuICAgICAgICAgICAgLy8gICAgbmFtZTogam9iX3R5cGUubmFtZSxcbiAgICAgICAgICAgIC8vICAgIHZlcnNpb246IGpvYl90eXBlLnZlcnNpb25cbiAgICAgICAgICAgIC8vfTtcbiAgICAgICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzIHx8IFtdO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVjaXBlX2lucHV0cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlcGVuZGVuY2llc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlVHlwZURlZmluaXRpb25Kb2IuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iO1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGVUeXBlRGV0YWlsJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlRGVmaW5pdGlvbiwgSm9iVHlwZURldGFpbHMpIHtcbiAgICAgICAgdmFyIFJlY2lwZVR5cGVEZXRhaWwgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgaXNfYWN0aXZlLCBkZWZpbml0aW9uLCBjcmVhdGVkLCBsYXN0X21vZGlmaWVkLCBhcmNoaXZlZCwgdHJpZ2dlcl9ydWxlLCBqb2JfdHlwZXMpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgdGhpcy5pc19hY3RpdmUgPSBpc19hY3RpdmU7XG4gICAgICAgICAgICB0aGlzLmRlZmluaXRpb24gPSBSZWNpcGVUeXBlRGVmaW5pdGlvbi50cmFuc2Zvcm1lcihkZWZpbml0aW9uKTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyX3J1bGUgPSB0cmlnZ2VyX3J1bGU7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlcyA9IEpvYlR5cGVEZXRhaWxzLnRyYW5zZm9ybWVyKGpvYl90eXBlcyk7XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZVR5cGVEZXRhaWwuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZXRhaWwoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50cmlnZ2VyX3J1bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURldGFpbCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZVR5cGVEZXRhaWwudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlVHlwZURldGFpbC5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURldGFpbC5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURldGFpbDtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZVR5cGVWYWxpZGF0aW9uJywgZnVuY3Rpb24gKFJlY2lwZVR5cGVEZWZpbml0aW9uKSB7XG5cbiAgICAgICAgdmFyIGdldFJlY2lwZVR5cGVWYWxpZGF0aW9uSm9icyA9IGZ1bmN0aW9uIChqb2JzKSB7XG4gICAgICAgICAgICB2YXIgam9ic091dCA9IFtdO1xuICAgICAgICAgICAgXy5mb3JFYWNoKGpvYnMsIGZ1bmN0aW9uKGpvYil7XG4gICAgICAgICAgICAgICBqb2JzT3V0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgIHJlY2lwZV9pbnB1dHM6IGpvYi5yZWNpcGVfaW5wdXRzLFxuICAgICAgICAgICAgICAgICAgIG5hbWU6IGpvYi5uYW1lLFxuICAgICAgICAgICAgICAgICAgIGpvYl90eXBlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGpvYi5qb2JfdHlwZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBqb2Iuam9iX3R5cGUudmVyc2lvblxuICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBqb2IuZGVwZW5kZW5jaWVzXG4gICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gam9ic091dDtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBSZWNpcGVUeXBlVmFsaWRhdGlvbiA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdmVyc2lvbiwgdGl0bGUsIGRlc2NyaXB0aW9uLCBkZWZpbml0aW9uLCB0cmlnZ2VyX3J1bGUpIHtcbiAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgdGhpcy5kZWZpbml0aW9uID0ge1xuICAgICAgICAgICAgICAgIGlucHV0X2RhdGE6IGRlZmluaXRpb24uaW5wdXRfZGF0YSxcbiAgICAgICAgICAgICAgICBqb2JzOiBnZXRSZWNpcGVUeXBlVmFsaWRhdGlvbkpvYnMoZGVmaW5pdGlvbi5qb2JzKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcl9ydWxlID0gdHJpZ2dlcl9ydWxlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVUeXBlVmFsaWRhdGlvbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZVZhbGlkYXRpb24oXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlZmluaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHJpZ2dlcl9ydWxlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZVZhbGlkYXRpb24oKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVUeXBlVmFsaWRhdGlvbi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVUeXBlVmFsaWRhdGlvbi5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlVHlwZVZhbGlkYXRpb24uYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVWYWxpZGF0aW9uO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3JlY2lwZVNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkdGltZW91dCwgc2NhbGVDb25maWcsIFJlY2lwZVR5cGUsIFJlY2lwZVR5cGVEZXRhaWwsIFJlY2lwZSwgUmVjaXBlRGV0YWlscywgUmVjaXBlVHlwZVZhbGlkYXRpb24pIHtcbiAgICAgICAgdmFyIGdldFJlY2lwZXNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIsIGNvbXBsZXRlZCwgcmVjaXBlX3R5cGVfaWQsIHJlY2lwZV90eXBlX25hbWUsIHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlcixcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQ6IGNvbXBsZXRlZCxcbiAgICAgICAgICAgICAgICByZWNpcGVfdHlwZV9pZDogcmVjaXBlX3R5cGVfaWQsXG4gICAgICAgICAgICAgICAgcmVjaXBlX3R5cGVfbmFtZTogcmVjaXBlX3R5cGVfbmFtZSxcbiAgICAgICAgICAgICAgICB1cmw6IHVybFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0UmVjaXBlVHlwZXNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIgPyBvcmRlciA6IFsndGl0bGUnLCAndmVyc2lvbiddXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRSZWNpcGVUeXBlczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRSZWNpcGVUeXBlc1BhcmFtcygpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3JlY2lwZS10eXBlcycpICsgJ3JlY2lwZS10eXBlcy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gUmVjaXBlVHlwZS50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZ2V0UmVjaXBlVHlwZURldGFpbDogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGUtdHlwZXMnKSArICdyZWNpcGUtdHlwZXMvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IFJlY2lwZVR5cGVEZXRhaWwudHJhbnNmb3JtZXIoZGF0YSk7XG4gICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmV0dXJuRGF0YSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZ2V0UmVjaXBlczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRSZWNpcGVzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGVzJykgKyAncmVjaXBlcy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gUmVjaXBlLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGdldFJlY2lwZURldGFpbHM6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGVzJykgKyAncmVjaXBlcy8nICsgaWQgKyAnLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRldGFpbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2dldFJlY2lwZURldGFpbHMnKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGV0YWlscyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBSZWNpcGVEZXRhaWxzLnRyYW5zZm9ybWVyKGRldGFpbHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzYXZlUmVjaXBlVHlwZTogZnVuY3Rpb24gKHJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIGNsZWFuUmVjaXBlVHlwZSA9IFJlY2lwZVR5cGVWYWxpZGF0aW9uLnRyYW5zZm9ybWVyKHJlY2lwZVR5cGUpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFjbGVhblJlY2lwZVR5cGUuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdChzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3JlY2lwZS10eXBlcycpICsgJ3JlY2lwZS10eXBlcy8nLCBjbGVhblJlY2lwZVR5cGUpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAucGF0Y2goc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGUtdHlwZXMnKSArICdyZWNpcGUtdHlwZXMvJyArIGNsZWFuUmVjaXBlVHlwZS5pZCArICcvJywgY2xlYW5SZWNpcGVUeXBlKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2lwZVR5cGUgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVjaXBlVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHZhbGlkYXRlUmVjaXBlVHlwZTogZnVuY3Rpb24gKHJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIGNsZWFuUmVjaXBlVHlwZSA9IFJlY2lwZVR5cGVWYWxpZGF0aW9uLnRyYW5zZm9ybWVyKHJlY2lwZVR5cGUpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3JlY2lwZS10eXBlcycpICsgJ3JlY2lwZS10eXBlcy92YWxpZGF0aW9uLycsIGNsZWFuUmVjaXBlVHlwZSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3dvcmtzcGFjZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkdWliTW9kYWwsICRyb3V0ZVBhcmFtcywgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UsIHdvcmtzcGFjZXNTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgdXNlclNlcnZpY2UsIGdyaWRGYWN0b3J5LCBXb3Jrc3BhY2UsIHRvYXN0cikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgY3VycldvcmtzcGFjZSA9IHt9LFxuICAgICAgICAgICAgYWN0aXZlV29ya3NwYWNlcyA9IFtdLFxuICAgICAgICAgICAgaW5hY3RpdmVXb3Jrc3BhY2VzID0gW107XG5cbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnNjYWxlQ29uZmlnID0gc2NhbGVDb25maWc7XG4gICAgICAgIHZtLnNob3dBY3RpdmUgPSBzdGF0ZVNlcnZpY2UuZ2V0U2hvd0FjdGl2ZVdvcmtzcGFjZXMoKTtcbiAgICAgICAgdm0ud29ya3NwYWNlcyA9IFtdO1xuICAgICAgICB2bS5sb2NhbFdvcmtzcGFjZXMgPSBbXTtcbiAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0ge307XG4gICAgICAgIHZtLmFkZEJ0bkNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uYWRkQnRuSWNvbiA9ICdmYS1wbHVzLWNpcmNsZSc7XG4gICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgdm0ucmVhZG9ubHkgPSAhKHZtLnVzZXIgJiYgdm0udXNlci5pc19hZG1pbik7XG4gICAgICAgIHZtLmJyb2tlckRlc2NyaXB0aW9uID0gJyc7XG4gICAgICAgIHZtLmF2YWlsYWJsZVdvcmtzcGFjZVR5cGVzID0gXy5jbG9uZURlZXAoc2NhbGVDb25maWcud29ya3NwYWNlVHlwZXMpO1xuXG4gICAgICAgIHZtLmNhbmNlbENyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgICAgICAvLyByZXZlcnQgYW55IGNoYW5nZXMgdG8gdGhlIHdvcmtzcGFjZVxuICAgICAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0gV29ya3NwYWNlLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKGN1cnJXb3Jrc3BhY2UpKTtcbiAgICAgICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQgPT09ICcwJykge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvd29ya3NwYWNlcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmVkaXRXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzdG9yZSBhIHJlZmVyZW5jZSBvZiB0aGUgd29ya3NwYWNlIGFzIGl0IGN1cnJlbnRseSBleGlzdHMgaW4gY2FzZSB0aGUgdXNlciBjYW5jZWxzIHRoZSBlZGl0XG4gICAgICAgICAgICBjdXJyV29ya3NwYWNlID0gV29ya3NwYWNlLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKHZtLmFjdGl2ZVdvcmtzcGFjZSkpO1xuICAgICAgICAgICAgdm0ubW9kZSA9ICdlZGl0JztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zYXZlV29ya3NwYWNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2Uuc2F2ZVdvcmtzcGFjZSh2bS5hY3RpdmVXb3Jrc3BhY2UpLnRoZW4oZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IFdvcmtzcGFjZS50cmFuc2Zvcm1lcih3b3Jrc3BhY2UpO1xuICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3dvcmtzcGFjZScgKyB2bS5hY3RpdmVXb3Jrc3BhY2UuaWQsIEpTT04uc3RyaW5naWZ5KHZtLmFjdGl2ZVdvcmtzcGFjZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuICAgICAgICAgICAgICAgIGdldFdvcmtzcGFjZXMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNsZWFyTG9jYWxXb3Jrc3BhY2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmxvY2FsV29ya3NwYWNlcywgZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd3b3Jrc3BhY2UnICsgd29ya3NwYWNlLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy93b3Jrc3BhY2VzJyk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2bS5uZXdXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICB2bS5sb2FkV29ya3NwYWNlKDApO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmxvYWRXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCd3b3Jrc3BhY2VzLycgKyBpZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFdhcm5pbmdzSHRtbCA9IGZ1bmN0aW9uICh3YXJuaW5ncykge1xuICAgICAgICAgICAgdmFyIHdhcm5pbmdzSHRtbCA9ICcnO1xuICAgICAgICAgICAgXy5mb3JFYWNoKHdhcm5pbmdzLCBmdW5jdGlvbiAod2FybmluZykge1xuICAgICAgICAgICAgICAgIHdhcm5pbmdzSHRtbCArPSAnPGI+JyArIHdhcm5pbmcuaWQgKyAnOjwvYj4gJyArIHdhcm5pbmcuZGV0YWlscyArICc8YnIgLz48YnIgLz4nO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3YXJuaW5nc0h0bWwgKz0gJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyBjbGVhclwiPkhpZGU8L2J1dHRvbj4nO1xuICAgICAgICAgICAgcmV0dXJuIHdhcm5pbmdzSHRtbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS52YWxpZGF0ZVdvcmtzcGFjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2UudmFsaWRhdGVXb3Jrc3BhY2Uodm0uYWN0aXZlV29ya3NwYWNlKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEud2FybmluZ3MgJiYgZGF0YS53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdGhlIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSBnZXRXYXJuaW5nc0h0bWwoZGF0YS53YXJuaW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSh3YXJuaW5nc0h0bWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdXb3Jrc3BhY2UgaXMgdmFsaWQuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yLmRldGFpbCkge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IuZGV0YWlsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmFjdGl2ZVdvcmtzcGFjZS5qc29uX2NvbmZpZy5icm9rZXIudHlwZScsIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSAnbmZzJykge1xuICAgICAgICAgICAgICAgIHZtLmJyb2tlckRlc2NyaXB0aW9uID0gc2NhbGVDb25maWcubmZzQnJva2VyRGVzY3JpcHRpb247XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlID09PSAnaG9zdCcpIHtcbiAgICAgICAgICAgICAgICB2bS5icm9rZXJEZXNjcmlwdGlvbiA9IHNjYWxlQ29uZmlnLmhvc3RCcm9rZXJEZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsdWUgPT09ICdzMycpIHtcbiAgICAgICAgICAgICAgICB2bS5icm9rZXJEZXNjcmlwdGlvbiA9IHNjYWxlQ29uZmlnLnMzQnJva2VyRGVzY3JpcHRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNob3dBY3RpdmUnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLnNob3dBY3RpdmUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRTaG93QWN0aXZlV29ya3NwYWNlcyhuZXdWYWx1ZSk7XG4gICAgICAgICAgICB2bS53b3Jrc3BhY2VzID0gdm0uc2hvd0FjdGl2ZSA/IF8uY2xvbmVEZWVwKGFjdGl2ZVdvcmtzcGFjZXMpIDogXy5jbG9uZURlZXAoaW5hY3RpdmVXb3Jrc3BhY2VzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGdldFdvcmtzcGFjZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZXMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjYWxlQ29uZmlnLnN0YXRpYykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvSnNvbiA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc0tleTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICg7IHNLZXkgPSBsb2NhbFN0b3JhZ2Uua2V5KGkpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9Kc29uW3NLZXldID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oc0tleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXy5maWx0ZXIoXy5wYWlycyhvSnNvbiksIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXy5jb250YWlucyhvWzBdLCAnd29ya3NwYWNlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IEpTT04ucGFyc2Uob1sxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9jYWxXb3Jrc3BhY2VzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWN0aXZlV29ya3NwYWNlcyA9IF8uZmlsdGVyKGRhdGEsIHsgJ2lzX2FjdGl2ZSc6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgaW5hY3RpdmVXb3Jrc3BhY2VzID0gXy5maWx0ZXIoZGF0YSwgeyAnaXNfYWN0aXZlJzogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgdm0ud29ya3NwYWNlcyA9IHZtLnNob3dBY3RpdmUgPyBfLmNsb25lRGVlcChhY3RpdmVXb3Jrc3BhY2VzKSA6IF8uY2xvbmVEZWVwKGluYWN0aXZlV29ya3NwYWNlcyk7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0V29ya3NwYWNlcygpO1xuICAgICAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0gbnVsbDtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG5cbiAgICAgICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICAgICAgICAgIGlmIChpZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IG5ldyBXb3Jrc3BhY2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgYWN0aXZlV29ya3NwYWNlID0gd29ya3NwYWNlIGRldGFpbHMgZm9yIGlkXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZURldGFpbHMoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IFdvcmtzcGFjZS50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignd29ya3NwYWNlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyTWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0ICsgNjA7XG5cbiAgICAgICAgICAgIHZtLmNvbnRhaW5lclN0eWxlID0gJ2hlaWdodDogJyArIGNvbnRhaW5lck1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGNvbnRhaW5lck1heEhlaWdodCArICdweDsnO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdXb3Jrc3BhY2UnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIFdvcmtzcGFjZSA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdGl0bGUsIGRlc2NyaXB0aW9uLCBiYXNlX3VybCwgaXNfYWN0aXZlLCB1c2VkX3NpemUsIHRvdGFsX3NpemUsIGNyZWF0ZWQsIGFyY2hpdmVkLCBsYXN0X21vZGlmaWVkLCBqc29uX2NvbmZpZykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuYmFzZV91cmwgPSBiYXNlX3VybDtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy51c2VkX3NpemUgPSB1c2VkX3NpemU7XG4gICAgICAgICAgICB0aGlzLnRvdGFsX3NpemUgPSB0b3RhbF9zaXplO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmpzb25fY29uZmlnID0ganNvbl9jb25maWcgfHwgXy5jbG9uZURlZXAoc2NhbGVDb25maWcud29ya3NwYWNlVHlwZXNbMF0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIFdvcmtzcGFjZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBjbGVhbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBiYXNlX3VybDogdGhpcy5iYXNlX3VybCxcbiAgICAgICAgICAgICAgICAgICAgaXNfYWN0aXZlOiB0aGlzLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAganNvbl9jb25maWc6IHRoaXMuanNvbl9jb25maWdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBXb3Jrc3BhY2UuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFdvcmtzcGFjZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmJhc2VfdXJsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51c2VkX3NpemUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudG90YWxfc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuanNvbl9jb25maWdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3Jrc3BhY2UoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBXb3Jrc3BhY2UudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChXb3Jrc3BhY2UuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFdvcmtzcGFjZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gV29ya3NwYWNlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnd29ya3NwYWNlc1NlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkcmVzb3VyY2UsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRXb3Jrc3BhY2VzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3dvcmtzcGFjZXMnKSArICd3b3Jrc3BhY2VzLyc7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgb3JkZXI6ICctdGl0bGUnIH1cbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRXb3Jrc3BhY2VEZXRhaWxzOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnd29ya3NwYWNlcycpICsgJ3dvcmtzcGFjZXMvJyArIGlkICsgJy8nO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJ1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZhbGlkYXRlV29ya3NwYWNlOiBmdW5jdGlvbiAod29ya3NwYWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBjbGVhbldvcmtzcGFjZSA9IHdvcmtzcGFjZS5jbGVhbigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3dvcmtzcGFjZXMnKSArICd3b3Jrc3BhY2VzL3ZhbGlkYXRpb24vJywgY2xlYW5Xb3Jrc3BhY2UpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2F2ZVdvcmtzcGFjZTogZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgIGlmICghd29ya3NwYWNlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCd3b3Jrc3BhY2VzJykgKyAnd29ya3NwYWNlcy8nLCB3b3Jrc3BhY2UuY2xlYW4oKSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBhdGNoKHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnd29ya3NwYWNlcycpICsgJ3dvcmtzcGFjZXMvJyArIHdvcmtzcGFjZS5pZCArICcvJywgd29ya3NwYWNlLmNsZWFuKCkpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHdvcmtzcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIi8qKlxuICogQGF1dGhvciBEaW1pdHJ5IEt1ZHJheXZ0c2V2XG4gKiBAdmVyc2lvbiAyLjFcbiAqL1xuXG4gdmFyIHVwZGF0ZVdpbmRvdyA9IGZ1bmN0aW9uKCl7XG4gICAgLy8gIHggPSB3LmlubmVyV2lkdGggfHwgZS5jbGllbnRXaWR0aCB8fCBnLmNsaWVudFdpZHRoO1xuICAgIC8vICB5ID0gdy5pbm5lckhlaWdodHx8IGUuY2xpZW50SGVpZ2h0fHwgZy5jbGllbnRIZWlnaHQ7XG4gICAgIC8vXG4gICAgLy8gIHN2Zy5hdHRyKFwid2lkdGhcIiwgeCkuYXR0cihcImhlaWdodFwiLCB5KTtcbiAgICBjb25zb2xlLmxvZygncmVzaXplJyk7XG4gfTtcblxuIHdpbmRvdy5vbnJlc2l6ZSA9IHVwZGF0ZVdpbmRvdztcblxuZDMuZ2FudHQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgRklUX1RJTUVfRE9NQUlOX01PREUgPSBcImZpdFwiO1xuICAgIHZhciBGSVhFRF9USU1FX0RPTUFJTl9NT0RFID0gXCJmaXhlZFwiO1xuXG4gICAgdmFyIG1hcmdpbiA9IHtcblx0XHR0b3AgOiAyMCxcblx0XHRyaWdodCA6IDIwLFxuXHRcdGJvdHRvbSA6IDIwLFxuXHRcdGxlZnQgOiA2MFxuICAgIH07XG4gICAgdmFyIHRpbWVEb21haW5TdGFydCA9IGQzLnRpbWUuZGF5Lm9mZnNldChuZXcgRGF0ZSgpLC0zKTtcbiAgICB2YXIgdGltZURvbWFpbkVuZCA9IGQzLnRpbWUuaG91ci5vZmZzZXQobmV3IERhdGUoKSwrMyk7XG4gICAgdmFyIHRpbWVEb21haW5Nb2RlID0gRklUX1RJTUVfRE9NQUlOX01PREU7Ly8gZml4ZWQgb3IgZml0XG4gICAgdmFyIHRhc2tUeXBlcyA9IFtdO1xuICAgIHZhciB0YXNrU3RhdHVzID0gW107XG4gICAgdmFyIGhlaWdodCA9IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b20tNTtcbiAgICB2YXIgd2lkdGggPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIC0gbWFyZ2luLnJpZ2h0IC0gbWFyZ2luLmxlZnQtNTtcblx0dmFyIHJlbmRlclRvID0gXCJib2R5XCI7XG5cdHZhciBiZWdpbiA9ICcnO1xuXHR2YXIgZW5kZWQgPSAnJztcblxuICAgIHZhciB0aWNrRm9ybWF0ID0gXCIlSDolTTolU1wiO1xuXG4gICAgdmFyIGtleUZ1bmN0aW9uID0gZnVuY3Rpb24oZCkge1xuXHRcdHJldHVybiBkW2JlZ2luXSArIGQudGFza05hbWUgKyBkW2VuZGVkXTtcbiAgICB9O1xuXG4gICAgdmFyIHJlY3RUcmFuc2Zvcm0gPSBmdW5jdGlvbihkKSB7XG5cdFx0cmV0dXJuIFwidHJhbnNsYXRlKFwiICsgeChkW2JlZ2luXSkgKyBcIixcIiArIHkoZC50YXNrTmFtZSkgKyBcIilcIjtcbiAgICB9O1xuXG4gICAgdmFyIHggPSBkMy50aW1lLnNjYWxlKCkuZG9tYWluKFsgdGltZURvbWFpblN0YXJ0LCB0aW1lRG9tYWluRW5kIF0pLnJhbmdlKFsgMCwgd2lkdGggXSkuY2xhbXAodHJ1ZSk7XG5cbiAgICB2YXIgeSA9IGQzLnNjYWxlLm9yZGluYWwoKS5kb21haW4odGFza1R5cGVzKS5yYW5nZVJvdW5kQmFuZHMoWyAwLCBoZWlnaHQgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSBdLCAuMSk7XG5cbiAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHgpLm9yaWVudChcImJvdHRvbVwiKS50aWNrRm9ybWF0KGQzLnRpbWUuZm9ybWF0KHRpY2tGb3JtYXQpKS50aWNrU3ViZGl2aWRlKHRydWUpXG5cdCAgICAudGlja1NpemUoOCkudGlja1BhZGRpbmcoOCk7XG5cbiAgICB2YXIgeUF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHkpLm9yaWVudChcImxlZnRcIikudGlja1NpemUoMCk7XG5cbiAgICB2YXIgaW5pdFRpbWVEb21haW4gPSBmdW5jdGlvbih0YXNrcykge1xuXHRpZiAodGltZURvbWFpbk1vZGUgPT09IEZJVF9USU1FX0RPTUFJTl9NT0RFKSB7XG5cdCAgICBpZiAodGFza3MgPT09IHVuZGVmaW5lZCB8fCB0YXNrcy5sZW5ndGggPCAxKSB7XG5cdFx0dGltZURvbWFpblN0YXJ0ID0gZDMudGltZS5kYXkub2Zmc2V0KG5ldyBEYXRlKCksIC0zKTtcblx0XHR0aW1lRG9tYWluRW5kID0gZDMudGltZS5ob3VyLm9mZnNldChuZXcgRGF0ZSgpLCArMyk7XG5cdFx0cmV0dXJuO1xuXHQgICAgfVxuXHQgICAgdGFza3Muc29ydChmdW5jdGlvbihhLCBiKSB7XG5cdFx0cmV0dXJuIGFbZW5kZWRdIC0gYltlbmRlZF07XG5cdCAgICB9KTtcblx0ICAgIHRpbWVEb21haW5FbmQgPSB0YXNrc1t0YXNrcy5sZW5ndGggLSAxXVtlbmRlZF07XG5cdCAgICB0YXNrcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRyZXR1cm4gYVtiZWdpbl0gLSBiW2JlZ2luXTtcblx0ICAgIH0pO1xuXHQgICAgdGltZURvbWFpblN0YXJ0ID0gdGFza3NbMF1bYmVnaW5dO1xuXHR9XG4gICAgfTtcblxuICAgIHZhciBpbml0QXhpcyA9IGZ1bmN0aW9uKCkge1xuXHR4ID0gZDMudGltZS5zY2FsZSgpLmRvbWFpbihbIHRpbWVEb21haW5TdGFydCwgdGltZURvbWFpbkVuZCBdKS5yYW5nZShbIDAsIHdpZHRoIF0pLmNsYW1wKHRydWUpO1xuXHR5ID0gZDMuc2NhbGUub3JkaW5hbCgpLmRvbWFpbih0YXNrVHlwZXMpLnJhbmdlUm91bmRCYW5kcyhbIDAsIGhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tIF0sIC4xKTtcblx0eEF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHgpLm9yaWVudChcImJvdHRvbVwiKS50aWNrcyhNYXRoLmNlaWwod2lkdGgvMTUwKSkudGlja0Zvcm1hdChkMy50aW1lLmZvcm1hdCh0aWNrRm9ybWF0KSkudGlja1N1YmRpdmlkZSh0cnVlKVxuXHRcdC50aWNrU2l6ZSg4KS50aWNrUGFkZGluZyg4KTtcblxuXHR5QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeSkub3JpZW50KFwibGVmdFwiKS50aWNrU2l6ZSgwKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2FudHQodGFza3MpIHtcblxuXHRpbml0VGltZURvbWFpbih0YXNrcyk7XG5cdGluaXRBeGlzKCk7XG5cblx0dmFyIHN2ZyA9IGQzLnNlbGVjdChyZW5kZXJUbylcblx0LmFwcGVuZChcInN2Z1wiKVxuXHQuYXR0cihcImNsYXNzXCIsIFwiY2hhcnRcIilcblx0LmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KVxuXHQuYXR0cihcImhlaWdodFwiLCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSlcblx0LmFwcGVuZChcImdcIilcbiAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImdhbnR0LWNoYXJ0XCIpXG5cdC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcblx0LmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG5cdC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luLmxlZnQgKyBcIiwgXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpO1xuXG4gICAgICBzdmcuc2VsZWN0QWxsKFwiLmNoYXJ0XCIpXG5cdCAuZGF0YSh0YXNrcywga2V5RnVuY3Rpb24pLmVudGVyKClcblx0IC5hcHBlbmQoXCJyZWN0XCIpXG5cdCAuYXR0cihcInJ4XCIsIDUpXG4gICAgICAgICAuYXR0cihcInJ5XCIsIDUpXG5cdCAuYXR0cihcImNsYXNzXCIsIGZ1bmN0aW9uKGQpe1xuXHQgICAgIGlmKHRhc2tTdGF0dXNbZC5zdGF0dXNdID09IG51bGwpeyByZXR1cm4gXCJiYXJcIjt9XG5cdCAgICAgcmV0dXJuIHRhc2tTdGF0dXNbZC5zdGF0dXNdO1xuXHQgICAgIH0pXG5cdCAuYXR0cihcInlcIiwgMClcblx0IC5hdHRyKFwidHJhbnNmb3JtXCIsIHJlY3RUcmFuc2Zvcm0pXG5cdCAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB5LnJhbmdlQmFuZCgpOyB9KVxuXHQgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbihkKSB7XG5cdCAgICAgcmV0dXJuICh4KGRbZW5kZWRdKSAtIHgoZFtiZWdpbl0pKTtcblx0ICAgICB9KTtcblxuXG5cdCBzdmcuYXBwZW5kKFwiZ1wiKVxuXHQgLmF0dHIoXCJjbGFzc1wiLCBcInggYXhpc1wiKVxuXHQgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCwgXCIgKyAoaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b20pICsgXCIpXCIpXG5cdCAudHJhbnNpdGlvbigpXG5cdCAuY2FsbCh4QXhpcyk7XG5cblx0IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBcInkgYXhpc1wiKS50cmFuc2l0aW9uKCkuY2FsbCh5QXhpcyk7XG5cblx0IHJldHVybiBnYW50dDtcblxuICAgIH07XG5cbiAgICBnYW50dC5yZWRyYXcgPSBmdW5jdGlvbih0YXNrcykge1xuICAgICAgICBjb25zb2xlLmxvZygncmVkcmF3Jyk7XG5cdGluaXRUaW1lRG9tYWluKHRhc2tzKTtcblx0aW5pdEF4aXMoKTtcblxuICAgICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KFwic3ZnXCIpO1xuXG4gICAgICAgIHZhciBnYW50dENoYXJ0R3JvdXAgPSBzdmcuc2VsZWN0KFwiLmdhbnR0LWNoYXJ0XCIpO1xuICAgICAgICB2YXIgcmVjdCA9IGdhbnR0Q2hhcnRHcm91cC5zZWxlY3RBbGwoXCJyZWN0XCIpLmRhdGEodGFza3MsIGtleUZ1bmN0aW9uKTtcblxuICAgICAgICByZWN0LmVudGVyKClcbiAgICAgICAgIC5pbnNlcnQoXCJyZWN0XCIsXCI6Zmlyc3QtY2hpbGRcIilcbiAgICAgICAgIC5hdHRyKFwicnhcIiwgNSlcbiAgICAgICAgIC5hdHRyKFwicnlcIiwgNSlcblx0IC5hdHRyKFwiY2xhc3NcIiwgZnVuY3Rpb24oZCl7XG5cdCAgICAgaWYodGFza1N0YXR1c1tkLnN0YXR1c10gPT0gbnVsbCl7IHJldHVybiBcImJhclwiO31cblx0ICAgICByZXR1cm4gdGFza1N0YXR1c1tkLnN0YXR1c107XG5cdCAgICAgfSlcblx0IC50cmFuc2l0aW9uKClcblx0IC5hdHRyKFwieVwiLCAwKVxuXHQgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgcmVjdFRyYW5zZm9ybSlcblx0IC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHkucmFuZ2VCYW5kKCk7IH0pXG5cdCAgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbihkKSB7XG5cdCAgICAgcmV0dXJuICh4KGRbZW5kZWRdKSAtIHgoZFtiZWdpbl0pKTtcblx0ICAgICB9KTtcblxuICAgICAgICByZWN0LnRyYW5zaXRpb24oKVxuICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIHJlY3RUcmFuc2Zvcm0pXG5cdCAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB5LnJhbmdlQmFuZCgpOyB9KVxuXHQgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbihkKSB7XG5cdCAgICAgcmV0dXJuICh4KGRbZW5kZWRdKSAtIHgoZFtiZWdpbl0pKTtcblx0ICAgICB9KTtcblxuXHRyZWN0LmV4aXQoKS5yZW1vdmUoKTtcblxuXHRzdmcuc2VsZWN0KFwiLnhcIikudHJhbnNpdGlvbigpLmNhbGwoeEF4aXMpO1xuXHRzdmcuc2VsZWN0KFwiLnlcIikudHJhbnNpdGlvbigpLmNhbGwoeUF4aXMpO1xuXG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG4gICAgZ2FudHQubWFyZ2luID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIG1hcmdpbjtcblx0bWFyZ2luID0gdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG4gICAgZ2FudHQudGltZURvbWFpbiA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiBbIHRpbWVEb21haW5TdGFydCwgdGltZURvbWFpbkVuZCBdO1xuXHR0aW1lRG9tYWluU3RhcnQgPSArdmFsdWVbMF0sIHRpbWVEb21haW5FbmQgPSArdmFsdWVbMV07XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9XG4gICAgICogICAgICAgICAgICAgICAgdmFsZSBUaGUgdmFsdWUgY2FuIGJlIFwiZml0XCIgLSB0aGUgZG9tYWluIGZpdHMgdGhlIGRhdGEgb3JcbiAgICAgKiAgICAgICAgICAgICAgICBcImZpeGVkXCIgLSBmaXhlZCBkb21haW4uXG4gICAgICovXG4gICAgZ2FudHQudGltZURvbWFpbk1vZGUgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gdGltZURvbWFpbk1vZGU7XG4gICAgICAgIHRpbWVEb21haW5Nb2RlID0gdmFsdWU7XG4gICAgICAgIHJldHVybiBnYW50dDtcblxuICAgIH07XG5cbiAgICBnYW50dC50YXNrVHlwZXMgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gdGFza1R5cGVzO1xuXHR0YXNrVHlwZXMgPSB2YWx1ZTtcblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cbiAgICBnYW50dC50YXNrU3RhdHVzID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIHRhc2tTdGF0dXM7XG5cdHRhc2tTdGF0dXMgPSB2YWx1ZTtcblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cblx0Z2FudHQuYmVnaW4gPSBmdW5jdGlvbih2YWx1ZSl7XG5cdFx0aWYoIWFyZ3VtZW50cy5sZW5ndGgpe1xuXHRcdFx0cmV0dXJuIGJlZ2luO1xuXHRcdH1cblx0XHRiZWdpbiA9IHZhbHVlO1xuXHRcdHJldHVybiBnYW50dDtcblx0fTtcblxuXHRnYW50dC5lbmRlZCA9IGZ1bmN0aW9uKHZhbHVlKXtcblx0XHRpZighYXJndW1lbnRzLmxlbmd0aCl7XG5cdFx0XHRyZXR1cm4gZW5kZWQ7XG5cdFx0fVxuXHRcdGVuZGVkID0gdmFsdWU7XG5cdFx0cmV0dXJuIGdhbnR0O1xuXHR9O1xuXG4gICAgZ2FudHQud2lkdGggPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gd2lkdGg7XG5cdHdpZHRoID0gK3ZhbHVlO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIGdhbnR0LmhlaWdodCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiBoZWlnaHQ7XG5cdGhlaWdodCA9ICt2YWx1ZTtcblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cbiAgICBnYW50dC50aWNrRm9ybWF0ID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIHRpY2tGb3JtYXQ7XG5cdHRpY2tGb3JtYXQgPSB2YWx1ZTtcblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cblx0Z2FudHQucmVuZGVyVG8gPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdGlmKCFhcmd1bWVudHMubGVuZ3RoKXtcblx0XHRcdHJldHVybiByZW5kZXJUbztcblx0XHR9XG5cdFx0cmVuZGVyVG8gPSB2YWx1ZTtcblx0XHRyZXR1cm4gZ2FudHQ7XG5cdH07XG5cblxuXG4gICAgcmV0dXJuIGdhbnR0O1xufTtcbiIsImZ1bmN0aW9uIEdhdWdlKHBsYWNlaG9sZGVyTmFtZSwgY29uZmlndXJhdGlvbilcbntcbiAgICB0aGlzLnBsYWNlaG9sZGVyTmFtZSA9IHBsYWNlaG9sZGVyTmFtZTtcblxuICAgIHZhciBzZWxmID0gdGhpczsgLy8gZm9yIGludGVybmFsIGQzIGZ1bmN0aW9uc1xuXG4gICAgdGhpcy5jb25maWd1cmUgPSBmdW5jdGlvbihjb25maWd1cmF0aW9uKVxuICAgIHtcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWd1cmF0aW9uO1xuXG4gICAgICAgIHRoaXMuY29uZmlnLnNpemUgPSB0aGlzLmNvbmZpZy5zaXplICogMC45O1xuXG4gICAgICAgIHRoaXMuY29uZmlnLnJhZHVpcyA9IHRoaXMuY29uZmlnLnNpemUgKiAwLjk3IC8gMjtcbiAgICAgICAgdGhpcy5jb25maWcuY3ggPSB0aGlzLmNvbmZpZy5zaXplIC8gMjtcbiAgICAgICAgdGhpcy5jb25maWcuY3kgPSB0aGlzLmNvbmZpZy5zaXplIC8gMjtcblxuICAgICAgICB0aGlzLmNvbmZpZy5taW4gPSB1bmRlZmluZWQgIT0gY29uZmlndXJhdGlvbi5taW4gPyBjb25maWd1cmF0aW9uLm1pbiA6IDA7XG4gICAgICAgIHRoaXMuY29uZmlnLm1heCA9IHVuZGVmaW5lZCAhPSBjb25maWd1cmF0aW9uLm1heCA/IGNvbmZpZ3VyYXRpb24ubWF4IDogMTAwO1xuICAgICAgICB0aGlzLmNvbmZpZy5yYW5nZSA9IHRoaXMuY29uZmlnLm1heCAtIHRoaXMuY29uZmlnLm1pbjtcblxuICAgICAgICB0aGlzLmNvbmZpZy5tYWpvclRpY2tzID0gY29uZmlndXJhdGlvbi5tYWpvclRpY2tzIHx8IDU7XG4gICAgICAgIHRoaXMuY29uZmlnLm1pbm9yVGlja3MgPSBjb25maWd1cmF0aW9uLm1pbm9yVGlja3MgfHwgMjtcblxuICAgICAgICB0aGlzLmNvbmZpZy5ncmVlbkNvbG9yIFx0PSBjb25maWd1cmF0aW9uLmdyZWVuQ29sb3IgfHwgXCIjOGZjYTBlXCI7XG4gICAgICAgIHRoaXMuY29uZmlnLnllbGxvd0NvbG9yID0gY29uZmlndXJhdGlvbi55ZWxsb3dDb2xvciB8fCBcIiNmZmMzMTdcIjtcbiAgICAgICAgdGhpcy5jb25maWcucmVkQ29sb3IgXHQ9IGNvbmZpZ3VyYXRpb24ucmVkQ29sb3IgfHwgXCIjZjU0ZDM2XCI7XG5cbiAgICAgICAgdGhpcy5jb25maWcudHJhbnNpdGlvbkR1cmF0aW9uID0gY29uZmlndXJhdGlvbi50cmFuc2l0aW9uRHVyYXRpb24gfHwgNTAwO1xuICAgIH07XG5cbiAgICB0aGlzLnJlbmRlciA9IGZ1bmN0aW9uKClcbiAgICB7XG4gICAgICAgIHRoaXMuYm9keSA9IGQzLnNlbGVjdChcIiNcIiArIHRoaXMucGxhY2Vob2xkZXJOYW1lKVxuICAgICAgICAgICAgLmFwcGVuZChcInN2ZzpzdmdcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJnYXVnZVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB0aGlzLmNvbmZpZy5zaXplKVxuICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgdGhpcy5jb25maWcuc2l6ZSk7XG5cbiAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpjaXJjbGVcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJvdXRlci1jaXJjbGVcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAuYXR0cihcImN5XCIsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgLmF0dHIoXCJyXCIsIHRoaXMuY29uZmlnLnJhZHVpcyAqIDAuOTUpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiI2NjY1wiKTtcbiAgICAgICAgICAgIC8qLnN0eWxlKFwic3Ryb2tlXCIsIFwiIzAwMFwiKVxuICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMC41cHhcIik7Ki9cblxuICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOmNpcmNsZVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjeFwiLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgdGhpcy5jb25maWcuY3kpXG4gICAgICAgICAgICAuYXR0cihcInJcIiwgMC45ICogdGhpcy5jb25maWcucmFkdWlzKVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiNmZmZcIilcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcIiNlMGUwZTBcIilcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjJweFwiKTtcblxuICAgICAgICBmb3IgKHZhciBncmVlbklkeCBpbiB0aGlzLmNvbmZpZy5ncmVlblpvbmVzKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLmRyYXdCYW5kKHRoaXMuY29uZmlnLmdyZWVuWm9uZXNbZ3JlZW5JZHhdLmZyb20sIHRoaXMuY29uZmlnLmdyZWVuWm9uZXNbZ3JlZW5JZHhdLnRvLCBzZWxmLmNvbmZpZy5ncmVlbkNvbG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIHllbGxvd0lkeCBpbiB0aGlzLmNvbmZpZy55ZWxsb3dab25lcylcbiAgICAgICAge1xuICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy55ZWxsb3dab25lc1t5ZWxsb3dJZHhdLmZyb20sIHRoaXMuY29uZmlnLnllbGxvd1pvbmVzW3llbGxvd0lkeF0udG8sIHNlbGYuY29uZmlnLnllbGxvd0NvbG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIHJlZElkeCBpbiB0aGlzLmNvbmZpZy5yZWRab25lcylcbiAgICAgICAge1xuICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy5yZWRab25lc1tyZWRJZHhdLmZyb20sIHRoaXMuY29uZmlnLnJlZFpvbmVzW3JlZElkeF0udG8sIHNlbGYuY29uZmlnLnJlZENvbG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmb250U2l6ZSA9IDA7XG5cbiAgICAgICAgaWYgKHVuZGVmaW5lZCAhPSB0aGlzLmNvbmZpZy5sYWJlbClcbiAgICAgICAge1xuICAgICAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyA5KTtcbiAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6dGV4dFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgdGhpcy5jb25maWcuY3kgLyAyICsgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgICAgICAgICAgICAudGV4dCh0aGlzLmNvbmZpZy5sYWJlbClcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgZm9udFNpemUgKyBcInB4XCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiMzMzNcIilcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIwcHhcIik7XG4gICAgICAgIH1cblxuICAgICAgICBmb250U2l6ZSA9IE1hdGgucm91bmQodGhpcy5jb25maWcuc2l6ZSAvIDE2KTtcbiAgICAgICAgdmFyIG1ham9yRGVsdGEgPSB0aGlzLmNvbmZpZy5yYW5nZSAvICh0aGlzLmNvbmZpZy5tYWpvclRpY2tzIC0gMSk7XG4gICAgICAgIGZvciAodmFyIG1ham9yID0gdGhpcy5jb25maWcubWluOyBtYWpvciA8PSB0aGlzLmNvbmZpZy5tYXg7IG1ham9yICs9IG1ham9yRGVsdGEpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBtaW5vckRlbHRhID0gbWFqb3JEZWx0YSAvIHRoaXMuY29uZmlnLm1pbm9yVGlja3MsXG4gICAgICAgICAgICAgICAgcG9pbnQxID0gMCxcbiAgICAgICAgICAgICAgICBwb2ludDIgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgbWlub3IgPSBtYWpvciArIG1pbm9yRGVsdGE7IG1pbm9yIDwgTWF0aC5taW4obWFqb3IgKyBtYWpvckRlbHRhLCB0aGlzLmNvbmZpZy5tYXgpOyBtaW5vciArPSBtaW5vckRlbHRhKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBvaW50MSA9IHRoaXMudmFsdWVUb1BvaW50KG1pbm9yLCAwLjc1KTtcbiAgICAgICAgICAgICAgICBwb2ludDIgPSB0aGlzLnZhbHVlVG9Qb2ludChtaW5vciwgMC44NSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOmxpbmVcIilcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4MVwiLCBwb2ludDEueClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5MVwiLCBwb2ludDEueSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4MlwiLCBwb2ludDIueClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5MlwiLCBwb2ludDIueSlcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiIzY2NlwiKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIxcHhcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBvaW50MSA9IHRoaXMudmFsdWVUb1BvaW50KG1ham9yLCAwLjcpO1xuICAgICAgICAgICAgcG9pbnQyID0gdGhpcy52YWx1ZVRvUG9pbnQobWFqb3IsIDAuODUpO1xuXG4gICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOmxpbmVcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcIngxXCIsIHBvaW50MS54KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieTFcIiwgcG9pbnQxLnkpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ4MlwiLCBwb2ludDIueClcbiAgICAgICAgICAgICAgICAuYXR0cihcInkyXCIsIHBvaW50Mi55KVxuICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcIiMzMzNcIilcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIycHhcIik7XG5cbiAgICAgICAgICAgIGlmIChtYWpvciA9PSB0aGlzLmNvbmZpZy5taW4gfHwgbWFqb3IgPT0gdGhpcy5jb25maWcubWF4KVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBwb2ludCA9IHRoaXMudmFsdWVUb1BvaW50KG1ham9yLCAwLjYzKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6dGV4dFwiKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgcG9pbnQueClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHBvaW50LnkpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgZm9udFNpemUgLyAzKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIG1ham9yID09IHRoaXMuY29uZmlnLm1pbiA/IFwic3RhcnRcIiA6IFwiZW5kXCIpXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KG1ham9yKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgZm9udFNpemUgKyBcInB4XCIpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjMzMzXCIpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjBweFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwb2ludGVyQ29udGFpbmVyID0gdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpnXCIpLmF0dHIoXCJjbGFzc1wiLCBcInBvaW50ZXJDb250YWluZXJcIik7XG5cbiAgICAgICAgdmFyIG1pZFZhbHVlID0gKHRoaXMuY29uZmlnLm1pbiArIHRoaXMuY29uZmlnLm1heCkgLyAyO1xuXG4gICAgICAgIHZhciBwb2ludGVyUGF0aCA9IHRoaXMuYnVpbGRQb2ludGVyUGF0aChtaWRWYWx1ZSk7XG5cbiAgICAgICAgdmFyIHBvaW50ZXJMaW5lID0gZDMuc3ZnLmxpbmUoKVxuICAgICAgICAgICAgLngoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC54IH0pXG4gICAgICAgICAgICAueShmdW5jdGlvbihkKSB7IHJldHVybiBkLnkgfSlcbiAgICAgICAgICAgIC5pbnRlcnBvbGF0ZShcImJhc2lzXCIpO1xuXG4gICAgICAgIHBvaW50ZXJDb250YWluZXIuc2VsZWN0QWxsKFwicGF0aFwiKVxuICAgICAgICAgICAgLmRhdGEoW3BvaW50ZXJQYXRoXSlcbiAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKFwic3ZnOnBhdGhcIilcbiAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBwb2ludGVyTGluZSlcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjODg4XCIpO1xuXG4gICAgICAgIHBvaW50ZXJDb250YWluZXIuYXBwZW5kKFwic3ZnOmNpcmNsZVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjeFwiLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgdGhpcy5jb25maWcuY3kpXG4gICAgICAgICAgICAuYXR0cihcInJcIiwgMC4xMiAqIHRoaXMuY29uZmlnLnJhZHVpcylcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjODg4XCIpO1xuXG4gICAgICAgIGZvbnRTaXplID0gTWF0aC5yb3VuZCh0aGlzLmNvbmZpZy5zaXplIC8gMTApO1xuICAgICAgICBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbChcInRleHRcIilcbiAgICAgICAgICAgIC5kYXRhKFttaWRWYWx1ZV0pXG4gICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgLmFwcGVuZChcInN2Zzp0ZXh0XCIpXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAuYXR0cihcInlcIiwgdGhpcy5jb25maWcuc2l6ZSAtIHRoaXMuY29uZmlnLmN5IC8gNCAtIGZvbnRTaXplKVxuICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBmb250U2l6ZSAvIDIpXG4gICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgZm9udFNpemUgKyBcInB4XCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzAwMFwiKVxuICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMHB4XCIpO1xuXG4gICAgICAgIHRoaXMucmVkcmF3KHRoaXMuY29uZmlnLm1pbiwgMCk7XG4gICAgfTtcblxuICAgIHRoaXMuYnVpbGRQb2ludGVyUGF0aCA9IGZ1bmN0aW9uKHZhbHVlKVxuICAgIHtcbiAgICAgICAgdmFyIGRlbHRhID0gdGhpcy5jb25maWcucmFuZ2UgLyAxMztcblxuICAgICAgICB2YXIgaGVhZCA9IHZhbHVlVG9Qb2ludCh2YWx1ZSwgMC44NSk7XG4gICAgICAgIHZhciBoZWFkMSA9IHZhbHVlVG9Qb2ludCh2YWx1ZSAtIGRlbHRhLCAwLjEyKTtcbiAgICAgICAgdmFyIGhlYWQyID0gdmFsdWVUb1BvaW50KHZhbHVlICsgZGVsdGEsIDAuMTIpO1xuXG4gICAgICAgIHZhciB0YWlsVmFsdWUgPSB2YWx1ZSAtICh0aGlzLmNvbmZpZy5yYW5nZSAqICgxLygyNzAvMzYwKSkgLyAyKTtcbiAgICAgICAgdmFyIHRhaWwgPSB2YWx1ZVRvUG9pbnQodGFpbFZhbHVlLCAwLjI4KTtcbiAgICAgICAgdmFyIHRhaWwxID0gdmFsdWVUb1BvaW50KHRhaWxWYWx1ZSAtIGRlbHRhLCAwLjEyKTtcbiAgICAgICAgdmFyIHRhaWwyID0gdmFsdWVUb1BvaW50KHRhaWxWYWx1ZSArIGRlbHRhLCAwLjEyKTtcblxuICAgICAgICByZXR1cm4gW2hlYWQsIGhlYWQxLCB0YWlsMiwgdGFpbCwgdGFpbDEsIGhlYWQyLCBoZWFkXTtcblxuICAgICAgICBmdW5jdGlvbiB2YWx1ZVRvUG9pbnQodmFsdWUsIGZhY3RvcilcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIHBvaW50ID0gc2VsZi52YWx1ZVRvUG9pbnQodmFsdWUsIGZhY3Rvcik7XG4gICAgICAgICAgICBwb2ludC54IC09IHNlbGYuY29uZmlnLmN4O1xuICAgICAgICAgICAgcG9pbnQueSAtPSBzZWxmLmNvbmZpZy5jeTtcbiAgICAgICAgICAgIHJldHVybiBwb2ludDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmRyYXdCYW5kID0gZnVuY3Rpb24oc3RhcnQsIGVuZCwgY29sb3IpXG4gICAge1xuICAgICAgICBpZiAoMCA+PSBlbmQgLSBzdGFydCkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6cGF0aFwiKVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBjb2xvcilcbiAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBkMy5zdmcuYXJjKClcbiAgICAgICAgICAgICAgICAuc3RhcnRBbmdsZSh0aGlzLnZhbHVlVG9SYWRpYW5zKHN0YXJ0KSlcbiAgICAgICAgICAgICAgICAuZW5kQW5nbGUodGhpcy52YWx1ZVRvUmFkaWFucyhlbmQpKVxuICAgICAgICAgICAgICAgIC5pbm5lclJhZGl1cygwLjY1ICogdGhpcy5jb25maWcucmFkdWlzKVxuICAgICAgICAgICAgICAgIC5vdXRlclJhZGl1cygwLjg1ICogdGhpcy5jb25maWcucmFkdWlzKSlcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyBzZWxmLmNvbmZpZy5jeCArIFwiLCBcIiArIHNlbGYuY29uZmlnLmN5ICsgXCIpIHJvdGF0ZSgyNzApXCIgfSk7XG4gICAgfTtcblxuICAgIHRoaXMucmVkcmF3ID0gZnVuY3Rpb24odmFsdWUsIHRyYW5zaXRpb25EdXJhdGlvbilcbiAgICB7XG4gICAgICAgIHZhciBwb2ludGVyQ29udGFpbmVyID0gdGhpcy5ib2R5LnNlbGVjdChcIi5wb2ludGVyQ29udGFpbmVyXCIpO1xuXG4gICAgICAgIHBvaW50ZXJDb250YWluZXIuc2VsZWN0QWxsKFwidGV4dFwiKS50ZXh0KE1hdGgucm91bmQodmFsdWUpKTtcblxuICAgICAgICB2YXIgcG9pbnRlciA9IHBvaW50ZXJDb250YWluZXIuc2VsZWN0QWxsKFwicGF0aFwiKTtcbiAgICAgICAgcG9pbnRlci50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5kdXJhdGlvbih1bmRlZmluZWQgIT0gdHJhbnNpdGlvbkR1cmF0aW9uID8gdHJhbnNpdGlvbkR1cmF0aW9uIDogdGhpcy5jb25maWcudHJhbnNpdGlvbkR1cmF0aW9uKVxuICAgICAgICAgICAgLy8uZGVsYXkoMClcbiAgICAgICAgICAgIC8vLmVhc2UoXCJsaW5lYXJcIilcbiAgICAgICAgICAgIC8vLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZClcbiAgICAgICAgICAgIC5hdHRyVHdlZW4oXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBwb2ludGVyVmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiBzZWxmLmNvbmZpZy5tYXgpIHBvaW50ZXJWYWx1ZSA9IHNlbGYuY29uZmlnLm1heCArIDAuMDIqc2VsZi5jb25maWcucmFuZ2U7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPCBzZWxmLmNvbmZpZy5taW4pIHBvaW50ZXJWYWx1ZSA9IHNlbGYuY29uZmlnLm1pbiAtIDAuMDIqc2VsZi5jb25maWcucmFuZ2U7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldFJvdGF0aW9uID0gKHNlbGYudmFsdWVUb0RlZ3JlZXMocG9pbnRlclZhbHVlKSAtIDkwKTtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFJvdGF0aW9uID0gc2VsZi5fY3VycmVudFJvdGF0aW9uIHx8IHRhcmdldFJvdGF0aW9uO1xuICAgICAgICAgICAgICAgIHNlbGYuX2N1cnJlbnRSb3RhdGlvbiA9IHRhcmdldFJvdGF0aW9uO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0ZXApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm90YXRpb24gPSBjdXJyZW50Um90YXRpb24gKyAodGFyZ2V0Um90YXRpb24tY3VycmVudFJvdGF0aW9uKSpzdGVwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyBzZWxmLmNvbmZpZy5jeCArIFwiLCBcIiArIHNlbGYuY29uZmlnLmN5ICsgXCIpIHJvdGF0ZShcIiArIHJvdGF0aW9uICsgXCIpXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIG91dGVyQ2lyY2xlID0gdGhpcy5ib2R5LnNlbGVjdChcIi5vdXRlci1jaXJjbGVcIilcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5kdXJhdGlvbig3NTApXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IHBhcnNlSW50KHZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoaSA+IDAgJiYgaSA8IDc1KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5ncmVlbkNvbG9yO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+PSA3NSAmJiBpIDwgOTApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLnllbGxvd0NvbG9yO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5yZWRDb2xvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy52YWx1ZVRvRGVncmVlcyA9IGZ1bmN0aW9uKHZhbHVlKVxuICAgIHtcbiAgICAgICAgLy8gdGhhbmtzIEBjbG9zZWFsZXJ0XG4gICAgICAgIC8vcmV0dXJuIHZhbHVlIC8gdGhpcy5jb25maWcucmFuZ2UgKiAyNzAgLSA0NTtcbiAgICAgICAgcmV0dXJuIHZhbHVlIC8gdGhpcy5jb25maWcucmFuZ2UgKiAyNzAgLSAodGhpcy5jb25maWcubWluIC8gdGhpcy5jb25maWcucmFuZ2UgKiAyNzAgKyA0NSk7XG4gICAgfTtcblxuICAgIHRoaXMudmFsdWVUb1JhZGlhbnMgPSBmdW5jdGlvbih2YWx1ZSlcbiAgICB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlVG9EZWdyZWVzKHZhbHVlKSAqIE1hdGguUEkgLyAxODA7XG4gICAgfTtcblxuICAgIHRoaXMudmFsdWVUb1BvaW50ID0gZnVuY3Rpb24odmFsdWUsIGZhY3RvcilcbiAgICB7XG4gICAgICAgIHJldHVybiB7IFx0eDogdGhpcy5jb25maWcuY3ggLSB0aGlzLmNvbmZpZy5yYWR1aXMgKiBmYWN0b3IgKiBNYXRoLmNvcyh0aGlzLnZhbHVlVG9SYWRpYW5zKHZhbHVlKSksXG4gICAgICAgICAgICB5OiB0aGlzLmNvbmZpZy5jeSAtIHRoaXMuY29uZmlnLnJhZHVpcyAqIGZhY3RvciAqIE1hdGguc2luKHRoaXMudmFsdWVUb1JhZGlhbnModmFsdWUpKSBcdFx0fTtcbiAgICB9O1xuXG4gICAgLy8gaW5pdGlhbGl6YXRpb25cbiAgICB0aGlzLmNvbmZpZ3VyZShjb25maWd1cmF0aW9uKTtcbn0iLCIvKiEgXG4gKiBhbmd1bGFyLWhvdGtleXMgdjEuNS4wXG4gKiBodHRwczovL2NoaWVmZmFuY3lwYW50cy5naXRodWIuaW8vYW5ndWxhci1ob3RrZXlzXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUgV2VzIENydXZlclxuICogTGljZW5zZTogTUlUXG4gKi9cbiFmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2FuZ3VsYXIubW9kdWxlKFwiY2ZwLmhvdGtleXNcIixbXSkucHJvdmlkZXIoXCJob3RrZXlzXCIsW1wiJGluamVjdG9yXCIsZnVuY3Rpb24oYSl7dGhpcy5pbmNsdWRlQ2hlYXRTaGVldD0hMCx0aGlzLnVzZU5nUm91dGU9YS5oYXMoXCJuZ1ZpZXdEaXJlY3RpdmVcIiksdGhpcy50ZW1wbGF0ZVRpdGxlPVwiS2V5Ym9hcmQgU2hvcnRjdXRzOlwiLHRoaXMudGVtcGxhdGVIZWFkZXI9bnVsbCx0aGlzLnRlbXBsYXRlRm9vdGVyPW51bGwsdGhpcy50ZW1wbGF0ZT0nPGRpdiBjbGFzcz1cImNmcC1ob3RrZXlzLWNvbnRhaW5lciBmYWRlXCIgbmctY2xhc3M9XCJ7aW46IGhlbHBWaXNpYmxlfVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj48ZGl2IGNsYXNzPVwiY2ZwLWhvdGtleXNcIj48aDQgY2xhc3M9XCJjZnAtaG90a2V5cy10aXRsZVwiIG5nLWlmPVwiIWhlYWRlclwiPnt7IHRpdGxlIH19PC9oND48ZGl2IG5nLWJpbmQtaHRtbD1cImhlYWRlclwiIG5nLWlmPVwiaGVhZGVyXCI+PC9kaXY+PHRhYmxlPjx0Ym9keT48dHIgbmctcmVwZWF0PVwiaG90a2V5IGluIGhvdGtleXMgfCBmaWx0ZXI6eyBkZXNjcmlwdGlvbjogXFwnISQkdW5kZWZpbmVkJCRcXCcgfVwiPjx0ZCBjbGFzcz1cImNmcC1ob3RrZXlzLWtleXNcIj48c3BhbiBuZy1yZXBlYXQ9XCJrZXkgaW4gaG90a2V5LmZvcm1hdCgpIHRyYWNrIGJ5ICRpbmRleFwiIGNsYXNzPVwiY2ZwLWhvdGtleXMta2V5XCI+e3sga2V5IH19PC9zcGFuPjwvdGQ+PHRkIGNsYXNzPVwiY2ZwLWhvdGtleXMtdGV4dFwiPnt7IGhvdGtleS5kZXNjcmlwdGlvbiB9fTwvdGQ+PC90cj48L3Rib2R5PjwvdGFibGU+PGRpdiBuZy1iaW5kLWh0bWw9XCJmb290ZXJcIiBuZy1pZj1cImZvb3RlclwiPjwvZGl2PjxkaXYgY2xhc3M9XCJjZnAtaG90a2V5cy1jbG9zZVwiIG5nLWNsaWNrPVwidG9nZ2xlQ2hlYXRTaGVldCgpXCI+w5c8L2Rpdj48L2Rpdj48L2Rpdj4nLHRoaXMuY2hlYXRTaGVldEhvdGtleT1cIj9cIix0aGlzLmNoZWF0U2hlZXREZXNjcmlwdGlvbj1cIlNob3cgLyBoaWRlIHRoaXMgaGVscCBtZW51XCIsdGhpcy4kZ2V0PVtcIiRyb290RWxlbWVudFwiLFwiJHJvb3RTY29wZVwiLFwiJGNvbXBpbGVcIixcIiR3aW5kb3dcIixcIiRkb2N1bWVudFwiLGZ1bmN0aW9uKGEsYixjLGQsZSl7ZnVuY3Rpb24gZihhKXt2YXIgYj17Y29tbWFuZDpcIuKMmFwiLHNoaWZ0Olwi4oenXCIsbGVmdDpcIuKGkFwiLHJpZ2h0Olwi4oaSXCIsdXA6XCLihpFcIixkb3duOlwi4oaTXCIsXCJyZXR1cm5cIjpcIuKGqVwiLGJhY2tzcGFjZTpcIuKMq1wifTthPWEuc3BsaXQoXCIrXCIpO2Zvcih2YXIgYz0wO2M8YS5sZW5ndGg7YysrKVwibW9kXCI9PT1hW2NdJiYoZC5uYXZpZ2F0b3ImJmQubmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJNYWNcIik+PTA/YVtjXT1cImNvbW1hbmRcIjphW2NdPVwiY3RybFwiKSxhW2NdPWJbYVtjXV18fGFbY107cmV0dXJuIGEuam9pbihcIiArIFwiKX1mdW5jdGlvbiBnKGEsYixjLGQsZSxmKXt0aGlzLmNvbWJvPWEgaW5zdGFuY2VvZiBBcnJheT9hOlthXSx0aGlzLmRlc2NyaXB0aW9uPWIsdGhpcy5jYWxsYmFjaz1jLHRoaXMuYWN0aW9uPWQsdGhpcy5hbGxvd0luPWUsdGhpcy5wZXJzaXN0ZW50PWYsdGhpcy5fZm9ybWF0ZWQ9bnVsbH1mdW5jdGlvbiBoKCl7Zm9yKHZhciBhPW8uaG90a2V5cy5sZW5ndGg7YS0tOyl7dmFyIGI9by5ob3RrZXlzW2FdO2ImJiFiLnBlcnNpc3RlbnQmJmsoYil9fWZ1bmN0aW9uIGkoKXtvLmhlbHBWaXNpYmxlPSFvLmhlbHBWaXNpYmxlLG8uaGVscFZpc2libGU/KHQ9bChcImVzY1wiKSxrKFwiZXNjXCIpLGooXCJlc2NcIix0LmRlc2NyaXB0aW9uLGksbnVsbCxbXCJJTlBVVFwiLFwiU0VMRUNUXCIsXCJURVhUQVJFQVwiXSkpOihrKFwiZXNjXCIpLHQhPT0hMSYmaih0KSl9ZnVuY3Rpb24gaihhLGIsYyxkLGUsZil7dmFyIGgsaT1bXCJJTlBVVFwiLFwiU0VMRUNUXCIsXCJURVhUQVJFQVwiXSxqPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKTtpZihcIltvYmplY3QgT2JqZWN0XVwiPT09aiYmKGI9YS5kZXNjcmlwdGlvbixjPWEuY2FsbGJhY2ssZD1hLmFjdGlvbixmPWEucGVyc2lzdGVudCxlPWEuYWxsb3dJbixhPWEuY29tYm8pLGIgaW5zdGFuY2VvZiBGdW5jdGlvbj8oZD1jLGM9YixiPVwiJCR1bmRlZmluZWQkJFwiKTphbmd1bGFyLmlzVW5kZWZpbmVkKGIpJiYoYj1cIiQkdW5kZWZpbmVkJCRcIiksdm9pZCAwPT09ZiYmKGY9ITApLFwiZnVuY3Rpb25cIj09dHlwZW9mIGMpe2g9YyxlIGluc3RhbmNlb2YgQXJyYXl8fChlPVtdKTtmb3IodmFyIGssbD0wO2w8ZS5sZW5ndGg7bCsrKWVbbF09ZVtsXS50b1VwcGVyQ2FzZSgpLGs9aS5pbmRleE9mKGVbbF0pLC0xIT09ayYmaS5zcGxpY2UoaywxKTtjPWZ1bmN0aW9uKGEpe3ZhciBiPSEwLGM9YS50YXJnZXR8fGEuc3JjRWxlbWVudCxkPWMubm9kZU5hbWUudG9VcHBlckNhc2UoKTtpZigoXCIgXCIrYy5jbGFzc05hbWUrXCIgXCIpLmluZGV4T2YoXCIgbW91c2V0cmFwIFwiKT4tMSliPSEwO2Vsc2UgZm9yKHZhciBlPTA7ZTxpLmxlbmd0aDtlKyspaWYoaVtlXT09PWQpe2I9ITE7YnJlYWt9YiYmbihoLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9fVwic3RyaW5nXCI9PXR5cGVvZiBkP01vdXNldHJhcC5iaW5kKGEsbihjKSxkKTpNb3VzZXRyYXAuYmluZChhLG4oYykpO3ZhciBtPW5ldyBnKGEsYixjLGQsZSxmKTtyZXR1cm4gby5ob3RrZXlzLnB1c2gobSksbX1mdW5jdGlvbiBrKGEpe3ZhciBiPWEgaW5zdGFuY2VvZiBnP2EuY29tYm86YTtpZihNb3VzZXRyYXAudW5iaW5kKGIpLGFuZ3VsYXIuaXNBcnJheShiKSl7Zm9yKHZhciBjPSEwLGQ9Yi5sZW5ndGg7ZC0tOyljPWsoYltkXSkmJmM7cmV0dXJuIGN9dmFyIGU9by5ob3RrZXlzLmluZGV4T2YobChiKSk7cmV0dXJuIGU+LTE/KG8uaG90a2V5c1tlXS5jb21iby5sZW5ndGg+MT9vLmhvdGtleXNbZV0uY29tYm8uc3BsaWNlKG8uaG90a2V5c1tlXS5jb21iby5pbmRleE9mKGIpLDEpOm8uaG90a2V5cy5zcGxpY2UoZSwxKSwhMCk6ITF9ZnVuY3Rpb24gbChhKXtpZighYSlyZXR1cm4gby5ob3RrZXlzO2Zvcih2YXIgYixjPTA7YzxvLmhvdGtleXMubGVuZ3RoO2MrKylpZihiPW8uaG90a2V5c1tjXSxiLmNvbWJvLmluZGV4T2YoYSk+LTEpcmV0dXJuIGI7cmV0dXJuITF9ZnVuY3Rpb24gbShhKXtyZXR1cm4gYS4kaWQgaW4gcHx8KHBbYS4kaWRdPVtdLGEuJG9uKFwiJGRlc3Ryb3lcIixmdW5jdGlvbigpe2Zvcih2YXIgYj1wW2EuJGlkXS5sZW5ndGg7Yi0tOylrKHBbYS4kaWRdLnBvcCgpKX0pKSx7YWRkOmZ1bmN0aW9uKGIpe3ZhciBjO3JldHVybiBjPWFyZ3VtZW50cy5sZW5ndGg+MT9qLmFwcGx5KHRoaXMsYXJndW1lbnRzKTpqKGIpLHBbYS4kaWRdLnB1c2goYyksdGhpc319fWZ1bmN0aW9uIG4oYSl7cmV0dXJuIGZ1bmN0aW9uKGMsZCl7aWYoYSBpbnN0YW5jZW9mIEFycmF5KXt2YXIgZT1hWzBdLGY9YVsxXTthPWZ1bmN0aW9uKGEpe2Yuc2NvcGUuJGV2YWwoZSl9fWIuJGFwcGx5KGZ1bmN0aW9uKCl7YShjLGwoZCkpfSl9fU1vdXNldHJhcC5wcm90b3R5cGUuc3RvcENhbGxiYWNrPWZ1bmN0aW9uKGEsYil7cmV0dXJuKFwiIFwiK2IuY2xhc3NOYW1lK1wiIFwiKS5pbmRleE9mKFwiIG1vdXNldHJhcCBcIik+LTE/ITE6Yi5jb250ZW50RWRpdGFibGUmJlwidHJ1ZVwiPT1iLmNvbnRlbnRFZGl0YWJsZX0sZy5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKCl7aWYobnVsbD09PXRoaXMuX2Zvcm1hdGVkKXtmb3IodmFyIGE9dGhpcy5jb21ib1swXSxiPWEuc3BsaXQoL1tcXHNdLyksYz0wO2M8Yi5sZW5ndGg7YysrKWJbY109ZihiW2NdKTt0aGlzLl9mb3JtYXRlZD1ifXJldHVybiB0aGlzLl9mb3JtYXRlZH07dmFyIG89Yi4kbmV3KCk7by5ob3RrZXlzPVtdLG8uaGVscFZpc2libGU9ITEsby50aXRsZT10aGlzLnRlbXBsYXRlVGl0bGUsby5oZWFkZXI9dGhpcy50ZW1wbGF0ZUhlYWRlcixvLmZvb3Rlcj10aGlzLnRlbXBsYXRlRm9vdGVyLG8udG9nZ2xlQ2hlYXRTaGVldD1pO3ZhciBwPVtdO2lmKHRoaXMudXNlTmdSb3V0ZSYmYi4kb24oXCIkcm91dGVDaGFuZ2VTdWNjZXNzXCIsZnVuY3Rpb24oYSxiKXtoKCksYiYmYi5ob3RrZXlzJiZhbmd1bGFyLmZvckVhY2goYi5ob3RrZXlzLGZ1bmN0aW9uKGEpe3ZhciBjPWFbMl07KFwic3RyaW5nXCI9PXR5cGVvZiBjfHxjIGluc3RhbmNlb2YgU3RyaW5nKSYmKGFbMl09W2MsYl0pLGFbNV09ITEsai5hcHBseSh0aGlzLGEpfSl9KSx0aGlzLmluY2x1ZGVDaGVhdFNoZWV0KXt2YXIgcT1lWzBdLHI9YVswXSxzPWFuZ3VsYXIuZWxlbWVudCh0aGlzLnRlbXBsYXRlKTtqKHRoaXMuY2hlYXRTaGVldEhvdGtleSx0aGlzLmNoZWF0U2hlZXREZXNjcmlwdGlvbixpKSwocj09PXF8fHI9PT1xLmRvY3VtZW50RWxlbWVudCkmJihyPXEuYm9keSksYW5ndWxhci5lbGVtZW50KHIpLmFwcGVuZChjKHMpKG8pKX12YXIgdD0hMSx1PXthZGQ6aixkZWw6ayxnZXQ6bCxiaW5kVG86bSx0ZW1wbGF0ZTp0aGlzLnRlbXBsYXRlLHRvZ2dsZUNoZWF0U2hlZXQ6aSxpbmNsdWRlQ2hlYXRTaGVldDp0aGlzLmluY2x1ZGVDaGVhdFNoZWV0LGNoZWF0U2hlZXRIb3RrZXk6dGhpcy5jaGVhdFNoZWV0SG90a2V5LGNoZWF0U2hlZXREZXNjcmlwdGlvbjp0aGlzLmNoZWF0U2hlZXREZXNjcmlwdGlvbix1c2VOZ1JvdXRlOnRoaXMudXNlTmdSb3V0ZSxwdXJnZUhvdGtleXM6aCx0ZW1wbGF0ZVRpdGxlOnRoaXMudGVtcGxhdGVUaXRsZX07cmV0dXJuIHV9XX1dKS5kaXJlY3RpdmUoXCJob3RrZXlcIixbXCJob3RrZXlzXCIsZnVuY3Rpb24oYSl7cmV0dXJue3Jlc3RyaWN0OlwiQVwiLGxpbms6ZnVuY3Rpb24oYixjLGQpe3ZhciBlLGY7YW5ndWxhci5mb3JFYWNoKGIuJGV2YWwoZC5ob3RrZXkpLGZ1bmN0aW9uKGIsYyl7Zj1cInN0cmluZ1wiPT10eXBlb2YgZC5ob3RrZXlBbGxvd0luP2QuaG90a2V5QWxsb3dJbi5zcGxpdCgvW1xccyxdKy8pOltdLGU9YyxhLmFkZCh7Y29tYm86YyxkZXNjcmlwdGlvbjpkLmhvdGtleURlc2NyaXB0aW9uLGNhbGxiYWNrOmIsYWN0aW9uOmQuaG90a2V5QWN0aW9uLGFsbG93SW46Zn0pfSksYy5iaW5kKFwiJGRlc3Ryb3lcIixmdW5jdGlvbigpe2EuZGVsKGUpfSl9fX1dKS5ydW4oW1wiaG90a2V5c1wiLGZ1bmN0aW9uKGEpe31dKX0oKSxmdW5jdGlvbihhLGIsYyl7ZnVuY3Rpb24gZChhLGIsYyl7cmV0dXJuIGEuYWRkRXZlbnRMaXN0ZW5lcj92b2lkIGEuYWRkRXZlbnRMaXN0ZW5lcihiLGMsITEpOnZvaWQgYS5hdHRhY2hFdmVudChcIm9uXCIrYixjKX1mdW5jdGlvbiBlKGEpe2lmKFwia2V5cHJlc3NcIj09YS50eXBlKXt2YXIgYj1TdHJpbmcuZnJvbUNoYXJDb2RlKGEud2hpY2gpO3JldHVybiBhLnNoaWZ0S2V5fHwoYj1iLnRvTG93ZXJDYXNlKCkpLGJ9cmV0dXJuIHJbYS53aGljaF0/clthLndoaWNoXTpzW2Eud2hpY2hdP3NbYS53aGljaF06U3RyaW5nLmZyb21DaGFyQ29kZShhLndoaWNoKS50b0xvd2VyQ2FzZSgpfWZ1bmN0aW9uIGYoYSxiKXtyZXR1cm4gYS5zb3J0KCkuam9pbihcIixcIik9PT1iLnNvcnQoKS5qb2luKFwiLFwiKX1mdW5jdGlvbiBnKGEpe3ZhciBiPVtdO3JldHVybiBhLnNoaWZ0S2V5JiZiLnB1c2goXCJzaGlmdFwiKSxhLmFsdEtleSYmYi5wdXNoKFwiYWx0XCIpLGEuY3RybEtleSYmYi5wdXNoKFwiY3RybFwiKSxhLm1ldGFLZXkmJmIucHVzaChcIm1ldGFcIiksYn1mdW5jdGlvbiBoKGEpe3JldHVybiBhLnByZXZlbnREZWZhdWx0P3ZvaWQgYS5wcmV2ZW50RGVmYXVsdCgpOnZvaWQoYS5yZXR1cm5WYWx1ZT0hMSl9ZnVuY3Rpb24gaShhKXtyZXR1cm4gYS5zdG9wUHJvcGFnYXRpb24/dm9pZCBhLnN0b3BQcm9wYWdhdGlvbigpOnZvaWQoYS5jYW5jZWxCdWJibGU9ITApfWZ1bmN0aW9uIGooYSl7cmV0dXJuXCJzaGlmdFwiPT1hfHxcImN0cmxcIj09YXx8XCJhbHRcIj09YXx8XCJtZXRhXCI9PWF9ZnVuY3Rpb24gaygpe2lmKCFxKXtxPXt9O2Zvcih2YXIgYSBpbiByKWE+OTUmJjExMj5hfHxyLmhhc093blByb3BlcnR5KGEpJiYocVtyW2FdXT1hKX1yZXR1cm4gcX1mdW5jdGlvbiBsKGEsYixjKXtyZXR1cm4gY3x8KGM9aygpW2FdP1wia2V5ZG93blwiOlwia2V5cHJlc3NcIiksXCJrZXlwcmVzc1wiPT1jJiZiLmxlbmd0aCYmKGM9XCJrZXlkb3duXCIpLGN9ZnVuY3Rpb24gbShhKXtyZXR1cm5cIitcIj09PWE/W1wiK1wiXTooYT1hLnJlcGxhY2UoL1xcK3syfS9nLFwiK3BsdXNcIiksYS5zcGxpdChcIitcIikpfWZ1bmN0aW9uIG4oYSxiKXt2YXIgYyxkLGUsZj1bXTtmb3IoYz1tKGEpLGU9MDtlPGMubGVuZ3RoOysrZSlkPWNbZV0sdVtkXSYmKGQ9dVtkXSksYiYmXCJrZXlwcmVzc1wiIT1iJiZ0W2RdJiYoZD10W2RdLGYucHVzaChcInNoaWZ0XCIpKSxqKGQpJiZmLnB1c2goZCk7cmV0dXJuIGI9bChkLGYsYikse2tleTpkLG1vZGlmaWVyczpmLGFjdGlvbjpifX1mdW5jdGlvbiBvKGEsYyl7cmV0dXJuIGE9PT1iPyExOmE9PT1jPyEwOm8oYS5wYXJlbnROb2RlLGMpfWZ1bmN0aW9uIHAoYSl7ZnVuY3Rpb24gYyhhKXthPWF8fHt9O3ZhciBiLGM9ITE7Zm9yKGIgaW4gdSlhW2JdP2M9ITA6dVtiXT0wO2N8fCh4PSExKX1mdW5jdGlvbiBrKGEsYixjLGQsZSxnKXt2YXIgaCxpLGs9W10sbD1jLnR5cGU7aWYoIXMuX2NhbGxiYWNrc1thXSlyZXR1cm5bXTtmb3IoXCJrZXl1cFwiPT1sJiZqKGEpJiYoYj1bYV0pLGg9MDtoPHMuX2NhbGxiYWNrc1thXS5sZW5ndGg7KytoKWlmKGk9cy5fY2FsbGJhY2tzW2FdW2hdLChkfHwhaS5zZXF8fHVbaS5zZXFdPT1pLmxldmVsKSYmbD09aS5hY3Rpb24mJihcImtleXByZXNzXCI9PWwmJiFjLm1ldGFLZXkmJiFjLmN0cmxLZXl8fGYoYixpLm1vZGlmaWVycykpKXt2YXIgbT0hZCYmaS5jb21ibz09ZSxuPWQmJmkuc2VxPT1kJiZpLmxldmVsPT1nOyhtfHxuKSYmcy5fY2FsbGJhY2tzW2FdLnNwbGljZShoLDEpLGsucHVzaChpKX1yZXR1cm4ga31mdW5jdGlvbiBsKGEsYixjLGQpe3Muc3RvcENhbGxiYWNrKGIsYi50YXJnZXR8fGIuc3JjRWxlbWVudCxjLGQpfHxhKGIsYyk9PT0hMSYmKGgoYiksaShiKSl9ZnVuY3Rpb24gbShhKXtcIm51bWJlclwiIT10eXBlb2YgYS53aGljaCYmKGEud2hpY2g9YS5rZXlDb2RlKTt2YXIgYj1lKGEpO2lmKGIpcmV0dXJuXCJrZXl1cFwiPT1hLnR5cGUmJnY9PT1iP3ZvaWQodj0hMSk6dm9pZCBzLmhhbmRsZUtleShiLGcoYSksYSl9ZnVuY3Rpb24gbygpe2NsZWFyVGltZW91dCh0KSx0PXNldFRpbWVvdXQoYywxZTMpfWZ1bmN0aW9uIHEoYSxiLGQsZil7ZnVuY3Rpb24gZyhiKXtyZXR1cm4gZnVuY3Rpb24oKXt4PWIsKyt1W2FdLG8oKX19ZnVuY3Rpb24gaChiKXtsKGQsYixhKSxcImtleXVwXCIhPT1mJiYodj1lKGIpKSxzZXRUaW1lb3V0KGMsMTApfXVbYV09MDtmb3IodmFyIGk9MDtpPGIubGVuZ3RoOysraSl7dmFyIGo9aSsxPT09Yi5sZW5ndGgsaz1qP2g6ZyhmfHxuKGJbaSsxXSkuYWN0aW9uKTtyKGJbaV0sayxmLGEsaSl9fWZ1bmN0aW9uIHIoYSxiLGMsZCxlKXtzLl9kaXJlY3RNYXBbYStcIjpcIitjXT1iLGE9YS5yZXBsYWNlKC9cXHMrL2csXCIgXCIpO3ZhciBmLGc9YS5zcGxpdChcIiBcIik7cmV0dXJuIGcubGVuZ3RoPjE/dm9pZCBxKGEsZyxiLGMpOihmPW4oYSxjKSxzLl9jYWxsYmFja3NbZi5rZXldPXMuX2NhbGxiYWNrc1tmLmtleV18fFtdLGsoZi5rZXksZi5tb2RpZmllcnMse3R5cGU6Zi5hY3Rpb259LGQsYSxlKSx2b2lkIHMuX2NhbGxiYWNrc1tmLmtleV1bZD9cInVuc2hpZnRcIjpcInB1c2hcIl0oe2NhbGxiYWNrOmIsbW9kaWZpZXJzOmYubW9kaWZpZXJzLGFjdGlvbjpmLmFjdGlvbixzZXE6ZCxsZXZlbDplLGNvbWJvOmF9KSl9dmFyIHM9dGhpcztpZihhPWF8fGIsIShzIGluc3RhbmNlb2YgcCkpcmV0dXJuIG5ldyBwKGEpO3MudGFyZ2V0PWEscy5fY2FsbGJhY2tzPXt9LHMuX2RpcmVjdE1hcD17fTt2YXIgdCx1PXt9LHY9ITEsdz0hMSx4PSExO3MuX2hhbmRsZUtleT1mdW5jdGlvbihhLGIsZCl7dmFyIGUsZj1rKGEsYixkKSxnPXt9LGg9MCxpPSExO2ZvcihlPTA7ZTxmLmxlbmd0aDsrK2UpZltlXS5zZXEmJihoPU1hdGgubWF4KGgsZltlXS5sZXZlbCkpO2ZvcihlPTA7ZTxmLmxlbmd0aDsrK2UpaWYoZltlXS5zZXEpe2lmKGZbZV0ubGV2ZWwhPWgpY29udGludWU7aT0hMCxnW2ZbZV0uc2VxXT0xLGwoZltlXS5jYWxsYmFjayxkLGZbZV0uY29tYm8sZltlXS5zZXEpfWVsc2UgaXx8bChmW2VdLmNhbGxiYWNrLGQsZltlXS5jb21ibyk7dmFyIG09XCJrZXlwcmVzc1wiPT1kLnR5cGUmJnc7ZC50eXBlIT14fHxqKGEpfHxtfHxjKGcpLHc9aSYmXCJrZXlkb3duXCI9PWQudHlwZX0scy5fYmluZE11bHRpcGxlPWZ1bmN0aW9uKGEsYixjKXtmb3IodmFyIGQ9MDtkPGEubGVuZ3RoOysrZClyKGFbZF0sYixjKX0sZChhLFwia2V5cHJlc3NcIixtKSxkKGEsXCJrZXlkb3duXCIsbSksZChhLFwia2V5dXBcIixtKX1mb3IodmFyIHEscj17ODpcImJhY2tzcGFjZVwiLDk6XCJ0YWJcIiwxMzpcImVudGVyXCIsMTY6XCJzaGlmdFwiLDE3OlwiY3RybFwiLDE4OlwiYWx0XCIsMjA6XCJjYXBzbG9ja1wiLDI3OlwiZXNjXCIsMzI6XCJzcGFjZVwiLDMzOlwicGFnZXVwXCIsMzQ6XCJwYWdlZG93blwiLDM1OlwiZW5kXCIsMzY6XCJob21lXCIsMzc6XCJsZWZ0XCIsMzg6XCJ1cFwiLDM5OlwicmlnaHRcIiw0MDpcImRvd25cIiw0NTpcImluc1wiLDQ2OlwiZGVsXCIsOTE6XCJtZXRhXCIsOTM6XCJtZXRhXCIsMjI0OlwibWV0YVwifSxzPXsxMDY6XCIqXCIsMTA3OlwiK1wiLDEwOTpcIi1cIiwxMTA6XCIuXCIsMTExOlwiL1wiLDE4NjpcIjtcIiwxODc6XCI9XCIsMTg4OlwiLFwiLDE4OTpcIi1cIiwxOTA6XCIuXCIsMTkxOlwiL1wiLDE5MjpcImBcIiwyMTk6XCJbXCIsMjIwOlwiXFxcXFwiLDIyMTpcIl1cIiwyMjI6XCInXCJ9LHQ9e1wiflwiOlwiYFwiLFwiIVwiOlwiMVwiLFwiQFwiOlwiMlwiLFwiI1wiOlwiM1wiLCQ6XCI0XCIsXCIlXCI6XCI1XCIsXCJeXCI6XCI2XCIsXCImXCI6XCI3XCIsXCIqXCI6XCI4XCIsXCIoXCI6XCI5XCIsXCIpXCI6XCIwXCIsXzpcIi1cIixcIitcIjpcIj1cIixcIjpcIjpcIjtcIiwnXCInOlwiJ1wiLFwiPFwiOlwiLFwiLFwiPlwiOlwiLlwiLFwiP1wiOlwiL1wiLFwifFwiOlwiXFxcXFwifSx1PXtvcHRpb246XCJhbHRcIixjb21tYW5kOlwibWV0YVwiLFwicmV0dXJuXCI6XCJlbnRlclwiLGVzY2FwZTpcImVzY1wiLHBsdXM6XCIrXCIsbW9kOi9NYWN8aVBvZHxpUGhvbmV8aVBhZC8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pP1wibWV0YVwiOlwiY3RybFwifSx2PTE7MjA+djsrK3YpclsxMTErdl09XCJmXCIrdjtmb3Iodj0wOzk+PXY7Kyt2KXJbdis5Nl09djtwLnByb3RvdHlwZS5iaW5kPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzO3JldHVybiBhPWEgaW5zdGFuY2VvZiBBcnJheT9hOlthXSxkLl9iaW5kTXVsdGlwbGUuY2FsbChkLGEsYixjKSxkfSxwLnByb3RvdHlwZS51bmJpbmQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzO3JldHVybiBjLmJpbmQuY2FsbChjLGEsZnVuY3Rpb24oKXt9LGIpfSxwLnByb3RvdHlwZS50cmlnZ2VyPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcztyZXR1cm4gYy5fZGlyZWN0TWFwW2ErXCI6XCIrYl0mJmMuX2RpcmVjdE1hcFthK1wiOlwiK2JdKHt9LGEpLGN9LHAucHJvdG90eXBlLnJlc2V0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztyZXR1cm4gYS5fY2FsbGJhY2tzPXt9LGEuX2RpcmVjdE1hcD17fSxhfSxwLnByb3RvdHlwZS5zdG9wQ2FsbGJhY2s9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzO3JldHVybihcIiBcIitiLmNsYXNzTmFtZStcIiBcIikuaW5kZXhPZihcIiBtb3VzZXRyYXAgXCIpPi0xPyExOm8oYixjLnRhcmdldCk/ITE6XCJJTlBVVFwiPT1iLnRhZ05hbWV8fFwiU0VMRUNUXCI9PWIudGFnTmFtZXx8XCJURVhUQVJFQVwiPT1iLnRhZ05hbWV8fGIuaXNDb250ZW50RWRpdGFibGV9LHAucHJvdG90eXBlLmhhbmRsZUtleT1mdW5jdGlvbigpe3ZhciBhPXRoaXM7cmV0dXJuIGEuX2hhbmRsZUtleS5hcHBseShhLGFyZ3VtZW50cyl9LHAuaW5pdD1mdW5jdGlvbigpe3ZhciBhPXAoYik7Zm9yKHZhciBjIGluIGEpXCJfXCIhPT1jLmNoYXJBdCgwKSYmKHBbY109ZnVuY3Rpb24oYil7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGFbYl0uYXBwbHkoYSxhcmd1bWVudHMpfX0oYykpfSxwLmluaXQoKSxhLk1vdXNldHJhcD1wLFwidW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzJiYobW9kdWxlLmV4cG9ydHM9cCksXCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kJiZkZWZpbmUoZnVuY3Rpb24oKXtyZXR1cm4gcH0pfSh3aW5kb3csZG9jdW1lbnQpOyIsImlmICghU3RyaW5nLnByb3RvdHlwZS5pbmNsdWRlcykge1xuICAgIFN0cmluZy5wcm90b3R5cGUuaW5jbHVkZXMgPSBmdW5jdGlvbihzZWFyY2gsIHN0YXJ0KSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgaWYgKHR5cGVvZiBzdGFydCAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdGFydCArIHNlYXJjaC5sZW5ndGggPiB0aGlzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhPZihzZWFyY2gsIHN0YXJ0KSAhPT0gLTE7XG4gICAgICAgIH1cbiAgICB9O1xufSIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29uZmlnKGZ1bmN0aW9uICgkcHJvdmlkZSkge1xuICAgICAgICAkcHJvdmlkZS5kZWNvcmF0b3IoJyRodHRwQmFja2VuZCcsIGFuZ3VsYXIubW9jay5lMmUuJGh0dHBCYWNrZW5kRGVjb3JhdG9yKTtcbiAgICB9KS5ydW4oZnVuY3Rpb24gKCRodHRwQmFja2VuZCwgJGludGVydmFsLCBzY2FsZUNvbmZpZywgWE1MSHR0cFJlcXVlc3QsIG1vbWVudCkge1xuXG4gICAgICAgIHZhciBnZXRTeW5jID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsLCBmYWxzZSk7XG4gICAgICAgICAgICByZXF1ZXN0LnNlbmQobnVsbCk7XG4gICAgICAgICAgICByZXR1cm4gW3JlcXVlc3Quc3RhdHVzLCByZXF1ZXN0LnJlc3BvbnNlLCB7fV07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFVybFBhcmFtcyA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSB7fTtcblxuICAgICAgICAgICAgaWYgKHVybCAmJiB1cmwuc3BsaXQoJz8nKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgdXJsLnNwbGl0KCc/JylbMV0uc3BsaXQoJyYnKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzID0gaXRlbS5zcGxpdCgnPScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgayA9IHNbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICB2ID0gc1sxXSAmJiBkZWNvZGVVUklDb21wb25lbnQoc1sxXSk7XG4gICAgICAgICAgICAgICAgICAgIChrIGluIG9iaikgPyBvYmpba10ucHVzaCh2KSA6IG9ialtrXSA9IFt2XVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEluZ2VzdHMgU3RhdHVzXG4gICAgICAgIHZhciBpbmdlc3RzU3RhdHVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnaW5nZXN0cycpICsgJ2luZ2VzdHMvc3RhdHVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGluZ2VzdHNTdGF0dXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc3RyaWtlcyA9IEpTT04ucGFyc2UoZ2V0U3luYygndGVzdC9kYXRhL2luZ2VzdFN0cmlrZXMuanNvbicpWzFdKSxcbiAgICAgICAgICAgICAgICBzdGFydERhdGUgPSBtb21lbnQudXRjKCkuc3VidHJhY3QoMSwgJ3cnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBlbmREYXRlID0gbW9tZW50LnV0YygpLmFkZCgxLCAnZCcpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG51bUhvdXJzID0gbW9tZW50LnV0YyhlbmREYXRlKS5kaWZmKG1vbWVudC51dGMoc3RhcnREYXRlKSwgJ2gnKSxcbiAgICAgICAgICAgICAgICB0aGlzVGltZSA9ICcnLFxuICAgICAgICAgICAgICAgIHZhbHVlcyA9IFtdLFxuICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKHN0cmlrZXMucmVzdWx0cywgZnVuY3Rpb24gKHN0cmlrZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1Ib3VyczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNUaW1lID0gbW9tZW50LnV0YyhzdGFydERhdGUpLmFkZChpLCAnaCcpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHRoaXNUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg1MDAgLSA1ICsgMSkpICsgNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg1MDAwMDAwMDAgLSA1MDAwMDAwICsgMSkpICsgNTAwMDAwMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdHJpa2U6IHN0cmlrZSxcbiAgICAgICAgICAgICAgICAgICAgbW9zdF9yZWNlbnQ6IG1vbWVudC51dGMoKS5zdGFydE9mKCdoJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgZmlsZXM6IDIsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IDEyMzQ1Njc4OSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiB2YWx1ZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBjb3VudDogMixcbiAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzOiBudWxsLFxuICAgICAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBkYXRhLCB7fV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEluZ2VzdHNcbiAgICAgICAgdmFyIGluZ2VzdHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvaW5nZXN0cy5qc29uJztcbiAgICAgICAgdmFyIGluZ2VzdHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdpbmdlc3RzJykgKyAnaW5nZXN0cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChpbmdlc3RzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhpbmdlc3RzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIGluZ2VzdHMgPSBKU09OLnBhcnNlKHJldHVybk9ialsxXSk7XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMub3JkZXIgJiYgdXJsUGFyYW1zLm9yZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgb3JkZXJzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh1cmxQYXJhbXMub3JkZXIsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmRlciA9IG8uY2hhckF0KDApID09PSAnLScgPyAnZGVzYycgOiAnYXNjJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gb3JkZXIgPT09ICdkZXNjJyA/IHVybFBhcmFtcy5vcmRlclswXS5zdWJzdHJpbmcoMSkgOiB1cmxQYXJhbXMub3JkZXJbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgb3JkZXJzLnB1c2gob3JkZXIpO1xuICAgICAgICAgICAgICAgICAgICBmaWVsZHMucHVzaChmaWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpbmdlc3RzLnJlc3VsdHMgPSBfLnNvcnRCeU9yZGVyKGluZ2VzdHMucmVzdWx0cywgZmllbGRzLCBvcmRlcnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLnBhZ2UgJiYgdXJsUGFyYW1zLnBhZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcGFyc2VJbnQodXJsUGFyYW1zLnBhZ2VbMF0pLFxuICAgICAgICAgICAgICAgICAgICBwYWdlU2l6ZSA9IHBhcnNlSW50KHVybFBhcmFtcy5wYWdlX3NpemVbMF0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2UgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5nZXN0cy5yZXN1bHRzID0gXy50YWtlKGluZ2VzdHMucmVzdWx0cywgcGFnZVNpemUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydElkeCA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkeEFycmF5ID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0SWR4OyBpIDwgaW5nZXN0cy5yZXN1bHRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWR4QXJyYXkucHVzaChpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGluZ2VzdHMucmVzdWx0cyA9IF8uYXQoaW5nZXN0cy5yZXN1bHRzLCBpZHhBcnJheSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGluZ2VzdHMucmVzdWx0cyA9IF8uZmlsdGVyKGluZ2VzdHMucmVzdWx0cywgZnVuY3Rpb24gKGluZ2VzdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5nZXN0LnN0YXR1cyA9PT0gdXJsUGFyYW1zLnN0YXR1c1swXTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5zdHJpa2VfaWQpIHtcbiAgICAgICAgICAgICAgICBpbmdlc3RzLnJlc3VsdHMgPSBfLmZpbHRlcihpbmdlc3RzLnJlc3VsdHMsIGZ1bmN0aW9uIChpbmdlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluZ2VzdC5zdHJpa2UuaWQgPT09IHBhcnNlSW50KHVybFBhcmFtcy5zdHJpa2VfaWRbMF0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm5PYmpbMV0gPSBKU09OLnN0cmluZ2lmeShpbmdlc3RzKTtcblxuICAgICAgICAgICAgcmV0dXJuIHJldHVybk9iajtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU291cmNlIGRldGFpbHNcbiAgICAgICAgdmFyIHNvdXJjZURldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvc291cmNlRGV0YWlscy5qc29uJztcbiAgICAgICAgdmFyIHNvdXJjZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdzb3VyY2VzJykgKyAnc291cmNlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChzb3VyY2VEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyAvLyBnZXQgdGhlIGpvYlR5cGUuaWQgZnJvbSB0aGUgdXJsXG4gICAgICAgICAgICAvLyB1cmwgPSB1cmwudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIC8vIHZhciBmaWxlbmFtZSA9IHVybC5zdWJzdHJpbmcodXJsLnN1YnN0cmluZygwLHVybC5sYXN0SW5kZXhPZignLycpKS5sYXN0SW5kZXhPZignLycpKzEsdXJsLmxlbmd0aC0xKTtcbiAgICAgICAgICAgIC8vIHNvdXJjZURldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvc291cmNlLWRldGFpbHMvJyArIGZpbGVuYW1lICsgJy5qc29uJztcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHNvdXJjZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNvdXJjZXNcbiAgICAgICAgdmFyIHNvdXJjZXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvc291cmNlcy5qc29uJztcbiAgICAgICAgdmFyIHNvdXJjZXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdzb3VyY2VzJykgKyAnc291cmNlcy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChzb3VyY2VzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvL3JldHVybiBnZXRTeW5jKHNvdXJjZXNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhzb3VyY2VzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIHNvdXJjZXMgPSBKU09OLnBhcnNlKHJldHVybk9ialsxXSk7XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMuZmlsZV9uYW1lICYmIHVybFBhcmFtcy5maWxlX25hbWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBvcmRlcnMgPSBbJ2ZpbGVfbmFtZSddLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBbJ2FzYyddO1xuXG4gICAgICAgICAgICAgICAgc291cmNlcy5yZXN1bHRzID0gXy5maWx0ZXIoc291cmNlcy5yZXN1bHRzLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5maWxlX25hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh1cmxQYXJhbXMuZmlsZV9uYW1lWzBdLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc291cmNlcy5yZXN1bHRzID0gXy5zb3J0QnlPcmRlcihzb3VyY2VzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuT2JqWzFdID0gSlNPTi5zdHJpbmdpZnkoc291cmNlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5PYmo7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEpvYiBsb2FkXG4gICAgICAgIHZhciBqb2JMb2FkUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbG9hZCcpICsgJ2xvYWQvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoam9iTG9hZFJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBudW1Ib3VycyA9IG1vbWVudC51dGMoKS5lbmRPZignZCcpLmRpZmYobW9tZW50LnV0YygpLnN1YnRyYWN0KDcsICdkJykuc3RhcnRPZignZCcpLCAnaCcpO1xuICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCg3LCAnZCcpLnN0YXJ0T2YoJ2QnKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGNvdW50OiBudW1Ib3VycyxcbiAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzOiBudWxsLFxuICAgICAgICAgICAgICAgIHJlc3VsdHM6IFtdXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEuY291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGltZTogbW9tZW50LnV0YyhzdGFydFRpbWUpLmFkZChpLCAnaCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIHBlbmRpbmdfY291bnQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICBxdWV1ZWRfY291bnQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICBydW5uaW5nX2NvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMjAgKyAxKSkgKyAyMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gWzIwMCwgZGF0YSwge31dO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgZGV0YWlsc1xuICAgICAgICB2YXIgam9iRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2JEZXRhaWxzLmpzb24nO1xuICAgICAgICB2YXIgam9iRGV0YWlsc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2JzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYkRldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgam9iVHlwZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGlkID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgam9iRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2ItZGV0YWlscy9qb2JEZXRhaWxzJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKGpvYkRldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEpvYnNcbiAgICAgICAgdmFyIGpvYnNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9icy5qc29uJztcbiAgICAgICAgdmFyIGpvYnNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2JzJykgKyAnam9icy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhqb2JzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIGpvYnMgPSBKU09OLnBhcnNlKHJldHVybk9ialsxXSk7XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMub3JkZXIgJiYgdXJsUGFyYW1zLm9yZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgb3JkZXJzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh1cmxQYXJhbXMub3JkZXIsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmRlciA9IG8uY2hhckF0KDApID09PSAnLScgPyAnZGVzYycgOiAnYXNjJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gb3JkZXIgPT09ICdkZXNjJyA/IHVybFBhcmFtcy5vcmRlclswXS5zdWJzdHJpbmcoMSkgOiB1cmxQYXJhbXMub3JkZXJbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkID09PSAnam9iX3R5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9ICdqb2JfdHlwZS5uYW1lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIG9yZGVycy5wdXNoKG9yZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgam9icy5yZXN1bHRzID0gXy5zb3J0QnlPcmRlcihqb2JzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBqb2JzLnJlc3VsdHMgPSBfLmZpbHRlcihqb2JzLnJlc3VsdHMsIGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpvYi5zdGF0dXMgPT09IHVybFBhcmFtcy5zdGF0dXNbMF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMucGFnZSkge1xuICAgICAgICAgICAgICAgIHZhciBwYWdlZFJlc3VsdHMgPSBfLmNodW5rKGpvYnMucmVzdWx0cywgdXJsUGFyYW1zLnBhZ2Vfc2l6ZSk7XG4gICAgICAgICAgICAgICAgam9icy5yZXN1bHRzID0gcGFnZWRSZXN1bHRzW3VybFBhcmFtcy5wYWdlIC0gMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybk9ialsxXSA9IEpTT04uc3RyaW5naWZ5KGpvYnMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgdHlwZSBzdGF0dXNcbiAgICAgICAgdmFyIGpvYlR5cGVTdGF0dXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iVHlwZVN0YXR1cy5qc29uJztcbiAgICAgICAgdmFyIGpvYlR5cGVTdGF0dXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvc3RhdHVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYlR5cGVTdGF0dXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhqb2JUeXBlU3RhdHVzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSdW5uaW5nIGpvYiB0eXBlc1xuICAgICAgICB2YXIgcnVubmluZ0pvYnNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcnVubmluZ0pvYnMuanNvbic7XG4gICAgICAgIHZhciBydW5uaW5nSm9ic1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ2pvYi10eXBlcycpICsgJ2pvYi10eXBlcy9ydW5uaW5nLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHJ1bm5pbmdKb2JzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMocnVubmluZ0pvYnNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEpvYiBUeXBlIERldGFpbHNcbiAgICAgICAgdmFyIGpvYlR5cGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2pvYi10eXBlcy9qb2JUeXBlMS5qc29uJztcbiAgICAgICAgdmFyIGpvYlR5cGVEZXRhaWxzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9iLXR5cGVzJykgKyAnam9iLXR5cGVzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYlR5cGVEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIGpvYlR5cGUuaWQgZnJvbSB0aGUgdXJsXG4gICAgICAgICAgICB1cmwgPSB1cmwudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBpZCA9IHVybC5zdWJzdHJpbmcodXJsLnN1YnN0cmluZygwLHVybC5sYXN0SW5kZXhPZignLycpKS5sYXN0SW5kZXhPZignLycpKzEsdXJsLmxlbmd0aC0xKTtcbiAgICAgICAgICAgIGpvYlR5cGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2pvYi10eXBlcy9qb2JUeXBlJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKGpvYlR5cGVEZXRhaWxzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgdHlwZXNcbiAgICAgICAgdmFyIGpvYlR5cGVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2pvYlR5cGVzLmpzb24nO1xuICAgICAgICB2YXIgam9iVHlwZXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdqb2ItdHlwZXMnKSArICdqb2ItdHlwZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoam9iVHlwZXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIHZhciB1cmxQYXJhbXMgPSBnZXRVcmxQYXJhbXModXJsKSxcbiAgICAgICAgICAgICAgICByZXR1cm5PYmogPSBnZXRTeW5jKGpvYlR5cGVzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIGpvYlR5cGVzID0gSlNPTi5wYXJzZShyZXR1cm5PYmpbMV0pO1xuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLm9yZGVyICYmIHVybFBhcmFtcy5vcmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9yZGVycyA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLm9yZGVyLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3JkZXIgPSBvLmNoYXJBdCgwKSA9PT0gJy0nID8gJ2Rlc2MnIDogJ2FzYycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9IG9yZGVyID09PSAnZGVzYycgPyB1cmxQYXJhbXMub3JkZXJbMF0uc3Vic3RyaW5nKDEpIDogdXJsUGFyYW1zLm9yZGVyWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIG9yZGVycy5wdXNoKG9yZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgam9iVHlwZXMucmVzdWx0cyA9IF8uc29ydEJ5T3JkZXIoam9iVHlwZXMucmVzdWx0cywgZmllbGRzLCBvcmRlcnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLm5hbWUgJiYgdXJsUGFyYW1zLm5hbWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGpvYlR5cGVzLnJlc3VsdHMgPSBfLmZpbHRlcihqb2JUeXBlcy5yZXN1bHRzLCB7IG5hbWU6IHVybFBhcmFtcy5uYW1lWzBdIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm5PYmpbMV0gPSBKU09OLnN0cmluZ2lmeShqb2JUeXBlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5PYmo7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEpvYiBleGVjdXRpb24gbG9nc1xuICAgICAgICB2YXIgam9iRXhlY3V0aW9uTG9nUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9iLWV4ZWN1dGlvbnMnKSArICdqb2ItZXhlY3V0aW9ucy8uKi9sb2dzL2NvbWJpbmVkLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYkV4ZWN1dGlvbkxvZ1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBsb2cgPSB7XG4gICAgICAgICAgICAgICAgaGl0czoge1xuICAgICAgICAgICAgICAgICAgICBoaXRzOiBbXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgbGluZXMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKDUwMCAtIDUpICsgMSkgKyA1KTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXM7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciByYW5kID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDIgLSAxICsgMSkpICsgMTtcbiAgICAgICAgICAgICAgICB2YXIgbGluZVR5cGUgPSByYW5kID09PSAxID8gJ3N0ZG91dCcgOiAnc3RkZXJyJztcbiAgICAgICAgICAgICAgICBsb2cuaGl0cy5oaXRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBfc291cmNlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhpcyBpcyBhICcgKyBsaW5lVHlwZSArICcgbWVzc2FnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnQHRpbWVzdGFtcCc6IG1vbWVudC51dGMoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVfb3JkZXJfbnVtOiBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVfdGFzazogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZV9qb2JfZXhlOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlX25vZGU6ICdub2RlJyArIGksXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW06IGxpbmVUeXBlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShsb2cpLCB7fV07XG4gICAgICAgICAgICAvLyByZXR1cm4gZ2V0U3luYyhqb2JFeGVjdXRpb25Mb2dzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gdmFyIGpvYkV4ZWN1dGlvbkxvZ3NPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iRXhlY3V0aW9uTG9nQ29tYmluZWQuanNvbic7XG5cbiAgICAgICAgLy8gSm9iIGV4ZWN1dGlvbiBEZXRhaWxzXG4gICAgICAgIHZhciBqb2JFeGVjdXRpb25EZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2pvYkV4ZWN1dGlvbkRldGFpbHMuanNvbic7XG4gICAgICAgIHZhciBqb2JFeGVjdXRpb25EZXRhaWxzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnam9iLWV4ZWN1dGlvbnMnKSArICdqb2ItZXhlY3V0aW9ucy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JFeGVjdXRpb25EZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoam9iRXhlY3V0aW9uRGV0YWlsc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cblxuICAgICAgICAvLyBNZXRyaWNzIFBsb3QgRGF0YSBEZXRhaWxcbiAgICAgICAgLy92YXIgbWV0cmljc1Bsb3REYXRhT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL21ldHJpY3NKb2JUeXBlc1Bsb3REYXRhLmpzb24nO1xuICAgICAgICB2YXIgbWV0cmljc1Bsb3REYXRhUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbWV0cmljcycpICsgJ21ldHJpY3MvLiovLiovJywnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChtZXRyaWNzUGxvdERhdGFSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIHZhciB1cmxQYXJhbXMgPSBnZXRVcmxQYXJhbXModXJsKSxcbiAgICAgICAgICAgICAgICByYW5kb20gPSAwO1xuXG4gICAgICAgICAgICB2YXIgcmV0dXJuT2JqID0ge1xuICAgICAgICAgICAgICAgIGNvdW50OiAyOCxcbiAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzOiBudWxsLFxuICAgICAgICAgICAgICAgIHJlc3VsdHM6IFtdXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgbnVtRGF5cyA9IG1vbWVudC51dGModXJsUGFyYW1zLmVuZGVkWzBdKS5kaWZmKG1vbWVudC51dGModXJsUGFyYW1zLnN0YXJ0ZWRbMF0pLCAnZCcpICsgMTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKHVybFBhcmFtcy5jb2x1bW4sIGZ1bmN0aW9uIChtZXRyaWMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF4UmFuZG9tID0gbWV0cmljID09PSAndG90YWxfY291bnQnID8gMTAwMCA6IDIwMDtcbiAgICAgICAgICAgICAgICB2YXIgbWluUmFuZG9tID0gbWV0cmljID09PSAndG90YWxfY291bnQnID8gODAwIDogMTA7XG4gICAgICAgICAgICAgICAgdmFyIHJldHVyblJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uOiB7IHRpdGxlOiBfLnN0YXJ0Q2FzZShtZXRyaWMpIH0sXG4gICAgICAgICAgICAgICAgICAgIG1pbl94OiBtb21lbnQudXRjKHVybFBhcmFtcy5zdGFydGVkWzBdKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgbWF4X3g6IG1vbWVudC51dGModXJsUGFyYW1zLmVuZGVkWzBdKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgbWluX3k6IDEsXG4gICAgICAgICAgICAgICAgICAgIG1heF95OiAxMDAwLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IFtdXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtRGF5czsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cmxQYXJhbXMuY2hvaWNlX2lkICYmIHVybFBhcmFtcy5jaG9pY2VfaWQubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHVybFBhcmFtcy5jaG9pY2VfaWQsIGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg1IC0gMSArIDEpKSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmRvbSA8PSA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXhSYW5kb20gLSBtaW5SYW5kb20gKyAxKSkgKyBtaW5SYW5kb207XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblJlc3VsdC52YWx1ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBtb21lbnQudXRjKHVybFBhcmFtcy5zdGFydGVkWzBdKS5hZGQoaSwgJ2QnKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBwYXJzZUludChpZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYW5kb20gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoNSAtIDEgKyAxKSkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmRvbSA8PSA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0LnZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbW9tZW50LnV0Yyh1cmxQYXJhbXMuc3RhcnRlZFswXSkuYWRkKGksICdkJykuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4UmFuZG9tIC0gbWluUmFuZG9tICsgMSkpICsgbWluUmFuZG9tXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqLnJlc3VsdHMucHVzaChyZXR1cm5SZXN1bHQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBbMjAwLCByZXR1cm5PYmosIHt9XTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gTWV0cmljcyBEZXRhaWxcbiAgICAgICAgdmFyIG1ldHJpY3NEZXRhaWxSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdtZXRyaWNzJykgKyAnbWV0cmljcy8uKi8nLCdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG1ldHJpY3NEZXRhaWxSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIHZhciB1cmxBcnIgPSB1cmwuc3BsaXQoJy8nKSxcbiAgICAgICAgICAgICAgICBkZXRhaWxUeXBlID0gdXJsQXJyW3VybEFyci5sZW5ndGggLSAyXTtcblxuICAgICAgICAgICAgaWYgKGRldGFpbFR5cGUgPT09ICdqb2ItdHlwZXMnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoJ3Rlc3QvZGF0YS9tZXRyaWNzSm9iVHlwZXMuanNvbicpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkZXRhaWxUeXBlID09PSAnZXJyb3ItdHlwZXMnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoJ3Rlc3QvZGF0YS9tZXRyaWNzRXJyb3JUeXBlcy5qc29uJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYygndGVzdC9kYXRhL21ldHJpY3NJbmdlc3QuanNvbicpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBNZXRyaWNzXG4gICAgICAgIHZhciBtZXRyaWNzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL21ldHJpY3MuanNvbic7XG4gICAgICAgIHZhciBtZXRyaWNzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbWV0cmljcycpICsgJ21ldHJpY3MvJywnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChtZXRyaWNzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMobWV0cmljc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gTm9kZSBkZXRhaWxzXG4gICAgICAgIHZhciBub2RlT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL25vZGUuanNvbic7XG4gICAgICAgIHZhciBub2RlUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbm9kZXMnKSArICdub2Rlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChub2RlUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMobm9kZU92ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuUEFUQ0gobm9kZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKG5vZGVPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE5vZGVzXG4gICAgICAgIHZhciBub2Rlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9ub2Rlcy5qc29uJztcbiAgICAgICAgdmFyIG5vZGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnbm9kZXMnKSArICdub2Rlcy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChub2Rlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKG5vZGVzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBRdWV1ZSBTdGF0dXMgc2VydmljZVxuICAgICAgICB2YXIgcXVldWVTdGF0dXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcXVldWVTdGF0dXMuanNvbic7XG4gICAgICAgIHZhciBxdWV1ZVN0YXR1c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3F1ZXVlJykgKyAncXVldWUvc3RhdHVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHF1ZXVlU3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMocXVldWVTdGF0dXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlY2lwZSBEZXRhaWxzXG4gICAgICAgIHZhciByZWNpcGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZURldGFpbHMuanNvbic7XG4gICAgICAgIHZhciByZWNpcGVEZXRhaWxzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlcycpICsgJ3JlY2lwZXMvLiovJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQocmVjaXBlRGV0YWlsc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgLy8gZ2V0IHRoZSByZWNpcGVEZXRhaWwuaWQgZnJvbSB0aGUgdXJsXG4gICAgICAgICAgICB1cmwgPSB1cmwudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBpZCA9IHVybC5zdWJzdHJpbmcodXJsLnN1YnN0cmluZygwLHVybC5sYXN0SW5kZXhPZignLycpKS5sYXN0SW5kZXhPZignLycpKzEsdXJsLmxlbmd0aC0xKTtcbiAgICAgICAgICAgIHJlY2lwZURldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlLWRldGFpbHMvcmVjaXBlRGV0YWlsJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlY2lwZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhyZWNpcGVEZXRhaWxzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZWNpcGVzIHNlcnZpY2VcbiAgICAgICAgdmFyIHJlY2lwZXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlcy5qc29uJztcbiAgICAgICAgdmFyIHJlY2lwZXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGVzJykgKyAncmVjaXBlcy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChyZWNpcGVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhyZWNpcGVzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIHJlY2lwZXMgPSBKU09OLnBhcnNlKHJldHVybk9ialsxXSk7XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMub3JkZXIgJiYgdXJsUGFyYW1zLm9yZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgb3JkZXJzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh1cmxQYXJhbXMub3JkZXIsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmRlciA9IG8uY2hhckF0KDApID09PSAnLScgPyAnZGVzYycgOiAnYXNjJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gb3JkZXIgPT09ICdkZXNjJyA/IHVybFBhcmFtcy5vcmRlclswXS5zdWJzdHJpbmcoMSkgOiB1cmxQYXJhbXMub3JkZXJbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkID09PSAncmVjaXBlX3R5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9ICdyZWNpcGVfdHlwZS5uYW1lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIG9yZGVycy5wdXNoKG9yZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVjaXBlcy5yZXN1bHRzID0gXy5zb3J0QnlPcmRlcihyZWNpcGVzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuT2JqWzFdID0gSlNPTi5zdHJpbmdpZnkocmVjaXBlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5PYmo7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlY2lwZSB0eXBlIHZhbGlkYXRpb24gc2VydmljZVxuICAgICAgICB2YXIgcmVjaXBlVHlwZVZhbGlkYXRpb25PdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlVHlwZVZhbGlkYXRpb25TdWNjZXNzLmpzb24nO1xuICAgICAgICB2YXIgcmVjaXBlVHlwZVZhbGlkYXRpb25SZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGUtdHlwZXMnKSArICdyZWNpcGUtdHlwZXMvdmFsaWRhdGlvbi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBPU1QocmVjaXBlVHlwZVZhbGlkYXRpb25SZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhyZWNpcGVUeXBlVmFsaWRhdGlvbk92ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVjaXBlIFR5cGUgRGV0YWlsc1xuICAgICAgICB2YXIgcmVjaXBlVHlwZURldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlLXR5cGVzL3JlY2lwZVR5cGUxLmpzb24nO1xuICAgICAgICB2YXIgcmVjaXBlVHlwZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGUtdHlwZXMnKSArICdyZWNpcGUtdHlwZXMvLiovJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQocmVjaXBlVHlwZURldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgcmVjaXBlVHlwZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGlkID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgcmVjaXBlVHlwZURldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlLXR5cGVzL3JlY2lwZVR5cGUnICsgaWQgKyAnLmpzb24nO1xuICAgICAgICAgICAgdmFyIHJldHVyblZhbHVlID0gZ2V0U3luYyhyZWNpcGVUeXBlRGV0YWlsc092ZXJyaWRlVXJsKTtcbiAgICAgICAgICAgIGlmIChyZXR1cm5WYWx1ZVswXSAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncmVjaXBlVHlwZScgKyBpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyMDAsIEpTT04ucGFyc2UocmV0dXJuVmFsdWUpLCB7fV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVjaXBlIFR5cGVzIHNlcnZpY2VcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZVR5cGVzLmpzb24nO1xuICAgICAgICB2YXIgcmVjaXBlVHlwZXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdyZWNpcGUtdHlwZXMnKSArICdyZWNpcGUtdHlwZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQocmVjaXBlVHlwZXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIHZhciB1cmxQYXJhbXMgPSBnZXRVcmxQYXJhbXModXJsKSxcbiAgICAgICAgICAgICAgICByZXR1cm5PYmogPSBnZXRTeW5jKHJlY2lwZVR5cGVzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIHJlY2lwZVR5cGVzID0gSlNPTi5wYXJzZShyZXR1cm5PYmpbMV0pO1xuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLm9yZGVyICYmIHVybFBhcmFtcy5vcmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9yZGVycyA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLm9yZGVyLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3JkZXIgPSBvLmNoYXJBdCgwKSA9PT0gJy0nID8gJ2Rlc2MnIDogJ2FzYycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9IG9yZGVyID09PSAnZGVzYycgPyB1cmxQYXJhbXMub3JkZXJbMF0uc3Vic3RyaW5nKDEpIDogdXJsUGFyYW1zLm9yZGVyWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIG9yZGVycy5wdXNoKG9yZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVjaXBlVHlwZXMucmVzdWx0cyA9IF8uc29ydEJ5T3JkZXIocmVjaXBlVHlwZXMucmVzdWx0cywgZmllbGRzLCBvcmRlcnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm5PYmpbMV0gPSBKU09OLnN0cmluZ2lmeShyZWNpcGVUeXBlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5PYmo7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNhdmUgUmVjaXBlIFR5cGVcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVTYXZlUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgncmVjaXBlLXR5cGVzJykgKyAncmVjaXBlLXR5cGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuUE9TVChyZWNpcGVUeXBlU2F2ZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIHJlY2lwZUpvYlR5cGVzID0gW10sXG4gICAgICAgICAgICAgICAgcmVjaXBlSm9iVHlwZXNEZXRhaWxzID0gW10sXG4gICAgICAgICAgICAgICAgam9iVHlwZURhdGEgPSBnZXRTeW5jKCd0ZXN0L2RhdGEvam9iVHlwZXMuanNvbicpLFxuICAgICAgICAgICAgICAgIGpvYlR5cGVzID0gSlNPTi5wYXJzZShqb2JUeXBlRGF0YVsxXSkucmVzdWx0cyxcbiAgICAgICAgICAgICAgICByZWNpcGVUeXBlID0gSlNPTi5wYXJzZShkYXRhKSxcbiAgICAgICAgICAgICAgICB1bmlxdWVSZWNpcGVUeXBlSm9icyA9IF8udW5pcShyZWNpcGVUeXBlLmRlZmluaXRpb24uam9icywgJ2pvYl90eXBlJyk7XG4gICAgICAgICAgICBfLmZvckVhY2godW5pcXVlUmVjaXBlVHlwZUpvYnMsIGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVKb2JUeXBlcy5wdXNoKF8uZmluZChqb2JUeXBlcywgZnVuY3Rpb24gKGpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGUubmFtZSA9PT0gam9iLmpvYl90eXBlLm5hbWUgJiYgam9iVHlwZS52ZXJzaW9uID09PSBqb2Iuam9iX3R5cGUudmVyc2lvbjtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF8uZm9yRWFjaChyZWNpcGVKb2JUeXBlcywgZnVuY3Rpb24gKGpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIganQgPSBnZXRTeW5jKCd0ZXN0L2RhdGEvam9iLXR5cGVzL2pvYlR5cGUnICsgam9iVHlwZS5pZCArICcuanNvbicpO1xuICAgICAgICAgICAgICAgIHJlY2lwZUpvYlR5cGVzRGV0YWlscy5wdXNoKEpTT04ucGFyc2UoanRbMV0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHJldHVyblJlY2lwZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMDAwIC0gNSArIDEpKSArIDUsXG4gICAgICAgICAgICAgICAgbmFtZTogcmVjaXBlVHlwZS5uYW1lLFxuICAgICAgICAgICAgICAgIHZlcnNpb246IHJlY2lwZVR5cGUudmVyc2lvbixcbiAgICAgICAgICAgICAgICB0aXRsZTogcmVjaXBlVHlwZS50aXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVjaXBlVHlwZS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBpc19hY3RpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgZGVmaW5pdGlvbjogcmVjaXBlVHlwZS5kZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgIHJldmlzaW9uX251bTogMSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgbGFzdF9tb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGFyY2hpdmVkOiBudWxsLFxuICAgICAgICAgICAgICAgIHRyaWdnZXJfcnVsZTogcmVjaXBlVHlwZS50cmlnZ2VyX3J1bGUsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVzOiByZWNpcGVKb2JUeXBlc0RldGFpbHNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gWzIwMCwgSlNPTi5zdHJpbmdpZnkocmV0dXJuUmVjaXBlKSwge31dO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTdGF0dXMgc2VydmljZVxuICAgICAgICB2YXIgc3RhdHVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3N0YXR1cy5qc29uJztcbiAgICAgICAgdmFyIHN0YXR1c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy5nZXRVcmxQcmVmaXgoJ3N0YXR1cycpICsgJ3N0YXR1cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChzdGF0dXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhzdGF0dXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFRlbXAgTm9kZSBTdGF0dXMgc2VydmljZVxuICAgICAgICB2YXIgdGVtcE5vZGVTdGF0dXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCdub2RlU3RhdHVzJykgKyAnc3RhdHVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHRlbXBOb2RlU3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGpvYlR5cGVEYXRhID0gZ2V0U3luYygndGVzdC9kYXRhL2pvYlR5cGVzLmpzb24nKSxcbiAgICAgICAgICAgICAgICBqb2JUeXBlcyA9IEpTT04ucGFyc2Uoam9iVHlwZURhdGFbMV0pLnJlc3VsdHMsXG4gICAgICAgICAgICAgICAgc3RhdHVzSm9iVHlwZXMgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKGpvYlR5cGVzLCBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciByYW5kID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDIgLSAxICsgMSkpICsgMTtcbiAgICAgICAgICAgICAgICBpZiAocmFuZCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXNKb2JUeXBlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0eXBlLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHlwZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogdHlwZS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHR5cGUudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdHlwZS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzX3N5c3RlbTogdHlwZS5pc19zeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uX2NvZGU6IHR5cGUuaWNvbl9jb2RlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgbm9kZXNEYXRhID0gZ2V0U3luYygndGVzdC9kYXRhL25vZGVzLmpzb24nKSxcbiAgICAgICAgICAgICAgICBub2RlcyA9IEpTT04ucGFyc2Uobm9kZXNEYXRhWzFdKS5yZXN1bHRzLFxuICAgICAgICAgICAgICAgIHN0YXR1c05vZGVzID0gW107XG5cbiAgICAgICAgICAgIHZhciBzdGF0ZXMgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnUkVBRFknLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1JlYWR5JyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOb2RlIGlzIHJlYWR5IHRvIHJ1biBuZXcgam9icy4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdQQVVTRUQnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1BhdXNlZCcsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTm9kZSBpcyBwYXVzZWQuJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnV0FJVElORycsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnV2FpdGluZycsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTm9kZSBpcyB3YWl0aW5nLidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0JVU1knLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0J1c3knLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ05vZGUgaXMgYnVzeS4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdPRkZMSU5FJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdPZmZsaW5lJyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOb2RlIGlzIG9mZmxpbmUuJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIHZhciBzdGF0ZXNSYW5kID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDIgLSAxICsgMSkpICsgMTtcbiAgICAgICAgICAgIHZhciBhY3RpdmVTdGF0ZXMgPSBzdGF0ZXNSYW5kID09PSAxID8gW3N0YXRlc1swXSxzdGF0ZXNbMV0sc3RhdGVzWzRdXSA6IFtzdGF0ZXNbMl0sc3RhdGVzWzNdLHN0YXRlc1s0XV07XG5cbiAgICAgICAgICAgIF8uZm9yRWFjaChub2RlcywgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZUVycm9ycyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAgKyAxKSk7IGUrKykge1xuICAgICAgICAgICAgICAgICAgICBub2RlRXJyb3JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ215LWVycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTXkgRXJyb3InLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdNeSBFcnJvciBEZXNjcmlwdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydGVkOiBtb21lbnQudXRjKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlZDogbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIG5vZGVXYXJuaW5ncyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgdyA9IDA7IHcgPCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAgKyAxKSk7IHcrKykge1xuICAgICAgICAgICAgICAgICAgICBub2RlV2FybmluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbXktd2FybmluZycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ015IFdhcm5pbmcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdNeSBXYXJuaW5nIERlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IG1vbWVudC51dGMoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVkOiBtb21lbnQudXRjKCkudG9JU09TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcnVubmluZ0pvYnMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gNSArIDEpKSArIDUsXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZEpvYnMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMjAwIC0gNSArIDEpKSArIDUsXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZEpvYnMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMjAgLSA1ICsgMSkpICsgNTtcblxuICAgICAgICAgICAgICAgIHZhciBydW5uaW5nSm9ic0JyZWFrZG93biA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBydW5uaW5nSm9ic0NodW5rID0gTWF0aC5mbG9vcihydW5uaW5nSm9icyAvIDMpLFxuICAgICAgICAgICAgICAgICAgICByakRpZmYgPSBydW5uaW5nSm9icyAtIChydW5uaW5nSm9ic0NodW5rICogMyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWF4UmogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTIgLSAxICsgMSkpICsgMTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciByaiA9IDA7IHJqIDwgbWF4Umo7IHJqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcnVubmluZ0pvYnNCcmVha2Rvd24ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iVHlwZXNbcmpdLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IHJqID09PSAobWF4UmogLSAxKSA/IHJ1bm5pbmdKb2JzQ2h1bmsgKyByakRpZmYgOiBydW5uaW5nSm9ic0NodW5rXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBjb21wbGV0ZWRKb2JzQnJlYWtkb3duID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZEpvYnNDaHVuayA9IE1hdGguZmxvb3IoY29tcGxldGVkSm9icyAvIDIpLFxuICAgICAgICAgICAgICAgICAgICBjakRpZmYgPSBjb21wbGV0ZWRKb2JzIC0gKGNvbXBsZXRlZEpvYnNDaHVuayAqIDIpO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgY2ogPSAwOyBjaiA8IDI7IGNqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkSm9ic0JyZWFrZG93bi5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBqb2JUeXBlc1tjal0uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogY2ogPT09IChjb21wbGV0ZWRKb2JzQ2h1bmsgLSAxKSA/IGNvbXBsZXRlZEpvYnNDaHVuayArIGNqRGlmZiA6IGNvbXBsZXRlZEpvYnNDaHVua1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZmFpbGVkSm9ic0JyZWFrZG93biA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieV9qb2JfdHlwZTogW11cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGdvcml0aG06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieV9qb2JfdHlwZTogW11cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzeXN0ZW06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieV9qb2JfdHlwZTogW11cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkSm9ic0NodW5rID0gTWF0aC5mbG9vcihmYWlsZWRKb2JzIC8gMyksXG4gICAgICAgICAgICAgICAgICAgIGZqRGlmZiA9IGZhaWxlZEpvYnMgLSAoZmFpbGVkSm9ic0NodW5rICogMyk7XG5cbiAgICAgICAgICAgICAgICBmYWlsZWRKb2JzQnJlYWtkb3duLmRhdGEudG90YWwgPSBmYWlsZWRKb2JzQ2h1bms7XG4gICAgICAgICAgICAgICAgZmFpbGVkSm9ic0JyZWFrZG93bi5hbGdvcml0aG0udG90YWwgPSBmYWlsZWRKb2JzQ2h1bms7XG4gICAgICAgICAgICAgICAgZmFpbGVkSm9ic0JyZWFrZG93bi5zeXN0ZW0udG90YWwgPSBmYWlsZWRKb2JzQ2h1bmsgKyBmakRpZmY7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0YUZhaWxDaHVuayA9IE1hdGguZmxvb3IoZmFpbGVkSm9ic0JyZWFrZG93bi5kYXRhLnRvdGFsIC8gMyksXG4gICAgICAgICAgICAgICAgICAgIGRmRGlmZiA9IGZhaWxlZEpvYnNCcmVha2Rvd24uZGF0YS50b3RhbCAtIGRhdGFGYWlsQ2h1bmssXG4gICAgICAgICAgICAgICAgICAgIGFsZ0ZhaWxDaHVuayA9IE1hdGguZmxvb3IoZmFpbGVkSm9ic0JyZWFrZG93bi5hbGdvcml0aG0udG90YWwgLyAzKSxcbiAgICAgICAgICAgICAgICAgICAgYWZEaWZmID0gZmFpbGVkSm9ic0JyZWFrZG93bi5hbGdvcml0aG0udG90YWwgLSBhbGdGYWlsQ2h1bmssXG4gICAgICAgICAgICAgICAgICAgIHN5c0ZhaWxDaHVuayA9IE1hdGguZmxvb3IoZmFpbGVkSm9ic0JyZWFrZG93bi5zeXN0ZW0udG90YWwgLyAzKSxcbiAgICAgICAgICAgICAgICAgICAgc2ZEaWZmID0gZmFpbGVkSm9ic0JyZWFrZG93bi5hbGdvcml0aG0udG90YWwgLSBzeXNGYWlsQ2h1bms7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBmaiA9IDA7IGZqIDwgMzsgZmorKykge1xuICAgICAgICAgICAgICAgICAgICBmYWlsZWRKb2JzQnJlYWtkb3duLmRhdGEuYnlfam9iX3R5cGUucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iVHlwZXNbZmpdLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGZqID09PSAoZmFpbGVkSm9ic0JyZWFrZG93bi5kYXRhLnRvdGFsIC0gMSkgPyBkYXRhRmFpbENodW5rICsgZGZEaWZmIDogZGF0YUZhaWxDaHVua1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkSm9ic0JyZWFrZG93bi5hbGdvcml0aG0uYnlfam9iX3R5cGUucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iVHlwZXNbZmpdLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGZqID09PSAoZmFpbGVkSm9ic0JyZWFrZG93bi5hbGdvcml0aG0udG90YWwgLSAxKSA/IGFsZ0ZhaWxDaHVuayArIGFmRGlmZiA6IGFsZ0ZhaWxDaHVua1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkSm9ic0JyZWFrZG93bi5zeXN0ZW0uYnlfam9iX3R5cGUucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iVHlwZXNbZmpdLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGZqID09PSAoZmFpbGVkSm9ic0JyZWFrZG93bi5zeXN0ZW0udG90YWwgLSAxKSA/IHN5c0ZhaWxDaHVuayArIHNmRGlmZiA6IHN5c0ZhaWxDaHVua1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcmFuZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgyIC0gMSArIDEpKSArIDE7XG4gICAgICAgICAgICAgICAgc3RhdHVzTm9kZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBub2RlLmlkLFxuICAgICAgICAgICAgICAgICAgICBob3N0bmFtZTogbm9kZS5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYWdlbnRfaWQ6IG5vZGUuYWdlbnRfaWQsXG4gICAgICAgICAgICAgICAgICAgIGlzX2FjdGl2ZTogcmFuZCA9PT0gMSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IHJhbmQgPT09IDEgPyBhY3RpdmVTdGF0ZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEgLSAwICsgMSkpICsgMF0gOiBhY3RpdmVTdGF0ZXNbMl0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yczogbm9kZUVycm9ycyxcbiAgICAgICAgICAgICAgICAgICAgd2FybmluZ3M6IG5vZGVXYXJuaW5ncyxcbiAgICAgICAgICAgICAgICAgICAgam9iX2V4ZWN1dGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bm5pbmc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogcnVubmluZ0pvYnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnlfam9iX3R5cGU6IHJ1bm5pbmdKb2JzQnJlYWtkb3duXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGNvbXBsZXRlZEpvYnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnlfam9iX3R5cGU6IGNvbXBsZXRlZEpvYnNCcmVha2Rvd25cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZmFpbGVkSm9icyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmYWlsZWRKb2JzQnJlYWtkb3duLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxnb3JpdGhtOiBmYWlsZWRKb2JzQnJlYWtkb3duLmFsZ29yaXRobSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeXN0ZW06IGZhaWxlZEpvYnNCcmVha2Rvd24uc3lzdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBzdGF0dXMgPSB7XG4gICAgICAgICAgICAgICAgdGltZXN0YW1wOiBtb21lbnQudXRjKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZXM6IHN0YXR1c0pvYlR5cGVzLFxuICAgICAgICAgICAgICAgIG5vZGVzOiBzdGF0dXNOb2Rlc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXR1cyk7XG4gICAgICAgICAgICByZXR1cm4gWzIwMCwgSlNPTi5zdHJpbmdpZnkoc3RhdHVzKSwge31dO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBWZXJzaW9uXG4gICAgICAgIHZhciB2ZXJzaW9uT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3ZlcnNpb24uanNvbic7XG4gICAgICAgIHZhciB2ZXJzaW9uUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3ZlcnNpb24vJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQodmVyc2lvblJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHZlcnNpb25PdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdvcmtzcGFjZSBEZXRhaWxzXG4gICAgICAgIHZhciB3b3Jrc3BhY2VEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3dvcmtzcGFjZXMvd29ya3NwYWNlMS5qc29uJztcbiAgICAgICAgdmFyIHdvcmtzcGFjZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcuZ2V0VXJsUHJlZml4KCd3b3Jrc3BhY2VzJykgKyAnd29ya3NwYWNlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVCh3b3Jrc3BhY2VEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIHdvcmtzcGFjZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGlkID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgd29ya3NwYWNlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS93b3Jrc3BhY2VzL3dvcmtzcGFjZScgKyBpZCArICcuanNvbic7XG4gICAgICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSBnZXRTeW5jKHdvcmtzcGFjZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWVbMF0gIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3dvcmtzcGFjZScgKyBpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyMDAsIEpTT04ucGFyc2UocmV0dXJuVmFsdWUpLCB7fV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuICAgICAgICAvLyBXb3Jrc3BhY2VzXG4gICAgICAgIHZhciB3b3Jrc3BhY2VzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3dvcmtzcGFjZXMuanNvbic7XG4gICAgICAgIHZhciB3b3Jrc3BhY2VzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnd29ya3NwYWNlcycpICsgJ3dvcmtzcGFjZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQod29ya3NwYWNlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHdvcmtzcGFjZXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNhdmUgV29ya3NwYWNlXG4gICAgICAgIHZhciBnZXRXb3Jrc3BhY2VSZXR1cm4gPSBmdW5jdGlvbiAoZGF0YSwgaWQpIHtcbiAgICAgICAgICAgIHZhciB3b3Jrc3BhY2UgPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiBpZCB8fCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwMDAgLSA1ICsgMSkpICsgNSxcbiAgICAgICAgICAgICAgICBuYW1lOiB3b3Jrc3BhY2UubmFtZSxcbiAgICAgICAgICAgICAgICB0aXRsZTogd29ya3NwYWNlLnRpdGxlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB3b3Jrc3BhY2UuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgYmFzZV91cmw6IHdvcmtzcGFjZS5iYXNlX3VybCxcbiAgICAgICAgICAgICAgICBpc19hY3RpdmU6IHdvcmtzcGFjZS5pc19hY3RpdmUgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgdXNlZF9zaXplOiAwLFxuICAgICAgICAgICAgICAgIHRvdGFsX3NpemU6IDAsXG4gICAgICAgICAgICAgICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGFyY2hpdmVkOiBudWxsLFxuICAgICAgICAgICAgICAgIGxhc3RfbW9kaWZpZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBqc29uX2NvbmZpZzogd29ya3NwYWNlLmpzb25fY29uZmlnXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB2YXIgd29ya3NwYWNlQ3JlYXRlUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLmdldFVybFByZWZpeCgnd29ya3NwYWNlcycpICsgJ3dvcmtzcGFjZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QT1NUKHdvcmtzcGFjZUNyZWF0ZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIHJldHVybldvcmtzcGFjZSA9IGdldFdvcmtzcGFjZVJldHVybihkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5Xb3Jrc3BhY2UpLCB7fV07XG4gICAgICAgIH0pO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBBVENIKHdvcmtzcGFjZURldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwsIGRhdGEpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgd29ya3NwYWNlLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICB2YXIgcmV0dXJuV29ya3NwYWNlID0gZ2V0V29ya3NwYWNlUmV0dXJuKGRhdGEsIGlkKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5Xb3Jrc3BhY2UpLCB7fV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN0cmlrZSBEZXRhaWxzXG4gICAgICAgIHZhciBzdHJpa2VEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3N0cmlrZXMvc3RyaWtlMS5qc29uJztcbiAgICAgICAgdmFyIHN0cmlrZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc3RyaWtlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChzdHJpa2VEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIHN0cmlrZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGlkID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgc3RyaWtlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zdHJpa2VzL3N0cmlrZScgKyBpZCArICcuanNvbic7XG4gICAgICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSBnZXRTeW5jKHN0cmlrZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWVbMF0gIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3N0cmlrZScgKyBpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyMDAsIEpTT04ucGFyc2UocmV0dXJuVmFsdWUpLCB7fV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU3RyaWtlc1xuICAgICAgICB2YXIgc3RyaWtlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zdHJpa2VzLmpzb24nO1xuICAgICAgICB2YXIgc3RyaWtlc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzdHJpa2VzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHN0cmlrZXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhzdHJpa2VzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTYXZlIFN0cmlrZVxuICAgICAgICB2YXIgZ2V0U3RyaWtlUmV0dXJuID0gZnVuY3Rpb24gKGRhdGEsIGlkKSB7XG4gICAgICAgICAgICB2YXIgc3RyaWtlID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpZDogaWQgfHwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMDAwIC0gNSArIDEpKSArIDUsXG4gICAgICAgICAgICAgICAgbmFtZTogc3RyaWtlLm5hbWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHN0cmlrZS50aXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogc3RyaWtlLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIGpvYjogbnVsbCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgbGFzdF9tb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb246IHN0cmlrZS5jb25maWd1cmF0aW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB2YXIgc3RyaWtlQ3JlYXRlUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3N0cmlrZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QT1NUKHN0cmlrZUNyZWF0ZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIHJldHVyblN0cmlrZSA9IGdldFN0cmlrZVJldHVybihkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5TdHJpa2UpLCB7fV07XG4gICAgICAgIH0pO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBBVENIKHN0cmlrZURldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwsIGRhdGEpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgc3RyaWtlLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICB2YXIgcmV0dXJuU3RyaWtlID0gZ2V0U3RyaWtlUmV0dXJuKGRhdGEsIGlkKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5TdHJpa2UpLCB7fV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNjYW4gRGV0YWlsc1xuICAgICAgICB2YXIgc2NhbkRldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvc2NhbnMvc2NhbjEuanNvbic7XG4gICAgICAgIHZhciBzY2FuRGV0YWlsc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzY2Fucy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChzY2FuRGV0YWlsc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgLy8gZ2V0IHRoZSBzY2FuLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICBzY2FuRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zY2Fucy9zY2FuJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIHZhciByZXR1cm5WYWx1ZSA9IGdldFN5bmMoc2NhbkRldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWVbMF0gIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NjYW4nICsgaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnBhcnNlKHJldHVyblZhbHVlKSwge31dO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNjYW5zXG4gICAgICAgIHZhciBzY2Fuc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zY2Fucy5qc29uJztcbiAgICAgICAgdmFyIHNjYW5zUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3NjYW5zLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHNjYW5zUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoc2NhbnNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNhdmUgU2NhblxuICAgICAgICB2YXIgZ2V0U2NhblJldHVybiA9IGZ1bmN0aW9uIChkYXRhLCBpZCkge1xuICAgICAgICAgICAgdmFyIHNjYW4gPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiBpZCB8fCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwMDAgLSA1ICsgMSkpICsgNSxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY2FuLm5hbWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHNjYW4udGl0bGUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHNjYW4uZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgZmlsZV9jb3VudDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMCAtIDEgKyAxKSkgKyAxLFxuICAgICAgICAgICAgICAgIGpvYjogbnVsbCxcbiAgICAgICAgICAgICAgICBkcnlfcnVuX2pvYjogbnVsbCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgbGFzdF9tb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb246IHNjYW4uY29uZmlndXJhdGlvblxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHNjYW5DcmVhdGVSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc2NhbnMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QT1NUKHNjYW5DcmVhdGVSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwsIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciByZXR1cm5TY2FuID0gZ2V0U2NhblJldHVybihkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5TY2FuKSwge31dO1xuICAgICAgICB9KTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QQVRDSChzY2FuRGV0YWlsc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgLy8gZ2V0IHRoZSBzY2FuLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICB2YXIgcmV0dXJuU2NhbiA9IGdldFNjYW5SZXR1cm4oZGF0YSwgaWQpO1xuICAgICAgICAgICAgcmV0dXJuIFsyMDAsIEpTT04uc3RyaW5naWZ5KHJldHVyblNjYW4pLCB7fV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEJhdGNoXG4gICAgICAgIHZhciBiYXRjaGVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2JhdGNoL2JhdGNoZXMuanNvbic7XG4gICAgICAgIHZhciBiYXRjaGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2JhdGNoZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoYmF0Y2hlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoYmF0Y2hlc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRm9yIGV2ZXJ5dGhpbmcgZWxzZSwgZG9uJ3QgbW9ja1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVCgvXlxcdysuKi8pLnBhc3NUaHJvdWdoKCk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuUE9TVCgvXlxcdysuKi8pLnBhc3NUaHJvdWdoKCk7XG4gICAgfSk7XG59KSgpO1xuIl19
