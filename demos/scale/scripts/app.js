function Gauge(e,t){this.placeholderName=e;var n=this;this.configure=function(e){this.config=e,this.config.size=.9*this.config.size,this.config.raduis=.97*this.config.size/2,this.config.cx=this.config.size/2,this.config.cy=this.config.size/2,this.config.min=void 0!=e.min?e.min:0,this.config.max=void 0!=e.max?e.max:100,this.config.range=this.config.max-this.config.min,this.config.majorTicks=e.majorTicks||5,this.config.minorTicks=e.minorTicks||2,this.config.greenColor=e.greenColor||"#8fca0e",this.config.yellowColor=e.yellowColor||"#ffc317",this.config.redColor=e.redColor||"#f54d36",this.config.transitionDuration=e.transitionDuration||500},this.render=function(){this.body=d3.select("#"+this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size),this.body.append("svg:circle").attr("class","outer-circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.95*this.config.raduis).style("fill","#ccc"),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.9*this.config.raduis).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px");for(var e in this.config.greenZones)this.drawBand(this.config.greenZones[e].from,this.config.greenZones[e].to,n.config.greenColor);for(var t in this.config.yellowZones)this.drawBand(this.config.yellowZones[t].from,this.config.yellowZones[t].to,n.config.yellowColor);for(var i in this.config.redZones)this.drawBand(this.config.redZones[i].from,this.config.redZones[i].to,n.config.redColor);var r=0;void 0!=this.config.label&&(r=Math.round(this.config.size/9),this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/2+r/2).attr("dy",r/2).attr("text-anchor","middle").text(this.config.label).style("font-size",r+"px").style("fill","#333").style("stroke-width","0px")),r=Math.round(this.config.size/16);for(var o=this.config.range/(this.config.majorTicks-1),a=this.config.min;a<=this.config.max;a+=o){for(var s=o/this.config.minorTicks,c=0,l=0,u=a+s;u<Math.min(a+o,this.config.max);u+=s)c=this.valueToPoint(u,.75),l=this.valueToPoint(u,.85),this.body.append("svg:line").attr("x1",c.x).attr("y1",c.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#666").style("stroke-width","1px");if(c=this.valueToPoint(a,.7),l=this.valueToPoint(a,.85),this.body.append("svg:line").attr("x1",c.x).attr("y1",c.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#333").style("stroke-width","2px"),a==this.config.min||a==this.config.max){var d=this.valueToPoint(a,.63);this.body.append("svg:text").attr("x",d.x).attr("y",d.y).attr("dy",r/3).attr("text-anchor",a==this.config.min?"start":"end").text(a).style("font-size",r+"px").style("fill","#333").style("stroke-width","0px")}}var p=this.body.append("svg:g").attr("class","pointerContainer"),f=(this.config.min+this.config.max)/2,g=this.buildPointerPath(f),m=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("basis");p.selectAll("path").data([g]).enter().append("svg:path").attr("d",m).style("fill","#888"),p.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.12*this.config.raduis).style("fill","#888"),r=Math.round(this.config.size/10),p.selectAll("text").data([f]).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-r).attr("dy",r/2).attr("text-anchor","middle").style("font-size",r+"px").style("fill","#000").style("stroke-width","0px"),this.redraw(this.config.min,0)},this.buildPointerPath=function(e){function t(e,t){var i=n.valueToPoint(e,t);return i.x-=n.config.cx,i.y-=n.config.cy,i}var i=this.config.range/13,r=t(e,.85),o=t(e-i,.12),a=t(e+i,.12),s=e-this.config.range*(1/.75)/2,c=t(s,.28),l=t(s-i,.12),u=t(s+i,.12);return[r,o,u,c,l,a,r]},this.drawBand=function(e,t,i){0>=t-e||this.body.append("svg:path").style("fill",i).attr("d",d3.svg.arc().startAngle(this.valueToRadians(e)).endAngle(this.valueToRadians(t)).innerRadius(.65*this.config.raduis).outerRadius(.85*this.config.raduis)).attr("transform",function(){return"translate("+n.config.cx+", "+n.config.cy+") rotate(270)"})},this.redraw=function(e,t){var i=this.body.select(".pointerContainer");i.selectAll("text").text(Math.round(e));var r=i.selectAll("path");r.transition().duration(void 0!=t?t:this.config.transitionDuration).attrTween("transform",function(){var t=e;e>n.config.max?t=n.config.max+.02*n.config.range:e<n.config.min&&(t=n.config.min-.02*n.config.range);var i=n.valueToDegrees(t)-90,r=n._currentRotation||i;return n._currentRotation=i,function(e){var t=r+(i-r)*e;return"translate("+n.config.cx+", "+n.config.cy+") rotate("+t+")"}});this.body.select(".outer-circle").transition().duration(750).style("fill",function(){var t=parseInt(e);return t>0&&t<75?n.config.greenColor:t>=75&&t<90?n.config.yellowColor:n.config.redColor})},this.valueToDegrees=function(e){return e/this.config.range*270-(this.config.min/this.config.range*270+45)},this.valueToRadians=function(e){return this.valueToDegrees(e)*Math.PI/180},this.valueToPoint=function(e,t){return{x:this.config.cx-this.config.raduis*t*Math.cos(this.valueToRadians(e)),y:this.config.cy-this.config.raduis*t*Math.sin(this.valueToRadians(e))}},this.configure(t)}!function(){"use strict";var e=angular.module("scaleApp",["scaleConfigModule","ngResource","ngSanitize","ngRoute","emguo.poller","ui.bootstrap","ui.grid","ui.grid.selection","ui.grid.pagination","ui.grid.resizeColumns","ui.sortable","cfp.hotkeys","toggle-switch","uiSwitch"]);e.config(["$routeProvider","$resourceProvider","$provide","pollerConfig",function(e,t,n,i){n.decorator("$exceptionHandler",["$delegate",function(e){return function(t,n){e(t,n),setTimeout(function(){throw t})}}]),i.stopOn="$routeChangeStart",i.smart=!0,t.defaults.stripTrailingSlashes=!1,e.when("/",{controller:"ovController",controllerAs:"vm",templateUrl:"modules/overview/partials/ovTemplate.html"}).when("/admin/login",{controller:"adminLoginController",templateUrl:"modules/admin/partials/adminLoginTemplate.html"}).when("/admin/logout",{controller:"logoutController",templateUrl:"modules/admin/partials/adminLoginTemplate.html"}).when("/about",{controller:"aboutController",controllerAs:"vm",templateUrl:"modules/about/partials/aboutTemplate.html"}).when("/feed",{controller:"feedDetailsController",controllerAs:"vm",templateUrl:"modules/feed/partials/feedDetailsTemplate.html",reloadOnSearch:!1}).when("/feed/ingests",{controller:"ingestRecordsController",controllerAs:"vm",templateUrl:"modules/feed/partials/ingestRecordsTemplate.html",reloadOnSearch:!1}).when("/feed/ingests/:id",{controller:"ingestRecordDetailsController",controllerAs:"vm",templateUrl:"modules/feed/partials/ingestRecordDetailsTemplate.html"}).when("/metrics",{controller:"metricsController",controllerAs:"vm",templateUrl:"modules/metrics/partials/metricsTemplate.html",reloadOnSearch:!1}).when("/nodes",{controller:"nodesController",controllerAs:"vm",templateUrl:"modules/nodes/partials/nodesTemplate.html",reloadOnSearch:!1}).when("/nodes/:id",{controller:"nodeDetailsController",controllerAs:"vm",templateUrl:"modules/nodes/partials/nodeDetailsTemplate.html"}).when("/load/queued",{controller:"loadController",controllerAs:"vm",templateUrl:"modules/load/partials/loadTemplate.html"}).when("/load/running",{controller:"queueRunningController",controllerAs:"vm",templateUrl:"modules/load/partials/queueRunningTemplate.html"}).when("/load/depth",{controller:"loadDepthController",controllerAs:"vm",templateUrl:"modules/load/partials/loadDepthTemplate.html"}).when("/recipes",{controller:"recipesController",controllerAs:"vm",templateUrl:"modules/recipes/partials/recipesTemplate.html",reloadOnSearch:!1}).when("/recipes/recipe/:id",{controller:"recipeDetailsController",controllerAs:"vm",templateUrl:"modules/recipes/partials/recipeDetailsTemplate.html"}).when("/recipes/types/:id?",{controller:"recipeTypesController",controllerAs:"vm",templateUrl:"modules/recipes/partials/recipeTypesTemplate.html"}).when("/jobs",{controller:"jobsController",controllerAs:"vm",templateUrl:"modules/jobs/partials/jobsTemplate.html",reloadOnSearch:!1}).when("/jobs/job/:id",{controller:"jobDetailController",controllerAs:"vm",templateUrl:"modules/jobs/partials/jobDetailTemplate.html"}).when("/jobs/types/:id?",{controller:"jobTypesController",controllerAs:"vm",templateUrl:"modules/jobs/partials/jobTypesTemplate.html",reloadOnSearch:!1}).when("/jobs/failure-rates",{controller:"jobTypesFailureRatesController",controllerAs:"vm",templateUrl:"modules/jobs/partials/jobTypesFailureRatesTemplate.html",reloadOnSearch:!1}).when("/jobs/executions",{controller:"jobExecutionsController",controllerAs:"vm",templateUrl:"modules/jobs/partials/jobExecutionsTemplate.html"}).when("/jobs/executions/:id",{controller:"jobExecutionDetailController",controllerAs:"vm",templateUrl:"modules/jobs/partials/jobExecutionDetailTemplate.html"}).when("/workspaces/:id?",{controller:"workspacesController",controllerAs:"vm",templateUrl:"modules/workspaces/partials/workspacesTemplate.html"}).when("/feed/strikes/:id?",{controller:"strikesController",controllerAs:"vm",templateUrl:"modules/feed/partials/strikesTemplate.html"}).when("/feed/scans/",{controller:"scansController",controllerAs:"vm",templateUrl:"modules/feed/partials/scansTemplate.html"}).when("/feed/scans/:id",{controller:"scanDetailsController",controllerAs:"vm",templateUrl:"modules/feed/partials/scanDetailsTemplate.html"}).when("/batch",{controller:"batchesController",controllerAs:"vm",templateUrl:"modules/batch/partials/batchesTemplate.html"}).when("/batch/:id",{controller:"batchDetailsController",controllerAs:"vm",templateUrl:"modules/batch/partials/batchDetailsTemplate.html"}).otherwise({redirectTo:"/"})}]).value("moment",window.moment).value("localStorage",window.localStorage).value("XMLHttpRequest",window.XMLHttpRequest).value("toastr",window.toastr)}(),function(){"use strict";angular.module("scaleConfigModule",[]).provider("scaleConfig",function(){var e={},t={};this.$get=function(){var n=$.ajax({type:"GET",url:"config/scaleConfig.json",cache:!1,async:!1,contentType:"application/json",dataType:"json"});if(200===n.status){e=n.responseJSON.scaleConfig;var i=$.ajax({type:"GET",url:"config/scaleConfig.local.json",cache:!1,async:!1,contentType:"application/json",dataType:"json"});200===i.status&&(t=i.responseJSON.scaleConfigLocal),_.merge(e,t),e.getUrlPrefix=function(t){return e.urls.overrides&&e.urls.overrides[t]?e.urls.overrides[t]:e.urls.apiPrefix}}return e}})}(),function(){"use strict";angular.module("scaleApp").controller("aisHeaderController",["$scope","subnavService",function(e,t){var n=this;n.currentPath=t.getCurrentPath(),n.loadingClass=e.showSubnav?"loading-content-subnav":"loading-content"}]).directive("aisHeader",function(){return{controller:"aisHeaderController",controllerAs:"vm",restrict:"E",templateUrl:"modules/header/headerTemplate.html",scope:{name:"=",hideTitle:"=",loading:"=",showSubnav:"=",subnavLinks:"="}}})}(),function(){"use strict";angular.module("scaleApp").directive("scaleNavigation",function(){return{restrict:"E",templateUrl:"modules/navigation/partials/navTemplate.html",controller:"navController",controllerAs:"vm"}})}(),function(){"use strict";angular.module("scaleApp").controller("aboutController",["$scope","$location","navService","stateService",function(e,t,n,i){var r=this;r.stateService=i,r.version="";var o=function(){n.updateLocation("about")};o(),e.$watch("vm.stateService.getVersion()",function(e){r.version=e})}])}(),function(){"use strict";angular.module("scaleApp").controller("adminLoginController",["$timeout","$location","stateService","userService",function(e,t,n,i){var r=function(){var n=i.getUserCreds();n||i.login("admin"),e(function(){t.path("/")})};r()}])}(),function(){"use strict";angular.module("scaleApp").controller("logoutController",["$timeout","$rootScope","$location","userService",function(e,t,n,i){var r=function(){i.logout(),e(function(){n.path("/")})};r()}])}(),function(){"use strict";angular.module("scaleApp").controller("aisDataFeedController",["$scope","scaleConfig","loadService","scaleService",function(e,t,n,i){var r=[],o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],a={},s=function(){r=[];var n="";e.feed&&(_.forEach(e.feed.values,function(e){var i=moment.utc(e.time).format(t.dateFormats.day),o=moment.utc(e.time).hour(),s=i+"_"+o;a[s]=e,i!==n&&(n=i,r.push(i))}),c())},c=function(){var e=moment().utc().format(t.dateFormats.day),n=moment().utc().hour(),s='<div class="table-responsive"><table>';s+="<tr><th>Hour (UTC)</th>";for(l in r)s+='<td class="day-label" title="'+r[l]+'"><div class="day-of-week">'+i.getDayString(moment(r[l]).day())+"</div>"+moment(r[l]).format("MM/DD")+"</td>";s+="</tr>";for(var c in o){c=23-c,s+="<tr>",s+='<th title="'+o[c]+':00">'+o[c]+"</th>";for(var l in r){var u=r[l]+"_"+o[c],d=a[u].files,p=a[u].size,f="good";r[l]===e&&(o[c]===n?f="current":o[c]>n&&(f="future")),0===d&&0===p&&"current"!==f&&"future"!==f&&(f="unknown"),s+='<td id="'+u+'" title="'+r[l]+" "+o[c]+':00">',s+="future"===f?'<span class="'+f+'" id="span_'+r[l]+"_"+o[c]+'" style="display: block;">&nbsp;</span></td>':'<span class="'+f+'" id="span_'+r[l]+"_"+o[c]+'" style="display: block;">'+i.calculateFileSizeFromBytes(p,1)+" / "+d+"</span></td>"}s+="</tr>"}s+="</table></div>",$("#history").html(s)},l=function(){e.$watch("feed",function(t){e.feed&&s()})};l()}]).directive("aisDataFeed",function(){return{controller:"aisDataFeedController",templateUrl:"modules/charts/dataFeed/dataFeedTemplate.html",restrict:"E",scope:{feed:"="}}})}(),function(){"use strict";angular.module("scaleApp").controller("aisDonutController",["$scope","$element","scaleConfig",function(e,t,n){var i=[],r=null,o=function(){if(r){var o=[],a=[];_.forEach(r.data(),function(e){o.push([e.values[0].id,e.values[0].value])}),_.forEach(o,function(e){var t=_.find(i,function(t){return t[0]===e[0]});t||a.push(e[0])}),r.load({columns:i,unload:a})}else r=c3.generate({bindto:t[0],data:{columns:i,type:e.type,colors:{down:n.colors.chart_red,warning:n.colors.chart_yellow,up:n.colors.chart_green,Completed:n.colors.chart_green,Done:"#3681bf",Queue:n.colors.chart_yellow,Failed:n.colors.chart_red,ALGORITHM:n.colors.failure_algorithm,DATA:n.colors.failure_data,SYSTEM:n.colors.failure_system,Offline:n.colors.chart_red,"High Failure Rate":n.colors.chart_orange,Paused:n.colors.chart_yellow}},transition:{duration:700},pie:{label:{format:d3.format(",")}},donut:{label:{format:e.showLabel?d3.format(","):function(){return""}},width:e.width,title:e.name},tooltip:{format:{value:d3.format(",")}},size:{height:e.size||320}});t[0].style.position="static"},a=function(){i=[],e.data.forEach(function(e){i.push([e.status,e.count])})},s=function(){a(),o()};e.$watch("data",function(e){e&&(e.length>0?s():r&&(r.destroy(),r=null))}),window.onresize=function(){o()}}])}(),function(){"use strict";angular.module("scaleApp").directive("aisDonut",function(){return{controller:"aisDonutController",restrict:"E",scope:{data:"=",type:"=",size:"=",showLabel:"=",width:"=",name:"="}}})}(),function(){"use strict";angular.module("scaleApp").controller("aisGridChartController",["$rootScope","$scope","$location","$uibModal","userService","scaleConfig","scaleService",function(e,t,n,i,r,o,a){var s=this,c=null,l=parseFloat(t.scale),u=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){var t=e.status.getFailures(),n=t.length>0?"<br /><br />":"",i=F(e),r=B(e),o=i>0||r>0?"<br />":"";return i>0&&(o=o+'<span class="label label-running">Running: '+i+"</span>"),r>0&&(o=o+' <span class="label label-completed">Completed: '+r+"</span>"),t=_.sortByOrder(t,["order"]),_.forEach(t,function(e){n=n+'<span class="label label-'+e.status.toLowerCase()+'">'+_.capitalize(e.status.toLowerCase())+": "+e.count+"</span> "}),e.title+" "+e.version+"<br />"+o+n}),d=50*l,p=50*l,f="undefined"==typeof t.mode||"zoom"===t.mode,g="undefined"!=typeof t.mode&&"tooltip"===t.mode,m="undefined"==typeof t.reveal||t.reveal,h=r.getUserCreds(),v=[],y=$(".grid-chart").width(),b=Math.ceil(y/d)*p,S=0,T=0,w=.4,j=.3;s.loading=!0,s.pauseReason="",s.dataValues=[],s.gridClass=function(){return t.icons===!0?"icons":""},t.$watchCollection("vm.dataValues",function(e,t){angular.equals(e,t)||(b=Math.ceil(e.length/Math.floor(y/d))*p,f&&(b=6*b),d3.select(".grid-chart-container svg").attr("height",b),d3.select(".overlay").attr("height",b))});var C=function(e){if(v=[],s.dataValues=[],e.data){var n=e.data.toString().split(",")[0];"JobType"===n?(s.dataValues=_.sortByOrder(_.values(e.data),["name"],["asc"]),_.forEach(s.dataValues,function(t){t.status=_.find(e.status,"job_type.id",t.id)}),s.dataValues=_.sortByOrder(_.values(e.data),["status.has_running","status.description","name"],["asc","asc","asc"])):"Node"===n?(s.dataValues=_.values(e.data),_.forEach(s.dataValues,function(t){t.status=_.find(e.status,"node.id",t.id)})):s.dataValues=e.data,S=t.columns?t.columns:Math.floor(y/d),T=t.rows?t.rows:Math.ceil(s.dataValues.length/S),d3.range(T).map(function(e){d3.range(S).map(function(t){if(t<=s.dataValues.length-1){var n=s.dataValues[S*e+t];n&&(n.coords=[t*p,e*d],v.push(n))}})}),H()}},x=function(){d3.selectAll(".cell-text").style("display","none"),d3.selectAll(".cell-text-detail").style("display","block"),d3.selectAll(".cell-pause-resume-icon").style("display","block")},k=function(){d3.selectAll(".cell-text").style("display","block"),d3.selectAll(".cell-text-detail").style("display","none"),d3.selectAll(".cell-pause-resume-icon").style("display","none")},P=function(e){function n(){var e=d3.event.scale;m&&(e>3?x():k()),1===e&&(t.showAxes?r.translate([25,0]):r.translate([0,0])),c.attr("transform","translate("+r.translate()+")scale("+d3.event.scale+")")}S=t.columns?t.columns:Math.floor(y/d),T=t.rows?t.rows:Math.ceil(s.dataValues.length/S);var i=Array.apply(null,{length:T}).map(Number.call,Number),r=d3.behavior.zoom().scaleExtent([1,6]).on("zoom",n);if(c=f?d3.select(".grid-chart").append("svg").attr("width",y).attr("height",b).append("g").call(r).append("g"):g?d3.select(".grid-chart").append("svg").attr("width",y).attr("height",b).append("g").call(u):d3.select(".grid-chart").append("svg").attr("width",y).attr("height",b).append("g"),c.append("rect").attr("class","overlay").attr("width",y).attr("height",b),s.showAxes){var o=d3.scale.linear().domain([0,T]).range([0,b-10]),a=d3.svg.axis().scale(o).orient("left").tickValues(i);c.attr("transform","translate(25,0)").append("g").attr("class","y axis").attr("transform","translate(0,"+p/2+")").call(a)}C(e),s.loading=!1},D=0,A=0,E=0,O=0,J=d3.behavior.drag().on("dragstart",function(){D=d3.event.sourceEvent.layerX,A=d3.event.sourceEvent.layerY}),I=function(e){return e&&e.status?e.status.getCellFill():"none"},R=function(e){if(e)return e.getCellText()},M=function(e){if(e&&e.status&&"JobType"===e.toString())return e.status.getCellActivity()},z=function(e){if(e&&e.status)return e.status.getCellPauseResume()},F=function(e){if(e&&e.status)return e.status.getCellActivityTotal()},L=function(e){if(e)return e.getCellTitle()},N=function(e){return e&&e.status?e.status.getCellError():"Failed: Unavailable"},B=function(e){return e&&e.status?e.status.getCellTotal():"Completed: Unavailable"},q=function(e){return e&&e.status&&"Node"===e.toString()?e.status.getCellStatus():"Status Unavailable"},U=function(e){if(e&&e.status&&"Node"===e.toString())return e.status.getCellJobs()},V=function(e){if(e&&e.status&&"JobType"===e.toString())return e.status.getCellFailures()},W=function(e){E=d3.event.layerX,O=d3.event.layerY,D===E&&A===O&&t.$apply(function(){"JobType"===e.toString()?n.path("/jobs").search("job_type_id",e.id).search("status",e.status.has_running.status):"Node"===e.toString()&&n.path("/nodes/"+e.id)})},H=function(){function e(e,t){e.each(function(){for(var e,t=d3.select(this),n=t.text().split(/\s+/).reverse(),i=[],r=0,o=1.1,a=t.attr("y"),s=parseFloat(t.attr("dy")),c=t.text(null).append("tspan").attr("x",d/2).attr("y",a).attr("dy",s+"em");e=n.pop();)"undefined"!==e&&(i.push(e),c.text(i.join(" ")),c.node().getComputedTextLength()>d-10&&(i.pop(),c.text(i.join(" ")),i=[e],c=t.append("tspan").attr("x",d/2).attr("y",a).attr("dy",++r*o+s+"em").text(e)))})}var n=$(".cell-activity-icon");if(TweenMax.to(n,1,{rotation:360,transformOrigin:"50% 50%",repeat:-1,ease:Linear.easeNone}),g)var i=c.selectAll(".cell-group").data(v,function(e){return e.coords}).on("mouseover",u.show).on("mouseout",u.hide).on("click",u.hide);else var i=c.selectAll(".cell-group").data(v,function(e){return e.coords});i.selectAll(".stop1").attr("offset",function(e){var t=V(e);return t&&t.length>0&&1===t.length?"100%":"0%"}).attr("stop-color",function(e){var t=V(e);return t&&t.length>0?"SYSTEM"===t[0]?o.colors.failure_system:"DATA"===t[0]?o.colors.failure_data:o.colors.failure_algorithm:I(e)}),i.selectAll(".stop2").attr("offset",function(e){var t=V(e);if(t&&t.length>0){if(3===t.length)return"50%";if(2===t.length)return"100%"}return"0%"}).attr("stop-color",function(e){var t=V(e);return t&&t.length>1?"SYSTEM"===t[1]?o.colors.failure_system:"DATA"===t[1]?o.colors.failure_data:o.colors.failure_algorithm:I(e)}),i.selectAll(".stop3").attr("offset",function(e){var t=V(e);return t&&t.length>2&&3===t.length?"100%":"0%"}).attr("stop-color",function(e){var t=V(e);return t&&t.length>2?"SYSTEM"===t[2]?o.colors.failure_system:"DATA"===t[2]?o.colors.failure_data:o.colors.failure_algorithm:I(e)}),i.selectAll(".cell").data(v,function(e){return e.coords}).transition().duration(750).style("stroke",function(e){return e?"#fff":"none"}).style("fill",function(e){if("Node"===e.toString())return I(e)});i.selectAll(".cell-gradient");i.selectAll(".cell-text").data(v,function(e){return e.coords}).html(function(e){return R(e)}).attr("y",function(e){return"JobType"===e.toString()&&F(e)>0?p/2:p/2+10}),i.selectAll(".cell-total-active").data(v,function(e){return e.coords}).text(function(e){if("JobType"===e.toString())return F(e)}),i.selectAll(".cell-pause-resume-icon").data(v,function(e){return e.coords}).html(function(e){return z(e)}),i.selectAll(".cell-activity-icon").data(v,function(e){return e.coords}).html(function(e){return M(e)}),i.selectAll(".cell-title").data(v,function(e){return e.coords}).html(function(e){return L(e)}),i.selectAll(".cell-error").data(v,function(e){return e.coords}).text(function(e){return N(e,!0)}),i.selectAll(".cell-total").data(v,function(e){return e.coords}).text(function(e){return B(e)}),i.selectAll(".cell-status").data(v,function(e){return e.coords}).text(function(e){return q(e)}),i.selectAll(".cell-jobs").data(v,function(e){return e.coords}).html(function(e){return U(e)}),i.selectAll(".cell-overlay").data(v,function(e){return e.coords}).on("click",function(e){W(e)});var r=i.enter().append("g").attr("class","cell-group"),a=r.append("defs"),s=a.append("linearGradient").attr("id",function(e){return e.name}).attr("class","cell-gradient").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",1);s.append("stop").attr("class","stop1").attr("offset",function(e){var t=V(e);return t&&t.length>0&&1===t.length?"100%":"0%"}).attr("stop-color",function(e){var t=V(e);return t&&t.length>0?"SYSTEM"===t[0]?o.colors.failure_system:"DATA"===t[0]?o.colors.failure_data:o.colors.failure_algorithm:I(e)}),s.append("stop").attr("class","stop2").attr("offset",function(e){var t=V(e);if(t&&t.length>1){if(3===t.length)return"50%";if(2===t.length)return"100%"}return"0%"}).attr("stop-color",function(e){var t=V(e);return t&&t.length>1?"SYSTEM"===t[1]?o.colors.failure_system:"DATA"===t[1]?o.colors.failure_data:o.colors.failure_algorithm:I(e)}),s.append("stop").attr("class","stop3").attr("offset",function(e){var t=V(e);return t&&t.length>2&&3===t.length?"100%":"0%"}).attr("stop-color",function(e){var t=V(e);return t&&t.length>2?"SYSTEM"===t[2]?o.colors.failure_system:"DATA"===t[2]?o.colors.failure_data:o.colors.failure_algorithm:I(e)}),r.append("rect").attr("class","cell").attr("width",d).attr("height",p).style("fill",function(e){if("Node"===e.toString())return I(e)}).attr("fill",function(e){if("JobType"===e.toString())return"url(#"+e.name+")"}).style("stroke",function(e){return e?"#fff":"none"}).transition().duration(750),r.append("text").attr("class","cell-text").html(function(e){return R(e)}).attr("text-anchor","middle").attr("x",d/2).attr("y",function(e){return"JobType"===e.toString()?F(e)>0?p/2:p/2+10:p/2}).style("font-size",function(e){return"Node"===e.toString()?8*t.scale+"px":""}).style("display",m?"block":"none"),r.append("text").attr("class","cell-total-active").text(function(e){if("JobType"===e.toString())return F(e)}).attr("text-anchor","middle").attr("x",d/2).attr("y",p-5).style("display",m?"block":"none"),r.append("g").attr("class","cell-activity").append("text").attr("class","cell-activity-icon").attr("font-size",11).html(function(e){return M(e)}).attr("text-anchor","end").attr("x",d-2).attr("y",13);var f=r.append("text").attr("class","cell-text-detail").attr("text-anchor","middle").attr("x",d/2).attr("y",Math.floor(.15*p)).attr("dy",0).style("display",m?"none":"block");f.append("tspan").attr("class","cell-title").attr("text-anchor","middle").attr("x",d/2).attr("y",Math.floor(.15*p)).attr("dy",0).style("font-size",j*l+"em").html(function(e){return L(e)}).call(e),f.append("tspan").attr("class","cell-error").attr("text-anchor","middle").attr("x",d/2).attr("y",Math.floor(.3*p)).attr("dy",0).style("font-size",j*l+"em").text(function(e){return N(e)}).call(e),f.append("tspan").attr("class","cell-total").attr("text-anchor","middle").attr("x",d/2).attr("y",Math.floor(.4*p)).attr("dy",0).style("font-size",j*l+"em").text(function(e){return B(e)}).call(e),f.append("tspan").attr("class","cell-status").attr("text-anchor","middle").attr("x",d/2).attr("y",Math.floor(.55*p)).attr("dy",0).style("font-size",w*l+"em").text(function(e){return q(e)}),f.append("tspan").attr("class","cell-jobs").attr("text-anchor","middle").attr("x",d/2).attr("y",Math.floor(.75*p)).attr("dy",0).style("font-size",j*l+"em").html(function(e){return U(e)}).call(e),r.append("rect").attr("class","cell-overlay").attr("width",d).attr("height",p).style("fill","#fff").on("mouseover",function(){d3.select(this).style("fill-opacity","0.25")}).on("mouseout",function(){d3.select(this).style("fill-opacity","0")}).on("click",function(e){W(e)}).call(J),h&&h.is_admin&&r.append("text").attr("class","cell-pause-resume-icon").html(function(e){return z(e)}).attr("text-anchor","start").attr("x",m?2:5).attr("y",m?8*t.scale:20).style("display",m?"none":"block").style("font-size",m?7*t.scale+"px":"1.3em").on("mouseover",function(){d3.select(this).style("cursor","pointer").style("fill",o.colors.chart_blue)}).on("mouseout",function(){d3.select(this).style("fill","white")}),i.transition().duration(750).attr("transform",function(e){return"translate("+e.coords+")"});i.exit().attr("class","cell-exit").transition().duration(750).attr("transform","translate(0,0)").remove()};t.$watch("data",function(e){_.keys(e).length>0&&($(".grid-chart").empty(),P(e))}),t.$on("redrawGrid",function(e,t){C(t)})}])}(),function(){"use strict";angular.module("scaleApp").directive("aisGridChart",function(){return{controller:"aisGridChartController",controllerAs:"vm",templateUrl:"modules/charts/grid/gridChartTemplate.html",restrict:"E",scope:{data:"=",icons:"=",scale:"=",reveal:"=",mode:"@",columns:"=",rows:"=",showAxes:"="}}})}(),function(){"use strict";angular.module("scaleApp").controller("aisHealthController",["$scope",function(e){var t=this,n=!1,i=function(){n=!0;var i=e.scale||1;t.donutSize=275*i,t.donutWidth=25*i};e.$watch("data",function(e){e&&_.keys(e).length>0&&(n||i())})}])}(),function(){"use strict";angular.module("scaleApp").directive("aisHealth",function(){return{controller:"aisHealthController",controllerAs:"vm",templateUrl:"modules/charts/health/healthTemplate.html",restrict:"E",scope:{name:"=",data:"=",scale:"=",errorLabel:"=",type:"="}}})}(),function(){"use strict";angular.module("scaleApp").controller("aisJobLoadController",["$scope","scaleConfig","scaleService","loadService",function(e,t,n,i){var r=this,o=null,a=[],s=[];r.filterValue=1,r.filterDuration="w",r.filterDurations=["M","w","d"],r.zoomEnabled=!1,r.zoomClass="btn-default",r.zoomText="Enable Zoom",r.jobLoadData={},r.loadingJobLoad=!0,r.jobLoadError=null,r.jobLoadErrorStatus=null,r.total=0,r.chartStyle="";var c={started:moment.utc().subtract(r.filterValue,r.filterDuration).startOf("d").toDate(),ended:moment.utc().endOf("d").toDate(),job_type_id:null,job_type_name:null,job_type_category:null,url:null};r.toggleZoom=function(){r.zoomEnabled=!r.zoomEnabled,o.zoom.enable(r.zoomEnabled),r.zoomEnabled?(r.zoomClass="btn-primary",r.zoomText="Disable Zoom"):(r.zoomClass="btn-default",r.zoomText="Enable Zoom")};var l=function(){s=[],s=_.pluck(r.jobLoadData.results,"time"),_.forEach(s,function(e,t){s[t]=moment.utc(e).toDate()}),s.unshift("x");var e=_.pluck(r.jobLoadData.results,"pending_count"),n=_.pluck(r.jobLoadData.results,"queued_count"),i=_.pluck(r.jobLoadData.results,"running_count");e.unshift("Pending"),n.unshift("Queued"),i.unshift("Running"),a=[s,e,n,i];var c={},l={},u=[];_.forEach(a,function(e){l={},"x"!==e[0]&&(l[e[0]]="area",u.push(e[0])),angular.extend(c,l)}),o&&o.flush(),o=c3.generate({bindto:"#job-load",data:{x:"x",columns:a,types:c,groups:[u],colors:{Pending:t.colors.chart_pink,Queued:t.colors.chart_purple,Running:t.colors.chart_blue}},transition:{duration:700},tooltip:{format:{title:function(e){return moment.utc(e).startOf("h").format(t.dateFormats.day_second)}}},axis:{x:{type:"timeseries",tick:{format:function(e){return moment.utc(e).format(t.dateFormats.day)}}}}}),r.loadingJobLoad=!1},u=function(t){t?e.$parent.loading=!0:r.loadingJobLoad=!0,c.started=moment.utc().subtract(r.filterValue,r.filterDuration).startOf("d").toDate(),c.ended=moment.utc(c.started).add(1,r.filterDuration).endOf("d").toDate(),c.page_size=1e3,i.getJobLoad(c).then(null,null,function(n){n.$resolved?(r.jobLoadData=n,l()):(n.statusText&&""!==n.statusText&&(r.jobLoadErrorStatus=n.statusText),r.jobLoadError="Unable to retrieve job load."),t?e.$parent.loading=!1:r.loadingJobLoad=!1})};r.updateJobLoadRange=function(e){"older"===e?r.filterValue++:"newer"===e?r.filterValue>1&&r.filterValue--:"today"===e&&(r.filterValue=1),u(!0)},e.$watch("vm.filterValue",function(e){var t=$(".job-load-newer"),n=$(".job-load-today");e>1?(t.removeAttr("disabled"),n.removeAttr("disabled")):(t.attr("disabled","disabled"),n.attr("disabled","disabled"))}),e.autoHeight?angular.element(document).ready(function(){var e=n.getViewportSize(),i=t.headerOffset,o=$(".job-load-header").height(),a=$(".job-load-legend-label").height(),s=$(".job-load-filter").outerHeight(!0),c=e.height-i-o-a-s-5;r.chartStyle="height: "+c+"px; max-height: "+c+"px;",u()}):u()}])}(),function(){"use strict";angular.module("scaleApp").directive("aisJobLoad",function(){return{controller:"aisJobLoadController",controllerAs:"vm",templateUrl:"modules/charts/jobLoad/jobLoadTemplate.html",restrict:"E",scope:{showFilter:"=",cullLegend:"=",hideTitle:"=",autoHeight:"="}}})}(),angular.module("scaleApp").controller("aisRadialPercentageController",["$scope","$element","scaleConfig",function(e,t,n){var i=!1,r="",o="",a="",s="",c=function(){var t=parseFloat(e.percentage);return t>=75?n.colors.chart_green:t<75&&t>=50?n.colors.chart_yellow:n.colors.chart_red},l=function(){var n=e.percentage||0;n>1&&(n/=100);var l=t[0].parentNode.clientWidth;t[0].parentNode.clientHeight<l&&(l=t[0].parentNode.clientHeight);var d=d3.format(".0%"),p=d3.svg.arc().startAngle(0).outerRadius(.95*l/2).innerRadius(.8*l/2),f=d3.select(t[0]).append("svg").attr({width:l,height:l}).append("g").attr({transform:"translate("+l/2+","+l/2+")","class":"aisRadial"}),g=f.append("g").attr({transform:"rotate(180)"});g.append("path").datum({endAngle:2*Math.PI}).attr("class","background").attr("d",p),r=g.append("path").datum({endAngle:0}).attr({d:p}).style("fill",function(){return c()}),o=f.append("text").datum({percentage:0}).attr("text-anchor","middle").attr("dy",".35em"),s=function(e,t){
e.attrTween("text",function(e){"undefined"==typeof e&&(e=0);var n=d3.interpolate(e.percentage,t);return function(t){return e.percentage=n(t),o.text(d(n(t))),t}})},a=function(e,t){e.attrTween("d",function(e){var n=d3.interpolate(e.endAngle,t);return function(t){return e.endAngle=n(t),p(e)}})},i=!0,u(n)},u=function(e){if(i){var t=e;t>1&&(t/=100),r.transition().duration(1e3).style("fill",function(){return c()}).call(a,2*Math.PI*t),o.transition().duration(1e3).call(s,t)}};e.$watch("percentage",function(e){e&&!i?l():u(e)})}]),angular.module("scaleApp").directive("aisRadialPercentage",function(){return{controller:"aisRadialPercentageController",restrict:"E",scope:{percentage:"@"}}}),function(){"use strict";angular.module("scaleApp").controller("aisTimelineDirectiveController",["$scope","$element","scaleConfig",function(e,t,n){var i=this,r=null,o=[];t[0].onresize=function(){console.log("element resize")};var a=function(){e.$watch("tasks",function(e){s()})},s=function(){if(e.tasks&&e.tasks.length>0){e.tasks.sort(function(t,n){return t[e.ended]-n[e.ended]}),o=_(e.tasks).pluck("taskName").uniq().value();var i=30*o.length+20,a=t[0].clientWidth;a&&0!==a||(a=600),e.tasks.sort(function(t,n){return t[e.started]-n[e.started]});var s=e.tasks[0][e.started],c=e.tasks[e.tasks.length-1][e.ended],l=moment.utc(c).diff(moment.utc(s),"days"),u="%H:%M:%S.%m";l>0&&(u="%m/%d/%y %H:%M"),r=d3.gantt().renderTo("#ais-timeline").taskTypes(o).taskStatus(n.taskStatusStyles).tickFormat(u).begin(e.started).ended(e.ended).height(i).width(a),r.timeDomainMode("fit"),r(e.tasks)}};i.formatDate=function(e){return e?moment.utc(e).toISOString():e},a()}]).directive("aisTimeline",function(){return{controller:"aisTimelineDirectiveController",controllerAs:"vm",templateUrl:"modules/charts/timeline/timelineDirectiveTemplate.html",restrict:"E",scope:{tasks:"=",started:"=",ended:"="}}})}(),function(){"use strict";angular.module("scaleApp").controller("batchDetailsController",["$scope","$routeParams","$location","scaleConfig","navService","userService","batchService","recipeService","jobTypeService","Batch","toastr","moment",function(e,t,n,i,r,o,a,s,c,l,u,d){var p=this;p.scaleConfig=i,p.moment=d,p.loading=!0,p.mode=t.id>0?"details":"create",p.readonly=!0,p.saveBtnClass="btn-default",p.batch=t.id>0?{}:new l,p.recipeTypes=[],p.selectedRecipeType={},p.jobTypes=[],p.selectedJobTypes=[],p.startTime={hour:null,minute:null,second:null},p.endTime={hour:null,minute:null,second:null},p.dateModelOptions={timezone:"+000"},p.dateRangeStartedPopup={opened:!1},p.openDateRangeStartedPopup=function(e){e.stopPropagation(),p.dateRangeStartedPopup.opened=!0},p.dateRangeEndedPopup={opened:!1},p.openDateRangeEndedPopup=function(e){e.stopPropagation(),p.dateRangeEndedPopup.opened=!0},p.cancelCreate=function(){p.mode="view","0"===t.id&&n.path("/batch")},p.disableSaveBtn=function(e){var t=!!e;return p.saveBtnClass=t?"btn-default":"btn-success",t};var f=function(e){var t="";return _.forEach(e,function(e){t+="<b>"+e.id+":</b> "+e.details+"<br /><br />"}),t+='<button type="button" class="btn btn-default btn-xs clear">Hide</button>'};p.getDateRange=function(){return d.utc(p.batch.definition.date_range.started).format(i.dateFormats.day_second_utc)+" &ndash; "+d.utc(p.batch.definition.date_range.ended).format(i.dateFormats.day_second_utc)},p.setTime=function(e){"started"===e?p.startTime={hour:("0"+d.utc(p.batch.definition.date_range[e]).hour()).slice(-2),minute:("0"+d.utc(p.batch.definition.date_range[e]).minute()).slice(-2),second:("0"+d.utc(p.batch.definition.date_range[e]).second()).slice(-2)}:p.endTime={hour:("0"+d.utc(p.batch.definition.date_range[e]).hour()).slice(-2),minute:("0"+d.utc(p.batch.definition.date_range[e]).minute()).slice(-2),second:("0"+d.utc(p.batch.definition.date_range[e]).second()).slice(-2)}},p.changeTime=function(e,t){if(p.batch.definition.date_range&&(p[e][t].length>2&&(p[e][t]=("0"+p[e].hour).slice(-2)),!isNaN(p[e][t]))){(p[e].hour>23||p[e].hour<0)&&(p[e].hour=p[e].hour>23?23:0),(p[e].minute>59||p[e].minute<0)&&(p[e].minute=p[e].minute>59?59:0),(p[e].second>59||p[e].second<0)&&(p[e].second=p[e].second>59?59:0);var n="startTime"===e?d.utc(p.batch.definition.date_range.started.toISOString()):d.utc(p.batch.definition.date_range.ended.toISOString());n.set({hour:("0"+p[e].hour).slice(-2),minute:("0"+p[e].minute).slice(-2),second:("0"+p[e].second).slice(-2)}),"startTime"===e?(p.batch.definition.date_range.started=n.toDate(),console.log("start time: "+p.batch.definition.date_range.started.toISOString())):"endTime"===e&&(p.batch.definition.date_range.ended=n.toDate(),console.log("end time: "+p.batch.definition.date_range.ended.toISOString()))}},p.keydown=function(e,t,n){var i=0;"hour"===t?i=23:"minute"!==t&&"second"!==t||(i=60),38===e.keyCode?(isNaN(p[n][t])&&(p[n][t]="00".slice(-2)),p[n][t]<i?p[n][t]++:p[n][t],p[n][t]=("0"+p[n][t]).slice(-2),p.changeTime(n,t)):40===e.keyCode&&(isNaN(p[n][t])&&(p[n][t]="00".slice(-2)),p[n][t]>0?p[n][t]--:p[n][t],p[n][t]=("0"+p[n][t]).slice(-2),p.changeTime(n,t))},p.validateBatch=function(){p.loading=!0,a.validateBatch(p.batch).then(function(e){if(e.warnings&&e.warnings.length>0){var t=f(e.warnings);u.error(t)}else u.success("Batch is valid.")})["catch"](function(e){e&&e.detail?u.error(e.detail):u.error("Error validating batch")})["finally"](function(){p.loading=!1})},p.saveBatch=function(){p.loading=!0,a.saveBatch(p.batch).then(function(e){u.success("Batch successfully created.")})["catch"](function(e){e&&e.detail?u.error(e.detail):u.error("Error creating batch")})["finally"](function(){p.loading=!1,n.path("/batch")})};var g=function(){return s.getRecipeTypes().then(function(e){p.recipeTypes=e.results})["catch"](function(e){console.log("Error retrieving recipe types: "+e)})},m=function(){a.getBatchById(t.id).then(function(e){p.loading=!1,p.batch=l.transformer(e)})},h=function(){var e=o.getUserCreds();p.readonly=!(e&&e.is_admin),r.updateLocation("batch"),"create"===p.mode?g().then(function(){p.loading=!1}):"details"===p.mode&&m()};h(),e.$watchCollection("vm.batch.recipe_type",function(e,t){if(!angular.equals(e,t))if(e){p.jobTypes=[];var n=_.map(e.definition.jobs,"job_type.name");_.forEach(n,function(e){p.jobTypes.push({label:e,title:e,value:e})})}else p.jobTypes=[]}),e.$watch("vm.batch.definition.date_range.started",function(e,t){angular.equals(e,t)||e||(p.startTime={hour:null,minute:null,second:null})}),e.$watch("vm.batch.definition.date_range.ended",function(e,t){angular.equals(e,t)||e||(p.endTime={hour:null,minute:null,second:null})})}])}(),function(){"use strict";angular.module("scaleApp").controller("batchesController",["$scope","$location","scaleConfig","gridFactory","subnavService","userService","recipeService","navService","stateService","batchService","Batch","moment","poller",function(e,t,n,i,r,o,a,s,c,l,u,d,p){r.setCurrentPath("batch");var f=this,g={name:"VIEW ALL",title:"VIEW ALL",version:"",id:0};f.batchesParams=c.getBatchesParams(),f.stateService=c,f.loading=!0,f.readonly=!0,f.recipeTypeValues=[g],f.selectedRecipeType=f.batchesParams.recipe_type_id?f.batchesParams.recipe_type_id:g,f.batchStatusValues=n.batchStatus,f.selectedBatchStatus=f.batchesParams.status||f.batchStatusValues[0],f.lastModifiedStart=d.utc(f.batchesParams.started).toDate(),f.lastModifiedStartPopup={opened:!1},f.openLastModifiedStartPopup=function(e){e.stopPropagation(),f.lastModifiedStartPopup.opened=!0},f.lastModifiedStop=d.utc(f.batchesParams.ended).toDate(),f.lastModifiedStopPopup={opened:!1},f.openLastModifiedStopPopup=function(e){e.stopPropagation(),f.lastModifiedStopPopup.opened=!0},f.dateModelOptions={timezone:"+000"},f.gridOptions=i.defaultGridOptions(),f.gridOptions.paginationCurrentPage=f.batchesParams.page||1,f.gridOptions.paginationPageSize=f.batchesParams.page_size||f.gridOptions.paginationPageSize,f.gridOptions.data=[];var m=!!f.batchesParams.status,h=!!f.batchesParams.recipe_type_id,v=!!f.batchesParams.order;f.colDefs=[{field:"title",enableFiltering:!1,displayName:"Title"},{field:"recipe_type",displayName:"Recipe Type",cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.recipe_type.title }} {{ row.entity.recipe_type.version }}</div>',filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedRecipeType" ng-options="recipeType as (recipeType.title + \' \' + recipeType.version) for recipeType in grid.appScope.vm.recipeTypeValues"></select></div>'},{field:"status",displayName:"Status",filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedBatchStatus"><option ng-selected="{{ grid.appScope.vm.batchStatusValues[$index] == grid.appScope.vm.selectedBatchStatus }}" value="{{ grid.appScope.vm.batchStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.batchStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'},{field:"created_count",enableFiltering:!1,displayName:"Job Creation Rate",cellTemplate:"completedRate.html"},{field:"created",displayName:"Created (Z)",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'},{field:"last_modified",displayName:"Last Modified (Z)",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'}],f.getBatches=function(){l.getBatches(f.batchesParams).then(function(e){f.loading=!1,f.gridOptions.totalItems=e.count?e.count:0,f.gridOptions.minRowsToShow=e.results?e.results.length:0,f.gridOptions.virtualizationThreshold=e.results?e.results.length:0,f.gridOptions.data=e.results?u.transformer(e.results):[]})["catch"](function(e){console.log("Error retrieving batches: "+e),f.loading=!1})},f.getRecipeTypes=function(){return a.getRecipeTypes().then(function(e){f.recipeTypeValues.push(e.results),f.recipeTypeValues=_.flatten(f.recipeTypeValues),f.selectedRecipeType=_.find(f.recipeTypeValues,{id:f.batchesParams.recipe_type_id})||g})["catch"](function(e){console.log("Error retrieving recipe types: "+e)})},f.filterResults=function(){p.stopAll(),c.setBatchesParams(f.batchesParams),f.loading=!0,f.getBatches()},f.updateColDefs=function(){f.gridOptions.columnDefs=i.applySortConfig(f.colDefs,f.batchesParams)},f.updateBatchOrder=function(e){f.batchesParams.order=e.length>0?e:null,v=e.length>0,f.filterResults()},f.updateRecipeType=function(e){e.id!==f.batchesParams.recipe_type_id&&(f.batchesParams.page=1),f.batchesParams.recipe_type_id=0===e.id?null:e.id,f.batchesParams.page_size=f.gridOptions.paginationPageSize,f.loading||f.filterResults()},f.updateBatchStatus=function(e){e!=f.batchesParams.status&&(f.batchesParams.page=1),f.batchesParams.status="VIEW ALL"===e?null:e,f.batchesParams.page_size=f.gridOptions.paginationPageSize,f.loading||f.filterResults()},f.completedRateStyle=function(e,t){var n=(e/t*100).toFixed(0);return n>0?"width: "+n+"%":"display: none"},f.gridOptions.onRegisterApi=function(n){f.gridApi=n,f.gridApi.selection.on.rowSelectionChanged(e,function(e){t.path("/batch/"+e.entity.id).search("")}),f.gridApi.pagination.on.paginationChanged(e,function(e,t){f.batchesParams.page=e,f.batchesParams.page_size=t,f.filterResults()}),f.gridApi.core.on.sortChanged(e,function(e,t){_.forEach(f.gridApi.grid.columns,function(e){e.colDef.sort=e.sort}),c.setBatchesColDefs(f.gridApi.grid.options.columnDefs);var n=[];_.forEach(t,function(e){n.push("desc"===e.sort.direction?"-"+e.field:e.field)}),f.updateBatchOrder(n)})},f.initialize=function(){c.setBatchesParams(f.batchesParams),f.updateColDefs();var e=o.getUserCreds();f.readonly=!(e&&e.is_admin),f.getRecipeTypes().then(f.getBatches),s.updateLocation("batch")},f.initialize(),e.$watch("vm.selectedRecipeType",function(e){parseInt(e)&&(e=_.find(f.recipeTypeValues,{id:parseInt(e)})),e&&(f.loading?h&&f.updateRecipeType(e):(h=!angular.equals(e,g),f.updateRecipeType(e)))}),e.$watch("vm.selectedBatchStatus",function(e){f.loading?m&&f.updateBatchStatus(e):(m="VIEW ALL"!==e,f.updateBatchStatus(e))}),e.$watch("vm.lastModifiedStart",function(e){f.loading||(f.batchesParams.started=e.toISOString(),f.filterResults())}),e.$watch("vm.lastModifiedStop",function(e){f.loading||(f.batchesParams.ended=e.toISOString(),f.filterResults())}),e.$watchCollection("vm.stateService.getBatchesColDefs()",function(e,t){angular.equals(e,t)||(f.colDefs=e,f.updateColDefs())}),e.$watchCollection("vm.stateService.getBatchesParams()",function(e,t){angular.equals(e,t)||(f.batchesParams=e,f.updateColDefs())})}])}(),function(){"use strict";angular.module("scaleApp").factory("Batch",["scaleConfig","JobType","RecipeType",function(e,t,n){var i=function(i,r,o,a,s,c,l,u,d,p,f,g,m){this.id=i||null,this.title=r||null,this.description=o||null,this.status=a||null,this.recipe_type=s?n.transformer(s):null,this.event=c||null,this.creator_job=l?{id:l.id||null,job_type:l.job_type?t.transformer(l.job_type):null,job_type_rev:l.job_type_rev||null,event:l.event||null,status:l.status||null,priority:l.priority||null,num_exes:l.num_exes||null}:{},this.definition=u?{version:e.batchDefinitionVersion,date_range:u.date_range||null,job_names:u.job_names||null,all_jobs:u.all_jobs||null,priority:u.priority||null}:{version:e.batchDefinitionVersion},this.created_count=d||0,this.failed_count=p||0,this.total_count=f||0,this.created=g,this.created_formatted=moment.utc(g).format(e.dateFormats.day_second_utc),this.last_modified=m,this.last_modified_formatted=moment.utc(m).format(e.dateFormats.day_second_utc)};return i.prototype={clean:function(){var e={recipe_type_id:this.recipe_type?this.recipe_type.id:null,title:this.title,description:this.description,definition:this.definition};return _.pick(e,_.identity)}},i.build=function(e){if(e){var t=new i(e.id,e.title,e.description,e.status,e.recipe_type,e.event,e.creator_job,e.definition,e.created_count,e.failed_count,e.total_count,e.created,e.last_modified);return t=_.pick(t,_.identity),t.created_count="undefined"==typeof t.created_count?0:t.created_count,t.failed_count="undefined"==typeof t.failed_count?0:t.failed_count,t.total_count="undefined"==typeof t.total_count?0:t.total_count,t}return new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").service("batchService",["$http","$q","$resource","scaleConfig",function(e,t,n,i){var r=function(e,t,n,i,r,o){return{page:e,page_size:t,started:n,ended:i,order:r,status:o}};return{getBatches:function(n){n=n||r();var o=t.defer(),a=i.getUrlPrefix()+"batches/";return e({url:a,method:"GET",params:n}).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},getBatchById:function(n){var r=t.defer();return e({url:i.getUrlPrefix()+"batches/"+n+"/",method:"GET"}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},validateBatch:function(n){var r=t.defer();return e.post(i.urls.apiPrefix+"batches/validation/",n.clean()).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},saveBatch:function(n){var r=t.defer();return e.post(i.urls.apiPrefix+"batches/",n.clean()).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}])}(),function(){"use strict";angular.module("scaleApp").controller("feedDetailsController",["$scope","$location","scaleConfig","navService","subnavService","feedService","moment",function(e,t,n,i,r,o,a){var s=this;s.loading=!0,s.feedData={},s.subnavLinks=n.subnavLinks.feed,s.useIngestTime="false",s.filterValue=1,s.filterDuration="w",s.changeFeedSelection=function(){u()},s.changeIngestTimeSelection=function(){u(),l()};var c=function(){var e={},n=s.selectedFeed?s.selectedFeed.strike.id:null,i=s.useIngestTime?s.useIngestTime:null;return e.started=a.utc().subtract(s.filterValue,s.filterDuration).startOf("d").toISOString(),e.ended=a.utc(e.started).add(1,s.filterDuration).endOf("d").toISOString(),n!=t.search().strike_id?e.strike_id=n:t.search().strike_id&&(e.strike_id=t.search().strike_id),i!=t.search().use_ingest_time?e.use_ingest_time=i:t.search().use_ingest_time&&(console.log("getFeedParams use_ingest_time: "+t.search().use_ingest_time),e.use_ingest_time=t.search().use_ingest_time),e},l=function(){s.loading=!0,t.search().use_ingest_time&&(s.useIngestTime=t.search().use_ingest_time);var e=c();t.search(e),o.getFeed(e).then(function(e){s.allFeeds=_.sortByOrder(e.results,["strike.name"],["asc"]);var n=t.search().strike_id;if(n){var i=_.find(s.allFeeds,function(e){return e.strike.id==n});s.selectedFeed=i?i:null}else s.selectedFeed=s.allFeeds[0],u()})["finally"](function(){s.loading=!1})};s.updateFeedRange=function(e){"older"===e?s.filterValue++:"newer"===e?s.filterValue>1&&s.filterValue--:"today"===e&&(s.filterValue=1),l()};var u=function(){var e=c();t.search(e)},d=function(){i.updateLocation("feed"),r.setCurrentPath("feed"),l()};d(),e.$watch("vm.filterValue",function(e){var t=$(".feed-newer"),n=$(".feed-today");e>1?(t.removeAttr("disabled"),n.removeAttr("disabled")):(t.attr("disabled","disabled"),n.attr("disabled","disabled"))})}])}(),function(){"use strict";angular.module("scaleApp").controller("ingestRecordDetailsController",["$scope","$routeParams","scaleConfig","scaleService","navService","subnavService","feedService",function(e,t,n,i,r,o,a){var s=this;s.loading=!1,s.subnavLinks=n.subnavLinks.feed,s.scaleService=i,s.moment=moment,s.ingestRecord=null;var c=function(){s.loading=!0,a.getSourceDetails(t.id).then(function(e){s.ingestRecord=e})["catch"](function(e){console.log(e)})["finally"](function(){s.loading=!1})},l=function(){r.updateLocation("feed"),o.setCurrentPath("feed/ingests"),c()};s.calculateFileSize=function(e){return i.calculateFileSizeFromBytes(e)},l()}])}(),function(){"use strict";angular.module("scaleApp").controller("ingestRecordsController",["$scope","$location","$timeout","scaleConfig","scaleService","stateService","feedService","strikeService","navService","subnavService","gridFactory","poller",function(e,t,n,i,r,o,a,s,c,l,u,d){l.setCurrentPath("feed/ingests");var p=this;p.ingestsParams=o.getIngestsParams(),p.stateService=o,p.loading=!0,p.subnavLinks=i.subnavLinks.feed,p.ingestStatusValues=i.ingestStatus,p.selectedIngestStatus=p.ingestsParams.status||p.ingestStatusValues[0],p.lastModifiedStart=moment.utc(p.ingestsParams.started).toDate(),p.lastModifiedStartPopup={opened:!1},p.openLastModifiedStartPopup=function(e){e.stopPropagation(),p.lastModifiedStartPopup.opened=!0},p.lastModifiedStop=moment.utc(p.ingestsParams.ended).toDate(),p.lastModifiedStopPopup={opened:!1},p.openLastModifiedStopPopup=function(e){e.stopPropagation(),p.lastModifiedStopPopup.opened=!0},p.dateModelOptions={timezone:"+000"},p.ingestData=[],p.strikeData=[],p.selectedStrike={},p.searchText=p.ingestsParams.file_name||"",p.gridOptions=u.defaultGridOptions(),p.gridOptions.data=[],n(function(){p.gridOptions.paginationCurrentPage=p.ingestsParams.page||1,p.gridOptions.paginationPageSize=p.ingestsParams.page_size||p.gridOptions.paginationPageSize}),p.refreshData=function(){var e=_.filter(p.ingestData,function(e){return e.file_name.toLowerCase().includes(p.searchText.toLowerCase())});p.gridOptions.data=e.length>0?e:p.gridOptions.data};var f=!!p.ingestsParams.status,g=!!p.ingestsParams.strike_id,m=!!p.ingestsParams.order;p.colDefs=[{field:"file_name",displayName:"File Name",enableFiltering:!1},{field:"file_size",displayName:"File Size",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.file_size_formatted }}</div>'},{field:"strike.title",displayName:"Strike Process",cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.strike.title }}</div>',filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedStrike" ng-options="strike as strike.title.toUpperCase() for strike in grid.appScope.vm.strikeData"></select></div>'},{field:"status",filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedIngestStatus" ng-options="status.toUpperCase() for status in grid.appScope.vm.ingestStatusValues"></select></div>'},{field:"transfer_started",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.transfer_started_formatted }}</div>'},{field:"transfer_ended",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.transfer_ended_formatted }}</div>'},{field:"ingest_started",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.ingest_started_formatted }}</div>'},{field:"ingest_ended",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.ingest_ended_formatted }}</div>'}],p.getIngests=function(){p.loading=!0,a.getIngestsOnce(p.ingestsParams).then(function(e){p.ingestData=e.results,p.gridOptions.minRowsToShow=e.results.length,p.gridOptions.virtualizationThreshold=e.results.length,p.gridOptions.totalItems=e.count,p.gridOptions.data=e.results})["catch"](function(e){console.log(e)})["finally"](function(){p.loading=!1})},p.filterResults=function(){d.stopAll(),o.setIngestsParams(p.ingestsParams),p.getIngests()},p.updateColDefs=function(){p.gridOptions.columnDefs=u.applySortConfig(p.colDefs,p.ingestsParams)},p.updateIngestOrder=function(e){p.ingestsParams.order=e.length>0?e:null,m=e.length>0,p.filterResults()},p.updateIngestStatus=function(e){e!=p.ingestsParams.status&&(p.ingestsParams.page=1),p.ingestsParams.status="VIEW ALL"===e?null:e,p.ingestsParams.page_size=p.gridOptions.paginationPageSize,p.loading||p.filterResults()},p.updateIngestStrike=function(e){e.title&&(e.id!==p.ingestsParams.strike_id&&(p.ingestsParams.page=1),p.ingestsParams.strike_id="VIEW ALL"===e.title?null:e.id,p.ingestsParams.page_size=p.gridOptions.paginationPageSize,p.loading||p.filterResults())},p.getStrikes=function(){s.getStrikes().then(function(e){var t={id:0,name:"viewall",title:"VIEW ALL"};p.strikeData=e,p.strikeData.unshift(t),p.selectedStrike=_.find(p.strikeData,{id:p.ingestsParams.strike_id})||e[0],p.getIngests()})},p.gridOptions.onRegisterApi=function(n){p.gridApi=n,p.gridApi.pagination.on.paginationChanged(e,function(e,t){p.ingestsParams.page=e,p.ingestsParams.page_size=t,p.filterResults()}),p.gridApi.selection.on.rowSelectionChanged(e,function(e){e.entity.source_file&&e.entity.source_file.id?t.path("/feed/ingests/"+e.entity.source_file.id).search(""):toastr.info("Source file is undefined for "+e.entity.file_name)}),p.gridApi.core.on.sortChanged(e,function(e,t){_.forEach(p.gridApi.grid.columns,function(e){e.colDef.sort=e.sort}),o.setIngestsColDefs(p.gridApi.grid.options.columnDefs);var n=[];_.forEach(t,function(e){n.push("desc"===e.sort.direction?"-"+e.field:e.field)}),p.updateIngestOrder(n)})},p.filterByFilename=function(e){(!e||e&&13===e.which)&&(p.ingestsParams.file_name=p.searchText,p.filterResults())},p.initialize=function(){o.setIngestsParams(p.ingestsParams),p.updateColDefs(),p.getStrikes(),c.updateLocation("feed")},p.initialize(),e.$watch("vm.selectedIngestStatus",function(e){p.loading?f&&p.updateIngestStatus(e):(f="VIEW ALL"!==e,p.updateIngestStatus(e))}),e.$watch("vm.selectedStrike",function(e){p.loading?g&&p.updateIngestStrike(e):(g="VIEW ALL"!==e.title,p.updateIngestStrike(e))}),e.$watch("vm.lastModifiedStart",function(e){p.loading||(p.ingestsParams.started=e.toISOString(),p.filterResults())}),e.$watch("vm.lastModifiedStop",function(e){p.loading||(p.ingestsParams.ended=e.toISOString(),p.filterResults())}),e.$watchCollection("vm.stateService.getIngestsColDefs()",function(e,t){angular.equals(e,t)||(p.colDefs=e,p.updateColDefs())}),e.$watchCollection("vm.stateService.getIngestsParams()",function(e,t){angular.equals(e,t)||(p.ingestsParams=e,p.updateColDefs())})}])}(),function(){"use strict";angular.module("scaleApp").controller("scanDetailsController",["$scope","$route","$location","$routeParams","Scan","ScanIngestFile","scaleConfig","navService","subnavService","scanService","workspacesService","scaleService","stateService","userService","toastr",function(e,t,n,i,r,o,a,s,c,l,u,d,p,f,g){var m=this,h={};m.loading=!0,m.scaleConfig=a,m.workspaces=[],m.newWorkspaces=[],m.activeWorkspace={},m.localScans=[],m.activeScan=new r,m.activeScanIngestFile=new o,m.dataType="",m.availableWorkspaceTypes=_.cloneDeep(a.workspaceTypes),m.addBtnClass="btn-primary",m.addBtnIcon="fa-plus-circle",m.saveBtnClass="btn-default",m.mode="view",m.user=f.getUserCreds(),m.readonly=!(m.user&&m.user.is_admin),m.JSON=JSON,m.cancelCreate=function(){m.mode="view",m.activeScan=r.transformer(_.cloneDeep(h)),"0"===i.id&&n.path("/feed/scans")},m.editScan=function(){h=r.transformer(_.cloneDeep(m.activeScan)),m.mode="edit"},m.saveScan=function(){l.saveScan(m.activeScan).then(function(e){m.activeScan=r.transformer(e),_.forEach(m.activeScan.configuration.files_to_ingest,function(e){e.new_workspace&&(e.new_workspace=e.new_workspace.name)}),a["static"]&&localStorage.setItem("scan"+m.activeScan.id,JSON.stringify(m.activeScan)),"0"===i.id?n.path("/feed/scans/"+m.activeScan.id):t.reload()})["catch"](function(){})},m.clearLocalScans=function(){_.forEach(m.localScans,function(e){localStorage.removeItem("scan"+e.id)}),n.path("/feed/scans")},m.newScan=function(){m.mode="add",m.loadScan(0)},m.loadScan=function(e){n.path("feed/scans/"+e)};var v=function(e){var t="";return _.forEach(e,function(e){t+="<b>"+e.id+":</b> "+e.details+"<br /><br />"}),t+='<button type="button" class="btn btn-default btn-xs clear">Hide</button>'};m.validateScan=function(){m.loading=!0,l.validateScan(m.activeScan).then(function(e){if(e.warnings&&e.warnings.length>0){var t=v(e.warnings);g.error(t)}else g.success("Scan is valid.")})["catch"](function(e){e&&e.detail?g.error(e.detail):g.error("Error validating scan")})["finally"](function(){m.loading=!1})},m.disableSaveBtn=function(e){var t=!(!e&&m.activeScan.configuration.files_to_ingest.length>0);return m.saveBtnClass=t?"btn-default":"btn-success",t},m.addScanIngestFile=function(){_.keys(m.activeScanIngestFile).length>0&&(m.activeScan.configuration.files_to_ingest.push(o.transformer(m.activeScanIngestFile)),m.activeScanIngestFile=new o)},m.deleteScanIngestFile=function(e){_.remove(m.activeScan.configuration.files_to_ingest,function(t){return angular.equals(t,e)})},m.addDataType=function(){m.dataType&&(m.activeScanIngestFile.data_types.push(m.dataType),m.dataType="")},m.removeDataType=function(e){_.remove(m.activeScanIngestFile.data_types,function(t){return t===e})},m.updateWorkspace=function(){if(m.activeScan){var e=_.find(m.workspaces,{name:m.activeScan.configuration.workspace});e&&(m.newWorkspaces=_.cloneDeep(m.workspaces),_.remove(m.newWorkspaces,e),y(e.id))}},m.formatJSON=function(e){e=_.omit(e,"$$hashKey"),e.new_workspace&&(e.new_workspace=e.new_workspace.name);var t=JSON.stringify(e,null,4);return t.replace(/\\\\/g,"\\")};var y=function(e){m.loading=!0,u.getWorkspaceDetails(e).then(function(e){m.activeWorkspace=e,"host"===m.activeWorkspace.json_config.broker.type?m.activeScan.configuration.scanner.type="dir":"s3"===m.activeWorkspace.json_config.broker.type?m.activeScan.configuration.scanner.type="s3":m.activeScan.configuration.scanner.type=null})["catch"](function(e){console.log(e)})["finally"](function(){m.loading=!1})},b=function(){u.getWorkspaces().then(function(e){m.workspaces=e,m.newWorkspaces=e,m.updateWorkspace()})["catch"](function(e){console.log(e)})["finally"](function(){m.loading=!1})},S=function(){if(b(),m.activeScan=null,m.mode="view",i.id){var e=parseInt(i.id);0===e?(m.mode="add",m.activeScan=new r):l.getScanDetails(e).then(function(e){m.activeScan=r.transformer(e)})}s.updateLocation("feed"),c.setCurrentPath("feed/scans")};S()}])}(),function(){"use strict";angular.module("scaleApp").controller("scansController",["$scope","$location","$timeout","scaleConfig","scaleService","stateService","scanService","Scan","navService","subnavService","gridFactory",function(e,t,n,i,r,o,a,s,c,l,u){l.setCurrentPath("feed/scans");var d=this;d.scansParams=o.getScansParams(),d.stateService=o,d.loading=!0,d.subnavLinks=i.subnavLinks.feed,d.lastModifiedStart=moment.utc(d.scansParams.started).toDate(),d.lastModifiedStartPopup={opened:!1},d.openLastModifiedStartPopup=function(e){e.stopPropagation(),d.lastModifiedStartPopup.opened=!0},d.lastModifiedStop=moment.utc(d.scansParams.ended).toDate(),d.lastModifiedStopPopup={opened:!1},d.openLastModifiedStopPopup=function(e){e.stopPropagation(),d.lastModifiedStopPopup.opened=!0},d.dateModelOptions={timezone:"+000"},d.scanData=[],d.searchText=d.scansParams.name||"",d.gridOptions=u.defaultGridOptions(),d.gridOptions.data=[],d.sortableOptions={handle:".sortable-handle"},n(function(){d.gridOptions.paginationCurrentPage=d.scansParams.page||1,d.gridOptions.paginationPageSize=d.scansParams.page_size||d.gridOptions.paginationPageSize}),d.refreshData=function(){var e=_.filter(d.scanData,function(e){return e.name.toLowerCase().includes(d.searchText.toLowerCase())});d.gridOptions.data=e.length>0?e:d.gridOptions.data};var p=!!d.scansParams.order;d.colDefs=[{field:"name",displayName:"Name",enableFiltering:!1},{field:"file_count",displayName:"File Count",enableFiltering:!1},{field:"job",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.job.job_type.title }}</div>'},{field:"created",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'},{field:"last_modified",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'}],d.getScans=function(){d.loading=!0,a.getScans(d.scansParams).then(function(e){d.scanData=s.transformer(e.results),d.gridOptions.minRowsToShow=e.results.length,d.gridOptions.virtualizationThreshold=e.results.length,d.gridOptions.totalItems=e.count,d.gridOptions.data=d.scanData=s.transformer(e.results)})["catch"](function(e){console.log(e)})["finally"](function(){d.loading=!1})},d.filterResults=function(){o.setScansParams(d.scansParams),d.getScans()},d.updateColDefs=function(){d.gridOptions.columnDefs=u.applySortConfig(d.colDefs,d.scansParams)},d.updateScanOrder=function(e){d.scansParams.order=e.length>0?e:null,p=e.length>0,d.filterResults()},d.gridOptions.onRegisterApi=function(n){d.gridApi=n,d.gridApi.pagination.on.paginationChanged(e,function(e,t){d.scansParams.page=e,d.scansParams.page_size=t,d.filterResults()}),d.gridApi.selection.on.rowSelectionChanged(e,function(e){t.path("/feed/scans/"+e.entity.id).search("")}),d.gridApi.core.on.sortChanged(e,function(e,t){_.forEach(d.gridApi.grid.columns,function(e){e.colDef.sort=e.sort}),o.setScansColDefs(d.gridApi.grid.options.columnDefs);var n=[];_.forEach(t,function(e){n.push("desc"===e.sort.direction?"-"+e.field:e.field)}),d.updateScanOrder(n)})},d.filterByName=function(e){(!e||e&&13===e.which)&&(d.scansParams.name=d.searchText,d.filterResults())},d.initialize=function(){d.getScans(),o.setScansParams(d.scansParams),d.updateColDefs(),c.updateLocation("feed")},d.initialize(),e.$watch("vm.lastModifiedStart",function(e){d.loading||(d.scansParams.started=e.toISOString(),d.filterResults())}),e.$watch("vm.lastModifiedStop",function(e){d.loading||(d.scansParams.ended=e.toISOString(),d.filterResults())}),e.$watchCollection("vm.stateService.getScansColDefs()",function(e,t){angular.equals(e,t)||(d.colDefs=e,d.updateColDefs())}),e.$watchCollection("vm.stateService.getScansParams()",function(e,t){angular.equals(e,t)||(d.scansParams=e,d.updateColDefs())})}])}(),function(){"use strict";angular.module("scaleApp").controller("strikesController",["$scope","$route","$location","$routeParams","Strike","StrikeIngestFile","scaleConfig","navService","subnavService","strikeService","workspacesService","scaleService","stateService","userService","toastr",function(e,t,n,i,r,o,a,s,c,l,u,d,p,f,g){var m=this,h={};m.loading=!0,m.scaleConfig=a,m.strikes=[],m.workspaces=[],m.newWorkspaces=[],m.activeWorkspace={},m.localStrikes=[],m.activeStrike=new r,m.activeStrikeIngestFile=new o,m.dataType="",
m.availableWorkspaceTypes=_.cloneDeep(a.workspaceTypes),m.addBtnClass="btn-primary",m.addBtnIcon="fa-plus-circle",m.saveBtnClass="btn-default",m.mode="view",m.user=f.getUserCreds(),m.readonly=!(m.user&&m.user.is_admin),m.JSON=JSON,m.sortableOptions={handle:".sortable-handle"},m.cancelCreate=function(){m.mode="view",m.activeStrike=r.transformer(_.cloneDeep(h)),"0"===i.id&&n.path("/feed/strikes")},m.editStrike=function(){h=r.transformer(_.cloneDeep(m.activeStrike)),m.mode="edit"},m.saveStrike=function(){l.saveStrike(m.activeStrike).then(function(e){m.activeStrike=r.transformer(e),_.forEach(m.activeStrike.configuration.files_to_ingest,function(e){e.new_workspace&&(e.new_workspace=e.new_workspace.name)}),a["static"]&&localStorage.setItem("strike"+m.activeStrike.id,JSON.stringify(m.activeStrike)),t.reload()})["catch"](function(){})},m.clearLocalStrikes=function(){_.forEach(m.localStrikes,function(e){localStorage.removeItem("strike"+e.id)}),n.path("/feed/strikes")},m.newStrike=function(){m.mode="add",m.loadStrike(0)},m.loadStrike=function(e){n.path("feed/strikes/"+e)};var v=function(e){var t="";return _.forEach(e,function(e){t+="<b>"+e.id+":</b> "+e.details+"<br /><br />"}),t+='<button type="button" class="btn btn-default btn-xs clear">Hide</button>'};m.validateStrike=function(){m.loading=!0,l.validateStrike(m.activeStrike).then(function(e){if(e.warnings&&e.warnings.length>0){var t=v(e.warnings);g.error(t)}else g.success("Strike is valid.")})["catch"](function(e){e&&e.detail?g.error(e.detail):g.error("Error validating strike")})["finally"](function(){m.loading=!1})},m.disableSaveBtn=function(e){var t=!(!e&&m.activeStrike.configuration.files_to_ingest.length>0);return m.saveBtnClass=t?"btn-default":"btn-success",t},m.addStrikeIngestFile=function(){_.keys(m.activeStrikeIngestFile).length>0&&(m.activeStrike.configuration.files_to_ingest.push(o.transformer(m.activeStrikeIngestFile)),m.activeStrikeIngestFile=new o)},m.deleteStrikeIngestFile=function(e){_.remove(m.activeStrike.configuration.files_to_ingest,function(t){return angular.equals(t,e)})},m.addDataType=function(){m.dataType&&(m.activeStrikeIngestFile.data_types.push(m.dataType),m.dataType="")},m.removeDataType=function(e){_.remove(m.activeStrikeIngestFile.data_types,function(t){return t===e})},m.updateWorkspace=function(){if(m.activeStrike){var e=_.find(m.workspaces,{name:m.activeStrike.configuration.workspace});e&&(m.newWorkspaces=_.cloneDeep(m.workspaces),_.remove(m.newWorkspaces,e),y(e.id))}},m.formatJSON=function(e){return e=_.omit(e,"$$hashKey"),e.new_workspace&&(e.new_workspace=e.new_workspace.name),JSON.stringify(e,null,4)};var y=function(e){m.loading=!0,u.getWorkspaceDetails(e).then(function(e){m.activeWorkspace=e,"host"===m.activeWorkspace.json_config.broker.type?m.activeStrike.configuration.monitor.type="dir-watcher":"s3"===m.activeWorkspace.json_config.broker.type?m.activeStrike.configuration.monitor.type="s3":m.activeStrike.configuration.monitor.type=null})["catch"](function(e){console.log(e)})["finally"](function(){m.loading=!1})},b=function(){u.getWorkspaces().then(function(e){m.workspaces=e,m.newWorkspaces=e,m.updateWorkspace()})["catch"](function(e){console.log(e)})["finally"](function(){m.loading=!1})},S=function(){m.loading=!0,l.getStrikes().then(function(e){if(a["static"]){for(var t,n=0,i={};t=localStorage.key(n);n++)i[t]=localStorage.getItem(t);_.filter(_.pairs(i),function(t){if(_.contains(t[0],"strike")){var n=JSON.parse(t[1]);m.localStrikes.push(n),e.push(n)}})}m.strikes=e,b()})["catch"](function(e){console.log(e),m.loading=!1})},T=function(){if(S(),m.activeStrike=null,m.mode="view",i.id){var e=parseInt(i.id);0===e?(m.mode="add",m.activeStrike=new r):l.getStrikeDetails(e).then(function(e){m.activeStrike=r.transformer(e)})}s.updateLocation("feed"),c.setCurrentPath("feed/strikes")};T(),angular.element(document).ready(function(){var e=d.getViewportSize(),t=a.headerOffset,n=e.height-t+60;m.containerStyle="height: "+n+"px; max-height: "+n+"px;"})}])}(),function(){"use strict";angular.module("scaleApp").factory("Feed",["scaleConfig",function(e){var t=function(e,t){this.value=e,this.status=t};return t.prototype={toString:function(){return"Feed"},getCellText:function(){return this.value},getCellTitle:function(){return""}},t.build=function(e){return e?new t(e.value,e.status):new t},t.transformer=function(e){return angular.isArray(e)?e.map(t.build).filter(Boolean):t.build(e)},t}])}(),function(){"use strict";angular.module("scaleApp").factory("FeedStatus",["scaleConfig",function(e){var t=function(e){this.status=e};return t.prototype={toString:function(){return"FeedStatus"},getCellFill:function(){return e.colors.chart_green},getCellActivity:function(){return""},getCellActivityTotal:function(){return""},getCellError:function(){return""},getCellTotal:function(){return""}},t.build=function(e){return e?new t(e.status):new t},t.transformer=function(e){return angular.isArray(e)?e.map(t.build).filter(Boolean):t.build(e)},t}])}(),function(){"use strict";angular.module("scaleApp").factory("Ingest",["scaleConfig","scaleService",function(e,t){var n=function(n,i,r,o,a,s,c,l,u,d,p,f,g,m,h){this.id=n,this.file_name=i,this.strike=r,this.status=o,this.bytes_transferred=a,this.transfer_started=s,this.transfer_started_formatted=moment.utc(s).format(e.dateFormats.day_second_utc_nolabel),this.transfer_ended=c,this.transfer_ended_formatted=moment.utc(c).format(e.dateFormats.day_second_utc_nolabel),this.media_type=l,this.file_size=u,this.file_size_formatted=t.calculateFileSizeFromBytes(u),this.data_type=d,this.ingest_started=p,this.ingest_started_formatted=p?moment.utc(p).format(e.dateFormats.day_second_utc_nolabel):"",this.ingest_ended=f,this.ingest_ended_formatted=f?moment.utc(f).format(e.dateFormats.day_second_utc_nolabel):"",this.source_file=g,this.created=m,this.created_formatted=moment.utc(m).format(e.dateFormats.day_second_utc_nolabel),this.last_modified=h,this.last_modified_formatted=moment.utc(h).format(e.dateFormats.day_second_utc_nolabel)};return n.prototype={},n.build=function(e){return e?new n(e.id,e.file_name,e.strike,e.status,e.bytes_transferred,e.transfer_started,e.transfer_ended,e.media_type,e.file_size,e.data_type,e.ingest_started,e.ingest_ended,e.source_file,e.created,e.last_modified):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").factory("Scan",["scaleConfig","Job","ScanConfiguration",function(e,t,n){var i=function(i,r,o,a,s,c,l,u,d,p){this.id=i,this.name=r,this.title=o,this.description=a,this.file_count=s,this.job=t.transformer(c),this.dry_run_job=t.transformer(l),this.created=u,this.created_formatted=moment.utc(u).format(e.dateFormats.day_second_utc),this.last_modified=d,this.last_modified_formatted=moment.utc(d).format(e.dateFormats.day_second_utc),this.configuration=n.transformer(p)};return i.prototype={clean:function(){var e={name:this.name,title:this.title,description:this.description,configuration:this.configuration};return e.configuration&&"s3"===e.configuration.scanner.type&&delete e.configuration.scanner.transfer_suffix,e.configuration.files_to_ingest&&_.forEach(e.configuration.files_to_ingest,function(e){delete e.$$hashKey}),_.pick(e,_.identity)}},i.build=function(e){return e?new i(e.id,e.name,e.title,e.description,e.file_count,e.job,e.dry_run_job,e.created,e.last_modified,e.configuration):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("ScanConfiguration",["scaleConfig","ScanIngestFile",function(e,t){var n=function(n,i,r,o){this.version=e.scanConfigurationVersion,this.workspace=i,this.scanner=r?r:{type:"",transfer_suffix:""},this.files_to_ingest=o?t.transformer(o):[]};return n.prototype={},n.build=function(e){return e?new n(e.version,e.workspace,e.scanner,e.files_to_ingest):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").factory("ScanIngestFile",function(){var e=function(e,t,n,i){this.filename_regex=e,this.data_types=t||[],this.new_workspace=n||"",this.new_file_path=i||""};return e.prototype={},e.build=function(t){if(t){var n=new e(t.filename_regex,t.data_types,t.new_workspace,t.new_file_path);return t.data_types&&0===t.data_types.length&&delete n.data_types,_.pick(n,_.identity)}return new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("Strike",["scaleConfig","Job","StrikeConfiguration",function(e,t,n){var i=function(i,r,o,a,s,c,l,u){this.id=i,this.name=r,this.title=o,this.description=a,this.job=t.transformer(s),this.created=c,this.created_formatted=moment.utc(c).format(e.dateFormats.day_second_utc),this.last_modified=l,this.last_modified_formatted=moment.utc(l).format(e.dateFormats.day_second_utc),this.configuration=n.transformer(u)};return i.prototype={clean:function(){return{name:this.name,title:this.title,description:this.description,configuration:this.configuration}}},i.build=function(e){return e?new i(e.id,e.name,e.title,e.description,e.job,e.created,e.last_modified,e.configuration):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("StrikeConfiguration",["scaleConfig","StrikeIngestFile",function(e,t){var n=function(n,i,r,o){this.version=e.strikeConfigurationVersion,this.workspace=i,this.monitor=r?r:{type:"",region_name:"",credentials:{access_key_id:"",secret_access_key:""}},this.files_to_ingest=o?t.transformer(o):[]};return n.prototype={},n.build=function(e){return e?new n(e.version,e.workspace,e.monitor,e.files_to_ingest):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").factory("StrikeIngestFile",function(){var e=function(e,t,n,i){this.filename_regex=e,this.data_types=t||[],this.new_workspace=n||"",this.new_file_path=i||""};return e.prototype={},e.build=function(t){if(t){var n=new e(t.filename_regex,t.data_types,t.new_workspace,t.new_file_path);return t.data_types&&0===t.data_types.length&&delete n.data_types,_.pick(n,_.identity)}return new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").service("feedService",["$location","$timeout","$q","$http","scaleConfig","Ingest",function(e,t,n,i,r,o){var a=function(e){e||(e={});var t={};return t.page_size=1e3,t.started=e.started?e.started:moment.utc().add(-7,"days").startOf("d").toDate(),t.ended=e.ended?e.ended:moment.utc().toDate(),t.use_ingest_time=e.use_ingest_time?e.use_ingest_time:null,t},s=function(e){return e},c=function(e,t,n,i,r,o,a){return{page:e,page_size:t?t:1e3,started:n,ended:i,order:r?r:"-last_modified",is_parsed:o,file_name:a}};return{getFeed:function(e){var t=n.defer(),e=a(e);return i({url:r.getUrlPrefix("ingests")+"ingests/status/",method:"GET",params:e}).success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise},getIngestsOnce:function(e){var t=n.defer(),e=s(e);return i({url:r.getUrlPrefix("ingests")+"ingests/",method:"GET",params:e}).success(function(e){e.results=o.transformer(e.results),t.resolve(e)}).error(function(e){t.reject(e)}),t.promise},getSources:function(e){e=e||c();var t=n.defer();return i({url:r.getUrlPrefix("sources")+"sources/",method:"GET",params:e}).success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise},getSourceDetails:function(e){var t=n.defer();return i({url:r.getUrlPrefix("sources")+"sources/"+e+"/",method:"GET"}).success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}}}])}(),function(){"use strict";angular.module("scaleApp").service("scanService",["$http","$q","$resource","scaleConfig",function(e,t,n,i){return{getScans:function(n){var r=t.defer(),o=i.urls.apiPrefix+"scans/";return e({url:o,method:"GET",params:n}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getScanDetails:function(n){var r=t.defer(),o=i.urls.apiPrefix+"scans/"+n+"/";return e({url:o,method:"GET"}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},validateScan:function(n){var r=t.defer(),o=n.clean();return e.post(i.urls.apiPrefix+"scans/validation/",o).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},saveScan:function(n){var r=t.defer();return n.id?e.patch(i.urls.apiPrefix+"scans/"+n.id+"/",n).success(function(e){n=e,r.resolve(n)}).error(function(e){r.reject(e)}):e.post(i.urls.apiPrefix+"scans/",n).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}])}(),function(){"use strict";angular.module("scaleApp").service("strikeService",["$http","$q","$resource","scaleConfig",function(e,t,n,i){return{getStrikes:function(){var n=t.defer(),r=i.urls.apiPrefix+"strikes/";return e({url:r,method:"GET",params:{order:"-title"}}).success(function(e){n.resolve(e.results)}).error(function(e){n.reject(e)}),n.promise},getStrikeDetails:function(n){var r=t.defer(),o=i.urls.apiPrefix+"strikes/"+n+"/";return e({url:o,method:"GET"}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},validateStrike:function(n){var r=t.defer(),o=n.clean();return e.post(i.urls.apiPrefix+"strikes/validation/",o).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},saveStrike:function(n){var r=t.defer();return n.id?e.patch(i.urls.apiPrefix+"strikes/"+n.id+"/",n.clean()).success(function(e){n=e,r.resolve(n)}).error(function(e){r.reject(e)}):e.post(i.urls.apiPrefix+"strikes/",n.clean()).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}])}(),function(){"use strict";angular.module("scaleApp").directive("aisGridPagination",function(){return{templateUrl:"modules/common/directives/aisGridPaginationTemplate.html",restrict:"E"}})}(),function(){"use strict";angular.module("scaleApp").directive("aisMultiselect",function(){return{restrict:"A",require:"^ngModel",scope:{multiselectDataProvider:"=",enableFiltering:"=",maxHeight:"=",numberDisplayed:"=",includeSelectAllOption:"=",nonSelectedText:"=",ngModel:"="},link:function(e,t,n){t=$(t[0]),t.multiselect({enableFiltering:e.enableFiltering,enableCaseInsensitiveFiltering:!0,maxHeight:e.maxHeight||300,numberDisplayed:e.numberDisplayed||3,includeSelectAllOption:e.includeSelectAllOption,nonSelectedText:e.nonSelectedText||"None Selected",onChange:function(n,i){e.$apply(function(){e.ngModel=t.val()})}}),e.$watchCollection("multiselectDataProvider",function(e,n){angular.equals(e,n)||t.multiselect("dataprovider",e)})}}})}(),function(){"use strict";angular.module("scaleApp").factory("gaugeFactory",["scaleConfig",function(e){var t=function(e,t){this.placeholderName=e;var n=this;this.configure=function(e){this.config=e,this.config.size=.9*this.config.size,this.config.radius=.97*this.config.size/2,this.config.cx=this.config.size/2,this.config.cy=this.config.size/2,this.config.min=void 0!=e.min?e.min:0,this.config.max=void 0!=e.max?e.max:100,this.config.range=this.config.max-this.config.min,this.config.majorTicks=e.majorTicks||5,this.config.minorTicks=e.minorTicks||2,this.config.greenColor=e.greenColor||"#8fca0e",this.config.yellowColor=e.yellowColor||"#ffc317",this.config.redColor=e.redColor||"#f54d36",this.config.grayColor=e.grayColor||"#aaa",this.config.transitionDuration=e.transitionDuration||500},this.render=function(){this.body=d3.select("#"+this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size),this.body.append("svg:circle").attr("class","outer-circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",this.config.radius).style("fill","#ccc"),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.9*this.config.radius).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px");for(var e in this.config.greenZones)this.drawBand(this.config.greenZones[e].from,this.config.greenZones[e].to,n.config.greenColor);for(var t in this.config.yellowZones)this.drawBand(this.config.yellowZones[t].from,this.config.yellowZones[t].to,n.config.yellowColor);for(var i in this.config.redZones)this.drawBand(this.config.redZones[i].from,this.config.redZones[i].to,n.config.redColor);var r=0;void 0!=this.config.label&&(r=Math.round(this.config.size/9),this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/2+r/2).attr("dy",r/2).attr("text-anchor","middle").text(this.config.label).style("font-size",r+"px").style("fill","#333").style("stroke-width","0px")),r=Math.round(this.config.size/16);for(var o=this.config.range/(this.config.majorTicks-1),a=this.config.min;a<=this.config.max;a+=o){for(var s=o/this.config.minorTicks,c=0,l=0,u=a+s;u<Math.min(a+o,this.config.max);u+=s)c=this.valueToPoint(u,.75),l=this.valueToPoint(u,.85),this.body.append("svg:line").attr("x1",c.x).attr("y1",c.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#666").style("stroke-width","1px");if(c=this.valueToPoint(a,.7),l=this.valueToPoint(a,.85),this.body.append("svg:line").attr("x1",c.x).attr("y1",c.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#333").style("stroke-width","2px"),a==this.config.min||a==this.config.max){var d=this.valueToPoint(a,.63);this.body.append("svg:text").attr("x",d.x).attr("y",d.y).attr("dy",r/3).attr("text-anchor",a==this.config.min?"start":"end").text(a).style("font-size",r+"px").style("fill","#333").style("stroke-width","0px")}}var p=this.body.append("svg:g").attr("class","pointerContainer"),f=(this.config.min+this.config.max)/2,g=this.buildPointerPath(f),m=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("basis");p.selectAll("path").data([g]).enter().append("svg:path").attr("d",m).style("fill","#888"),p.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.07*this.config.radius).style("fill","#888"),r=Math.round(this.config.size/10),p.selectAll("text").data([f]).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-r).attr("dy",r/2).attr("text-anchor","middle").style("font-size",r+"px").style("fill","#000").style("stroke-width","0px"),this.redraw(this.config.min,0)},this.buildPointerPath=function(e){function t(e,t){var i=n.valueToPoint(e,t);return i.x-=n.config.cx,i.y-=n.config.cy,i}var i=this.config.range/13,r=t(e,.85),o=t(e-i,.12),a=t(e+i,.12),s=e-this.config.range*(1/.75)/2,c=t(s,.28),l=t(s-i,.12),u=t(s+i,.12);return[r,o,u,c,l,a,r]},this.drawBand=function(e,t,i){0>=t-e||this.body.append("svg:path").style("fill",i).attr("d",d3.svg.arc().startAngle(this.valueToRadians(e)).endAngle(this.valueToRadians(t)).innerRadius(.65*this.config.radius).outerRadius(.85*this.config.radius)).attr("transform",function(){return"translate("+n.config.cx+", "+n.config.cy+") rotate(270)"})},this.redraw=function(e,t){var i=!1;e<0&&(i=!0,e=0);var r=this.body.select(".pointerContainer");r.selectAll("text").text(parseFloat(e).toFixed(2)+"%");var o=r.selectAll("path");o.transition().duration(void 0!=t?t:this.config.transitionDuration).attrTween("transform",function(){var t=e;e>n.config.max?t=n.config.max+.02*n.config.range:e<n.config.min&&(t=n.config.min-.02*n.config.range);var i=n.valueToDegrees(t)-90,r=n._currentRotation||i;return n._currentRotation=i,function(e){var t=r+(i-r)*e;return"translate("+n.config.cx+", "+n.config.cy+") rotate("+t+")"}});this.body.select(".outer-circle").transition().duration(750).style("fill",function(){var t=parseInt(e);return t>=0&&t<75&&!i?n.config.greenColor:t>=75&&t<90&&!i?n.config.yellowColor:0===t&&i?n.config.redColor:n.config.redColor})},this.valueToDegrees=function(e){return e/this.config.range*270-(this.config.min/this.config.range*270+45)},this.valueToRadians=function(e){return this.valueToDegrees(e)*Math.PI/180},this.valueToPoint=function(e,t){return{x:this.config.cx-this.config.radius*t*Math.cos(this.valueToRadians(e)),y:this.config.cy-this.config.radius*t*Math.sin(this.valueToRadians(e))}},this.configure(t)};return{createGauge:function(n,i,r,o,a){var s={size:a||e.defaultGaugeWidth,label:i,min:r||0,max:o||100,minorTicks:5},c=s.max-s.min;s.yellowZones=[{from:s.min+.75*c,to:s.min+.9*c}],s.redZones=[{from:s.min+.9*c,to:s.max}];var l=new t(n+"GaugeContainer",s);return l.render(),l}}}])}(),function(){"use strict";angular.module("scaleApp").factory("gridFactory",["uiGridConstants",function(e){var t=function(e){var t=[];return e&&_.forEach(e,function(e){var n=e,i="asc";_.startsWith(e,"-")&&(i="desc"),t.push({direction:i,field:n})}),t};return{defaultGridOptions:function(){return{enableRowSelection:!0,enableRowHeaderSelection:!1,enableHorizontalScrollbar:e.scrollbars.NEVER,enableVerticalScrollbar:e.scrollbars.NEVER,multiSelect:!1,enableFiltering:!0,useExternalSorting:!0,useExternalFiltering:!0,enableSorting:!0,minRowsToShow:17,paginationPageSizes:[25,50,75,100],paginationPageSize:25,useExternalPagination:!0,enablePaginationControls:!1,paginationCurrentPage:1}},applySortConfig:function(e,n){var i=t(n.order);return _.forEach(i,function(t,n){var i=_.startsWith(t.field,"-")?t.field.substring(1):t.field,r=_.find(e,{field:i});r&&(r.sort={direction:t.direction,priority:n})}),e}}}])}(),function(){"use strict";angular.module("scaleApp").factory("pollerFactory",["poller",function(e){return{newPoller:function(t,n){return e.get(t,{delay:n,catchError:!0})}}}])}(),function(){"use strict";angular.module("scaleApp").factory("Status",["StatusMaster","StatusScheduler","StatusResources",function(e,t,n){var i=function(i,r,o,a,s){this.$resolved=i,this.master=e.transformer(r),this.scheduler=t.transformer(o),this.queue_depth=a,this.resources=n.transformer(s)};return i.prototype={getCpuUsage:function(){return this.resources.scheduled.cpus&&this.resources.total.cpus&&this.resources.total.cpus>0?(this.resources.scheduled.cpus/this.resources.total.cpus*100).toFixed(2):0},getMemUsage:function(){return this.resources.scheduled.mem&&this.resources.total.mem&&this.resources.total.mem>0?(this.resources.scheduled.mem/this.resources.total.mem*100).toFixed(2):0},getDiskUsage:function(){return this.resources.scheduled.disk&&this.resources.total.disk&&this.resources.total.disk>0?(this.resources.scheduled.disk/this.resources.total.disk*100).toFixed(2):0}},i.build=function(e){return e?new i(e.$resolved,e.master,e.scheduler,e.queue_depth,e.resources):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build).filter(Boolean):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("StatusMaster",function(){var e=function(e,t,n){this.is_online=e,this.hostname=t,this.port=n};return e.prototype={},e.build=function(t){return t?new e(t.is_online,t.hostname,t.port):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("StatusResource",function(){var e=function(e,t,n){this.cpus=e,this.mem=t,this.disk=n};return e.prototype={},e.build=function(t){return t?new e(t.cpus,t.mem,t.disk):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("StatusResources",["StatusResource",function(e){var t=function(t,n,i){this.total=e.transformer(t),this.scheduled=e.transformer(n),this.used=e.transformer(i)};return t.prototype={},t.build=function(e){return e?new t(e.total,e.scheduled,e.used):new t},t.transformer=function(e){return angular.isArray(e)?e.map(t.build).filter(Boolean):t.build(e)},t}])}(),function(){"use strict";angular.module("scaleApp").factory("StatusScheduler",function(){var e=function(e,t,n){this.is_online=e,this.is_paused=t,this.hostname=n};return e.prototype={},e.build=function(t){return t?new e(t.is_online,t.is_paused,t.hostname):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").service("scaleService",["$q","$http","scaleConfig",function(e,t,n){function i(e,t){e=""+e;var n=Math.max(0,t-e.length);return new Array(n>0?n+1:0).join("0")+e}return{calculateFileSizeFromMib:function(e){return e>0?e<1024?e.toFixed(2)+" MB":e>=1024&&e<1048576?(e/1024).toFixed(2)+" GB":(e/1024/1024).toFixed(2)+" TB":e},calculateFileSizeFromBytes:function(e,t){return e>0?e<1024?e.toFixed(t)+" Bytes":e>=1024&&e<1048576?(e/1024).toFixed(t)+" KB":e>=1048576&&e<1073741824?(e/1024/1024).toFixed(t)+" MB":e>=1073741824&&e<1099511627776?(e/1024/1024/1024).toFixed(t)+" GB":(e/1024/1024/1024/1024).toFixed(t)+" TB":e},getViewportSize:function(){var e=window,t=document,n=t.documentElement,i=document.body,r=e.innerWidth||n.clientWidth||i.clientWidth,o=e.innerHeight||n.clientHeight||i.clientHeight;return{width:r,height:o}},calculateDuration:function(e,t,n){var r=moment.utc(t),o=moment.utc(e),a=moment.utc(r).diff(moment.utc(o)),s="",c=moment.duration(a);return n?(s=c.years()>0?s+c.years()+"Y, ":s,s=c.months()>0?s+c.months()+"M, ":s,s=c.days()>0?s+c.days()+"D, ":s,s=c.hours()>0?s+c.hours()+"h, ":s,s=c.minutes()>0?s+c.minutes()+"m, ":s,s=s+c.seconds()+"s"):(s=c.years()>0?s+i(c.years(),2)+"Y, ":s,s=c.months()>0?s+i(c.months(),2)+"M, ":s,s=c.days()>0?s+i(c.days(),2)+"D, ":s,s=c.hours()>0?s+i(c.hours(),2)+"h, ":s,s=c.minutes()>0?s+i(c.minutes(),2)+"m, ":s,s=s+i(c.seconds(),2)+"s"),s},getDayString:function(e){var t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return t[e]},isIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE"),n=e.indexOf("Trident/");return t>-1||n>-1},getMediaTypeHtml:function(e){var t='<i class="fa fa-file"></i>';if(e){var i=_.find(n.mediaTypes,{mimeType:e});i&&(t='<i class="fa '+i.icon+'"></i>')}return t},getVersion:function(){var i=e.defer();return t({url:n.urls.apiPrefix+"version/",method:"GET"}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},setGridHeight:function(e){e=e||n.headerOffset;var t=this.getViewportSize(),i=t.height-e;return"height: "+i+"px; max-height: "+i+"px; overflow-y: auto;"}}}])}(),function(){"use strict";angular.module("scaleApp").service("schedulerService",["$http","$q","scaleConfig",function(e,t,n){var i=function(e){return{is_paused:e}};return{updateScheduler:function(r){r=r||i();var o=t.defer();return e({url:n.getUrlPrefix("scheduler")+"scheduler/",method:"PATCH",data:r}).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}}])}(),function(){"use strict";angular.module("scaleApp").service("stateService",["$location",function(e){var t="",n=[],i={},r={},o={},a=[],s={},c={},l=[],u={},d=[],p={},f=[],g=[],m={},h=!0,v={},y=[],b=[],S=function(t,n){n=n||!1,n||(t.page=t.page||1,t.page_size=t.page_size||25,t.started=t.started||null,t.ended=t.ended||null,t.order=t.order?Array.isArray(t.order)?t.order:[t.order]:null,t.status=t.status||null),_.forEach(_.pairs(t),function(t){e.search(t[0],t[1])})},T=function(e){return{page:e.page?parseInt(e.page):1,page_size:e.page_size?parseInt(e.page_size):25,started:e.started?e.started:moment.utc().subtract(1,"weeks").startOf("d").toISOString(),ended:e.ended?e.ended:moment.utc().endOf("d").toISOString(),order:e.order?Array.isArray(e.order)?e.order:[e.order]:["-last_modified"],status:e.status?e.status:null,error_category:e.error_category?e.error_category:null,job_type_id:e.job_type_id?parseInt(e.job_type_id):null,job_type_name:e.job_type_name?e.job_type_name:null,job_type_category:e.job_type_category?e.job_type_category:null,url:null}},w=function(e){return{page:e.page?parseInt(e.page):1,page_size:e.page_size?parseInt(e.page_size):25,started:e.started?e.started:moment.utc().subtract(1,"weeks").startOf("d").toISOString(),ended:e.ended?e.ended:moment.utc().endOf("d").toISOString(),order:e.order?Array.isArray(e.order)?e.order:[e.order]:["-last_modified"],status:e.status?e.status:null,job_type_id:e.job_type_id?parseInt(e.job_type_id):null,job_type_name:e.job_type_name?e.job_type_name:null,job_type_category:e.job_type_category?e.job_type_category:null,node_id:e.node_id?e.node_id:null}},j=function(e){return{show_rd:"undefined"==typeof e.show_rd||e.show_rd}},C=function(e){return{page:null,page_size:null,started:null,ended:null,name:e.name?e.name:null,version:e.version?e.version:null,category:null,order:e.order?e.order:"desc",orderField:e.orderField?e.orderField:"twentyfour_hours",orderErrorType:e.orderErrorType?e.orderErrorType:"errorTotal"}},x=function(e){return{page:e.page?parseInt(e.page):1,page_size:e.page_size?parseInt(e.page_size):25,started:e.started?e.started:moment.utc().subtract(1,"weeks").startOf("d").toISOString(),ended:e.ended?e.ended:moment.utc().endOf("d").toISOString(),order:e.order?Array.isArray(e.order)?e.order:[e.order]:["-last_modified"],type_id:e.type_id?parseInt(e.type_id):null,type_name:e.type_name?e.type_name:null,url:null}},k=function(e){return{page:e.page?parseInt(e.page):1,page_size:e.page_size?parseInt(e.page_size):25,started:e.started?e.started:moment.utc().subtract(1,"weeks").startOf("d").toISOString(),ended:e.ended?e.ended:moment.utc().endOf("d").toISOString(),order:e.order?Array.isArray(e.order)?e.order:[e.order]:["-ingest_started"],status:e.status?e.status:null,file_name:e.file_name?e.file_name:null,strike_id:e.strike_id?parseInt(e.strike_id):null}},P=function(e){return{page:e.page?parseInt(e.page):1,page_size:e.page_size?parseInt(e.page_size):25,started:e.started?e.started:moment.utc().subtract(1,"weeks").startOf("d").toISOString(),ended:e.ended?e.ended:moment.utc().endOf("d").toISOString(),name:e.name?e.name:null,order:e.order?Array.isArray(e.order)?e.order:[e.order]:["-last_modified"]}},D=function(e){return{order:e.order?Array.isArray(e.order)?e.order:[e.order]:["hostname"],active:e.active||"true",state:e.state||null}},A=function(e){return{page:e.page?parseInt(e.page):1,page_size:e.page_size?parseInt(e.page_size):25,started:e.started?e.started:moment.utc().subtract(1,"weeks").startOf("d").toISOString(),ended:e.ended?e.ended:moment.utc().endOf("d").toISOString(),order:e.order?Array.isArray(e.order)?e.order:[e.order]:["-last_modified"],status:e.status?e.status:null,recipe_type_id:e.recipe_type_id?parseInt(e.recipe_type_id):null,job_type_id:e.job_type_id?parseInt(e.job_type_id):null,url:null}};return{getVersion:function(){return t},setVersion:function(e){t=e},getJobsColDefs:function(){return n},setJobsColDefs:function(e){n=e},getJobsParams:function(){return 0===_.keys(i).length?T(e.search()):i},setJobsParams:function(e){i=T(e),S(i)},getJobExecutionsParams:function(){return 0===_.keys(r).length?w(e.search()):r},setJobExecutionsParams:function(e){r=w(e),S(r)},getJobTypesParams:function(){return 0===_.keys(o).length&&(o=j(e.search())),o},setJobTypesParams:function(e){o=j(e),S(o)},getJobTypesFailureRatesParams:function(){return 0===_.keys(s).length?C(e.search()):s},setJobTypesFailureRatesParams:function(t){s=C(t),_.forEach(_.pairs(s),function(t){e.search(t[0],t[1])})},getRecipesColDefs:function(){return a},setRecipesColDefs:function(e){a=e},getRecipesParams:function(){return 0===_.keys(c).length?x(e.search()):c},setRecipesParams:function(e){c=x(e),S(c)},getIngestsColDefs:function(){return l},setIngestsColDefs:function(e){l=e},getScansColDefs:function(){return d},setScansColDefs:function(e){d=e},getIngestsParams:function(){return 0===_.keys(u).length?k(e.search()):u},setIngestsParams:function(e){u=k(e),S(u)},getScansParams:function(){return 0===_.keys(p).length?P(e.search()):p},setScansParams:function(e){p=P(e),S(p)},getNodesColDefs:function(){return f},setNodesColDefs:function(e){f=e},getShowActiveWorkspaces:function(){return h},setShowActiveWorkspaces:function(e){h=e},getNodesParams:function(){return 0===_.keys(v).length?D(e.search()):v},setNodesParams:function(e){v=D(e),S(v,!0)},getLogArgs:function(){return y},setLogArgs:function(e){y=e},getJobExecutionLogPoller:function(){
return b},setJobExecutionLogPoller:function(e){b.push(e)},getBatchesColDefs:function(){return g},setBatchesColDefs:function(e){g=e},getBatchesParams:function(){return 0===_.keys(m).length?A(e.search()):m},setBatchesParams:function(e){m=A(e),S(m)}}}])}(),function(){"use strict";angular.module("scaleApp").service("statusService",["$resource","scaleConfig","poller","pollerFactory","Status",function(e,t,n,i,r){return{getStatus:function(n){n=n||!1;var o=e(n?t.getUrlPrefix("nodeStatus")+"status/":t.getUrlPrefix("status")+"status/"),a=n?i.newPoller(o,t.pollIntervals.nodeStatus):i.newPoller(o,t.pollIntervals.status);return a.promise.then(null,null,function(e){return e.$resolved?e=n?e:r.transformer(e):a.stop(),e})}}}])}(),function(){"use strict";angular.module("scaleApp").service("userService",function(){return{getUserCreds:function(){var e=localStorage.getItem("userCreds");try{return JSON.parse(e)}catch(t){return console.log("Error parsing user credentials"),e}},setUserCreds:function(e){null!==e?localStorage.setItem("userCreds",JSON.stringify(e)):localStorage.removeItem("userCreds")},login:function(e){var t={username:e,is_admin:!0};return this.setUserCreds(t),t},logout:function(){this.setUserCreds(null)}}})}(),function(){angular.module("scaleApp").controller("scaleFileAncestryTreeController",["$scope","scaleService",function(e,t){function n(e){var t=25,n=e;if(e.length>30){var i=e.substring(e.lastIndexOf(".")+1),r=t-i.length;n=e.substring(0,r-1)+"..."+i}return n}function i(e){var i=t.getMediaTypeHtml(e.media_type),r=n(e.file_name),o="<div class='graph'>";return o+="<span class='name' title='"+e.file_name+"'>",o+="<a ng-show='"+e.url+"' href='"+e.url+"' target='_jobfile'>"+i+" "+r+"</a>",o+="</span>",o+="</div>"}function r(e,t){var n="<div>";return n+="<span class='status'></span><span class='job-name'><a href='#/jobs/job/"+t+"'>"+e.name+"</a></span>",n+="</div>"}function o(){if(a.source&&void 0!==a.source){var e=d3.select("svg"),t=e.select("g"),n=d3.behavior.zoom().on("zoom",function(){t.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")});e.call(n);var o=new dagreD3.render,s=new dagreD3.graphlib.Graph({multigraph:!0});s.setGraph({nodesep:30,ranksep:70,rankdir:"LR",marginx:20,marginy:0});var c=i(a.source);s.setNode("file-"+a.source.id,{labelType:"html",label:c,rx:10,ry:10,padding:10,width:250,height:20});for(var l in a.source.products){var u=a.source.products[l],d=r(u.job_type,u.job.id);s.setNode("job-"+u.job.id,{labelType:"html",label:d,rx:10,ry:10,padding:10,width:200,height:20}),s.setEdge("file-"+a.source.id,"job-"+u.job.id,{});var c=i(u);s.setNode("file-"+u.id,{labelType:"html",label:c,rx:10,ry:10,padding:10,width:250,height:20}),s.setEdge("job-"+u.job.id,"file-"+u.id,{})}o(t,s);var p=e.attr("viewBox").split(" "),f=s.graph().width,g=s.graph().height;console.log(g),console.log(p[3]),g<p[3]&&e.attr("viewBox",p[0]+" "+p[1]+" "+p[2]+" "+1.1*g);var m=Math.min(.95*p[2]/f,.95*p[3]/g);n.translate([.02*p[2],.02*p[3]]).scale(m).event(e),$(".job-name").closest(".node").children("rect").attr("class","job")}}var a=this;a.source=e.source,e.$watchCollection("vm.source",function(){o()})}]).directive("scaleFileAncestryTree",function(){"use strict";return{controller:"scaleFileAncestryTreeController",templateUrl:"modules/feed/directives/fileAncestryTreeTemplate.html",restrict:"E",scope:{source:"="}}})}(),function(){"use strict";angular.module("scaleApp").service("jobExecutionService",["$http","$q","$resource","stateService","poller","scaleConfig","JobExecution","JobExecutionLog",function(e,t,n,i,r,o,a,s){var c=function(e,t,n,i,r,o,a,s,c,l){return{page:e,page_size:t,started:n,ended:i,order:r,status:o,job_type_id:a,job_type_name:s,job_type_category:c,node_id:l}};return{getJobExecutions:function(n){n=n||c();var i=t.defer();return e({url:o.getUrlPrefix("job-executions")+"job-executions/",method:"GET",params:n}).success(function(e){e.results=a.transformer(e.results),i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},getJobExecutionDetails:function(n){var i=t.defer();return e.get(o.getUrlPrefix("job-executions")+"job-executions/"+n+"/").success(function(e){i.resolve(a.transformer(e))}).error(function(e){i.reject(e)}),i.promise},getLogOnce:function(n){var i=t.defer();return e({method:"GET",url:o.getUrlPrefix("job-executions")+"job-executions/"+n+"/logs/combined/"}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},getLog:function(e){var t=t||o.getUrlPrefix("job-executions")+"job-executions/"+e+"/logs/combined/",a=n(t,{},{get:{method:"GET",interceptor:{response:function(e){var t=e.resource;return t.$status=e.status,t.$statusText=e.statusText,t}}}}),s=r.get(a,{action:"get",delay:o.pollIntervals.jobExecutionLog,argumentsArray:function(){return i.getLogArgs()}});return i.setJobExecutionLogPoller(s),s.promise.then(null,null,function(e){return e.$resolved?e:(s.stop(),e)})}}}])}(),function(){"use strict";angular.module("scaleApp").service("jobService",["$http","$q","$resource","scaleConfig","Job","JobDetails","RunningJob","poller","pollerFactory",function(e,t,n,i,r,o,a,s,c){var l=function(e,t,n,i,r,o,a,s,c,l){return{page:e,page_size:t,started:n,ended:i,order:r,status:o,job_type_id:a,job_type_name:s,job_type_category:c,url:l}},u=function(e){return{status:e}};return{getJobs:function(e){e=e||l(),e.url=e.url?e.url:i.getUrlPrefix("jobs")+"jobs/";var t=n(e.url,e),o=c.newPoller(t,i.pollIntervals.jobs);return o.promise.then(null,null,function(e){return e.$resolved?e.results=r.transformer(e.results):o.stop(),e})},getJobsOnce:function(n){n=n||l();var o=t.defer();return e({url:n.url?n.url:i.getUrlPrefix("jobs")+"jobs/",method:"GET",params:n}).success(function(e){e.results=r.transformer(e.results),o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},getJobCountsByStatus:function(n){n=n||3;var r=t.defer();return e.get(i.urls.getJobCountsByStatus(n)).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getJobDetail:function(n){var r=t.defer();return e.get(i.getUrlPrefix("jobs")+"jobs/"+n+"/").success(function(e){r.resolve(o.transformer(e))}).error(function(e){r.reject(e)}),r.promise},getRunningJobs:function(e,t){var r={pageNumber:e,pageSize:t},o=n(i.getUrlPrefix("job-types")+"job-types/running/",r),s=c.newPoller(o,i.pollIntervals.runningJobs);return s.promise.then(null,null,function(e){return e.$resolved?e.results=a.transformer(e.results):s.stop(),e})},getRunningJobsOnce:function(n,r){var o={pageNumber:n,pageSize:r},s=t.defer();return e.get(i.getUrlPrefix("job-types")+"job-types/running/",o).success(function(e){e.results=a.transformer(e.results),s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},updateJob:function(n,r){r=r||u();var o=t.defer();return e({url:i.getUrlPrefix("jobs")+"jobs/"+n+"/",method:"PATCH",data:r}).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}}])}(),function(){"use strict";angular.module("scaleApp").service("jobTypeService",["$http","$q","$resource","poller","pollerFactory","scaleConfig","jobService","JobType","JobTypeDetails","JobTypeStatus",function(e,t,n,i,r,o,a,s,c,l){var u=function(e,t,n,i,r,o,a){return{page:e,page_size:t?t:1e3,started:n,ended:i,name:r,category:o,order:a?a:["title","version"]}},d=function(e,t,n,i){return{page:e,page_size:t?t:1e3,started:n,ended:i}};return{getJobTypes:function(e){e=e||u();var t=n(o.getUrlPrefix("job-types")+"job-types/",e),i=r.newPoller(t,o.pollIntervals.jobTypes);return i.promise.then(null,null,function(e){return e.$resolved?(e.results=s.transformer(e.results),e):(i.stop(),e)})},getJobTypesOnce:function(n){n=n||u();var i=t.defer();return e({url:o.getUrlPrefix("job-types")+"job-types/",method:"GET",params:n}).success(function(e){e.results=s.transformer(e.results),i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},getJobTypeStatus:function(e){e=e||d();var t=n(o.getUrlPrefix("job-types")+"job-types/status/",e),i=r.newPoller(t,o.pollIntervals.jobTypeStatus);return i.promise.then(null,null,function(e){return e.$resolved?e.results=l.transformer(e.results):i.stop(),e})},getJobTypeStatusOnce:function(n){var i=t.defer();return n=n||d(),e({url:o.getUrlPrefix("job-types")+"job-types/status/",method:"GET",params:n}).success(function(e){e.results=l.transformer(e.results),i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},getJobTypeDetails:function(n){var i=t.defer();return e.get(o.getUrlPrefix("job-types")+"job-types/"+n+"/").success(function(e){i.resolve(c.transformer(e))}).error(function(e){i.reject(e)}),i.promise},updateJobType:function(n){var i=function(e){return{error_mappings:e.error_mappings,is_paused:e.is_paused}},r=i(n),a=t.defer();return e({url:o.getUrlPrefix("job-types")+"job-types/"+n.id+"/",method:"PATCH",data:r}).success(function(e){a.resolve(c.transformer(e))}).error(function(e){a.reject(e)}),a.promise}}}])}(),function(){"use strict";angular.module("scaleApp").controller("loadController",["$scope","$location","scaleService","stateService","navService","loadService","uiGridConstants","scaleConfig","subnavService","QueueStatus","gridFactory",function(e,t,n,i,r,o,a,s,c,l,u){var d=this;d.loading=!0,d.queueStatusError=null,d.queueStatusErrorStatus=null,d.totalQueued=0,d.subnavLinks=s.subnavLinks.load,c.setCurrentPath("load/queued");var p=i.getJobsParams();d.getPage=function(e,t){d.loading=!0,o.getQueueStatus(e-1,t).then(function(e){for(var t=[],n=0;n<d.gridOptions.paginationPageSize;n++)t.push(e.jobs[n]);d.gridOptions.minRowsToShow=t.length,d.gridOptions.virtualizationThreshold=t.length,d.gridOptions.data=t})["catch"](function(e){d.status="Unable to load queue status: "+e.message,console.error(d.status)})["finally"](function(){d.loading=!1})};var f=function(){d.gridOptions=u.defaultGridOptions(),d.gridOptions.enableSorting=!1,d.gridOptions.columnDefs=[{field:"job_type.title",displayName:"Job Type",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }}</div>'},{field:"job_type.version",displayName:"Version",enableFiltering:!1},{field:"highest_priority",enableFiltering:!1},{field:"longestQueued",displayName:"Duration of Longest Queued Job",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'},{field:"count",enableFiltering:!1}],d.gridOptions.data=[],d.gridOptions.onRegisterApi=function(n){d.gridApi=n,n.selection.on.rowSelectionChanged(e,function(e){i.setJobsParams({job_type_id:e.entity.job_type.id,status:"QUEUED",page:p.page,page_size:p.page_size,order:p.order}),t.path("/jobs")}),d.gridApi.pagination.on.paginationChanged(e,function(e,t){d.getPage(e,t)})},o.getQueueStatus(0,d.gridOptions.paginationPageSize).then(null,null,function(e){e.$resolved?(d.gridOptions.minRowsToShow=e.results.length,d.gridOptions.virtualizationThreshold=e.results.length,d.gridOptions.data=e.results,d.gridOptions.totalItems=e.results.length,d.totalQueued=_.sum(e.results,"count"),console.log("queue status updated")):(e.statusText&&""!==e.statusText&&(d.queueStatusErrorStatus=e.statusText),d.queueStatusError="Unable to retrieve queue status."),d.loading=!1}),r.updateLocation("load")};f()}])}(),function(){"use strict";angular.module("scaleApp").controller("loadDepthController",["$scope","$location","navService","scaleConfig","subnavService",function(e,t,n,i,r){var o=this;o.subnavLinks=i.subnavLinks.load,r.setCurrentPath("load/depth"),o.loading=!1;var a=function(){n.updateLocation("load")};a()}])}(),function(){"use strict";angular.module("scaleApp").controller("queueRunningController",["$scope","$location","scaleService","stateService","navService","jobService","gridFactory","uiGridConstants","scaleConfig","subnavService",function(e,t,n,i,r,o,a,s,c,l){var u=this;u.loading=!0,u.runningJobsError=null,u.runningJobsErrorStatus=null,u.totalRunning=0,u.subnavLinks=c.subnavLinks.load,l.setCurrentPath("load/running");var d=i.getJobsParams();u.getPage=function(e,t){u.loading=!0,o.getRunningJobsOnce(e-1,t).then(function(e){for(var t=[],n=0;n<u.gridOptions.paginationPageSize;n++)t.push(e.results[n]);u.gridOptions.minRowsToShow=t.length,u.gridOptions.virtualizationThreshold=t.length,u.gridOptions.data=t})["catch"](function(e){u.status="Unable to load queue running status: "+e.message,console.error(u.status)})["finally"](function(){u.loading=!1})};var p=function(){u.gridOptions=a.defaultGridOptions(),u.gridOptions.enableSorting=!1,u.gridOptions.columnDefs=[{field:"title",displayName:"Job Type",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.getIcon()"></span> {{ row.entity.job_type.title }}</div>'},{field:"job_type.version",displayName:"Version",enableFiltering:!1},{field:"count",displayName:"Number of Jobs",enableFiltering:!1},{field:"longestRunning",displayName:"Duration of Longest Running Job",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'}],u.gridOptions.data=[],u.gridOptions.onRegisterApi=function(n){u.gridApi=n,n.selection.on.rowSelectionChanged(e,function(e){i.setJobsParams({job_type_id:e.entity.job_type.id,status:"RUNNING",page:d.page,page_size:d.page_size,order:d.order}),t.path("/jobs")}),u.gridApi.pagination.on.paginationChanged(e,function(e,t){u.getPage(e,t)})},o.getRunningJobs(0,u.gridOptions.paginationPageSize).then(null,null,function(e){e.$resolved?(u.gridOptions.minRowsToShow=e.results.length,u.gridOptions.virtualizationThreshold=e.results.length,u.gridOptions.data=e.results,u.gridOptions.totalItems=e.results.length,u.totalRunning=_.sum(e.results,"count"),console.log("running jobs updated")):(e.statusText&&""!==e.statusText&&(u.runningJobsErrorStatus=e.statusText),u.runningJobsError="Unable to retrieve running jobs."),u.loading=!1}),r.updateLocation("load")};p()}])}(),function(){"use strict";angular.module("scaleApp").factory("QueueStatus",["scaleConfig","scaleService","JobType",function(e,t,n){var i=function(e,t,i,r){this.job_type=n.transformer(e),this.count=t,this.longest_queued=i,this.highest_priority=r};return i.prototype={getIcon:function(){return this.job_type.icon_code?'<i class="fa">&#x'+this.job_type.icon_code+"</i>":'<i class="fa">&#x'+e.defaultIconCode+"</i>"},getDuration:function(){return t.calculateDuration(this.longest_queued,moment.utc().toISOString())}},i.build=function(e){return e?new i(e.job_type,e.count,e.longest_queued,e.highest_priority):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").service("loadService",["$http","$q","$resource","scaleConfig","poller","pollerFactory","QueueStatus",function(e,t,n,i,r,o,a){var s=function(e,t,n,i,r,o,a,s,c,l){return{started:n,ended:i,job_type_id:a,job_type_name:s,job_type_category:c,page_size:1e3,url:l}},c=function(e,t,n,i,r,o,a,s){return{started:e,ended:t,job_status:n,job_ids:job_ids,job_type_ids:i,job_type_names:r,job_type_categories:o,priority:a,url:s}};return{getQueueStatus:function(e,t){var r={page_number:e,page_size:t},s=n(i.getUrlPrefix("queue")+"queue/status/",r),c=o.newPoller(s,i.pollIntervals.queueStatus);return c.promise.then(null,null,function(e){return e.$resolved?e.results=a.transformer(e.results):c.stop(),e})},getQueueStatusOnce:function(){var n=t.defer();return e.get(i.getUrlPrefix("queue")+"queue/status/").success(function(e){e.results=a.transformer(e.results),n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},requeueJobs:function(n){n=n||c(),n.url=n.url?n.url:i.getUrlPrefix("queue")+"queue/requeue-jobs/";var r=t.defer();return e.post(n.url,n).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getJobLoad:function(e){e=e||s(),e.url=e.url?e.url:i.getUrlPrefix("load")+"load/";var t=n(e.url,e),r=o.newPoller(t,i.pollIntervals.jobLoad);return r.promise.then(null,null,function(e){return e.$resolved||r.stop(),e})},getJobLoadOnce:function(n){n=n||s();var r=t.defer();return e({url:n.url?n.url:i.getUrlPrefix("load")+"load/",method:"GET",params:n}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}])}(),function(){"use strict";angular.module("scaleApp").controller("jobDetailController",["$scope","$rootScope","$location","$routeParams","$uibModal","stateService","navService","jobService","jobExecutionService","nodeService","loadService","scaleConfig","subnavService","userService","scaleService","toastr",function(e,t,n,i,r,o,a,s,c,l,u,d,p,f,g,m){var h=this;h.job={},h.jobId=i.id,h.subnavLinks=d.subnavLinks.jobs,p.setCurrentPath("jobs"),h.loadingJobDetail=!1,h.latestExecution=null,h.executionLog=null,h.executionDetails=null,h.selectedExecutionDetailValues=null,h.timeline=[],h.readonly=!0,h.jobErrorCreated="",h.jobErrorLastModified="",h.lastStatusChange="",h.supersededStatus="",h.triggerOccurred="",h.showLog=function(t){c.getJobExecutionDetails(t.id).then(function(e){h.selectedExecutionLog=e});var n=r.open({animation:!0,templateUrl:"showLog.html",scope:e,windowClass:"log-modal-window"});n.result.then(function(){},function(){_.forEach(o.getJobExecutionLogPoller(),function(e){e.stop()})})},h.showExecutionDetails=function(t){c.getJobExecutionDetails(t).then(function(t){h.selectedExecutionDetails=t,h.selectedExecutionDetailValues=_.pairs(t),r.open({animation:!0,templateUrl:"showExecutionDetails.html",scope:e,size:"lg"})})["catch"](function(e){console.log(e)})},h.requeueJob=function(e){h.loading=!0,u.requeueJobs({job_ids:[e]}).then(function(t){m.success("Requeued Job"),h.job.status=t.job_status,v(e)})["catch"](function(e){m.error("Requeue request failed"),console.log(e)})["finally"](function(){h.loading=!1})},h.cancelJob=function(e){h.loading=!0,h.actionClicked=!0,h.loading=!0;var t=e.status;e.status="CANCEL",s.updateJob(e.id,{status:"CANCELED"}).then(function(){m.success("Job Canceled"),e.status="CANCELED"})["catch"](function(n){m.error(n),console.log(n),e.status=t})["finally"](function(){h.loading=!1})},h.calculateFileSize=function(e){return g.calculateFileSizeFromBytes(e)};var v=function(e){h.loadingJobDetail=!0,s.getJobDetail(e).then(function(e){h.job=e,h.timeline=y(e),h.latestExecution=e.getLatestExecution(),h.jobErrorCreated=e.error?moment.utc(e.error.created).toISOString():"",h.lastStatusChange=e.last_status_change?moment.duration(moment.utc(e.last_status_change).diff(moment.utc())).humanize(!0):"",h.supersededChange=e.superseded?moment.duration(moment.utc(e.superseded).diff(moment.utc())).humanize(!0):"",h.triggerOccurred=e.event.occurred?moment.duration(moment.utc(e.event.occurred).diff(moment.utc())).humanize(!0):"",h.inputs=e.inputs,h.outputs=e.outputs})["catch"](function(e){console.log(e)})["finally"](function(){h.loadingJobDetail=!1})},y=function(e){var t=[];return t.push({taskName:"Created",started:e.created?moment.utc(e.created).toDate():e.created,ended:e.queued?moment.utc(e.queued).toDate():e.queued}),t.push({taskName:"Queued",started:e.queued?moment.utc(e.queued).toDate():e.queued,ended:e.started?moment.utc(e.started).toDate():e.started}),t.push({taskName:"Executed",started:e.started?moment.utc(e.started).toDate():e.started,ended:e.ended?moment.utc(e.ended).toDate():e.ended}),t},b=function(){a.updateLocation("jobs");var e=f.getUserCreds();h.readonly=!(e&&e.is_admin),v(h.jobId)};b()}])}(),function(){"use strict";angular.module("scaleApp").controller("jobExecutionDetailController",["$scope","$location","$routeParams","navService","jobExecutionService","nodeService","scaleConfig","subnavService",function(e,t,n,i,r,o,a,s){var c=this;c.jobExecution={},c.jobExecutionId=n.id,c.loading=!0,c.subnavLinks=a.subnavLinks.jobs,s.setCurrentPath("jobs/runs");var l=function(){r.getJobExecutionDetail(id).then(function(e){c.jobExecution=e})["catch"](function(e){console.log(e)})["finally"](function(){c.loading=!1})},u=function(){l(n.id),i.updateLocation("jobs")};u()}])}(),function(){"use strict";angular.module("scaleApp").controller("jobExecutionsController",["$scope","$location","navService","stateService","gridFactory","userService","jobExecutionService","jobTypeService","uiGridConstants","scaleConfig","subnavService",function(e,t,n,i,r,o,a,s,c,l,u){u.setCurrentPath("jobs");var d=this,p={name:"VIEW ALL",title:"VIEW ALL",version:"",id:0};d.jobExecutionsParams=i.getJobExecutionsParams(),d.stateService=i,d.loading=!0,d.readonly=!0,d.jobTypeValues=[p],d.jobExecution=null,d.selectedJobType=d.jobExecutionsParams.job_type_id?d.jobExecutionsParams.job_type_id:p,d.jobStatusValues=l.jobStatus,d.selectedJobStatus=d.jobExecutionsParams.status||d.jobStatusValues[0],d.subnavLinks=l.subnavLinks.jobs,d.actionClicked=!1,d.lastModifiedStart=moment.utc(d.jobExecutionsParams.started).toDate(),d.lastModifiedStartPopup={opened:!1},d.openLastModifiedStartPopup=function(e){e.stopPropagation(),d.lastModifiedStartPopup.opened=!0},d.lastModifiedStop=moment.utc(d.jobExecutionsParams.ended).toDate(),d.lastModifiedStopPopup={opened:!1},d.openLastModifiedStopPopup=function(e){e.stopPropagation(),d.lastModifiedStopPopup.opened=!0},d.dateModelOptions={timezone:"+000"},d.gridOptions=r.defaultGridOptions(),d.gridOptions.paginationCurrentPage=d.jobExecutionsParams.page||1,d.gridOptions.paginationPageSize=d.jobExecutionsParams.page_size||d.gridOptions.paginationPageSize,d.gridOptions.data=[];var f=!!d.jobExecutionsParams.job_type_id,g=!!d.jobExecutionsParams.status,m=!!d.jobExecutionsParams.order;d.colDefs=[{field:"job_type",displayName:"Job Type",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>'},{field:"created",displayName:"Created (Z)",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'},{field:"last_modified",displayName:"Last Modified (Z)",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'},{field:"duration",enableFiltering:!1,enableSorting:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'},{field:"status",width:150,cellTemplate:'<div class="ui-grid-cell-contents"><div class="pull-right"><button ng-show="((!grid.appScope.vm.readonly) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.vm.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job"><i class="fa fa-repeat"></i></button> <button ng-show="!grid.appScope.vm.readonly && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.vm.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job"><i class="fa fa-ban"></i></button></div> {{ row.entity.status }}</div>',filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobStatus"><option ng-selected="{{ grid.appScope.vm.jobStatusValues[$index] == grid.appScope.vm.selectedJobStatus }}" value="{{ grid.appScope.vm.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'},{field:"id",displayName:"Log",enableFiltering:!1,sortable:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.vm.showLog(row.entity)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'}],d.getJobExecutions=function(){a.getJobExecutions(d.jobExecutionsParams).then(function(e){d.gridOptions.totalItems=e.count,d.gridOptions.minRowsToShow=e.results.length,d.gridOptions.virtualizationThreshold=e.results.length,d.gridOptions.data=e.results})["catch"](function(e){console.log(e)})["finally"](function(){d.loading=!1})},d.getJobTypes=function(){s.getJobTypesOnce().then(function(e){d.jobTypeValues.push(e.results),d.jobTypeValues=_.flatten(d.jobTypeValues),d.selectedJobType=_.find(d.jobTypeValues,{id:d.jobExecutionsParams.job_type_id})||p,d.getJobExecutions()})["catch"](function(){d.loading=!1})},d.showLog=function(t){d.actionClicked=!0,d.jobExecution=t,$uibModal.open({animation:!0,templateUrl:"showLog.html",scope:e,size:"lg",windowClass:"log-modal-window"})},d.filterResults=function(){i.setJobsParams(d.jobExecutionsParams),d.loading=!0,d.getJobs()},d.updateColDefs=function(){d.gridOptions.columnDefs=r.applySortConfig(d.colDefs,d.jobExecutionsParams)},d.updateJobOrder=function(e){d.jobExecutionsParams.order=e.length>0?e:null,m=e.length>0,d.filterResults()},d.updateJobType=function(e){e.id!==d.jobExecutionsParams.job_type_id&&(d.jobExecutionsParams.page=1),d.jobExecutionsParams.job_type_id=0===e.id?null:e.id,d.jobExecutionsParams.page_size=d.gridOptions.paginationPageSize,d.loading||d.filterResults()},d.updateJobStatus=function(e){e!=d.jobExecutionsParams.status&&(d.jobExecutionsParams.page=1),d.jobExecutionsParams.status="VIEW ALL"===e?null:e,d.jobExecutionsParams.page_size=d.gridOptions.paginationPageSize,d.loading||d.filterResults()},d.gridOptions.onRegisterApi=function(n){d.gridApi=n,d.gridApi.selection.on.rowSelectionChanged(e,function(e){d.actionClicked?d.actionClicked=!1:t.path("/jobs/job/"+e.entity.id)}),d.gridApi.pagination.on.paginationChanged(e,function(e,t){d.jobExecutionsParams.page=e,d.jobExecutionsParams.page_size=t,d.filterResults()}),d.gridApi.core.on.sortChanged(e,function(e,t){_.forEach(d.gridApi.grid.columns,function(e){e.colDef.sort=e.sort}),i.setJobsColDefs(d.gridApi.grid.options.columnDefs);var n=[];_.forEach(t,function(e){n.push("desc"===e.sort.direction?"-"+e.field:e.field)}),d.updateJobOrder(n)})},d.initialize=function(){i.setJobExecutionsParams(d.jobExecutionsParams),d.updateColDefs();var e=o.getUserCreds();d.readonly=!(e&&e.is_admin),d.getJobTypes(),n.updateLocation("jobs/executions")},d.initialize(),e.$watch("vm.selectedJobType",function(e){parseInt(e)&&(e=_.find(d.jobTypeValues,{id:parseInt(e)})),e&&(d.loading?f&&d.updateJobType(e):(f=!angular.equals(e,p),d.updateJobType(e)))}),e.$watch("vm.selectedJobStatus",function(e){d.loading?g&&d.updateJobStatus(e):(g="VIEW ALL"!==e,d.updateJobStatus(e))}),e.$watch("vm.lastModifiedStart",function(e){d.loading||(d.jobExecutionsParams.started=e.toISOString(),d.filterResults())}),e.$watch("vm.lastModifiedStop",function(e){d.loading||(d.jobExecutionsParams.ended=e.toISOString(),d.filterResults())}),e.$watchCollection("vm.stateService.getJobsColDefs()",function(e,t){angular.equals(e,t)||(d.colDefs=e,d.updateColDefs())}),e.$watchCollection("vm.stateService.getJobsParams()",function(e,t){angular.equals(e,t)||(d.jobExecutionsParams=e,d.updateColDefs())})}])}(),function(){"use strict";angular.module("scaleApp").controller("jobTypesController",["$rootScope","$scope","$routeParams","$location","hotkeys","scaleService","navService","stateService","jobTypeService","scaleConfig","subnavService","nodeService","localStorage","userService",function(e,t,n,i,r,o,a,s,c,l,u,d,p,f){var g=this;g.containerStyle="",g.requestedJobTypeId=parseInt(n.id),g.jobTypes=[],g.jobTypeIds=[],g.jobTypeCount=0,g.activeJobTypeDetails={},g.activeJobTypeInterfaceValues=[],g.activeJobTypeErrors=[],g.activeJobTypeStats={},g.jobTypesParams=s.getJobTypesParams(),g.showJobTypeErrors=!1,g.loading=!0,g.activeJobType=null,g.healthData6={},g.healthData12={},g.healthData24={},g.activityIcon='<i class="fa fa-pulse">&#x'+l.activityIconCode+"</i>",g.jobDetailsClass="hidden",g.pauseBtnClass="fa-pause",g.user=f.getUserCreds(),g.subnavLinks=l.subnavLinks.jobs,u.setCurrentPath("jobs/types"),t.$watchCollection("vm.jobTypesParams",function(e){s.setJobTypesParams(e)}),g.viewDetails=function(e){g.activeJobType=_.find(g.jobTypes,"id",e),g.activeJobType.created=m(g.activeJobType.created),g.activeJobType.lastModified=m(g.activeJobType.lastModified),i.path("jobs/types/"+e),v(g.activeJobType.id),g.jobDetailsClass="visible"},g.togglePause=function(){g.activeJobType.is_paused=!g.activeJobType.is_paused,g.activeJobTypeDetails.is_paused=g.activeJobType.is_paused,g.loading=!0,c.updateJobType(g.activeJobTypeDetails).then(function(e){g.activeJobTypeDetails=e,g.pauseBtnClass=g.getPauseButtonClass(g.activeJobTypeDetails.is_paused),g.loading=!1})["catch"](function(e){console.log(e),toastr.error(e),g.loading=!1})},g.getPauseButtonClass=function(e){return e?"fa-play":"fa-pause"},g.getJobTypeListItemClass=function(e){return e.is_paused?"paused":""};var m=function(e){return moment.utc(e).toISOString()},h=function(){c.getJobTypesOnce().then(function(e){g.jobTypes=e.results,g.jobTypeIds=_.pluck(g.jobTypes,"id"),g.jobTypeCount=e.count,g.requestedJobTypeId?g.viewDetails(g.requestedJobTypeId):g.loading=!1,r.bindTo(t).add({combo:"ctrl+up",description:"Previous Job Type",callback:function(){if(g.activeJobType){var e=_.indexOf(g.jobTypeIds,g.activeJobType.id);e>0&&g.viewDetails(g.jobTypeIds[e-1])}}}).add({combo:"ctrl+down",description:"Next Job Type",callback:function(){if(g.activeJobType){var e=_.indexOf(g.jobTypeIds,g.activeJobType.id);e<g.jobTypeIds.length-1&&g.viewDetails(g.jobTypeIds[e+1])}}})})["catch"](function(e){console.log(e),g.loading=!1})},v=function(e){g.loading=!0,c.getJobTypeDetails(e).then(function(e){g.activeJobTypeDetails=e,g.activeJobTypeInterfaceValues=_.pairs(e.job_type_interface),g.pauseBtnClass=g.getPauseButtonClass(g.activeJobTypeDetails.is_paused),g.activeJobTypeErrors=[],g.showJobTypeErrors=_.keys(e.error_mapping.exit_codes).length>0,g.showJobTypeErrors&&_.forEach(e.error_mapping.exit_codes,function(t){var n=_.find(e.errors,"name",t),i=_.invert(e.error_mapping.exit_codes)[t];g.activeJobTypeErrors.push({code:i,data:n})});var t=e.getPerformance(),n=e.getFailures();g.activeJobTypeStats=t,g.healthData6={gaugeData:t.hour6.rate,donutData:n.hour6},g.healthData12={gaugeData:t.hour12.rate,donutData:n.hour12},g.healthData24={gaugeData:t.hour24.rate,donutData:n.hour24}})["catch"](function(e){console.log(e)})["finally"](function(){g.loading=!1})},y=function(){g.jobTypesParams=s.getJobTypesParams(),h(),a.updateLocation("jobs")};y(),angular.element(document).ready(function(){var e=o.getViewportSize(),t=l.headerOffset,n=e.height-t;g.containerStyle="height: "+n+"px; max-height: "+n+"px;"})}])}(),function(){"use strict";angular.module("scaleApp").controller("jobTypesFailureRatesController",["$scope","$location","scaleConfig","stateService","scaleService","subnavService","jobTypeService","metricsService","gridFactory","JobType","toastr","moment",function(e,t,n,i,r,o,a,s,c,l,u,d){var p=this,f={name:"VIEW ALL",title:"VIEW ALL",version:"",id:0};p.jobTypesParams=i.getJobTypesFailureRatesParams();var g=[],m=d.utc().subtract(30,"days").startOf("d").toISOString(),h=d.utc().endOf("d").toISOString(),v=!!p.jobTypesParams.name;p.stateService=i,p.scaleService=r,p.loading=!0,p.dates=[],p.performanceData=[],p.jobTypeValues=[f],p.selectedJobType=null,p.sortOrders={twentyfour_hours:{system:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},algorithm:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},data:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},total:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},errorTotal:{direction:p.jobTypesParams.order||"desc",icon:"hidden"}},fortyeight_hours:{system:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},algorithm:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},data:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},total:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},errorTotal:{direction:p.jobTypesParams.order||"desc",icon:"hidden"}},thirty_days:{system:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},algorithm:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},data:{direction:p.jobTypesParams.order||"desc",
icon:"hidden"},total:{direction:p.jobTypesParams.order||"desc",icon:"hidden"},errorTotal:{direction:p.jobTypesParams.order||"desc",icon:"hidden"}}},p.currSortField="",p.currSortErrorType="",p.subnavLinks=n.subnavLinks.jobs,o.setCurrentPath("jobs/failure-rates");var y=[{field:"job_type",displayName:"Job Type",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>',width:"16%",enableSorting:!1},{field:"twentyfour_hours",displayName:"24 Hours",enableSorting:!1,enableFiltering:!1,width:"28%",headerCellTemplate:"gridHeader.html",cellTemplate:"gridRow.html"},{field:"fortyeight_hours",displayName:"48 Hours",enableSorting:!1,enableFiltering:!1,width:"28%",headerCellTemplate:"gridHeader.html",cellTemplate:"gridRow.html"},{field:"thirty_days",displayName:"30 Days",enableSorting:!1,enableFiltering:!1,width:"28%",headerCellTemplate:"gridHeader.html",cellTemplate:"gridRow.html"}];p.gridOptions=c.defaultGridOptions(),p.gridOptions.columnDefs=y,p.gridOptions.data=[],p.gridOptions.onRegisterApi=function(n){e.gridApi=n,e.gridApi.selection.on.rowSelectionChanged(e,function(n){e.actionClicked?e.actionClicked=!1:e.$apply(function(){t.path("/jobs/types/"+n.entity.job_type.id)})})},p.setStyle=function(e,t){var n=(e[t]/e.total).toFixed(2),i=n>=.5?"#fff":"#000",r="system"===t?"103, 0, 13":"algorithm"===t?"203, 24, 29":"241, 105, 19";return"background: rgba("+r+", "+n+"); color: "+i},p.failRateStyle=function(e,t){var n=(e/t*100).toFixed(0);return n>0?"width: "+n+"%":"display: none"},p.getPercentageOfTotal=function(e,t){return 0===t?"0%":(e/t*100).toFixed(0)+"%"},p.filterResults=function(e,n){i.setJobTypesFailureRatesParams(p.jobTypesParams),_.forEach(_.pairs(p.jobTypesParams),function(e){t.search(e[0],e[1])}),e||(p.gridOptions.data=[],p.loading=!0,T(n))},p.updateJobType=function(e){p.jobTypesParams.name="VIEW ALL"===e.name?null:e.name,p.jobTypesParams.version="VIEW ALL"===e.name?null:e.version,p.loading||p.filterResults(!1,!1)},p.sortBy=function(t,n,i){i=i||p.sortOrders[n][t].direction,p.sortOrders[p.currSortField][p.currSortErrorType].icon="hidden",p.gridOptions.data=_.sortByOrder(p.performanceData,function(e){return"errorTotal"===t?e[n].total>0?e[n].errorTotal/e[n].total:0:e[n][t]},i),p.currSortErrorType=t,p.currSortField=n,p.jobTypesParams.order=i,p.jobTypesParams.orderField=n,p.jobTypesParams.orderErrorType=t,i?(p.sortOrders[n][t].icon="desc"===i?"fa-caret-down":"fa-caret-up",p.sortOrders[n][t].direction="desc"===i?"asc":"desc"):(p.sortOrders[n][t].icon="desc"===p.sortOrders[n][t].direction?"fa-caret-down":"fa-caret-up",p.sortOrders[n][t].direction="desc"===p.sortOrders[n][t].direction?"asc":"desc"),p.filterResults(!0),e.gridApi.core.refresh()};var b=function(e,t){var n=[];return _.forEach(e,function(e){var i=_.filter(e,function(e){var n=d.utc(e.date,"YYYY-MM-DD");if(d.utc().diff(d.utc(n),"d")<=t)return e});n.push(i)}),n},S=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a={system:_.sum(_.map(_.filter(n,{id:t}),"value")),algorithm:_.sum(_.map(_.filter(i,{id:t}),"value")),data:_.sum(_.map(_.filter(r,{id:t}),"value")),total:_.sum(_.map(_.filter(o,{id:t}),"value"))};return a.errorTotal=a.system+a.algorithm+a.data,a},T=function(e){p.performanceData=[],p.jobTypeValues=[f],i.setJobTypesFailureRatesParams(p.jobTypesParams),a.getJobTypesOnce().then(function(t){g=p.jobTypesParams.name&&p.jobTypesParams.version?_.filter(t.results,{name:p.jobTypesParams.name,version:p.jobTypesParams.version}):_.cloneDeep(t.results),p.jobTypeValues.push(t.results),p.jobTypeValues=_.flatten(p.jobTypeValues),p.selectedJobType=_.find(p.jobTypeValues,{name:p.jobTypesParams.name,version:p.jobTypesParams.version})||f,p.gridOptions.totalItems=t.count;var n={page:null,page_size:null,started:m,ended:h,choice_id:p.selectedJobType.id>0?[p.selectedJobType.id]:_.map(g,"id"),column:["error_system_count","error_algorithm_count","error_data_count","total_count"],group:null,dataType:"job-types"};s.getPlotData(n).then(function(t){if(t.results.length>0){var n=_.map(t.results,"values"),i=b(n,2),r=b(i,1);_.forEach(g,function(e){p.performanceData.push({job_type:l.transformer(e),twentyfour_hours:S(r,e.id),fortyeight_hours:S(i,e.id),thirty_days:S(n,e.id)})}),p.performanceData=_.sortByOrder(p.performanceData,[function(e){return e.twentyfour_hours.total>0?e.twentyfour_hours.errorTotal/e.twentyfour_hours.total:0},"twentyfour_hours.total"],["desc","desc"]),p.gridOptions.minRowsToShow=p.performanceData.length,p.gridOptions.virtualizationThreshold=p.performanceData.length,p.gridOptions.data=p.performanceData,e||(p.currSortField=p.jobTypesParams.orderField||"twentyfour_hours",p.currSortErrorType=p.jobTypesParams.orderErrorType||"errorTotal",p.jobTypesParams.order&&p.jobTypesParams.orderField&&p.jobTypesParams.orderErrorType&&p.sortBy(p.jobTypesParams.orderErrorType,p.jobTypesParams.orderField,p.jobTypesParams.order))}p.loading=!1})["catch"](function(e){p.loading=!1,console.log(e),u.error(e)})})};T(),e.$watch("vm.selectedJobType",function(e,t){angular.equals(e,t)||p.jobTypeValues.length>1&&(p.loading?v&&p.updateJobType(e):(v="VIEW ALL"!==e,p.updateJobType(e)))})}])}(),function(){"use strict";angular.module("scaleApp").controller("jobsController",["$scope","$location","$uibModal","scaleConfig","scaleService","stateService","navService","subnavService","userService","jobService","jobExecutionService","jobTypeService","loadService","gridFactory","toastr","poller",function(e,t,n,i,r,o,a,s,c,l,u,d,p,f,g,m){s.setCurrentPath("jobs");var h=this,v={name:"VIEW ALL",title:"VIEW ALL",version:"",id:0};h.jobsParams=o.getJobsParams(),h.stateService=o,h.loading=!0,h.readonly=!0,h.jobTypeValues=[v],h.jobExecution=null,h.selectedJobType=h.jobsParams.job_type_id?h.jobsParams.job_type_id:v,h.jobStatusValues=i.jobStatus,h.selectedJobStatus=h.jobsParams.status||h.jobStatusValues[0],h.errorCategoryValues=_.map(i.errorCategories,"name"),h.selectedErrorCategory=h.jobsParams.error_category||h.errorCategoryValues[0],h.subnavLinks=i.subnavLinks.jobs,h.actionClicked=!1,h.lastModifiedStart=moment.utc(h.jobsParams.started).toDate(),h.lastModifiedStartPopup={opened:!1},h.openLastModifiedStartPopup=function(e){e.stopPropagation(),h.lastModifiedStartPopup.opened=!0},h.lastModifiedStop=moment.utc(h.jobsParams.ended).toDate(),h.lastModifiedStopPopup={opened:!1},h.openLastModifiedStopPopup=function(e){e.stopPropagation(),h.lastModifiedStopPopup.opened=!0},h.dateModelOptions={timezone:"+000"},h.gridOptions=f.defaultGridOptions(),h.gridOptions.paginationCurrentPage=h.jobsParams.page||1,h.gridOptions.paginationPageSize=h.jobsParams.page_size||h.gridOptions.paginationPageSize,h.gridOptions.data=[];var y=!!h.jobsParams.job_type_id,b=!!h.jobsParams.status,S=!!h.jobsParams.error_category,T=!!h.jobsParams.order;h.colDefs=[{field:"job_type",displayName:"Job Type",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>'},{field:"created",displayName:"Created (Z)",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'},{field:"last_modified",displayName:"Last Modified (Z)",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'},{field:"duration",enableFiltering:!1,enableSorting:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'},{field:"status",width:150,cellTemplate:'<div class="ui-grid-cell-contents"><div class="pull-right"><button ng-show="((!grid.appScope.vm.readonly && !row.entity.is_superseded) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.vm.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job"><i class="fa fa-repeat"></i></button> <button ng-show="!grid.appScope.vm.readonly && !row.entity.is_superseded && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.vm.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job"><i class="fa fa-ban"></i></button></div> {{ row.entity.status }} <span type="button"  ng-if="row.entity.is_superseded" class="label label-info pull-right" tooltip-append-to-body="true" uib-tooltip="Superseded">S</span></div>',filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobStatus"><option ng-selected="{{ grid.appScope.vm.jobStatusValues[$index] == grid.appScope.vm.selectedJobStatus }}" value="{{ grid.appScope.vm.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'},{field:"error.category",width:150,displayName:"Error Category",filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedErrorCategory"><option ng-selected="{{ grid.appScope.vm.errorCategoryValues[$index] == grid.appScope.vm.selectedErrorCategory }}" value="{{ grid.appScope.vm.errorCategoryValues[$index] }}" ng-repeat="error in grid.appScope.vm.errorCategoryValues track by $index">{{ error.toUpperCase() }}</option></select></div>'},{field:"error.title",displayName:"Error",cellTemplate:'<div class="ui-grid-cell-contents"><div uib-tooltip="{{ row.entity.error.description }}" tooltip-append-to-body="true">{{ row.entity.error.title }}</div></div>',width:200,enableFiltering:!1},{field:"id",displayName:"Log",enableFiltering:!1,sortable:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.vm.showLog(row.entity.id)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'}],h.getJobs=function(){l.getJobs(h.jobsParams).then(null,null,function(e){h.loading=!1,e.$resolved?(h.gridOptions.totalItems=e.count,h.gridOptions.minRowsToShow=e.results.length,h.gridOptions.virtualizationThreshold=e.results.length,h.gridOptions.data=e.results,h.gridOptions.paginationCurrentPage=h.jobsParams.page,h.gridOptions.paginationPageSize=h.jobsParams.page_size):console.log(error)})},h.getJobTypes=function(){d.getJobTypesOnce().then(function(e){h.jobTypeValues.push(e.results),h.jobTypeValues=_.flatten(h.jobTypeValues),h.selectedJobType=_.find(h.jobTypeValues,{id:h.jobsParams.job_type_id})||v,h.getJobs()})["catch"](function(){h.loading=!1})},h.showLog=function(t){h.actionClicked=!0,l.getJobDetail(t).then(function(t){h.jobExecution=t.getLatestExecution(),u.getJobExecutionDetails(h.jobExecution.id).then(function(e){h.jobExecution=e}),n.open({animation:!0,templateUrl:"showLog.html",scope:e,windowClass:"log-modal-window"})})},h.requeueJobs=function(e){e||(e=h.jobsParams?h.jobsParams:{started:h.lastModifiedStart.toISOString(),ended:h.lastModifiedStop.toISOString()}),h.actionClicked=!0,h.loading=!0,p.requeueJobs(e).then(function(){g.success("Requeue Successful"),h.getJobs()})["catch"](function(e){g.error("Requeue request failed"),h.loading=!1})},h.cancelJob=function(e){h.actionClicked=!0,h.loading=!0;var t=e.status;e.status="CANCEL",l.updateJob(e.id,{status:"CANCELED"}).then(function(){g.success("Job Canceled"),e.status="CANCELED"})["catch"](function(n){g.error(n),e.status=t})["finally"](function(){h.loading=!1})},h.filterResults=function(){m.stopAll(),o.setJobsParams(h.jobsParams),h.loading=!0,h.getJobs()},h.updateColDefs=function(){h.gridOptions.columnDefs=f.applySortConfig(h.colDefs,h.jobsParams)},h.updateJobOrder=function(e){h.jobsParams.order=e.length>0?e:null,T=e.length>0,h.filterResults()},h.updateJobType=function(e){e.id!==h.jobsParams.job_type_id&&(h.jobsParams.page=1),h.jobsParams.job_type_id=0===e.id?null:e.id,h.jobsParams.page_size=h.gridOptions.paginationPageSize,h.loading||h.filterResults()},h.updateJobStatus=function(e){e!=h.jobsParams.status&&(h.jobsParams.page=1),h.jobsParams.status="VIEW ALL"===e?null:e,h.jobsParams.page_size=h.gridOptions.paginationPageSize,h.loading||h.filterResults()},h.updateErrorCategory=function(e){e!=h.jobsParams.error_category&&(h.jobsParams.page=1),h.jobsParams.error_category="VIEW ALL"===e?null:e,h.jobsParams.page_size=h.gridOptions.paginationPageSize,h.loading||h.filterResults()},h.gridOptions.onRegisterApi=function(n){h.gridApi=n,h.gridApi.selection.on.rowSelectionChanged(e,function(e){h.actionClicked?h.actionClicked=!1:t.path("/jobs/job/"+e.entity.id).search("")}),h.gridApi.pagination.on.paginationChanged(e,function(e,t){h.jobsParams.page=e,h.jobsParams.page_size=t,h.filterResults()}),h.gridApi.core.on.sortChanged(e,function(e,t){_.forEach(h.gridApi.grid.columns,function(e){e.colDef.sort=e.sort}),o.setJobsColDefs(h.gridApi.grid.options.columnDefs);var n=[];_.forEach(t,function(e){n.push("desc"===e.sort.direction?"-"+e.field:e.field)}),h.updateJobOrder(n)})},h.initialize=function(){o.setJobsParams(h.jobsParams),h.updateColDefs();var e=c.getUserCreds();h.readonly=!(e&&e.is_admin),h.getJobTypes(),a.updateLocation("jobs")},h.initialize(),e.$watch("vm.selectedJobType",function(e){parseInt(e)&&(e=_.find(h.jobTypeValues,{id:parseInt(e)})),e&&(h.loading?y&&h.updateJobType(e):(y=!angular.equals(e,v),h.updateJobType(e)))}),e.$watch("vm.selectedJobStatus",function(e){h.loading?b&&h.updateJobStatus(e):(b="VIEW ALL"!==e,h.updateJobStatus(e))}),e.$watch("vm.selectedErrorCategory",function(e){h.loading?S&&h.updateErrorCategory(e):(S="VIEW ALL"!==e,h.updateErrorCategory(e))}),e.$watch("vm.lastModifiedStart",function(e){h.loading||(h.jobsParams.started=e.toISOString(),h.filterResults())}),e.$watch("vm.lastModifiedStop",function(e){h.loading||(h.jobsParams.ended=e.toISOString(),h.filterResults())}),e.$watchCollection("vm.stateService.getJobsColDefs()",function(e,t){angular.equals(e,t)||(h.colDefs=e,h.updateColDefs())}),e.$watchCollection("vm.stateService.getJobsParams()",function(e,t){angular.equals(e,t)||(h.jobsParams=e,h.updateColDefs())})}])}(),function(){"use strict";angular.module("scaleApp").controller("metricsController",["$scope","$location","scaleConfig","scaleService","navService","metricsService","moment",function(e,t,n,i,r,o,a){var s=this,c=null,l=[],u={},d=[],p=[],f=[];s._=_,s.moment=a,s.loadingMetrics=!1,s.chartArr=[],s.chartData=[],s.chartStyle="",s.selectedDataType={},s.inputStartDate=a.utc().subtract(1,"M").toDate(),s.inputEndDate=a.utc().toDate(),s.openInputStart=function(e){e.stopPropagation(),s.inputStartOpened=!0},s.inputStartOpened=!1,s.openInputEnd=function(e){e.stopPropagation(),s.inputEndOpened=!0},s.inputEndOpened=!1,s.dateModelOptions={timezone:"+000"},s.dataTypeFilterText="",s.filtersApplied=[],s.filteredChoices=[],s.filteredChoicesOptions=[],s.selectedMetrics=[],s.columnGroupsOptions=[],s.columns=[],s.groups=[],s.chartTitle="",s.chartDisplay="stacked",s.stackedClass="btn-primary",s.groupedClass="btn-default",s.subchartClass="btn-primary",s.subchartEnabled=!1,s.chartType="bar",s.chartTypeDisplay="Bar",s.barClass="btn-primary",s.areaClass="btn-default",s.lineClass="btn-default",s.splineClass="btn-default",s.scatterClass="btn-default",s.metricsTotal=null,s.getPlotDataParams=function(e){return{page:null,page_size:null,started:e.started,ended:e.ended,choice_id:e.choice_id,column:e.column,group:e.group,dataType:e.dataType.name}},s.resetSelections=function(){s.inputStartDate=a.utc().subtract(1,"M").toDate(),s.inputEndDate=a.utc().toDate(),s.selectedDataType={},s.changeDataTypeSelection()},s.updateChart=function(){if(s.chartData=[],0===s.chartArr.length)c.destroy(),c=null;else{var e=_.after(s.chartArr.length,function(){s.loadingMetrics=!1,s.initChart()});_.forEach(s.chartArr,function(t){var n=s.getPlotDataParams(t);o.getPlotData(n).then(function(n){s.chartData.push({query:t,results:n.results}),e()})["catch"](function(e){s.loadingMetrics=!1,console.log(e),toastr.error(e)})})}},s.addToChart=function(){s.chartArr=[],s.loadingMetrics=!0;var e=[],t=[];_.forEach(s.filtersApplied,function(t){e.push(_.find(s.filteredChoices,{id:parseInt(t)}))}),angular.isArray(s.selectedMetrics)?_.forEach(s.selectedMetrics,function(e){t.push(_.find(s.columns,{name:e}))}):t.push(_.find(s.columns,{name:s.selectedMetrics})),s.chartArr.push({started:s.inputStartDate.toISOString(),ended:s.inputEndDate.toISOString(),choice_id:s.filtersApplied,column:_.pluck(t,"name"),group:null,dataType:s.selectedDataType,filtersApplied:e,selectedMetrics:t}),s.updateChart()},s.deleteFromChart=function(e){_.remove(s.chartArr,function(t){return JSON.stringify(t)===JSON.stringify(e)}),s.updateChart()},s.getFilterOptions=function(e){return _.uniq(_.pluck(s.filteredChoices,e))},s.changeDataTypeSelection=function(){s.filtersApplied=[],s.selectedDataTypeOptions=[],s.dataTypeFilterText="",s.selectedMetrics=[],s.columns=[],s.selectedDataType.name&&""!==s.selectedDataType.name?s.getDataTypeOptions(s.selectedDataType):(s.selectedDataType={},s.getDataTypes())},s.areFiltersApplied=function(){return s.filtersApplied.length>0},s.updateChartDisplay=function(e){s.chartDisplay=e,s.stackedClass="stacked"===e?"btn-primary":"btn-default",s.groupedClass="grouped"===e?"btn-primary":"btn-default",s.initChart()},s.updateChartType=function(e){s.chartType=e,s.chartTypeDisplay=_.capitalize(e),s.barClass="bar"===e?"btn-primary":"btn-default",s.areaClass="area"===e?"btn-primary":"btn-default",s.lineClass="line"===e?"btn-primary":"btn-default",s.splineClass="spline"===e?"btn-primary":"btn-default",s.scatterClass="scatter"===e?"btn-primary":"btn-default",s.initChart()},s.toggleSubchart=function(){s.subchartEnabled=!s.subchartEnabled,s.subchartEnabled?s.subchartClass="btn-primary":s.subchartClass="btn-default"},s.initialize=function(){r.updateLocation("metrics"),s.getDataTypes()},s.getDataTypes=function(){o.getDataTypes().then(function(e){s.availableDataTypes=e.results})["catch"](function(e){console.log(e),toastr.error(e)})},s.getDataType=function(e){o.getDataTypeMetrics(e).then(function(e){s.selectedDataTypeAvailableMetrics=e.metrics})["catch"](function(e){console.log(e)})},s.getDataTypeOptions=function(e){o.getDataTypeOptions(e.name).then(function(e){s.selectedDataTypeOptions=e,_.forEach(e.filters,function(e){s.dataTypeFilterText=0===s.dataTypeFilterText.length?_.capitalize(e.param):s.dataTypeFilterText+", "+_.capitalize(e.param)}),s.filteredChoices=_.sortByOrder(e.choices,["title","version"],["asc","asc"]);var t=[];_.forEach(s.filteredChoices,function(e){t.push({label:e.version?e.title+" "+e.version:e.title,title:e.version?e.title+" "+e.version:e.title,value:e.id})}),s.filteredChoicesOptions=t,s.columns=_.sortByOrder(e.columns,["title"],["asc"]),s.groups=e.groups;var n=[],i=_.pairs(_.groupBy(e.columns,"group"));_.forEach(i,function(e){var t={label:_.find(s.groups,{name:e[0]}).title,children:[]};_.forEach(e[1],function(e){var n={label:e.title,title:e.title,value:e.name};t.children.push(n)}),n.push(t)}),n.unshift({label:"None Selected",title:"None Selected",value:""}),s.columnGroupsOptions=n})["catch"](function(e){console.log(e),toastr.error(e)})},s.initialize(),e.$watch("vm.inputEndDate",function(e){console.log(e)});var g=function(e,t){return t=t||!1,"seconds"===f[0]?i.calculateDuration(a.utc().startOf("d"),a.utc().startOf("d").add(e,"s"),t):"bytes"===f[0]?i.calculateFileSizeFromBytes(e,1):e};s.initChart=function(){p=[],s.metricsTotal=null;var e=[],t=[];_.forEach(l,function(t,n){n>0&&e.push(t[0])}),_.forEach(s.chartData,function(e){t=t.concat(_.pluck(e.query.filtersApplied,"name")),"sum"===e.query.selectedMetrics[0].aggregate&&(s.metricsTotal=s.metricsTotal+_.sum(e.results[0].values,"value"))}),_.forEach(e,function(e){var n=_.find(t,function(t){return t===e});n||p.push(e)}),l=[],d=[],u={};for(var i=a.utc(s.inputEndDate).endOf("d").diff(a.utc(s.inputStartDate.toISOString()).startOf("d"),"d")+1,r=0;r<i;r++)d.push(a.utc(s.inputStartDate.toISOString()).startOf("d").add(r,"d").toDate());_.forEach(s.chartData,function(e){var t=[],n=e.query,i={},r=[];f=_.pluck(n.selectedMetrics,"units"),n.filtersApplied.length>0?_.forEach(e.results,function(e){if(e.values.length>0){var o=_.groupBy(e.values,"id"),s={},c=_.pluck(n.filtersApplied,"id");c.length>1?_.forEach(c,function(e){s[e]=_.get(o,e,[])}):s[n.choice_id[0]]=_.pairs(o)[0][1],_.forEach(_.pairs(s),function(e){t=[],i="undefined"===e[0]?n.filtersApplied[0]:_.find(n.filtersApplied,{id:parseInt(e[0])}),r=e[1],_.forEach(d,function(e){var n=_.find(r,function(t){return a.utc(t.date).isSame(e,"day")});t.push(n?n.value:0)}),t.unshift(i.name+i.id),u[i.name+i.id]=i.version?i.title+" "+i.version:i.title,l.push(t)})}}):_.forEach(e.results,function(e){_.forEach(d,function(n){var i=_.find(e.values,function(e){return a.utc(e.date).isSame(n,"day")});t.push(i?i.value:0)});var i=e.column.title+" for all "+n.dataType.title;t.unshift(i),u.aggregate=i,l.push(t)})}),0===_.sum(_.flatten(l))&&toastr.info("There is no data to display."),d.unshift("x"),l.unshift(d);var o={},m={},h=[];_.forEach(l,function(e){m={},"x"!==e[0]&&(m[e[0]]=s.chartType,"stacked"===s.chartDisplay&&h.push(e[0])),angular.extend(o,m)}),c?(c.groups([h]),c.data.names(u),c.axis.labels({y:_.capitalize(f[0])}),c.load({columns:l,types:o,unload:p})):c=c3.generate({bindto:"#metrics",data:{x:"x",columns:l,types:o,groups:[h],names:u},subchart:{show:s.subchartEnabled},transition:{duration:700},color:{pattern:n.colors.patternD320},axis:{type:"timeseries",x:{tick:{format:function(e){return a.utc(e).toISOString()}},label:{text:"Dates",position:"outer-center"}},y:{tick:{format:function(e){return g(e)}},label:{text:_.capitalize(f[0]),position:"outer-middle"}}}}),s.metricsTotal?(s.metricsTotal=g(s.metricsTotal,!0),s.chartTitle='<div class="label label-success">'+s.metricsTotal.toLocaleString()+"</div> "+s.chartData[0].query.selectedMetrics[0].title+" for "+a.utc(s.inputStartDate).format("DD MMM YYYY")+" - "+a.utc(s.inputEndDate).format("DD MMM YYYY")):s.chartTitle=s.chartData[0].query.selectedMetrics[0].title+" "+a.utc(s.inputStartDate).format("DD MMM YYYY")+" - "+a.utc(s.inputEndDate).format("DD MMM YYYY")},angular.element(document).ready(function(){var e=i.getViewportSize(),t=n.headerOffset,r=e.height-t;s.chartStyle="height: "+r+"px; max-height: "+r+"px;"})}])}(),function(){"use strict";angular.module("scaleApp").service("metricsService",["$http","$q","$resource","scaleConfig",function(e,t,n,i){var r=function(e,t,n,i,r,o,a,s){return console.log(r),{page:e,page_size:t,started:n,ended:i,choice_id:r,column:o,group:a,dataType:s}};return{getDataTypes:function(){var n=t.defer();return e.get(i.getUrlPrefix("metrics")+"metrics/").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},getDataTypeMetrics:function(n){var r=t.defer();return e.get(i.getUrlPrefix("metrics")+"metrics/"+n+"/").success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getDataTypeOptions:function(n){var r=t.defer(),o=i.getUrlPrefix("metrics")+"metrics/"+n+"/";return e.get(o).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getPlotData:function(n){var n=n||r(),o=t.defer();return e({method:"GET",url:i.getUrlPrefix("metrics")+"metrics/"+n.dataType+"/plot-data/",params:n}).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},getGeneratedPlotData:function(e){var n=t.defer(),i={count:28,next:null,previous:null,results:[]},r=moment.utc(e.params.ended).diff(moment.utc(e.params.started),"d")+1;return _.forEach(e.query.selectedMetrics,function(t){for(var n={column:t,min_x:moment.utc(e.params.started).format("YYYY-MM-DD"),max_x:moment.utc(e.params.ended).format("YYYY-MM-DD"),min_y:1,max_y:100,values:[]},o=0;o<r;o++)e.query.filtersApplied.length>1?_.forEach(e.query.filtersApplied,function(t){n.values.push({date:moment.utc(e.params.started).add(o,"d").format("YYYY-MM-DD"),value:Math.floor(1e3*Math.random())+1,id:t.id})}):n.values.push({date:moment.utc(e.params.started).add(o,"d").format("YYYY-MM-DD"),value:Math.floor(1e3*Math.random())+1});i.results.push(n)}),n.resolve(i),n.promise}}}])}(),function(){"use strict";angular.module("scaleApp").controller("ovController",["$rootScope","$scope","navService","nodeService","jobService","jobTypeService","statusService","gaugeFactory","scaleConfig","scaleService","schedulerService","userService",function(e,t,n,i,r,o,a,s,c,l,u,d){var p=this;p.date=new Date,p.jobError=null,p.jobErrorStatus=null,p.loadingJobs=!0,p.loadingNodeHealth=!0,p.jobTypes=[],p.nodes=[],p.nodeHealthError=null,p.nodeHealthErrorStatus="",p.hourValue=3,p.jobData={data:null,status:null},p.jobErrorBreakdown=[],p.status=null,p.statusError=null,p.loadingStatus=!0,p.masterStatus="",p.masterStatusClass="alert-success",p.schedulerStatus="",p.schedulerStatusClass="alert-success",p.memCalc="",p.diskCalc="",p.schedulerIsPaused=!1,p.user=d.getUserCreds(),p.schedulerContainerClass=p.user&&p.user.is_admin?"col-xs-8 col-lg-10":"col-xs-12",p.schedulerBtnClass="fa-pause",p.toggleScheduler=function(){p.schedulerIsPaused=!p.schedulerIsPaused;var e={is_paused:p.schedulerIsPaused};u.updateScheduler(e).then(function(e){p.schedulerStatus=e.is_paused?"Paused":"Running",p.schedulerStatusClass=e.is_paused?"alert-warning":"alert-success",p.schedulerBtnClass=e.is_paused?"fa-play":"fa-pause"})["catch"](function(e){console.log(e)})};var f=function(){t.$broadcast("redrawGrid",p.jobData)},g=function(){o.getJobTypes().then(null,null,function(e){e.$resolved?(p.jobError=null,p.jobData.data=e.results,f()):(e.statusText&&""!==e.statusText&&(p.jobErrorStatus=e.statusText),p.jobError="Unable to retrieve job types."),p.loadingJobs=!1})},m=function(){var e=s.createGauge("cpu","CPU",0,100,180),t=s.createGauge("memory","Memory",0,100,180),n=s.createGauge("disk","Disk",0,100,180);a.getStatus().then(null,null,function(i){i.$resolved?(p.statusError=null,p.status=i,e.redraw(i.getCpuUsage()),t.redraw(i.getMemUsage()),n.redraw(i.getDiskUsage()),p.masterStatus=i.master.is_online?"Master is Online":"Master is Offline",p.masterStatusClass=i.master.is_online?"alert-success":"alert-danger",i.scheduler.is_online?(p.schedulerStatus=i.scheduler.is_paused?"Scheduler is Paused":"Scheduler is Running",p.schedulerStatusClass=i.scheduler.is_paused?"alert-warning":"alert-success",p.schedulerIsPaused=i.scheduler.is_paused,p.schedulerBtnClass=i.scheduler.is_paused?"fa-play":"fa-pause"):(p.schedulerStatus=i.scheduler.is_paused?"Scheduler is Offline; Paused":"Scheduler is Offline",p.schedulerStatusClass="alert-danger",p.schedulerIsPaused=i.scheduler.is_paused,p.schedulerBtnClass=i.scheduler.is_paused?"fa-play":"fa-pause"),i.resources.scheduled.mem&&i.resources.total.mem&&(p.memCalc=l.calculateFileSizeFromMib(i.resources.scheduled.mem)+" / "+l.calculateFileSizeFromMib(i.resources.total.mem)),i.resources.scheduled.disk&&i.resources.total.disk&&(p.diskCalc=l.calculateFileSizeFromMib(i.resources.scheduled.disk)+" / "+l.calculateFileSizeFromMib(i.resources.total.disk))):(p.statusError=i.statusText&&""!==i.statusText?i.statusText:"Unable to retrieve cluster status.",e.redraw(-1),t.redraw(-1),n.redraw(-1),p.masterStatus="Master Status is Unknown",p.masterStatusClass="alert-danger",p.schedulerContainerClass="col-xs-12",p.schedulerStatus="Scheduler Status is Unknown",p.schedulerStatusClass="alert-danger"),p.loadingStatus=!1})},h=function(){a.getStatus(!0).then(null,null,function(e){e.$resolved?(p.nodeHealthError=null,p.nodes=_.filter(e.nodes,{is_active:!0})):(e.statusText&&""!==e.statusText&&(p.nodeHealthErrorStatus=e.statusText),p.nodeHealthError="Unable to retrieve nodes."),p.loadingNodeHealth=!1})};e.$on("jobTypeStatus",function(e,t){p.jobData.status=t,f()});var v=function(){g(),m(),h(),n.updateLocation("overview")};v()}])}(),function(){"use strict";angular.module("scaleApp").factory("Job",["scaleConfig","JobType","scaleService",function(e,t,n){var i=function(n,i,r,o,a,s,c,l,u,d,p,f,g,m,h,v,y,b,_,S,T){this.id=n,this.job_type=t.transformer(i),this.job_type_rev=r,this.event=o,this.error=a,this.status=s,this.priority=c,this.num_exes=l,this.timeout=u,this.max_tries=d,this.cpus_required=p,this.mem_required=f,this.disk_in_required=g,this.disk_out_required=m,this.created=h,this.created_formatted=moment.utc(h).format(e.dateFormats.day_second_utc_nolabel),this.queued=v,this.started=y,this.ended=b,this.last_status_change=_,this.last_modified=S,this.last_modified_formatted=moment.utc(S).format(e.dateFormats.day_second_utc_nolabel),this.is_superseded=T};return i.prototype={getDuration:function(){var e=this.started,t=this.ended?this.ended:moment.utc().toISOString();return n.calculateDuration(e,t)}},i.build=function(e){return e?new i(e.id,e.job_type,e.job_type_rev,e.event,e.error,e.status,e.priority,e.num_exes,e.timeout,e.max_tries,e.cpus_required,e.mem_required,e.disk_in_required,e.disk_out_required,e.created,e.queued,e.started,e.ended,e.last_status_change,e.last_modified,e.is_superseded):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build).filter(Boolean):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("JobDetailEvent",["JobDetailEventRule",function(e){var t=function(t,n,i,r){this.id=t,this.type=n,this.rule=e.transformer(i),this.occurred=r};return t.prototype={},t.build=function(e){return e?new t(e.id,e.type,e.rule,e.occurred):new t},t.transformer=function(e){return angular.isArray(e)?e.map(t.build).filter(Boolean):t.build(e)},t}])}(),function(){"use strict";angular.module("scaleApp").factory("JobDetailEventRule",function(){var e=function(e,t,n,i,r,o){this.id=e,this.type=t,this.is_active=n,this.created=i,this.archived=r,this.last_modified=o};return e.prototype={},e.build=function(t){return t?new e(t.id,t.type,t.is_active,t.created,t.archived,t.last_modified):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("JobDetailInputData",function(){var e=function(e,t,n,i,r){this.name=e,this.value=t,this.file_id=n,this.file_ids=i,this.files=r};return e.prototype={getValue:function(){return this.value?this.value:this.file_id?this.file_id:this.file_ids?this.file_ids:void 0}},e.build=function(t){return t?new e(t.name,t.value,t.file_id,t.file_ids,t.files):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("JobDetailOutputData",function(){var e=function(e,t,n){this.name=e,this.workspace_id=t,this.files=n};return e.prototype={},e.build=function(t){return t?new e(t.name,t.workspace_id,t.files):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("JobDetails",["scaleConfig","JobType","JobExecution","Product","JobDetailInputData","JobDetailOutputData","Recipe","JobDetailEvent","scaleService",function(e,t,n,i,r,o,a,s,c){var l=function(i,c,l,u,d,p,f,g,m,h,v,y,b,S,T,w,j,C,x,k,P,D,A,E,O,J,I,$,R,M,z){this.id=i,this.job_type=t.transformer(c),this.job_type_rev=l,this.event=s.transformer(u),this.error=d,this.status=p,this.priority=f,this.num_exes=g,this.timeout=m,this.max_tries=h,this.cpus_required=v,this.mem_required=y,this.disk_in_required=b,this.disk_out_required=S,this.created=T,this.created_formatted=moment.utc(T).format(e.dateFormats.day_second_utc),this.queued=w,this.queued_formatted=moment.utc(w).format(e.dateFormats.day_second_utc),this.started=j,
this.started_formatted=moment.utc(j).format(e.dateFormats.day_second_utc),this.ended=C,this.ended_formatted=moment.utc(C).format(e.dateFormats.day_second_utc),this.last_status_change=x,this.last_modified=k,this.data={input_data:r.transformer(P.input_data),version:P.version,output_data:o.transformer(P.output_data)},this.results={output_data:o.transformer(D.output_data),version:D.version},this.recipes=_.sortBy(a.transformer(A),["created"]).reverse(),this.job_exes=n.transformer(E),this.inputs=O,this.outputs=J,this.is_superseded=I,this.root_superseded_job=$,this.superseded_job=R,this.superseded_by_job=M,this.superseded=z,this.superseded_formatted=moment.utc(z).format(e.dateFormats.day_second_utc)};return l.prototype={getDuration:function(){var e=this.started,t=this.ended?this.ended:moment.utc().toISOString();return c.calculateDuration(e,t)},getLatestExecution:function(){return this.num_exes>0?this.job_exes[0]:null},getStatusClass:function(){return this.status.toLowerCase()}},l.build=function(e){return e?new l(e.id,e.job_type,e.job_type_rev,e.event,e.error,e.status,e.priority,e.num_exes,e.timeout,e.max_tries,e.cpus_required,e.mem_required,e.disk_in_required,e.disk_out_required,e.created,e.queued,e.started,e.ended,e.last_status_change,e.last_modified,e.data,e.results,e.recipes,e.job_exes,e.inputs,e.outputs,e.is_superseded,e.root_superseded_job,e.superseded_job,e.superseded_by_job,e.superseded):new l},l.transformer=function(e){return angular.isArray(e)?e.map(l.build).filter(Boolean):l.build(e)},l}])}(),function(){"use strict";angular.module("scaleApp").factory("JobExecution",["scaleConfig","Job","Node","moment",function(e,t,n,i){var r=function(e,r,o,a,s,c,l,u,d,p,f,g,m,h,v,y,b,_,S,T,w,j,C,x,k,P,D,A,E,O,J){this.id=e,this.status=r,this.command_arguments=o,this.timeout=a,this.pre_started=s,this.pre_completed=c,this.pre_exit_code=l,this.job_started=u,this.job_completed=d,this.job_exit_code=p,this.post_started=f,this.post_completed=g,this.post_exit_code=m,this.created=h,this.created_formatted=h?i.utc(h).toISOString():h,this.queued=v,this.queued_formatted=v?i.utc(v).toISOString():v,this.started=y,this.started_formatted=y?i.utc(y).toISOString():y,this.ended=b,this.ended_formatted=b?i.utc(b).toISOString():b,this.last_modified=_,this.last_modified_formatted=_?i.utc(_).toISOString():_,this.job=t.transformer(S),this.node=n.transformer(T),this.error=w,this.environment=j,this.cpus_scheduled=C,this.mem_scheduled=x,this.disk_in_scheduled=k,this.disk_out_scheduled=P,this.disk_total_scheduled=D,this.results=A,this.current_stdout_url=E,this.current_stderr_url=O,this.results_manifest=J};return r.prototype={getDuration:function(){return i.utc(this.job_completed).diff(i.utc(this.job_started))},getIcon:function(){return this.job.jobType.iconCode?'<i class="fa">&#x'+this.job.jobType.iconCode+"</i>":'<i class="fa">&#x'+e.defaultIconCode+"</i>"}},r.build=function(e){return e?new r(e.id,e.status,e.command_arguments,e.timeout,e.pre_started,e.pre_completed,e.pre_exit_code,e.job_started,e.job_completed,e.job_exit_code,e.post_started,e.post_completed,e.post_exit_code,e.created,e.queued,e.started,e.ended,e.last_modified,e.job,e.node,e.error,e.environment,e.cpus_scheduled,e.mem_scheduled,e.disk_in_scheduled,e.disk_out_scheduled,e.disk_total_scheduled,e.results,e.current_stdout_url,e.current_stderr_url,e.results_manifest):new r},r.transformer=function(e){return angular.isArray(e)?e.map(r.build).filter(Boolean):r.build(e)},r}])}(),function(){"use strict";angular.module("scaleApp").factory("JobExecutionLog",["scaleConfig","Job","Node",function(e,t,n){var i=function(e,i,r,o,a,s,c,l,u,d,p,f,g,m,h,v,y,b,_,S,T,w){this.id=e,this.status=i,this.command_arguments=r,this.timeout=o,this.exit_code=a,this.created=s,this.queued=c,this.scheduled=l,this.pre_started=u,this.pre_completed=d,this.job_started=p,this.job_completed=f,this.post_started=g,this.post_completed=m,this.ended=h,this.last_modified=v,this.job=t.transformer(y),this.node=n.transformer(b),this.error=_,this.is_finished=S,this.stdout=T,this.stdoutHtml=T?T.replace(new RegExp("\r?\n","g"),"<br />"):"",this.stderr=w};return i.prototype={toHtml:function(e){return e}},i.build=function(e){return e?new i(e.id,e.status,e.command_arguments,e.timeout,e.exit_code,e.created,e.queued,e.scheduled,e.pre_started,e.pre_completed,e.job_started,e.job_completed,e.post_started,e.post_completed,e.ended,e.last_modified,e.job,e.node,e.error,e.is_finished,e.stdout,e.stderr):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build).filter(Boolean):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("JobType",["scaleConfig","JobTypeInterface",function(e,t){var n=function(e,n,i,r,o,a,s,c,l,u,d,p,f,g,m,h,v,y,b,_,S,T,w,j,C,x){this.id=e,this.name=n,this.title=i,this.version=r,this.description=o,this.is_system=a,this.is_long_running=s,this.is_active=c,this.is_operational=l,this.is_paused=u,this.uses_docker=d,this.docker_privileged=p,this.docker_image=f,this.priority=g,this.timeout=m,this.max_tries=h,this.cpus_required=v,this.mem_required=y,this.disk_out_const_required=b,this.disk_out_mult_required=_,this.icon_code=S,this.created=T,this.archived=w,this.paused=j,this.last_modified=C,this.job_type_interface=t.transformer(x)};return n.prototype={toString:function(){return"JobType"},getIcon:function(){return this.icon_code?'<i class="fa fa-fw">&#x'+this.icon_code+"</i>":'<i class="fa fa-fw">&#x'+e.defaultIconCode+"</i>"},getCellText:function(){return this.icon_code?"&#x"+this.icon_code+";":"&#x"+e.defaultIconCode+";"},getCellTitle:function(){return this.title}},n.build=function(e){return e?new n(e.id,e.name,e.title,e.version,e.description,e.is_system,e.is_long_running,e.is_active,e.is_operational,e.is_paused,e.uses_docker,e.docker_privileged,e.docker_image,e.priority,e.timeout,e.max_tries,e.cpus_required,e.mem_required,e.disk_out_const_required,e.disk_out_mult_required,e.icon_code,e.created,e.archived,e.paused,e.last_modified,e["interface"]):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build).filter(Boolean):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").factory("JobTypeDetails",["scaleConfig","JobTypeInterface","JobTypeErrorMapping","JobTypeError","scaleService",function(e,t,n,i,r){var o=function(e,t,o,a,s,c,l,u,d,p,f,g,m,h,v,y,b,_,S,T,w,j,C,x,k,P,D,A,E,O,J,I,$,R,M,z,F,L){this.id=e,this.name=t,this.version=o,this.title=a,this.description=s,this.category=c,this.author_name=l,this.author_url=u,this.is_system=d,this.is_long_running=p,this.is_active=f,this.is_operational=g,this.is_paused=m,this.icon_code=h,this.uses_docker=v,this.docker_privileged=y,this.docker_image=b,this.revision_num=_,this.priority=S,this.timeout=T,this.max_scheduled=w,this.max_tries=j,this.cpus_required=C,this.mem_required=x,this.mem_required_formatted=r.calculateFileSizeFromMib(x),this.shared_mem_required=k,this.shared_mem_required_formatted=r.calculateFileSizeFromMib(k),this.disk_out_const_required=P,this.disk_out_const_required_formatted=r.calculateFileSizeFromMib(P),this.disk_out_mult_required=D,this.created=A,this.archived=E,this.paused=O,this.last_modified=J,this.job_type_interface=I,this.error_mapping=n.transformer($),this.trigger_rule=R,this.errors=i.transformer(M),this.job_counts_6h=z,this.job_counts_12h=F,this.job_counts_24h=L};return o.prototype={getIcon:function(){return this.icon_code?'<i class="fa">&#x'+this.icon_code+"</i>":'<i class="fa">&#x'+e.defaultIconCode+"</i>"},getPerformance:function(){var e=_.where(this.job_counts_6h,{status:"FAILED"}),t=_.where(this.job_counts_12h,{status:"FAILED"}),n=_.where(this.job_counts_24h,{status:"FAILED"}),i=_.find(this.job_counts_6h,"status","COMPLETED")||{count:0},r=_.sum(e,"count"),o=e.length>0?r+i.count:i.count,a=0===o?0:100-(r/o*100).toFixed(2),s=_.find(this.job_counts_12h,"status","COMPLETED")||{count:0},c=_.sum(t,"count"),l=t.length>0?c+s.count:s.count,u=0===l?0:100-(c/l*100).toFixed(2),d=_.find(this.job_counts_24h,"status","COMPLETED")||{count:0},p=_.sum(n,"count"),f=n.length>0?p+d.count:d.count,g=0===f?0:100-(p/f*100).toFixed(2);return{hour6:{rate:a,failed:r,completed:i.count,total:o},hour12:{rate:u,failed:c,completed:s.count,total:l},hour24:{rate:g,failed:p,completed:d.count,total:f}}},getFailures:function(){var e=_.where(this.job_counts_6h,{status:"FAILED"}),t=_.values(_.groupBy(e,"category")),n=_.where(this.job_counts_12h,{status:"FAILED"}),i=_.values(_.groupBy(n,"category")),r=_.where(this.job_counts_24h,{status:"FAILED"}),o=_.values(_.groupBy(r,"category")),a=function(e){var t=[];return _.forEach(e,function(e){_.forEach(e,function(e){t.push({status:e.category,count:e.count})})}),t};return{hour6:a(t),hour12:a(i),hour24:a(o)}}},o.build=function(e){if(e){var t=e["interface"]?e["interface"]:e.job_type_interface;return new o(e.id,e.name,e.version,e.title,e.description,e.category,e.author_name,e.author_url,e.is_system,e.is_long_running,e.is_active,e.is_operational,e.is_paused,e.icon_code,e.uses_docker,e.docker_privileged,e.docker_image,e.revision_num,e.priority,e.timeout,e.max_scheduled,e.max_tries,e.cpus_required,e.mem_required,e.shared_mem_required,e.disk_out_const_required,e.disk_out_mult_required,e.created,e.archived,e.paused,e.last_modified,t,e.error_mapping,e.trigger_rule,e.errors,e.job_counts_6h,e.job_counts_12h,e.job_counts_24h)}return new o},o.transformer=function(e){return angular.isArray(e)?e.map(o.build):o.build(e)},o}])}(),function(){"use strict";angular.module("scaleApp").factory("JobTypeError",["moment","scaleConfig",function(e,t){var n=function(t,n,i,r,o,a,s){this.id=t,this.name=n,this.title=i,this.description=r,this.category=o,this.created=a,this.created_formatted=a?e.utc(a).toISOString():a,this.last_modified=s,this.last_modified_formatted=s?e.utc(s).toISOString():s};return n.prototype={},n.build=function(e){return e?new n(e.id,e.name,e.title,e.description,e.category,e.created,e.last_modified):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build).filter(Boolean):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").factory("JobTypeErrorMapping",function(){var e=function(e,t){this.version=e,this.exit_codes=t};return e.prototype={},e.build=function(t){return t?new e(t.version,t.exit_codes):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("JobTypeInputData",["scaleConfig",function(e){var t=function(e,t,n,i){this.media_types=e,this.required=t,this.type=n,this.name=i};return t.prototype={},t.build=function(e){return e?new t(e.media_types,e.required,e.type,e.name):new t},t.transformer=function(e){return angular.isArray(e)?e.map(t.build):t.build(e)},t}])}(),function(){"use strict";angular.module("scaleApp").factory("JobTypeInterface",["scaleConfig","JobTypeInputData","JobTypeOutputData",function(e,t,n){var i=function(e,i,r,o,a){this.version=e,this.command=i,this.command_arguments=r,this.input_data=t.transformer(o),this.output_data=n.transformer(a)};return i.prototype={getIcon:function(){return this.iconCode?'<i class="fa">&#x'+this.iconCode+"</i>":'<i class="fa">&#x'+e.defaultIconCode+"</i>"}},i.build=function(e){return e?new i(e.version,e.command,e.command_arguments,e.input_data,e.output_data):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build).filter(Boolean):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("JobTypeOutputData",function(){var e=function(e,t,n,i){this.name=e,this.type=t,this.required=n,this.media_type=i};return e.prototype={},e.build=function(t){return t?new e(t.name,t.type,t.required,t.media_type):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("JobTypeStatus",["scaleConfig","JobType","JobExecution",function(e,t,n){var i=function(e,n){this.job_type=t.transformer(e),this.job_counts=n,this.has_running=_.find(n,"status","RUNNING"),this.description=this.getPerformance().rateDescription};return i.prototype={toString:function(){return"JobTypeStatus"},getPerformance:function(){var e=_.sortByOrder(_.filter(this.job_counts,{status:"FAILED"}),["count"],["desc"]),t=_.find(this.job_counts,"status","COMPLETED")||{count:0},n=_.sum(e,"count"),i=e.length>0?e[0].category:"",r=e.length>0?n+t.count:t.count,o=0===r?0:100-(n/r*100).toFixed(2),a="success";return o<=30&&r>0?a="error":o>30&&o<=60&&r>0?a="warning":0!==r||this.has_running||(a="z_inactive"),{rate:o,rateDescription:a,failed:n,failedCategory:i,completed:t.count,total:r}},getRunning:function(){return _.find(this.job_counts,"status","RUNNING")||{count:0}},getFailures:function(){var t=_.where(this.job_counts,{status:"FAILED"});_.forEach(t,function(t){var n=_.find(e.errorCategories,{name:t.category});t.order=n?n.order:""});var n=_.values(_.groupBy(t,"order")),i=function(e){var t=[];return _.forEach(e,function(e){_.forEach(e,function(e){t.push({status:e.category,count:e.count,order:e.order})})}),_.sortByOrder(t,["order"],["desc"])};return i(n)},getCellFill:function(){var t=this.getPerformance();return"z_inactive"===t.rateDescription?e.colors.chart_gray_dark:e.colors.chart_green},getCellActivity:function(){var t=this.getRunning();return t.count>0?"&#x"+e.activityIconCode+";":""},getCellActivityTotal:function(){return this.getRunning().count>0?this.getRunning().count:""},getCellError:function(){var e=this.getPerformance();return"Failed: "+e.failed},getCellTotal:function(){var e=this.getPerformance();return e.completed},getCellPauseResume:function(){},getCellFailures:function(){return _.map(this.getFailures(),"status")}},i.build=function(e){return e?new i(e.job_type,e.job_counts):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build).filter(Boolean):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("Product",["JobType","scaleService","scaleConfig",function(e,t,n){var i=function(t,n,i,r,o,a,s,c,l,u,d,p,f,g,m,h,v,y,b,_,S,T,w,j,C,x,k){this.id=t,this.workspace=n,this.file_name=i,this.media_type=r,this.file_size=o,this.file_size_readable=this.getReadableFileSize(),this.data_type=a,this.is_deleted=s,this.uuid=c,this.url=l,this.created=u,this.created_formatted=u?moment.utc(u).toISOString():u,this.deleted=d,this.data_started=p,this.data_ended=f,this.geometry=g,this.center_point=m,this.meta_data=h,this.countries=v,this.last_modified=y,this.last_modified_formatted=y?moment.utc(y).toISOString():y,this.is_operational=b,this.is_operational_label=b?"Operational":"R&amp;D",this.is_published=_,this.published=S,this.unpublished=T,this.job_type=e.transformer(w),this.job=j,this.job_exe=C,this.update=x,this.source_files=k};return i.prototype={getDuration:function(){return moment.utc(this.last_modified).diff(moment.utc(this.created))},getReadableFileSize:function(){return t.calculateFileSizeFromBytes(this.file_size)}},i.build=function(e){return e?new i(e.id,e.workspace,e.file_name,e.media_type,e.file_size,e.data_type,e.is_deleted,e.uuid,e.url,e.created,e.deleted,e.data_started,e.data_ended,e.geometry,e.center_point,e.meta_data,e.countries,e.last_modified,e.is_operational,e.is_published,e.published,e.unpublished,e.job_type,e.job,e.job_exe,e.update,e.source_files):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build).filter(Boolean):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("RunningJob",["scaleConfig","scaleService","JobType",function(e,t,n){var i=function(e,t,i){this.count=e,this.longest_running=t,this.job_type=n.transformer(i)};return i.prototype={getDuration:function(){return t.calculateDuration(this.longest_running,moment.utc().toISOString())},getIcon:function(){var t=this.job_type.icon_code?'<i class="fa fa-fw">&#x'+this.job_type.icon_code+"</i>":'<i class="fa fa-fw">&#x'+e.defaultIconCode+"</i>";return t}},i.build=function(e){return e?new i(e.count,e.longest_running,e.job_type):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build).filter(Boolean):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("SystemFailure",["scaleConfig","scaleService",function(e,t){var n=function(e,t,n,i,r,o){this.count=e,this.job_type_name=t,this.job_type_version=n,this.error_name=i,this.first_error=r,this.last_error=o};return n.prototype={getDuration:function(){return t.calculateDuration(this.first_error,this.last_error)},getIcon:function(){var t=_.find(e.jobTypes,"title",this.job_type_name);return t?t.icon:e.defaultIcon}},n.build=function(e){return e?new n(e.count,e.job_type_name,e.job_type_version,e.error_name,e.first_error,e.last_error):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build).filter(Boolean):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").controller("jobExecutionLogController",["$scope","$location","$element","$timeout","scaleConfig","jobExecutionService","stateService","poller",function(e,t,n,i,r,o,a,s){var c=this,l=0,u=function(){c.forceScroll=!0,c.jobLogError=null,c.execLog=[],a.setLogArgs([]),e.$watch("execution",_.debounce(function(){e.execution&&(c.status=e.execution.status.toLowerCase(),console.log(e.execution),o.getLog(e.execution.id).then(null,null,function(t){if(t.$resolved){if(204!==t.$status){var i=$(n[0]).find(".bash");if(c.scrollDiff=i.scrollTop()+i.prop("offsetHeight")-i.prop("scrollHeight"),c.scrollDiff>=0&&(c.forceScroll=!0),c.execLog=_.sortBy(c.execLog.concat(t.hits.hits),["_source.@timestamp","_source.scale_order_num"]),c.execLog&&c.execLog.length>0){var r=_.last(c.execLog)._source;r.scale_order_num!==l?(console.log("New entries - "+r.scale_order_num+" : "+l),l=r.scale_order_num,a.setLogArgs([{started:r["@timestamp"]}])):(console.log("Duplicate entries"),c.execLog=_.take(c.execLog,c.execLog.length-t.hits.hits.length))}}}else t.$statusText&&""!==t.$statusText&&(c.jobLogErrorStatus=t.$statusText),e.jobLogError="Unable to retrieve job logs."}),e.$on("modal.closing",function(){s.stopAll()}))},r.pollIntervals.jobExecutionLog-100)),e.$watch("vm.execLog",function(){c.execLog&&(c.forceScroll||c.scrollDiff>=0)&&i(function(){c.forceScroll=!1;var e=$(n[0]).find(".bash").prop("scrollHeight");$(n[0]).find(".bash").scrollTop(e)},50)})};c.scrollitem=function(e){console.log(e)},c.stdoutChanged=function(){console.log("stdout changed.")},u()}]).directive("jobExecutionLog",function(){return{controller:"jobExecutionLogController",controllerAs:"vm",templateUrl:"modules/jobs/directives/jobExecutionLogTemplate.html",restrict:"E",scope:{execution:"="}}})}(),function(){"use strict";angular.module("scaleApp").controller("aisJobHealthController",["$rootScope","$scope","jobTypeService",function(e,t,n){var i=this;i.loadingJobHealth=!0,i.jobHealthError=null,i.jobHealthErrorStatus=null,i.jobHealth={};var r=function(){n.getJobTypeStatus({page:null,page_size:1e3,started:t.duration,ended:null}).then(null,null,function(n){if(n.$resolved){i.jobHealthError=null,i.jobTypeStatus=n.results,i.total=0,i.failed=0;var r={},o=[];_.forEach(n.results,function(e){r=e.getPerformance(),i.total=i.total+r.total,i.failed=i.failed+r.failed,o.push(e.getFailures())});var a=[],s=0,c=0,l=0;_.forEach(o,function(e){_.forEach(e,function(e){"SYSTEM"===e.status?s+=e.count:"DATA"===e.status?c+=e.count:"ALGORITHM"===e.status&&(l+=e.count)})}),(s>0||c>0||l>0)&&(s>0&&a.push({status:"SYSTEM",count:s}),l>0&&a.push({status:"ALGORITHM",count:l}),c>0&&a.push({status:"DATA",count:c})),i.jobHealth={gaugeData:0===i.total?0:100-(i.failed/i.total*100).toFixed(2),donutData:a},t.broadcastData&&e.$broadcast("jobTypeStatus",i.jobTypeStatus)}else n.statusText&&""!==n.statusText&&(i.jobHealthErrorStatus=n.statusText),i.jobHealthError="Unable to retrieve job statistics.";i.loadingJobHealth=!1})};r()}]).directive("aisJobHealth",function(){return{controller:"aisJobHealthController",controllerAs:"vm",templateUrl:"modules/jobs/directives/jobHealthTemplate.html",restrict:"E",scope:{duration:"=",broadcastData:"=",showDescription:"="}}})}(),function(){"use strict";angular.module("scaleApp").controller("jobTypeInterfaceDirectiveController",["$rootScope","$scope","jobTypeService",function(e,t,n){}]).directive("aisJobTypeInterface",function(){return{controller:"jobTypeInterfaceDirectiveController",templateUrl:"modules/jobs/directives/jobTypeInterfaceTemplate.html",restrict:"E",scope:{jobTypeInterface:"="}}})}(),function(){"use strict";angular.module("scaleApp").controller("nodeDetailsController",["$scope","$location","$routeParams","$timeout","navService","nodeService","scaleConfig","scaleService","statusService","jobTypeService","moment",function(e,t,n,i,r,o,a,s,c,l,u){var d=this,p=[],f=[];d.scaleConfig=a,d.moment=u,d._=_,d.loading=!0,d.loadingStatus=!0,d.nodeStatus=null,d.nodesError=null,d.nodeId=parseInt(n.id),d.runningJobs=[],d.completedJobs=[],d.systemJobs=[],d.algorithmJobs=[],d.dataJobs=[],d.scaleService=s;var g=function(){c.getStatus(!0).then(null,null,function(e){e.$resolved?(d.nodesError=null,d.runningJobs=[],d.completedJobs=[],p=e.nodes,d.nodeStatus=_.find(p,{id:d.nodeId}),_.forEach(d.nodeStatus.job_executions.running.by_job_type,function(e){d.runningJobs.push({jobType:_.find(f,{id:e.job_type_id}),count:e.count})}),_.forEach(d.nodeStatus.job_executions.completed.by_job_type,function(e){d.completedJobs.push({jobType:_.find(f,{id:e.job_type_id}),count:e.count})}),_.forEach(d.nodeStatus.job_executions.failed.system.by_job_type,function(e){d.systemJobs.push({jobType:_.find(f,{id:e.job_type_id}),count:e.count})}),_.forEach(d.nodeStatus.job_executions.failed.algorithm.by_job_type,function(e){d.algorithmJobs.push({jobType:_.find(f,{id:e.job_type_id}),count:e.count})}),_.forEach(d.nodeStatus.job_executions.failed.data.by_job_type,function(e){d.dataJobs.push({jobType:_.find(f,{id:e.job_type_id}),count:e.count})})):(e.statusText&&""!==e.statusText&&(d.nodesErrorStatus=e.statusText),d.nodesError="Unable to retrieve nodes."),d.loadingStatus=!1})},m=function(e){o.getNode(e).then(function(e){d.node=e})["finally"](function(){d.loading=!1})},h=function(){r.updateLocation("nodes"),l.getJobTypesOnce().then(function(e){f=e.results,m(d.nodeId),g()})};h()}])}(),function(){"use strict";angular.module("scaleApp").controller("nodesController",["$scope","$location","$timeout","$uibModal","navService","nodeService","nodeUpdateService","statusService","stateService","userService","jobTypeService","gridFactory","toastr","poller",function(e,t,n,i,r,o,a,s,c,l,u,d,p,f){var g=this;g.nodesParams=c.getNodesParams(),g.stateService=c,g.loading=!0,g.loadingStatus=!0,g.readonly=!0,g.actionClicked=!1,g.gridOptions=d.defaultGridOptions(),g.gridOptions.data=[],g.showActive="true"===g.nodesParams.active,g.nodeType=g.showActive?"Active":"Deprecated",g.nodeTotals="",g.nodeStates=[],g.selectedNodeState=t.search().state||"All",e.pauseReason="";var m=[],h=!!g.nodesParams.order,v=null;g.colDefs=[{field:"hostname",displayName:"Hostname",enableFiltering:!1,width:"20%",cellTemplate:"hostname.html"},{field:"state.name",displayName:"State",width:"10%",cellTemplate:'<div class="ui-grid-cell-contents"><div class="pull-right"><span class="fa fa-exclamation-triangle error" ng-show="row.entity.errors.length > 0" tooltip-append-to-body="true" uib-tooltip="{{ row.entity.errors.length === 1 ? row.entity.errors[0].description : row.entity.errors.length + \' Errors\' }}"></span> <span class="fa fa-exclamation-triangle warning" ng-show="row.entity.warnings.length > 0" tooltip-append-to-body="true" uib-tooltip="{{ row.entity.warnings.length === 1 ? row.entity.warnings[0].description : row.entity.warnings.length + \' Warnings\' }}"></span></div><span ng-bind-html="row.entity.state.title" tooltip-append-to-body="true" uib-tooltip="{{ row.entity.state.description }}"></span></div>',filterHeaderTemplate:'<div class="ui-grid-filter-container" ng-show="grid.appScope.vm.showActive"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedNodeState"><option ng-selected="{{ grid.appScope.vm.nodeStates[$index] == grid.appScope.vm.selectedNodeState }}" value="{{ grid.appScope.vm.nodeStates[$index] }}" ng-repeat="state in grid.appScope.vm.nodeStates track by $index">{{ state }}</option></select></div>'},{field:"job_executions",displayName:"Job Executions (Last 3 Hrs)",enableFiltering:!1,enableSorting:!1,width:"22%",cellTemplate:"jobExecutions.html",headerCellTemplate:"jobExecutionsHeader.html"},{field:"running_jobs",displayName:"Running Jobs",enableFiltering:!1,enableSorting:!1,cellTemplate:"runningJobs.html"}],g.gridOptions.columnDefs=g.colDefs,g.toggleActive=function(e){g.actionClicked=!0;var t=!e.is_active;a.updateNode(e.id,{pause_reason:"",is_paused:e.is_paused,is_active:t}).then(function(t){var n=_.find(g.gridOptions.data,{id:t.id});e.is_active=t.is_active,e.is_active?p.info(n.hostname+" Activated"):p.info(n.hostname+" Deactivated")})},g.resumeNode=function(e){g.actionClicked=!0,a.updateNode(e.id,{pause_reason:null,is_paused:!1,is_active:e.is_active}).then(function(t){var n=_.find(g.gridOptions.data,{id:t.id});e.is_paused=t.is_paused,p.info(n.hostname+" Resumed")})},g.pauseNode=function(t){e.pauseReason="",g.actionClicked=!0,e.updateReason=function(t){e.pauseReason=t};var n=i.open({animation:!0,templateUrl:"pauseDialog.html",scope:e});n.result.then(function(){a.updateNode(t.id,{pause_reason:e.pauseReason,is_paused:!0,is_active:t.is_active}).then(function(e){var n=_.find(g.gridOptions.data,{id:e.id});t.is_paused=e.is_paused,p.info(n.hostname+" Paused")})})},g.filterResults=function(){f.stopAll(),c.setNodesParams(g.nodesParams),g.loading=!0,S()},g.updateColDefs=function(){g.gridOptions.columnDefs=d.applySortConfig(g.colDefs,g.nodesParams)},g.updateNodeOrder=function(e){g.nodesParams.order=e.length>0?e:null,h=e.length>0,g.filterResults()},g.updateNodeActive=function(){y()},g.gridOptions.onRegisterApi=function(n){g.gridApi=n,g.gridApi.selection.on.rowSelectionChanged(e,function(e){g.actionClicked?g.actionClicked=!1:(t.search({}),t.path("/nodes/"+e.entity.id))}),g.gridApi.core.on.sortChanged(e,function(e,t){_.forEach(g.gridApi.grid.columns,function(e){e.colDef.sort=e.sort}),c.setNodesColDefs(g.gridApi.grid.options.columnDefs);var n=[];_.forEach(t,function(e){n.push("desc"===e.sort.direction?"-"+e.field:e.field)}),g.updateNodeOrder(n)})};var y=function(){var e=g.showActive?"Active":"Deprecated",n=g.showActive?"Deprecated":"Active";g.nodes=_.filter(m,{is_active:g.showActive}),g.nodeTotals=g.nodes.length+" "+e+" Nodes / "+(m.length-g.nodes.length)+" "+n+" Nodes",g.nodeStates=_.sortBy(_.uniq(_.map(g.nodes,"state.title")));var i=_.find(g.nodeStates,function(e){return e===g.selectedNodeState});i||"All"===g.selectedNodeState||g.nodeStates.push(g.selectedNodeState),g.nodeStates.unshift("All");var r=t.search().order,o=t.search().state;if(r){var a=[],s=[];_.forEach(r,function(e){a.push(_.startsWith(e,"-")?_.tail(e).join(""):e),s.push(_.startsWith(r,"-")?"desc":"asc")}),g.nodes=_.sortByOrder(g.nodes,a,s)}_.forEach(g.nodes,function(e){e.running_jobs=b(e)});var c=_.cloneDeep(g.nodes);o&&(c=_.filter(c,{state:{title:o}})),g.gridOptions.totalItems=c.length,g.gridOptions.minRowsToShow=c.length,g.gridOptions.virtualizationThreshold=c.length,g.gridOptions.data=c},b=function(e){var t=[];return _.forEach(e.job_executions.running.by_job_type,function(e){t.push({jobType:_.find(v,{id:e.job_type_id}),count:e.count})}),t},S=function(){f.stopAll(),s.getStatus(!0).then(null,null,function(e){e.$resolved?(g.nodesError=null,m=e.nodes,y()):(e.statusText&&""!==e.statusText&&(g.nodesErrorStatus=e.statusText),g.nodesError="Unable to retrieve nodes."),g.loading=!1})},T=function(){u.getJobTypesOnce().then(function(e){v=e.results,S()}),g.nodesParams.state=g.showActive&&"All"!==g.selectedNodeState?g.selectedNodeState:null,c.setNodesParams(g.nodesParams),g.updateColDefs();var e=l.getUserCreds();g.readonly=!(e&&e.is_admin),r.updateLocation("nodes")};T(),e.$watchCollection("vm.stateService.getNodesColDefs()",function(e,t){angular.equals(e,t)||(g.colDefs=e,g.updateColDefs())}),e.$watchCollection("vm.stateService.getNodesParams()",function(e,t){angular.equals(e,t)||(g.nodesParams=e,g.updateColDefs())}),e.$watch("vm.showActive",function(e,t){angular.equals(e,t)||(g.nodesParams.active=e.toString(),g.nodesParams.state=e&&"All"!==g.selectedNodeState?g.selectedNodeState:null,g.showActive=e,g.nodeType=e?"Active":"Deprecated",c.setNodesParams(g.nodesParams),y())}),e.$watch("vm.selectedNodeState",function(e,t){angular.equals(e,t)||(g.nodesParams.state="All"!==e?e:null,S(),c.setNodesParams(g.nodesParams))})}])}(),function(){"use strict";angular.module("scaleApp").controller("aisNodeHealthController",["$rootScope","$scope",function(e,t){var n=this;n.nodes=[],n.groupedNodes=[],n.totalNodes=0;var i=function(){if(n.totalNodes=n.nodes.length,n.totalNodes>0){n.groupedNodes=_.pairs(_.groupBy(n.nodes,"state.title"));var e=[];_.forEach(n.groupedNodes,function(t){e.push({status:t[0],count:t[1].length})}),n.nodeHealth=e}else n.nodeHealth=[]};t.$watch("data",function(e){e&&(n.nodes=e,n.totalNodes=e.length,i())})}]).directive("aisNodeHealth",function(){return{controller:"aisNodeHealthController",controllerAs:"vm",templateUrl:"modules/nodes/directives/nodeHealthTemplate.html",restrict:"E",scope:{data:"=",showDescription:"=",loading:"=",nodeType:"@"}}})}(),function(){"use strict";angular.module("scaleApp").controller("nodeStatusGridController",["$scope","$location",function(e,t){var n=this,i=e.cellSize||"10px";n.nodes=[],n.hours=e.hours||3,n.cellStyle={width:i,height:i},n.getNodeClass=function(e){return console.log("getNodeClass"),e.is_online?e.node.is_paused?"is-paused":e.node.is_paused_errors?"is-paused-errors":"online":"offline"},n.viewNode=function(e){t.path("nodes/"+e)},e.$watch("data",function(e,t){angular.equals(e,t)||(_.forEach(e,function(e){e.is_online?e.node.is_paused?e["class"]="is-paused":e.node.is_paused_errors?e["class"]="is-paused-errors":e["class"]="online":e["class"]="offline"}),n.nodes=e)})}])}(),function(){"use strict";angular.module("scaleApp").directive("aisNodeStatusGrid",function(){return{controller:"nodeStatusGridController",controllerAs:"vm",templateUrl:"modules/nodes/directives/nodeStatusGridTemplate.html",restrict:"E",scope:{data:"=",hours:"=",cellSize:"@"}}})}(),function(){"use strict";angular.module("scaleApp").factory("Node",["NodeResources","scaleService",function(e,t){var n=function(e,t,n,i,r,o,a,s){this.id=e,this.hostname=t,this.pause_reason=n,this.is_paused=i,this.is_active=r,this.deprecated=o,this.created=a,this.last_modified=s};return n.prototype={toString:function(){return"Node"},getDuration:function(){return t.calculateDuration(this.created,this.last_modified)},getCellText:function(){return this.hostname},getCellTitle:function(){return this.hostname},isPaused:function(){return this.is_paused}},n.build=function(e){return e?new n(e.id,e.hostname,e.pause_reason,e.is_paused,e.is_active,e.deprecated,e.created,e.last_modified):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").factory("NodeResources",function(){var e=function(e,t,n){this.total=e,this.scheduled=t,this.used=n};return e.prototype={},e.build=function(t){return t?new e(t.total,t.scheduled,t.used):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").service("nodeService",["$http","$q","$resource","scaleConfig","Node","poller","pollerFactory",function(e,t,n,i,r,o,a){var s=function(e,t){return{order:e,active:t}};return{getNodes:function(e){e=e||s();var t=n(i.getUrlPrefix("nodes")+"nodes/",e),o=a.newPoller(t,i.pollIntervals.nodes);return o.promise.then(null,null,function(e){return e.$resolved?e.results=r.transformer(e.results):o.stop(),e})},getNodesOnce:function(n){n=n||s();var o=t.defer();return e({url:n.url?n.url:i.getUrlPrefix("nodes")+"nodes/",method:"GET",params:n}).success(function(e){var t=r.transformer(e.nodes);o.resolve(t)}).error(function(e){
o.reject(e)}),o.promise},getNode:function(n){var o=t.defer();return e.get(i.getUrlPrefix("nodes")+"nodes/"+n+"/").success(function(e){var t=r.transformer(e);o.resolve(t)}).error(function(e){o.reject(e)}),o.promise},getNodeData:function(e,t){var n={},i=this;return t=t||"PT3H",i.getNodes().then(function(e){return n.nodes=e,i.getNodeStatus(t).then(function(e){return n.stats=e,n})})}}}])}(),function(){"use strict";angular.module("scaleApp").service("nodeUpdateService",["$http","$q","scaleConfig","Node",function(e,t,n,i){var r=function(e,t,n){return{pause_reason:e,is_paused:t,is_active:n}};return{updateNode:function(o,a){a=a||r();var s=t.defer();return e({url:n.getUrlPrefix("nodes")+"nodes/"+o+"/",method:"PATCH",data:a}).success(function(e){s.resolve(i.transformer(e))}).error(function(e){s.reject(e)}),s.promise}}}])}(),function(){"use strict";angular.module("scaleApp").controller("navController",["$scope","$location","$window","scaleConfig","scaleService","stateService","navService",function(e,t,n,i,r,o,a){document.getElementsByTagName("body")[0].style.backgroundColor=i.colors.nav_bg;var s=this;s.version="",s.activePage="overview",s.docsUrl=i.urls.documentation,s["goto"]=function(e){t.search(""),t.path(e)};var c=function(){s.activePage=a.location},l=function(){a.registerObserver(c),r.getVersion().then(function(e){s.version=e.version,o.setVersion(e.version)})};l()}])}(),function(){"use strict";angular.module("scaleApp").service("navService",["$location",function(e){this.location="overview";var t=[];this.registerObserver=function(e){t.push(e)},this.notifyObservers=function(){angular.forEach(t,function(e){e()})},this.updateLocation=function(e){this.location=e,this.notifyObservers()}}])}(),function(){"use strict";angular.module("scaleApp").service("subnavService",["$http","scaleConfig",function(e,t){var n="";this.setCurrentPath=function(e){n=e},this.getCurrentPath=function(){return n}}])}(),function(){"use strict";angular.module("scaleApp").controller("recipeDetailsController",["$rootScope","$scope","$location","$routeParams","navService","recipeService","scaleConfig","subnavService","userService",function(e,t,n,i,r,o,a,s,c){var l=this;l.recipe={},l.recipeId=i.id,l.subnavLinks=a.subnavLinks.recipes,s.setCurrentPath("recipes"),l.loadingRecipeDetail=!0,l.activeTab="status",l.lastStatusChange="",l.getRecipeDetail=function(e){l.loadingRecipeDetail=!0,o.getRecipeDetails(e).then(function(e){l.recipe=e,o.getRecipeTypeDetail(e.recipe_type.id).then(function(e){l.recipeType=e})["catch"](function(e){console.log(e)})})["catch"](function(e){console.log(e)})["finally"](function(){l.loadingRecipeDetail=!1})},l.initialize=function(){r.updateLocation("recipes"),l.getRecipeDetail(l.recipeId)},l.switchTab=function(e){$("#"+l.activeTab).hide(),l.activeTab=e,$("#"+l.activeTab).show()},l.initialize()}])}(),function(){"use strict";angular.module("scaleApp").controller("recipeTypesController",["$rootScope","$scope","$routeParams","$location","$uibModal","hotkeys","scaleService","navService","recipeService","subnavService","jobTypeService","scaleConfig","RecipeType","userService","localStorage",function(e,t,n,i,r,o,a,s,c,l,u,d,p,f,g){var m=this;m.loading=!0,m.containerStyle="",m.recipeTypes=[],m.recipeTypeIds=[],m.requestedRecipeTypeId=parseInt(n.id),m.activeRecipeType=null,m.percentage=73,m.date=new Date,m.recipes=null,m.mode="view",m.addBtnText="New Recipe",m.addBtnClass="btn-primary",m.addBtnIcon="fa-plus-circle",m.editBtnText="Edit",m.editBtnClass="btn-success",m.editBtnIcon="fa-edit",m.jobTypeValues=[],m.isRecipeModified=!1,m.saveBtnClass="btn-default",m.masterClass="col-xs-3",m.detailClass="col-xs-9",m.minimizeMaster=!1,m.minimizeBtnClass="fa fa-chevron-left",m.user=f.getUserCreds(),m.scaleConfig=d,m.localRecipeTypes=[],m.subnavLinks=d.subnavLinks.recipes,l.setCurrentPath("recipes/types");var h=function(){s.updateLocation("recipes"),v()},v=function(){c.getRecipeTypes().then(function(e){if(m.recipeTypes=e.results,d["static"]){for(var n,i=0,r={};n=g.key(i);i++)r[n]=g.getItem(n);_.filter(_.pairs(r),function(e){if(_.contains(e[0],"recipeType")){var t=JSON.parse(e[1]);m.localRecipeTypes.push(t),m.recipeTypes.push(t)}})}m.recipeTypeIds=_.pluck(e,"id"),m.viewRecipeTypeDetail(m.requestedRecipeTypeId),o.bindTo(t).add({combo:"ctrl+up",description:"Previous Recipe Type",callback:function(){if(m.activeRecipeType){var e=_.indexOf(m.recipeTypeIds,m.activeRecipeType.id);e>0&&m.loadRecipeType(m.recipeTypeIds[e-1])}}}).add({combo:"ctrl+down",description:"Next Recipe Type",callback:function(){if(m.activeRecipeType){var e=_.indexOf(m.recipeTypeIds,m.activeRecipeType.id);e<m.recipeTypeIds.length-1&&m.loadRecipeType(m.recipeTypeIds[e+1])}}})})["catch"](function(e){console.log(e)})["finally"](function(){m.loading&&(m.loading=!1)})};m.clearLocalRecipeTypes=function(){_.forEach(m.localRecipeTypes,function(e){g.removeItem("recipeType"+e.id)}),i.path("/recipes/types")},m.newRecipeType=function(){i.path("/recipes/types/0")},m.viewRecipeTypeDetail=function(e){e>0?c.getRecipeTypeDetail(e).then(function(e){m.activeRecipeType=e}):0===e&&(m.activeRecipeType=new p)},m.loadRecipeType=function(e){m.activeRecipeType&&m.activeRecipeType.modified?y().then(function(){i.path("/recipes/types/"+e)},function(){}):i.path("/recipes/types/"+e)};var y=function(){var e=r.open({animation:m.animationsEnabled,templateUrl:"confirmDialog.html",scope:t,size:"sm"});return e.result};m.toggleMaster=function(e){"undefined"!=typeof e?m.minimizeMaster=e:m.minimizeMaster=!m.minimizeMaster,m.masterClass=m.minimizeMaster?"col-xs-1 minimized":"col-xs-3",m.detailClass=m.minimizeMaster?"col-xs-11":"col-xs-9",m.minimizeBtnClass=m.minimizeMaster?"fa fa-chevron-right":"fa fa-chevron-left"},e.$on("toggleEdit",function(e,t){m.toggleMaster("edit"===t)}),h(),e.$on("recipeModified",function(){m.isRecipeModified=!0,m.saveBtnClass="btn-success"}),angular.element(document).ready(function(){var e=a.getViewportSize(),t=d.headerOffset,n=e.height-t;m.containerStyle="height: "+n+"px; max-height: "+n+"px;"})}])}(),function(){"use strict";angular.module("scaleApp").controller("recipesController",["$scope","$location","scaleConfig","scaleService","stateService","recipeService","navService","subnavService","gridFactory","poller",function(e,t,n,i,r,o,a,s,c,l){s.setCurrentPath("recipes");var u=this,d={name:"VIEW ALL",title:"VIEW ALL",version:"",id:0};u.recipesParams=r.getRecipesParams(),u.stateService=r,u.loading=!0,u.recipeTypeValues=[d],u.selectedRecipeType=u.recipesParams.type_id?u.recipesParams.type_id:d,u.subnavLinks=n.subnavLinks.recipes,u.lastModifiedStart=moment.utc(u.recipesParams.started).toDate(),u.lastModifiedStartPopup={opened:!1},u.openLastModifiedStartPopup=function(e){e.stopPropagation(),u.lastModifiedStartPopup.opened=!0},u.lastModifiedStop=moment.utc(u.recipesParams.ended).toDate(),u.lastModifiedStopPopup={opened:!1},u.openLastModifiedStopPopup=function(e){e.stopPropagation(),u.lastModifiedStopPopup.opened=!0},u.dateModelOptions={timezone:"+000"},u.gridOptions=c.defaultGridOptions(),u.gridOptions.paginationCurrentPage=u.recipesParams.page||1,u.gridOptions.paginationPageSize=u.recipesParams.page_size||u.gridOptions.paginationPageSize,u.gridOptions.data=[];var p=!!u.recipesParams.type_id,f=!!u.recipesParams.order;u.colDefs=[{field:"recipe_type",displayName:"Recipe Type",cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.recipe_type.title }} {{ row.entity.recipe_type.version }}</div>',filterHeaderTemplate:'<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedRecipeType" ng-options="recipeType as (recipeType.title + \' \' + recipeType.version) for recipeType in grid.appScope.vm.recipeTypeValues"></select>'},{field:"created",displayName:"Created (Z)",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'},{field:"last_modified",displayName:"Last Modified (Z)",enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'},{field:"duration",enableFiltering:!1,enableSorting:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'},{field:"completed",enableFiltering:!1,enableSorting:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.completed_formatted }}</div>'}],u.getRecipes=function(){o.getRecipes(u.recipesParams).then(function(e){u.gridOptions.minRowsToShow=e.results.length,u.gridOptions.virtualizationThreshold=e.results.length,u.gridOptions.totalItems=e.count,u.gridOptions.data=e.results})["catch"](function(e){console.log(e)})["finally"](function(){u.loading=!1})},u.getRecipeTypes=function(){o.getRecipeTypes().then(function(e){u.recipeTypeValues.push(e.results),u.recipeTypeValues=_.flatten(u.recipeTypeValues),u.selectedRecipeType=_.find(u.recipeTypeValues,{id:u.recipesParams.type_id})||d,u.getRecipes()})["catch"](function(e){u.loading=!1})},u.filterResults=function(){l.stopAll(),r.setRecipesParams(u.recipesParams),u.loading=!0,u.getRecipes()},u.updateColDefs=function(){u.gridOptions.columnDefs=c.applySortConfig(u.colDefs,u.recipesParams)},u.updateRecipeOrder=function(e){u.recipesParams.order=e.length>0?e:null,f=e.length>0,u.filterResults()},u.updateRecipeType=function(e){e.id!==u.recipesParams.type_id&&(u.recipesParams.page=1),u.recipesParams.type_id=0===e.id?null:e.id,u.recipesParams.page_size=u.gridOptions.paginationPageSize,u.loading||u.filterResults()},u.gridOptions.onRegisterApi=function(n){u.gridApi=n,u.gridApi.selection.on.rowSelectionChanged(e,function(e){t.path("/recipes/recipe/"+e.entity.id).search("")}),u.gridApi.pagination.on.paginationChanged(e,function(e,t){u.recipesParams.page=e,u.recipesParams.page_size=t,u.filterResults()}),u.gridApi.core.on.sortChanged(e,function(e,t){_.forEach(u.gridApi.grid.columns,function(e){e.colDef.sort=e.sort}),r.setRecipesColDefs(u.gridApi.grid.options.columnDefs);var n=[];_.forEach(t,function(e){n.push("desc"===e.sort.direction?"-"+e.field:e.field)}),u.updateRecipeOrder(n)})},u.initialize=function(){r.setRecipesParams(u.recipesParams),u.updateColDefs(),u.getRecipeTypes(),a.updateLocation("recipes")},u.initialize(),e.$watch("vm.selectedRecipeType",function(e){parseInt(e)&&(e=_.find(u.recipeTypeValues,{id:parseInt(e)})),e&&(u.loading?p&&u.updateRecipeType(e):(p=!angular.equals(e,d),u.updateRecipeType(e)))}),e.$watch("vm.lastModifiedStart",function(e){u.loading||(u.recipesParams.started=e.toISOString(),u.filterResults())}),e.$watch("vm.lastModifiedStop",function(e){u.loading||(u.recipesParams.ended=e.toISOString(),u.filterResults())}),e.$watchCollection("vm.stateService.getRecipesColDefs()",function(e,t){angular.equals(e,t)||(u.colDefs=e,u.updateColDefs())}),e.$watchCollection("vm.stateService.getRecipesParams()",function(e,t){angular.equals(e,t)||(u.recipesParams=e,u.updateColDefs())})}])}(),function(){angular.module("scaleApp").controller("aisScaleRecipeGraphViewerController",["$rootScope","$scope","$location","$uibModal","scaleConfig","scaleService","jobTypeService","recipeService","workspacesService","RecipeType","RecipeTypeDetail","JobType","localStorage",function(e,t,n,i,r,o,a,s,c,l,u,d,p){var f=this;f.vertices=[],f.edges=[],f.selectedJob=null,f.selectedInputProvider=null,f.mode=null,f.editMode=null,f.dependencyBtnClass="fa-plus",f.addBtnText="New Recipe",f.addBtnClass="btn-primary",f.addBtnIcon="fa-plus-circle",f.editBtnText="Edit",f.editBtnClass="btn-success",f.editBtnIcon="fa-edit",f.jobTypeValues=[],f.saveBtnClass="btn-default",f.savingRecipe=!1,f.warnings=[],f.readonly=!0,f.detailMaxHeight=0,f.recipeTypeTrigger={dataTypes:""},f.detailContainerStyle="",f.containerClass=t.hasContainer?"":"detail-container no-tabs",f.lastStatusChange="",f.availableWorkspaces=[],f.recipeInputTypes=[{name:"property",title:"Property",fields:[]},{name:"file",title:"File",fields:[{name:"media_types",title:"Media Types",value:[]}]},{name:"files",title:"Files",fields:[{name:"media_types",title:"Media Types",value:[]}]}],f.availableTriggerTypes=r.triggerTypes,f.selectedRecipeInputType={},f.recipeInput={name:"",required:!0,type:""},f.isIE=o.isIE();var g=null,m=0,h=null,v=null,y=null,b=null,S=null,T=function(e){return d3.selectAll(".nodeRect").filter(function(t){return t===e})},w=function(e){return d3.selectAll(".nodeRect").filter(function(t){return t!==e})},j=function(){f.editBtnText="edit"===f.mode?"Cancel Edit":"Edit",f.editBtnClass="edit"===f.mode?"btn-warning":"btn-success",f.editBtnIcon="edit"===f.mode?"fa-close":"fa-edit"},C=function(){f.addBtnText="add"===f.mode?"Cancel":"New Recipe",f.addBtnClass="add"===f.mode?"btn-warning":"btn-primary",f.addBtnIcon="add"===f.mode?"fa-close":"fa-plus-circle"},x=function(){"edit"===f.mode?(f.mode="view",f.reloadRecipeTypeDetail(t.recipeType.id)):f.mode="edit",f.editMode="",j()},k=function(){t.recipeType.modified=!0,f.saveBtnClass="btn-success"},P=function(){t.recipeType.modified=!1,f.saveBtnClass="btn-default;"},D=function(){var e=i.open({animation:f.animationsEnabled,templateUrl:"confirmDialog.html",scope:t,size:"sm"});return e.result},A=function(e){var n="nostatus";if(t.recipe){var i=_.find(t.recipe.jobs,{job_name:e.name});i&&(n=i.job.status.toLowerCase())}return n};f.reloadRecipeTypeDetail=function(e){var n=function(){s.getRecipeTypeDetail(e).then(function(e){t.recipeType=e})};t.recipeType.modified?D().then(function(){P(),C(),"edit"===f.mode&&x(),n()},function(){}):("edit"===f.mode&&x(),C(),n())},f.redraw=function(){I()},f.nodeClick=function(e){d3.selectAll(".nodeRect").classed("selected-node",!1);var n=_.find(t.recipeType.definition.jobs,{name:e});"start"===e&&(n=g);var i=$("#"+e);i.position();if(f.selectedJob&&n.name===f.selectedJob.name)d3.selectAll(".nodeRect").classed("selected-node",!1),f.selectedJob=null,f.selectedRecipeJob=null,f.selectedOutputReceiver=null,f.selectedInputProvider=null,f.editMode="",f.dependencyBtnClass="fa-plus",w(e).classed("selected-node-selectable",!1);else if("addDependency"===f.editMode)O(e),k(),f.redraw();else if("addInput"===f.editMode){var r="";"start"===n.name?(r='<ul class="list-group">',_.forEach(t.recipeType.definition.input_data,function(e){r+='<li class="list-group-item">',r=r+"<a onclick=\"mapInputRecipeInput('"+e.name+"')\">"+e.name+"</a>",e.media_types&&(r=r+'<div class="input-media-types">'+e.media_types.join(",")+"</div>"),r+="</li>"}),r+="</ul>",i.popover({container:"body",content:r,html:!0,title:"Select provider/output"}),i.popover("show")):n.job_type.job_type_interface.output_data.length>0&&(r='<ul class="list-group">',_.forEach(n.job_type.job_type_interface.output_data,function(e){r+='<li class="list-group-item">',r=r+"<a onclick=\"mapInput('"+n.name+"', '"+e.name+"')\">"+e.name+"</a>",e.media_type&&(r=r+'<div class="input-media-types">'+e.media_type+"</div>"),r+="</li>"}),r+="</ul>",i.popover({container:"body",content:r,html:!0,title:"Select provider/output"}),i.popover("show"))}else"addOutput"===f.editMode?(f.selectedOutputReceiver=n,n.job_type.job_type_interface.input_data.length>0&&(r='<ul class="list-group">',_.forEach(n.job_type.job_type_interface.input_data,function(e){r+='<li class="list-group-item">',r=r+"<a onclick=\"mapOutput('"+n.name+"', '"+e.name+"')\">"+e.name+"</a>",e.media_types&&(r=r+'<div class="input-media-types">'+e.media_types.join(",")+"</div>"),r+="</li>"}),r+="</ul>",i.popover({container:"body",content:r,html:!0,title:"Select receiver/input"}),i.popover("show"))):(f.selectedJob=n,t.recipe&&(f.selectedRecipeJob=_.find(t.recipe.jobs,{job_name:n.name})),T(e).classed("selected-node",!0));f.selectedJob&&T(f.selectedJob.name).classed("selected-node",!0)},f.toggleEditMode=function(){"edit"===f.mode?f.reloadRecipeTypeDetail(t.recipeType.id):(x(),C()),e.$broadcast("toggleEdit",f.mode)},f.openAddJob=function(){var e=i.open({animation:f.animationsEnabled,templateUrl:"addJobContent.html",scope:t,size:"sm"});e.result.then(function(){f.selectedJobType&&a.getJobTypeDetails(f.selectedJobType.id).then(function(e){f.addJobType(e),k()})},function(){})},f.openEditTrigger=function(){var e=i.open({animation:f.animationsEnabled,templateUrl:"editTrigger.html",scope:t,size:"md"});e.result.then(function(){"edit"!==f.mode&&"add"!==f.mode||(t.recipeType.trigger_rule.configuration.condition.data_types=f.recipeTypeTrigger.dataTypes?f.recipeTypeTrigger.dataTypes.split(","):[],k())},function(){})},f.deleteRecipeInput=function(e){var n=_.remove(t.recipeType.definition.input_data,function(t){return t.name===e});console.log("removed "+n.length+" recipe inputs."),k(),f.redraw()},f.openAddInput=function(){var e=i.open({animation:f.animationsEnabled,templateUrl:"addInput.html",scope:t});e.result.then(function(){if(f.selectedRecipeInputType.fields.length>0){var e=[];_.forEach(f.selectedRecipeInputType.fields,function(t){_.forEach(t.value.split(","),function(t){e.push(t)}),f.recipeInput[t.name]=e})}t.recipeType.definition.input_data.push(f.recipeInput),_.forEach(t.recipeType.definition.jobs,function(e){0===e.recipe_inputs.length&&e.recipe_inputs.push({job_input:f.recipeInput.name,recipe_input:f.recipeInput.name})}),J(),f.recipeInput={name:"",required:!0,type:""},f.selectedRecipeInputType={}})},f.changeInputType=function(){f.selectedRecipeInputType=_.find(f.recipeInputTypes,{name:f.recipeInput.type})};var E=function(e){var t="";return _.forEach(e,function(e){t+="<b>"+e.id+":</b> "+e.details+"<br /><br />"}),t+='<button type="button" class="btn btn-default btn-xs clear">Hide</button>'};f.validateRecipeType=function(){s.validateRecipeType(t.recipeType).then(function(e){if(e.warnings&&e.warnings.length>0){var t=E(e.warnings);toastr.warning(t)}else toastr.success("Recipe is valid.")})["catch"](function(e){e.detail?toastr.error(e.detail):toastr.error(e)})},f.saveRecipeType=function(){f.savingRecipe=!0,s.validateRecipeType(t.recipeType).then(function(e){if(e.warnings&&e.warnings.length>0){var i=E(e.warnings);toastr.warning(i),f.savingRecipe=!1}s.saveRecipeType(t.recipeType).then(function(e){f.savingRecipe=!1,t.recipeType=u.transformer(e),r["static"]&&(console.log(JSON.stringify(t.recipeType)),p.setItem("recipeType"+t.recipeType.id,JSON.stringify(t.recipeType))),f.redraw(),n.path("/recipes/types/"+t.recipeType.id)})})["catch"](function(e){e&&e.detail?toastr.error(e.detail):toastr.error(e),f.savingRecipe=!1}),P()},f.addJobType=function(e){console.log(e.name),t.recipeType.definition.addJob(e),f.redraw()},f.mapInput=function(e,t){console.log("map selected job input to "+e+"."+t);var n=_.find(f.selectedJob.dependencies,{name:e});if(n&&n.connections&&n.connections.length>0){var i=_.find(n.connections,{output:t,input:f.selectedJobInput.name});i||n.connections.push({output:t,input:f.selectedJobInput.name})}else n?n.connections=[{output:t,input:f.selectedJobInput.name}]:(n={name:e,connections:[{output:t,input:f.selectedJobInput.name}]},f.selectedJob.dependencies.push(n));f.selectedJob.depStart=!1,f.editMode="",f.selectedJobInput=null,f.selectedInputProvider=null,k(),f.redraw()},f.mapInputRecipeInput=function(e){console.log("map selected job to recipe input "+e);var t=_.find(f.selectedJob.recipe_inputs,{job_input:f.selectedJobInput.name});t&&t.recipe_name!==e?(t.recipe_input=e,k(),f.redraw()):t||(f.selectedJob.recipe_inputs.push({job_input:f.selectedJobInput.name,recipe_input:e}),k(),f.redraw()),f.editMode="",f.selectedJobInput=null,f.selectedInputProvider=null},f.mapOutput=function(e,t){var n=_.find(f.selectedOutputReceiver.dependencies,{name:f.selectedJob.name});if(n&&n.connections&&n.connections.length>0){var i=_.find(n.connections,{output:f.selectedJobOutput.name,input:t});i||n.connections.push({output:f.selectedJobOutput.name,input:t})}else n?n.connections=[{output:f.selectedJobOutput.name,input:t}]:(n={name:f.selectedJob.name,connections:[{output:f.selectedJobOutput.name,input:t}]},f.selectedOutputReceiver.dependencies.push(n));f.selectedOutputReceiver.depStart=!1,f.editMode="",f.selectedJobOutput=null,f.selectedOutputReceiver=null,k(),f.redraw()},f.toggleAddDependency=function(){"addDependency"===f.editMode?(f.editMode="",f.dependencyBtnClass="fa-plus",w(f.selectedJob.name).classed("selected-node-selectable",!1)):(console.log("toggle addDependency mode"),f.editMode="addDependency",f.dependencyBtnClass="fa-remove",w(f.selectedJob.name).classed("selected-node-selectable",!0))},f.toggleAddInput=function(e){"addInput"===f.editMode?(f.editMode="",w(f.selectedJob.name).classed("selected-node-selectable",!1)):(f.selectedJobInput=e,console.log("toggle addInput mode"),f.editMode="addInput",w(f.selectedJob.name).classed("selected-node-selectable",!0))},f.toggleAddOutput=function(e){"addOutput"===f.editMode?(f.editMode="",w(f.selectedJob.name).classed("selected-node-selectable",!1)):(f.selectedJobOutput=e,console.log("toggle addOutput mode"),f.editMode="addOutput",w(f.selectedJob.name).classed("selected-node-selectable",!0))},f.removeDependency=function(e){var t=_.remove(f.selectedJob.dependencies,function(t){return t.name===e});console.log("removed "+t.length+" dependencies."),k(),f.redraw()},f.removeInputMapping=function(e,t){if("recipe"===e){var n=_.remove(f.selectedJob.recipe_inputs,{recipe_input:t});k(),f.redraw()}else{var n=_.find(f.selectedJob.dependencies,{name:e});if(n&&n.connections){var i=_.remove(n.connections,function(e){return e.output===t});console.log("removed "+i.length+" input connections."),k(),f.redraw()}}},f.deleteRecipeJob=function(e){_.forEach(t.recipeType.definition.jobs,function(t){_.remove(t.dependencies,{name:e})}),_.remove(t.recipeType.definition.jobs,{name:e}),f.selectedJob=null,k(),f.redraw()},f.removeOutputMapping=function(e,n){var i=_.find(t.recipeType.definition.jobs,{name:e}),r=_.find(i.dependencies,{name:f.selectedJob.name});if(r&&r.connections){var o=_.remove(r.connections,function(e){return e.output===n});console.log("removed "+o.length+" output connections."),k(),f.redraw()}},f.selectJobTypeToAdd=function(e){f.selectedJobType=e},t.$on("redrawRecipes",function(){f.redraw()});var O=function(e){console.log(f.selectedJob.name+"->"+e),f.selectedJob.dependencies||(f.selectedJob.dependencies=[]);var t=_.find(f.selectedJob.dependencies,{name:e});t||f.selectedJob.dependencies.push({name:e}),f.selectedJob.depStart=!1,f.editMode="",f.dependencyBtnClass="fa-plus"},J=function(){t.recipeType.definition&&_.forEach(t.recipeType.definition.jobs,function(e){e.job_type&&e.job_type.job_type_interface&&(_.forEach(e.job_type.job_type_interface.output_data,function(t,n){if(t){var i=M(e.name,t.name);t.dependents=i}}),_.forEach(e.job_type.job_type_interface.input_data,function(t,n){if(t){var i=[];_.forEach(e.dependencies,function(e,n){_.forEach(e.connections,function(n,r){n.input===t.name&&i.push({name:e.name,output:n.output,input:n.input})})}),_.forEach(e.recipe_inputs,function(e,n){e.job_input===t.name&&i.push({name:"recipe",output:e.recipe_input,input:e.job_input})}),t.dependencies=i}}))})},I=function(){a.getJobTypesOnce().then(function(e){f.jobTypeValues=e.results}),c.getWorkspaces().then(function(e){f.availableWorkspaces=e}),t.$watchCollection("recipeType",function(e,n){t.recipeType||(t.recipeType=new l),"undefined"==typeof t.recipeType.id||null===t.recipeType.id||0===t.recipeType.id?f.mode="add":"edit"!==f.mode&&(f.mode="view"),_.forEach(t.recipeType.definition.jobs,function(e,n){if(!e.job_type.job_type_interface&&t.recipeType.job_types){var i=_.find(t.recipeType.job_types,{name:e.job_type.name,version:e.job_type.version});t.recipeType.definition.jobs[n].job_type=i}}),t.recipeType.trigger_rule&&t.recipeType.trigger_rule.configuration&&t.recipeType.trigger_rule.configuration.condition&&t.recipeType.trigger_rule.configuration.condition.data_types&&(f.recipeTypeTrigger.dataTypes=t.recipeType.trigger_rule.configuration.condition.data_types.join(",")),R(),J(),drawGraph()}),t.$parent.vm.user&&(f.readonly=!1)},R=function(){h=d3.select("svg"),v=h.select("g"),b=d3.behavior.zoom().on("zoom",function(){m=d3.event.scale,v.attr("transform","translate("+d3.event.translate+")scale("+m+")")}),h.call(b),S=new dagreD3.render,y=new dagreD3.graphlib.Graph,y.setGraph({nodesep:70,ranksep:50,rankdir:"TB",marginx:20,marginy:20})};drawGraph=function(){window.nodeClick=function(e){var t=angular.element(document.getElementById("recipeviewer")).scope();t.$apply(function(){t.vm.nodeClick(e)})},window.mapInput=function(e,t){$("#"+e).popover("destroy");var n=angular.element(document.getElementById("recipeviewer")).scope();n.$apply(function(){n.vm.mapInput(e,t)})},window.mapInputRecipeInput=function(e){$("#start").popover("destroy");var t=angular.element(document.getElementById("recipeviewer")).scope();t.$apply(function(){t.vm.mapInputRecipeInput(e)})},window.mapOutput=function(e,t){$("#"+e).popover("destroy");var n=angular.element(document.getElementById("recipeviewer")).scope();n.$apply(function(){n.vm.mapOutput(e,t)})},t.recipe&&(f.lastStatusChange=t.recipe.last_modified?moment.duration(moment.utc(t.recipe.last_modified).diff(moment.utc())).humanize(!0):"");var e=[];t.recipeType.definition&&(e=t.recipeType.definition.jobs);var n=[];for(var i in e){var r=e[i];(void 0===r.dependencies||r.dependencies.length<1)&&(r.depStart=!0);var o=A(r),a='<div class="recipeNode">';"nostatus"!==o&&(a+='<span class="status"></span>'),a+='<span class="name">',r.job_type&&(a+='<div id="'+r.name+'" class="" onclick="nodeClick(\''+r.name+'\')"><span class="name">'+r.job_type.getIcon()+" "+r.name+"</span></div>"),a+="</span>",a+="</div>",y.setNode(r.name,{labelType:"html",label:a,rx:5,ry:5,padding:0,"class":o});for(var s in r.dependencies){var c=r.dependencies[s];c.name&&(y.setEdge(c.name,r.name,{width:20}),n[c.name]?n[c.name]+=1:n[c.name]=1)}}y.setNode("start",{labelType:"html",label:'<div id="start" class="recipeNode" onclick="nodeClick(\'start\')"><span class=name>Start</span></div>',rx:5,ry:5,padding:0}),g={name:"start",job_type:{title:"Start"},input_data:t.recipeType.input_data};var l=_.filter(e,"depStart",!0);for(var u in l)y.setEdge("start",l[u].name,{width:20});y.setNode("end",{labelType:"html",label:'<div class="recipeNode"><span class="name">End</span></div>',rx:5,ry:5,padding:0});var d=_.filter(e,function(e){return!n[e.name]});for(var p in d)y.setEdge(d[p].name,"end",{width:20});_.defer(function(){v.call(S,y),b.event(d3.select("svg")),$(".node rect").attr("class","nodeRect"),f.selectedJob&&T(f.selectedJob.name).classed("selected-node",!0)})};var M=function(e,n){var i=[];return _.forEach(t.recipeType.definition.jobs,function(t,r){t.name!==e&&_.forEach(t.dependencies,function(r,o){r.name===e&&_.forEach(r.connections,function(e,r){e.output===n&&i.push({name:t.name,output:e.output,input:e.input})})})}),i};I()}]).directive("aisScaleRecipeGraphViewer",function(){"use strict";return{controller:"aisScaleRecipeGraphViewerController",controllerAs:"vm",templateUrl:"modules/recipes/partials/recipeGraphViewerTemplate.html",restrict:"E",scope:{recipeType:"=",recipe:"=",isModified:"=modified",allowEdit:"=",hasContainer:"="}}})}(),function(){"use strict";angular.module("scaleApp").factory("Recipe",["scaleConfig","RecipeType","scaleService",function(e,t,n){var i=function(n,i,r,o,a){this.id=n,this.created=i,this.created_formatted=moment.utc(i).format(e.dateFormats.day_second_utc_nolabel),this.completed=r,this.completed_formatted=r?moment.utc(r).format(e.dateFormats.day_second_utc_nolabel):"",this.last_modified=o,this.last_modified_formatted=moment.utc(o).format(e.dateFormats.day_second_utc_nolabel),this.last_status_change=o?moment.duration(moment.utc(o).diff(moment.utc())).humanize(!0):"",this.recipe_type=t.transformer(a)};return i.prototype={getDuration:function(){return n.calculateDuration(this.created,this.last_modified)}},i.build=function(e){return e?new i(e.id,e.created,e.completed,e.last_modified,e.recipe_type):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build).filter(Boolean):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("RecipeData",function(){var e=function(e,t,n){this.input_data=e,this.version=t,this.workspace_id=n};return e.build=function(t){return t?new e(t.input_data,t.version,t.workspace_id):new e},e.transformer=function(t){return angular.isArray(t)?t.map(e.build).filter(Boolean):e.build(t)},e})}(),function(){"use strict";angular.module("scaleApp").factory("RecipeDetails",["RecipeData","RecipeTypeDefinition","RecipeType","RecipeTypeDetail","RecipeJobContainer","scaleConfig",function(e,t,n,i,r,o){var a=function(t,a,s,c,l,u,d,p,f,g,m,h,v){this.id=t,this.created=a,this.completed=s,this.completed_formatted=this.completed?moment.utc(this.completed).format(o.dateFormats.day_second_utc):this.completed,this.last_modified=c,this.data=e.transformer(l),this.recipe_type=n.transformer(u),this.recipe_type_rev=i.transformer(d),this.jobs=r.transformer(p),this.is_superseded=f,this.root_superseded_recipe=g,this.superseded_recipe=m,this.superseded_by_recipe=h,this.superseded=v};return a.build=function(e){return e?new a(e.id,e.created,e.completed,e.last_modified,e.data,e.recipe_type,e.recipe_type_rev,e.jobs,e.is_superseded,e.root_superseded_recipe,e.superseded_recipe,e.superseded_by_recipe,e.superseded):new a},a.transformer=function(e){return angular.isArray(e)?e.map(a.build).filter(Boolean):a.build(e)},a}])}(),function(){"use strict";angular.module("scaleApp").factory("RecipeJob",["JobType",function(e){var t=function(t,n,i){this.id=t,this.status=n,this.job_type=e.transformer(i)};return t.build=function(e){return e?new t(e.id,e.status,e.job_type):new t},t.transformer=function(e){return angular.isArray(e)?e.map(t.build).filter(Boolean):t.build(e)},t}])}(),function(){"use strict";angular.module("scaleApp").factory("RecipeJobContainer",["RecipeJob",function(e){var t=function(t,n){this.job_name=t,this.job=e.transformer(n)};return t.build=function(e){return e?new t(e.job_name,e.job):new t},t.transformer=function(e){return angular.isArray(e)?e.map(t.build).filter(Boolean):t.build(e)},t}])}(),function(){"use strict";angular.module("scaleApp").factory("RecipeType",["scaleConfig","RecipeTypeDefinition",function(e,t){var n=function(e,n,i,r,o,a,s,c,l,u,d,p){this.id=e,this.name=n,this.version=i,this.title=r,this.description=o,this.is_active=a,this.definition=s?t.transformer(s):new t,this.revision_num=c,this.created=l,this.last_modified=u,this.archived=d,p?this.trigger_rule=p:this.trigger_rule={type:"",name:"",is_active:!1,configuration:{condition:{media_type:"",data_types:[]},data:{workspace_name:"",input_data_name:""}}},this.modified=!1};return n.build=function(e){return e?new n(e.id,e.name,e.version,e.title,e.description,e.is_active,e.definition,e.revision_num,e.created,e.last_modified,e.archived,e.trigger_rule):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").factory("RecipeTypeDefinition",["scaleConfig","RecipeTypeDefinitionJob","JobTypeInputData",function(e,t,n){var i=function(e,i,r){this.input_data=e?n.transformer(e):[],this.version=i||"1.0",this.jobs=r?t.transformer(r):[]},r=function(e,t){for(var n=t,i=_.find(e,{name:t}),r=2;i;)n=t+"-"+r,i=_.find(e,{name:n}),r++;return n};return i.prototype={addJob:function(e){var t=r(this.jobs,e.name);console.log(t);var n={dependencies:[],recipe_inputs:[],name:t,job_type_id:e.id,job_type:e};this.jobs.push(n)}},i.build=function(e){return e?new i(e.input_data,e.version,e.jobs):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("RecipeTypeDefinitionJob",["scaleConfig","JobTypeDetails",function(e,t){var n=function(e,t,n,i){this.recipe_inputs=e,this.name=t,this.job_type=n,this.dependencies=i||[]};return n.build=function(e){return e?new n(e.recipe_inputs,e.name,e.job_type,e.dependencies):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").factory("RecipeTypeDetail",["scaleConfig","RecipeTypeDefinition","JobTypeDetails",function(e,t,n){var i=function(e,i,r,o,a,s,c,l,u,d,p,f){
this.id=e,this.name=i,this.version=r,this.title=o,this.description=a,this.is_active=s,this.definition=t.transformer(c),this.created=l,this.last_modified=u,this.archived=d,this.trigger_rule=p,this.job_types=n.transformer(f),this.modified=!1};return i.build=function(e){return e?new i(e.id,e.name,e.version,e.title,e.description,e.is_active,e.definition,e.created,e.last_modified,e.archived,e.trigger_rule,e.job_types):new i},i.transformer=function(e){return angular.isArray(e)?e.map(i.build):i.build(e)},i}])}(),function(){"use strict";angular.module("scaleApp").factory("RecipeTypeValidation",["RecipeTypeDefinition",function(e){var t=function(e){var t=[];return _.forEach(e,function(e){t.push({recipe_inputs:e.recipe_inputs,name:e.name,job_type:{name:e.job_type.name,version:e.job_type.version},dependencies:e.dependencies})}),t},n=function(e,n,i,r,o,a,s){e&&(this.id=e),this.name=n,this.version=i,this.title=r,this.description=o,this.definition={input_data:a.input_data,jobs:t(a.jobs)},this.trigger_rule=s};return n.build=function(e){return e?new n(e.id,e.name,e.version,e.title,e.description,e.definition,e.trigger_rule):new n},n.transformer=function(e){return angular.isArray(e)?e.map(n.build):n.build(e)},n}])}(),function(){"use strict";angular.module("scaleApp").service("recipeService",["$http","$q","$timeout","scaleConfig","RecipeType","RecipeTypeDetail","Recipe","RecipeDetails","RecipeTypeValidation",function(e,t,n,i,r,o,a,s,c){var l=function(e,t,n,i,r,o,a,s,c){return{page:e,page_size:t,started:n,ended:i,order:r,completed:o,recipe_type_id:a,recipe_type_name:s,url:c}},u=function(e,t,n,i,r){return{page:e,page_size:t,started:n,ended:i,order:r?r:["title","version"]}};return{getRecipeTypes:function(n){n=n||u();var o=t.defer();return e({url:i.getUrlPrefix("recipe-types")+"recipe-types/",method:"GET",params:n}).success(function(e){e.results=r.transformer(e.results),o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},getRecipeTypeDetail:function(n){var r=t.defer();return e.get(i.getUrlPrefix("recipe-types")+"recipe-types/"+n+"/").success(function(e){var t=o.transformer(e);r.resolve(t)}),r.promise},getRecipes:function(n){n=n||l();var r=t.defer();return e({url:n.url?n.url:i.getUrlPrefix("recipes")+"recipes/",method:"GET",params:n}).success(function(e){e.results=a.transformer(e.results),r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getRecipeDetails:function(n){var r=t.defer();return e.get(i.getUrlPrefix("recipes")+"recipes/"+n+"/").success(function(e){console.log("getRecipeDetails"),console.log(e);var t=s.transformer(e);r.resolve(t)}).error(function(e){r.reject(e)}),r.promise},saveRecipeType:function(n){var r=t.defer(),o=c.transformer(n);return o.id?e.patch(i.getUrlPrefix("recipe-types")+"recipe-types/"+o.id+"/",o).success(function(e){n=e,r.resolve(n)}).error(function(e){r.reject(e)}):e.post(i.getUrlPrefix("recipe-types")+"recipe-types/",o).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},validateRecipeType:function(n){var r=t.defer(),o=c.transformer(n);return e.post(i.getUrlPrefix("recipe-types")+"recipe-types/validation/",o).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}])}(),function(){"use strict";angular.module("scaleApp").controller("workspacesController",["$scope","$location","$uibModal","$routeParams","scaleConfig","navService","workspacesService","scaleService","stateService","userService","gridFactory","Workspace","toastr",function(e,t,n,i,r,o,a,s,c,l,u,d,p){var f=this,g={},m=[],h=[];f.loading=!0,f.scaleConfig=r,f.showActive=c.getShowActiveWorkspaces(),f.workspaces=[],f.localWorkspaces=[],f.activeWorkspace={},f.addBtnClass="btn-primary",f.addBtnIcon="fa-plus-circle",f.saveBtnClass="btn-default",f.mode="view",f.user=l.getUserCreds(),f.readonly=!(f.user&&f.user.is_admin),f.brokerDescription="",f.availableWorkspaceTypes=_.cloneDeep(r.workspaceTypes),f.cancelCreate=function(){f.mode="view",f.activeWorkspace=d.transformer(_.cloneDeep(g)),"0"===i.id&&t.path("/workspaces")},f.editWorkspace=function(){g=d.transformer(_.cloneDeep(f.activeWorkspace)),f.mode="edit"},f.saveWorkspace=function(){a.saveWorkspace(f.activeWorkspace).then(function(e){f.activeWorkspace=d.transformer(e),r["static"]&&localStorage.setItem("workspace"+f.activeWorkspace.id,JSON.stringify(f.activeWorkspace)),f.mode="view",y()})["catch"](function(){})},f.clearLocalWorkspaces=function(){_.forEach(f.localWorkspaces,function(e){localStorage.removeItem("workspace"+e.id)}),t.path("/workspaces")},f.newWorkspace=function(){f.mode="add",f.loadWorkspace(0)},f.loadWorkspace=function(e){t.path("workspaces/"+e)};var v=function(e){var t="";return _.forEach(e,function(e){t+="<b>"+e.id+":</b> "+e.details+"<br /><br />"}),t+='<button type="button" class="btn btn-default btn-xs clear">Hide</button>'};f.validateWorkspace=function(){f.loading=!0,a.validateWorkspace(f.activeWorkspace).then(function(e){if(e.warnings&&e.warnings.length>0){var t=v(e.warnings);p.error(t)}else p.success("Workspace is valid.")})["catch"](function(e){e.detail?p.error(e.detail):p.error(e)})["finally"](function(){f.loading=!1})},e.$watch("vm.activeWorkspace.json_config.broker.type",function(e){"nfs"===e?f.brokerDescription=r.nfsBrokerDescription:"host"===e?f.brokerDescription=r.hostBrokerDescription:"s3"===e&&(f.brokerDescription=r.s3BrokerDescription)}),e.$watch("vm.showActive",function(e,t){angular.equals(e,t)||(f.showActive=e,c.setShowActiveWorkspaces(e),f.workspaces=f.showActive?_.cloneDeep(m):_.cloneDeep(h))});var y=function(){f.loading=!0,a.getWorkspaces().then(function(e){if(r["static"]){for(var t,n=0,i={};t=localStorage.key(n);n++)i[t]=localStorage.getItem(t);_.filter(_.pairs(i),function(t){if(_.contains(t[0],"workspace")){var n=JSON.parse(t[1]);f.localWorkspaces.push(n),e.push(n)}})}m=_.filter(e,{is_active:!0}),h=_.filter(e,{is_active:!1}),f.workspaces=f.showActive?_.cloneDeep(m):_.cloneDeep(h),f.loading=!1})["catch"](function(e){f.loading=!1,console.log(e)})},b=function(){if(y(),f.activeWorkspace=null,f.mode="view",i.id){var e=parseInt(i.id);0===e?(f.mode="add",f.activeWorkspace=new d):a.getWorkspaceDetails(e).then(function(e){f.activeWorkspace=d.transformer(e)})}o.updateLocation("workspaces")};b(),angular.element(document).ready(function(){var e=s.getViewportSize(),t=r.headerOffset,n=e.height-t+60;f.containerStyle="height: "+n+"px; max-height: "+n+"px;"})}])}(),function(){"use strict";angular.module("scaleApp").factory("Workspace",["scaleConfig",function(e){var t=function(t,n,i,r,o,a,s,c,l,u,d,p){this.id=t,this.name=n,this.title=i,this.description=r,this.base_url=o,this.is_active=a,this.used_size=s,this.total_size=c,this.created=l,this.archived=u,this.last_modified=d,this.json_config=p||_.cloneDeep(e.workspaceTypes[0])};return t.prototype={clean:function(){return{name:this.name,title:this.title,description:this.description,base_url:this.base_url,is_active:this.is_active,json_config:this.json_config}}},t.build=function(e){return e?new t(e.id,e.name,e.title,e.description,e.base_url,e.is_active,e.used_size,e.total_size,e.created,e.archived,e.last_modified,e.json_config):new t},t.transformer=function(e){return angular.isArray(e)?e.map(t.build):t.build(e)},t}])}(),function(){"use strict";angular.module("scaleApp").service("workspacesService",["$http","$q","$resource","scaleConfig",function(e,t,n,i){return{getWorkspaces:function(){var n=t.defer(),r=i.getUrlPrefix("workspaces")+"workspaces/";return e({url:r,method:"GET",params:{order:"-title"}}).success(function(e){n.resolve(e.results)}).error(function(e){n.reject(e)}),n.promise},getWorkspaceDetails:function(n){var r=t.defer(),o=i.getUrlPrefix("workspaces")+"workspaces/"+n+"/";return e({url:o,method:"GET"}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},validateWorkspace:function(n){var r=t.defer(),o=n.clean();return e.post(i.getUrlPrefix("workspaces")+"workspaces/validation/",o).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},saveWorkspace:function(n){var r=t.defer();return n.id?e.patch(i.getUrlPrefix("workspaces")+"workspaces/"+n.id+"/",n.clean()).success(function(e){n=e,r.resolve(n)}).error(function(e){r.reject(e)}):e.post(i.getUrlPrefix("workspaces")+"workspaces/",n.clean()).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}])}();var updateWindow=function(){console.log("resize")};window.onresize=updateWindow,d3.gantt=function(){function e(t){_(t),S();var i=d3.select(u).append("svg").attr("class","chart").attr("width",l+n.left+n.right).attr("height",c+n.top+n.bottom).append("g").attr("class","gantt-chart").attr("width",l+n.left+n.right).attr("height",c+n.top+n.bottom).attr("transform","translate("+n.left+", "+n.top+")");return i.selectAll(".chart").data(t,g).enter().append("rect").attr("rx",5).attr("ry",5).attr("class",function(e){return null==s[e.status]?"bar":s[e.status]}).attr("y",0).attr("transform",m).attr("height",function(e){return v.rangeBand()}).attr("width",function(e){return h(e[p])-h(e[d])}),i.append("g").attr("class","x axis").attr("transform","translate(0, "+(c-n.top-n.bottom)+")").transition().call(y),i.append("g").attr("class","y axis").transition().call(b),e}var t="fit",n={top:20,right:20,bottom:20,left:60},i=d3.time.day.offset(new Date,-3),r=d3.time.hour.offset(new Date,3),o=t,a=[],s=[],c=document.body.clientHeight-n.top-n.bottom-5,l=document.body.clientWidth-n.right-n.left-5,u="body",d="",p="",f="%H:%M:%S",g=function(e){return e[d]+e.taskName+e[p]},m=function(e){return"translate("+h(e[d])+","+v(e.taskName)+")"},h=d3.time.scale().domain([i,r]).range([0,l]).clamp(!0),v=d3.scale.ordinal().domain(a).rangeRoundBands([0,c-n.top-n.bottom],.1),y=d3.svg.axis().scale(h).orient("bottom").tickFormat(d3.time.format(f)).tickSubdivide(!0).tickSize(8).tickPadding(8),b=d3.svg.axis().scale(v).orient("left").tickSize(0),_=function(e){if(o===t){if(void 0===e||e.length<1)return i=d3.time.day.offset(new Date,-3),void(r=d3.time.hour.offset(new Date,3));e.sort(function(e,t){return e[p]-t[p]}),r=e[e.length-1][p],e.sort(function(e,t){return e[d]-t[d]}),i=e[0][d]}},S=function(){h=d3.time.scale().domain([i,r]).range([0,l]).clamp(!0),v=d3.scale.ordinal().domain(a).rangeRoundBands([0,c-n.top-n.bottom],.1),y=d3.svg.axis().scale(h).orient("bottom").ticks(Math.ceil(l/150)).tickFormat(d3.time.format(f)).tickSubdivide(!0).tickSize(8).tickPadding(8),b=d3.svg.axis().scale(v).orient("left").tickSize(0)};return e.redraw=function(t){console.log("redraw"),_(t),S();var n=d3.select("svg"),i=n.select(".gantt-chart"),r=i.selectAll("rect").data(t,g);return r.enter().insert("rect",":first-child").attr("rx",5).attr("ry",5).attr("class",function(e){return null==s[e.status]?"bar":s[e.status]}).transition().attr("y",0).attr("transform",m).attr("height",function(e){return v.rangeBand()}).attr("width",function(e){return h(e[p])-h(e[d])}),r.transition().attr("transform",m).attr("height",function(e){return v.rangeBand()}).attr("width",function(e){return h(e[p])-h(e[d])}),r.exit().remove(),n.select(".x").transition().call(y),n.select(".y").transition().call(b),e},e.margin=function(t){return arguments.length?(n=t,e):n},e.timeDomain=function(t){return arguments.length?(i=+t[0],r=+t[1],e):[i,r]},e.timeDomainMode=function(t){return arguments.length?(o=t,e):o},e.taskTypes=function(t){return arguments.length?(a=t,e):a},e.taskStatus=function(t){return arguments.length?(s=t,e):s},e.begin=function(t){return arguments.length?(d=t,e):d},e.ended=function(t){return arguments.length?(p=t,e):p},e.width=function(t){return arguments.length?(l=+t,e):l},e.height=function(t){return arguments.length?(c=+t,e):c},e.tickFormat=function(t){return arguments.length?(f=t,e):f},e.renderTo=function(t){return arguments.length?(u=t,e):u},e},!function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",["$injector",function(e){this.includeCheatSheet=!0,this.useNgRoute=e.has("ngViewDirective"),this.templateTitle="Keyboard Shortcuts:",this.templateHeader=null,this.templateFooter=null,this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title" ng-if="!header">{{ title }}</h4><div ng-bind-html="header" ng-if="header"></div><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div ng-bind-html="footer" ng-if="footer"></div><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()"></div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(e,t,n,i,r){function o(e){var t={command:"",shift:"",left:"",right:"",up:"",down:"","return":"",backspace:""};e=e.split("+");for(var n=0;n<e.length;n++)"mod"===e[n]&&(i.navigator&&i.navigator.platform.indexOf("Mac")>=0?e[n]="command":e[n]="ctrl"),e[n]=t[e[n]]||e[n];return e.join(" + ")}function a(e,t,n,i,r,o){this.combo=e instanceof Array?e:[e],this.description=t,this.callback=n,this.action=i,this.allowIn=r,this.persistent=o,this._formated=null}function s(){for(var e=g.hotkeys.length;e--;){var t=g.hotkeys[e];t&&!t.persistent&&u(t)}}function c(){g.helpVisible=!g.helpVisible,g.helpVisible?(b=d("esc"),u("esc"),l("esc",b.description,c,null,["INPUT","SELECT","TEXTAREA"])):(u("esc"),b!==!1&&l(b))}function l(e,t,n,i,r,o){var s,c=["INPUT","SELECT","TEXTAREA"],l=Object.prototype.toString.call(e);if("[object Object]"===l&&(t=e.description,n=e.callback,i=e.action,o=e.persistent,r=e.allowIn,e=e.combo),t instanceof Function?(i=n,n=t,t="$$undefined$$"):angular.isUndefined(t)&&(t="$$undefined$$"),void 0===o&&(o=!0),"function"==typeof n){s=n,r instanceof Array||(r=[]);for(var u,d=0;d<r.length;d++)r[d]=r[d].toUpperCase(),u=c.indexOf(r[d]),-1!==u&&c.splice(u,1);n=function(e){var t=!0,n=e.target||e.srcElement,i=n.nodeName.toUpperCase();if((" "+n.className+" ").indexOf(" mousetrap ")>-1)t=!0;else for(var r=0;r<c.length;r++)if(c[r]===i){t=!1;break}t&&f(s.apply(this,arguments))}}"string"==typeof i?Mousetrap.bind(e,f(n),i):Mousetrap.bind(e,f(n));var p=new a(e,t,n,i,r,o);return g.hotkeys.push(p),p}function u(e){var t=e instanceof a?e.combo:e;if(Mousetrap.unbind(t),angular.isArray(t)){for(var n=!0,i=t.length;i--;)n=u(t[i])&&n;return n}var r=g.hotkeys.indexOf(d(t));return r>-1&&(g.hotkeys[r].combo.length>1?g.hotkeys[r].combo.splice(g.hotkeys[r].combo.indexOf(t),1):g.hotkeys.splice(r,1),!0)}function d(e){if(!e)return g.hotkeys;for(var t,n=0;n<g.hotkeys.length;n++)if(t=g.hotkeys[n],t.combo.indexOf(e)>-1)return t;return!1}function p(e){return e.$id in m||(m[e.$id]=[],e.$on("$destroy",function(){for(var t=m[e.$id].length;t--;)u(m[e.$id].pop())})),{add:function(t){var n;return n=arguments.length>1?l.apply(this,arguments):l(t),m[e.$id].push(n),this}}}function f(e){return function(n,i){if(e instanceof Array){var r=e[0],o=e[1];e=function(e){o.scope.$eval(r)}}t.$apply(function(){e(n,d(i))})}}Mousetrap.prototype.stopCallback=function(e,t){return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(t.contentEditable&&"true"==t.contentEditable)},a.prototype.format=function(){if(null===this._formated){for(var e=this.combo[0],t=e.split(/[\s]/),n=0;n<t.length;n++)t[n]=o(t[n]);this._formated=t}return this._formated};var g=t.$new();g.hotkeys=[],g.helpVisible=!1,g.title=this.templateTitle,g.header=this.templateHeader,g.footer=this.templateFooter,g.toggleCheatSheet=c;var m=[];if(this.useNgRoute&&t.$on("$routeChangeSuccess",function(e,t){s(),t&&t.hotkeys&&angular.forEach(t.hotkeys,function(e){var n=e[2];("string"==typeof n||n instanceof String)&&(e[2]=[n,t]),e[5]=!1,l.apply(this,e)})}),this.includeCheatSheet){var h=r[0],v=e[0],y=angular.element(this.template);l(this.cheatSheetHotkey,this.cheatSheetDescription,c),(v===h||v===h.documentElement)&&(v=h.body),angular.element(v).append(n(y)(g))}var b=!1,_={add:l,del:u,get:d,bindTo:p,template:this.template,toggleCheatSheet:c,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,useNgRoute:this.useNgRoute,purgeHotkeys:s,templateTitle:this.templateTitle};return _}]}]).directive("hotkey",["hotkeys",function(e){return{restrict:"A",link:function(t,n,i){var r,o;angular.forEach(t.$eval(i.hotkey),function(t,n){o="string"==typeof i.hotkeyAllowIn?i.hotkeyAllowIn.split(/[\s,]+/):[],r=n,e.add({combo:n,description:i.hotkeyDescription,callback:t,action:i.hotkeyAction,allowIn:o})}),n.bind("$destroy",function(){e.del(r)})}}}]).run(["hotkeys",function(e){}])}(),function(e,t,n){function i(e,t,n){return e.addEventListener?void e.addEventListener(t,n,!1):void e.attachEvent("on"+t,n)}function r(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return v[e.which]?v[e.which]:y[e.which]?y[e.which]:String.fromCharCode(e.which).toLowerCase()}function o(e,t){return e.sort().join(",")===t.sort().join(",")}function a(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function s(e){return e.preventDefault?void e.preventDefault():void(e.returnValue=!1)}function c(e){return e.stopPropagation?void e.stopPropagation():void(e.cancelBubble=!0)}function l(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function u(){if(!h){h={};for(var e in v)e>95&&112>e||v.hasOwnProperty(e)&&(h[v[e]]=e)}return h}function d(e,t,n){return n||(n=u()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function p(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus"),e.split("+"))}function f(e,t){var n,i,r,o=[];for(n=p(e),r=0;r<n.length;++r)i=n[r],_[i]&&(i=_[i]),t&&"keypress"!=t&&b[i]&&(i=b[i],o.push("shift")),l(i)&&o.push(i);return t=d(i,o,t),{key:i,modifiers:o,action:t}}function g(e,n){return e!==t&&(e===n||g(e.parentNode,n))}function m(e){function n(e){e=e||{};var t,n=!1;for(t in _)e[t]?n=!0:_[t]=0;n||(w=!1)}function u(e,t,n,i,r,a){var s,c,u=[],d=n.type;if(!y._callbacks[e])return[];for("keyup"==d&&l(e)&&(t=[e]),s=0;s<y._callbacks[e].length;++s)if(c=y._callbacks[e][s],(i||!c.seq||_[c.seq]==c.level)&&d==c.action&&("keypress"==d&&!n.metaKey&&!n.ctrlKey||o(t,c.modifiers))){var p=!i&&c.combo==r,f=i&&c.seq==i&&c.level==a;(p||f)&&y._callbacks[e].splice(s,1),u.push(c)}return u}function d(e,t,n,i){y.stopCallback(t,t.target||t.srcElement,n,i)||e(t,n)===!1&&(s(t),c(t))}function p(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=r(e);if(t)return"keyup"==e.type&&S===t?void(S=!1):void y.handleKey(t,a(e),e)}function g(){clearTimeout(b),b=setTimeout(n,1e3)}function h(e,t,i,o){function a(t){return function(){w=t,++_[e],g()}}function s(t){d(i,t,e),"keyup"!==o&&(S=r(t)),setTimeout(n,10)}_[e]=0;for(var c=0;c<t.length;++c){var l=c+1===t.length,u=l?s:a(o||f(t[c+1]).action);v(t[c],u,o,e,c)}}function v(e,t,n,i,r){y._directMap[e+":"+n]=t,e=e.replace(/\s+/g," ");var o,a=e.split(" ");return a.length>1?void h(e,a,t,n):(o=f(e,n),y._callbacks[o.key]=y._callbacks[o.key]||[],u(o.key,o.modifiers,{type:o.action},i,e,r),void y._callbacks[o.key][i?"unshift":"push"]({callback:t,modifiers:o.modifiers,action:o.action,seq:i,level:r,combo:e}))}var y=this;if(e=e||t,!(y instanceof m))return new m(e);y.target=e,y._callbacks={},y._directMap={};var b,_={},S=!1,T=!1,w=!1;y._handleKey=function(e,t,i){var r,o=u(e,t,i),a={},s=0,c=!1;for(r=0;r<o.length;++r)o[r].seq&&(s=Math.max(s,o[r].level));for(r=0;r<o.length;++r)if(o[r].seq){if(o[r].level!=s)continue;c=!0,a[o[r].seq]=1,d(o[r].callback,i,o[r].combo,o[r].seq)}else c||d(o[r].callback,i,o[r].combo);var p="keypress"==i.type&&T;i.type!=w||l(e)||p||n(a),T=c&&"keydown"==i.type},y._bindMultiple=function(e,t,n){for(var i=0;i<e.length;++i)v(e[i],t,n)},i(e,"keypress",p),i(e,"keydown",p),i(e,"keyup",p)}for(var h,v={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},b={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},S=1;20>S;++S)v[111+S]="f"+S;for(S=0;9>=S;++S)v[S+96]=S;m.prototype.bind=function(e,t,n){var i=this;return e=e instanceof Array?e:[e],i._bindMultiple.call(i,e,t,n),i},m.prototype.unbind=function(e,t){var n=this;return n.bind.call(n,e,function(){},t)},m.prototype.trigger=function(e,t){var n=this;return n._directMap[e+":"+t]&&n._directMap[e+":"+t]({},e),n},m.prototype.reset=function(){var e=this;return e._callbacks={},e._directMap={},e},m.prototype.stopCallback=function(e,t){var n=this;return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(!g(t,n.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},m.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},m.init=function(){var e=m(t);for(var n in e)"_"!==n.charAt(0)&&(m[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n))},m.init(),e.Mousetrap=m,"undefined"!=typeof module&&module.exports&&(module.exports=m),"function"==typeof define&&define.amd&&define(function(){return m})}(window,document),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&this.indexOf(e,t)!==-1});